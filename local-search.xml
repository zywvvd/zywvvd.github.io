<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>错误 mkl-service + Intel(R) MKL MKL_THREADING_LAYER=INTEL is incompatible with libgomp.so.1 ... 解决方案</title>
    <link href="/2021/08/19/deep_learning/bug-fix/mkl-service-err-message/mkl-service-err-message/"/>
    <url>/2021/08/19/deep_learning/bug-fix/mkl-service-err-message/mkl-service-err-message/</url>
    
    <content type="html"><![CDATA[<blockquote><p>当使用pytorch 多卡训练时可能会报错 <code>mkl-service + Intel(R) MKL MKL_THREADING_LAYER=INTEL is incompatible ...</code>，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><h4 id="出现问题的条件"><a href="#出现问题的条件" class="headerlink" title="出现问题的条件"></a>出现问题的条件</h4><ul><li>在 pytorch 1.5 + 以上的版本</li><li>在多卡训练</li><li>在import torch 在 import numpy 之前</li></ul><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>如果在 numpy 之前导入了 torch，那么这里的子进程将获得一个 GNU 线程层（即使父进程没有定义变量）</p><p>但是如果 numpy 在 Torch 之前被导入，子进程将获得一个 INTEL 线程层，这种情况会导致线程之间打架</p><ul><li>错误信息</li></ul><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error: </span>mkl-service + Intel® MKL: MKL_THREADING_LAYER=INTEL is incompatible with libgomp.so.1 library. Try to import numpy first or set the threading layer accordingly. Set MKL_SERVICE_FORCE_INTEL to force it.<br></code></pre></td></tr></table></figure><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h4><p>降级pytorch </p><ul><li>降级 pytorch 到1.5 一下</li></ul><h4 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h4><blockquote><p>谁会接受降级啊</p></blockquote><p>使用单卡训练</p><h4 id="方案三"><a href="#方案三" class="headerlink" title="方案三"></a>方案三</h4><blockquote><p>单卡batch size 不够大啊</p></blockquote><ul><li>在python 程序入口 import numpy</li><li>可以极大程度上减少 error 信息输出</li></ul><h4 id="方案四"><a href="#方案四" class="headerlink" title="方案四"></a>方案四</h4><blockquote><p>正儿八经的</p></blockquote><ul><li>在环境变量添加</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">&#x27;MKL_SERVICE_FORCE_INTEL&#x27;</span> = <span class="hljs-string">&#x27;1&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p>可以使得程序继续运行，但错误信息还是会报</p></blockquote><ul><li>再加入</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">&#x27;MKL_THREADING_LAYER&#x27;</span> = <span class="hljs-string">&#x27;GNU&#x27;</span> <br></code></pre></td></tr></table></figure><blockquote><p>据说可以避免报错</p></blockquote><ul><li>可以查看原始 <a href="https://github.com/pytorch/pytorch/issues/37377">issues</a></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://github.com/pytorch/pytorch/issues/37377">https://github.com/pytorch/pytorch/issues/37377</a></li><li><a href="https://blog.csdn.net/qq_40246742/article/details/117898715">https://blog.csdn.net/qq_40246742/article/details/117898715</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorch 拷贝数据</title>
    <link href="/2021/08/18/deep_learning/pytorch/torch-copy/torch-copy/"/>
    <url>/2021/08/18/deep_learning/pytorch/torch-copy/torch-copy/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Pytorch拷贝数据的几种方法，clone(), detach(), new_tensor(), copy_()。</p></blockquote><span id="more"></span><h3 id="1、clone"><a href="#1、clone" class="headerlink" title="1、clone()"></a>1、clone()</h3><p>clone()函数返回一个和源张量同shape、dtype和device的张量，与源张量不共享数据内存，但提供梯度的回溯。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>a = torch.tensor(<span class="hljs-number">1.0</span>, requires_grad=<span class="hljs-literal">True</span>)<br>y = a ** <span class="hljs-number">2</span><br>a_ = a.clone()<br>z = a_ * <span class="hljs-number">3</span><br>y.backward()<br><span class="hljs-built_in">print</span>(a.grad)  <span class="hljs-comment"># 2</span><br>z.backward()<br><span class="hljs-built_in">print</span>(a_.grad)  <span class="hljs-comment"># None, 无grad</span><br><span class="hljs-built_in">print</span>(a.grad)  <span class="hljs-comment"># 5. a_的梯度会传递回给a，因此2+3=5</span><br><br><br>a = a + <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(a_) <span class="hljs-comment"># 1</span><br></code></pre></td></tr></table></figure><p>梯度回溯：进行的运算梯度会加在a（叶子节点）的梯度上。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>a = torch.tensor(<span class="hljs-number">1.0</span>, requires_grad=<span class="hljs-literal">True</span>)<br>a_ = a.clone()<br>a_.add_(torch.tensor(<span class="hljs-number">1.0</span>))<br><span class="hljs-built_in">print</span>(a)    <span class="hljs-comment"># tensor(1., requires_grad=True)</span><br><span class="hljs-built_in">print</span>(a_)   <span class="hljs-comment"># tensor(2., grad_fn=&lt;AddBackward0&gt;)</span><br>a_.backward()<br><span class="hljs-built_in">print</span>(a_.grad)  <span class="hljs-comment"># None</span><br><span class="hljs-built_in">print</span>(a.grad)   <span class="hljs-comment"># tensor(1.)</span><br>可以发现不共享内存空间。<br></code></pre></td></tr></table></figure><h3 id="2、detach"><a href="#2、detach" class="headerlink" title="2、detach()"></a>2、detach()</h3><p>detach()函数返回一个和源张量同shape、dtype和device的张量，并且与源张量共享数据内存，但不提供梯度的回溯。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>a = torch.tensor(<span class="hljs-number">1.0</span>, requires_grad=<span class="hljs-literal">True</span>)<br>y = a ** <span class="hljs-number">2</span><br>a_ = a.detach()<br><span class="hljs-built_in">print</span>(a_.grad)  <span class="hljs-comment"># None，requires_grad=False</span><br>a_.requires_grad_()  <span class="hljs-comment"># set a_.requires_grad = True</span><br>z = a_ * <span class="hljs-number">3</span><br>y.backward()<br>z.backward()<br><span class="hljs-built_in">print</span>(a_.grad)  <span class="hljs-comment"># tensor(3.)</span><br><span class="hljs-built_in">print</span>(a.grad)  <span class="hljs-comment"># tensor(2.)</span><br></code></pre></td></tr></table></figure><p>可见，a_即使重新定义requires_grad=True，也与a的梯度没有关系。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>a = torch.tensor(<span class="hljs-number">1.0</span>, requires_grad=<span class="hljs-literal">True</span>)<br>a_ = a.detach()<br>a_.add_(torch.tensor(<span class="hljs-number">1.0</span>))<br><span class="hljs-built_in">print</span>(a)    <span class="hljs-comment"># tensor(2., requires_grad=True)</span><br><span class="hljs-built_in">print</span>(a_)   <span class="hljs-comment"># tensor(2.)</span><br><span class="hljs-comment"># a_.backward()</span><br><span class="hljs-comment"># print(a.grad) # RuntimeError: element 0 of tensors does not require grad and does not have a grad_fn</span><br></code></pre></td></tr></table></figure><p>容易验证a与a_共享内存空间</p><h3 id="3、torch-clone-detach-（建议赋值方法）"><a href="#3、torch-clone-detach-（建议赋值方法）" class="headerlink" title="3、torch.clone.detach() （建议赋值方法）"></a>3、torch.clone.detach() （建议赋值方法）</h3><p>clone()提供了非数据内存共享的梯度追溯功能，而detach又“舍弃”了梯度回溯功能，因此clone.detach()只做简单的数据复制，既不数据共享，也不梯度共享，从此两个张量无关联。<br>置于是先clone还是先detach，其返回值一样，一般采用sourcetensor.clone().detach()。</p><h3 id="4、new-tensor"><a href="#4、new-tensor" class="headerlink" title="4、new_tensor()"></a>4、new_tensor()</h3><p>new_tensor()可以将源张量中的数据复制到目标张量（数据不共享），同时提供了更细致的属性控制：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>a = torch.tensor(<span class="hljs-number">1.0</span>, device=<span class="hljs-string">&quot;cuda&quot;</span>, dtype=torch.float32, requires_grad=<span class="hljs-literal">True</span>)<br>b = a.clone()<br>c = a.detach()<br>d = a.clone().detach()<br>e = a.new_tensor(a)  <span class="hljs-comment"># more attributions could be setted</span><br>f = a.new_tensor(a, device=<span class="hljs-string">&quot;cpu&quot;</span>, dtype=torch.float64, requires_grad=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(a)  <span class="hljs-comment"># tensor(1., device=&#x27;cuda:0&#x27;, requires_grad=True)</span><br><span class="hljs-built_in">print</span>(b)  <span class="hljs-comment"># tensor(1., device=&#x27;cuda:0&#x27;, grad_fn=&lt;CloneBackward&gt;)</span><br><span class="hljs-built_in">print</span>(c)  <span class="hljs-comment"># tensor(1., device=&#x27;cuda:0&#x27;)</span><br><span class="hljs-built_in">print</span>(d)  <span class="hljs-comment"># tensor(1., device=&#x27;cuda:0&#x27;)</span><br><span class="hljs-built_in">print</span>(e)  <span class="hljs-comment"># tensor(1., device=&#x27;cuda:0&#x27;)</span><br><span class="hljs-built_in">print</span>(f)  <span class="hljs-comment"># tensor(1., dtype=torch.float64)</span><br></code></pre></td></tr></table></figure><h3 id="5、copy"><a href="#5、copy" class="headerlink" title="5、copy_()"></a>5、copy_()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>a = torch.tensor(<span class="hljs-number">1.0</span>, device=<span class="hljs-string">&quot;cpu&quot;</span>, requires_grad=<span class="hljs-literal">False</span>)<br>b = torch.tensor(<span class="hljs-number">2.0</span>, device=<span class="hljs-string">&quot;cuda&quot;</span>, requires_grad=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(a)  <span class="hljs-comment"># tensor(1.)</span><br><span class="hljs-built_in">print</span>(b)  <span class="hljs-comment"># tensor(2., device=&#x27;cuda:0&#x27;, requires_grad=True)</span><br>a.copy_(b)<br><span class="hljs-built_in">print</span>(a)  <span class="hljs-comment"># tensor(2., grad_fn=&lt;CopyBackwards&gt;)</span><br><span class="hljs-built_in">print</span>(a.device)  <span class="hljs-comment"># cpu</span><br><span class="hljs-built_in">print</span>(a.requires_grad)  <span class="hljs-comment"># True</span><br></code></pre></td></tr></table></figure><p><code>copy_()</code>会将b复制给a，同时改变 a 的 requires_grad 属性，但不改变 device 属性。（当a.requires_grad=False是copy_()方法会报错）</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_40438388/article/details/106860180">https://blog.csdn.net/qq_40438388/article/details/106860180</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>设置 CUDA_VISIBLE_DEVICES</title>
    <link href="/2021/08/17/deep_learning/cuda-vis-device/cuda-vis-device/"/>
    <url>/2021/08/17/deep_learning/cuda-vis-device/cuda-vis-device/</url>
    
    <content type="html"><![CDATA[<blockquote><p>深度学习过程中需要配置可见的显卡设备，本文记录 CUDA_VISIBLE_DEVICES 配置方法。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>服务器中有多个GPU，选择特定的GPU运行程序可在程序运行命令前使用：<code>CUDA_VISIBLE_DEVICES=0</code>命令。0为服务器中的GPU编号，可以为0, 1, 2, 3等，表明对程序可见的GPU编号。</p><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td>CUDA_VISIBLE_DEVICES=1</td><td>只有编号为1的GPU对程序是可见的，在代码中gpu[0]指的就是这块GPU</td></tr><tr><td>CUDA_VISIBLE_DEVICES=0,2,3</td><td>只有编号为0,2,3的GPU对程序是可见的，在代码中gpu[0]指的是第0块，gpu[1]指的是第2块，gpu[2]指的是第3块</td></tr><tr><td>CUDA_VISIBLE_DEVICES=2,0,3</td><td>只有编号为0,2,3的GPU对程序是可见的，但是在代码中gpu[0]指的是第2块，gpu[1]指的是第0块，gpu[2]指的是第3块</td></tr></tbody></table><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h5 id="临时设置"><a href="#临时设置" class="headerlink" title="临时设置"></a>临时设置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">Linux： export CUDA_VISIBLE_DEVICES=1<br>windows:  set CUDA_VISIBLE_DEVICES=1<br></code></pre></td></tr></table></figure><h5 id="python-运行时设置"><a href="#python-运行时设置" class="headerlink" title="python 运行时设置"></a>python 运行时设置</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = <span class="hljs-string">&quot;1&quot;</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">CUDA_VISIBLE_DEVICES</span>=<span class="hljs-number">1</span> python **.py<br></code></pre></td></tr></table></figure><p><strong>注意</strong>：这种设置方法一定要<strong>在第一次使用 cuda 之前进行设置</strong></p><h5 id="永久设置"><a href="#永久设置" class="headerlink" title="永久设置"></a>永久设置</h5><ul><li>linux:<br>在~/.bashrc 的最后加上export CUDA_VISIBLE_DEVICES=1，然后source ~/.bashrc</li><li>windows:<br>打开我的电脑环境变量设置的地方，直接添加就行了。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/lscelory/article/details/83579062">https://blog.csdn.net/lscelory/article/details/83579062</a></li><li><a href="https://blog.csdn.net/weixin_41803874/article/details/93541309">https://blog.csdn.net/weixin_41803874/article/details/93541309</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LINUX下运行.sh文件出现Syntax error end of file unexpected (expecting “then”) 解决方案</title>
    <link href="/2021/08/17/linux/expect-then/expect-then/"/>
    <url>/2021/08/17/linux/expect-then/expect-then/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录 <code>Syntax error: end of file unexpected (expecting “then”)</code> 错误解决方案。</p></blockquote><span id="more"></span><h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><blockquote><p>出现问题的<strong>原因</strong>是.sh文件是dos格式文件，但是linux的shell需要unix格式的文件</p></blockquote><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>转换文件格式</li></ul><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>sudo apt-get install dos2unix<br><span class="hljs-variable">$ </span>dos2unix &lt;filename&gt;<br></code></pre></td></tr></table></figure><ul><li>随后重新运行 sh 文件</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_38989148/article/details/105340521">https://blog.csdn.net/qq_38989148/article/details/105340521</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fluid -3- pdf.js PC,移动端查看 PDF</title>
    <link href="/2021/08/15/hexo-theme/fluid/fluid-pdf/fluid-pdf/"/>
    <url>/2021/08/15/hexo-theme/fluid/fluid-pdf/fluid-pdf/</url>
    
    <content type="html"><![CDATA[<blockquote><p>hexo 有各种支持pdf的查看方案，但大多不同时支持移动端和PC端，本文记录使用 <code>pdf.js</code> 实现各设备查看 pdf 的方法。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>pdf.js 是用于解析和呈现 PDF 的基于 Web 标准平台的通用解决方案，功能强大。</p><p>官方网站：<a href="https://mozilla.github.io/pdf.js/">https://mozilla.github.io/pdf.js/</a></p><h3 id="下载-pdf-js"><a href="#下载-pdf-js" class="headerlink" title="下载 pdf.js"></a>下载 pdf.js</h3><ul><li>官网地址：<a href="https://mozilla.github.io/pdf.js/">https://mozilla.github.io/pdf.js/</a></li><li>新版本不支持部分浏览器，为了更好的兼容性，下载旧版本浏览器的文件包</li><li>点击 <code>Download</code> 按钮</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210818111723.png"></p><ul><li>下载并解压相关内容</li></ul><h3 id="修改-viewer-js"><a href="#修改-viewer-js" class="headerlink" title="修改 viewer.js"></a>修改 viewer.js</h3><p>直接使用下载的文件会报错</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error: </span>file origin does not match viewer&#x27;s<br></code></pre></td></tr></table></figure><p>需要注释掉</p><ul><li> <code>web/viewer.js</code> 文件中的相应内容：</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210818112623.png"></p><h3 id="加入主题"><a href="#加入主题" class="headerlink" title="加入主题"></a>加入主题</h3><p>将下载文件夹命名为 pdfjs，拷贝到 <code>themes/fluid/source/js</code> 中</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210815161714.png"></p><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ul><li>在markdown 文档中使用 <code>&lt;iframe&gt;</code> 控件配合pdf.js 库完成pdf 显示</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;iframe <span class="hljs-attribute">src</span>=<span class="hljs-string">&#x27;/js/pdfjs/web/viewer.html?file=&lt;src-to-pdf&gt;&#x27;</span> <span class="hljs-attribute">style</span>=<span class="hljs-string">&#x27;width:100%;height:100%&#x27;</span>&gt;&lt;/iframe&gt;<br></code></pre></td></tr></table></figure><p>src-to-pdf：为 pdf 文件的链接</p><p>style 可以根据实际需求适当调整</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><iframe src='/js/pdfjs/web/viewer.html?file=https://photos.zywvvd.com/win11-mt/20210814144827.pdf' style='width:100%;height:600px'></iframe><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://mozilla.github.io/pdf.js/">https://mozilla.github.io/pdf.js/</a></li><li><a href="https://blog.csdn.net/qq_20473985/article/details/84984136">https://blog.csdn.net/qq_20473985/article/details/84984136</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>fluid</category>
      
    </categories>
    
    
    <tags>
      
      <tag>fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -18- 添加 PDF 阅读功能</title>
    <link href="/2021/08/14/hexo/18%20hexo-pdf/hexo-pdf/"/>
    <url>/2021/08/14/hexo/18%20hexo-pdf/hexo-pdf/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍在hexo 中添加 pdf 插件的方法。</p></blockquote><span id="more"></span><h3 id="方法一-hexo-pdf"><a href="#方法一-hexo-pdf" class="headerlink" title="方法一  hexo pdf"></a>方法一  hexo pdf</h3><ul><li>安装 hexo pdf 插件</li><li>在博客中插入pdf 指令</li></ul><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs node.js">$ npm install --save hexo-pdf<br></code></pre></td></tr></table></figure><p>官网：<a href="https://github.com/superalsrk/hexo-pdf">https://github.com/superalsrk/hexo-pdf</a></p><h4 id="插入链接"><a href="#插入链接" class="headerlink" title="插入链接"></a>插入链接</h4><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name">pdf</span> &lt;url-to-pdf&gt; %&#125;</span><br></code></pre></td></tr></table></figure><ul><li>该方法可以方便地在hexo PC端嵌入PDF</li><li>弊端是手机端无法正常显示页面</li></ul><h3 id="方法二-lt-iframe-gt"><a href="#方法二-lt-iframe-gt" class="headerlink" title="方法二 &lt; iframe &gt;"></a>方法二 &lt; iframe &gt;</h3><p>所有浏览器都支持 &lt; iframe &gt; 标签，直接将src设置为指定的PDF文件就可以预览了。</p><p>此外可以把需要的文本放置在 &lt; iframe &gt; 和 之间，这样就可以应对无法理解 iframe 的浏览器，比如下面的代码可以提供一个PDF的下载链接：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">&lt;iframe src=<span class="hljs-string">&quot;/index.pdf&quot;</span> width=<span class="hljs-string">&quot;100%&quot;</span> height=<span class="hljs-string">&quot;100%&quot;</span>&gt;<br><br>This browser does <span class="hljs-keyword">not</span> support PDFs. Please download <span class="hljs-keyword">the</span> PDF <span class="hljs-built_in">to</span> view <span class="hljs-keyword">it</span>: &lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">&quot;/index.pdf&quot;</span>&gt;Download PDF&lt;/<span class="hljs-keyword">a</span>&gt;<br><br>&lt;/iframe&gt;<br></code></pre></td></tr></table></figure><ul><li>可以在PC端显示</li><li>手机端无法显示</li><li>进入页面会自动跳入下载pdf文件，并不好用</li></ul><h3 id="方法三-lt-embed-gt"><a href="#方法三-lt-embed-gt" class="headerlink" title="方法三 &lt; embed &gt;"></a>方法三 &lt; embed &gt;</h3><p>&lt; embed &gt; 标签定义嵌入的内容。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;embed <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;/index.pdf&quot;</span> <span class="hljs-attribute">type</span>=<span class="hljs-string">&quot;application/pdf&quot;</span> <span class="hljs-attribute">width</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attribute">height</span>=<span class="hljs-string">&quot;100%&quot;</span>&gt;<br></code></pre></td></tr></table></figure><ul><li>可以在PC端显示</li><li>手机端无法显示</li></ul><h3 id="方法四-lt-object-gt"><a href="#方法四-lt-object-gt" class="headerlink" title="方法四 &lt; object &gt;"></a>方法四 &lt; object &gt;</h3><p>&lt; object &gt;定义一个嵌入的对象，请使用此元素向页面添加多媒体。此元素允许您规定插入 HTML 文档中的对象的数据和参数，以及可用来显示和操作数据的代码。用于包含对象，比如图像、音频、视频、Java applets、ActiveX、PDF 以及 Flash。几乎所有主流浏览器都拥有部分对 &lt; object &gt; 标签的支持。这个标签在这里的用法和&lt; iframe &gt;很小，也支持回退：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">&lt;object data=<span class="hljs-string">&quot;/index.php&quot;</span> type=<span class="hljs-string">&quot;application/pdf&quot;</span> width=<span class="hljs-string">&quot;100%&quot;</span> height=<span class="hljs-string">&quot;100%&quot;</span>&gt;<br><br>This browser does <span class="hljs-keyword">not</span> support PDFs. Please download <span class="hljs-keyword">the</span> PDF <span class="hljs-built_in">to</span> view <span class="hljs-keyword">it</span>: &lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">&quot;/index.pdf&quot;</span>&gt;Download PDF&lt;/<span class="hljs-keyword">a</span>&gt;<br><br>&lt;/object&gt;<br></code></pre></td></tr></table></figure><ul><li><p>当然，结合&lt; object &gt;和&lt; iframe &gt;能提供一个更强大的回退方案：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs typescript">&lt;<span class="hljs-built_in">object</span> data=<span class="hljs-string">&quot;/index.pdf&quot;</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;application/pdf&quot;</span> width=<span class="hljs-string">&quot;100%&quot;</span> height=<span class="hljs-string">&quot;100%&quot;</span>&gt;<br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/index.pdf&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100%&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;border: none;&quot;</span>&gt;</span></span><br><span class="xml"></span><br><span class="xml">This browser does not support PDFs. Please download the PDF to view it: <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/index.pdf&quot;</span>&gt;</span>Download PDF<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml"></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span></span><br><br>&lt;/<span class="hljs-built_in">object</span>&gt;<br><br></code></pre></td></tr></table></figure></li><li><p>手机端不支持该方案</p></li></ul><h3 id="方法五-pdf-js"><a href="#方法五-pdf-js" class="headerlink" title="方法五 pdf.js"></a>方法五 pdf.js</h3><blockquote><p><strong>全平台查看PDF解决方案</strong></p></blockquote><p>使用方法</p><ul><li><p>下载 pdf.js</p></li><li><p>官网地址：<a href="https://mozilla.github.io/pdf.js/">https://mozilla.github.io/pdf.js/</a></p></li><li><p>新版本不支持部分浏览器，为了更好的兼容性，下载旧版本浏览器的文件包，点击 <code>Download</code> 按钮</p></li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210818111723.png"></p><ul><li>下载并解压相关内容，使用 viewer.html 配合 iframe 插件查看pdf文件：</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;iframe <span class="hljs-attribute">src</span>=<span class="hljs-string">&#x27;/js/pdfjs/web/viewer.html?file=&lt;src-to-pdf&gt;&#x27;</span> <span class="hljs-attribute">style</span>=<span class="hljs-string">&#x27;width:100%;height:100%&#x27;</span>&gt;&lt;/iframe&gt;<br></code></pre></td></tr></table></figure><ul><li>使用时会报错：</li></ul><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error: </span>file origin does not match viewer&#x27;s<br></code></pre></td></tr></table></figure><ul><li>需要注释掉 <code>web/viewer.js</code> 文件中的相应内容：</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210818112623.png"></p><ul><li>示例：</li></ul><iframe src='/js/pdfjs/web/viewer.html?file=https://photos.zywvvd.com/win11-mt/20210814144827.pdf' style='width:100%;height:100%'></iframe><ul><li>这是目前发现唯一支持多平台浏览PDF的方案</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://github.com/superalsrk/hexo-pdf">https://github.com/superalsrk/hexo-pdf</a></p></li><li><p><a href="https://mozilla.github.io/pdf.js/">https://mozilla.github.io/pdf.js/</a></p></li><li><p><a href="https://www.cnblogs.com/liangziaha/p/12486766.html#">https://www.cnblogs.com/liangziaha/p/12486766.html#</a></p></li><li><p><a href="https://blog.csdn.net/qq_20473985/article/details/84984136">https://blog.csdn.net/qq_20473985/article/details/84984136</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>神经网络 Attention</title>
    <link href="/2021/08/14/deep_learning/attention/attention/"/>
    <url>/2021/08/14/deep_learning/attention/attention/</url>
    
    <content type="html"><![CDATA[<blockquote><p>随着神经网络的发展，注意力模型已经被广泛的应用到自然语言处理，统计学习语音识别和计算机视觉等人工智能相关领域。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Attention机制：又称为注意力机制，顾名思义，是一种能让模型对重要信息重点关注并充分学习吸收的技术.通俗的讲就是把注意力集中放在重要的点上，而忽略其他不重要的因素。其中重要程度的判断取决于应用场景，根据应用场景的不同，Attention分为<strong>空间注意力</strong>和<strong>时间注意力</strong>，前者用于<strong>图像处理</strong>，后者用于<strong>自然语言处理.</strong></p><p>注意力机制的灵感来源可以归结到人对环境的生理感知上来。比方说，我们的视觉系统更倾向于去挑选影像中的部分信息进行集中分析而忽略掉图像中的无关信息。与此类似，很多设计到语言，语音和视觉的问题中都包含与研究任务密切相关的信息，同时也包含着一些无关的信息。比方说，在文本翻译和总结任务中，可能只有输入序列的某些单词与我们的下一个预测输出值有关；在图像标注任务中，可能某些局部信息与下一个标注单词联系更为密切。注意力机制将这种相关系进行了整合，允许模型动态地去关注输入的特定部分从而更为有效地完成手头的任务。</p><p>在神经网络结构中加入注意力模型主要是基于三点考虑：</p><ol><li>首先是这些模型在众多的任务中取得了非常好的性能，比方说机器翻译、问答系统、情感分析、词性标注选民分析和问答系统。</li><li>在提升模型性能的同时，注意力机制增加了神经网络结构的可解释性。由于传统的神经网络是一个黑盒模型，因此提高其可解释性对机器学习模型的公平性、可靠性和透明性的提高至关重要。</li><li>能够帮助缓解递归神经网络中的一些缺陷，比方说随着输入序列长度的增加导致的性能下降和对输入的顺序处理所导致的计算效率低下。本文的目的在于对注意力模型进行一个简单且易理解的介绍。</li></ol><h3 id="序列模型"><a href="#序列模型" class="headerlink" title="序列模型"></a>序列模型</h3><p>一个经典的序列模型 (sequence-to-sequence) 包含一个编码部分和一个解码部分。编码器通常采用一个循环神经网络结构来对序列的输入${x _ { 1 }, x _ { 2 }, \cdots , x _ { T } }$​​​​​​​​​  进行编码得到一组固定长度的编码向量 $ {h_ { 1}, h_ { 2}, \cdots, h_ { T } } $​​。解码器同样利用一个RNN结构读取单个输入 $ h_{T} $​​组固定长度的编码向量 $ {h_ {  1 }, h _ { 2 }, \cdots , h _ { T } } $​​ 。解码器同样利用一个RNN结构读取单个输入 $ h_{T} $​​ 然后一个接一个的进行输出得到一个输出序列 $  {x_ {1 }, x_{2 }, \cdots, x_{T ^ { \prime}} } $​​ 。其中 $ T $​​ 和 $ T^{\prime} $​​ 分别代表输入和输出序列的长度。在每个位置$ t, h_{t} $​​ 和 $ s_{t} $​​​​​​​​​分别代表该位置编码器和解码器的隐藏状态。</p><h4 id="传统编码的弊端"><a href="#传统编码的弊端" class="headerlink" title="传统编码的弊端"></a>传统编码的弊端</h4><p>注意力机制最早用在 seq2seq 模型上<strong>，</strong>原始编解码模型的encode过程会生成一个中间向量C，用于保存原序列的语义信息。但是这个向量长度是固定的，<strong>当输入原序列的长度比较长时，向量C无法保存全部的语义信息</strong>，上下文语义信息受到了限制，这也限制了模型的理解能力。</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210821141955.png"></p><p>常规的编码方法，<strong>无法体现对一个句子序列中不同语素的关注程度</strong>，在自然语言中，一个句子中的不同部分是有不同含义和重要性的，比如：I hate this movie。 如果是做情感分析的应用场景，训练的时候明显应该对hate这个词语做更多的关注。</p><h3 id="注意力模型-Attention"><a href="#注意力模型-Attention" class="headerlink" title="注意力模型 Attention"></a>注意力模型 Attention</h3><p>注意力模型通过允许解码器访问所有编码器产生的输出 $ {h_{1}, h_{2}, \cdots, h_ { T}} $​​ 来克服传统结构的缺点。其核心思想是对编码器的所有输出进行加权组合后输入到当前位置的解码器中来影响解码器的输出。通过对编码器的输出进行加权，在实现输入与输出的对齐的同时还能够利用更多的原始数据的上下文信息。</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210816234637.png" alt="编码器-解码器结构:(a)传统结构 (b)加入注意力机制的模型的结构"></p><h4 id="注意力机制的引入"><a href="#注意力机制的引入" class="headerlink" title="注意力机制的引入"></a>注意力机制的引入</h4><p>引入注意力机制的模型的结构如图(b)所示。注意力模块能够自动地学习权重 $ \alpha_{i j} $ 用来捕捉编码器隐藏状态$ h_{i} $和解码器隐藏状态$ s_{j} $ 的相关性。习得的这些注意力权重将会被用来构建一个上下文向量 $ c $ 来作为解码器的输入。在解码器的每个位置 $ j $,上下文向量 $ c_{j} $ 是由注意力权重对所有的编码器的隐藏状态进行加权求和进行得到的，即: $ c_{j}=\sum_{i=1}^{T^{\prime}} \alpha_{i j} h_{i} $ 。于是, 这一上下文向量其实为解码器提供了一种访问整个输入序列并且关注序列中的特定相关位置的一种机制，我们称这 种机制为注意力机制。</p><h4 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h4><p>以 seq2seq 模型为例子，对于一个句子序列$S$，其由单词序列$[w_1,w_2,w_3,…,w_n]$​构成：</p><ol><li>将$S$的每个单词 $ w_{i} $ 编码为一个单独向量 $ v_{i} $​, 这里对应seq2seq模型, 就是在encoder编码阶段，每个时间步单位(即每个单词)的输出隐状态。</li><li>在解码decoder阶段，待预测词的输入隐状态$C$(即上一个时间步的输出状态)与 (1) 中每个单词的隐状态相乘再做 softmax 归一化后得到权重分数，使用学习到的注意力权重 $ a_{i} $ 对 (1) 中得到的所有单词向量做加权线性组合 $ Z=\sum_{i} a_{i} v_{i} $​。</li><li>利用输入状态$C$以及输入变量$Z$作为对待预测词的共同输入，来进行预测。</li></ol><h4 id="具体描述"><a href="#具体描述" class="headerlink" title="具体描述"></a>具体描述</h4><p>我们的最终目标是要能够帮助decoder在生成词语时，有一个不同词语的权重的参考。在训练时，对于decoder我们是有训练目标的，此时将decoder中的信息定义为一个<strong>Query。</strong>而encoder中包含了所有可能出现的词语，我们将其作为一个<strong>字典</strong>，该字典的<strong>key</strong>为所有encoder的序列信息。n个单词相当于当前字典中有n条记录，而字典的<strong>value</strong>通常也是所有encoder的序列信息。</p><p>上面对应于第一步，然后是第二部计算注意力权重，由于我们要让模型自己去学习该对哪些语素重点关注，因此要用我们的学习目标Query来参与这个过程，因此对于Query的每个向量，通过一个函数 $ a_{i}=F\left(Q_{i}, K\right) $，计算预测i时刻词时，需要学习的注意力权重，由于包含n个单词，因此， $a_i$ 应当是一个n维的向量，为了后续计算方便，需要将该向量进行softmax归一化，让向量的每一维元素都是一个概率值。</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210819232635.png"></p><p>最后对Value vectors进行加权线性组合，得到带权重参考的“字典”输出：</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210819232741.png"></p><p>此处Value 和 Key 是相同的。</p><h4 id="Q，K，V"><a href="#Q，K，V" class="headerlink" title="Q，K，V"></a>Q，K，V</h4><p>Query , Key 和 Value 是注意力机制的几个核心概念，刚接触时总是难以理解，个人总结一些要点辅助理顺思路：</p><ul><li>注意力最终的目的是从已经编码好的 Value 中挑出一组线性组合和 Query 最相关</li><li>那么就需要计算每一组 Value 和当前 Query 的相关程度了</li><li>可以认为 Key 和 Value 是一一绑定的，我们通过计算 Query 和每一组 Key 的相关性来得到 Query 和 Value 的相关性</li><li>将计算得到的相关性向量做 softmax 得到加权系数</li><li>用这个加权系数线性组合 Value 得到解码后的特征</li></ul><h4 id="注意力权重的学习"><a href="#注意力权重的学习" class="headerlink" title="注意力权重的学习"></a>注意力权重的学习</h4><p>注意力权重的学习是通过在原始的网络结构中增加一个前馈网络来实现的。这一前馈网络的注意力权重的值$ \alpha_{i j} $是编码器隐藏状态值 $ h_{j} $和解码器内部隐藏状态值$ \boldsymbol{S}_{i-1} $的函数。该前馈网络可以与之前的网络结构一起进行训练。</p><p>那么如何计算 Query 和 key 的注意力权重$\alpha$呢？</p><p>这里总结了几种方法：</p><ol><li>多层感知机方法</li></ol><p>$$<br>a(q, k)=w_{2}^{T} \tanh \left(W_{1}[q ; k]\right)<br>$$</p><blockquote><p>主要是先将query和key进行拼接，然后接一个激活函数为 $tanh$ 的全连接层，然后再与一个网络定义的权重矩阵做乘积。这种方法据说对于大规模的数据特别有效。</p></blockquote><ol start="2"><li>Bilinear方法</li></ol><p>$$<br>a(q, k)=q^{T} W k<br>$$</p><blockquote><p>通过一个权重矩阵直接建立q和k的关系映射，比较直接，且计算速度较快。</p></blockquote><ol start="3"><li>Dot Product</li></ol><p>$$<br>a(q, k)=q^{T} k<br>$$</p><blockquote><p>这个方法更直接，连权重矩阵都省了，直接建立q和k的关系映射，优点是计算速度更快了，且不需要参数，降低了模型的复杂度。但是需要q和k的维度要相同。</p></blockquote><ol start="4"><li>scaled-dot Product</li></ol><p>$$<br>a(q, k)=\frac{q^{T} k}{\sqrt{|k|}}<br>$$</p><blockquote><p>上面的点积方法有一个问题，就是随着向量维度的增加，最后得到的权重也会增加，为了提升计算效率，防止数据上溢，对其进行scaling。</p></blockquote><h4 id="可解释性"><a href="#可解释性" class="headerlink" title="可解释性"></a>可解释性</h4><p>人们对人工智能模型的可解释性有着巨大的兴趣，这是由模型的性能、透明度和公平性驱动的。然而，神经网络，尤其是深度学习结构因其不可预测性而受到批评。从可解释性的角度来看，注意力模型特别有趣，因为它允许我们直接检查深度学习体系结构的内部工作。针对输入和输出均为一个序列的问题，注意力模型的一个重要假设是学习得到的注意力权重体现了当前需输出的数据与输入序列的某些特定位置数据的相关性。为了验证这一假设，我们可以通过对一组输入输出序列对进行可视化。</p><p>研究人员将注意力权重可视化，尽管不同语言的主语-动名词位置不同，但法语和英语的句子自动对齐的效果很明显。在一般情况下，注意模型通过正确地将海洋环境与海洋环境进行比对，显示出非单调的一致性。</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210818001633.png"></p><h3 id="自注意力模型-Self-Attention"><a href="#自注意力模型-Self-Attention" class="headerlink" title="自注意力模型 Self-Attention"></a><strong>自注意力模型 Self-Attention</strong></h3><h4 id="不同于-Attention"><a href="#不同于-Attention" class="headerlink" title="不同于 Attention"></a>不同于 Attention</h4><p>传统的Attention是基于source端和target端的隐变量（hidden state）计算Attention的，得到的结果是源端（source端）的每个词与目标端（target端）每个词之间的依赖关系。</p><p>Self -Attention 首先分别在source端和target端进行自身的attention，仅与source input或者target input自身相关的Self -Attention，以捕捉source端或target端自身的词与词之间的依赖关系；然后再把source端的得到的self -Attention加入到target端得到的Attention中，称作为Cross-Attention，以捕捉source端和target端词与词之间的依赖关系。</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210818234646.png"></p><p>传统的Attention机制<strong>忽略了源端或目标端句子中词与词之间的依赖关系</strong>，相对比，self Attention可以不仅可以得到源端与目标端词与词之间的依赖关系，同时还可以有效获取源端或目标端自身词与词之间的依赖关系。</p><h4 id="基本流程-1"><a href="#基本流程-1" class="headerlink" title="基本流程"></a>基本流程</h4><p>关于attention有很多应用，在非seq2seq任务中，比如文本分类，或者其他分类问题，会通过self attention来使用attention。这个方法思想很简单，而且计算成本相对来说不高，强烈推荐。具体来说就是：</p><p>Query和Key，value都是相同的，即输入的句子序列信息（可以是词向量lookup后的序列信息，也可以先用cnn或者rnn进行一次序列编码后得到的处理过的序列信息。）后面的步骤与上述的都是一样的：</p><p>1、首先建立句子序列中的每个词 $q_i$ 与句子其他词 $k_i$ 的注意力权重$a_i$</p><p>2、然后将注意力权重向量进行softmax归一化，并与句子序列的所有时刻的信息（词向量或者rnn hidden state）进行线性加权。</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210821150445.png"></p><p>这种方法中，句子中的每个词都能与句子中任意距离的其他词建立一个敏感的关系，可以说在一定程度上提升了之前所说的CNN和RNN对于长距离语义依赖建模能力的上限。</p><h3 id="多头注意力模型-Multi-head-attention"><a href="#多头注意力模型-Multi-head-attention" class="headerlink" title="多头注意力模型 Multi-head attention"></a>多头注意力模型 Multi-head attention</h3><details><summary>论文 《Attention is all you need》</summary>    <iframe src='/js/pdfjs/web/viewer.html?file=https://photos.zywvvd.com/win11-mt/20210814144827.pdf' style='width:100%;height:800px'></iframe></details>公式化表示如下：$$multihead  (Q, K, V)=  concat  \left(\right.  head  _{1} , head  _{2}, \ldots , head  \left._{h}\right) W^{o}$$$$head  _{i}=\operatorname{attention}\left(Q W^{Q}, K W^{K}, V W^{V}\right)$$<p>与原来的self-attention的核心原理其实是差不多的，但是由于self attention只从一个角度去学习关注点，可能会有点偏颇。所以，设计h种不同的$( W _ { i } ^ { Q } , W _ { i } ^ { K } , W _ { i } ^ { V } )$权重矩阵对，然后做基本的attention操作前，将query，key和value分别用上述权重对做线性变换，然后再计算得到h个不同角度的attention权重$head_i$，将这些 $head_i$<strong>按列拼接</strong>后，再与一个新的权重矩阵$W^O$做线性变换，得到最终的attention输出。</p><h4 id="计算步骤"><a href="#计算步骤" class="headerlink" title="计算步骤"></a>计算步骤</h4><ol><li>将输入单词转化成嵌入向量;</li><li>根据嵌入向量得到 $ q, k, v $ 三个向量;</li><li>为每个向量计算一个$score$: $score$ $ =q \cdot k $;</li><li>为了梯度的稳定, 使用归一化，即除以 $ \sqrt{d_{k}} $，($d_{k}$为特征的维度数量);</li><li>对score施以softmax激活函数;</li><li>softmax点乘Value , 得到加权的每个输入向量的评分 $v$;</li><li>相加之后得到最终的输出结果 $ z: \quad z=\sum v 。 $</li></ol><ul><li>核心公式</li></ul><p>$$<br>Attention  (Q, K, V)=\operatorname{softmax}\left(\frac{Q K^{T}}{\sqrt{d_{k}}}\right) V<br>$$</p><ul><li>以单个 self-attention 为例，词向量维度为4，单词数量2，$Q,K,V$ 维度为3，$W$ 矩阵为4$\times$3</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210819231055.png"></p><ul><li>其中 $Q, K, V$ 是由 $X$ 计算而来的</li><li>论文中计算方式如下：</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210819231330.png"></p><ul><li>网络学习参数 $W^Q, Q^K, W^V$，计算得到 $Q, K, V$，维度均为 $2\times3$</li><li>由 $Q, K, V$ 计算得到 $Z$<ul><li>其中$QK^T$为计算相关度的过程，得到 $2\times2$的矩阵，每行表示一组Query向量与所有Key向量的相关度</li><li>$d_{k}$是向量维度，此处为3，$ \sqrt{d_{k}} $为归一化系数，用于防止由于维度过大导致结果太大</li><li>softmax 按行做</li></ul></li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210819235151.png"></p><ul><li>同一组 $X$ 输入多个 Attention模块中，得到多组 $Z_i$，将$Z_i$们连接起来组成大$Z^O$，和 $W^O$ 相乘得到输出层 $Z$<ul><li>多头汇总，$Z$的维度是$2\times3$，8个头，共有八组$Z$，按列拼接得到 $2\times24$的特征</li><li>线性变化到指定维度(4)，得到汇总的多头注意力结果特征$2\times4$</li></ul></li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210819235509.png"></p><ul><li>注意 Transformer 中的 Attention 会将 encoder 的 $K$ 和 $V$ 传给 decoder，而 $Q$ 来自与解码器的上一个输出。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/gczr/p/14693829.html">https://www.cnblogs.com/gczr/p/14693829.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/66076731">https://zhuanlan.zhihu.com/p/66076731</a></li><li><a href="https://zhuanlan.zhihu.com/p/46313756">https://zhuanlan.zhihu.com/p/46313756</a></li><li><a href="https://zhuanlan.zhihu.com/p/79115586">https://zhuanlan.zhihu.com/p/79115586</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - random 和 numpy.random 线程安全</title>
    <link href="/2021/08/14/python/python-random/python-random-seed/"/>
    <url>/2021/08/14/python/python-random/python-random-seed/</url>
    
    <content type="html"><![CDATA[<blockquote><p>代码中经常会用到随机的部分，此时需要使用程序自带的伪随机数发生器，本文探讨python随机数发生器的线程安全相关内容。</p></blockquote><span id="more"></span><h3 id="对比内容"><a href="#对比内容" class="headerlink" title="对比内容"></a>对比内容</h3><ul><li>python 原生 random 库</li><li>numpy 中 random 包</li></ul><h3 id="随机数安全需求"><a href="#随机数安全需求" class="headerlink" title="随机数安全需求"></a>随机数安全需求</h3><ul><li><p>我们需要随机数，但是特定条件下需要<code>稳定的随机</code></p></li><li><p>这表示我们需要产生固定的随机数，在保证算法或程序正常运行的同时保证结果稳定可复现，对于调试程序是否有必要</p></li><li><p>安全需求为：<strong>在多线程情况下仍然可以保证稳定的伪随机</strong></p></li></ul><h3 id="random"><a href="#random" class="headerlink" title="random"></a>random</h3><p>random 确定随机序列的方法有 seed 和 state 两种</p><h4 id="random-seed-n"><a href="#random-seed-n" class="headerlink" title="random.seed(n)"></a>random.seed(n)</h4><p>可以使得随机数发生器以 $n$ 为种子产生随后的序列</p><ul><li>当运行 <code>random.seed()</code> 时表面使用当前系统时间作为随机种子，也就是随机重置随机数发生器</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_random_num</span>(<span class="hljs-params">tag</span>):</span><br>    random.seed()<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        random.random()<br>    <span class="hljs-built_in">print</span>(tag)<br>    <span class="hljs-built_in">print</span>(random.random())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        get_random_num(index)<br></code></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">08855079666960641</span><br><span class="hljs-attribute">1</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">9249561135155114</span><br><span class="hljs-attribute">2</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">847403937717389</span><br><span class="hljs-attribute">3</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">9581127578680636</span><br><span class="hljs-attribute">4</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">3559537092834082</span><br></code></pre></td></tr></table></figure><p>这表明变化的seed条件会产生不同的随机序列</p><ul><li>当固定随机种子时</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_random_num</span>(<span class="hljs-params">tag</span>):</span><br>    random.seed(<span class="hljs-number">7</span>)  <span class="hljs-comment"># 固定随机种子为 7</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        random.random()<br>    <span class="hljs-built_in">print</span>(tag)<br>    <span class="hljs-built_in">print</span>(random.random())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        get_random_num(index)<br></code></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">17621772849037032</span><br><span class="hljs-attribute">1</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">17621772849037032</span><br><span class="hljs-attribute">2</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">17621772849037032</span><br><span class="hljs-attribute">3</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">17621772849037032</span><br><span class="hljs-attribute">4</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">17621772849037032</span><br></code></pre></td></tr></table></figure><p>这表明固定的seed会产生相同的随机序列</p><h4 id="random-setstate-state"><a href="#random-setstate-state" class="headerlink" title="random.setstate(state)"></a>random.setstate(state)</h4><p>random.setstate 可以将随机数发生状态设置为特定的某个情况</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_random_num</span>(<span class="hljs-params">tag, state</span>):</span><br>    random.setstate(state)<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        random.random()<br>    <span class="hljs-built_in">print</span>(tag)<br>    <span class="hljs-built_in">print</span>(random.random())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    cur_state = random.getstate()<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        get_random_num(index, cur_state)<br></code></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">7362097058247947</span><br><span class="hljs-attribute">1</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">7362097058247947</span><br><span class="hljs-attribute">2</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">7362097058247947</span><br><span class="hljs-attribute">3</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">7362097058247947</span><br><span class="hljs-attribute">4</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">7362097058247947</span><br></code></pre></td></tr></table></figure><p>表明固定的state会产生相同的随机序列</p><h4 id="random-seed-线程安全"><a href="#random-seed-线程安全" class="headerlink" title="random.seed 线程安全"></a>random.seed 线程安全</h4><p>我们设计一个稍微复杂一些的多线程随机数发生的情况</p><p>程序会使用单线程和多线程的方法产生随机数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_random_num</span>(<span class="hljs-params">tag</span>):</span><br>    random.seed(<span class="hljs-number">7</span>)<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)):<br>        time.sleep(<span class="hljs-number">0.1</span> * random.random())<br>        random.random()<br><br>    <span class="hljs-built_in">print</span>(tag, <span class="hljs-string">&#x27;-&#x27;</span>, random.random())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  单线程  ###########&quot;</span>)<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        get_random_num(index)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  多线程  ###########&quot;</span>)<br>    thread_list = <span class="hljs-built_in">list</span>()<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        t = threading.Thread(target=get_random_num, args=(index, ))<br>        thread_list.append(t)<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs clean">-&gt; 第一次运行<br><br>############  单线程  ###########<br><span class="hljs-number">0</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.1878710267871435</span><br>############  多线程  ###########<br><span class="hljs-number">3</span> - <span class="hljs-number">0.07031557615348971</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.9554680239214713</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.48806805903541084</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.4803951046156485</span><br><span class="hljs-number">0</span> - <span class="hljs-number">0.6920567688453093</span><br><br>-&gt; 第二次运行<br><br>############  单线程  ###########<br><span class="hljs-number">0</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.1878710267871435</span><br>############  多线程  ###########<br><span class="hljs-number">4</span> - <span class="hljs-number">0.125491512495977</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.4406268683247505</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.9554680239214713</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.4803951046156485</span><br><span class="hljs-number">0</span> - <span class="hljs-number">0.6920567688453093</span><br><br>-&gt; 第三次运行<br><br>############  单线程  ###########<br><span class="hljs-number">0</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.1878710267871435</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.1878710267871435</span><br>############  多线程  ###########<br><span class="hljs-number">4</span> - <span class="hljs-number">0.19060953756680787</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.48806805903541084</span><br><span class="hljs-number">0</span> - <span class="hljs-number">0.4803951046156485</span><br><span class="hljs-number">1</span> <span class="hljs-number">2</span> --  <span class="hljs-number">0.74035122442809410</span><span class="hljs-number">.6920567688453093</span><br><br></code></pre></td></tr></table></figure><p>可以看到多线程会打乱本来稳定的随机数发生器序列，产生不再那么稳定的随机数</p><h4 id="random-setstate-线程安全"><a href="#random-setstate-线程安全" class="headerlink" title="random.setstate() 线程安全"></a>random.setstate() 线程安全</h4><p>我们将 random.seed 替换为 random.setstate</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_random_num</span>(<span class="hljs-params">tag, state</span>):</span><br>    random.setstate(state)<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)):<br>        time.sleep(<span class="hljs-number">0.1</span> * random.random())<br>        random.random()<br><br>    <span class="hljs-built_in">print</span>(tag, <span class="hljs-string">&#x27;-&#x27;</span>, random.random())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    cur_state = random.getstate()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  单线程  ###########&quot;</span>)<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        get_random_num(index, cur_state)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  多线程  ###########&quot;</span>)<br>    thread_list = <span class="hljs-built_in">list</span>()<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        t = threading.Thread(target=get_random_num, args=(index, cur_state, ))<br>        thread_list.append(t)<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs clean">############  单线程  ###########<br><span class="hljs-number">0</span> - <span class="hljs-number">0.15376246243379788</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.15376246243379788</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.15376246243379788</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.15376246243379788</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.15376246243379788</span><br>############  多线程  ###########<br><span class="hljs-number">0</span> - <span class="hljs-number">0.37956604279157746</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.5552055004170326</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.40568119200883823</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.09736679342311894</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.9874404365309796</span><br></code></pre></td></tr></table></figure><p>可以看到多线程输出的还是纷乱的随机数，表面设置状态还是会受到多线程的干扰</p><p><strong>得出综合结论: python自带 random 模块线程不安全</strong></p><h3 id="numpy-random"><a href="#numpy-random" class="headerlink" title="numpy.random"></a>numpy.random</h3><p>numpy 也存在 seed 和 state 两种随机数状态设定策略</p><p>二者固定时也可以确定随机数发生序列，我们直接进入线程安全实验</p><h4 id="numpy-random-seed-线程安全"><a href="#numpy-random-seed-线程安全" class="headerlink" title="numpy.random.seed 线程安全"></a>numpy.random.seed 线程安全</h4><p>设置和random模块测试相同的程序，仅替换随机数产生器为numpy</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_random_num</span>(<span class="hljs-params">tag</span>):</span><br>    np.random.seed(<span class="hljs-number">7</span>)<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(np.random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)):<br>        time.sleep(<span class="hljs-number">0.1</span> * np.random.random())<br>        np.random.random()<br><br>    <span class="hljs-built_in">print</span>(tag, <span class="hljs-string">&#x27;-&#x27;</span>, np.random.random())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  单线程  ###########&quot;</span>)<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        get_random_num(index)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  多线程  ###########&quot;</span>)<br>    thread_list = <span class="hljs-built_in">list</span>()<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        t = threading.Thread(target=get_random_num, args=(index, ))<br>        thread_list.append(t)<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs clean">############  单线程  ###########<br><span class="hljs-number">0</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.4677528597449807</span><br>############  多线程  ###########<br><span class="hljs-number">2</span> - <span class="hljs-number">0.7969513574435644</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.27425859319442125</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.8767009301816353</span><br><span class="hljs-number">0</span> - <span class="hljs-number">0.8078354592960695</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.16471665877901287</span><br></code></pre></td></tr></table></figure><p>numpy 的 seed 也没有抗住多线程测试</p><h4 id="numpy-random-set-state-state-线程安全"><a href="#numpy-random-set-state-state-线程安全" class="headerlink" title="numpy.random.set_state(state) 线程安全"></a>numpy.random.set_state(state) 线程安全</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_random_num</span>(<span class="hljs-params">tag, state</span>):</span><br>    np.random.set_state(state)<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(np.random.randint(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)):<br>        time.sleep(<span class="hljs-number">0.1</span> * np.random.random())<br>        np.random.random()<br><br>    <span class="hljs-built_in">print</span>(tag, <span class="hljs-string">&#x27;-&#x27;</span>, np.random.random())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    state = np.random.get_state()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  单线程  ###########&quot;</span>)<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        get_random_num(index, state)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  多线程  ###########&quot;</span>)<br>    thread_list = <span class="hljs-built_in">list</span>()<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        t = threading.Thread(target=get_random_num, args=(index, state, ))<br>        thread_list.append(t)<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs clean">############  单线程  ###########<br><span class="hljs-number">0</span> - <span class="hljs-number">0.08401109992998335</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.08401109992998335</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.08401109992998335</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.08401109992998335</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.08401109992998335</span><br>############  多线程  ###########<br><span class="hljs-number">3</span> - <span class="hljs-number">0.3760344064206267</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.9126801411121602</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.3426880186919875</span><br><span class="hljs-number">0</span> - <span class="hljs-number">0.11892388333372905</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.8831013606778471</span><br></code></pre></td></tr></table></figure><p>仍然不是线程安全</p><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><ul><li><p>总结下来，random模块和numpy模块的 seed 和 state 系列方法都没有做到线程安全</p></li><li><p>事实上setstate 一类的方法和 seed 方法原理相同，都是设置随机数发生器的初始状态，问题在于这种设置是全局的</p></li><li><p>当多线程穿插使用时会打乱这个序列</p></li><li><p>因此线程安全的随机数发生器必须做到相互隔离</p></li><li><p>解决问题的终极方案为 <code>numpy.random.RandomState</code></p></li></ul><h3 id="numpy-random-RandomState"><a href="#numpy-random-RandomState" class="headerlink" title="numpy.random.RandomState"></a>numpy.random.RandomState</h3><p>RandomState方法之所以解决问题，在于它不仅设置了随机数发生器的初始状态，也会生成一个随机数发生器实例，产生一个独立的变量生成随机数</p><p>只要不是同一个实例，相互之间就不会产生影响</p><p>上代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_random_num</span>(<span class="hljs-params">tag</span>):</span><br>    rand_obj = np.random.RandomState(<span class="hljs-number">7</span>)<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rand_obj.randint(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)):<br>        time.sleep(<span class="hljs-number">0.1</span> * rand_obj.random())<br>        rand_obj.random()<br><br>    <span class="hljs-built_in">print</span>(tag, <span class="hljs-string">&#x27;-&#x27;</span>, rand_obj.random())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  单线程  ###########&quot;</span>)<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        get_random_num(index)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;############  多线程  ###########&quot;</span>)<br>    thread_list = <span class="hljs-built_in">list</span>()<br>    <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        t = threading.Thread(target=get_random_num, args=(index, ))<br>        thread_list.append(t)<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> thread_list:<br>        t.join()<br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><blockquote><p>输出</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs clean">############  单线程  ###########<br><span class="hljs-number">0</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">1</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">2</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">3</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">4</span> - <span class="hljs-number">0.4677528597449807</span><br>############  多线程  ###########<br><span class="hljs-number">2</span> - <span class="hljs-number">0.4677528597449807</span><br><span class="hljs-number">043</span>  - - <span class="hljs-number">0.46775285974498070</span><span class="hljs-number">.4677528597449807</span><br><br><span class="hljs-number">1</span> -  - <span class="hljs-number">0.46775285974498070</span><span class="hljs-number">.4677528597449807</span><br><br></code></pre></td></tr></table></figure><p>这里输出是乱的，解释一下，这不是我的笔误，是因为随机数完全相同，几个线程的运行时间相同，就会在同一时间向终端输出内容，导致输出有点乱</p><p>不过还是可以看出来每个发生器产生的随机数完全相同，证实了 RandomState 的线程安全性</p><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><ol><li>seed , state 一类方法可以确定随机数发生序列，但这种全局配置的随机数确定序列做不到线程安全</li><li>线程安全需要确定序列的同时创建线程内的随机数发生器实例，保证线程之间互不影响，才会产生真正的随机序列</li></ol><p>**numpy.random.RandomState -&gt; YYDS **</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/zm714981790/article/details/61195490">https://blog.csdn.net/zm714981790/article/details/61195490</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - random 和 numpy.random 使用方法</title>
    <link href="/2021/08/14/python/python-random/python-random/"/>
    <url>/2021/08/14/python/python-random/python-random/</url>
    
    <content type="html"><![CDATA[<blockquote><p>代码中经常会用到随机的部分，此时需要使用程序自带的伪随机数发生器，本文记录常用方法。</p></blockquote><span id="more"></span><h3 id="python-伪随机数产生方法"><a href="#python-伪随机数产生方法" class="headerlink" title="python 伪随机数产生方法"></a>python 伪随机数产生方法</h3><ul><li>python 原生 random 库</li><li>numpy 中 random 包</li></ul><h3 id="random-方法"><a href="#random-方法" class="headerlink" title="random 方法"></a>random 方法</h3><p>Python中的random模块用于生成随机数。下面介绍一下random模块中最常用的几个函数。</p><h4 id="random-random"><a href="#random-random" class="headerlink" title="random.random()"></a>random.random()</h4><p>用于生成一个0到1的随机符点数: 0 &lt;= n &lt; 1.0。</p><h4 id="random-uniform-a-b"><a href="#random-uniform-a-b" class="headerlink" title="random.uniform(a, b)"></a>random.uniform(a, b)</h4><p>用于生成一个在[a, b]均匀分布上的随机数。</p><h4 id="random-randint-a-b"><a href="#random-randint-a-b" class="headerlink" title="random.randint(a, b)"></a>random.randint(a, b)</h4><p>用于生成一个指定范围内的整数。</p><h4 id="random-choice-sequence"><a href="#random-choice-sequence" class="headerlink" title="random.choice(sequence)"></a>random.choice(sequence)</h4><p>从序列中获取一个随机元素。</p><h4 id="random-shuffle-sequence"><a href="#random-shuffle-sequence" class="headerlink" title="random.shuffle(sequence)"></a>random.shuffle(sequence)</h4><p>用于将一个列表中的元素打乱。</p><h4 id="random-sample-sequence-k"><a href="#random-sample-sequence-k" class="headerlink" title="random.sample(sequence, k)"></a>random.sample(sequence, k)</h4><p>从指定序列中随机（<strong>无放回</strong>）获取指定长度的片断。</p><h3 id="numpy-random-方法"><a href="#numpy-random-方法" class="headerlink" title="numpy.random 方法"></a>numpy.random 方法</h3><h4 id="np-random-rand-d0-d1-…-dn"><a href="#np-random-rand-d0-d1-…-dn" class="headerlink" title="np.random.rand(d0, d1, …, dn)"></a>np.random.rand(d0, d1, …, dn)</h4><p>产生 [d0, d1, …, dn] 维度的随机数矩阵，数据取自[0,1]均匀分布</p><blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">np</span>.random.rand(<span class="hljs-number">3</span>,<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure></blockquote><h4 id="np-random-randn-d0-d1-…-dn"><a href="#np-random-randn-d0-d1-…-dn" class="headerlink" title="np.random.randn(d0, d1, …, dn)"></a>np.random.randn(d0, d1, …, dn)</h4><p>产生 [d0, d1, …, dn] 维度的随机数矩阵，数据取自标准正态分布</p><h4 id="np-random-randint-low-high-size"><a href="#np-random-randint-low-high-size" class="headerlink" title="np.random.randint(low, high, size)"></a>np.random.randint(low, high, size)</h4><p>产生半开半闭区间 [low, high)中的随机整数，返回 size 个</p><h4 id="np-random-choice-a-size-replace-p"><a href="#np-random-choice-a-size-replace-p" class="headerlink" title="np.random.choice(a, size, replace, p)"></a>np.random.choice(a, size, replace, p)</h4><p>a: sequence 或者 数字（表示序列）</p><p>size: 取样个数</p><p>replace: True 有放回 False 无放回</p><p>p: 概率列表</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs maxima">Examples<br><br>Generate a uniform <span class="hljs-built_in">random</span> sample from <span class="hljs-built_in">np</span>.arange(<span class="hljs-number">5</span>) of size <span class="hljs-number">3</span>:<br><br>&gt;&gt;&gt; <span class="hljs-built_in">np</span>.<span class="hljs-built_in">random</span>.choice(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<br><span class="hljs-built_in">array</span>([<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])<br>&gt;&gt;&gt; #This <span class="hljs-built_in">is</span> equivalent to <span class="hljs-built_in">np</span>.<span class="hljs-built_in">random</span>.randint(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>,<span class="hljs-number">3</span>)<br>Generate a non-uniform <span class="hljs-built_in">random</span> sample from <span class="hljs-built_in">np</span>.arange(<span class="hljs-number">5</span>) of size <span class="hljs-number">3</span>:<br><br>&gt;&gt;&gt; <span class="hljs-built_in">np</span>.<span class="hljs-built_in">random</span>.choice(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, p=[<span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>])<br><span class="hljs-built_in">array</span>([<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>])<br>Generate a uniform <span class="hljs-built_in">random</span> sample from <span class="hljs-built_in">np</span>.arange(<span class="hljs-number">5</span>) of size <span class="hljs-number">3</span> without replacement:<br><br>&gt;&gt;&gt; <span class="hljs-built_in">np</span>.<span class="hljs-built_in">random</span>.choice(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, replace=False)<br><span class="hljs-built_in">array</span>([<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>])<br>&gt;&gt;&gt; #This <span class="hljs-built_in">is</span> equivalent to <span class="hljs-built_in">np</span>.<span class="hljs-built_in">random</span>.<span class="hljs-built_in">permutation</span>(<span class="hljs-built_in">np</span>.arange(<span class="hljs-number">5</span>))[:<span class="hljs-number">3</span>]<br>Generate a non-uniform <span class="hljs-built_in">random</span> sample from <span class="hljs-built_in">np</span>.arange(<span class="hljs-number">5</span>) of size <span class="hljs-number">3</span> without replacement:<br><br>&gt;&gt;&gt; <span class="hljs-built_in">np</span>.<span class="hljs-built_in">random</span>.choice(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, replace=False, p=[<span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.6</span>, <span class="hljs-number">0</span>])<br><span class="hljs-built_in">array</span>([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>])<br>Any of the above can be repeated with an arbitrary <span class="hljs-built_in">array</span>-like instead of just integers. For instance:<br><br>&gt;&gt;&gt; aa_milne_arr = [‘pooh‘, ‘rabbit‘, ‘piglet‘, ‘Christopher‘]<br>&gt;&gt;&gt; <span class="hljs-built_in">np</span>.<span class="hljs-built_in">random</span>.choice(aa_milne_arr, <span class="hljs-number">5</span>, p=[<span class="hljs-number">0.5</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.3</span>])<br><span class="hljs-built_in">array</span>([‘pooh‘, ‘pooh‘, ‘pooh‘, ‘Christopher‘, ‘piglet‘],<br>      dtype=‘|S11‘)<br></code></pre></td></tr></table></figure><h4 id="np-random-bytes-length"><a href="#np-random-bytes-length" class="headerlink" title="np.random.bytes(length)"></a>np.random.bytes(length)</h4><p>返回 length 个随机字节。</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">&gt;&gt;&gt; np.random.bytes(10)<br>‘ eh<span class="hljs-symbol">\x</span>85<span class="hljs-symbol">\x</span>022SZ<span class="hljs-symbol">\x</span>bf<span class="hljs-symbol">\x</span>a4‘ #random<br></code></pre></td></tr></table></figure><h4 id="np-random-permutation-X"><a href="#np-random-permutation-X" class="headerlink" title="np.random.permutation(X)"></a>np.random.permutation(X)</h4><p>返回一个随机排列</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">&gt;&gt;&gt; np<span class="hljs-selector-class">.random</span><span class="hljs-selector-class">.permutation</span>(<span class="hljs-number">10</span>)<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">([<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>, <span class="hljs-number">6</span>])</span></span><br>&gt;&gt;&gt; np<span class="hljs-selector-class">.random</span><span class="hljs-selector-class">.permutation</span>(<span class="hljs-selector-attr">[1, 4, 9, 12, 15]</span>)<br><span class="hljs-function"><span class="hljs-title">array</span><span class="hljs-params">([<span class="hljs-number">15</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">9</span>,  <span class="hljs-number">4</span>, <span class="hljs-number">12</span>])</span></span><br>&gt;&gt;&gt; arr = np<span class="hljs-selector-class">.arange</span>(<span class="hljs-number">9</span>)<span class="hljs-selector-class">.reshape</span>((<span class="hljs-number">3</span>, <span class="hljs-number">3</span>))<br>&gt;&gt;&gt; np<span class="hljs-selector-class">.random</span><span class="hljs-selector-class">.permutation</span>(arr)<br>array(<span class="hljs-selector-attr">[[6, 7, 8]</span>,<br>       <span class="hljs-selector-attr">[0, 1, 2]</span>,<br>       <span class="hljs-selector-attr">[3, 4, 5]</span>])<br></code></pre></td></tr></table></figure><h4 id="np-random-shuffle-X"><a href="#np-random-shuffle-X" class="headerlink" title="np.random.shuffle(X)"></a>np.random.shuffle(X)</h4><p>现场修改序列，改变自身内容。</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">arr = np.arange(<span class="hljs-number">10</span>)</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">np.random.shuffle(arr)</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">arr</span><br>[1 7 5 2 9 4 3 6 0 8]<br> <br><br>This function only shuffles the array along the first index of a multi-dimensional array:<br><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">arr = np.arange(<span class="hljs-number">9</span>).reshape((<span class="hljs-number">3</span>, <span class="hljs-number">3</span>))</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">np.random.shuffle(arr)</span><br><span class="hljs-meta">&gt;&gt;&gt;</span> <span class="python">arr</span><br>array([[3, 4, 5],<br>       [6, 7, 8],<br>       [0, 1, 2]])<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://www.cnblogs.com/yyxayz/p/4080525.html">https://www.cnblogs.com/yyxayz/p/4080525.html</a></p></li><li><p><a href="https://blog.csdn.net/weixin_42029738/article/details/81977492">https://blog.csdn.net/weixin_42029738/article/details/81977492</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>node.js -4- ejs 简单教程</title>
    <link href="/2021/08/13/node-js/node-js-ejs/node-js-ejs/"/>
    <url>/2021/08/13/node-js/node-js-ejs/node-js-ejs/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ejs 是 node.js 的一种模板引擎，本文介绍简单用法。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>EJS是一个javascript模板库，用来从json数据中生成HTML字符串。</p><ul><li>功能：缓存功能，能够缓存好的HTML模板；</li><li>&lt;% code %&gt;用来执行javascript代码</li><li>ejs模板文件后缀名 .ejs</li></ul><h3 id="常用语法"><a href="#常用语法" class="headerlink" title="常用语法"></a>常用语法</h3><ul><li>用<code>&lt;%...%&gt;</code>包含 js 代码</li><li>用<code>&lt;%=...%&gt;</code>输出变量 变量若包含<code> &#39;&lt;&#39; &#39;&gt;&#39; &#39;&amp;&#39;</code>等字符 会被转义</li><li>用<code>&lt;%-...%&gt;</code>输出变量 不转义</li><li>用<code>&lt;%- include(&#39;user/show&#39;) %&gt;</code>引入其他模板 包含<code> ./user/show.ejs</code></li><li>用<code>&lt;%# some comments %&gt;</code>来注释，不执行不输出</li><li><code>&lt;%%</code> 转义为 <code>&#39;&lt;%&#39;</code></li><li><code>&lt;% ... -%&gt;</code> 删除新的空白行模式?</li><li><code>&lt;%_ ... _%&gt;</code> 删除空白符模式</li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">npm install ejs<br>bower install ejs<br><span class="hljs-regexp">//</span>ejs可以配合express框架使用，或直接在node中/浏览器中使用<br></code></pre></td></tr></table></figure><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>template.ejs:<br>&lt;% <span class="hljs-keyword">if</span>(comic) &#123; %&gt;<br>    &lt;h2&gt;&lt;%=comic.name%&gt;&lt;/h2&gt;<br>&lt;% &#125; %&gt;<br><br><span class="hljs-regexp">//</span>test.js:<br>var comic = &#123;name: <span class="hljs-string">&#x27;one  piece&#x27;</span>&#125;;<br><br><span class="hljs-regexp">//</span> 渲染文件模板,<br><span class="hljs-regexp">//</span> comic.ejs 包含 header.ejs footer.ejs, <br><span class="hljs-regexp">//</span> 若include了文件 必须指定 filename参数 , 参数为文件路径，<br><span class="hljs-regexp">//</span> 文件所在目录为查找include资源的目录  path.diranme(specialFilepath) <br>var html = ejs.render( fs.readFileSync(<span class="hljs-string">&#x27;comic.ejs&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>), &#123;<span class="hljs-string">&#x27;comic&#x27;</span>: comic&#125;, &#123;filename: __dirname+<span class="hljs-string">&#x27;\\abc.js&#x27;</span>&#125;);<br>console.log(html);<br></code></pre></td></tr></table></figure><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><ul><li><p>ejs.compile()</p></li><li><p>ejs.render()</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">var template = ejs.compile(str, options); <span class="hljs-regexp">//</span>=&gt; <span class="hljs-keyword">function</span><br>template(data); <span class="hljs-regexp">//</span>=&gt; html<br><br>ejs.render(str, data, options); <span class="hljs-regexp">//</span>=&gt;html<br><br><span class="hljs-regexp">//</span>or 把str data options都放在一个object中传入<br>ejs.render(allOptions);<br></code></pre></td></tr></table></figure></li><li><p>options参数</p><ul><li><code>cache</code> 缓存编译后的函数(ejs.compile(..) ,需要 <code>filename</code>参数作为缓存的key</li><li><code>filename</code> 用于缓存的key，和include</li><li><code>context</code> 函数的执行上下文</li><li><code>compileDebug</code> 输出compile的信息来跟踪调试</li><li><code>client</code> 返回编译后的函数</li><li><code>delimiter</code> &lt;% .. %&gt; 指这里的%</li><li><code>debug</code> 输出ejs.compile()得到函数的函数体</li><li><code>strict</code> ejs.compile()返回的函数是否执行在严格模式</li><li><code>_with</code> 是否使用 with(){..} 来访问本地变量</li><li><code>localsName</code> 保存本地变量的对象名，默认为locals</li><li><code>rmWhitespace</code> 移除多余空格</li></ul></li><li><p>include(文件包含)<br>被包含文件的路径可以是：绝对路径或相对路径,还可以传入data</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;ul&gt;<br>    &lt;% users.<span class="hljs-keyword">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-keyword">user</span>)&#123; %&gt;<br>        &lt;%- <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;user/show&#x27;</span>, &#123;<span class="hljs-keyword">user</span>: <span class="hljs-keyword">user</span>&#125;) %&gt;<br>    &lt;%&#125;);%&gt;<br>&lt;/ul&gt;<br></code></pre></td></tr></table></figure><p>include是在运行时被执行的，所以可以支持路径为变量, 如：</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel">&lt;% somePath=<span class="hljs-string">&#x27;some/path&#x27;</span> %&gt;<br>...<br>&lt;%- include(somePath) %&gt;<br></code></pre></td></tr></table></figure></li><li><p>自定义模板定界符</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> ejs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ejs&#x27;</span>);<br><span class="hljs-keyword">var</span> users = [<span class="hljs-string">&#x27;lufy&#x27;</span>, <span class="hljs-string">&#x27;zoro&#x27;</span>, <span class="hljs-string">&#x27;nami&#x27;</span>];<br><br><span class="hljs-comment">//渲染字符串模板时，指定分隔符</span><br><span class="hljs-comment">//&lt;%= ... %&gt; 输出变量 输出表达式的结果</span><br><span class="hljs-keyword">var</span> ret1 = ejs.render(<span class="hljs-string">&#x27;&lt;?=users.join(&quot; | &quot;); ?&gt; &#x27;</span>, &#123;<span class="hljs-attr">users</span>: users&#125;, &#123;<span class="hljs-attr">delimiter</span>: <span class="hljs-string">&#x27;?&#x27;</span>&#125;);<br><span class="hljs-built_in">console</span>.log(ret1);  <span class="hljs-comment">//=&gt;lufy | zoro | nami</span><br><br><span class="hljs-comment">// 全局指定分隔符</span><br>ejs.delimiter = <span class="hljs-string">&#x27;$&#x27;</span>;<br><span class="hljs-keyword">var</span> ret2 = ejs.render(<span class="hljs-string">&#x27;&lt;$= users.join(&quot; | &quot;); $&gt;&#x27;</span>, &#123;<span class="hljs-attr">users</span>: users&#125;);<br><span class="hljs-built_in">console</span>.log(ret2);<br></code></pre></td></tr></table></figure></li><li><p>页面布局<br>ejs 没有显式的支持布局功能，但是可以通过 include 页头页脚的方式，实现基本的布局。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//comic.ejs:</span><br>&lt;%- include(<span class="hljs-string">&#x27;header&#x27;</span>); %&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>hot comic now: <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br>&lt;% <span class="hljs-keyword">if</span>(comic) &#123; %&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&lt;%= comic.name %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span><br>&lt;% &#125; %&gt;<br>&lt;%- include(<span class="hljs-string">&#x27;footer&#x27;</span>)  %&gt;<br><br><span class="hljs-comment">//test.js:</span><br><span class="hljs-keyword">var</span> html = ejs.render( fs.readFileSync(<span class="hljs-string">&#x27;comic.ejs&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span>), &#123;<span class="hljs-string">&#x27;comic&#x27;</span>: comic&#125;, &#123;<span class="hljs-attr">filename</span>: __dirname+<span class="hljs-string">&#x27;\\abc.js&#x27;</span>&#125;);<br></code></pre></td></tr></table></figure></li></ul><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><h4 id="引入其他文件"><a href="#引入其他文件" class="headerlink" title="引入其他文件"></a>引入其他文件</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">&lt;%- <span class="hljs-meta">include</span>(<span class="hljs-string">&#x27;path/filename&#x27;</span>, &#123; <span class="hljs-meta">data</span>: <span class="hljs-meta">data</span> &#125;) %&gt;<br></code></pre></td></tr></table></figure><p>上面的代码将path目录下的filename.ejs文件引入到当前文件中，并将data的值传入filename.ejs文件中。</p><p>此处使用<code>&lt;%- %&gt;</code>是为了避免二次转义。</p><p>也可以使用<code>&lt;% include path/filename %&gt;</code>进行引入</p><h4 id="设置分隔符"><a href="#设置分隔符" class="headerlink" title="设置分隔符"></a>设置分隔符</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">var ejs = require(<span class="hljs-string">&#x27;ejs&#x27;</span>),<br><br>    users = [<span class="hljs-string">&#x27;geddy&#x27;</span>, <span class="hljs-string">&#x27;neil&#x27;</span>, <span class="hljs-string">&#x27;alex&#x27;</span>];<br><br><span class="hljs-regexp">//</span> 仅对当前模板有效的设置<br>ejs.render(<span class="hljs-string">&#x27;&lt;?= users.join(&quot; | &quot;); ?&gt;&#x27;</span>, &#123;users: users&#125;, &#123;delimiter: <span class="hljs-string">&#x27;?&#x27;</span>&#125;);<br><br><span class="hljs-regexp">//</span> =&gt; <span class="hljs-string">&#x27;geddy | neil | alex&#x27;</span> <br><span class="hljs-regexp">//</span> 全局有效的设置<br><br>ejs.delimiter = <span class="hljs-string">&#x27;$&#x27;</span>;<br>ejs.render(<span class="hljs-string">&#x27;&lt;$= users.join(&quot; | &quot;); $&gt;&#x27;</span>, &#123;users: users&#125;);<br><br><span class="hljs-regexp">//</span> =&gt; <span class="hljs-string">&#x27;geddy | neil | alex&#x27;</span><br></code></pre></td></tr></table></figure><h4 id="模板嵌套"><a href="#模板嵌套" class="headerlink" title="模板嵌套"></a>模板嵌套</h4><p>ejs不支持像Jade那样的block布局，但是可以使用include的方式实现布局</p><figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs erb"><span class="xml">&lt;%-</span><span class="ruby"> <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;header&#x27;</span>) </span><span class="xml">-%&gt;</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">  Title</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">  My page</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">&lt;%-</span><span class="ruby"> <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;footer&#x27;</span>) </span><span class="xml">-%&gt;</span><br></code></pre></td></tr></table></figure><h4 id="变量定义标签属性"><a href="#变量定义标签属性" class="headerlink" title="变量定义标签属性"></a>变量定义标签属性</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;&lt;%= style %&gt;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bnf"><span class="hljs-attribute">&lt;ul&gt;</span><br>    <span class="hljs-attribute">&lt;% for(var i in users)&#123; %&gt;</span><br>    <span class="hljs-attribute">&lt;li&gt;</span><span class="hljs-attribute">&lt;%= users[i].username %&gt;</span>--<span class="hljs-attribute">&lt;%= users[i].age %&gt;</span><span class="hljs-attribute">&lt;/li&gt;</span><br><span class="hljs-attribute">&lt;% &#125; %&gt;</span><br><span class="hljs-attribute">&lt;/ul&gt;</span><br><br><span class="hljs-attribute">&lt;% if (names.length) &#123; %&gt;</span>  <br>  <span class="hljs-attribute">&lt;ul&gt;</span>  <br>    <span class="hljs-attribute">&lt;% names.forEach(function(name)&#123; %&gt;</span>  <br>      <span class="hljs-attribute">&lt;li foo=&#x27;&lt;%= name + &quot;&#x27;&quot; %&gt;</span>&#x27;&gt;<span class="hljs-attribute">&lt;%= name %&gt;</span><span class="hljs-attribute">&lt;/li&gt;</span>  <br>    <span class="hljs-attribute">&lt;% &#125;) %&gt;</span>  <br>  <span class="hljs-attribute">&lt;/ul&gt;</span>  <br><span class="hljs-attribute">&lt;% &#125; %&gt;</span>  <br></code></pre></td></tr></table></figure><h4 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h4><figure class="highlight erb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs erb"><span class="xml"><span class="hljs-comment">&lt;!-- 将所有条件判断代码放&lt;%</span></span><span class="ruby"> </span><span class="xml"><span class="hljs-comment">%&gt;里面即可 --&gt;</span></span><br><span class="xml">    &lt;%</span><span class="ruby"> <span class="hljs-keyword">if</span>(isLogin)&#123; </span><span class="xml">%&gt;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;user&quot;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>Jack<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>退出<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    &lt;%</span><span class="ruby"> &#125;<span class="hljs-keyword">else</span>&#123; </span><span class="xml">%&gt;</span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;login&quot;</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>注册<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="xml">    &lt;%</span><span class="ruby"> &#125; </span><span class="xml">%&gt;</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/stephenykk/p/6017927.html">https://www.cnblogs.com/stephenykk/p/6017927.html</a></li><li><a href="https://ejs.bootcss.com/">https://ejs.bootcss.com/</a></li><li><a href="https://blog.csdn.net/weixin_30385925/article/details/97279656">https://blog.csdn.net/weixin_30385925/article/details/97279656</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>node.js</category>
      
    </categories>
    
    
    <tags>
      
      <tag>node.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ScreenToGif - 免费开源 GIF 录屏制作软件</title>
    <link href="/2021/08/13/software/recommend/Windows/screen-to-gif/screen-to-gif/"/>
    <url>/2021/08/13/software/recommend/Windows/screen-to-gif/screen-to-gif/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Screen to Gif是一款方便可靠的gif动画录制软件，可以用来快速录制屏幕上的指定区域，将其直接保存为GIF动画文件。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><strong>屏幕</strong>，<strong>摄像头</strong>和<strong>画板</strong>录像，并有内置<strong>编辑器</strong></p><ul><li><p>软件开源，使用免费</p></li><li><p>设计舒适，轻便好用</p></li><li><p>支持简体中文</p></li><li><p>可以录制 GIF 和视频</p></li><li><p>支持动画编辑</p></li><li><p>可以调整大小</p></li><li><p>官网：<a href="https://www.screentogif.com/?l=zh_cn#">https://www.screentogif.com/?l=zh_cn#</a></p></li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>进入官网下载安装即可</p><ul><li>下载链接：<a href="https://www.screentogif.com/downloads">https://www.screentogif.com/downloads</a></li></ul><h3 id="制作-GIF"><a href="#制作-GIF" class="headerlink" title="制作 GIF"></a>制作 GIF</h3><p>打开 ScreenToGif，可以选择录像机 (录屏)、摄像头、画板</p><ul><li>一般常用的是「录制屏幕」，选择录像机即可</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210813171520.png"></p><ul><li>对齐窗口按钮可以自动选择录制某个窗口</li><li>可以设置帧率</li><li>可以配置录制选项</li><li>F7 录制</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210813172103.png"></p><ul><li>录制完成后可以编辑 GIF </li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210813172126.png"></p><ul><li>可以输出多种格式</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210813172218.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.screentogif.com/?l=zh_cn#">https://www.screentogif.com/?l=zh_cn#</a></li><li><a href="https://www.iplaysoft.com/screentogif.html">https://www.iplaysoft.com/screentogif.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>software</category>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>software</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>git commit 图标 emoji 使用</title>
    <link href="/2021/08/13/git/git-emoji/git-emoji/"/>
    <url>/2021/08/13/git/git-emoji/git-emoji/</url>
    
    <content type="html"><![CDATA[<blockquote><p>执行 <code>git commit</code> 时使用 emoji 为本次提交打上一个 “标签”, 使得此次 commit 的主要工作得以凸现，也能够使得其在整个提交历史中易于区分与查找。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>git commit 时可以加入表情，可以使得提交历史内容清晰</p><p><img src="https://photos.zywvvd.com/win11-mt/20210813163510.png"></p><h3 id="添加方法"><a href="#添加方法" class="headerlink" title="添加方法"></a>添加方法</h3><ul><li><h5 id="git-commit-时，提交信息遵循以下格式："><a href="#git-commit-时，提交信息遵循以下格式：" class="headerlink" title="git commit 时，提交信息遵循以下格式："></a><em><strong>git commit</strong></em> 时，提交信息遵循以下格式：</h5></li></ul><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-meta">:emoji1:</span> :emoji2: 内容<br></code></pre></td></tr></table></figure><ul><li>示例</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">git</span> commit -m <span class="hljs-string">&quot;:tada: Initialize Repo&quot;</span><br></code></pre></td></tr></table></figure><h3 id="emoji-列表"><a href="#emoji-列表" class="headerlink" title="emoji 列表"></a>emoji 列表</h3><table><thead><tr><th>emoji</th><th>emoji 代码</th><th>commit 说明</th></tr></thead><tbody><tr><td>:art: (调色板)</td><td>:art:</td><td>改进代码结构/代码格式</td></tr><tr><td>:zap: (闪电):racehorse: (赛马)</td><td>:zap: :racehorse:</td><td>提升性能</td></tr><tr><td>:fire: (火焰)</td><td>:fire:</td><td>移除代码或文件</td></tr><tr><td>:bug: (bug)</td><td>:bug:</td><td>修复 bug</td></tr><tr><td>:ambulance: (急救车)</td><td>:ambulance:</td><td>重要补丁</td></tr><tr><td>:sparkles: (火花)</td><td>:sparkles:</td><td>引入新功能</td></tr><tr><td>:memo: (备忘录)</td><td>:memo:</td><td>撰写文档</td></tr><tr><td>:rocket: (火箭)</td><td>:rocket:</td><td>部署功能</td></tr><tr><td>:lipstick: (口红)</td><td>:lipstick:</td><td>更新 UI 和样式文件</td></tr><tr><td>:tada: (庆祝)</td><td>:tada:</td><td>初次提交</td></tr><tr><td>:white_check_mark: (白色复选框)</td><td>:white_check_mark:</td><td>增加测试</td></tr><tr><td>:lock: (锁)</td><td>:lock:</td><td>修复安全问题</td></tr><tr><td>:apple: (苹果)</td><td>:apple:</td><td>修复 macOS 下的问题</td></tr><tr><td>:penguin: (企鹅)</td><td>:penguin:</td><td>修复 Linux 下的问题</td></tr><tr><td>:checkered_flag: (旗帜)</td><td>:checkered_flag:</td><td>修复 Windows 下的问题</td></tr><tr><td>:bookmark: (书签)</td><td>:bookmark:</td><td>发行/版本标签</td></tr><tr><td>:rotating_light: (警车灯)</td><td>:rotating_light:</td><td>移除 linter 警告</td></tr><tr><td>:construction: (施工)</td><td>:construction:</td><td>工作进行中</td></tr><tr><td>:green_heart: (绿心)</td><td>:green_heart:</td><td>修复 CI 构建问题</td></tr><tr><td>:arrow_down: (下降箭头)</td><td>:arrow_down:</td><td>降级依赖</td></tr><tr><td>:arrow_up: (上升箭头)</td><td>:arrow_up:</td><td>升级依赖</td></tr><tr><td>:construction_worker: (工人)</td><td>:construction_worker:</td><td>添加 CI 构建系统</td></tr><tr><td>:chart_with_upwards_trend: (上升趋势图)</td><td>:chart_with_upwards_trend:</td><td>添加分析或跟踪代码</td></tr><tr><td>:hammer: (锤子)</td><td>:hammer:</td><td>重大重构</td></tr><tr><td>:heavy_minus_sign: (减号)</td><td>:heavy_minus_sign:</td><td>减少一个依赖</td></tr><tr><td>:whale: (鲸鱼)</td><td>:whale:</td><td>Docker 相关工作</td></tr><tr><td>:heavy_plus_sign: (加号)</td><td>:heavy_plus_sign:</td><td>增加一个依赖</td></tr><tr><td>:wrench: (扳手)</td><td>:wrench:</td><td>修改配置文件</td></tr><tr><td>:globe_with_meridians: (地球)</td><td>:globe_with_meridians:</td><td>国际化与本地化</td></tr><tr><td>:pencil2: (铅笔)</td><td>:pencil2:</td><td>修复 typo</td></tr></tbody></table><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_41005535/article/details/80999062">https://blog.csdn.net/qq_41005535/article/details/80999062</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fluid -2- 随机视频背景切换</title>
    <link href="/2021/08/13/hexo-theme/fluid/fluid-update/fluid-update/"/>
    <url>/2021/08/13/hexo-theme/fluid/fluid-update/fluid-update/</url>
    
    <content type="html"><![CDATA[<blockquote><p>fluid 主题简洁舒适，入场背景图片恢弘大气，但视频可能更好看，尝试自己对主题做了修改，本文记录修改方法和效果。</p></blockquote><span id="more"></span><h3 id="修改思路"><a href="#修改思路" class="headerlink" title="修改思路"></a>修改思路</h3><ul><li>向主题加入新的配置项 <code>index.banner_video</code>，控制是否使用视频背景</li><li>在 <code>layout.ejs</code> 模板中获取该变量值，根据开关是否打开在模板层面决定是否启用视频背景</li><li>创建 json 文件收集视频背景链接</li><li>当开启视频背景时，创建div，id为<code>banner_video_insert</code></li><li>js 读取 json 文件，创建视频控件语句，加入到创建的div中，实现视频显示，覆盖图片背景</li><li>动态监控窗口变化，适时调整视频属性，使得任意窗口大小可以全屏显示视频</li><li>识别是否是手机端访问，手机端访问改为使用图像做背景</li></ul><h3 id="修改方法"><a href="#修改方法" class="headerlink" title="修改方法"></a>修改方法</h3><h4 id="配置文件修改"><a href="#配置文件修改" class="headerlink" title="配置文件修改"></a>配置文件修改</h4><ul><li>在主题配置文件中修改 <code>首页 Home Page</code></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 首页</span><br><span class="hljs-comment"># Home Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">index:</span><br>  <span class="hljs-comment"># 首页 Banner 头图，可以是相对路径或绝对路径，以下相同</span><br>  <span class="hljs-comment"># Path of Banner image, can be a relative path or an absolute path, the same on other pages</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br> <br>  <span class="hljs-comment"># 首页 Banner 使用随机视频</span><br>  <span class="hljs-comment"># true 开启  false 关闭</span><br>  <span class="hljs-attr">banner_video:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><ul><li>加入：index.banner_video: true</li></ul><h3 id="引入-jquery-js"><a href="#引入-jquery-js" class="headerlink" title="引入 jquery.js"></a>引入 jquery.js</h3><ul><li><p>为了 读取json 需要加载jquery.js</p></li><li><p>保险起见，我下载了最新的 jquery.js 放在了 <code>fluid/source/js</code> 文件夹中</p></li><li><p>可以在代码中使用  <code>&lt;script type=&quot;text/javascript&quot; src=&quot;/js/jquery.js&quot;&gt;&lt;/script&gt;</code> 加载</p></li></ul><h3 id="创建视频url-json"><a href="#创建视频url-json" class="headerlink" title="创建视频url json"></a>创建视频url json</h3><ul><li>例如我的，文件在<code>fluid/source/js</code>文件夹，命名为<code>video_url.json</code>：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">[<br><span class="hljs-string">&quot;https://photos.zywvvd.com/vvd-dell-2021-win-10/20210808220318.mp4&quot;</span>,<br><span class="hljs-string">&quot;https://photos.zywvvd.com/vvd-dell-2021-win-10/20210808220356.mp4&quot;</span>,<br><span class="hljs-string">&quot;https://photos.zywvvd.com/vvd-dell-2021-win-10/20210808220415.mp4&quot;</span>,<br><span class="hljs-string">&quot;https://photos.zywvvd.com/vvd-dell-2021-win-10/20210808220556.mp4&quot;</span>,<br><span class="hljs-string">&quot;https://photos.zywvvd.com/vvd-dell-2021-win-10/20210808220626.mp4&quot;</span>,<br><span class="hljs-string">&quot;https://photos.zywvvd.com/vvd-dell-2021-win-10/20210808220640.mp4&quot;</span>,<br><span class="hljs-string">&quot;https://photos.zywvvd.com/vvd-dell-2021-win-10/20210808220742.mp4&quot;</span><br>]<br></code></pre></td></tr></table></figure><h3 id="修改layout-ejs"><a href="#修改layout-ejs" class="headerlink" title="修改layout.ejs"></a>修改layout.ejs</h3><ul><li>修改 <code>themes/fluid/layout/layout.ejs</code> 模板文件</li></ul><h5 id="加载变量时加载-index-banner-video"><a href="#加载变量时加载-index-banner-video" class="headerlink" title="加载变量时加载 index.banner_video"></a>加载变量时加载 index.banner_video</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;%<br><span class="hljs-keyword">var</span> subtitle = page.subtitle || page.title<br><span class="hljs-keyword">var</span> banner_img = page.banner_img || theme.index.banner_img<br><span class="hljs-keyword">var</span> banner_img_height = page.banner_img_height || theme.index.banner_img_height<br><span class="hljs-keyword">var</span> banner_mask_alpha = page.banner_mask_alpha || theme.index.banner_mask_alpha<br><span class="hljs-keyword">var</span> colorSchema = theme.dark_mode &amp;&amp; theme.dark_mode.enable &amp;&amp; theme.dark_mode.default ? theme.dark_mode.default : <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">var</span> banner_video = theme.index.banner_video<br>%&gt;<br></code></pre></td></tr></table></figure><h5 id="加载-jquery-js"><a href="#加载-jquery-js" class="headerlink" title="加载 jquery.js"></a>加载 jquery.js</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ejs">&lt;!DOCTYPE html&gt;<br>&lt;html lang=&quot;&lt;%= config.language %&gt;&quot; &lt;%= colorSchema ? `data-default-color-scheme=&quot;$&#123;colorSchema&#125;&quot;` : &#x27;&#x27; %&gt;&gt;<br>&lt;script type=&quot;text/javascript&quot; src=&quot;/js/jquery.js&quot;&gt;&lt;/script&gt;<br><br></code></pre></td></tr></table></figure><h5 id="加入核心模板代码"><a href="#加入核心模板代码" class="headerlink" title="加入核心模板代码"></a>加入核心模板代码</h5><ul><li>在 <code>&lt;div class=&quot;full-bg-img&quot; &gt;</code> 行之后</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs ejs">    &lt;div class=&quot;full-bg-img&quot; &gt;<br><br>&lt;% if(banner_video)&#123; %&gt;<br>&lt;div id=&quot;banner_video_insert&quot;&gt;<br>&lt;/div&gt;<br>&lt;script&gt;<br><br>var ua = navigator.userAgent;<br>var ipad = ua.match(/(iPad).*OS\s([\d_]+)/),<br>isIphone = !ipad &amp;&amp; ua.match(/(iPhone\sOS)\s([\d_]+)/),<br>isAndroid = ua.match(/(Android)\s+([\d.]+)/),<br>isMobile = isIphone || isAndroid;<br><br>function set_video_attr(id)&#123;<br><br>var height = document.body.children[0].clientHeight<br><br>var width = document.body.children[0].clientWidth<br><br>var video_item = document.getElementById(id);<br><br>if (height / width &lt; 0.56)&#123;<br>video_item.setAttribute(&#x27;width&#x27;, &#x27;100%&#x27;);<br>video_item.setAttribute(&#x27;height&#x27;, &#x27;auto&#x27;);<br>&#125; else &#123;<br>video_item.setAttribute(&#x27;height&#x27;, &#x27;100%&#x27;);<br>video_item.setAttribute(&#x27;width&#x27;, &#x27;auto&#x27;);<br>&#125;<br>&#125;<br><br>$.getJSON(&#x27;/js/video_url.json&#x27;, function(data)&#123;<br>if (!isMobile)&#123;<br>var video_list_length = data.length<br>var seed = Math.random()<br>index = Math.floor(seed * video_list_length)<br><br>video_url = data[index]<br>video_html_res = &quot;&lt;video id=&#x27;video_item&#x27; style=&#x27;position: absolute;&#x27; muted=&#x27;muted&#x27; src=&quot; + video_url + &quot; autoplay=&#x27;autoplay&#x27; loop=&#x27;loop&#x27;&gt;&lt;/video&gt;&quot;<br><br>document.getElementById(&quot;banner_video_insert&quot;).innerHTML = video_html_res;<br>set_video_attr(&#x27;video_item&#x27;)<br>&#125;<br><br>&#125;);<br><br>if (!isMobile)&#123;<br>window.onresize = function()&#123;<br>set_video_attr(&#x27;video_item&#x27;)<br>&#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;% &#125; %&gt;<br></code></pre></td></tr></table></figure><p>作用为：</p><ol><li>读取json</li><li>判断是否加载视频背景</li><li>创建视频背景控件</li><li>插入视频链接</li><li>监控窗口变化</li><li>适时调整视频控件属性</li><li>判断设备类型决定是否执行背景视频模块</li></ol><h3 id="运行示例"><a href="#运行示例" class="headerlink" title="运行示例"></a>运行示例</h3><p><img src="https://photos.zywvvd.com/win11-mt/20210813154909.gif"></p><h3 id="主题仓库"><a href="#主题仓库" class="headerlink" title="主题仓库"></a>主题仓库</h3><ul><li><p>我修改的仓库在 ：<a href="https://github.com/zywvvd/hexo-theme-fluid">https://github.com/zywvvd/hexo-theme-fluid</a></p></li><li><p>使用方法与原生fluid一致</p></li><li><p>额外需要添加的是 <code>index.banner_video</code> 配置项，并修改 js 文件夹中的 json文件内容</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://github.com/fluid-dev/hexo-theme-fluid/">https://github.com/fluid-dev/hexo-theme-fluid/</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>fluid</category>
      
    </categories>
    
    
    <tags>
      
      <tag>fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaScript -2- 设置属性的几种方法</title>
    <link href="/2021/08/13/java-script/js-new-attri/js-new-attri/"/>
    <url>/2021/08/13/java-script/js-new-attri/js-new-attri/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录JS设置元素属性的几种方法。</p></blockquote><span id="more"></span><h3 id="直接设置style的属性"><a href="#直接设置style的属性" class="headerlink" title="直接设置style的属性"></a>直接设置style的属性</h3><p>某些情况用这个设置 !important值无效</p><p>如果属性有’-‘号，就写成驼峰的形式（如textAlign）  如果想保留 - 号，就中括号的形式  element.style[‘text-align’] = ‘100px’;</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">element.style.height</span> = <span class="hljs-string">&#x27;100px&#x27;</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="直接设置属性"><a href="#直接设置属性" class="headerlink" title="直接设置属性"></a>直接设置属性</h3><p>只能用于某些属性，相关样式会自动识别</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">element</span><span class="hljs-selector-class">.setAttribute</span>(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-number">100</span>);<br><span class="hljs-selector-tag">element</span><span class="hljs-selector-class">.setAttribute</span>(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-string">&#x27;100px&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="设置style的属性"><a href="#设置style的属性" class="headerlink" title="设置style的属性"></a>设置style的属性</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">element.set<span class="hljs-constructor">Attribute(&#x27;<span class="hljs-params">style</span>&#x27;, &#x27;<span class="hljs-params">height</span>: 100px !<span class="hljs-params">important</span>&#x27;)</span>;<br></code></pre></td></tr></table></figure><h3 id="使用setProperty"><a href="#使用setProperty" class="headerlink" title="使用setProperty"></a>使用setProperty</h3><p> 如果要设置!important，推荐用这种方法设置第三个参数</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">element</span><span class="hljs-selector-class">.style</span><span class="hljs-selector-class">.setProperty</span>(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-string">&#x27;300px&#x27;</span>, <span class="hljs-string">&#x27;important&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="改变class"><a href="#改变class" class="headerlink" title="改变class"></a>改变class</h3><p>因JS获取不到css的伪元素，所以可以通过改变伪元素父级的class来动态更改伪元素的样式</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sqf">element.<span class="hljs-built_in">className</span> = <span class="hljs-string">&#x27;blue&#x27;</span>;<br>element.<span class="hljs-built_in">className</span> += <span class="hljs-string">&#x27;blue fb&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="设置cssText"><a href="#设置cssText" class="headerlink" title="设置cssText"></a>设置cssText</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">element.<span class="hljs-built_in">style</span>.cssText = &#x27;<span class="hljs-built_in">height</span>: 100px !important&#x27;;<br>element.<span class="hljs-built_in">style</span>.cssText += &#x27;<span class="hljs-built_in">height</span>: 100px !important&#x27;;<br></code></pre></td></tr></table></figure><h3 id="创建引入新的css样式文件"><a href="#创建引入新的css样式文件" class="headerlink" title="创建引入新的css样式文件"></a>创建引入新的css样式文件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addNewStyle</span>(<span class="hljs-params">newStyle</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> styleElement = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;styles_js&#x27;</span>);<br><br>    <span class="hljs-keyword">if</span> (!styleElement) &#123;<br>        styleElement = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;style&#x27;</span>);<br>        styleElement.type = <span class="hljs-string">&#x27;text/css&#x27;</span>;<br>        styleElement.id = <span class="hljs-string">&#x27;styles_js&#x27;</span>;<br>        <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">&#x27;head&#x27;</span>)[<span class="hljs-number">0</span>].appendChild(styleElement);<br>    &#125;<br><br>    styleElement.appendChild(<span class="hljs-built_in">document</span>.createTextNode(newStyle));<br>&#125;<br><br>addNewStyle(<span class="hljs-string">&#x27;.box &#123;height: 100px !important;&#125;&#x27;</span>);<br></code></pre></td></tr></table></figure><h3 id="添加style样式"><a href="#添加style样式" class="headerlink" title="添加style样式"></a>添加style样式</h3><p>当代码中没有style元素时，可以通过 <code>document.createElement(&quot;style&quot;);</code> 建立style</p><p>然后插入到doucment.head, 最后就可以成功在js中添加style了</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;box1&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript">        <span class="hljs-keyword">var</span> styleNode = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;style&quot;</span>);</span><br><span class="javascript">        styleNode.innerHTML=<span class="hljs-string">&quot;.box1&#123;width:100px;height:100px;background:red&#125;&quot;</span>;</span><br><span class="javascript">        <span class="hljs-built_in">document</span>.head.appendChild(styleNode);                </span><br><span class="javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/webpon/p/13432184.html">https://www.cnblogs.com/webpon/p/13432184.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>javascript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaScript -1- 基础教程与部分功能示例</title>
    <link href="/2021/08/13/java-script/java-script-basic-tips/java-script-basic-tips/"/>
    <url>/2021/08/13/java-script/java-script-basic-tips/java-script-basic-tips/</url>
    
    <content type="html"><![CDATA[<blockquote><p>JavaScript 是属于 HTML 和 Web 的编程语言，编程令计算机完成您需要它们做的工作。本文记录基础教程与部分功能。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>JavaScript（简称“JS”） 是一种具有函数优先的轻量级，解释型或即时编译型的编程语言。虽然它是作为开发Web页面的脚本语言而出名，但是它也被用到了很多非浏览器环境中，JavaScript 基于原型编程、多范式的动态脚本语言，并且支持面向对象、命令式、声明式、函数式编程范式。</p><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ul><li><p>JS 服务于 HTML 和 Web，需要结合网页代码共同运行。</p></li><li><p>我们可以在 HTML 文档中放置任意数量的脚本。</p></li><li><p>脚本可被放置与 HTML 页面的 <body> 或 <head> 部分中，或兼而有之。</p></li></ul><h4 id="lt-script-gt-标签"><a href="#lt-script-gt-标签" class="headerlink" title="&lt;script&gt; 标签"></a><code>&lt;script&gt;</code> 标签</h4><p>在 HTML 中，JavaScript 代码必须位于 <code>&lt;script&gt;</code> 与 <code>&lt;/script&gt;</code> 标签之间。</p><p><strong>实例</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Body 中的 JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;demo&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;demo&quot;</span>).innerHTML = <span class="hljs-string">&quot;我的第一段 JavaScript&quot;</span>;</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>旧的 JavaScript 例子也许会使用 <strong>type</strong> 属性：<code>&lt;script type=&quot;text/javascript&quot;&gt;</code>。</p><p>type 属性不是必需的。JavaScript 是 HTML 中的默认脚本语言。</p></blockquote><h4 id="外部脚本"><a href="#外部脚本" class="headerlink" title="外部脚本"></a>外部脚本</h4><p>脚本可放置于外部文件中：</p><ul><li>外部文件：<code>myScript.js</code></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFunction</span>(<span class="hljs-params"></span>) </span>&#123;<br>   <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;demo&quot;</span>).innerHTML = <span class="hljs-string">&quot;段落被更改。&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>外部脚本很实用，如果相同的脚本被用于许多不同的网页。</p></blockquote><ul><li><p>JavaScript 文件的文件扩展名是 <code>*.js*</code>。</p></li><li><p>如需使用外部脚本，请在 <code>&lt;script&gt;</code> 标签的 <code>src (source)</code> 属性中设置脚本的名称：</p></li></ul><p><strong>实例</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;myScript.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p>可以在 <code>&lt;head&gt;</code> 或 <code>&lt;body&gt;</code> 中放置外部脚本引用。</p></li><li><p>该脚本的表现与它被置于 <code>&lt;script&gt;</code> 标签中是一样的。</p></li><li><p>外部脚本不能包含 <code>&lt;script&gt;</code> 标签。</p></li></ul><h5 id="外部脚本的优势"><a href="#外部脚本的优势" class="headerlink" title="外部脚本的优势"></a><strong>外部脚本的优势</strong></h5><p>在外部文件中放置脚本有如下优势：</p><ul><li>分离了 HTML 和代码</li><li>使 HTML 和 JavaScript 更易于阅读和维护</li><li>已缓存的 JavaScript 文件可加速页面加载</li></ul><p>如需向一张页面添加多个脚本文件 - 请使用多个 script 标签：</p><p><strong>实例</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;myScript1.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;myScript2.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="外部引用"><a href="#外部引用" class="headerlink" title="外部引用"></a><strong>外部引用</strong></h5><ul><li><p>可通过完整的 URL 或相对于当前网页的路径引用外部脚本：</p></li><li><p>本例使用完整的 URL 来链接至脚本：</p></li></ul><p><strong>实例</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://www.w3school.com.cn/js/myScript1.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><h4 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h4><ul><li>使用 if 来规定要执行的代码块，如果指定条件为 true</li><li>使用 else 来规定要执行的代码块，如果相同的条件为 false</li><li>使用 else if 来规定要测试的新条件，如果第一个条件为 false</li><li>使用 switch 来规定多个被执行的备选代码块</li></ul><h5 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">if</span> (条件 <span class="hljs-number">1</span>) &#123;<br>    条件 <span class="hljs-number">1</span> 为 <span class="hljs-literal">true</span> 时执行的代码块<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (条件 <span class="hljs-number">2</span>) &#123;<br>    条件 <span class="hljs-number">1</span> 为 <span class="hljs-literal">false</span> 而条件 <span class="hljs-number">2</span> 为 <span class="hljs-literal">true</span> 时执行的代码块<br> &#125; <span class="hljs-keyword">else</span> &#123;<br>    条件 <span class="hljs-number">1</span> 和条件 <span class="hljs-number">2</span> 同时为 <span class="hljs-literal">false</span> 时执行的代码块<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Switch-语句"><a href="#Switch-语句" class="headerlink" title="Switch 语句"></a>Switch 语句</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">switch</span>(表达式) &#123;<br>     <span class="hljs-keyword">case</span> n:<br>        代码块<br>        <span class="hljs-keyword">break</span>;<br>     <span class="hljs-keyword">case</span> n:<br>        代码块<br>        <span class="hljs-keyword">break</span>;<br>     <span class="hljs-keyword">default</span>:<br>        默认代码块<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h4><ul><li>for - 多次遍历代码块</li><li>for/in - 遍历对象属性</li><li>while - 当指定条件为 true 时循环一段代码块</li><li>do/while - 当指定条件为 true 时循环一段代码块</li></ul><h5 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">for</span> (语句 <span class="hljs-number">1</span>; 语句 <span class="hljs-number">2</span>; 语句 <span class="hljs-number">3</span>) &#123;<br>     要执行的代码块<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="While-循环"><a href="#While-循环" class="headerlink" title="While 循环"></a>While 循环</h5><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-keyword">while</span> <span class="hljs-comment">(条件)</span> &#123;<br>    要执行的代码块<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="Do-While-循环"><a href="#Do-While-循环" class="headerlink" title="Do/While 循环"></a>Do/While 循环</h5><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-keyword">do</span> &#123;<br>    要执行的代码块<br>&#125;<br><br><span class="hljs-keyword">while</span> <span class="hljs-comment">(条件)</span>;<br></code></pre></td></tr></table></figure><h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><blockquote><p>JavaScript 函数是被设计为执行特定任务的代码块。JavaScript 函数会在某代码调用它时被执行。</p></blockquote><h5 id="JavaScript-函数语法"><a href="#JavaScript-函数语法" class="headerlink" title="JavaScript 函数语法"></a>JavaScript 函数语法</h5><ul><li><p>JavaScript 函数通过 function 关键词进行定义，其后是<em>函数名</em>和括号 ()。</p></li><li><p>函数名可包含字母、数字、下划线和美元符号（规则与变量名相同）。</p></li><li><p>圆括号可包括由逗号分隔的参数：</p></li></ul><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">(参数 <span class="hljs-number">1</span>, 参数 <span class="hljs-number">2</span>, ...)<br></code></pre></td></tr></table></figure><ul><li>由函数执行的代码被放置在花括号中：*{}*</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>(<span class="hljs-params">参数 <span class="hljs-number">1</span>, 参数 <span class="hljs-number">2</span>, 参数 <span class="hljs-number">3</span></span>) </span>&#123;<br>    要执行的代码<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p><em>函数参数（Function parameters）</em>是在函数定义中所列的名称。</p></li><li><p><em>函数参数（Function arguments）</em>是当调用函数时由函数接收的真实的<em>值</em>。</p></li><li><p>在函数中，参数是局部变量。</p></li></ul><h5 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h5><p>函数中的代码将在其他代码调用该函数时执行：</p><ul><li>当事件发生时（当用户点击按钮时）</li><li>当 JavaScript 代码调用时</li><li>自动的（自调用）</li></ul><h5 id="函数返回"><a href="#函数返回" class="headerlink" title="函数返回"></a>函数返回</h5><ul><li><p>当 JavaScript 到达 return 语句，函数将停止执行。</p></li><li><p>如果函数被某条语句调用，JavaScript 将在调用语句之后“返回”执行代码。</p></li><li><p>函数通常会计算出<em>返回值</em>。这个返回值会返回给调用者：</p></li></ul><h5 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h5><ul><li><p>能够对代码进行复用：只要定义一次代码，就可以多次使用它。</p></li><li><p>能够多次向同一函数传递不同的参数，以产生不同的结果。</p></li></ul><p><strong>实例</strong></p><p>计算两个数的乘积，并返回结果：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> x = myFunction(<span class="hljs-number">7</span>, <span class="hljs-number">8</span>);        <span class="hljs-comment">// 调用函数，返回值被赋值给 x</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFunction</span>(<span class="hljs-params">a, b</span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> a * b;                <span class="hljs-comment">// 函数返回 a 和 b 的乘积</span><br>&#125;<br></code></pre></td></tr></table></figure><p>x 的结果将是：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">56<br></code></pre></td></tr></table></figure><h3 id="功能示例"><a href="#功能示例" class="headerlink" title="功能示例"></a>功能示例</h3><h4 id="读取-json-文件"><a href="#读取-json-文件" class="headerlink" title="读取 json 文件"></a>读取 json 文件</h4><ul><li>加载 jquery.js 后</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript">$.getJSON(json_path, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>&#123;<br><span class="hljs-keyword">var</span> video_list_length = data.length<br><span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">var</span>)<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="向-html-元素加入内容"><a href="#向-html-元素加入内容" class="headerlink" title="向 html 元素加入内容"></a>向 html 元素加入内容</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">video_url = &lt;a-url-<span class="hljs-keyword">of</span>-video&gt;<br>video_html_res = <span class="hljs-string">&quot;&lt;video id=&#x27;video_item&#x27; style=&#x27;position: absolute;&#x27; muted=&#x27;muted&#x27; src=&quot;</span> + video_url + <span class="hljs-string">&quot; autoplay=&#x27;autoplay&#x27; loop=&#x27;loop&#x27;&gt;&lt;/video&gt;&quot;</span><br><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;video_insert&quot;</span>).innerHTML = video_html_res;<br></code></pre></td></tr></table></figure><h4 id="调整-html-元素属性"><a href="#调整-html-元素属性" class="headerlink" title="调整 html 元素属性"></a>调整 html 元素属性</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_video_attr</span>(<span class="hljs-params">id</span>)</span>&#123;<br><br>    <span class="hljs-keyword">var</span> height = <span class="hljs-built_in">document</span>.body.children[<span class="hljs-number">0</span>].clientHeight<br>    <span class="hljs-keyword">var</span> width = <span class="hljs-built_in">document</span>.body.children[<span class="hljs-number">0</span>].clientWidth<br>    <span class="hljs-keyword">var</span> video_item = <span class="hljs-built_in">document</span>.getElementById(id);<br><br>    <span class="hljs-keyword">if</span> (height / width &lt; <span class="hljs-number">0.56</span>)&#123;<br>        video_item.setAttribute(<span class="hljs-string">&#x27;width&#x27;</span>, <span class="hljs-string">&#x27;100%&#x27;</span>);<br>        video_item.setAttribute(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-string">&#x27;auto&#x27;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        video_item.setAttribute(<span class="hljs-string">&#x27;height&#x27;</span>, <span class="hljs-string">&#x27;100%&#x27;</span>);<br>        video_item.setAttribute(<span class="hljs-string">&#x27;width&#x27;</span>, <span class="hljs-string">&#x27;auto&#x27;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="监控窗口尺寸变化"><a href="#监控窗口尺寸变化" class="headerlink" title="监控窗口尺寸变化"></a>监控窗口尺寸变化</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">window</span>.onresize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;window resized&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="检查当前运行设备是否是手机"><a href="#检查当前运行设备是否是手机" class="headerlink" title="检查当前运行设备是否是手机"></a>检查当前运行设备是否是手机</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> ua = navigator.userAgent;<br><span class="hljs-keyword">var</span> ipad = ua.match(<span class="hljs-regexp">/(iPad).*OS\s([\d_]+)/</span>),<br>isIphone = !ipad &amp;&amp; ua.match(<span class="hljs-regexp">/(iPhone\sOS)\s([\d_]+)/</span>),<br>isAndroid = ua.match(<span class="hljs-regexp">/(Android)\s+([\d.]+)/</span>),<br>isMobile = isIphone || isAndroid;<br><br><span class="hljs-keyword">if</span> (isMobile)&#123;<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;mobile device&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://baike.baidu.com/item/JavaScript/321142?fr=aladdin">https://baike.baidu.com/item/JavaScript/321142?fr=aladdin</a></li><li><a href="https://www.w3school.com.cn/js/js_shiyong.asp">https://www.w3school.com.cn/js/js_shiyong.asp</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>javascript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javascript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>node.js -3- 基本语法</title>
    <link href="/2021/08/07/node-js/node-js-grammer/node-js-grammer/"/>
    <url>/2021/08/07/node-js/node-js-grammer/node-js-grammer/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录 node.js 最基本的语法。</p></blockquote><span id="more"></span><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>Node.js有一些核心类型：number，boolean，string，object、undefined 和 function。</p><p>可以使用 <code>typeof</code> 查看数据类型</p><h4 id="number"><a href="#number" class="headerlink" title="number"></a>number</h4><p>数字</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">typeof</span><span class="hljs-params">(<span class="hljs-number">3.5</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">typeof</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span><br></code></pre></td></tr></table></figure><h4 id="boolean"><a href="#boolean" class="headerlink" title="boolean"></a>boolean</h4><p>true 和 false</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">typeof</span>(<span class="hljs-variable"><span class="hljs-literal">true</span></span>)</span><br><span class="hljs-function"><span class="hljs-title">typeof</span>(<span class="hljs-variable"><span class="hljs-literal">false</span></span>)</span><br></code></pre></td></tr></table></figure><h4 id="string"><a href="#string" class="headerlink" title="string"></a>string</h4><p>字符串</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">typeof</span><span class="hljs-params">(<span class="hljs-string">&#x27;abc&#x27;</span>)</span></span><br></code></pre></td></tr></table></figure><h4 id="object"><a href="#object" class="headerlink" title="object"></a>object</h4><p>node.js 对象，由 {} 定义 或 new Object();</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> user = &#123;<br>    <span class="hljs-attr">first_name</span>: <span class="hljs-string">&quot;HTML&quot;</span>,<br>    <span class="hljs-attr">last_name</span>: <span class="hljs-string">&quot;CSS&quot;</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>,<br>&#125;;<br><span class="hljs-keyword">var</span> empty = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>()<br><br><span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">typeof</span>(user))<br><span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">typeof</span>(empty))<br></code></pre></td></tr></table></figure><h4 id="undefined"><a href="#undefined" class="headerlink" title="undefined"></a>undefined</h4><p>意味着尚未设置或根本不存在</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">a</span><br><span class="hljs-function"><span class="hljs-title">typeof</span><span class="hljs-params">(a)</span></span><br><span class="hljs-function"><span class="hljs-title">typeof</span><span class="hljs-params">(askfalsjdflasf)</span></span><br></code></pre></td></tr></table></figure><h4 id="function"><a href="#function" class="headerlink" title="function"></a>function</h4><p>函数类型</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">function</span> <span class="hljs-function"><span class="hljs-title">hello</span>(<span class="hljs-variable">name</span>) &#123;</span><br><span class="hljs-function">    <span class="hljs-variable">console.log</span>(<span class="hljs-string">&quot;hello &quot;</span> + <span class="hljs-variable">name</span>);</span><br><span class="hljs-function">&#125;</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">hello</span>(<span class="hljs-string">&#x27;abc&#x27;</span>)</span><br><span class="hljs-variable">console.log</span>(<span class="hljs-function"><span class="hljs-title">typeof</span>(<span class="hljs-variable">hello</span>))</span><br></code></pre></td></tr></table></figure><h3 id="运算符表达式"><a href="#运算符表达式" class="headerlink" title="运算符表达式"></a>运算符表达式</h3><h4 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h4><ul><li>加+,减-,乘*,除 /,括号();</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> a = <span class="hljs-number">10</span>; <span class="hljs-comment">// 赋值语句</span><br>a = <span class="hljs-number">4</span> * <span class="hljs-number">23</span> + <span class="hljs-number">188</span> / <span class="hljs-number">6</span>; <span class="hljs-comment">// 数学表达式</span><br><span class="hljs-keyword">var</span> c = <span class="hljs-number">7</span>;<br><span class="hljs-keyword">var</span> b = (a + c) / <span class="hljs-number">2</span>; <span class="hljs-comment">// 变量的数学表达式</span><br><span class="hljs-built_in">console</span>.log(a);<br><span class="hljs-built_in">console</span>.log(b);<br></code></pre></td></tr></table></figure><h4 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h4><ul><li>等于==，小于等于&lt;=，大于等于 &gt;=,不等于 !=</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 比较表达式，如果成立，那么为<span class="hljs-literal">true</span>,否则为<span class="hljs-literal">false</span>;<br>console.<span class="hljs-built_in">log</span>(a <span class="hljs-operator">&gt;</span> b); <br>console.<span class="hljs-built_in">log</span>(a <span class="hljs-operator">=</span><span class="hljs-operator">=</span> b);<br>console.<span class="hljs-built_in">log</span>(a <span class="hljs-operator">&lt;=</span> b);<br>console.<span class="hljs-built_in">log</span>(a <span class="hljs-operator">!=</span> b);<br></code></pre></td></tr></table></figure><h4 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h4><ul><li>与&amp;&amp;,或 || 非 !</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-operator">&amp;&amp;</span>所有条件都满足才为真<br><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-operator">||</span>所有条件中只要有一条满足就为真<br>console.<span class="hljs-built_in">log</span>(&quot;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&quot;);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">false</span> <span class="hljs-operator">&amp;&amp;</span> <span class="hljs-literal">false</span>);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">false</span> <span class="hljs-operator">&amp;&amp;</span> <span class="hljs-literal">true</span>);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">true</span> <span class="hljs-operator">&amp;&amp;</span> <span class="hljs-literal">false</span>);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">true</span> <span class="hljs-operator">&amp;&amp;</span> <span class="hljs-literal">true</span>);<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 逻辑或<br>console.<span class="hljs-built_in">log</span>(&quot;||||||||||||&quot;);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">false</span> <span class="hljs-operator">||</span> <span class="hljs-literal">false</span>);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">false</span> <span class="hljs-operator">||</span> <span class="hljs-literal">true</span>);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">true</span> <span class="hljs-operator">||</span> <span class="hljs-literal">false</span>);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">true</span> <span class="hljs-operator">||</span> <span class="hljs-literal">true</span>);<br><br>console.<span class="hljs-built_in">log</span>((<span class="hljs-literal">false</span> <span class="hljs-operator">&amp;&amp;</span> <span class="hljs-literal">false</span>) <span class="hljs-operator">||</span> <span class="hljs-literal">true</span>); <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-literal">true</span><br>console.<span class="hljs-built_in">log</span>(<span class="hljs-literal">false</span> <span class="hljs-operator">&amp;&amp;</span> (<span class="hljs-literal">false</span> <span class="hljs-operator">||</span> <span class="hljs-literal">true</span>)); <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-literal">false</span><br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 非<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-operator">!</span><span class="hljs-literal">true</span>)<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-operator">!</span><span class="hljs-literal">false</span>)<br></code></pre></td></tr></table></figure><h4 id="字符串相关运算符"><a href="#字符串相关运算符" class="headerlink" title="字符串相关运算符"></a>字符串相关运算符</h4><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-comment">// 字符串的加法是把各个字符串连接在一起，生成一个新的字符串；</span><br>var <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;Hello i am &quot;</span>;<br>var <span class="hljs-built_in">name</span> = <span class="hljs-string">&quot;a girl&quot;</span><br>var str_total = (<span class="hljs-built_in">str</span> + <span class="hljs-built_in">name</span>);<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">str</span>, <span class="hljs-built_in">name</span>, str_total);<br><br><span class="hljs-comment">// 字符串与基本的数据类型相加，把这个基本数据类型转成字符串后再生成新的字符串</span><br>var num_str = <span class="hljs-string">&quot; &quot;</span> + a + b + c + <span class="hljs-literal">true</span>;<br>console.<span class="hljs-built_in">log</span>(num_str);<br><br></code></pre></td></tr></table></figure><h4 id="简约表达式"><a href="#简约表达式" class="headerlink" title="简约表达式"></a>简约表达式</h4><ul><li>+=, -=, *=, /= </li></ul><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">// 简约的写法<br><span class="hljs-keyword">a</span> += c; <span class="hljs-comment"> // a = a + c;</span><br><span class="hljs-keyword">a</span> -= c;<span class="hljs-comment"> //  a = a - c;</span><br><span class="hljs-keyword">a</span> *= c;<span class="hljs-comment"> // a = a * c;</span><br><span class="hljs-keyword">a</span> /= c;<span class="hljs-comment"> // a = a / c;</span><br></code></pre></td></tr></table></figure><ul><li>自增++,自减 –</li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">a</span> ++;  <span class="hljs-comment">// a = a + 1;</span><br>++ <span class="hljs-selector-tag">a</span>; <span class="hljs-comment">// a = a + 1;</span><br><span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">--</span>; <span class="hljs-comment">// a = a - 1;</span><br><span class="hljs-selector-tag">--</span> <span class="hljs-selector-tag">a</span>; <span class="hljs-comment">// a = a - 1;</span><br></code></pre></td></tr></table></figure><h3 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h3><h4 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h4><ul><li>单个条件</li></ul><blockquote><p>语法</p></blockquote><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml">if (条件判断)</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;</span><br><span class="hljs-template-variable">主体</span><br><span class="hljs-template-variable">&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">&gt; if (<span class="hljs-selector-tag">a</span> &gt; <span class="hljs-selector-tag">b</span>)<br>&#123;<br>    console<span class="hljs-selector-class">.log</span>(&quot;<span class="hljs-selector-tag">a</span> is bigger&quot;)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>默认否</li></ul><blockquote><p>语法</p></blockquote><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml">if (条件判断)</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;</span><br><span class="hljs-template-variable">主体</span><br><span class="hljs-template-variable">&#125;</span><span class="xml"> else</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;</span><br><span class="hljs-template-variable">主体</span><br><span class="hljs-template-variable">&#125;</span><br></code></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">if</span> (<span class="hljs-selector-tag">a</span> &gt; b)<br>&#123;<br>    console<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&quot;a is bigger&quot;</span>)<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    console<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&quot;b is bigger&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>多个条件</li></ul><blockquote><p>语法</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">(条件判断)</span></span><br>&#123;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> &#123;<br>&#125;<br>...<br><span class="hljs-keyword">else</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-keyword">if</span> (<span class="hljs-selector-tag">a</span> == <span class="hljs-number">1</span>)<br>&#123;<br>    console<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&quot;a is 1&quot;</span>)<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-selector-tag">a</span> == <span class="hljs-number">2</span>)<br>&#123;<br>    console<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&quot;a is 2&quot;</span>)<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-selector-tag">a</span> == <span class="hljs-number">3</span>)<br>&#123;<br>    console<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&quot;a is 3&quot;</span>)<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-selector-tag">a</span> == <span class="hljs-number">4</span>)<br>&#123;<br>    console<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&quot;a is 4&quot;</span>)<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    console<span class="hljs-selector-class">.log</span>(<span class="hljs-string">&quot;a is &quot;</span> + a)<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="switch-语句"><a href="#switch-语句" class="headerlink" title="switch 语句"></a>switch 语句</h4><blockquote><p>语法</p></blockquote><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">switch</span>(变量) &#123;<br><span class="hljs-keyword">case</span> 常量<span class="hljs-number">1</span>:<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> 常量<span class="hljs-number">2</span>:<br><span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs arduino">var a = <span class="hljs-number">2</span><br><br><span class="hljs-built_in"><span class="hljs-keyword">switch</span></span> (a)<br>&#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>    &#123;<br>        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;a is 1&quot;</span>)<br>        <span class="hljs-keyword">break</span><br>    &#125;<br><br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>    &#123;<br>        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;a is 2&quot;</span>)<br>        <span class="hljs-keyword">break</span><br>    &#125;<br><br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>    &#123;<br>        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;a is 3&quot;</span>)<br>        <span class="hljs-keyword">break</span><br>    &#125;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>    &#123;<br>        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;a is 4&quot;</span>)<br>        <span class="hljs-keyword">break</span><br>    &#125;<br>    <span class="hljs-keyword">default</span>:<br>    &#123;<br>        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;final a is &quot;</span> + a)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h3><h4 id="while-语句"><a href="#while-语句" class="headerlink" title="while 语句"></a>while 语句</h4><blockquote><p>语法</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">while</span><span class="hljs-params">(表达式)</span></span> &#123; 循环体&#125;<br></code></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-keyword">while</span>(条件成立) &#123;循环体代码&#125;; <br>index = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span>(index &lt; <span class="hljs-number">10</span>) &#123; <span class="hljs-regexp">//</span> 循环执行了<span class="hljs-number">10</span>次；判断一下， 循环条件是否为真，为真就执行，否者就不执行循环体；<br>    console.log(index);<br>    index += <span class="hljs-number">2</span>;<br>&#125;<br>console.log(<span class="hljs-string">&quot;out of while&quot;</span>);<br>/*<br><span class="hljs-regexp">//</span> 死循环，如果任何时候，这个循环判断条件都为真，那么就是死循环，代码就在循环体里面一直执行；<br><span class="hljs-keyword">while</span>(true) &#123; <span class="hljs-regexp">//</span> 死循环，一直执行<span class="hljs-keyword">while</span>语句<br>    console.log(<span class="hljs-string">&quot;while call true&quot;</span>);<br>&#125;<br>*/<br></code></pre></td></tr></table></figure><h4 id="for-语句"><a href="#for-语句" class="headerlink" title="for 语句"></a>for 语句</h4><blockquote><p>语法</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">for</span><span class="hljs-params">(初始化; 循环条件; 循环迭代)</span></span> &#123;循环体&#125;<br></code></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs nix">var <span class="hljs-attr">walk</span> = <span class="hljs-number">0</span>;<br>var <span class="hljs-attr">i</span> = <span class="hljs-number">1</span>;<br>for(<span class="hljs-attr">walk</span> = <span class="hljs-number">0</span>, <span class="hljs-attr">i</span> = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; walk += <span class="hljs-number">2</span>, i ++) &#123;<br>    console.log(walk);<br>&#125;<br><br><span class="hljs-attr">walk</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">i</span> = <span class="hljs-number">1</span>;<br>for(; i &lt;= <span class="hljs-number">10</span>; walk += <span class="hljs-number">2</span>, i ++) &#123;<br>&#125;<br>console.log(<span class="hljs-string">&quot;out for&quot;</span>);<br><br>// 死循环,如果么有循环判断，默认为<span class="hljs-literal">true</span><br><span class="hljs-comment">/*for(;;) &#123;</span><br><span class="hljs-comment">    console.log(&quot;loop for&quot;);</span><br><span class="hljs-comment">&#125;*/</span><br><br>// 省略初始化与循环迭代语句;<br><span class="hljs-attr">i</span> = <span class="hljs-number">6</span>;<br>for(; i &lt; <span class="hljs-number">10</span>;) &#123;<br>    console.log(<span class="hljs-string">&quot;for loop&quot;</span>);<br>    i ++;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="do-while-语句"><a href="#do-while-语句" class="headerlink" title="do while 语句"></a>do while 语句</h4><blockquote><p>语法</p></blockquote><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode"><span class="hljs-keyword">do</span> &#123;&#125;<span class="hljs-keyword">while</span><span class="hljs-comment">(表达式)</span>;<br></code></pre></td></tr></table></figure><blockquote><p>示例</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> <span class="hljs-keyword">for</span>, <span class="hljs-keyword">while</span>是先判断后执行，<span class="hljs-keyword">do</span>&#123;&#125; <span class="hljs-keyword">while</span>(); 先执行, 再判断是否继续执行循环<br>i = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">do</span> &#123;<br>    i ++;<br>    console.log(i);<br>&#125;<span class="hljs-keyword">while</span>(i &lt; <span class="hljs-number">10</span>);<br></code></pre></td></tr></table></figure><h3 id="循环控制语句"><a href="#循环控制语句" class="headerlink" title="循环控制语句"></a>循环控制语句</h3><h4 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h4><blockquote><p>终止当前循环体的本次循环</p></blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs arduino">i = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i ++) &#123;<br>    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">8</span>) &#123;<br>        <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// 终止本次循环，但是仍然会执行 循环迭代语句 (i ++)；</span><br>    &#125;<br><br>    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;give hime &quot;</span> + i);<br>&#125;<br><br>i = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">while</span>(i &lt;= <span class="hljs-number">10</span>) &#123;<br>    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">8</span>) &#123;<br>        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;while continue&quot;</span>);<br>        i ++;<br>        <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// 终止本次循环，回到循环判断，一定要注意循环判断变量，在continue,不要有死循环</span><br>    &#125;<br><br>    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;while give hime &quot;</span> + i);    <br>    i ++;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="break"><a href="#break" class="headerlink" title="break"></a>break</h4><blockquote><p> 结束最近一个循环体所有的循环</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp">i = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">for</span>(i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i ++) &#123;<br>    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">8</span>) &#123;<br>        <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 终止所有循环,跳出循环代码，但是不会执行 循环迭代语句 (i ++)；</span><br>    &#125;<br><br>    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;give hime &quot;</span> + i);<br>&#125;<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;end_for&quot;</span>, i); <span class="hljs-comment">// i = 8;</span><br><br>i = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">while</span>(i &lt;= <span class="hljs-number">10</span>) &#123;<br>    <span class="hljs-keyword">if</span> (i == <span class="hljs-number">8</span>) &#123;<br>        console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;while continue&quot;</span>);<br>        i ++;<br>        <span class="hljs-keyword">break</span>; <span class="hljs-comment">// 终止所有循环,跳出循环代码</span><br>    &#125;<br>    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;while give hime &quot;</span> + i);    <br>    i ++;<br>&#125;<br>console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;end while&quot;</span>);<br></code></pre></td></tr></table></figure><h3 id="字符串常用操作"><a href="#字符串常用操作" class="headerlink" title="字符串常用操作"></a>字符串常用操作</h3><h4 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf"></a>indexOf</h4><p>要查找具有另一个字符串的字符串，请使用<code>indexOf</code>函数:</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">var</span> i = <span class="hljs-string">&quot;this is a test&quot;</span>.indexOf(<span class="hljs-string">&quot;is&quot;</span>);<br><span class="hljs-built_in">console</span>.log(i);<br>-&gt;<br><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h4 id="substr和splice"><a href="#substr和splice" class="headerlink" title="substr和splice"></a>substr和splice</h4><p>要从字符串中提取子字符串，请使用<code>substr</code>或<code>splice</code>函数。</p><p><code>substr </code>获取要提取的字符串的起始索引和长度。<code>splice</code>取起始索引和结束索引:</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">var</span> s = <span class="hljs-string">&quot;this is a test string.&quot;</span><br><br><span class="hljs-built_in">console</span>.log(s.substr(<span class="hljs-number">19</span>, <span class="hljs-number">3</span>))<br><span class="hljs-built_in">console</span>.log(s.substr(-<span class="hljs-number">5</span>))<br><span class="hljs-built_in">console</span>.log(s.slice(<span class="hljs-number">19</span>, <span class="hljs-number">22</span>))<br><span class="hljs-built_in">console</span>.log<span class="hljs-function"><span class="hljs-params">(s.slice(-<span class="hljs-number">5</span>))</span></span><br><span class="hljs-function">-&gt;</span><br>ng.<br>ring.<br>ng.<br>ring.<br></code></pre></td></tr></table></figure><h4 id="Split"><a href="#Split" class="headerlink" title="Split"></a>Split</h4><p>要将字符串拆分为子字符串，请使用split函数并获取数组作为结果:</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">var</span> s = <span class="hljs-string">&quot;a|b|c|d|e|f|g|h&quot;</span>.split(<span class="hljs-string">&quot;|&quot;</span>);<br><span class="hljs-built_in">console</span>.log(s);<br>-&gt;<br>[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>, <span class="hljs-string">&#x27;h&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h4><p>trim函数从字符串的开头和结尾删除空格:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">var s <span class="hljs-operator">=</span> &quot;       cat   \n\n\n    &quot;. <span class="hljs-built_in">trim</span>();<br>console.<span class="hljs-built_in">log</span>(s);<br><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><br>cat<br></code></pre></td></tr></table></figure><h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><p>replace替换字符串</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">var</span> s = <span class="hljs-string">&quot;cat&quot;</span><br><span class="hljs-built_in">console</span>.log<span class="hljs-function"><span class="hljs-params">(s.replace(<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>))</span></span><br><span class="hljs-function">-&gt;</span><br>dog<br></code></pre></td></tr></table></figure><h5 id="String-对象属性"><a href="#String-对象属性" class="headerlink" title="String 对象属性"></a>String 对象属性</h5><table><thead><tr><th align="left">属性</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-constructor-string.html">constructor</a></td><td align="left">对创建该对象的函数的引用</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-length-string.html">length</a></td><td align="left">字符串的长度</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-prototype-string.html">prototype</a></td><td align="left">允许您向对象添加属性和方法</td></tr></tbody></table><h5 id="String-对象方法"><a href="#String-对象方法" class="headerlink" title="String 对象方法"></a>String 对象方法</h5><table><thead><tr><th align="left">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-charat.html">charAt()</a></td><td align="left">返回在指定位置的字符。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-charcodeat.html">charCodeAt()</a></td><td align="left">返回在指定的位置的字符的 Unicode 编码。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-concat-string.html">concat()</a></td><td align="left">连接两个或更多字符串，并返回新的字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-fromcharcode.html">fromCharCode()</a></td><td align="left">将 Unicode 编码转为字符。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-indexof.html">indexOf()</a></td><td align="left">返回某个指定的字符串值在字符串中首次出现的位置。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-lastindexof.html">lastIndexOf()</a></td><td align="left">从后向前搜索字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-match.html">match()</a></td><td align="left">查找找到一个或多个正则表达式的匹配。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-replace.html">replace()</a></td><td align="left">在字符串中查找匹配的子串， 并替换与正则表达式匹配的子串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-search.html">search()</a></td><td align="left">查找与正则表达式相匹配的值。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-slice-string.html">slice()</a></td><td align="left">提取字符串的片断，并在新的字符串中返回被提取的部分。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-split.html">split()</a></td><td align="left">把字符串分割为字符串数组。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-substr.html">substr()</a></td><td align="left">从起始索引号提取字符串中指定数目的字符。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-substring.html">substring()</a></td><td align="left">提取字符串中两个指定的索引号之间的字符。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-tolowercase.html">toLowerCase()</a></td><td align="left">把字符串转换为小写。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-touppercase.html">toUpperCase()</a></td><td align="left">把字符串转换为大写。</td></tr><tr><td align="left">trim()</td><td align="left">去除字符串两边的空白</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-valueof-string.html">valueOf()</a></td><td align="left">返回某个字符串对象的原始值。</td></tr></tbody></table><h5 id="String-HTML-包装方法"><a href="#String-HTML-包装方法" class="headerlink" title="String HTML 包装方法"></a>String HTML 包装方法</h5><p>HTML 包装方法返回加入了适当HTML标签的字符串。</p><table><thead><tr><th align="left">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-anchor.html">anchor()</a></td><td align="left">创建 HTML 锚。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-big.html">big()</a></td><td align="left">用大号字体显示字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-blink.html">blink()</a></td><td align="left">显示闪动字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-bold.html">bold()</a></td><td align="left">使用粗体显示字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-fixed.html">fixed()</a></td><td align="left">以打字机文本显示字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-fontcolor.html">fontcolor()</a></td><td align="left">使用指定的颜色来显示字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-fontsize.html">fontsize()</a></td><td align="left">使用指定的尺寸来显示字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-italics.html">italics()</a></td><td align="left">使用斜体显示字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-link.html">link()</a></td><td align="left">将字符串显示为链接。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-small.html">small()</a></td><td align="left">使用小字号来显示字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-strike.html">strike()</a></td><td align="left">用于显示加删除线的字符串。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-sub.html">sub()</a></td><td align="left">把字符串显示为下标。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-sup.html">sup()</a></td><td align="left">把字符串显示为上标。</td></tr></tbody></table><h3 id="Math-常用功能"><a href="#Math-常用功能" class="headerlink" title="Math 常用功能"></a>Math 常用功能</h3><p>完整介绍：<a href="https://www.w3cschool.cn/jsref/jsref-obj-math.html">https://www.w3cschool.cn/jsref/jsref-obj-math.html</a></p><h5 id="Math-属性"><a href="#Math-属性" class="headerlink" title="Math 属性"></a>Math 属性</h5><table><thead><tr><th align="left">属性</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-e.html">E</a></td><td align="left">返回算术常量 e，即自然对数的底数（约等于2.718）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-ln2.html">LN2</a></td><td align="left">返回 2 的自然对数（约等于0.693）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-ln10.html">LN10</a></td><td align="left">返回 10 的自然对数（约等于2.302）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-log2e.html">LOG2E</a></td><td align="left">返回以 2 为底的 e 的对数（约等于 1.414）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-log10e.html">LOG10E</a></td><td align="left">返回以 10 为底的 e 的对数（约等于0.434）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-pi.html">PI</a></td><td align="left">返回圆周率（约等于3.14159）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-sqrt1-2.html">SQRT1_2</a></td><td align="left">返回返回 2 的平方根的倒数（约等于 0.707）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-sqrt2.html">SQRT2</a></td><td align="left">返回 2 的平方根（约等于 1.414）。</td></tr></tbody></table><h5 id="Math-方法"><a href="#Math-方法" class="headerlink" title="Math 方法"></a>Math 方法</h5><table><thead><tr><th align="left">方法</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-abs.html">abs(x)</a></td><td align="left">返回 x 的绝对值。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-acos.html">acos(x)</a></td><td align="left">返回 x 的反余弦值。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-asin.html">asin(x)</a></td><td align="left">返回 x 的反正弦值。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-atan.html">atan(x)</a></td><td align="left">以介于 -PI/2 与 PI/2 弧度之间的数值来返回 x 的反正切值。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-atan2.html">atan2(y,x)</a></td><td align="left">返回从 x 轴到点 (x,y) 的角度（介于 -PI/2 与 PI/2 弧度之间）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-ceil.html">ceil(x)</a></td><td align="left">对数进行上舍入。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-cos.html">cos(x)</a></td><td align="left">返回数的余弦。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-exp.html">exp(x)</a></td><td align="left">返回 Ex 的指数。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-floor.html">floor(x)</a></td><td align="left">对 x 进行下舍入。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-log.html">log(x)</a></td><td align="left">返回数的自然对数（底为e）。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-max.html">max(x,y,z,…,n)</a></td><td align="left">返回 x,y,z,…,n 中的最高值。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-min.html">min(x,y,z,…,n)</a></td><td align="left">返回 x,y,z,…,n中的最低值。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-pow.html">pow(x,y)</a></td><td align="left">返回 x 的 y 次幂。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-random.html">random()</a></td><td align="left">返回 0 ~ 1 之间的随机数。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-round.html">round(x)</a></td><td align="left">把数四舍五入为最接近的整数。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-sin.html">sin(x)</a></td><td align="left">返回数的正弦。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-sqrt.html">sqrt(x)</a></td><td align="left">返回数的平方根。</td></tr><tr><td align="left"><a href="https://www.w3cschool.cn/jsref/jsref-tan.html">tan(x)</a></td><td align="left">返回角的正切。</td></tr></tbody></table><h3 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h3><ol><li>一个对象如果没有任何引用变量指向这个对象会被判定为垃圾对象;</li><li>在特定的时期js解释引擎会回收复杂对象的内存;</li><li>垃圾回收<ul><li>没有任何变量，保存了这个对象的引用；</li><li>在特定的时候，由js解释引擎(v8)特定的时期回收</li></ul></li></ol><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://blog.csdn.net/witch_666/article/details/76136118">https://blog.csdn.net/witch_666/article/details/76136118</a></p></li><li><p><a href="https://www.w3cschool.cn/javascript/js-obj-math.html">https://www.w3cschool.cn/javascript/js-obj-math.html</a></p></li><li><p><a href="https://www.w3cschool.cn/nodejs/node-js-tutorial.html">https://www.w3cschool.cn/nodejs/node-js-tutorial.html</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>node.js</category>
      
    </categories>
    
    
    <tags>
      
      <tag>node.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>node.js -2- REPL(交互式解释器)</title>
    <link href="/2021/08/07/node-js/node-js-basic-knowlg/node-js-basic-knowlg/"/>
    <url>/2021/08/07/node-js/node-js-basic-knowlg/node-js-basic-knowlg/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Node.js REPL(Read Eval Print Loop:交互式解释器) 表示一个电脑的环境，类似 Window 系统的终端或 Unix/Linux shell，我们可以在终端中输入命令，并接收系统的响应。。</p></blockquote><span id="more"></span><h3 id="REPL"><a href="#REPL" class="headerlink" title="REPL"></a>REPL</h3><p>Node 自带了交互式解释器，可以执行以下任务：</p><ul><li><strong>读取</strong> - 读取用户输入，解析输入的 Javascript 数据结构并存储在内存中。</li><li><strong>执行</strong> - 执行输入的数据结构</li><li><strong>打印</strong> - 输出结果</li><li><strong>循环</strong> - 循环操作以上步骤直到用户两次按下 <strong>ctrl-c</strong> 按钮退出。</li></ul><blockquote><p>需要安装 node.js </p></blockquote><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="启动终端"><a href="#启动终端" class="headerlink" title="启动终端"></a>启动终端</h4><ul><li>在系统终端输入 node 命令</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">C:\Users\Administrator&gt;<span class="hljs-keyword">node</span><br><span class="hljs-title">Welcome</span> to Node.js v14.<span class="hljs-number">17.3</span>.<br><span class="hljs-keyword">Type</span> <span class="hljs-string">&quot;.help&quot;</span> for more <span class="hljs-literal">inf</span>ormation.<br>&gt;<br></code></pre></td></tr></table></figure><h4 id="运算示例"><a href="#运算示例" class="headerlink" title="运算示例"></a>运算示例</h4><ul><li>可以在 Node.js REPL 的命令行窗口中执行命令</li><li>可以将数据存储在变量中，并在你需要的时候使用它</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs node">&gt; x = 9<br>9<br>&gt; y = 7<br>7<br>&gt;  x*y<br>63<br>&gt; console.log(&quot;Hello World&quot;)<br>Hello World<br>undefined<br>&gt;<br><br></code></pre></td></tr></table></figure><ul><li>多行表达式</li></ul><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript"><span class="hljs-keyword">var</span> x = <span class="hljs-number">0</span></span><br>undefined<br><span class="hljs-meta">&gt;</span> <span class="javascript"><span class="hljs-keyword">do</span> &#123;</span><br><span class="hljs-meta">...</span> <span class="javascript">x++;</span><br><span class="hljs-meta">...</span> <span class="javascript"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;x: &quot;</span> +x)</span><br><span class="hljs-meta">...</span> <span class="javascript">&#125; <span class="hljs-keyword">while</span>(x&lt;<span class="hljs-number">5</span>)</span><br>x: 1<br>x: 2<br>x: 3<br>x: 4<br>x: 5<br>undefined<br></code></pre></td></tr></table></figure><h3 id="REPL-命令"><a href="#REPL-命令" class="headerlink" title="REPL 命令"></a>REPL 命令</h3><ul><li><strong>ctrl + c</strong> - 退出当前终端。</li><li><strong>ctrl + c 按下两次</strong> - 退出 Node REPL。</li><li><strong>ctrl + d</strong> - 退出 Node REPL.</li><li><strong>向上/向下 键</strong> - 查看输入的历史命令</li><li><strong>tab 键</strong> - 列出当前命令</li><li><strong>.help</strong> - 列出使用命令</li><li><strong>.break</strong> - 退出多行表达式</li><li><strong>.clear</strong> - 退出多行表达式</li><li><strong>.save *filename*</strong> - 保存当前的 Node REPL 会话到指定文件</li><li><strong>.load *filename*</strong> - 载入当前 Node REPL 会话的文件内容。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.runoob.com/nodejs/nodejs-repl.html">https://www.runoob.com/nodejs/nodejs-repl.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>node.js</category>
      
    </categories>
    
    
    <tags>
      
      <tag>node.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>node.js -1- 安装与 hello world 程序</title>
    <link href="/2021/08/06/node-js/node-js-tutorials/node-js-tutorials/"/>
    <url>/2021/08/06/node-js/node-js-tutorials/node-js-tutorials/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Node.js 是一个基于Chrome JavaScript 运行时建立的一个平台，本文记录 node.js 基本知识。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul><li><p>简单的说 Node.js 就是运行在服务端的 JavaScript。</p></li><li><p>Node.js 是一个基于Chrome JavaScript 运行时建立的一个平台。</p></li><li><p>Node.js是一个事件驱动I/O服务端JavaScript环境，基于Google的V8引擎，V8引擎执行Javascript的速度非常快，性能非常好。</p></li></ul><h3 id="程序安装"><a href="#程序安装" class="headerlink" title="程序安装"></a>程序安装</h3><ul><li><p>在官方网站下载安装包安装即可</p></li><li><p>官方网站： <a href="https://nodejs.org/zh-cn/">https://nodejs.org/zh-cn/</a></p></li><li><p>下载地址： <a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></p></li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806232445.png"></p><ul><li>你可以根据不同平台系统选择你需要的 Node.js 安装包</li><li>Node.js 历史版本下载地址：<a href="https://nodejs.org/dist/">https://nodejs.org/dist/</a></li><li>安装完成后可以在控制台输入命令验证是否成功：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">C:\Users\Administrator&gt;node -v<br>v14.17.3<br></code></pre></td></tr></table></figure><h3 id="创建-node-js-Hello-World-应用"><a href="#创建-node-js-Hello-World-应用" class="headerlink" title="创建 node.js Hello World 应用"></a>创建 node.js Hello World 应用</h3><h4 id="引入-required-模块"><a href="#引入-required-模块" class="headerlink" title="引入 required 模块"></a>引入 required 模块</h4><p>我们使用 <strong>require</strong> 指令来载入 http 模块，并将实例化的 HTTP 赋值给变量 http，实例如下:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br></code></pre></td></tr></table></figure><h4 id="创建服务器"><a href="#创建服务器" class="headerlink" title="创建服务器"></a>创建服务器</h4><ul><li><p>接下来我们使用 http.createServer() 方法创建服务器，并使用 listen 方法绑定 8888 端口。 函数通过 request, response 参数来接收和响应数据。</p></li><li><p>在你项目的根目录下创建一个叫 server.js 的文件，并写入以下代码：</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;<br><br>    <span class="hljs-comment">// 发送 HTTP 头部 </span><br>    <span class="hljs-comment">// HTTP 状态值: 200 : OK</span><br>    <span class="hljs-comment">// 内容类型: text/plain</span><br>    response.writeHead(<span class="hljs-number">200</span>, &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;text/plain&#x27;</span>&#125;);<br><br>    <span class="hljs-comment">// 发送响应数据 &quot;Hello World&quot;</span><br>    response.end(<span class="hljs-string">&#x27;Hello World\n&#x27;</span>);<br>&#125;).listen(<span class="hljs-number">8888</span>);<br><br><span class="hljs-comment">// 终端打印如下信息</span><br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Server running at http://127.0.0.1:8888/&#x27;</span>);<br></code></pre></td></tr></table></figure><ul><li>以上代码我们完成了一个可以工作的 HTTP 服务器。</li><li><strong>分析Node.js 的 HTTP 服务器：</strong><ul><li>第一行请求（require）Node.js 自带的 http 模块，并且把它赋值给 http 变量。</li><li>接下来我们调用 http 模块提供的函数： createServer 。这个函数会返回 一个对象，这个对象有一个叫做 listen 的方法，这个方法有一个数值参数， 指定这个 HTTP 服务器监听的端口号。</li></ul></li></ul><h4 id="执行代码运行服务器"><a href="#执行代码运行服务器" class="headerlink" title="执行代码运行服务器"></a>执行代码运行服务器</h4><p>使用 <strong>node</strong> 命令执行以上的代码：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">node server.js<br><span class="hljs-built_in">Server</span> running at http:<span class="hljs-comment">//127.0.0.1:8888/</span><br></code></pre></td></tr></table></figure><p>此时服务器正在运行</p><h4 id="使用浏览器访问服务器"><a href="#使用浏览器访问服务器" class="headerlink" title="使用浏览器访问服务器"></a>使用浏览器访问服务器</h4><p>打开浏览器访问 <a href="http://127.0.0.1:8888/">http://127.0.0.1:8888/</a> 或 <a href="http://localhost:8888/%EF%BC%8C%E4%BD%A0%E4%BC%9A%E7%9C%8B%E5%88%B0%E4%B8%80%E4%B8%AA%E5%86%99%E7%9D%80">http://localhost:8888/，你会看到一个写着</a> “Hello World”的网页。</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806233447.png"></p><blockquote><p>成功运行 hello world，标志着一个新世界的大门已经打开。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.runoob.com/nodejs/nodejs-tutorial.html">https://www.runoob.com/nodejs/nodejs-tutorial.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>node.js</category>
      
    </categories>
    
    
    <tags>
      
      <tag>node.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Matery -1- 主题安装</title>
    <link href="/2021/08/05/hexo-theme/matery/add-matery-theme/add-matery-theme/"/>
    <url>/2021/08/05/hexo-theme/matery/add-matery-theme/add-matery-theme/</url>
    
    <content type="html"><![CDATA[<blockquote><p>matery 是是一个采用 <code>Material Design</code> 和响应式设计的 Hexo 博客主题，本文记录主题安装使用方法。</p></blockquote><span id="more"></span><h3 id="预备环境"><a href="#预备环境" class="headerlink" title="预备环境"></a>预备环境</h3><ul><li>gitbash</li><li>node.js</li><li>Hexo 5.0.0 以上</li></ul><h3 id="安装最新版本-matery"><a href="#安装最新版本-matery" class="headerlink" title="安装最新版本 matery"></a>安装最新版本 matery</h3><ul><li>官方github: <a href="https://github.com/blinkfox/hexo-theme-matery">https://github.com/blinkfox/hexo-theme-matery</a></li></ul><blockquote><p>下载最新版本 matery 仓库到 <code>themes</code> 目录，并将解压出的文件夹重命名为 <code>matery</code>。</p></blockquote><ul><li>在hexo 根目录执行</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/blinkfox/</span>hexo-theme-matery.git themes/matery<br></code></pre></td></tr></table></figure><h3 id="指定主题"><a href="#指定主题" class="headerlink" title="指定主题"></a>指定主题</h3><p>如下修改 Hexo 博客目录中的 <code>_config.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">theme:</span> <span class="hljs-string">matery</span>  <span class="hljs-comment"># 指定主题</span><br><span class="hljs-attr">language:</span> <span class="hljs-string">zh-CN</span>  <span class="hljs-comment"># 指定语言</span><br></code></pre></td></tr></table></figure><h3 id="添加分类、归档、关于页"><a href="#添加分类、归档、关于页" class="headerlink" title="添加分类、归档、关于页"></a>添加分类、归档、关于页</h3><p><code>categories</code> 页是用来展示所有分类的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>categories/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> <span class="hljs-string">&quot;categories&quot;</span><br></code></pre></td></tr></table></figure><p>编辑你刚刚新建的页面文件 <code>/source/categories/index.md</code>，至少需要以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">categories</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2018-09-30 17:25:30</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">&quot;categories&quot;</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">&quot;categories&quot;</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><h3 id="新建标签-tags-页"><a href="#新建标签-tags-页" class="headerlink" title="新建标签 tags 页"></a>新建标签 tags 页</h3><p><code>tags</code> 页是用来展示所有标签的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>tags/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> <span class="hljs-string">&quot;tags&quot;</span><br></code></pre></td></tr></table></figure><p>编辑你刚刚新建的页面文件 <code>/source/tags/index.md</code>，至少需要以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">tags</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2018-09-30 18:23:38</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">&quot;tags&quot;</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">&quot;tags&quot;</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><h3 id="新建关于我-about-页"><a href="#新建关于我-about-页" class="headerlink" title="新建关于我 about 页"></a>新建关于我 about 页</h3><p><code>about</code> 页是用来展示<strong>关于我和我的博客</strong>信息的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>about/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> <span class="hljs-string">&quot;about&quot;</span><br></code></pre></td></tr></table></figure><p>编辑你刚刚新建的页面文件 <code>/source/about/index.md</code>，至少需要以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">about</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2018-09-30 17:25:30</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">&quot;about&quot;</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">&quot;about&quot;</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><h3 id="新建留言板-contact-页（可选的）"><a href="#新建留言板-contact-页（可选的）" class="headerlink" title="新建留言板 contact 页（可选的）"></a>新建留言板 contact 页（可选的）</h3><p><code>contact</code> 页是用来展示<strong>留言板</strong>信息的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>contact/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> <span class="hljs-string">&quot;contact&quot;</span><br></code></pre></td></tr></table></figure><p>编辑你刚刚新建的页面文件 <code>/source/contact/index.md</code>，至少需要以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">contact</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2018-09-30 17:25:30</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">&quot;contact&quot;</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">&quot;contact&quot;</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>注</strong>：本留言板功能依赖于第三方评论系统，请<strong>激活</strong>你的评论系统才有效果。并且在主题的 <code>_config.yml</code> 文件中，第 <code>19</code> 至 <code>21</code> 行的“<strong>菜单</strong>”配置，取消关于留言板的注释即可。</p></blockquote><h3 id="新建友情链接-friends-页（可选的）"><a href="#新建友情链接-friends-页（可选的）" class="headerlink" title="新建友情链接 friends 页（可选的）"></a>新建友情链接 friends 页（可选的）</h3><p><code>friends</code> 页是用来展示<strong>友情链接</strong>信息的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>friends/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> <span class="hljs-string">&quot;friends&quot;</span><br></code></pre></td></tr></table></figure><p>编辑你刚刚新建的页面文件 <code>/source/friends/index.md</code>，至少需要以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">friends</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2018-12-12 21:25:30</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">&quot;friends&quot;</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">&quot;friends&quot;</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><p>同时，在你的博客 <code>source</code> 目录下新建 <code>_data</code> 目录，在 <code>_data</code> 目录中新建 <code>friends.json</code> 文件，文件内容如下所示：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json">[&#123;<br>    <span class="hljs-attr">&quot;avatar&quot;</span>: <span class="hljs-string">&quot;http://image.luokangyuan.com/1_qq_27922023.jpg&quot;</span>,<br>    <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;码酱&quot;</span>,<br>    <span class="hljs-attr">&quot;introduction&quot;</span>: <span class="hljs-string">&quot;我不是大佬，只是在追寻大佬的脚步&quot;</span>,<br>    <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;http://luokangyuan.com/&quot;</span>,<br>    <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;前去学习&quot;</span><br>&#125;, &#123;<br>    <span class="hljs-attr">&quot;avatar&quot;</span>: <span class="hljs-string">&quot;http://image.luokangyuan.com/4027734.jpeg&quot;</span>,<br>    <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;闪烁之狐&quot;</span>,<br>    <span class="hljs-attr">&quot;introduction&quot;</span>: <span class="hljs-string">&quot;编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬&quot;</span>,<br>    <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://blinkfox.github.io/&quot;</span>,<br>    <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;前去学习&quot;</span><br>&#125;, &#123;<br>    <span class="hljs-attr">&quot;avatar&quot;</span>: <span class="hljs-string">&quot;http://image.luokangyuan.com/avatar.jpg&quot;</span>,<br>    <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;ja_rome&quot;</span>,<br>    <span class="hljs-attr">&quot;introduction&quot;</span>: <span class="hljs-string">&quot;平凡的脚步也可以走出伟大的行程&quot;</span>,<br>    <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://me.csdn.net/jlh912008548&quot;</span>,<br>    <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;前去学习&quot;</span><br>&#125;]<br></code></pre></td></tr></table></figure><h3 id="新建-404-页"><a href="#新建-404-页" class="headerlink" title="新建 404 页"></a>新建 404 页</h3><p>如果在你的博客 <code>source</code> 目录下还没有 <code>404.md</code> 文件，那么你就需要新建一个</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> <span class="hljs-number">404</span><br></code></pre></td></tr></table></figure><p>编辑你刚刚新建的页面文件 <code>/source/404/index.md</code>，至少需要以下内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-meta">---</span><br><span class="hljs-attr">title:</span> <span class="hljs-number">404</span><br><span class="hljs-attr">date:</span> <span class="hljs-number">2018-09-30 17:25:30</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">&quot;404&quot;</span><br><span class="hljs-attr">layout:</span> <span class="hljs-string">&quot;404&quot;</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">&quot;Oops～，我崩溃了！找不到你想要的页面 :(&quot;</span><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ul><li>此时运行hexo系列命令</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo clean</span><br><span class="hljs-attribute">hexo g</span><br><span class="hljs-attribute">hexo s</span><br></code></pre></td></tr></table></figure><ul><li>访问 <a href="http://localhost:4000/">http://localhost:4000/</a></li><li>这个 about 界面还是挺酷的</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210805004500.png"></p><blockquote><p>我是next主题转过来的，自带一些信息，不过正常情况下也可以正常进入主题了。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md">https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>matery</category>
      
    </categories>
    
    
    <tags>
      
      <tag>matery</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fluid -1- 主题安装</title>
    <link href="/2021/08/03/hexo-theme/fluid/fluid-install/fluid-install/"/>
    <url>/2021/08/03/hexo-theme/fluid/fluid-install/fluid-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Fluid 是基于 Hexo 的一款 Material Design 风格的主题，由 Fluid-dev 负责开发与维护，本文记录主题安装使用方法。</p></blockquote><span id="more"></span><h3 id="预备环境"><a href="#预备环境" class="headerlink" title="预备环境"></a>预备环境</h3><ul><li>gitbash</li><li>node.js</li><li>Hexo 5.0.0 以上</li></ul><h3 id="安装最新版本-fluid"><a href="#安装最新版本-fluid" class="headerlink" title="安装最新版本 fluid"></a>安装最新版本 fluid</h3><h4 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h4><ol><li>推荐通过 npm 直接安装，进入博客目录执行命令：</li></ol><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install <span class="hljs-comment">--save hexo-theme-fluid</span><br></code></pre></td></tr></table></figure><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">$ npm install --save hexo-theme-fluid<br>+ hexo-theme-fluid@<span class="hljs-number">1.8</span>.<span class="hljs-number">11</span><br>added <span class="hljs-number">4</span> packages from <span class="hljs-number">9</span> contributors <span class="hljs-literal">and</span> audited <span class="hljs-number">788</span> packages in <span class="hljs-number">17.402</span>s<br><br><span class="hljs-number">13</span> packages are looking for funding<br>  run `npm fund` for details<br><br>found <span class="hljs-number">51</span> vulnerabilities (<span class="hljs-number">11</span> low, <span class="hljs-number">29</span> moderate, <span class="hljs-number">11</span> high)<br>  run `npm audit fix` to fix them, <span class="hljs-literal">or</span> `npm audit` for details<br><br></code></pre></td></tr></table></figure><ol start="2"><li>在博客目录下创建 <code>_config.fluid.yml</code> 空文件，将<a href="https://github.com/fluid-dev/hexo-theme-fluid/blob/master/_config.yml">官方配置文件</a>内容复制进去。</li></ol><h4 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h4><p>下载 <a href="https://github.com/fluid-dev/hexo-theme-fluid/releases">最新 release 版本</a>解压到 themes 目录，并将解压出的文件夹重命名为 <code>fluid</code>。</p><h3 id="指定主题"><a href="#指定主题" class="headerlink" title="指定主题"></a>指定主题</h3><p>如下修改 Hexo 博客目录中的 <code>_config.yml</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">theme:</span> <span class="hljs-string">fluid</span>  <span class="hljs-comment"># 指定主题</span><br><br><span class="hljs-attr">language:</span> <span class="hljs-string">zh-CN</span>  <span class="hljs-comment"># 指定语言，会影响主题显示的语言，按需修改</span><br></code></pre></td></tr></table></figure><ul><li>此时运行hexo系列命令</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo clean</span><br><span class="hljs-attribute">hexo g</span><br><span class="hljs-attribute">hexo s</span><br></code></pre></td></tr></table></figure><ul><li>访问 <a href="http://localhost:4000/">http://localhost:4000/</a></li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210804000553.png"></p><blockquote><p>我是next主题转过来的，自带一些信息，不过正常情况下也可以正常进入主题了。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://hexo.fluid-dev.com/docs/start/#%E5%88%9B%E5%BB%BA%E3%80%8C%E5%85%B3%E4%BA%8E%E9%A1%B5%E3%80%8D">https://hexo.fluid-dev.com/docs/start/#%E5%88%9B%E5%BB%BA%E3%80%8C%E5%85%B3%E4%BA%8E%E9%A1%B5%E3%80%8D</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>fluid</category>
      
    </categories>
    
    
    <tags>
      
      <tag>fluid</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ai 模型并行运行实践方案</title>
    <link href="/2021/08/03/deep_learning/ai-parallel/ai-parallel/"/>
    <url>/2021/08/03/deep_learning/ai-parallel/ai-parallel/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录并行Ai的一种实践路线。</p></blockquote><span id="more"></span><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><ul><li><p>当遇到一个任务需要多个Ai模型分别完成时，串行执行Ai可能不是最好的方法，总无法发挥GPU的最大利用率</p></li><li><p>现有平台少有并行推断的相关信息</p></li><li><p>尝试搭建一个服务式的并行Ai执行框架</p></li></ul><h3 id="思路流程"><a href="#思路流程" class="headerlink" title="思路流程"></a>思路流程</h3><ul><li>构建网络服务，在网络服务中初始化模型</li><li>留出infer接口作为服务器备用</li><li>客户端多线程向服务器提供请求，实现Ai并行执行</li></ul><h3 id="技术方案"><a href="#技术方案" class="headerlink" title="技术方案"></a>技术方案</h3><ul><li>python平台</li><li>使用flask搭建微服务框架</li><li>将训练好的模型在服务器中初始化，留出infer接口，注册在路由中</li><li>服务端建好服务后 while True 在那呆着</li><li>客户端将测试数据作为 post 请求向指定ip 端口 路由发送请求</li><li>服务器收到数据进行Ai推断得到结果</li><li>pytorch并行在Linux下可以多进程，但Win下会报内存或重复加载的错误</li><li>使用多线程向服务器提供请求的方式实现并行</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Win11 修改右键菜单回到 Win10 的方法</title>
    <link href="/2021/08/03/windows/win11-back-to-win10-rc-menu/win11-back-to-win10-rc-menu/"/>
    <url>/2021/08/03/windows/win11-back-to-win10-rc-menu/win11-back-to-win10-rc-menu/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Win11 右键菜单简直反人类，所有有用的项目都在 show more options，本文记录修改回Win10右键菜单的方法 。</p></blockquote><span id="more"></span><h3 id="修改注册表"><a href="#修改注册表" class="headerlink" title="修改注册表"></a>修改注册表</h3><h4 id="打开注册表编辑器"><a href="#打开注册表编辑器" class="headerlink" title="打开注册表编辑器"></a>打开注册表编辑器</h4><p>Win-R 输入 regedit</p><p><img src="https://photos.zywvvd.com/win11-mt/20210803104851.png"></p><h4 id="定位注册表"><a href="#定位注册表" class="headerlink" title="定位注册表"></a>定位注册表</h4><ul><li>定位到 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FeatureManagement\Overrides\4 </li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210803105038.png"></p><h4 id="新建项"><a href="#新建项" class="headerlink" title="新建项"></a>新建项</h4><ul><li>点击鼠标右键，创建新的项，命名为“ 586118283”。</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210803105214.png"></p><h4 id="新建键值"><a href="#新建键值" class="headerlink" title="新建键值"></a>新建键值</h4><p>在创建的新项右侧窗格创建 5 个 DWORD值，分别为：<code>EnabledState</code>、<code>EnabledStateOptions</code>、<code>Variant</code>、<code>VariantPayload</code>、<code>VariantPayloadKind</code>。</p><p><img src="https://photos.zywvvd.com/win11-mt/20210803105733.png"></p><h3 id="方法无效"><a href="#方法无效" class="headerlink" title="方法无效"></a>方法无效</h3><p>Windows 11 Build 22000.65 预览版更新中，微软阻止用户通过注册表方式恢复 Windows 10 系统的开始菜单。</p><p><strong>该方法已经无效</strong>。</p><h3 id="强制生效"><a href="#强制生效" class="headerlink" title="强制生效"></a>强制生效</h3><p>但是不要惊慌，微软在升级后才阻止用户回复右键菜单的，我们可以将核心文件替换为升级前的内容。</p><ul><li>完成上述注册表配置</li><li>下载22000.1版本的 <code>shell32.dll</code> 文件 </li><li><a href="https://photos.zywvvd.com/win11-mt/1%E7%89%88%E6%9C%ACshell32.dll">下载链接</a></li><li>备份当前 <code>C:\Windows\System32</code> 中的 shell32.dll 文件</li><li>进入 PE，在 PE 中替换<code>shell32.dll</code>文件</li><li>正常重启开机即可，终于清净了</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210804145240.png"></p><blockquote><p>不知道为什么要升级Win 11</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://jingyan.baidu.com/article/0320e2c1f8087f5a86507b24.html">https://jingyan.baidu.com/article/0320e2c1f8087f5a86507b24.html</a></li><li><a href="https://www.bilibili.com/video/BV1FV411p7Qz?from=search&amp;seid=3505361985681146189">https://www.bilibili.com/video/BV1FV411p7Qz?from=search&amp;seid=3505361985681146189</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 多线程</title>
    <link href="/2021/08/03/python/python-threading/python-threading/"/>
    <url>/2021/08/03/python/python-threading/python-threading/</url>
    
    <content type="html"><![CDATA[<blockquote><p>线程是操作系统调度运算的最小单位，本文记录python使用多线程的方法。</p></blockquote><span id="more"></span><h3 id="线程简介"><a href="#线程简介" class="headerlink" title="线程简介"></a>线程简介</h3><h4 id="什么是线程"><a href="#什么是线程" class="headerlink" title="什么是线程"></a>什么是线程</h4><p><strong>线程（Thread）</strong>也叫轻量级进程，是操作系统能够进行运算调度的最小单位，它被包涵在进程之中，是进程中的实际运作单位。线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源，但它可与同属一个进程的其它线程共享进程所拥有的全部资源。一个线程可以创建和撤消另一个线程，同一进程中的多个线程之间可以并发执行。</p><h4 id="为什么要使用多线程"><a href="#为什么要使用多线程" class="headerlink" title="为什么要使用多线程"></a>为什么要使用多线程</h4><p>线程在程序中是独立的、并发的执行流。与分隔的进程相比，进程中线程之间的隔离程度要小，它们共享内存、文件句柄和其他进程应有的状态。</p><p>因为线程的划分尺度小于进程，使得多线程程序的并发性高。进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。</p><p>线程比进程具有更高的性能，这是由于同一个进程中的线程都有共性多个线程共享同一个进程的虚拟空间。线程共享的环境包括进程代码段、进程的公有数据等，利用这些共享的数据，线程之间很容易实现通信。</p><p>操作系统在创建进程时，必须为该进程分配独立的内存空间，并分配大量的相关资源，但创建线程则简单得多。因此，使用多线程来实现并发比使用多进程的性能要高得多。</p><p>总结起来，使用多线程编程具有如下几个优点：</p><ul><li>进程之间不能共享内存，但线程之间共享内存非常容易。</li><li>操作系统在创建进程时，需要为该进程重新分配系统资源，但创建线程的代价则小得多。因此，使用多线程来实现多任务并发执行比使用多进程的效率高。</li><li>Python 语言内置了多线程功能支持，而不是单纯地作为底层操作系统的调度方式，从而简化了 Python 的多线程编程。</li></ul><h3 id="线程实现"><a href="#线程实现" class="headerlink" title="线程实现"></a>线程实现</h3><h4 id="threading模块"><a href="#threading模块" class="headerlink" title="threading模块"></a>threading模块</h4><p>普通创建方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">n</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;task&quot;</span>, n)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;2s&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;1s&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;0s&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    t1 = threading.Thread(target=run, args=(<span class="hljs-string">&quot;t1&quot;</span>,))<br>    t2 = threading.Thread(target=run, args=(<span class="hljs-string">&quot;t2&quot;</span>,))<br>    t1.start()<br>    t2.start()<br><br>----------------------------------<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>task t1<br><span class="hljs-meta">&gt;&gt;&gt; </span>task t2<br><span class="hljs-meta">&gt;&gt;&gt; </span>2s<br><span class="hljs-meta">&gt;&gt;&gt; </span>2s<br><span class="hljs-meta">&gt;&gt;&gt; </span>1s<br><span class="hljs-meta">&gt;&gt;&gt; </span>1s<br><span class="hljs-meta">&gt;&gt;&gt; </span>0s<br><span class="hljs-meta">&gt;&gt;&gt; </span>0s<br></code></pre></td></tr></table></figure><h4 id="自定义线程"><a href="#自定义线程" class="headerlink" title="自定义线程"></a>自定义线程</h4><p>继承threading.Thread来自定义线程类，其本质是重构Thread类中的run方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span>(<span class="hljs-params">threading.Thread</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, n</span>):</span><br>        <span class="hljs-built_in">super</span>(MyThread, self).__init__()  <span class="hljs-comment"># 重构run函数必须要写</span><br>        self.n = n<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;task&quot;</span>, self.n)<br>        time.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;2s&#x27;</span>)<br>        time.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;1s&#x27;</span>)<br>        time.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;0s&#x27;</span>)<br>        time.sleep(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    t1 = MyThread(<span class="hljs-string">&quot;t1&quot;</span>)<br>    t2 = MyThread(<span class="hljs-string">&quot;t2&quot;</span>)<br>    t1.start()<br>    t2.start()<br>    <br>----------------------------------<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>task t1<br><span class="hljs-meta">&gt;&gt;&gt; </span>task t2<br><span class="hljs-meta">&gt;&gt;&gt; </span>2s<br><span class="hljs-meta">&gt;&gt;&gt; </span>2s<br><span class="hljs-meta">&gt;&gt;&gt; </span>1s<br><span class="hljs-meta">&gt;&gt;&gt; </span>1s<br><span class="hljs-meta">&gt;&gt;&gt; </span>0s<br><span class="hljs-meta">&gt;&gt;&gt; </span>0s<br></code></pre></td></tr></table></figure><h4 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h4><p>我们看下面这个例子，这里使用setDaemon(True)把所有的子线程都变成了主线程的守护线程，因此当主进程结束后，子线程也会随之结束。所以当主线程结束后，整个程序就退出了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">n</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;task&quot;</span>, n)<br>    time.sleep(<span class="hljs-number">1</span>)       <span class="hljs-comment">#此时子线程停1s</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;3&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;2&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;1&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    t = threading.Thread(target=run, args=(<span class="hljs-string">&quot;t1&quot;</span>,))<br>    t.setDaemon(<span class="hljs-literal">True</span>)   <span class="hljs-comment">#把子进程设置为守护线程，必须在start()之前设置</span><br>    t.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;end&quot;</span>)<br>    <br>----------------------------------<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>task t1<br><span class="hljs-meta">&gt;&gt;&gt; </span>end<br></code></pre></td></tr></table></figure><p>我们可以发现，设置守护线程之后，当主线程结束时，子线程也将立即结束，不再执行。</p><h4 id="主线程等待子线程结束"><a href="#主线程等待子线程结束" class="headerlink" title="主线程等待子线程结束"></a>主线程等待子线程结束</h4><p>为了让守护线程执行结束之后，主线程再结束，我们可以使用join方法，让主线程等待子线程执行。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">n</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;task&quot;</span>, n)<br>    time.sleep(<span class="hljs-number">1</span>)       <span class="hljs-comment">#此时子线程停1s</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;3&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;2&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;1&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    t = threading.Thread(target=run, args=(<span class="hljs-string">&quot;t1&quot;</span>,))<br>    t.setDaemon(<span class="hljs-literal">True</span>)   <span class="hljs-comment">#把子进程设置为守护线程，必须在start()之前设置</span><br>    t.start()<br>    t.join() <span class="hljs-comment"># 设置主线程等待子线程结束</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;end&quot;</span>)<br><br>----------------------------------<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>task t1<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">3</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">2</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>end<br></code></pre></td></tr></table></figure><h4 id="多线程共享全局变量"><a href="#多线程共享全局变量" class="headerlink" title="多线程共享全局变量"></a>多线程共享全局变量</h4><p>线程是进程的执行单元，进程是系统分配资源的最小单位，所以在同一个进程中的多线程是共享资源的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>g_num = <span class="hljs-number">100</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">work1</span>():</span><br>    <span class="hljs-keyword">global</span> g_num<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        g_num += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;in work1 g_num is : %d&quot;</span> % g_num)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">work2</span>():</span><br>    <span class="hljs-keyword">global</span> g_num<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;in work2 g_num is : %d&quot;</span> % g_num)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    t1 = threading.Thread(target=work1)<br>    t1.start()<br>    time.sleep(<span class="hljs-number">1</span>)<br>    t2 = threading.Thread(target=work2)<br>    t2.start()<br><br>----------------------------------<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">in</span> work1 g_num <span class="hljs-keyword">is</span> : <span class="hljs-number">103</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">in</span> work2 g_num <span class="hljs-keyword">is</span> : <span class="hljs-number">103</span><br></code></pre></td></tr></table></figure><h4 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h4><p>由于线程之间是进行随机调度，并且每个线程可能只执行n条执行之后，当多个线程同时修改同一条数据时可能会出现脏数据，所以，出现了线程锁，即同一时刻允许一个线程执行操作。线程锁用于锁定资源，你可以定义多个锁, 像下面的代码, 当你需要独占某一资源时，任何一个锁都可以锁这个资源，就好比你用不同的锁都可以把相同的一个门锁住是一个道理。</p><p>由于线程之间是进行随机调度，如果有多个线程同时操作一个对象，如果没有很好地保护该对象，会造成程序结果的不可预期，我们也称此为“线程不安全”。</p><p>为了方式上面情况的发生，就出现了互斥锁(Lock)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread,Lock<br><span class="hljs-keyword">import</span> os,time<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">work</span>():</span><br>    <span class="hljs-keyword">global</span> n<br>    lock.acquire()<br>    temp=n<br>    time.sleep(<span class="hljs-number">0.1</span>)<br>    n=temp-<span class="hljs-number">1</span><br>    lock.release()<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    lock=Lock()<br>    n=<span class="hljs-number">100</span><br>    l=[]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        p=Thread(target=work)<br>        l.append(p)<br>        p.start()<br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> l:<br>        p.join()<br></code></pre></td></tr></table></figure><h4 id="递归锁"><a href="#递归锁" class="headerlink" title="递归锁"></a>递归锁</h4><p>RLcok类的用法和Lock类一模一样，但它支持嵌套，在多个锁没有释放的时候一般会使用RLcok类。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Func</span>(<span class="hljs-params">lock</span>):</span><br>    <span class="hljs-keyword">global</span> gl_num<br>    lock.acquire()<br>    gl_num += <span class="hljs-number">1</span><br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(gl_num)<br>    lock.release()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    gl_num = <span class="hljs-number">0</span><br>    lock = threading.RLock()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        t = threading.Thread(target=Func, args=(lock,))<br>        t.start()<br></code></pre></td></tr></table></figure><h4 id="信号量（BoundedSemaphore类"><a href="#信号量（BoundedSemaphore类" class="headerlink" title="信号量（BoundedSemaphore类)"></a>信号量（BoundedSemaphore类)</h4><p>互斥锁同时只允许一个线程更改数据，而Semaphore是同时允许一定数量的线程更改数据 ，比如厕所有3个坑，那最多只允许3个人上厕所，后面的人只能等里面有人出来了才能再进去。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">n, semaphore</span>):</span><br>    semaphore.acquire()   <span class="hljs-comment">#加锁</span><br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;run the thread:%s\n&quot;</span> % n)<br>    semaphore.release()     <span class="hljs-comment">#释放</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    num = <span class="hljs-number">0</span><br>    semaphore = threading.BoundedSemaphore(<span class="hljs-number">5</span>)  <span class="hljs-comment"># 最多允许5个线程同时运行</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">22</span>):<br>        t = threading.Thread(target=run, args=(<span class="hljs-string">&quot;t-%s&quot;</span> % i, semaphore))<br>        t.start()<br>    <span class="hljs-keyword">while</span> threading.active_count() != <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># print threading.active_count()</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-----all threads done-----&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="事件（Event类）"><a href="#事件（Event类）" class="headerlink" title="事件（Event类）"></a>事件（Event类）</h4><p>python线程的事件用于主线程控制其他线程的执行，事件是一个简单的线程同步对象，其主要提供以下几个方法：</p><ul><li>clear 将flag设置为“False”</li><li>set 将flag设置为“True”</li><li>is_set 判断是否设置了flag</li><li>wait 会一直监听flag，如果没有检测到flag就一直处于阻塞状态</li></ul><p>事件处理的机制：全局定义了一个“Flag”，当flag值为“False”，那么event.wait()就会阻塞，当flag值为“True”，那么event.wait()便不再阻塞。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#利用Event类模拟红绿灯</span><br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br>event = threading.Event()<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lighter</span>():</span><br>    count = <span class="hljs-number">0</span><br>    event.<span class="hljs-built_in">set</span>()     <span class="hljs-comment">#初始值为绿灯</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-number">5</span> &lt; count &lt;=<span class="hljs-number">10</span> :<br>            event.clear()  <span class="hljs-comment"># 红灯，清除标志位</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\33[41;1mred light is on...\033[0m&quot;</span>)<br>        <span class="hljs-keyword">elif</span> count &gt; <span class="hljs-number">10</span>:<br>            event.<span class="hljs-built_in">set</span>()  <span class="hljs-comment"># 绿灯，设置标志位</span><br>            count = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\33[42;1mgreen light is on...\033[0m&quot;</span>)<br><br>        time.sleep(<span class="hljs-number">1</span>)<br>        count += <span class="hljs-number">1</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">car</span>(<span class="hljs-params">name</span>):</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">if</span> event.is_set():      <span class="hljs-comment">#判断是否设置了标志位</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[%s] running...&quot;</span>%name)<br>            time.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[%s] sees red light,waiting...&quot;</span>%name)<br>            event.wait()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[%s] green light is on,start going...&quot;</span>%name)<br><br>light = threading.Thread(target=lighter,)<br>light.start()<br><br>car = threading.Thread(target=car,args=(<span class="hljs-string">&quot;MINI&quot;</span>,))<br>car.start()<br></code></pre></td></tr></table></figure><h4 id="获取线程返回值"><a href="#获取线程返回值" class="headerlink" title="获取线程返回值"></a>获取线程返回值</h4><p>threading 执行函数后无法执行 return，在需要返回值的函数中有些不方便</p><p>解决这个问题的核心思路是创建全局变量，收集线程们运行后返回的结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">num_adder</span>(<span class="hljs-params">num, res</span>):</span><br>    res[<span class="hljs-number">0</span>] += num<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    threading_list = <span class="hljs-built_in">list</span>()<br>    result = [<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        t = threading.Thread(target=num_adder, args=(num+<span class="hljs-number">1</span>, result, ))<br>        threading_list.append(t)<br>        t.start()<br><br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threading_list:<br>        t.join()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><blockquote><p>输出 1 到 100 的累加和值 5050</p><p>由于python的 GIL 机制，使得我们只能使用单核的CPU，同一时间只会有一个线程操作数据，反而不用担心线程安全的问题（不过保险起见还是加个锁的好）</p></blockquote><h3 id="GIL（Global-Interpreter-Lock）全局解释器锁"><a href="#GIL（Global-Interpreter-Lock）全局解释器锁" class="headerlink" title="GIL（Global Interpreter Lock）全局解释器锁"></a>GIL（Global Interpreter Lock）全局解释器锁</h3><p>在非python环境中，单核情况下，同时只能有一个任务执行。多核时可以支持多个线程同时执行。但是在python中，无论有多少核，同时只能执行一个线程。究其原因，这就是由于GIL的存在导致的。</p><p>GIL的全称是Global Interpreter Lock(全局解释器锁)，来源是python设计之初的考虑，为了数据安全所做的决定。某个线程想要执行，必须先拿到GIL，我们可以把GIL看作是“通行证”，并且在一个python进程中，GIL只有一个。拿不到通行证的线程，就不允许进入CPU执行。GIL只在cpython中才有，因为cpython调用的是c语言的原生线程，所以他不能直接操作cpu，只能利用GIL保证同一时间只能有一个线程拿到数据。而在pypy和jpython中是没有GIL的。</p><p>Python多线程的工作过程：<br>python在使用多线程的时候，调用的是c语言的原生线程。</p><ul><li>拿到公共数据</li><li>申请gil</li><li>python解释器调用os原生线程</li><li>os操作cpu执行运算</li><li>当该线程执行时间到后，无论运算是否已经执行完，gil都被要求释放</li><li>进而由其他进程重复上面的过程</li><li>等其他进程执行完后，又会切换到之前的线程（从他记录的上下文继续执行），整个过程是每个线程执行自己的运算，当执行时间到就进行切换（context switch）。</li></ul><p><strong>python针对不同类型的代码执行效率也是不同的：</strong></p><p>1、CPU密集型代码(各种循环处理、计算等等)，在这种情况下，由于计算工作多，ticks计数很快就会达到阈值，然后触发GIL的释放与再竞争（多个线程来回切换当然是需要消耗资源的），所以python下的多线程对CPU密集型代码并不友好。<br>2、IO密集型代码(文件处理、网络爬虫等涉及文件读写的操作)，多线程能够有效提升效率(单线程下有IO操作会进行IO等待，造成不必要的时间浪费，而开启多线程能在线程A等待时，自动切换到线程B，可以不浪费CPU的资源，从而能提升程序执行效率)。所以python的多线程对IO密集型代码比较友好。</p><p><strong>使用建议？</strong></p><p>python下想要充分利用多核CPU，就用多进程。因为每个进程有各自独立的GIL，互不干扰，这样就可以真正意义上的并行执行，在python中，多进程的执行效率优于多线程(仅仅针对多核CPU而言)。</p><p><strong>GIL在python中的版本差异：</strong></p><p>1、在python2.x里，GIL的释放逻辑是当前线程遇见IO操作或者ticks计数达到100时进行释放。（ticks可以看作是python自身的一个计数器，专门做用于GIL，每次释放后归零，这个计数可以通过sys.setcheckinterval 来调整）。而每次释放GIL锁，线程进行锁竞争、切换线程，会消耗资源。并且由于GIL锁存在，python里一个进程永远只能同时执行一个线程(拿到GIL的线程才能执行)，这就是为什么在多核CPU上，python的多线程效率并不高。<br>2、在python3.x中，GIL不使用ticks计数，改为使用计时器（执行时间达到阈值后，当前线程释放GIL），这样对CPU密集型程序更加友好，但依然没有解决GIL导致的同一时间只能执行一个线程的问题，所以效率依然不尽如人意。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/luyuze95/p/11289143.html">https://www.cnblogs.com/luyuze95/p/11289143.html</a></li><li><a href="https://blog.csdn.net/qq_37174526/article/details/92414970">https://blog.csdn.net/qq_37174526/article/details/92414970</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>numpy 和 pytorch tensor 的内存连续性 contiguous</title>
    <link href="/2021/08/02/deep_learning/numpy-tensor-contiguous/numpy-tensor-contiguous/"/>
    <url>/2021/08/02/deep_learning/numpy-tensor-contiguous/numpy-tensor-contiguous/</url>
    
    <content type="html"><![CDATA[<blockquote><p>numpy 和 pytorch tensor 存在内存是否连续的情况，对运行速度甚至网络运行结果都存在影响。</p></blockquote><span id="more"></span><h3 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h3><ul><li><strong>contiguous</strong> 本身是形容词<strong>，</strong>表示连续的。所谓<code>contiguous array</code>，指的是数组在内存中存放的地址也是连续的（注意内存地址实际是一维的），即访问数组中的下一个元素，直接移动到内存中的下一个地址就可以。</li><li>在numpy和torch的数据结构中，都有表示变量是否在内存中数据连续存储的概念。</li><li>连续存储又分为按照<strong>行优先（</strong>C order<strong>）</strong>和按照<strong>列优先（</strong>Fortran order<strong>）</strong></li></ul><h4 id="行优先-C-order"><a href="#行优先-C-order" class="headerlink" title="行优先  C order"></a>行优先  <strong>C order</strong></h4><p>行是指多维数组一维展开的方式，对应的是列优先。C/C++中使用的是行优先方式（row major），Matlab、Fortran使用的是列优先方式（column major），PyTorch中Tensor底层实现是C，也是使用行优先顺序，因此也称为 <code>C order</code>。</p><ul><li>Pascal, C，C++，Python都是行优先存储的。</li></ul><h4 id="列优先-Fortran-order"><a href="#列优先-Fortran-order" class="headerlink" title="列优先 Fortran order"></a>列优先 <strong>Fortran order</strong></h4><p>而<code>Fortran Order</code>则指的是列优先的顺序（Column-major Order)，即内存中同列的元素存在一起。</p><ul><li>Fortran，MatLab是列优先存储的。</li></ul><h3 id="数据举例"><a href="#数据举例" class="headerlink" title="数据举例"></a>数据举例</h3><h4 id="行优先"><a href="#行优先" class="headerlink" title="行优先"></a>行优先</h4><p>考虑一个2维数组<code>arr = np.arange(12).reshape(3,4)</code>。这个数组看起来结构是这样的：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210803165543.png"></p><p>在计算机的内存里，数组<code>arr</code>实际存储是像下图所示的：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210803165644.png"></p><p>这意味着<code>arr</code>是<code>C连续的</code>（<code>C contiguous</code>)的，因为在内存是行优先的，即某个元素在内存中的下一个位置存储的是它同行的下一个值。</p><blockquote><p>如果想要向下移动一列，则只需要跳过3个块既可（例如，从0到4只需要跳过1,2和3）。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    arr = np.arange(<span class="hljs-number">12</span>).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br>    <span class="hljs-built_in">print</span>(arr.flags)<br>    <span class="hljs-built_in">print</span>(arr)<br><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><ul><li>输出：</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml">  <span class="hljs-attr">C_CONTIGUOUS :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">F_CONTIGUOUS :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">OWNDATA :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">WRITEABLE :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">ALIGNED :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">WRITEBACKIFCOPY :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">UPDATEIFCOPY :</span> <span class="hljs-literal">False</span><br><br>[[ <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>]<br> [ <span class="hljs-number">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">6</span>  <span class="hljs-number">7</span>]<br> [ <span class="hljs-number">8</span>  <span class="hljs-number">9</span> <span class="hljs-number">10</span> <span class="hljs-number">11</span>]]<br></code></pre></td></tr></table></figure><ul><li>C_CONTIGUOUS 为 True 表示该矩阵行连续</li></ul><blockquote><p>也就是其中的行 [ 0  1  2  3] 在内存中连续，那么 [0 4 8] 就不会连续了，因此 F_CONTIGUOUS 为 False</p></blockquote><h4 id="列优先"><a href="#列优先" class="headerlink" title="列优先"></a>列优先</h4><p>上述数组的转置<code>arr.T</code>则没有了C连续特性，因为同一行中的相邻元素现在并不是在内存中相邻存储的了:</p><p><img src="https://photos.zywvvd.com/win11-mt/20210803171239.png"></p><blockquote><p>这里要说明一下，如果直接用这些值创建的numpy变量是连续的，因为Python默认 C order，新创建的numpy都是行优先的</p><p>但是我们创建arr时是以 0 - 11 为顺序创建的，其中[0 1 2 3] [4 5 6 7] [8 9 10 11]连续，矩阵转置后只改变引用，内存数据并不发生变化</p><p>类似的操作如numpy 的 <code>slice</code>、<code>transpose</code>、<code>转置</code> 或 tensor中的 <code>permute</code> 等操作都可能导致改变之前数据与内存的行连续状况</p></blockquote><ul><li>转置后，内存上仍然是 [0 1 2 3] [4 5 6 7] [8 9 10 11]连续，在当前矩阵上就是列连续，因此这是个Fortran order 连续的矩阵</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    arr = np.arange(<span class="hljs-number">12</span>).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br>    arr = arr.T<br>    <span class="hljs-built_in">print</span>(arr.flags)<br>    <span class="hljs-built_in">print</span>(arr)<br><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><ul><li>输出：</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml">  <span class="hljs-attr">C_CONTIGUOUS :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">F_CONTIGUOUS :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">OWNDATA :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">WRITEABLE :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">ALIGNED :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">WRITEBACKIFCOPY :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">UPDATEIFCOPY :</span> <span class="hljs-literal">False</span><br><br>[[ <span class="hljs-number">0</span>  <span class="hljs-number">4</span>  <span class="hljs-number">8</span>]<br> [ <span class="hljs-number">1</span>  <span class="hljs-number">5</span>  <span class="hljs-number">9</span>]<br> [ <span class="hljs-number">2</span>  <span class="hljs-number">6</span> <span class="hljs-number">10</span>]<br> [ <span class="hljs-number">3</span>  <span class="hljs-number">7</span> <span class="hljs-number">11</span>]]<br></code></pre></td></tr></table></figure><h3 id="查看连续性"><a href="#查看连续性" class="headerlink" title="查看连续性"></a>查看连续性</h3><h4 id="numpy"><a href="#numpy" class="headerlink" title="numpy"></a>numpy</h4><ul><li>可以使用 <code>data.contiguous</code> 、<code>data.c_contiguous</code>、 <code>data.f_contiguous</code> 属性</li><li>或者使用 <code>flags</code> 属性</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    arr = np.arange(<span class="hljs-number">12</span>).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br><br>    <span class="hljs-built_in">print</span>(arr.data.contiguous)  <span class="hljs-comment"># True</span><br>    <span class="hljs-built_in">print</span>(arr.data.c_contiguous)  <span class="hljs-comment"># True</span><br>    <span class="hljs-built_in">print</span>(arr.data.f_contiguous)  <span class="hljs-comment"># False</span><br><br>    <span class="hljs-built_in">print</span>(arr.flags)<br>    <span class="hljs-built_in">print</span>(arr)<br><br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><ul><li>输出</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-literal">True</span><br><span class="hljs-literal">True</span><br><span class="hljs-literal">False</span><br>  <span class="hljs-attr">C_CONTIGUOUS :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">F_CONTIGUOUS :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">OWNDATA :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">WRITEABLE :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">ALIGNED :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">WRITEBACKIFCOPY :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">UPDATEIFCOPY :</span> <span class="hljs-literal">False</span><br><br>[[ <span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>]<br> [ <span class="hljs-number">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">6</span>  <span class="hljs-number">7</span>]<br> [ <span class="hljs-number">8</span>  <span class="hljs-number">9</span> <span class="hljs-number">10</span> <span class="hljs-number">11</span>]]<br></code></pre></td></tr></table></figure><h4 id="pytorch"><a href="#pytorch" class="headerlink" title="pytorch"></a>pytorch</h4><ul><li>pytorch 的 tensor 有方法 <code>is_contiguous</code> 用来查看是否 C 连续</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    arr = np.arange(<span class="hljs-number">12</span>).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br>    ten = torch.from_numpy(arr)<br><br>    <span class="hljs-built_in">print</span>(ten.is_contiguous())  <span class="hljs-comment"># True</span><br><br>    ten_t = torch.from_numpy(arr.T)<br>    <span class="hljs-built_in">print</span>(ten_t.is_contiguous())  <span class="hljs-comment"># False</span><br><br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><ul><li>输出</li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-literal">True</span><br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><h3 id="产生的影响"><a href="#产生的影响" class="headerlink" title="产生的影响"></a>产生的影响</h3><h4 id="性能影响"><a href="#性能影响" class="headerlink" title="性能影响"></a>性能影响</h4><p>从性能上来说，获取内存中相邻的地址比不相邻的地址速度要快很多（从RAM读取一个数值的时候可以连着一起读一块地址中的数值，并且可以保存在Cache中），这意味着对连续数组的操作会快很多。</p><blockquote><p>由于<code>arr</code>是C连续的，因此对其进行行操作比进行列操作速度要快</p><p>通常来说</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">np.<span class="hljs-built_in">sum</span>(arr, axis=<span class="hljs-number">1</span>) <span class="hljs-comment"># 按行求和</span><br></code></pre></td></tr></table></figure><p>会比</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">np.<span class="hljs-built_in">sum</span>(arr, axis=<span class="hljs-number">0</span>) <span class="hljs-comment"># 按列求和</span><br></code></pre></td></tr></table></figure><p>稍微快些。</p><p>同理，在<code>arr.T</code>上，列操作比行操作会快些。</p></blockquote><h4 id="结果影响"><a href="#结果影响" class="headerlink" title="结果影响"></a>结果影响</h4><blockquote><p>其实写这篇博客的原因，就是我的onnx模型对于完全相同数据的tensor产生了完全不同的表现，险些三观俱碎。挣扎了几个小时后发现原来是数据的连续性在作祟。</p></blockquote><ul><li>对 pyhton 中算法平台的影响</li></ul><table><thead><tr><th>平台</th><th>影响</th></tr></thead><tbody><tr><td>numpy</td><td>计算不连续的变量，结果不会受到影响</td></tr><tr><td>pytorch</td><td>输入不连续的tensor，结果不会受到影响</td></tr><tr><td>onnx</td><td>输入不连续的tensor，<strong>结果直接爆炸</strong></td></tr></tbody></table><ul><li>在 python 的 tensor 中，如果不是C连续的tensor，在执行 <code>view</code> 方法时会报错：</li></ul><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">invalid argument <span class="hljs-number">2</span>: <span class="hljs-built_in">view</span> size <span class="hljs-built_in">is</span> <span class="hljs-keyword">not</span> compatible with input tensor&#x27;s size <span class="hljs-keyword">and</span> stride (<span class="hljs-built_in">at</span> least one <span class="hljs-built_in">dimension</span> <br>spans across two contiguous subspaces). Call .contiguous() before .<span class="hljs-built_in">view</span>(). <br></code></pre></td></tr></table></figure><ul><li>在 numpy 中某些需要连续的操作在遇到不连续的变量时也会报错：</li></ul><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">ValueError: some of the strides of a given numpy<span class="hljs-built_in"> array </span>are negative.<br>This is currently<span class="hljs-built_in"> not </span>supported, but will be added in future releases.<br></code></pre></td></tr></table></figure><h4 id="连带影响"><a href="#连带影响" class="headerlink" title="连带影响"></a>连带影响</h4><ul><li>不连续的numpy转为tensor后也是不连续的</li><li>不连续的tensor转为numpy后也是不连续的</li></ul><h3 id="修正连续性"><a href="#修正连续性" class="headerlink" title="修正连续性"></a>修正连续性</h3><p>变量可以通过重新开辟空间，将数据连续拷贝进去的方法将不连续的数据变成某种连续方式。</p><h4 id="numpy-1"><a href="#numpy-1" class="headerlink" title="numpy"></a>numpy</h4><ul><li>numpy 变量中连续性可以用自带的函数修正，不连续的变量通过函数 <code>np.ascontiguousarray(arr)</code>变为C连续，<code>np.asfortranarray(arr)</code>变为Fortran连续</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    arr = np.arange(<span class="hljs-number">12</span>).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(arr.data.c_contiguous)  <span class="hljs-comment"># True arr C连续</span><br><br>    tran_arr = arr.transpose(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(tran_arr.data.contiguous)  <span class="hljs-comment"># False tran_arr不连续</span><br><br>    c_arr = np.ascontiguousarray(tran_arr)  <span class="hljs-comment"># 变为 C 连续</span><br>    <span class="hljs-built_in">print</span>(c_arr.flags)<br><br>    f_arr = np.asfortranarray(tran_arr)  <span class="hljs-comment"># 变为 Fortran 连续</span><br>    <span class="hljs-built_in">print</span>(f_arr.flags)<br><br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><ul><li>输出：</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-literal">True</span><br><span class="hljs-literal">False</span><br>  <span class="hljs-attr">C_CONTIGUOUS :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">F_CONTIGUOUS :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">OWNDATA :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">WRITEABLE :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">ALIGNED :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">WRITEBACKIFCOPY :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">UPDATEIFCOPY :</span> <span class="hljs-literal">False</span><br><br>  <span class="hljs-attr">C_CONTIGUOUS :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">F_CONTIGUOUS :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">OWNDATA :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">WRITEABLE :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">ALIGNED :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">WRITEBACKIFCOPY :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">UPDATEIFCOPY :</span> <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><h4 id="pytorch-1"><a href="#pytorch-1" class="headerlink" title="pytorch"></a>pytorch</h4><ul><li>pytorch 的 tensor 在python中运行，需要C连续的变量，因此只有C连续的函数 <code>contiguous()</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    arr = np.arange(<span class="hljs-number">12</span>).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br><br>    tran_arr = arr.transpose(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(tran_arr.data.contiguous)  <span class="hljs-comment"># False tran_arr不连续</span><br><br>    ten = torch.from_numpy(tran_arr)<br>    <span class="hljs-built_in">print</span>(ten.is_contiguous())  <span class="hljs-comment"># False 不连续的numpy产生不连续的tensor</span><br><br>    c_ten = ten.contiguous()<br>    <span class="hljs-built_in">print</span>(c_ten.is_contiguous())  <span class="hljs-comment"># True Tensor变成连续的</span><br><br>    c_ten_arr = c_ten.numpy()<br>    <span class="hljs-built_in">print</span>(c_ten_arr.flags)  <span class="hljs-comment"># tensor 的连续函数结果是变成C连续的变量</span><br><br>    <span class="hljs-keyword">pass</span><br><br></code></pre></td></tr></table></figure><ul><li>输出</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-literal">False</span><br><span class="hljs-literal">False</span><br><span class="hljs-literal">True</span><br>  <span class="hljs-attr">C_CONTIGUOUS :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">F_CONTIGUOUS :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">OWNDATA :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">WRITEABLE :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">ALIGNED :</span> <span class="hljs-literal">True</span><br>  <span class="hljs-attr">WRITEBACKIFCOPY :</span> <span class="hljs-literal">False</span><br>  <span class="hljs-attr">UPDATEIFCOPY :</span> <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/64551412">https://zhuanlan.zhihu.com/p/64551412</a></li><li><a href="https://www.cnblogs.com/peixu/articles/13455350.html">https://www.cnblogs.com/peixu/articles/13455350.html</a></li><li><a href="https://www.cnblogs.com/sdu20112013/p/11981793.html">https://www.cnblogs.com/sdu20112013/p/11981793.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/59767914">https://zhuanlan.zhihu.com/p/59767914</a></li><li><a href="https://stackoverflow.com/questions/51304154/check-if-numpy-array-is-contiguous">https://stackoverflow.com/questions/51304154/check-if-numpy-array-is-contiguous</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>deep_learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>deep_learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Node.js npm 安装包 unable to verify the first certificate 错误解决方案</title>
    <link href="/2021/08/02/tools/nodejs-install-error/nodejs-install-error/"/>
    <url>/2021/08/02/tools/nodejs-install-error/nodejs-install-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>安装 node.js 后可能出现 npm 安装包时报错<code>unable to verify the first certificate</code>的问题，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="错误复现"><a href="#错误复现" class="headerlink" title="错误复现"></a>错误复现</h3><ul><li>npm 命令安装包时失败报错</li></ul><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs hsp">npm <span class="hljs-keyword">ERR</span>! code UNABLE_TO_VERIFY_LEAF_SIGNATURE<br>npm <span class="hljs-keyword">ERR</span>! errno UNABLE_TO_VERIFY_LEAF_SIGNATURE<br>npm <span class="hljs-keyword">ERR</span>! request to https:<span class="hljs-comment">//registry.npm.taobao.org/vant failed, reason: unable to verify the first certificate</span><br></code></pre></td></tr></table></figure><h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">As</span> of February <span class="hljs-number">27</span>, <span class="hljs-number">2014</span>, npm no longer supports its self-signed certificates.<br></code></pre></td></tr></table></figure><p>2014年2月27日，npm不再支持自签名证书。因为npm install走的是https协议，需要通过数字证书来保证的。</p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>暂时取消ssl验证</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm<span class="hljs-built_in"> config </span><span class="hljs-builtin-name">set</span> strict-ssl <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><ul><li>随后可以正常安装包，之后可以再开启</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm<span class="hljs-built_in"> config </span><span class="hljs-builtin-name">set</span> strict-ssl <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><ul><li>如果还没有成功，npm源更换为国内镜像：</li></ul><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs tcl">npm config <span class="hljs-keyword">set</span> <span class="hljs-keyword">registry</span> <span class="hljs-keyword">http</span>://<span class="hljs-keyword">registry</span>.cnpmjs.org/<br>npm config <span class="hljs-keyword">set</span> <span class="hljs-keyword">registry</span> <span class="hljs-keyword">http</span>://<span class="hljs-keyword">registry</span>.npm.taobao.org/<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/last_sho/article/details/113521910">https://blog.csdn.net/last_sho/article/details/113521910</a></li><li><a href="https://blog.csdn.net/nicexibeidage/article/details/78140692">https://blog.csdn.net/nicexibeidage/article/details/78140692</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>tools</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Markov Chain Monte Carlo 采样算法</title>
    <link href="/2021/08/01/math/mcmc-alg/mcmc-alg/"/>
    <url>/2021/08/01/math/mcmc-alg/mcmc-alg/</url>
    
    <content type="html"><![CDATA[<blockquote><p>作为一种随机采样方法，马尔科夫链蒙特卡罗（Markov Chain Monte Carlo，以下简称MCMC）在机器学习,深度学习以及自然语言处理等领域都有广泛的应用，是很多复杂算法求解的基础，本文介绍基本思想。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>马尔科夫链蒙特卡洛方法(Markov Chain Monte Carlo)，简称MCMC，产生于20世纪50年代早期，是在<a href="https://baike.baidu.com/item/%E8%B4%9D%E5%8F%B6%E6%96%AF">贝叶斯</a>理论框架下，通过计算机进行模拟的<a href="https://baike.baidu.com/item/%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E6%96%B9%E6%B3%95/7239909">蒙特卡洛方法</a>(Monte Carlo)。该方法将马尔科夫(Markov)过程引入到Monte Carlo模拟中，实现抽样分布随模拟的进行而改变的动态模拟，弥补了传统的蒙特卡罗积分只能静态模拟的缺陷。MCMC是一种简单有效的计算方法，在很多领域到广泛的应用，如统计物、贝叶斯(Bayes)问题、计算机问题等。</p><p>——百度百科</p><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>给定连续随机变量 $ X \in \mathcal{X} $ 的概率密度函数 $ \tilde{p}(x) $, 则 $ X $ 在区间 $ \mathbb{A} $ 中的概率可以计算为：<br>$$<br>P(\mathbb{A})=\int_{\mathrm{A}} \tilde{p}(x) d x<br>$$<br>如果函数 $ f: \mathcal{X} \longmapsto \mathbb{R} $, 则可以计算 $ f(X) $ 的期望:</p><p>$$<br>\mathbb{E}_{X \sim \tilde{p}(x)}[f(X)]=\int f(x) \tilde{p}(x) d x<br>$$</p><p>如果 $ X $ 不是一个单变量, 页是一个高维的多元变量 $ \vec{X} $, 且服从一个非常复杂的分布, 则对于上式的求积 分非常困难。为此，MCMC 先构造出服从 $ \tilde{p} $ 分布的独立同分布随机变量 $ \overrightarrow{\mathbf{x}}_{1}, \overrightarrow{\mathbf{x}}_{2}, \cdots, \overrightarrow{\mathbf{x}}_{N}$ ，再得到$ \mathbb{E}_{\vec{X} \sim \tilde{p}(\overrightarrow{\mathbf{x}})}[f(\vec{X})] $​ 的无偏估计:</p>$$\mathbb{E}_{\vec{X} \sim \hat{p}(\vec{x})}[f(\vec{X})]=\frac{1}{N} \sum_{i=1}^{N} f\left(\overrightarrow{\mathbf{x}}_{i}\right)$$<p>如果概率密度函数 $ \tilde{p}(\overrightarrow{\mathbf{x}}) $​ 也很复杂, 则构造服从 $ \tilde{p} $​ 分布的独立同分布随机变量也很困难。 MCMC 方法就是 通过构造平稳分布为 $ \tilde{p}(\overrightarrow{\mathbf{x}}) $​​ 的马尔可夫链来产生样本。</p><h3 id="Metropolis-Hastings-算法"><a href="#Metropolis-Hastings-算法" class="headerlink" title="Metropolis Hastings 算法"></a>Metropolis Hastings 算法</h3><h4 id="基本思想"><a href="#基本思想" class="headerlink" title="基本思想"></a>基本思想</h4><ul><li>先设法构造一条马尔可夫链, 使其收敛到平稳分布恰好为 $ \tilde{p} $ 。然后通过这条马尔可夫链来产生符合 $ \tilde{p} $ 分布的样本。最后通过这些样本来进行估计。</li><li>这里马尔可夫链的构造至关重要，不同的构造方法将产生不同的 MCMC 算法。</li><li>Metropolis-Hastings : MH 算法是 MCMC 的重要代表。</li></ul><h4 id="构造平稳分布转移矩阵"><a href="#构造平稳分布转移矩阵" class="headerlink" title="构造平稳分布转移矩阵"></a>构造平稳分布转移矩阵</h4><ul><li>假设已经提供了一条马尔可夫链，其转移矩阵为$Q$。目标是另一个马尔科夫链，使转移矩阵为$P$、平稳分布是 $ \tilde{p} $ 。</li><li>通常 $ \tilde{p}(i) Q_{i, j} \neq \tilde{p}(j) Q_{j, i} $, 即 $ \tilde{p} $ 并不满足细致平稳条件</li><li>我们需要改造已有的马尔可夫链，使得细致平稳条件成立</li><li>引入一个函数 $ \alpha(i, j) $, 使其满足:</li></ul><p>$$<br>\tilde{p}(i) Q_{i, j} \alpha(i, j)=\tilde{p}(j) Q_{j, i} \alpha(j, i)<br>$$</p><ul><li>可以取 $ \alpha(i, j)=\tilde{p}(j) Q_{j, i} $​, 则有:</li></ul><p>$$<br>\tilde{p}(i) Q_{i, j} \alpha(i, j)=\tilde{p}(i) Q_{i, j} \tilde{p}(j) Q_{j, i}=\tilde{p}(j) Q_{j, i} \tilde{p}(i) Q_{i, j}=\tilde{p}(j) Q_{j, i} \alpha(j, i)<br>$$</p><ul><li>令： $ Q_{i, j}^{\prime}=Q_{i, j} \alpha(i, j), Q_{j, i}^{\prime}=Q_{j, i} \alpha(j, i) $, 则有 $ \tilde{p}(i) Q_{i, j}^{\prime}=\tilde{p}(j) Q_{j, i}^{\prime} $其中 $ Q_{i, j}^{\prime} $ 构成了转移矩阵 $ \mathbf{Q}^{\prime} $。而 $ \mathbf{Q}^{\prime} $ 满足细致平稳条件，因此它对应的马尔可夫链的平稳分布就是 $ \tilde{p} $​ 。</li></ul><h5 id="接受率"><a href="#接受率" class="headerlink" title="接受率"></a>接受率</h5><p>在改造 $ \mathbf{Q} $ 的过程中引入的 $ \alpha(i, j) $ 称作接受率。</p><ul><li>其物理意义为: 在原来的马尔可夫链上，从状态 $ i $ 以 $ Q_{i, j} $ 的概率跳转到状态$j$的时候，以$ \alpha(i, j) $​的概率接受这个转移。</li><li>如果接受率$ \alpha(i, j) $太小，则改造马尔可夫链过程中非常容易原地踏步，拒绝大量的跳转。</li><li>这样使得马尔可夫链遍历所有的状态空间需要花费太长的时间，收敛到平稳分布$ \tilde{p} $的速度太慢。</li><li>根据推导 $ \alpha(i, j)=\tilde{p}(j) Q_{j, i} $, 如果将系数从 1 提高到 $ K $​, 则有:</li></ul>$$\begin{aligned}\alpha^{*}(i, j)=K \tilde{p}(j) Q_{j, i} &=K \alpha(i, j) \\\alpha^{*}(j, i)=K \tilde{p}(i) Q_{i, j} &=K \alpha(j, i)\end{aligned}$$<ul><li>于是有: </li></ul>$$\tilde{p}(i) Q_{i, j} \alpha^{*}(i, j)=K \tilde{p}(i) Q_{i, j} \alpha(i, j)=K \tilde{p}(j) Q_{j, i} \alpha(j, i)=\tilde{p}(j) Q_{j, i} \alpha^{*}(j, i)$$<ul><li>因此，即使提高了接受率, 细致平稳条件仍然成立。</li></ul><p>将 $ \alpha(i, j), \alpha(j, i) $ 同比例放大, 取: $ \alpha(i, j)=\min \left\{\frac{\tilde{p}(j) Q_{j, i}}{\tilde{p}(i) Q_{i, j}}, 1\right\} $ 。</p><ul><li>当$ \tilde{p}(j) Q_{j, i}=\tilde{p}(i) Q_{i, j} $ 时： $ \alpha(i, j)=\alpha(j, i)=1 $, 此时满足细致平稳条件。</li><li>当$ \tilde{p}(j) Q_{j, i}&gt;\tilde{p}(i) Q_{i, j} $ 时： $ \alpha(i, j)=1, \alpha(j, i)=\frac{\tilde{p}(i) Q_{i, j}}{\tilde{p}(j) Q_{j, i}} $, 此时满足细致平稳条件。</li><li>当$ \tilde{p}(j) Q_{j, i}&lt;\tilde{p}(i) Q_{i, j} $ 时： $ \alpha(i, j)=\frac{\tilde{p}(j) Q_{j, j}}{\tilde{p}(i) Q_{i, j}}, \alpha(j, i)=1 $, 此时满足细致平稳条件。</li></ul><h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><p>输入:</p><ol><li><p>先验转移概率矩阵$Q$</p></li><li><p>目标分布 $ \tilde{p} $</p></li></ol><p>输出: 采样出的一个状态序列 $ \left\{x_{0}, x_{1}, \cdots, x_{n}, x_{n+1}, \cdots\right\} $</p><h5 id="算法步骤："><a href="#算法步骤：" class="headerlink" title="算法步骤："></a>算法步骤：</h5><ul><li><p>初始化 $ x_{0} $</p></li><li><p>对 $ t=1,2, \cdots $ 执行迭代</p></li><li><p>迭代步骤:</p><ul><li>根据$ Q\left(x^{*} \mid x_{t-1}\right) $采样出候选样本$  x^{*} $, 其中 $ Q $ 为转移概率函数。</li><li>计算 $ \alpha\left(x^{*} \mid x_{t-1}\right) $​​ :</li></ul>  $$  \alpha\left(x^{*} \mid x_{t-1}\right)=\min \left(1, \frac{\tilde{p}\left(x^{*}\right) Q\left(x_{t-1} \mid x^{*}\right)}{\tilde{p}\left(x_{t-1}\right) Q\left(x^{*} \mid x_{t-1}\right)}\right)  $$  <ul><li>根据均匀分布从 $ (0,1) $ 内采样出阈值 $ u $, 如果 $ u \leq \alpha\left(x^{*} \mid x_{t-1}\right) $, 则接受 $ x^{*} $, 即 $ x_{t}=x^{*} $ 。否</li><li>返回采样得到的序列 $ \left\{x_{0}, x_{1}, \cdots, x_{n}, x_{n+1}, \cdots\right\} $​</li></ul></li><li><p><strong>注意</strong>：返回的序列中，只有充分大的 $ n $ 之后的序列 $ \left\{x_{n}, x_{n+1}, \cdots\right\} $ sss才是服从 $ \tilde{p} $ 分布的采样序列。</p></li></ul><h3 id="Gibbs-算法"><a href="#Gibbs-算法" class="headerlink" title="Gibbs 算法"></a>Gibbs 算法</h3><blockquote><p>MH 算法不仅可以应用于一维空间的采样，也适合高维空间的采样。<br>对于高维的情况，由于接受率 $ \alpha $ 的存在 (通常 $ \alpha&lt;1) $ ， MH 算法的效率通常不够高, 此时一般使用 Gibbs 采样算法。</p></blockquote><ul><li>考虑二维的情形：假设有概率分布$ \tilde{p}(x, y) $​, 考察状态空间上 $ x $​ 坐标相同的两个点 $ A\left(x_{1}, y_{1}\right), B\left(x_{1}, y_{2}\right) $​，可以证明有:</li></ul>$$\begin{array}{l}\tilde{p}\left(x_{1}, y_{1}\right) \tilde{p}\left(y_{2} \mid x_{1}\right)=\tilde{p}\left(x_{1}\right) \tilde{p}\left(y_{1} \mid x_{1}\right) \tilde{p}\left(y_{2} \mid x_{1}\right) \\\tilde{p}\left(x_{1}, y_{2}\right) \tilde{p}\left(y_{1} \mid x_{1}\right)=\tilde{p}\left(x_{1}\right) \tilde{p}\left(y_{2} \mid x_{1}\right) \tilde{p}\left(y_{1} \mid x_{1}\right)\end{array}$$<ul><li>于是有：</li></ul><p>$$<br>\tilde{p}\left(x_{1}, y_{1}\right) \tilde{p}\left(y_{2} \mid x_{1}\right)=\tilde{p}\left(x_{1}, y_{2}\right) \tilde{p}\left(y_{1} \mid x_{1}\right)<br>$$</p><ul><li><p>则在 $ x=x_{1} $​ 这条平行于 $ y $​ 轴的直线上，如果使用条件分布 $ \tilde{p}\left(y \mid x_{1}\right) $​ 作为直线上任意两点之间的转移概率, 则这两点之间的转移满足细致平稳条件。</p></li><li><p>同理: 考察 $ y $​ 坐标相同的两个点 $ A\left(x_{1}, y_{1}\right), C\left(x_{2}, y_{1}\right) $​, 有 $ \tilde{p}\left(x_{1}, y_{1}\right) \tilde{p}\left(x_{2} \mid y_{1}\right)=\tilde{p}\left(x_{2}, y_{1}\right) \tilde{p}\left(x_{1} \mid y_{1}\right) $​ 。在$ y=y_{1} $​ 这条平行于 $ x $​ 轴的直线上，如果使用条件分布 $ \tilde{p}\left(x \mid y_{1}\right) $​​ 作为直线上任意两点之间的转移概率, 则这 两点之间的转移满足细致平稳条件。</p></li><li><p>可以构造状态空间上任意两点之间的转移概率矩阵$ \mathbf{Q}: $ 对于任意两点 $ A=\left(x_{A}, y_{A}\right), B=\left(x_{B}, y_{B}\right), \quad $​ 令从$ A $ 转移到 $ B $ 的概率为 $ Q(A \rightarrow B) $​ :</p><ul><li>如果 $ x_{A}=x_{B}=x^{*} $, 则 $ Q(A \rightarrow B)=\tilde{p}\left(y_{B} \mid x^{*}\right) $ 。</li><li>如果 $ y_{A}=y_{B}=y^{*} $, 则 $ Q(A \rightarrow B)=\tilde{p}\left(x_{B} \mid y^{*}\right) $ 。</li><li>否则 $ Q(A \rightarrow B)=0 $​​ 。</li></ul></li><li><p>采用该转移矩阵$Q$，可以证明：对于状态空间中任意两点$A,B$ ，都满足细致平稳条件：</p></li></ul><p>$$<br>\tilde{p}(A) Q(A \rightarrow B)=\tilde{p}(B) Q(B \rightarrow A)<br>$$</p><ul><li>于是这个二维状态空间上的马尔可夫链将收敛到平稳分布 $ \tilde{p}(x, y) $​, 这就是吉布斯采样的原理。</li></ul><h4 id="算法-1"><a href="#算法-1" class="headerlink" title="算法:"></a>算法:</h4><p>输入：目标分布 $ \tilde{p}(\overrightarrow{\mathbf{x}}) $, 其中 $ \overrightarrow{\mathbf{x}} \in \mathbb{R}^{n} $</p><p>输出: 采样出的一个状态序列 $ \left\{\overrightarrow{\mathbf{x}}_{0}, \overrightarrow{\mathbf{x}}_{1}, \cdots\right\} $</p><h5 id="算法步骤：-1"><a href="#算法步骤：-1" class="headerlink" title="算法步骤："></a>算法步骤：</h5><ul><li><p>初始化：随机初始化 $ \overrightarrow{\mathbf{x}}_{0}, t=0 $ 。</p></li><li><p>执行迭代，迭代步骤如下:</p><ul><li><p>将 $ x_{1}, \cdots, x_{i-1}, x_{i+1}, \cdots, x_{n} $ 保持不变, 计算条件概率:<br>$$<br>\tilde{p}\left(x_{i} \mid x_{1}=x_{t, 1}, \cdots, x_{i-1}=x_{t, i-1}, x_{i+1}=x_{t, i+1}, \cdots, x_{n}=x_{t, n}\right)<br>$$</p><blockquote><p>该条件概率就是状态转移概率 $ Q(A \rightarrow B) $</p></blockquote></li><li><p>根据条件概率 $ \tilde{p}\left(x_{i} \mid x_{1}=x_{t, 1}, \cdots, x_{i-1}=x_{t, i-1}, x_{i+1}=x_{t, i+1}, \cdots, x_{n}=x_{t, n}\right) $ 对分量$ x_{i} $ 进行采样，假设采样结果为 $ x_{t, i}^{*} $​，则获得新样本:</p>    $$    \overrightarrow{\mathbf{x}}_{t+1}=\left(x_{t, 1}, \cdots, x_{t, i-1}, x_{t, i}^{*}, x_{t, i+1}, \cdots, x_{t, n}\right)^{T}    $$    </li><li><p>令 $ t \leftarrow t+1 $​, 继续遍历。</p></li></ul></li><li><p>最终返回一个状态序列 $ \left\{\overrightarrow{\mathbf{x}}_{0}, \overrightarrow{\mathbf{x}}_{1}, \cdots\right\} $ 。</p></li></ul><blockquote><p>吉布斯采样 Gibbs sampling 有时被视作 MH 算法的特例, 它也使用马尔可夫链获取样本。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/4_monte_carlo.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/4_monte_carlo.html</a></li><li><a href="https://www.cnblogs.com/pinard/p/6625739.html">https://www.cnblogs.com/pinard/p/6625739.html</a></li><li><a href="https://baike.baidu.com/item/%E9%A9%AC%E5%B0%94%E7%A7%91%E5%A4%AB%E9%93%BE%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E6%96%B9%E6%B3%95/20869120?fr=aladdin">https://baike.baidu.com/item/%E9%A9%AC%E5%B0%94%E7%A7%91%E5%A4%AB%E9%93%BE%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E6%96%B9%E6%B3%95/20869120?fr=aladdin</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>马尔可夫链</title>
    <link href="/2021/08/01/math/markov-chain/markov-chain/"/>
    <url>/2021/08/01/math/markov-chain/markov-chain/</url>
    
    <content type="html"><![CDATA[<blockquote><p>马尔可夫链是满足马尔可夫性质的随机过程，本文记录相关内容。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>马尔可夫链 $ X_{1}, X_{2}, \cdots $ 描述了一个状态序列，其中每个状态值取决于前一个状态。 $ X_{t} $ 为随机变量, 称为时刻 $ t $ 的状态, 其取值范围称作状态空间。</p><ul><li>马尔可夫链的数学定义为:<br>$$<br>P\left(X_{t+1} \mid X_{t}, X_{t-1}, \cdots, X_{1}\right)=P\left(X_{t+1} \mid X_{t}\right)<br>$$</li></ul><h3 id="马尔可夫链示例"><a href="#马尔可夫链示例" class="headerlink" title="马尔可夫链示例"></a>马尔可夫链示例</h3><h4 id="设定"><a href="#设定" class="headerlink" title="设定"></a>设定</h4><p>社会学家把人按照经济状况分成三类：下层、中层、上层。用状态 <code>1,2,3</code> 代表着三个阶层。社会学家发现：决定一个人的收入阶层的最重要因素就是其父母的收入阶层。</p><ul><li><p>如果一个人的收入属于下层，则他的孩子属于下层的概率是 0.65，属于中层的概率是 0.28，属于上层的概率是 0.07 。</p></li><li><p>如果一个人的收入属于中层，则他的孩子属于下层的概率是 0.15，属于中层的概率是 0.67，属于上层的概率是 0.18 。</p></li><li><p>如果一个人的收入属于上层，则他的孩子属于下层的概率是 0.12，属于中层的概率是 0.36，属于上层的概率是 0.52 。</p><p>从父代到子代，收入阶层的变化的转移概率如下：</p><table><thead><tr><th align="center"></th><th align="center">子代阶层1</th><th align="center">子代阶层2</th><th align="center">子代阶层3</th></tr></thead><tbody><tr><td align="center">父代阶层1</td><td align="center">0.65</td><td align="center">0.28</td><td align="center">0.07</td></tr><tr><td align="center">父代阶层2</td><td align="center">0.15</td><td align="center">0.67</td><td align="center">0.18</td></tr><tr><td align="center">父代阶层3</td><td align="center">0.12</td><td align="center">0.36</td><td align="center">0.52</td></tr></tbody></table></li></ul><h4 id="转移方式"><a href="#转移方式" class="headerlink" title="转移方式"></a>转移方式</h4><p>使用矩阵的表示方式，转移概率矩阵记作：</p>$$\mathbf{P}=\left[\begin{array}{lll}0.65 & 0.28 & 0.07 \\ 0.15 & 0.67 & 0.18 \\ 0.12 & 0.36 & 0.52\end{array}\right]$$<p>假设当前这一代人在下层、中层、上层的人的比例是概率分布 $ \vec{\pi}_{0}=\left(\pi_{0}(1), \pi_{0}(2), \pi_{0}(3)\right) $，则：</p><ul><li>他们的子女在下层、中层、上层的人的概率分布是 $ \vec{\pi}_{1}=\left(\pi_{1}(1), \pi_{1}(2), \pi_{1}(3)\right)=\vec{\pi}_{0} \mathbf{P} $</li><li>他们的孙子代的分布比例将是 $ \vec{\pi}_{2}=\left(\pi_{2}(1), \pi_{2}(2), \pi_{2}(3)\right)=\vec{\pi}_{1} \mathbf{P}=\vec{\pi}_{0} \mathbf{P}^{2} $</li><li>……</li><li>第 $ n $ 代子孙在下层、中层、上层的人的比例是 $ \vec{\pi}_{n}=\left(\pi_{n}(1), \pi_{n}(2), \pi_{n}(3)\right)=\vec{\pi}_{n-1} \mathbf{P}=\vec{\pi}_{0} \mathbf{P}^{n} $</li></ul><h4 id="数据举例"><a href="#数据举例" class="headerlink" title="数据举例"></a>数据举例</h4><h5 id="数据1"><a href="#数据1" class="headerlink" title="数据1"></a>数据1</h5><p>假设初始概率分布为$ \pi_{0}=(0.72,0.19,0.09) $​ ，给出前 14 代人的分布状况：</p><table><thead><tr><th>编号</th><th>阶层1</th><th>阶层2</th><th>阶层3</th></tr></thead><tbody><tr><td>0</td><td>0.72</td><td>0.19</td><td>0.09</td></tr><tr><td>1</td><td>0.5073</td><td>0.3613</td><td>0.1314</td></tr><tr><td>2</td><td>0.399708</td><td>0.431419</td><td>0.168873</td></tr><tr><td>3</td><td>0.344788</td><td>0.461763</td><td>0.193449</td></tr><tr><td>4</td><td>0.31659</td><td>0.475564</td><td>0.207846</td></tr><tr><td>5</td><td>0.30206</td><td>0.482097</td><td>0.215843</td></tr><tr><td>6</td><td>0.294555</td><td>0.485285</td><td>0.22016</td></tr><tr><td>7</td><td>0.290673</td><td>0.486874</td><td>0.222453</td></tr><tr><td>8</td><td>0.288663</td><td>0.487677</td><td>0.22366</td></tr><tr><td>9</td><td>0.287622</td><td>0.488087</td><td>0.224292</td></tr><tr><td>10</td><td>0.287082</td><td>0.488297</td><td>0.224621</td></tr><tr><td>11</td><td>0.286802</td><td>0.488406</td><td>0.224792</td></tr><tr><td>12</td><td>0.286657</td><td>0.488462</td><td>0.224881</td></tr><tr><td>13</td><td>0.286582</td><td>0.48849</td><td>0.224927</td></tr><tr><td>14</td><td>0.286543</td><td>0.488505</td><td>0.224951</td></tr></tbody></table><blockquote><p>可以看到从第 9 代开始，阶层分布就趋向于稳定不变。</p></blockquote><h5 id="数据2"><a href="#数据2" class="headerlink" title="数据2"></a>数据2</h5><p>如果换一个初始概率分布为$ \vec{\pi}_{0}=(0.51,0.34,0.15) $​ ，给出前 14 代人的分布状况：</p><table><thead><tr><th>编号</th><th>阶层1</th><th>阶层2</th><th>阶层3</th></tr></thead><tbody><tr><td>0</td><td>0.51</td><td>0.34</td><td>0.15</td></tr><tr><td>1</td><td>0.4005</td><td>0.4246</td><td>0.1749</td></tr><tr><td>2</td><td>0.345003</td><td>0.459586</td><td>0.195411</td></tr><tr><td>3</td><td>0.316639</td><td>0.474871</td><td>0.208489</td></tr><tr><td>4</td><td>0.302065</td><td>0.481879</td><td>0.216056</td></tr><tr><td>5</td><td>0.294551</td><td>0.485217</td><td>0.220232</td></tr><tr><td>6</td><td>0.290668</td><td>0.486853</td><td>0.222478</td></tr><tr><td>7</td><td>0.28866</td><td>0.487671</td><td>0.223669</td></tr><tr><td>8</td><td>0.28762</td><td>0.488085</td><td>0.224295</td></tr><tr><td>9</td><td>0.287081</td><td>0.488297</td><td>0.224622</td></tr><tr><td>10</td><td>0.286802</td><td>0.488406</td><td>0.224793</td></tr><tr><td>11</td><td>0.286657</td><td>0.488462</td><td>0.224881</td></tr><tr><td>12</td><td>0.286582</td><td>0.488491</td><td>0.224927</td></tr><tr><td>13</td><td>0.286543</td><td>0.488505</td><td>0.224951</td></tr><tr><td>14</td><td>0.286523</td><td>0.488513</td><td>0.224964</td></tr></tbody></table><blockquote><p>可以发现到第 8 代又收敛了。</p></blockquote><h4 id="收敛原因"><a href="#收敛原因" class="headerlink" title="收敛原因"></a>收敛原因</h4><p>两次不同的初始概率分布，最终都收敛到概率分布 $ \vec{\pi}=(0.286,0.489,0.225) $ 。 这说明收敛的行为和初始概率分布${\vec{\pi}}_0$无关，而是由概率转移矩阵$P$决定的。</p><h3 id="平稳分布"><a href="#平稳分布" class="headerlink" title="平稳分布"></a>平稳分布</h3><h4 id="马尔可夫链定理"><a href="#马尔可夫链定理" class="headerlink" title="马尔可夫链定理"></a>马尔可夫链定理</h4><p>如果一个非周期马尔可夫链具有转移概率矩阵$P$​ ，且它的任何两个状态是联通的，则有：</p>$$\lim _{n \rightarrow \infty} \mathbf{P}^{n}=\left[\begin{array}{ccccc}\pi(1) & \pi(2) & \cdots & \pi(j) & \cdots \\ \pi(1) & \pi(2) & \cdots & \pi(j) & \cdots \\ \vdots & \vdots & \ddots & \vdots & \vdots \\ \pi(1) & \pi(2) & \cdots & \pi(j) & \cdots \\ \vdots & \vdots & \ddots & \vdots & \vdots\end{array}\right] \\\pi(j)=\sum_{i=0}^{\infty} \pi(i) P_{i, j}$$<p>其中:</p><ul><li>$ 1,2, \cdots, j, \cdots $​ 为所有可能的状态。</li><li>$P_{i,j}$是转移概率矩阵$P$的第$i$行第$j$列的元素，表示状态$i$转移到状态$j$的概率。</li><li>概率分布 $ \vec{\pi} $ 是方程 $ \vec{\pi} \mathbf{P}=\vec{\pi} $ 的唯一解，其中 $ \vec{\pi}=(\pi(1), \pi(2), \cdots, \pi(j), \cdots), \sum_{j=0}^{\infty} \pi(j)=\mathbf{1} $ 。<br>称概率分布 $ \vec{\pi} $​ 为马尔可夫链的平稳分布。</li></ul><p>在马尔可夫链定理中：</p><ul><li>马尔可夫链的状态不要求有限, 可以是无穷多个。</li><li>非周期性在实际任务中都是满足的。</li><li>两个状态的连通指的是：状态 $ i $​ 可以通过有限的 $ n $​ 步转移到达 $ j $​ (并不要求从状态 $ i $​ 可以直接一步转移到 状态 $ j $​ )。<br>零。</li></ul><h4 id="收敛"><a href="#收敛" class="headerlink" title="收敛"></a>收敛</h4><p>从初始概率分布 $ \vec{\pi}_{0} $ 出发, 在马尔可夫链上做状态转移, 记时刻 $ i $ 的状态 $ X_{i} $ 服从的概率分布为 $ \vec{\pi}_{i} $, 记作 $ X_{i} \sim \vec{\pi}_{i} $, 则有:</p>$$\begin{array}{c}X_{0} \sim \vec{\pi}_{0} \\X_{1} \sim \vec{\pi}_{1} \\\ldots \\X_{n} \sim \vec{\pi}_{n} \\X_{n+1} \sim \vec{\pi}_{n+1}\end{array}$$<p>假设到达第$n$​​步时，马尔可夫链收敛，则有：</p>$$X_{n} \sim \vec{\pi}\\X_{n+1} \sim \vec{\pi}\\...$$<p>所以$ X_{n}, X_{n+1}, X_{n+2}, \cdots $​是同分布的随机变量（当然它们并不独立）。</p><p>如果从一个具体的初始状态$x_0$开始，然后沿着马尔可夫链按照概率转移矩阵做调整，则得到一个转移序列</p><p>$$<br>x_{0}, x_{1}, \cdots, x_{n}, x_{q_{b}+1}, \cdots<br>$$</p><p>根据马尔可夫链的收敛行为，当$n$​​较大时，$ x_{n}, x_{n+1}, \cdots $​​将是平稳分布$\vec{\pi}$​​​的样本。</p><h4 id="平稳分布-1"><a href="#平稳分布-1" class="headerlink" title="平稳分布"></a>平稳分布</h4><h5 id="细致平稳条件定理"><a href="#细致平稳条件定理" class="headerlink" title="细致平稳条件定理"></a>细致平稳条件定理</h5><p>如果非周期马尔可夫链的转移矩阵$P$和某个分布$\vec{\pi}$​ 满足：<br>$$<br>\pi(i) P_{i, j}=\pi(j) P_{j, i}<br>$$</p><p>则 $\vec{\pi}$ 是马尔可夫链的<strong>平稳分布</strong>，这也是马尔可夫细致平稳条件。</p><blockquote><p>这被称作马尔可夫链的细致平稳条件 detailed balance condition</p></blockquote><h5 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h5><p>已知 $\pi(i) P_{i, j}=\pi(j) P_{j, i}$​​​ ,往证 $\vec \pi {\bf{P}} = \vec \pi $​</p>$$\begin{array}{l}\vec \pi {\bf{P}} &= [{\pi _1},{\pi _2},...,{\pi _i},...,{\pi _n}]\left( {\begin{array}{*{20}{c}}\begin{array}{l}\\\end{array}&\begin{array}{l}{P_{1i}}\\{P_{2i}}\end{array}&\begin{array}{l}\\\end{array}\\{...}&{{P_{3i}}}&{...}\\\begin{array}{l}\\\end{array}&\begin{array}{l}...\\{P_{ni}}\end{array}&\begin{array}{l}\\\end{array}\end{array}} \right)\\ &= [...,{\pi _1}{P_{1i}} + {\pi _2}{P_{2i}} +  \cdots  + {\pi _n}{P_{ni}},...]\end{array}$$<ul><li>我们需要证明对于任意的$i$​​，有：</li></ul>$${\pi _i} = {\pi _1}{P_{1i}} + {\pi _2}{P_{2i}} +  \cdots  + {\pi _n}{P_{ni}}$$<ul><li>利用已知条件：</li></ul>$$\begin{array}{l}{\pi _1}{P_{1i}} + {\pi _2}{P_{2i}} +  \cdots  + {\pi _n}{P_{ni}} &= {\pi _i}{P_{i1}} + {\pi _i}{P_{i2}} +  \cdots  + {\pi _i}{P_{in}}\\ &= {\pi _i}\sum\limits_{j = 1}^n {{P_{ij}}} \\ & = {\pi _i}\end{array}$$<ul><li>因此：</li></ul><p>$$<br>\vec \pi {\bf{P}} = \vec \pi<br>$$</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/4_monte_carlo.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/4_monte_carlo.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 11 映射磁盘驱动器</title>
    <link href="/2021/07/28/windows/win11-mount/win11-mount/"/>
    <url>/2021/07/28/windows/win11-mount/win11-mount/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Windows 11 没有了映射磁盘驱动器按钮，本文记录在Win11下挂载远程磁盘的方法。</p></blockquote><span id="more"></span><h3 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h3><ul><li>开启NFS服务</li><li>确定可以挂载的磁盘</li><li>使用 <code>net use</code> 命令挂载磁盘</li></ul><h3 id="开启NFS服务"><a href="#开启NFS服务" class="headerlink" title="开启NFS服务"></a>开启NFS服务</h3><p>不开启NFS服务无法挂载磁盘</p><blockquote><p>可以在cmd 中使用 <code>showmount -e</code> 命令测试，如果没有安装会报错：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#x27;showmount&#x27; 不是内部或外部命令，也不是可运行的程序<br>或批处理文件。<br></code></pre></td></tr></table></figure></blockquote><ul><li>控制面板 -&gt; 程序和功能 -&gt; 勾选NFS服务 -&gt; 确定</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210728160634.png"></p><blockquote><p>等一会</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210728160704.png"></p><ul><li>此时使用 <code>showmount -e &lt;ip&gt;</code>可以查看远程地址中可以挂载的目录列表</li></ul><h3 id="确定可以挂载的磁盘"><a href="#确定可以挂载的磁盘" class="headerlink" title="确定可以挂载的磁盘"></a>确定可以挂载的磁盘</h3><h5 id="Linux-磁盘"><a href="#Linux-磁盘" class="headerlink" title="Linux 磁盘"></a>Linux 磁盘</h5><ul><li>使用 <code>showmount -e &lt;ip&gt;</code></li></ul><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade">C:\Users\Administrator&gt;showmount -e <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.15</span><br>导出列表在 <span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.15</span>:<br><span class="hljs-regexp">/disk/</span>zhangyiwei                   *<br></code></pre></td></tr></table></figure><ul><li>列表中的内容表明可以对这些目录进行远程挂载，如果没有的话需要到<a href="https://www.zywvvd.com/2020/06/03/linux/mount/mount-settings/mount-settings/#%E8%AE%BE%E7%BD%AE%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6%E5%A4%B9">远程主机中配置</a></li></ul><h5 id="Windows-共享目录"><a href="#Windows-共享目录" class="headerlink" title="Windows 共享目录"></a>Windows 共享目录</h5><ul><li>使用 <code>net view \\&lt;ip&gt;</code></li></ul><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\A</span>dministrator&gt;net view <span class="hljs-symbol">\\</span>10.0.2.19<br>在 <span class="hljs-symbol">\\</span>10.0.2.19 的共享资源<br><br><br><br>共享名         类型  使用为  注释<br><br>-------------------------------------------------------------------------------<br>VVD_Win_Share  Disk<br>命令成功完成。<br></code></pre></td></tr></table></figure><ul><li><p>列表会列出主机中的 Windows 共享目录列表</p></li><li><p>也可以在网络上右键 -&gt; 映射驱动器</p></li></ul><h3 id="使用-net-use-命令挂载磁盘"><a href="#使用-net-use-命令挂载磁盘" class="headerlink" title="使用 net use 命令挂载磁盘"></a>使用 <code>net use</code> 命令挂载磁盘</h3><h4 id="命令用法"><a href="#命令用法" class="headerlink" title="命令用法"></a>命令用法</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">net use <span class="hljs-tag">&lt;<span class="hljs-name">disk_driver</span>&gt;</span>: \\<span class="hljs-tag">&lt;<span class="hljs-name">ip</span>&gt;</span>\<span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>注意： <strong>冒号后面有空格</strong></p></blockquote><table><thead><tr><th>符号</th><th>含义</th></tr></thead><tbody><tr><td>disk_driver</td><td>盘符</td></tr><tr><td>ip</td><td>目标主机地址</td></tr><tr><td>path</td><td>文件夹相对路径</td></tr></tbody></table><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><h5 id="Linux-磁盘-1"><a href="#Linux-磁盘-1" class="headerlink" title="Linux 磁盘"></a>Linux 磁盘</h5><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\A</span>dministrator&gt;net use Z: <span class="hljs-symbol">\\</span>192.168.10.15<span class="hljs-symbol">\d</span>isk<span class="hljs-symbol">\z</span>hangyiwei<br>命令成功完成。<br></code></pre></td></tr></table></figure><h5 id="Windows-磁盘"><a href="#Windows-磁盘" class="headerlink" title="Windows 磁盘"></a>Windows 磁盘</h5><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\A</span>dministrator&gt;net use Y: <span class="hljs-symbol">\\</span>10.0.2.19<span class="hljs-symbol">\V</span>VD_Win_Share<br>命令成功完成。<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/win11-mt/20210728162216.png"></p><h4 id="断开连接"><a href="#断开连接" class="headerlink" title="断开连接"></a>断开连接</h4><ul><li>在挂载的磁盘上 <code>右键 -&gt; Show more options -&gt; 断开连接</code> 即可</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/fangye945a/article/details/87743291">https://blog.csdn.net/fangye945a/article/details/87743291</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>远程计算机或设备将不接受连接问题解决方案</title>
    <link href="/2021/07/28/internet/network-cannot-connect/network-cannot-connect/"/>
    <url>/2021/07/28/internet/network-cannot-connect/network-cannot-connect/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Win11 开机突然上不去网，右下角网络图标单击没有反应，浏览器网络诊断结果是<code>远程计算机或设备将不接受连接</code>，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><ul><li>网线没有问题，网络连接不上</li><li>右下角网络图标单击没有反应（未解决）</li><li>浏览器网络诊断结果是<code>远程计算机或设备将不接受连接</code></li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>打开控制面板 -&gt; Internet 选项 -&gt; 连接 -&gt; 局域网设置 -&gt; 去掉所有勾勾</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210728103555.png"></p><ul><li>此时可以正常上网</li><li>但右下角网络图标还是点不开，可能是Win11的bug</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://jingyan.baidu.com/article/ff42efa9493a68819e2202f1.html">https://jingyan.baidu.com/article/ff42efa9493a68819e2202f1.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>internet</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>internet</tag>
      
      <tag>故障排除</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>蒙特卡洛（Monte Carlo）方法</title>
    <link href="/2021/07/26/math/monte-carlo/monte-carlo/"/>
    <url>/2021/07/26/math/monte-carlo/monte-carlo/</url>
    
    <content type="html"><![CDATA[<blockquote><p>蒙特卡洛方法可以近似计算某个概率值，计算结果随着实验次数增加而愈加精确，本文记录相关内容。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ol><li><p>蒙特卡洛方法<code>Monte Carlo</code> 可以通过采用随机投点法来求解不规则图形的面积。</p><p>求解结果并不是一个精确值，而是一个近似值。当投点的数量越来越大时，该近似值也越接近真实值。</p></li><li><p>蒙特卡洛方法也可以用于根据概率分布来随机采样的任务。</p></li></ol><h3 id="布丰投针"><a href="#布丰投针" class="headerlink" title="布丰投针"></a>布丰投针</h3><p>布丰投针问题是1777年法国科学家布丰提出的一种计算圆周率的方法：随机投针法。</p><h4 id="执行步骤"><a href="#执行步骤" class="headerlink" title="执行步骤"></a>执行步骤</h4><ul><li>首先取一张白纸，在上面绘制许多条间距为$d$ 的平行线。</li><li>取一根长度为$l , l \lt d$的针，随机地向纸上投掷$n$次，观测针与直线相交的次数，记做 $m$。</li><li>计算针与直线相交的概率 $p=\frac{m}{n}$。因此有：</li></ul><p>$$<br>\pi = 2 \frac { n \times l } { m \times d }<br>$$</p><h4 id="相交概率证明"><a href="#相交概率证明" class="headerlink" title="相交概率证明"></a>相交概率证明</h4><p>由于向纸上投针是完全随机的, 因此用二维随机变量 $ (X, Y) $​ 来确定针在纸上的具体位置。其中:</p><ul><li><p>$ X $​ 表示针的中点到平行线的距离，它是 $ [0, d / 2] $​ 之间的均匀分布。</p></li><li><p>$ Y $​ 表示针与平行线的夹角， 它是 $ \left[0, \frac{\pi}{2}\right] $​ 之间的均匀分布。</p></li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210726231250.png"></p><ul><li>当 $ X&lt;\frac{l}{2} \sin Y $ 时，针与直线相交。</li><li>由于 $ X, Y $​ 相互独立， 因此有概率密度函数：</li></ul>$$p(X=x, Y=y)=\left\{\begin{array}{ll}  \frac{4}{\pi d}, & 0 \leq x \leq d / 2,0 \leq y \leq \pi / 2 \\  0, & \text { else }  \end{array}\right.$$<ul><li>因此，针与直线相交的概率为：</li></ul>$$P\left\{X<\frac{l}{2} \sin Y\right\}=\iint_{x<\frac{l}{2} \sin y} p(x, y) d x d y=\int_{x=0}^{x=\frac{1}{2} \sin y} \int_{y=0}^{y=\pi / 2} \frac{4}{\pi d} d x d y=\frac{2 l}{\pi d}$$<ul><li>根据 $ \frac{2 l}{\pi d}=\frac{m}{n} $​ 即可得证。</li></ul><h3 id="蒙特卡洛积分"><a href="#蒙特卡洛积分" class="headerlink" title="蒙特卡洛积分"></a>蒙特卡洛积分</h3><blockquote><p>对于函数 $ f(x) $, 其在区间 $ [a, b] $ 上的积分 $ \int_{a}^{b} f(x) d x $ 可以采用两种方法来求解: <code>投点法</code>、<code>期望法</code>。</p></blockquote><h4 id="投点法"><a href="#投点法" class="headerlink" title="投点法"></a>投点法</h4><ul><li><p>对函数 $ f(x) $​, 对其求积分等价于求它的曲线下方的面积。</p></li><li><p>定义一个常数 $M$，使得 $ M&gt;\max _{a \leq x \leq b} f(x) $，该常数在区间 $ [a, b] $上的面积就是矩形面积 $ M(b-a) $​​​.</p></li><li><p>随机向矩形框中随机的、均匀的投点，设落在函数$ f(x) $下方的点为绿色，落在$ f(x) $和$M$之间的点为红色。</p></li><li><p>则有：<strong>落在$ f(x) $下方的点的概率等于$ f(x) $的面积比上矩形框的面积</strong> 。</p></li><li><p>从 $ [a, b] $​ 之间的均匀分布中采样 $ x_{0} $​, 从 $ [0, M] $​ 之见的均匀分布中采样 $ y_{0}, \quad\left(x_{0}, y_{0}\right) $​ 构成一个 随机点。</p></li><li><p>若 $ y_{0} \leq f\left(x_{0}\right) $, 则说明该随机点在函数 $ f(x) $ 下方，染成绿色。</p></li><li><p>若 $ f\left(x_{0}\right)&lt;y_{0} \leq M $, 则说明该随机点在函数 $ f(x) $​​ 上方，染成红色。</p></li><li><p>假设绿色点有$n_1$个，红色点有$n_2$个，总的点数为$n_1 + n_2$​ ，因此有：</p></li></ul><p>$$<br>\int_{a}^{b} f(x) d x=\frac{n_{1}}{n_{1}+n_{2}} \times M(b-a)<br>$$</p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/%E6%9C%AA%E6%A0%87%E9%A2%98-1.jpg"></p><h4 id="期望法"><a href="#期望法" class="headerlink" title="期望法"></a>期望法</h4><ul><li>假设需要求解积分$ I=\int_{a}^{b} f(x) d x $，则任意选择一个概率密度函数 $ p(x) $，其中$ p(x) $​满足条件:</li></ul>$$\begin{array}{c}\int_{a}^{b} p(x) d x=1 \\\text { if } f(x) \neq 0 \text { then } p(x) \neq 0, \quad a \leq x \leq b\end{array}$$<ul><li>令:</li></ul>$$f^{*}(x)=\left\{\begin{array}{ll}\frac{f(x)}{p(x)}, & p(x) \neq 0 \\0, & p(x)=0\end{array}\right.$$<ul><li>则有:</li></ul><p>$$<br>I=\int_{a}^{b} f(x) d x=\int_{a}^{b} f^{*}(x) p(x) d x<br>$$</p><ul><li>$I$刚好是一个期望：设随机变量 $ X $ 服从分布 $ X \sim p(x) $, 则 $ I=\mathbb{E}_{X \sim p}\left[f^{*}(X)\right] $</li><li>则期望法求积分的步骤是：<ul><li>任选一个满足条件的概率分布 $ p(x) $ 。</li><li>根据 $ p(x) $, 生成一组服从分布 $ p(x) $ 的随机数 $ x_{1}, x_{2}, \cdots, x_{N} $ 。</li><li>计算均值 $ \bar{I}=\frac{1}{N} \sum_{i=1}^{N} f^{*}\left(x_{i}\right) $, 并将 $ \bar{I} $ 作为 $ I $​ 的近似。</li></ul></li><li>在期望法求积分中, 如果 $ a, b $ 均为有限值, 则 $ p(x) $ 可以取均匀分布的概率密度函数：</li></ul>$$p(x)=\left\{\begin{array}{ll}\frac{1}{b-a}, & a \leq x \leq b \\ 0, & \text { else }\end{array}\right. $$<p>​        此时 $ f^{*}(x)=(b-a) f(x), \quad \bar{I}=\frac{b-a}{N} \sum_{i=1}^{N} f\left(x_{i}\right) $​ 。</p><ul><li>其物理意义为: $ \frac{\sum_{i}^{N} f\left(x_{i}\right)}{N} $ 为在区间 $ [a, b] $ 上函数的平均高度, 乘以区间宽度 $ b-a $ 就是平均面积。</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/%E6%9C%AA%E6%A0%87%E9%A2%98-2.jpg"></p><h3 id="蒙特卡洛采样"><a href="#蒙特卡洛采样" class="headerlink" title="蒙特卡洛采样"></a>蒙特卡洛采样</h3><p>采样问题的主要任务是：根据概率分布 $ p(x) $, 生成一组服从分布 $ p(x) $ 的随机数 $ x_{1}, x_{2}, \cdots . $​</p><h4 id="均匀分布模拟-p-x-采样"><a href="#均匀分布模拟-p-x-采样" class="headerlink" title="均匀分布模拟$p(x)$采样"></a>均匀分布模拟$p(x)$采样</h4><ul><li><p>如果 $ p(x) $ 就是均匀分布，则均匀分布的采样非常简单。</p></li><li><p>如果 $ p(x) $ 是非均匀分布，则可以通过均匀分布的采样来实现。</p></li></ul><ol><li><p>首先根据均匀分布 $ U(0,1) $ 随机生成一个样本 $ z_{i} $ 。</p></li><li><p>设 $ \tilde{P}(x) $ 为概率分布 $ p(x) $ 的累计分布函数: </p></li></ol><p>$$<br>\tilde{P}(x)=\int_{-\infty}^{x} p(z) d z<br>$$</p><ol start="3"><li>令 $ z_{i}=\tilde{P}\left(x_{i}\right) $, 计算得到 $ x_{i}=\tilde{P}^{-1}\left(z_{i}\right) $, 其中 $ \tilde{P}^{-1} $ 为反函数, 则 $ x_{i} $ 为对 $ p(x) $ 的采样。</li></ol><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210731000211.png"></p><ol start="4"><li>通过均匀分布的采样的原理：假设随机变量$ Z, X $ 满足 $ Z=\tilde{P}(X) $, 则 $ X $ 的概率分布为:</li></ol><p>$$<br>p_{Z}(z) \frac{d}{d x} \tilde{P}(x)<br>$$</p><ul><li>因为 $ Z $ 是 $ [0,1] $ 上面的均匀分布，因此 $ p_{Z}(z)=1 ; \tilde{P}(x) $ 为概率分布 $ p(x) $ 的累计分布函数, 因此 $ \frac{d}{d x} \tilde{P}(x)=p_{X}(x) $ 。因此上式刚好等于 $ p(x) $, 即： $ x_{i} $ 服从概率分布 $ p(x) $​ 。</li></ul><ol start="5"><li>这其中有两个关键计算：</li></ol><ul><li>根据 $ p(x) $, 计算累计分布函数 $ \tilde{P}(x)=\int_{-\infty}^{\pi} p(z) d z $ 。</li><li>根据 $ z=\tilde{P}(x) $ 计算反函数 $ x=\tilde{P}^{-1}(z) $ 。</li></ul><blockquote><p>如果累计分布函数无法计算，或者反函数难以求解，则该方法无法进行。</p></blockquote><h4 id="接受-拒绝采样"><a href="#接受-拒绝采样" class="headerlink" title="接受-拒绝采样"></a>接受-拒绝采样</h4><p>对于复杂的概率分布$p(x)$ ，难以通过均匀分布来实现采样。此时可以使用<code>接受-拒绝采样</code> 策略。</p><ul><li>首先选定一个容易采样的概率分布 $ q(x) $​ ，选择一个常数 $ k $​, 使得在定义域的所有位置都满足 $ p(x) \leq k \times q(x) $​ 。</li><li>然后根据概率分布 $ q(x) $ 随机生成一个样本 $ x_{i} $ 。</li><li>计算 $ \alpha_{i}=\frac{p\left(x_{i}\right)}{k q\left(x_{i}\right)} $, 以概率 $ \alpha_{i} $​​ 接受该样本。</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210801210156.png"></p><h5 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h5><p>根据均匀分布$ U(0,1) $​随机生成一个点 $ u_{i} $​， 如果 $ u_{i} \leq \alpha_{i} $​​，则接受该样本；否则拒绝该样本。</p><h5 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h5><p>根据均匀分布 $ U\left(0, k q\left(x_{i}\right)\right) $​ 生成一个随机点, 如果该点落在灰色区间$((p(x_{i}), k q(x_{i})]) $​则拒绝该样本；如果该点落在白色区间$ \left(\left[0, p\left(x_{i}\right)\right]\right) $​​则接受该样本。</p><h5 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h5><p><code>接受-拒绝采样</code> 在高维的情况下会出现两个问题：</p><ul><li>合适的$q$ 分布比较难以找到。</li><li>难以确定一个合理的$k$值。</li></ul><p>这两个问题会导致拒绝率很高，无效计算太多。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/4_monte_carlo.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/4_monte_carlo.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Halcon 20.11 安装使用记录</title>
    <link href="/2021/07/26/halcon/halcon-20-11-install/halcon-20-11-install/"/>
    <url>/2021/07/26/halcon/halcon-20-11-install/halcon-20-11-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>HALCON是德国MVtec公司开发的一套完善的标准的机器视觉算法包，功能强大，百闻不如一见，本文记录Halcon最新20.11版的安装使用过程。</p></blockquote><span id="more"></span><h3 id="Halcon简介"><a href="#Halcon简介" class="headerlink" title="Halcon简介"></a>Halcon简介</h3><ul><li><p>HALCON是德国MVtec公司开发的一套完善的标准的机器视觉算法包，它节约了产品成本，缩短了软件开发周期。</p></li><li><p>底层功能算法多，运算性能快，开发需要一定软件功底和图像处理理论。</p></li><li><p>快速学习做法：研究实例、做实战项目。halcon不能提供相应的界面编程需求，需要和vs来构造MFC界面或者QT使用，才能构成一套完整软件。</p></li><li><p>官方网站：<a href="https://www.mvtec.com/">https://www.mvtec.com/</a></p></li></ul><h3 id="软件下载"><a href="#软件下载" class="headerlink" title="软件下载"></a>软件下载</h3><ul><li>官网提供下载链接</li><li>ihalcon 学习网也有百度云链接</li><li>需要下载：<ul><li>halcon-20.11.0.0-windows.exe</li><li>halcon-20.11.0.0-windows-deep-learning-core.exe</li><li>halcon-20.11.0.0-windows-deep-learning-data.exe</li><li>halcon-20.11.0.0-windows-runtime.exe</li></ul></li></ul><h3 id="许可"><a href="#许可" class="headerlink" title="许可"></a>许可</h3><blockquote><p> halcon 有着严格的许可机制</p></blockquote><ul><li>Halcon License分为：开发License、运行License、试用License（评估）三种类型！<ul><li>开发狗：可以进行Halcon程序开发专用的License狗，必须先购买开发狗才可以购买运行狗！</li><li>运行狗：程序开发完成后运行的PC需要此狗即可正常运行Halcon库的程序！</li><li>评估License：唯一的文件授权，可开发和运行，但是仅有一个月试用期，到期后必须更换下月新版本。</li></ul></li></ul><h3 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h3><ul><li>需要提前安装 vsiual studio，我装了 vs 2019 community 版</li></ul><p>现在我们有了四个安装包，安装顺序为：</p><ol><li><p>windows.exe或runtime.exe</p></li><li><p>deep-learning-core.exe</p></li><li><p>deep-learning-data.exe</p></li></ol><h4 id="1-windows-exe"><a href="#1-windows-exe" class="headerlink" title="1. windows.exe"></a>1. windows.exe</h4><ul><li>以管理员身份运行halcon-20.11.0.0-windows.exe</li></ul><blockquote><p>过程中能装的都装了</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210726140732.png"></p><p><img src="https://photos.zywvvd.com/win11-mt/20210727093358.png"></p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210726141414.png"></p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210726141623.png"></p><ul><li>每月的 license 需要在 haclon 学习网下载</li></ul><blockquote><p>将license 所有文件放到 halcon / license 文件夹下</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210726162809.png"></p><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210726150048.png"></p><ul><li>此时可以顺利使用halcon了</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210726163922.png"></p><h4 id="2-runtime-exe"><a href="#2-runtime-exe" class="headerlink" title="2. runtime.exe"></a>2. runtime.exe</h4><ul><li>以管理员身份运行 halcon-20.11.0.0-windows-runtime.exe</li></ul><blockquote><p>这个包与 windows.exe 安装一个即可</p></blockquote><ul><li>正常安装</li></ul><h4 id="3-deep-learning-core-exe"><a href="#3-deep-learning-core-exe" class="headerlink" title="3. deep-learning-core.exe"></a>3. deep-learning-core.exe</h4><blockquote><p>模块包含深度学习相关功能</p></blockquote><ul><li>以管理员身份运行 halcon-20.11.0.0-windows-deep-learning-core.exe</li><li>正常安装</li></ul><h4 id="4-deep-learning-data-exe"><a href="#4-deep-learning-data-exe" class="headerlink" title="4. deep-learning-data.exe"></a>4. deep-learning-data.exe</h4><blockquote><p>模块包含深度学习相关数据</p></blockquote><ul><li>以管理员身份运行 halcon-20.11.0.0-windows-deep-learning-data.exe</li><li>正常安装</li></ul><h3 id="测试运行"><a href="#测试运行" class="headerlink" title="测试运行"></a>测试运行</h3><ul><li>打开 <code>%HALCONEXAMPLES%/hdevelop/Applications/OCR/bottle.hdev</code></li><li>运行程序：</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210726191912.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://www.zhihu.com/question/36506976">https://www.zhihu.com/question/36506976</a></p></li><li><p><a href="https://blog.csdn.net/mlxg99999/article/details/118396439">https://blog.csdn.net/mlxg99999/article/details/118396439</a></p></li><li><p><a href="https://blog.csdn.net/bomany/article/details/112858234">https://blog.csdn.net/bomany/article/details/112858234</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>halcon</category>
      
    </categories>
    
    
    <tags>
      
      <tag>halcon</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -17- 解决typeError [ERR_INVALID_ARG_TYPE] The &quot;mode&quot; argument must be integer. Received an instance of Object的问题</title>
    <link href="/2021/07/25/hexo/17%20hexo-d-error/hexo-d-error/"/>
    <url>/2021/07/25/hexo/17%20hexo-d-error/hexo-d-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在写博客时，生成正常，部署时<code>hexo d</code>出现以下错误提示<code>typeError [ERR_INVALID_ARG_TYPE]: The &quot;mode&quot; argument must be integer. Received an instance of Object</code>。本文记录解决方案。</p></blockquote><span id="more"></span><h2 id="错误原因"><a href="#错误原因" class="headerlink" title="错误原因"></a>错误原因</h2><ul><li><p><code>hexo</code>暂时不能在新版的<code>nodejs</code>环境下运行</p></li><li><p>这应该是node版本过高导致的（我用的是v14.8.0），将node版本换为v12.14.0版本后，部署就成功了！</p></li></ul><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ul><li><p>降级<code>nodejs</code>即可，卸载现有<code>nodejs</code>，安装<a href="https://nodejs.org/download/release/v12.22.1/">nodejs 12</a>。</p></li><li><p>如果有<a href="https://www.jeay.net/js/install-nodejs.html#nvm%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95">nvm</a>的话，可以直接用nvm切换版本为12：</p></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nvm</span> install <span class="hljs-number">12</span><br><span class="hljs-attribute">nvm</span> use <span class="hljs-number">12</span><br></code></pre></td></tr></table></figure><blockquote><p>另外，hexo更新后或许就能支持新版nodejs了</p></blockquote><ul><li>此外，我重新安装hexo之后也可以正常 hexo d了，没有降级node.js，不知道该怎么解释</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.jeay.net/tools/hexo-type-error.html">https://www.jeay.net/tools/hexo-type-error.html</a></li><li><a href="https://www.jianshu.com/p/68177749d33f">https://www.jianshu.com/p/68177749d33f</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>V2rayN 4.12 科学上网教程</title>
    <link href="/2021/07/24/internet/sentific-online-2/sentific-online/"/>
    <url>/2021/07/24/internet/sentific-online-2/sentific-online/</url>
    
    <content type="html"><![CDATA[<blockquote><p>V2rayN是一个基于<a href="https://v2raytech.com/category/v2ray/">V2ray</a>核心的Windows客户端，功能强大且支持多种协议。V2rayN 4.0版本开始取消PAC模式，给许多用户使用上带来困难。鉴于此，本文介绍最新V2rayN 4.12正式版的配置教程，让你能顺利切换PAC模式和全局模式。。</p></blockquote><span id="more"></span><h3 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h3><ul><li>基本流程参考：</li></ul><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><blockquote><p>按照参考资料，本教程需要事先准备好如下内容：</p></blockquote><ul><li>自己的服务器</li><li>本机ssh登录远程服务器</li></ul><h3 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h3><h4 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h4><ul><li>登录服务器</li><li>执行命令：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bash &lt;(curl -sL https://s.hijk.art/v2ray.sh)<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210724235941.png"></p><ul><li>我选择最简单的 VMESS - 1，过程中选择一个自己喜欢的数字作为链接端口</li><li>安装完成后，记录当前的IP、端口、id、额外id</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210725000111.png"></p><ul><li>至此服务器端操作完成</li><li>信息在 <code>/etc/v2ray/config.json</code> 中也有保存</li></ul><h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><ul><li>下载 v2rayN 4.+ 版本</li></ul><ul><li>软件为绿色版，下载后解压即可运行 v2rayN 程序，添加 VMess</li></ul><p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210725000820622.png" alt="image-20210725000820622"></p><ul><li>将服务器输出的信息填入：</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210725001433.png"></p><ul><li>添加 VMess 服务器后会增加一个条目，此时进行几种测速都应该有延迟数值显示</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210725001800.png"></p><ul><li>配置好节点后需要设置系统代理才能让浏览器访问外网，操作为：右下角托盘找到v2rayN图标，在图标上点击右键，找到“系统代理” ，点击“自动配置系统代理”，此时图标会变成红色：</li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210725001940.png"></p><ul><li><p>默认v2rayN是全局代理，也就是不管访问什么网站，都是走节点流量。之前的v2rayN都是PAC模式，v2rayN 4.0版本开始取消了PAC，因此需要下面的操作来代替PAC：</p><p>主界面点击“设置” -&gt; “路由设置” -&gt; “基础功能” -&gt; “一键导入基础规则”，然后点击“确定”：</p></li></ul><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210725002202.png"></p><ul><li><p>接下来访问百度、淘宝等国外网站都是直连，不会再走代理了。如果想让某个网站走代理而不是直连，那么在上图中“代理的Domain或IP”的左边加一行：`domain:网站域名</p><blockquote><p>例如添加v2ray网站走代理：domain:v2raytech.com，然后点击“确定”。</p></blockquote></li><li><p>想换成所有网站都走代理又该怎么操作呢？方法也很简单：上图中“直连的Domain或IP”，把左边和右边输入框的行都清空，然后点击“确定”。</p></li><li><p>如果不想上外网了，右下角托盘找到v2rayN图标，在图标上点击右键，找到“系统代理” ，点击“清除系统代理”</p></li></ul><blockquote><p><strong>注意：</strong>如果看完上面的教程还是没搞懂新版V2rayN怎么用，建议下载3.29版本：<a href="https://netfiles.pw/download.php?filename=/v2/windows/v2rayN-v3.29.zip%EF%BC%8C%E7%84%B6%E5%90%8E%E6%8C%89%E7%85%A7">https://netfiles.pw/download.php?filename=/v2/windows/v2rayN-v3.29.zip，然后按照</a> <a href="https://v2xtls.org/v2rayn%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/">V2rayN配置教程</a> 操作。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://v2xtls.org/v2rayn-4-12%e9%85%8d%e7%bd%ae%e6%95%99%e7%a8%8b/">https://v2xtls.org/v2rayn-4-12%e9%85%8d%e7%bd%ae%e6%95%99%e7%a8%8b/</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>internet</category>
      
    </categories>
    
    
    <tags>
      
      <tag>internet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OMP Error 15 Initializing libiomp5md.dll, but found libiomp5md.dll already initialized 解决方案</title>
    <link href="/2021/07/23/python/omp-error-15/omp-error-15/"/>
    <url>/2021/07/23/python/omp-error-15/omp-error-15/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在python调用matplotlib时有时会报错 <code>OMP Error 15 Initializing libiomp5md.dll, but found libiomp5md.dll already initialized</code>，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="错误复现"><a href="#错误复现" class="headerlink" title="错误复现"></a>错误复现</h3><ul><li>报错信息：<code>OMP: Error #15: Initializing libiomp5md.dll, but found libiomp5md.dll already initialized</code> </li></ul><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">OMP: Error <span class="hljs-comment">#15: Initializing libiomp5md.dll, but found libiomp5md.dll already initialized.</span><br>OMP: Hint This means that multiple copies <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> OpenMP runtime have been linked <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> program. That is dangerous, since <span class="hljs-keyword">it</span> can degrade performance <span class="hljs-keyword">or</span> cause incorrect results. The best thing <span class="hljs-built_in">to</span> <span class="hljs-built_in">do</span> is <span class="hljs-built_in">to</span> ensure that only <span class="hljs-keyword">a</span> single OpenMP runtime is linked <span class="hljs-keyword">into</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">process</span>, e.g. <span class="hljs-keyword">by</span> avoiding static linking <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> OpenMP runtime <span class="hljs-keyword">in</span> <span class="hljs-keyword">any</span> library. As <span class="hljs-keyword">an</span> unsafe, unsupported, undocumented workaround you can <span class="hljs-built_in">set</span> <span class="hljs-keyword">the</span> environment <span class="hljs-built_in">variable</span> KMP_DUPLICATE_LIB_OK=<span class="hljs-literal">TRUE</span> <span class="hljs-built_in">to</span> allow <span class="hljs-keyword">the</span> program <span class="hljs-built_in">to</span> continue <span class="hljs-built_in">to</span> execute, but that may cause crashes <span class="hljs-keyword">or</span> silently produce incorrect results. For more information, please see <span class="hljs-keyword">http</span>://www.intel.com/software/products/support/.<br></code></pre></td></tr></table></figure><h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><ul><li>可能是从不同位置加载了 <code>libiomp5md.dll</code> 库，触发了某种自检，报出了错误</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h4><ul><li>忽略该错误，在环境变量中加入 <code>KMP_DUPLICATE_LIB_OK</code> 设置为 <code>True</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;KMP_DUPLICATE_LIB_OK&quot;</span>]=<span class="hljs-string">&quot;TRUE&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>通常 <code>libiomp5md.dll</code> 库没有特殊的变化，从不同位置加载其行为也是相同的，是大家广泛采取的解决方案</p></blockquote><h4 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h4><ul><li>在运行的python环境中搜索 <code>libiomp5md.dll</code> 文件，删除多余的文件，仅保留 torch 中的库可以避免这个错误</li><li>不过可能会造成其他未知的问题（我就是在删除之后 matplotlib 再也打不出图像了）</li><li><strong>删除文件需要谨慎</strong></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/weixin_41449637/article/details/108894809">https://blog.csdn.net/weixin_41449637/article/details/108894809</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git - 配置全局 ignore</title>
    <link href="/2021/07/20/git/global_ignore/global_ignore/"/>
    <url>/2021/07/20/git/global_ignore/global_ignore/</url>
    
    <content type="html"><![CDATA[<blockquote><p>使用 git 工具管理代码时，经常会误把临时文件夹、IDE临时文件当作代码的更新给出新文件提示，每个工程配置一个ignore文件又太繁琐，本文记录全局ignore方法。</p></blockquote><span id="more"></span><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ol><li><h4 id="创建-gitignore-global-文件"><a href="#创建-gitignore-global-文件" class="headerlink" title="创建.gitignore_global 文件"></a><strong>创建<code>.gitignore_global</code> 文件</strong></h4></li></ol><p><strong>Win</strong></p><ul><li>在 C盘 -&gt; 用户 -&gt; 当前用户 -&gt; 创建  <code>.gitignore_global</code> 文件</li></ul><p><strong>Linux</strong></p><ul><li>在家目录创建 <code>~/.gitignore_global</code> 文件</li></ul><ol start="2"><li><h4 id="添加忽略内容"><a href="#添加忽略内容" class="headerlink" title="添加忽略内容"></a><strong>添加忽略内容</strong></h4></li></ol><ul><li>向 <code>.gitignore_global</code>文件加入需要忽略的内容</li></ul><ol start="3"><li><h4 id="执行git指令"><a href="#执行git指令" class="headerlink" title="执行git指令"></a>执行git指令</h4></li></ol><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">git config <span class="hljs-params">--global</span> core.excludesfile ~<span class="hljs-string">/.gitignore_global</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/cxl07325/p/10723003.html">https://www.cnblogs.com/cxl07325/p/10723003.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -25- 中文目录单击不跳转问题解决方案</title>
    <link href="/2021/07/20/hexo-theme/next/25%20chinese-toc-not-jump/chinese-toc-not-jump/"/>
    <url>/2021/07/20/hexo-theme/next/25%20chinese-toc-not-jump/chinese-toc-not-jump/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 我配置的hexo环境下，next主题中，生成文章的中文目录点击后不会自动跳转到相应位置，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>在next github 上已经提出了该问题并给出了<a href="https://github.com/theme-next/hexo-theme-next/pull/1540/files">解决方案</a></li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210720143806.png"></p><ul><li>主要修改了如下函数：</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs javascript">registerSidebarTOC: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">const</span> navItems = <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">&#x27;.post-toc li&#x27;</span>);<br>  <span class="hljs-keyword">const</span> sections = [...navItems].map(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">var</span> link = element.querySelector(<span class="hljs-string">&#x27;a.nav-link&#x27;</span>);<br> <span class="hljs-keyword">var</span> target = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-built_in">decodeURI</span>(link.getAttribute(<span class="hljs-string">&#x27;href&#x27;</span>)).replace(<span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>));<br>    <span class="hljs-comment">// TOC item animation navigate.</span><br>    link.addEventListener(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> &#123;<br>      event.preventDefault();<br>      <span class="hljs-comment">//var target = document.getElementById(event.currentTarget.getAttribute(&#x27;href&#x27;).replace(&#x27;#&#x27;, &#x27;&#x27;));</span><br>      <span class="hljs-keyword">var</span> offset = target.getBoundingClientRect().top + <span class="hljs-built_in">window</span>.scrollY;<br>      <span class="hljs-built_in">window</span>.anime(&#123;<br>        <span class="hljs-attr">targets</span>  : <span class="hljs-built_in">document</span>.scrollingElement,<br>        <span class="hljs-attr">duration</span> : <span class="hljs-number">500</span>,<br>        <span class="hljs-attr">easing</span>   : <span class="hljs-string">&#x27;linear&#x27;</span>,<br>        <span class="hljs-attr">scrollTop</span>: offset + <span class="hljs-number">10</span><br>      &#125;);<br>    &#125;);<br>    <span class="hljs-comment">//return document.getElementById(link.getAttribute(&#x27;href&#x27;).replace(&#x27;#&#x27;, &#x27;&#x27;));</span><br> <span class="hljs-keyword">return</span> target;<br>  &#125;);<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://github.com/theme-next/hexo-theme-next/pull/1540/files">https://github.com/theme-next/hexo-theme-next/pull/1540/files</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>数值溢出与 softmax</title>
    <link href="/2021/07/18/deep_learning/softmax-overflow/softmax-overflow/"/>
    <url>/2021/07/18/deep_learning/softmax-overflow/softmax-overflow/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在计算机中执行数学运算需要使用有限的比特位来表达实数，这会引入近似误差。近似误差可以在多步数值运算中传递、积累，从而导致理论上成功的算法失败。因此数值算法设计时要考虑将累计误差最小化。</p></blockquote><span id="more"></span><h3 id="溢出"><a href="#溢出" class="headerlink" title="溢出"></a>溢出</h3><ul><li><p>一种严重的误差是下溢出<code>underflow</code>：当接近零的数字四舍五入为零时，发生下溢出。</p><p>许多函数在参数为零和参数为一个非常小的正数时，行为是不同的。如：对数函数要求自变量大于零，除法中要求除数非零。</p></li><li><p>一种严重的误差是上溢出<code>overflow</code>：当数值非常大，超过了计算机的表示范围时，发生上溢出。</p></li></ul><h3 id="softmax-溢出"><a href="#softmax-溢出" class="headerlink" title="softmax 溢出"></a>softmax 溢出</h3><ul><li>设 $x = {({x_1},{x_2}, \cdots ,{x_n})^T}$，则<code>softmax</code>函数定义为：</li></ul><p>$$<br>\operatorname{softmax}(\overrightarrow{\mathbf{x}})=\left(\frac{\exp \left(x_{1}\right)}{\sum_{j=1}^{n} \exp \left(x_{j}\right)}, \frac{\exp \left(x_{2}\right)}{\sum_{j=1}^{n} \exp \left(x_{j}\right)}, \cdots, \frac{\exp \left(x_{n}\right)}{\sum_{j=1}^{n} \exp \left(x_{j}\right)}\right)^{T}<br>$$</p><ul><li>当所有的 $x_i$ 都等于常数 $c$ 时，<code>softmax</code>函数的每个分量的理论值都为$\frac { 1 } { n }$<ul><li>考虑 $c$ 是一个非常大的负数（比如趋近负无穷)， 此时 $\exp (c)$ 下溢出。此时 $\frac{\exp (c)}{\sum_{j=1}^{n} \exp (c)}$ 分母为零, 结果 未定义。</li><li>Q考虑 $c$ 是一个非常大的正数（比如趋近正无穷），此时 $\exp (c)$ 上溢出。 $\frac{\exp (c)}{\sum_{j=1}^{n} \exp (c)}$ 的结果未定义。</li></ul></li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>为了解决 softmax 函数的数值稳定性问题, 令 $z=\overrightarrow{x}-\max_{i}x_{i}$, 则有 ${softmax}(\overrightarrow{\mathbf{z}})$ 的第 $i$ 个分量为:</li></ul>$$\begin{aligned}\operatorname{softmax}(\overrightarrow{\mathbf{z}})_{i}=& \frac{\exp \left(z_{i}\right)}{\sum_{j=1}^{n} \exp \left(z_{j}\right)}\\=&\frac{\exp \left(\max _{k} x_{k}\right) \exp \left(z_{i}\right)}{\exp \left(\max _{k} x_{k}\right) \sum_{j=1}^{n} \exp \left(z_{j}\right)} \\=&\frac{\exp \left(z_{i}+\max _{k} x_{k}\right)}{\sum_{j=1}^{n} \exp \left(z_{j}+\max _{k} x_{k}\right)} \\=& \frac{\exp \left(x_{i}\right)}{\sum_{j=1}^{n} \exp \left(x_{j}\right)} \\=&\operatorname{softmax}(\overrightarrow{\mathbf{x}})_{i}\end{aligned}$$<ul><li>当 $\overrightarrow{\mathbf{x}}$ 的分量较小时, $\overrightarrow{\mathbf{z}}$ 的分量至少有一个为零，从而导致 $\operatorname{softmax}(\overrightarrow{\mathbf{z}})_{i}$ 的分母至少有一项为 1 , 从而解 决了下溢出的问题。</li><li>当 $\overrightarrow{\mathbf{x}}$ 的分量较大时, $\operatorname{softmax}(\overrightarrow{\mathbf{z}})_{i}$ 相当于分子分母同时除以一个非常大的数 $\exp \left(\max <em>{i} x</em>{i}\right)$, 从而解决<br>了上溢出。</li></ul><h3 id="log-softmax-溢出风险"><a href="#log-softmax-溢出风险" class="headerlink" title="log softmax 溢出风险"></a>log softmax 溢出风险</h3><ul><li><p>当 $\overrightarrow{\mathbf{x}}$ 的分量 $x_{i}$ 较小时， $\operatorname{softmax}(\overrightarrow{\mathbf{x}})_{i}$ 的计算结果可能为 0 。此时 $\log \operatorname{softmax}(\overrightarrow{\mathbf{x}})$ 趋向于负无穷，因此存在<br>数值稳定性问题。</p></li><li><p>通常需要设计专门的函数来计算 $\log$ softmax，而不是将 $\operatorname{softmax}$ 的结果传递给 $\log$ 函数。</p></li><li><p>$\log \operatorname{softmax}(\cdot)$ 函数应用非常广泛。通常将 $\operatorname{softmax}$ 函数的输出作为模型的输出。由于一般使用样本的 交叉商作为目标函数，因此需要用到 $\operatorname{softmax}$ 输出的对数。</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/3_numerical_computaion.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/3_numerical_computaion.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VS code 远程调试 python 代码无法识别相对路径解决方案</title>
    <link href="/2021/07/17/software/ide/vs-code-remote-relative-path/vs-code-remote-relative-path/"/>
    <url>/2021/07/17/software/ide/vs-code-remote-relative-path/vs-code-remote-relative-path/</url>
    
    <content type="html"><![CDATA[<blockquote><p>VS code 刚刚配置远程调试时无法识别相对路径，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>VS code 刚刚配置好 remote ssh 远程调试，python 代码执行时不会进入工程目录：</p></blockquote><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#  <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/env /</span>root<span class="hljs-regexp">/anaconda3/</span>bin<span class="hljs-regexp">/python /</span>root<span class="hljs-regexp">/.vscode-server/</span>extensions<span class="hljs-regexp">/ms-python.python-2021.6.944021595/</span>pythonFiles<span class="hljs-regexp">/lib/</span>python<span class="hljs-regexp">/debugpy/</span>launcher <span class="hljs-number">35911</span> -- <span class="hljs-regexp">/workspace/</span>nfs<span class="hljs-regexp">/datasets/</span>VVD_Win_Share<span class="hljs-regexp">/Bearing/</span>ng_faker/demo.py <br></code></pre></td></tr></table></figure><h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><blockquote><p>python 插件设置中没有设置<code>终端执行命令时使用文件的路径代替现在打开的目录</code>。</p></blockquote><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>搜索配置 <code>execute in file</code>：</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210717114300.png"></p><ul><li>解决问题：</li></ul><blockquote><p>再次运行代码时会进入当前工程目录再执行程序</p></blockquote><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">#  cd <span class="hljs-regexp">/workspace/</span>nfs<span class="hljs-regexp">/datasets/</span>VVD_Win_Share<span class="hljs-regexp">/Bearing/</span>ng_faker ; <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/env /</span>root<span class="hljs-regexp">/anaconda3/</span>bin<span class="hljs-regexp">/python /</span>root<span class="hljs-regexp">/.vscode-server/</span>extensions<span class="hljs-regexp">/ms-python.python-2021.6.944021595/</span>pythonFiles<span class="hljs-regexp">/lib/</span>python<span class="hljs-regexp">/debugpy/</span>launcher <span class="hljs-number">38703</span> -- <span class="hljs-regexp">/workspace/</span>nfs<span class="hljs-regexp">/datasets/</span>VVD_Win_Share<span class="hljs-regexp">/Bearing/</span>ng_faker/demo.py <br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.zhihu.com/question/313379182">https://www.zhihu.com/question/313379182</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>VS code</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDE</tag>
      
      <tag>VS code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VS code An SSH installation couldn&#39;t be found 问题解决方案</title>
    <link href="/2021/07/17/software/ide/vs-code-ssh-not-found/vs-code-ssh-not-found/"/>
    <url>/2021/07/17/software/ide/vs-code-ssh-not-found/vs-code-ssh-not-found/</url>
    
    <content type="html"><![CDATA[<blockquote><p>使用VS code 配置远程调试时可能报错<code>An SSH installation couldn&#39;t be found</code>，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>安装 remote 插件连接远程主机时报错：</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210717095940.png"></p><h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><ol><li>没有安装 ssh 工具</li><li>没有将 ssh 添加到系统路径</li></ol><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ol><li>安装 git bash</li></ol><blockquote><p><a href="https://gitforwindows.org/">https://gitforwindows.org/</a></p></blockquote><ul><li>安装好后在 gitbash 中可以使用ssh命令，但是外部 cmd 不可以</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ssh -V</span><br>OpenSSH_8.5p1, OpenSSL 1.1.1k  25 Mar 2021<br></code></pre></td></tr></table></figure><ol start="2"><li>将ssh添加到系统路径</li></ol><ul><li>可以在 git bash 中查看ssh的位置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">where</span> ssh</span><br>E:\Program Files\Git\usr\bin\ssh.exe<br></code></pre></td></tr></table></figure><ul><li>将<code>E:\Program Files\Git\usr\bin</code> 添加到系统 path 中</li><li>使得在 cmd 中可以访问 ssh</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210717101703.png"></p><ul><li>此时再使用 VS code 访问远程主机就不会报ssh找不到的错误了</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/weixin_43425561/article/details/108565718">https://blog.csdn.net/weixin_43425561/article/details/108565718</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>VS code</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDE</tag>
      
      <tag>VS code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows Xshell 会话文件保存与复用</title>
    <link href="/2021/07/17/windows/reuse-xsehll-sessions/reuse-xsehll-sessions/"/>
    <url>/2021/07/17/windows/reuse-xsehll-sessions/reuse-xsehll-sessions/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Xshell 是方便好用的ssh管理软件，在重装操作系统时，之前的会话不想重复配置一遍，需要保存当前的会话配置，在新系统下运行，本文记录方案。</p></blockquote><span id="more"></span><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><blockquote><p>会话都是 Xshell 存下来的配置文件，只需要备份文件，放在新软件配置文件的位置即可。</p></blockquote><h3 id="会话配置文件"><a href="#会话配置文件" class="headerlink" title="会话配置文件"></a>会话配置文件</h3><blockquote><p>配置文件路径：</p></blockquote><ul><li><p><code>文档</code> -&gt; <code>NetSarang Computer</code> -&gt; <code>7</code> -&gt; <code>Xshell</code> -&gt; <code>Sessions</code></p></li><li><p>将会话文件保存，在新软件中复制过去即可</p></li><li><p><strong>注意</strong>：复用配置会话时密码会置空，需要重新输入密码</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://jingyan.baidu.com/article/cbcede0764a6b402f40b4da6.html">https://jingyan.baidu.com/article/cbcede0764a6b402f40b4da6.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 11 mmcv-full 1.3.9 安装记录</title>
    <link href="/2021/07/16/deep_learning/windows-mmcv-1-3-9-install/windows-mmcv-1-3-9-install/"/>
    <url>/2021/07/16/deep_learning/windows-mmcv-1-3-9-install/windows-mmcv-1-3-9-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>之前记录过<a href="https://www.zywvvd.com/2021/04/20/deep_learning/windows-mmcv-1-2-7-install/windows-mmcv-1-2-7-install/">mmcv-full 1.2.7 在Win 10 下的安装记录</a>，和 <a href="https://www.zywvvd.com/2021/06/16/deep_learning/windows-mmcv-1-3-6-install/windows-mmcv-1-3-6-install/">Windows 10 mmcv-full 1.3.6 安装记录</a>，本以为可以安享一段时间宁静，突然发现1.3.6训练有问题，重新安装了mmcv-full 1.3.9，本文记录安装过程。</p></blockquote><span id="more"></span><h3 id="环境记录"><a href="#环境记录" class="headerlink" title="环境记录"></a>环境记录</h3><ul><li>Win 11 专业版</li><li>Python 3.8.5 （Anaconda3-2020.11）</li><li>显卡型号 GTX 1660</li><li>显卡驱动  470.14</li><li>CUDA 11.1</li><li>cuDNN 8.2.1</li><li>PyTorch 1.8.1 + cu11.1</li><li>torchvision 0.9.1 + cu11.1</li><li>VS 2019 Community</li><li>MMCV 1.3.9</li></ul><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><blockquote><p>按照记录的环境逐步搭建，这是我安装mmcv时的环境，可以根据个人情况酌情调整，注意各个环境之间的版本依赖</p></blockquote><h4 id="Python-3-8-5"><a href="#Python-3-8-5" class="headerlink" title="Python 3.8.5"></a>Python 3.8.5</h4><ul><li>安装 Anaconda3-2020.11 可以得到配套的 python 3.8.5</li></ul><blockquote><p>其他版本也可以，建议 3.7 以上 python</p></blockquote><h4 id="显卡驱动"><a href="#显卡驱动" class="headerlink" title="显卡驱动"></a>显卡驱动</h4><blockquote><p>可以参考之前的<a href="https://www.zywvvd.com/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/#%E5%8D%87%E7%BA%A7%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8">链接</a> </p></blockquote><ul><li>我们的目标是安装CUDA 11.1</li><li>根据<a href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html">官网CUDA版本与驱动版本的关系表</a></li></ul><table><thead><tr><th></th><th><strong>Toolkit Driver Version</strong></th><th></th><th><strong>Minimum Required Driver Version*</strong></th><th></th></tr></thead><tbody><tr><td><strong>CUDA Toolkit</strong></td><td>Linux x86_64 Driver Version</td><td>Windows x86_64 Driver Version</td><td>Linux x86_64 Driver Version</td><td>Windows x86_64 Driver Version</td></tr><tr><td>CUDA 11.3.0 GA</td><td>&gt;=465.19.01</td><td>&gt;=465.89</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.2.2 Update 2</td><td>&gt;=460.32.03</td><td>&gt;=461.33</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.2.1 Update 1</td><td>&gt;=460.32.03</td><td>&gt;=461.09</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.2.0 GA</td><td>&gt;=460.27.03</td><td>&gt;=460.82</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.1.1 Update 1</td><td>&gt;=455.32</td><td>&gt;=456.81</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.1 GA</td><td>&gt;=455.23</td><td>&gt;=456.38</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.0.3 Update 1</td><td>&gt;= 450.51.06</td><td>&gt;= 451.82</td><td>&gt;= 450.51.06</td><td>&gt;= 451.82</td></tr><tr><td>CUDA 11.0.2 GA</td><td>&gt;= 450.51.05</td><td>&gt;= 451.48</td><td>&gt;= 450.51.06</td><td>&gt;= 451.48</td></tr><tr><td>CUDA 11.0.1 RC</td><td>&gt;= 450.36.06</td><td>&gt;= 451.22</td><td>&gt;= 450.51.06</td><td>&gt;= 451.22</td></tr><tr><td>CUDA 10.2.89</td><td>&gt;= 440.33</td><td>&gt;= 441.22</td><td>&gt;= 440.33</td><td>&gt;= 441.22</td></tr><tr><td>CUDA 10.1 (10.1.105 general release, and updates)</td><td>&gt;= 418.39</td><td>&gt;= 418.96</td><td>&gt;= 418.39</td><td>&gt;= 418.96</td></tr><tr><td>CUDA 10.0.130</td><td>&gt;= 410.48</td><td>&gt;= 411.31</td><td>&gt;= 410.48</td><td>&gt;= 411.31</td></tr><tr><td>CUDA 9.2 (9.2.148 Update 1)</td><td>&gt;= 396.37</td><td>&gt;= 398.26</td><td>&gt;= 396.37</td><td>&gt;= 398.26</td></tr><tr><td>CUDA 9.2 (9.2.88)</td><td>&gt;= 396.26</td><td>&gt;= 397.44</td><td>&gt;= 396.26</td><td>&gt;= 397.44</td></tr><tr><td>CUDA 9.1 (9.1.85)</td><td>&gt;= 390.46</td><td>&gt;= 391.29</td><td>&gt;= 390.46</td><td>&gt;= 391.29</td></tr><tr><td>CUDA 9.0 (9.0.76)</td><td>&gt;= 384.81</td><td>&gt;= 385.54</td><td>&gt;= 384.81</td><td>&gt;= 385.54</td></tr><tr><td>CUDA 8.0 (8.0.61 GA2)</td><td>&gt;= 375.26</td><td>&gt;= 376.51</td><td>&gt;= 375.26</td><td>&gt;= 376.51</td></tr><tr><td>CUDA 8.0 (8.0.44)</td><td>&gt;= 367.48</td><td>&gt;= 369.30</td><td>&gt;= 367.48</td><td>&gt;= 369.30</td></tr><tr><td>CUDA 7.5 (7.5.16)</td><td>&gt;= 352.31</td><td>&gt;= 353.66</td><td>&gt;= 352.31</td><td>&gt;= 353.66</td></tr><tr><td>CUDA 7.0 (7.0.28)</td><td>&gt;= 346.46</td><td>&gt;= 347.62</td><td>&gt;= 346.46</td><td>&gt;= 347.62</td></tr></tbody></table><ul><li>我们需要在Win 10 安装 456.81 以上版本的显卡驱动</li><li>在<a href="https://www.nvidia.cn/geforce/drivers/">官网</a>搜索自己的显卡，选择合适的版本下载安装即可</li><li>我下载的是 470.14 版本的显卡驱动</li></ul><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><br>C:\Users\Administrator&gt;nvidia-smi<br>Fri Jul 16 18:41:46 2021<br>+-----------------------------------------------------------------------------+<br>|<span class="hljs-string"> NVIDIA-SMI 470.14       Driver Version: 470.14       CUDA Version: 11.3     </span>|<br>|<span class="hljs-string">-------------------------------+----------------------+----------------------+</span><br><span class="hljs-string"></span>|<span class="hljs-string"> GPU  Name            TCC/WDDM </span>|<span class="hljs-string"> Bus-Id        Disp.A </span>|<span class="hljs-string"> Volatile Uncorr. ECC </span>|<br>|<span class="hljs-string"> Fan  Temp  Perf  Pwr:Usage/Cap</span>|<span class="hljs-string">         Memory-Usage </span>|<span class="hljs-string"> GPU-Util  Compute M. </span>|<br>|<span class="hljs-string">                               </span>|<span class="hljs-string">                      </span>|<span class="hljs-string">               MIG M. </span>|<br>|<span class="hljs-string">===============================+======================+======================</span>|<br>|<span class="hljs-string">   0  NVIDIA GeForce ... WDDM  </span>|<span class="hljs-string"> 00000000:01:00.0  On </span>|<span class="hljs-string">                  N/A </span>|<br>|<span class="hljs-string">  0%   50C    P8    15W / 135W </span>|<span class="hljs-string">    427MiB /  6144MiB </span>|<span class="hljs-string">      2%      Default </span>|<br>|<span class="hljs-string">                               </span>|<span class="hljs-string">                      </span>|<span class="hljs-string">                  N/A </span>|<br>+-------------------------------+----------------------+----------------------+<br><br>+-----------------------------------------------------------------------------+<br>|<span class="hljs-string"> Processes:                                                                  </span>|<br>|<span class="hljs-string">  GPU   GI   CI        PID   Type   Process name                  GPU Memory </span>|<br>|<span class="hljs-string">        ID   ID                                                   Usage      </span>|<br>|<span class="hljs-string">=============================================================================</span>|<br>|<span class="hljs-string">    0   N/A  N/A      1148    C+G   Insufficient Permissions        N/A      </span>|<br>|<span class="hljs-string">    0   N/A  N/A      1860    C+G   C:\Windows\explorer.exe         N/A      </span>|<br>|<span class="hljs-string">    0   N/A  N/A      4176    C+G   ...lPanel\SystemSettings.exe    N/A      </span>|<br>|<span class="hljs-string">    0   N/A  N/A      5072    C+G   ...b3d8bbwe\WinStore.App.exe    N/A      </span>|<br>|<span class="hljs-string">    0   N/A  N/A      6916    C+G   ...n1h2txyewy\SearchHost.exe    N/A      </span>|<br>|<span class="hljs-string">    0   N/A  N/A      7740    C+G   ...y\ShellExperienceHost.exe    N/A      </span>|<br>|<span class="hljs-string">    0   N/A  N/A     11232    C+G   ...2txyewy\TextInputHost.exe    N/A      </span>|<br>+-----------------------------------------------------------------------------+<br><br><br></code></pre></td></tr></table></figure><h4 id="CUDA-11-1"><a href="#CUDA-11-1" class="headerlink" title="CUDA 11.1"></a>CUDA 11.1</h4><blockquote><p>当前 （2021.06.16）最新 cuda 版本 11.3，pytorch 和 mmcv 还不支持，因此建议当前最高cuda版本11.1</p></blockquote><ul><li>在官网下载即可</li></ul><p><a href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a></p><ul><li><p>具体流程可以参考<a href="https://www.zywvvd.com/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/#CUDA%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE">之前的链接</a></p></li><li><p>注意安装时勾掉 <code>Visual Studio Intgration</code></p></li><li><p>可能会报<code>Nsight Visual Studio Edition 安装失败</code>的错误</p><ul><li><a href="https://www.zywvvd.com/2021/06/15/deep_learning/environment/cuda-install-error/cuda-install-error/">解决方案</a></li></ul></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">C</span>:\Users\Administrator&gt;nvcc -V<br><span class="hljs-attribute">nvcc</span>: NVIDIA (R) Cuda compiler driver<br><span class="hljs-attribute">Copyright</span> (c) <span class="hljs-number">2005</span>-<span class="hljs-number">2020</span> NVIDIA Corporation<br><span class="hljs-attribute">Built</span> <span class="hljs-literal">on</span> Tue_Sep_<span class="hljs-number">15</span>_<span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">04</span>_Pacific_Daylight_Time_<span class="hljs-number">2020</span><br><span class="hljs-attribute">Cuda</span> compilation tools, release <span class="hljs-number">11</span>.<span class="hljs-number">1</span>, V<span class="hljs-number">11</span>.<span class="hljs-number">1</span>.<span class="hljs-number">74</span><br><span class="hljs-attribute">Build</span> cuda_<span class="hljs-number">11</span>.<span class="hljs-number">1</span>.relgpu_drvr<span class="hljs-number">455</span>TC<span class="hljs-number">455</span>_<span class="hljs-number">06</span>.<span class="hljs-number">29069683</span>_<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h4 id="cuDNN-8-2-1"><a href="#cuDNN-8-2-1" class="headerlink" title="cuDNN 8.2.1"></a>cuDNN 8.2.1</h4><ul><li>针对CUDA 11.1， cuDnn 可选择的版本其实有好几个<ul><li>8.0.4 支持 11.1</li><li>8.1.1 支持11.0、11.1、11.2 </li><li>8.2.1 支持 11.X </li></ul></li><li>以上几个版本应该都可以用，我选择了 8.2.1</li><li>具体步骤参考<a href="https://www.zywvvd.com/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/#cuDNN-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85">之前的链接</a></li><li>官网链接（有时比较慢）：<a href="https://developer.nvidia.com/zh-cn/cudnn">https://developer.nvidia.com/zh-cn/cudnn</a></li><li>下载后直接粘贴到CUDA文件夹即可</li></ul><h4 id="PyTorch-1-8-1-cu11-1-torchvision-0-9-1-cu11-1"><a href="#PyTorch-1-8-1-cu11-1-torchvision-0-9-1-cu11-1" class="headerlink" title="PyTorch 1.8.1 + cu11.1 / torchvision 0.9.1 + cu11.1"></a>PyTorch 1.8.1 + cu11.1 / torchvision 0.9.1 + cu11.1</h4><ul><li>此处一定要安装 1.8 以上的torch</li><li>因为 mmcv 在CUDA 11.1 下仅支持 1.8 版本的 torch</li></ul><table><thead><tr><th>CUDA</th><th>torch 1.8</th><th>torch 1.7</th><th>torch 1.6</th><th>torch 1.5</th><th>torch 1.4</th><th>torch 1.3</th></tr></thead><tbody><tr><td>11.1</td><td>install</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>11.0</td><td></td><td>install</td><td></td><td></td><td></td><td></td></tr><tr><td>10.2</td><td>install</td><td>install</td><td>install</td><td>install</td><td></td><td></td></tr><tr><td>10.1</td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td></tr><tr><td>9.2</td><td></td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td></tr><tr><td>cpu</td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td></tr></tbody></table><ul><li><p>可以使用<a href="https://pytorch.org/get-started/locally/">官方命令</a>安装</p><ul><li>conda</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> install pytorch torchvision torchaudio cudatoolkit=<span class="hljs-number">11</span>.<span class="hljs-number">1</span> -c pytorch -c conda-forge<br></code></pre></td></tr></table></figure><ul><li>pip</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pip3</span> install torch==<span class="hljs-number">1</span>.<span class="hljs-number">9</span>.<span class="hljs-number">0</span>+cu<span class="hljs-number">111</span> torchvision==<span class="hljs-number">0</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>+cu<span class="hljs-number">111</span> torchaudio===<span class="hljs-number">0</span>.<span class="hljs-number">9</span>.<span class="hljs-number">0</span> -f https://download.pytorch.org/whl/torch_stable.html<br></code></pre></td></tr></table></figure></li><li><p>也可以直接去下载目录选择自己需要的版本：</p></li></ul><p><a href="https://download.pytorch.org/whl/torch_stable.html">https://download.pytorch.org/whl/torch_stable.html</a></p><h4 id="VS-2019-Community"><a href="#VS-2019-Community" class="headerlink" title="VS 2019 Community"></a>VS 2019 Community</h4><ul><li>可以参考<a href="https://www.zywvvd.com/2021/04/20/deep_learning/windows-mmcv-1-2-7-install/windows-mmcv-1-2-7-install/#%E5%AE%89%E8%A3%85-visual-studio-2019">之前的链接</a></li><li>当时下载的专业版，事实证明社区版就足够了</li><li>安装C++桌面开发功能即可</li><li>将 <code>C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.27.29110\bin\Hostx86\x64 </code>添加到环境变量 PATH, 这样 cl.exe 可以在控制台中所有路径中被调用。</li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">C:\Users\Administrator&gt;cl<br>用于 x64 的 Microsoft <span class="hljs-params">(R)</span> C/C++ 优化编译器 19.29.30037 版<br>版权所有<span class="hljs-params">(C)</span> Microsoft Corporation。保留所有权利。<br><br>用法: cl [ 选项<span class="hljs-string">...</span> ] 文件名<span class="hljs-string">...</span> [ <span class="hljs-string">/link</span> 链接选项<span class="hljs-string">...</span> ]<br></code></pre></td></tr></table></figure><blockquote><p>网上有说仅安装VS C++ build tools 也可以，我尝试的时候没有成功</p></blockquote><h3 id="安装-MMCV-1-3-9"><a href="#安装-MMCV-1-3-9" class="headerlink" title="安装 MMCV 1.3.9"></a>安装 MMCV 1.3.9</h3><ul><li>github 链接： <a href="https://github.com/open-mmlab/mmcv">https://github.com/open-mmlab/mmcv</a></li></ul><blockquote><p>可以重新构建 anaconda 环境</p></blockquote><ul><li>下载代码，调整到指定tag，构建基础依赖环境</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/open-mmlab/mm</span>cv.git<br>cd mmcv<br>git checkout v1.<span class="hljs-number">3.9</span><br>pip3 install -r requirements.txt<br></code></pre></td></tr></table></figure><h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><table><thead><tr><th>变量名称</th><th>值（需要根据个人情况调整）</th></tr></thead><tbody><tr><td>CUDA_HOME</td><td>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.1</td></tr><tr><td>CUDA_PATH</td><td>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.1</td></tr><tr><td>MMCV_WITH_OPS</td><td>1</td></tr><tr><td>MAX_JOBS</td><td>4</td></tr><tr><td>path</td><td>记得添加 cl.exe 所在文件夹</td></tr><tr><td>TORCH_CUDA_ARCH_LIST</td><td>7.5</td></tr></tbody></table><ul><li>其中<code>TORCH_CUDA_ARCH_LIST</code>一项表示的是显卡算力，可以在官网查询，我的查不到，可以用CUDA工具查询：</li></ul><blockquote><p>执行： <code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.1\extras\demo_suite\deviceQuery.exe</code></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">C:\&gt;&quot;C:\Program</span> <span class="hljs-string">Files\NVIDIA</span> <span class="hljs-string">GPU</span> <span class="hljs-string">Computing</span> <span class="hljs-string">Toolkit\CUDA\v11.1\extras\demo_suite\deviceQuery.exe&quot;</span><br><span class="hljs-string">C:\Program</span> <span class="hljs-string">Files\NVIDIA</span> <span class="hljs-string">GPU</span> <span class="hljs-string">Computing</span> <span class="hljs-string">Toolkit\CUDA\v11.1\extras\demo_suite\deviceQuery.exe</span> <span class="hljs-string">Starting...</span><br><br> <span class="hljs-string">CUDA</span> <span class="hljs-string">Device</span> <span class="hljs-string">Query</span> <span class="hljs-string">(Runtime</span> <span class="hljs-string">API)</span> <span class="hljs-string">version</span> <span class="hljs-string">(CUDART</span> <span class="hljs-string">static</span> <span class="hljs-string">linking)</span><br><br><span class="hljs-string">Detected</span> <span class="hljs-number">1</span> <span class="hljs-string">CUDA</span> <span class="hljs-string">Capable</span> <span class="hljs-string">device(s)</span><br><br><span class="hljs-attr">Device 0:</span> <span class="hljs-string">&quot;GeForce GTX 1660&quot;</span><br>  <span class="hljs-string">CUDA</span> <span class="hljs-string">Driver</span> <span class="hljs-string">Version</span> <span class="hljs-string">/</span> <span class="hljs-string">Runtime</span> <span class="hljs-string">Version</span>          <span class="hljs-number">11.2</span> <span class="hljs-string">/</span> <span class="hljs-number">11.1</span><br>  <span class="hljs-attr">CUDA Capability Major/Minor version number:</span>    <span class="hljs-number">7.5</span><br>  <span class="hljs-attr">Total amount of global memory:</span>                 <span class="hljs-number">6144 </span><span class="hljs-string">MBytes</span> <span class="hljs-string">(6442450944</span> <span class="hljs-string">bytes)</span><br>  <span class="hljs-string">(22)</span> <span class="hljs-string">Multiprocessors,</span> <span class="hljs-string">(</span> <span class="hljs-number">64</span><span class="hljs-string">)</span> <span class="hljs-attr">CUDA Cores/MP:</span>     <span class="hljs-number">1408 </span><span class="hljs-string">CUDA</span> <span class="hljs-string">Cores</span><br>  <span class="hljs-attr">GPU Max Clock rate:</span>                            <span class="hljs-number">1815 </span><span class="hljs-string">MHz</span> <span class="hljs-string">(1.81</span> <span class="hljs-string">GHz)</span><br>  <span class="hljs-attr">Memory Clock rate:</span>                             <span class="hljs-number">4001 </span><span class="hljs-string">Mhz</span><br>  <span class="hljs-attr">Memory Bus Width:</span>                              <span class="hljs-number">192</span><span class="hljs-string">-bit</span><br>  <span class="hljs-attr">L2 Cache Size:</span>                                 <span class="hljs-number">1572864</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-string">Maximum</span> <span class="hljs-string">Texture</span> <span class="hljs-string">Dimension</span> <span class="hljs-string">Size</span> <span class="hljs-string">(x,y,z)</span>         <span class="hljs-string">1D=(131072),</span> <span class="hljs-string">2D=(131072,</span> <span class="hljs-number">65536</span><span class="hljs-string">),</span> <span class="hljs-string">3D=(16384,</span> <span class="hljs-number">16384</span><span class="hljs-string">,</span> <span class="hljs-number">16384</span><span class="hljs-string">)</span><br>  <span class="hljs-string">Maximum</span> <span class="hljs-string">Layered</span> <span class="hljs-string">1D</span> <span class="hljs-string">Texture</span> <span class="hljs-string">Size,</span> <span class="hljs-string">(num)</span> <span class="hljs-string">layers</span>  <span class="hljs-string">1D=(32768),</span> <span class="hljs-number">2048 </span><span class="hljs-string">layers</span><br>  <span class="hljs-string">Maximum</span> <span class="hljs-string">Layered</span> <span class="hljs-string">2D</span> <span class="hljs-string">Texture</span> <span class="hljs-string">Size,</span> <span class="hljs-string">(num)</span> <span class="hljs-string">layers</span>  <span class="hljs-string">2D=(32768,</span> <span class="hljs-number">32768</span><span class="hljs-string">),</span> <span class="hljs-number">2048 </span><span class="hljs-string">layers</span><br>  <span class="hljs-attr">Total amount of constant memory:</span>               <span class="hljs-string">zu</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-attr">Total amount of shared memory per block:</span>       <span class="hljs-string">zu</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-attr">Total number of registers available per block:</span> <span class="hljs-number">65536</span><br>  <span class="hljs-attr">Warp size:</span>                                     <span class="hljs-number">32</span><br>  <span class="hljs-attr">Maximum number of threads per multiprocessor:</span>  <span class="hljs-number">1024</span><br>  <span class="hljs-attr">Maximum number of threads per block:</span>           <span class="hljs-number">1024</span><br>  <span class="hljs-string">Max</span> <span class="hljs-string">dimension</span> <span class="hljs-string">size</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">thread</span> <span class="hljs-string">block</span> <span class="hljs-string">(x,y,z):</span> <span class="hljs-string">(1024,</span> <span class="hljs-number">1024</span><span class="hljs-string">,</span> <span class="hljs-number">64</span><span class="hljs-string">)</span><br>  <span class="hljs-string">Max</span> <span class="hljs-string">dimension</span> <span class="hljs-string">size</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">grid</span> <span class="hljs-string">size</span>    <span class="hljs-string">(x,y,z):</span> <span class="hljs-string">(2147483647,</span> <span class="hljs-number">65535</span><span class="hljs-string">,</span> <span class="hljs-number">65535</span><span class="hljs-string">)</span><br>  <span class="hljs-attr">Maximum memory pitch:</span>                          <span class="hljs-string">zu</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-attr">Texture alignment:</span>                             <span class="hljs-string">zu</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-attr">Concurrent copy and kernel execution:</span>          <span class="hljs-literal">Yes</span> <span class="hljs-string">with</span> <span class="hljs-number">6</span> <span class="hljs-string">copy</span> <span class="hljs-string">engine(s)</span><br>  <span class="hljs-attr">Run time limit on kernels:</span>                     <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Integrated GPU sharing Host Memory:</span>            <span class="hljs-literal">No</span><br>  <span class="hljs-attr">Support host page-locked memory mapping:</span>       <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Alignment requirement for Surfaces:</span>            <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Device has ECC support:</span>                        <span class="hljs-string">Disabled</span><br>  <span class="hljs-string">CUDA</span> <span class="hljs-string">Device</span> <span class="hljs-string">Driver</span> <span class="hljs-string">Mode</span> <span class="hljs-string">(TCC</span> <span class="hljs-string">or</span> <span class="hljs-string">WDDM):</span>         <span class="hljs-string">WDDM</span> <span class="hljs-string">(Windows</span> <span class="hljs-string">Display</span> <span class="hljs-string">Driver</span> <span class="hljs-string">Model)</span><br>  <span class="hljs-string">Device</span> <span class="hljs-string">supports</span> <span class="hljs-string">Unified</span> <span class="hljs-string">Addressing</span> <span class="hljs-string">(UVA):</span>      <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Device supports Compute Preemption:</span>            <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Supports Cooperative Kernel Launch:</span>            <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Supports MultiDevice Co-op Kernel Launch:</span>      <span class="hljs-literal">No</span><br>  <span class="hljs-attr">Device PCI Domain ID / Bus ID / location ID:</span>   <span class="hljs-number">0</span> <span class="hljs-string">/</span> <span class="hljs-number">1</span> <span class="hljs-string">/</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">Compute Mode:</span><br>     <span class="hljs-string">&lt;</span> <span class="hljs-string">Default</span> <span class="hljs-string">(multiple</span> <span class="hljs-string">host</span> <span class="hljs-string">threads</span> <span class="hljs-string">can</span> <span class="hljs-string">use</span> <span class="hljs-string">::cudaSetDevice()</span> <span class="hljs-string">with</span> <span class="hljs-string">device</span> <span class="hljs-string">simultaneously)</span> <span class="hljs-string">&gt;</span><br><br><span class="hljs-string">deviceQuery,</span> <span class="hljs-string">CUDA</span> <span class="hljs-string">Driver</span> <span class="hljs-string">=</span> <span class="hljs-string">CUDART,</span> <span class="hljs-string">CUDA</span> <span class="hljs-string">Driver</span> <span class="hljs-string">Version</span> <span class="hljs-string">=</span> <span class="hljs-number">11.2</span><span class="hljs-string">,</span> <span class="hljs-string">CUDA</span> <span class="hljs-string">Runtime</span> <span class="hljs-string">Version</span> <span class="hljs-string">=</span> <span class="hljs-number">11.1</span><span class="hljs-string">,</span> <span class="hljs-string">NumDevs</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-string">Device0</span> <span class="hljs-string">=</span> <span class="hljs-string">GeForce</span> <span class="hljs-string">GTX</span> <span class="hljs-number">1660</span><br><span class="hljs-string">Result</span> <span class="hljs-string">=</span> <span class="hljs-string">PASS</span><br></code></pre></td></tr></table></figure><ul><li>将<code>CUDA Capability Major/Minor version number:    7.5</code>里的值填进<code>TORCH_CUDA_ARCH_LIST</code>中</li></ul><h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim"># build<br><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> build_ext # <span class="hljs-keyword">if</span> success, <span class="hljs-keyword">cl</span> will <span class="hljs-keyword">be</span> launched <span class="hljs-keyword">to</span> compile ops<br># install<br><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> develop<br></code></pre></td></tr></table></figure><h5 id="检查安装情况"><a href="#检查安装情况" class="headerlink" title="检查安装情况"></a>检查安装情况</h5><ul><li>查看pip包列表<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">C:\Users\Administrator&gt;pip show mmcv-full</span><br><span class="hljs-section">Name: mmcv-full</span><br><span class="hljs-section">Version: 1.3.9</span><br><span class="hljs-section">Summary: OpenMMLab Computer Vision Foundation</span><br><span class="hljs-section">Home-page: https://github.com/open-mmlab/mmcv</span><br><span class="hljs-section">Author: MMCV Authors</span><br><span class="hljs-section">Author-email: openmmlab@gmail.com</span><br><span class="hljs-section">License: UNKNOWN</span><br><span class="hljs-section">Location: e:\programdata\python_external_lib\mmcv</span><br><span class="hljs-section">Requires: addict, numpy, Pillow, pyyaml, yapf, regex</span><br><span class="hljs-section">Required-by:</span><br></code></pre></td></tr></table></figure></li><li>查看编译文件，55个<br><img src="https://photos.zywvvd.com/win11-mt20210716184537.png"></li><li>查看 <code>_ext.cp38-win_amd64.pyd</code>文件是否生成<br><img src="https://photos.zywvvd.com/win11-mt20210716184847.png"></li><li>上述文件生成正常说明安装成功<blockquote><p>正常情况下整个过程纵享丝滑，不需要改任何源码</p></blockquote></li></ul><h3 id="pyd文件"><a href="#pyd文件" class="headerlink" title="pyd文件"></a>pyd文件</h3><ul><li>分享我编译的<code>_ext.cp38-win_amd64.pyd</code>文件，可以安装mmcv-full之后直接放在安装目录中，不需要编译直接可用</li></ul><blockquote><p>当python环境中没有安装pytorch时mmcv不会编译，可以顺利成功安装，这之后再放入pyd文件即可</p><p>文件名：<code>_ext.cp38-win_amd64.pyd</code></p></blockquote><ul><li><p>[由 1660 显卡编译（算力 7.5）]:<a href="https://photos.zywvvd.com/win11-mt_ext.cp38-win_amd64.pyd">https://photos.zywvvd.com/win11-mt_ext.cp38-win_amd64.pyd</a></p></li><li><p>[由 960M 显卡编译（算力 5.0）]: <a href="https://photos.zywvvd.com/vvd-dell-2021-win-10/_ext.cp38-win_amd64.pyd">https://photos.zywvvd.com/vvd-dell-2021-win-10/_ext.cp38-win_amd64.pyd</a></p></li></ul><blockquote><p>前提是CUDA、python、torch、显卡算力等版本需要和我一致才能用</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/lebusini/article/details/117525764">https://blog.csdn.net/lebusini/article/details/117525764</a></li><li><a href="http://allophane.com/index.php/2021/05/26/win10_build_mmcv-full_from_source/">http://allophane.com/index.php/2021/05/26/win10_build_mmcv-full_from_source/</a></li><li><a href="https://github.com/open-mmlab/mmcv">https://github.com/open-mmlab/mmcv</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 10 critical_service_failed 等情况解决办法</title>
    <link href="/2021/07/15/windows/win10-blue-screen-recover/win10-blue-screen-recover/"/>
    <url>/2021/07/15/windows/win10-blue-screen-recover/win10-blue-screen-recover/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Win10 有可能由于驱动变化或补丁兼容性不佳导致蓝屏恢复，无限重启的错误，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><ul><li>无限重启</li><li>提示恢复</li><li>甚至安全模式都可能无法进入</li></ul><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><ul><li>驱动更新</li><li>安装补丁</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="临时解决方案"><a href="#临时解决方案" class="headerlink" title="临时解决方案"></a>临时解决方案</h4><ul><li><p>开机</p></li><li><p>出现错误提示后系统会收集信息然后再次启动，如此反复2次之后启动修复程序，</p></li><li><p>疑难解答 -&gt; 高级选项 -&gt; 启动设置 -&gt; 重启</p></li><li><p>重启后按下数字键 7 或 F7 - 选择<code>禁用驱动程序强制签名</code></p></li></ul><blockquote><p>也有情况可能不是按照这个步骤，核心在于 <strong>禁用驱动程序强制签名</strong></p><p>此时可以正常开机</p></blockquote><h4 id="彻底解决方案"><a href="#彻底解决方案" class="headerlink" title="彻底解决方案"></a>彻底解决方案</h4><ul><li><p>使用临时解决方案开机</p></li><li><p>在开始按钮点击右键，选择“命令提示符（管理员）”</p></li><li><p>执行以下命令（复制后，在命令提示符中单击鼠标右键即可完成粘贴，然后按回车键执行）：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">bcdedit.<span class="hljs-keyword">exe</span> /<span class="hljs-keyword">set</span> nointegritychecks <span class="hljs-keyword">on</span><br></code></pre></td></tr></table></figure></li><li><p>命令瞬间执行完毕，若想恢复默认验证，执行如下命令即可：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">bcdedit.exe /<span class="hljs-keyword">set</span> nointegritychecks <span class="hljs-keyword">off</span><br></code></pre></td></tr></table></figure></li><li><p>而且用命令行关闭签名后,先<code>关机</code> (<strong>注意不是重启</strong>) ,然后再启动就不用按F7了</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://tieba.baidu.com/p/5855560956#121663170628l">http://tieba.baidu.com/p/5855560956#121663170628l</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 11 拖拽窗口延时问题解决方案</title>
    <link href="/2021/07/13/windows/win11-delay-drag/win11-delay-drag/"/>
    <url>/2021/07/13/windows/win11-delay-drag/win11-delay-drag/</url>
    
    <content type="html"><![CDATA[<blockquote><p>莫名其妙更新到 Win 11 体验版后出现严重的拖拽窗口延时，深恶痛绝。本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><blockquote><p>升级 Win 11 更新 KB5004745 补丁后拖拽窗口延时极高</p><p>拖一下窗口之后2分钟只能看着鼠标自己在那动，啥都干不了</p><p>主要是资源管理器的窗口，其他的一般不会</p></blockquote><h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><ul><li>Win11 的透明特效吃过多资源导致</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>开始搜索 <code>transparency effects</code></li><li>进入 <code>辅助功能 -&gt; 视觉效果</code> 设置栏</li><li>关闭透明效果可以很大程度上解决问题</li><li>建议把动画效果也一并关了</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210713170826.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://tieba.baidu.com/p/7441123576">https://tieba.baidu.com/p/7441123576</a></li><li><a href="https://tieba.baidu.com/p/7441661265">https://tieba.baidu.com/p/7441661265</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>为 jupyterlab 添加 debugger 扩展</title>
    <link href="/2021/07/08/python/jupyter-lab-extension/jupyter-lab-extension/"/>
    <url>/2021/07/08/python/jupyter-lab-extension/jupyter-lab-extension/</url>
    
    <content type="html"><![CDATA[<blockquote><p>jupyterlab 作为 jupyter 的扩展版本，易用性强，结果保存很合理。突然发现可以添加debugger插件，实现在jupyterlab中调试代码，本文记录方法。</p></blockquote><span id="more"></span><h3 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h3><ul><li>安装 Anaconda</li><li>安装 jupyterlab</li><li>安装 node.js</li><li>安装 xpython</li><li>建立 jupyterlab 工程</li><li>搜索并安装插件</li><li>使用插件进行debug</li></ul><h3 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h3><h4 id="安装Anaconda"><a href="#安装Anaconda" class="headerlink" title="安装Anaconda"></a>安装Anaconda</h4><ul><li>下载地址： <a href="https://www.anaconda.com/products/individual#Downloads">https://www.anaconda.com/products/individual#Downloads</a></li><li>下载安装包安装即可，需要配置环境变量</li></ul><h4 id="安装jupyterlab"><a href="#安装jupyterlab" class="headerlink" title="安装jupyterlab"></a>安装jupyterlab</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install jupyterlab<br></code></pre></td></tr></table></figure><h4 id="安装-node-js"><a href="#安装-node-js" class="headerlink" title="安装 node.js"></a>安装 node.js</h4><blockquote><p>如果不装会报错：</p></blockquote><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs subunit">An error occurred installing &lt;code&gt;@jupyterlab/debugger-extension&lt;/code&gt;.<br><span class="hljs-keyword">Error </span>message:<br><br>Please install Node.js and npm before continuing installation. You may be able to install Node.js from your package manager, from conda, or directly from the Node.js website (https://nodejs.org).<br></code></pre></td></tr></table></figure><ul><li>下载地址：<a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></li><li>Win 下载 <strong>Windows Installer (.msi)</strong><ul><li>直接安装即可</li></ul></li><li>Linux 下载 <strong>Linux Binaries (x64)</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://nodejs.org/dist/v14.17.3/node-v14.17.3-linux-x64.tar.xz    // 下载<br>tar xf node-v14.17.3-linux-x64.tar.xz                                   // 解压<br></code></pre></td></tr></table></figure><blockquote><p>之后添加环境变量到 <code>/etc/profile</code> 或 <code>~/.bashrc</code> 文件</p></blockquote><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">export PATH=<span class="hljs-variable">$PATH</span><span class="hljs-symbol">:/path_to/node-v14</span>.<span class="hljs-number">17.3</span>-linux-x64/bin<br></code></pre></td></tr></table></figure><ul><li>测试</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># node -v</span><br><span class="hljs-attribute">v14</span>.<span class="hljs-number">17</span>.<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h4 id="安装-xpython"><a href="#安装-xpython" class="headerlink" title="安装 xpython"></a>安装 xpython</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> xeus-python<br></code></pre></td></tr></table></figure><blockquote><p>JupyterLab 2.0+</p><p>xeus-python 0.8.0+</p><p>notebook 6+</p></blockquote><ul><li>随后可以使用 xpython</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210708194440.png"></p><h4 id="建立-jupyterlab-工程"><a href="#建立-jupyterlab-工程" class="headerlink" title="建立 jupyterlab 工程"></a>建立 jupyterlab 工程</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">jupyter lab <span class="hljs-params">--allow-root</span> <span class="hljs-params">--no-browser</span> <span class="hljs-params">--ip</span> 0.0.0.0 <span class="hljs-params">--port</span> 8080 <span class="hljs-params">--notebook-dir</span> <span class="hljs-string">/workspace/nfs</span><br></code></pre></td></tr></table></figure><ul><li>有需要映射端口的同学可以参考 <a href="https://www.zywvvd.com/2021/03/22/python/jupyter-map/jupyter-map/">从服务器映射 jupyter 到本机应用</a></li></ul><h4 id="搜索并安装插件"><a href="#搜索并安装插件" class="headerlink" title="搜索并安装插件"></a>搜索并安装插件</h4><ul><li>进入 jupyterlab, enable Warning 中的内容即可使用扩展</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210708194722.png"></p><ul><li>搜索并安装插件</li></ul><blockquote><p>安装 <a href="https://github.com/jupyterlab/jupyterlab">@jupyterlab/debugger</a></p><ul><li>可以搜索之间单击 <code>install</code></li><li>也可以执行命令</li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">jupyter labextension install @jupyterlab/<span class="hljs-keyword">debugger</span><br></code></pre></td></tr></table></figure></blockquote><h4 id="使用插件进行debug"><a href="#使用插件进行debug" class="headerlink" title="使用插件进行debug"></a>使用插件进行debug</h4><ul><li>建立 xpython 工程</li><li>设置断点，debug 程序</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210708194849.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/sirdong/p/11447739.html">https://www.cnblogs.com/sirdong/p/11447739.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>jupyter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 10 mmcv-full 1.3.6 安装记录</title>
    <link href="/2021/06/16/deep_learning/windows-mmcv-1-3-6-install/windows-mmcv-1-3-6-install/"/>
    <url>/2021/06/16/deep_learning/windows-mmcv-1-3-6-install/windows-mmcv-1-3-6-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>之前记录过<a href="https://www.zywvvd.com/2021/04/20/deep_learning/windows-mmcv-1-2-7-install/windows-mmcv-1-2-7-install/">mmcv-full 1.2.7 在Win 10 下的安装记录</a>，当时的环境版本太低，现在需要升级，重新安装了mmcv-full 1.3.6，本文记录安装过程。</p></blockquote><span id="more"></span><h3 id="环境记录"><a href="#环境记录" class="headerlink" title="环境记录"></a>环境记录</h3><ul><li>Win 10 专业版</li><li>Python 3.8.5 （Anaconda3-2020.11）</li><li>显卡型号 GTX 1660</li><li>显卡驱动  461.92</li><li>CUDA 11.1</li><li>cuDNN 8.0.4</li><li>PyTorch 1.8.1 + cu11.1</li><li>torchvision 0.9.1 + cu11.1</li><li>VS 2019 Community</li><li>MMCV 1.3.6</li></ul><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><blockquote><p>按照记录的环境逐步搭建，这是我安装mmcv时的环境，可以根据个人情况酌情调整，注意各个环境之间的版本依赖</p></blockquote><h4 id="Python-3-8-5"><a href="#Python-3-8-5" class="headerlink" title="Python 3.8.5"></a>Python 3.8.5</h4><ul><li>安装 Anaconda3-2020.11 可以得到配套的 python 3.8.5</li></ul><blockquote><p>其他版本也可以，建议 3.7 以上 python</p></blockquote><h4 id="显卡驱动"><a href="#显卡驱动" class="headerlink" title="显卡驱动"></a>显卡驱动</h4><blockquote><p>可以参考之前的<a href="https://www.zywvvd.com/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/#%E5%8D%87%E7%BA%A7%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8">链接</a> </p></blockquote><ul><li>我们的目标是安装CUDA 11.1</li><li>根据<a href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html">官网CUDA版本与驱动版本的关系表</a></li></ul><table><thead><tr><th></th><th><strong>Toolkit Driver Version</strong></th><th></th><th><strong>Minimum Required Driver Version*</strong></th><th></th></tr></thead><tbody><tr><td><strong>CUDA Toolkit</strong></td><td>Linux x86_64 Driver Version</td><td>Windows x86_64 Driver Version</td><td>Linux x86_64 Driver Version</td><td>Windows x86_64 Driver Version</td></tr><tr><td>CUDA 11.3.0 GA</td><td>&gt;=465.19.01</td><td>&gt;=465.89</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.2.2 Update 2</td><td>&gt;=460.32.03</td><td>&gt;=461.33</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.2.1 Update 1</td><td>&gt;=460.32.03</td><td>&gt;=461.09</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.2.0 GA</td><td>&gt;=460.27.03</td><td>&gt;=460.82</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.1.1 Update 1</td><td>&gt;=455.32</td><td>&gt;=456.81</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.1 GA</td><td>&gt;=455.23</td><td>&gt;=456.38</td><td>&gt;= 450.80.02</td><td>&gt;= 456.38</td></tr><tr><td>CUDA 11.0.3 Update 1</td><td>&gt;= 450.51.06</td><td>&gt;= 451.82</td><td>&gt;= 450.51.06</td><td>&gt;= 451.82</td></tr><tr><td>CUDA 11.0.2 GA</td><td>&gt;= 450.51.05</td><td>&gt;= 451.48</td><td>&gt;= 450.51.06</td><td>&gt;= 451.48</td></tr><tr><td>CUDA 11.0.1 RC</td><td>&gt;= 450.36.06</td><td>&gt;= 451.22</td><td>&gt;= 450.51.06</td><td>&gt;= 451.22</td></tr><tr><td>CUDA 10.2.89</td><td>&gt;= 440.33</td><td>&gt;= 441.22</td><td>&gt;= 440.33</td><td>&gt;= 441.22</td></tr><tr><td>CUDA 10.1 (10.1.105 general release, and updates)</td><td>&gt;= 418.39</td><td>&gt;= 418.96</td><td>&gt;= 418.39</td><td>&gt;= 418.96</td></tr><tr><td>CUDA 10.0.130</td><td>&gt;= 410.48</td><td>&gt;= 411.31</td><td>&gt;= 410.48</td><td>&gt;= 411.31</td></tr><tr><td>CUDA 9.2 (9.2.148 Update 1)</td><td>&gt;= 396.37</td><td>&gt;= 398.26</td><td>&gt;= 396.37</td><td>&gt;= 398.26</td></tr><tr><td>CUDA 9.2 (9.2.88)</td><td>&gt;= 396.26</td><td>&gt;= 397.44</td><td>&gt;= 396.26</td><td>&gt;= 397.44</td></tr><tr><td>CUDA 9.1 (9.1.85)</td><td>&gt;= 390.46</td><td>&gt;= 391.29</td><td>&gt;= 390.46</td><td>&gt;= 391.29</td></tr><tr><td>CUDA 9.0 (9.0.76)</td><td>&gt;= 384.81</td><td>&gt;= 385.54</td><td>&gt;= 384.81</td><td>&gt;= 385.54</td></tr><tr><td>CUDA 8.0 (8.0.61 GA2)</td><td>&gt;= 375.26</td><td>&gt;= 376.51</td><td>&gt;= 375.26</td><td>&gt;= 376.51</td></tr><tr><td>CUDA 8.0 (8.0.44)</td><td>&gt;= 367.48</td><td>&gt;= 369.30</td><td>&gt;= 367.48</td><td>&gt;= 369.30</td></tr><tr><td>CUDA 7.5 (7.5.16)</td><td>&gt;= 352.31</td><td>&gt;= 353.66</td><td>&gt;= 352.31</td><td>&gt;= 353.66</td></tr><tr><td>CUDA 7.0 (7.0.28)</td><td>&gt;= 346.46</td><td>&gt;= 347.62</td><td>&gt;= 346.46</td><td>&gt;= 347.62</td></tr></tbody></table><ul><li>我们需要在Win 10 安装 456.81 以上版本的显卡驱动</li><li>在<a href="https://www.nvidia.cn/geforce/drivers/">官网</a>搜索自己的显卡，选择合适的版本下载安装即可</li><li>我下载的是 461.92 版本的显卡驱动</li></ul><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">C:\Users\Administrator&gt;nvidia-smi<br>Wed Jun 16 09:46:55 2021<br>+-----------------------------------------------------------------------------+<br>|<span class="hljs-string"> NVIDIA-SMI 461.92       Driver Version: 461.92       CUDA Version: 11.2     </span>|<br>|<span class="hljs-string">-------------------------------+----------------------+----------------------+</span><br><span class="hljs-string"></span>|<span class="hljs-string"> GPU  Name            TCC/WDDM </span>|<span class="hljs-string"> Bus-Id        Disp.A </span>|<span class="hljs-string"> Volatile Uncorr. ECC </span>|<br>|<span class="hljs-string"> Fan  Temp  Perf  Pwr:Usage/Cap</span>|<span class="hljs-string">         Memory-Usage </span>|<span class="hljs-string"> GPU-Util  Compute M. </span>|<br>|<span class="hljs-string">                               </span>|<span class="hljs-string">                      </span>|<span class="hljs-string">               MIG M. </span>|<br>|<span class="hljs-string">===============================+======================+======================</span>|<br>|<span class="hljs-string">   0  GeForce GTX 1660   WDDM  </span>|<span class="hljs-string"> 00000000:01:00.0  On </span>|<span class="hljs-string">                  N/A </span>|<br>|<span class="hljs-string"> 27%   38C    P8     4W / 120W </span>|<span class="hljs-string">    288MiB /  6144MiB </span>|<span class="hljs-string">     12%      Default </span>|<br>|<span class="hljs-string">                               </span>|<span class="hljs-string">                      </span>|<span class="hljs-string">                  N/A </span>|<br>+-------------------------------+----------------------+----------------------+<br><br>+-----------------------------------------------------------------------------+<br>|<span class="hljs-string"> Processes:                                                                  </span>|<br>|<span class="hljs-string">  GPU   GI   CI        PID   Type   Process name                  GPU Memory </span>|<br>|<span class="hljs-string">        ID   ID                                                   Usage      </span>|<br>|<span class="hljs-string">=============================================================================</span>|<br>|<span class="hljs-string">    0   N/A  N/A      1236    C+G   Insufficient Permissions        N/A      </span>|<br>+-----------------------------------------------------------------------------+<br><br></code></pre></td></tr></table></figure><h4 id="CUDA-11-1"><a href="#CUDA-11-1" class="headerlink" title="CUDA 11.1"></a>CUDA 11.1</h4><blockquote><p>当前 （2021.06.16）最新 cuda 版本 11.3，pytorch 和 mmcv 还不支持，因此建议当前最高cuda版本11.1</p></blockquote><ul><li>在官网下载即可</li></ul><p><a href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a></p><ul><li><p>具体流程可以参考<a href="https://www.zywvvd.com/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/#CUDA%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE">之前的链接</a></p></li><li><p>注意安装时勾掉 <code>Visual Studio Intgration</code></p></li><li><p>可能会报<code>Nsight Visual Studio Edition 安装失败</code>的错误</p><ul><li><a href="https://www.zywvvd.com/2021/06/15/deep_learning/environment/cuda-install-error/cuda-install-error/">解决方案</a></li></ul></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">C</span>:\Users\Administrator&gt;nvcc -V<br><span class="hljs-attribute">nvcc</span>: NVIDIA (R) Cuda compiler driver<br><span class="hljs-attribute">Copyright</span> (c) <span class="hljs-number">2005</span>-<span class="hljs-number">2020</span> NVIDIA Corporation<br><span class="hljs-attribute">Built</span> <span class="hljs-literal">on</span> Tue_Sep_<span class="hljs-number">15</span>_<span class="hljs-number">19</span>:<span class="hljs-number">12</span>:<span class="hljs-number">04</span>_Pacific_Daylight_Time_<span class="hljs-number">2020</span><br><span class="hljs-attribute">Cuda</span> compilation tools, release <span class="hljs-number">11</span>.<span class="hljs-number">1</span>, V<span class="hljs-number">11</span>.<span class="hljs-number">1</span>.<span class="hljs-number">74</span><br><span class="hljs-attribute">Build</span> cuda_<span class="hljs-number">11</span>.<span class="hljs-number">1</span>.relgpu_drvr<span class="hljs-number">455</span>TC<span class="hljs-number">455</span>_<span class="hljs-number">06</span>.<span class="hljs-number">29069683</span>_<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h4 id="cuDNN-8-0-4"><a href="#cuDNN-8-0-4" class="headerlink" title="cuDNN 8.0.4"></a>cuDNN 8.0.4</h4><ul><li>针对CUDA 11.1， cuDnn 可选择的版本其实有好几个<ul><li>8.0.4 支持 11.1</li><li>8.1.1 支持11.0、11.1、11.2 </li><li>8.2.1 支持 11.X </li></ul></li><li>以上几个版本应该都可以用，稳妥起见我选择了 8.0.4，其他的没有亲测过</li><li>具体步骤参考<a href="https://www.zywvvd.com/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/#cuDNN-%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85">之前的链接</a></li><li>官网链接（有时比较慢）：<a href="https://developer.nvidia.com/zh-cn/cudnn">https://developer.nvidia.com/zh-cn/cudnn</a></li><li>下载后直接粘贴到CUDA文件夹即可</li></ul><h4 id="PyTorch-1-8-1-cu11-1-torchvision-0-9-1-cu11-1"><a href="#PyTorch-1-8-1-cu11-1-torchvision-0-9-1-cu11-1" class="headerlink" title="PyTorch 1.8.1 + cu11.1 / torchvision 0.9.1 + cu11.1"></a>PyTorch 1.8.1 + cu11.1 / torchvision 0.9.1 + cu11.1</h4><ul><li>此处一定要安装 1.8 以上的torch</li><li>因为 mmcv 在CUDA 11.1 下仅支持 1.8 版本的 torch</li></ul><table><thead><tr><th>CUDA</th><th>torch 1.8</th><th>torch 1.7</th><th>torch 1.6</th><th>torch 1.5</th><th>torch 1.4</th><th>torch 1.3</th></tr></thead><tbody><tr><td>11.1</td><td>install</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>11.0</td><td></td><td>install</td><td></td><td></td><td></td><td></td></tr><tr><td>10.2</td><td>install</td><td>install</td><td>install</td><td>install</td><td></td><td></td></tr><tr><td>10.1</td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td></tr><tr><td>9.2</td><td></td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td></tr><tr><td>cpu</td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td><td>install</td></tr></tbody></table><ul><li><p>可以使用<a href="https://pytorch.org/get-started/locally/">官方命令</a>安装</p><ul><li>conda</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> install pytorch torchvision torchaudio cudatoolkit=<span class="hljs-number">11</span>.<span class="hljs-number">1</span> -c pytorch -c conda-forge<br></code></pre></td></tr></table></figure><ul><li>pip</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pip3</span> install torch==<span class="hljs-number">1</span>.<span class="hljs-number">9</span>.<span class="hljs-number">0</span>+cu<span class="hljs-number">111</span> torchvision==<span class="hljs-number">0</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>+cu<span class="hljs-number">111</span> torchaudio===<span class="hljs-number">0</span>.<span class="hljs-number">9</span>.<span class="hljs-number">0</span> -f https://download.pytorch.org/whl/torch_stable.html<br></code></pre></td></tr></table></figure></li><li><p>也可以直接去下载目录选择自己需要的版本：</p></li></ul><p><a href="https://download.pytorch.org/whl/torch_stable.html">https://download.pytorch.org/whl/torch_stable.html</a></p><h4 id="VS-2019-Community"><a href="#VS-2019-Community" class="headerlink" title="VS 2019 Community"></a>VS 2019 Community</h4><ul><li>可以参考<a href="https://www.zywvvd.com/2021/04/20/deep_learning/windows-mmcv-1-2-7-install/windows-mmcv-1-2-7-install/#%E5%AE%89%E8%A3%85-visual-studio-2019">之前的链接</a></li><li>当时下载的专业版，事实证明社区版就足够了</li><li>安装C++桌面开发功能即可</li><li>将 <code>C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.27.29110\bin\Hostx86\x64 </code>添加到环境变量 PATH, 这样 cl.exe 可以在控制台中所有路径中被调用。</li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">C:\Users\Administrator&gt;cl<br>用于 x64 的 Microsoft <span class="hljs-params">(R)</span> C/C++ 优化编译器 19.29.30037 版<br>版权所有<span class="hljs-params">(C)</span> Microsoft Corporation。保留所有权利。<br><br>用法: cl [ 选项<span class="hljs-string">...</span> ] 文件名<span class="hljs-string">...</span> [ <span class="hljs-string">/link</span> 链接选项<span class="hljs-string">...</span> ]<br></code></pre></td></tr></table></figure><blockquote><p>网上有说仅安装VS C++ build tools 也可以，我尝试的时候没有成功</p></blockquote><h3 id="安装-MMCV-1-3-6"><a href="#安装-MMCV-1-3-6" class="headerlink" title="安装 MMCV 1.3.6"></a>安装 MMCV 1.3.6</h3><ul><li>github 链接： <a href="https://github.com/open-mmlab/mmcv">https://github.com/open-mmlab/mmcv</a></li></ul><blockquote><p>可以重新构建 anaconda 环境</p></blockquote><ul><li>下载代码，调整到指定tag，构建基础依赖环境</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/open-mmlab/mm</span>cv.git<br>cd mmcv<br>git checkout v1.<span class="hljs-number">3.6</span><br>pip3 install -r requirements.txt<br></code></pre></td></tr></table></figure><h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><table><thead><tr><th>变量名称</th><th>值（需要根据个人情况调整）</th></tr></thead><tbody><tr><td>CUDA_HOME</td><td>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.1</td></tr><tr><td>CUDA_PATH</td><td>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.1</td></tr><tr><td>MMCV_WITH_OPS</td><td>1</td></tr><tr><td>MAX_JOBS</td><td>4</td></tr><tr><td>path</td><td>记得添加 cl.exe 所在文件夹</td></tr><tr><td>TORCH_CUDA_ARCH_LIST</td><td>7.5</td></tr></tbody></table><ul><li>其中<code>TORCH_CUDA_ARCH_LIST</code>一项表示的是显卡算力，可以在官网查询，我的查不到，可以用CUDA工具查询：</li></ul><blockquote><p>执行： <code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.1\extras\demo_suite\deviceQuery.exe</code></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">C:\&gt;&quot;C:\Program</span> <span class="hljs-string">Files\NVIDIA</span> <span class="hljs-string">GPU</span> <span class="hljs-string">Computing</span> <span class="hljs-string">Toolkit\CUDA\v11.1\extras\demo_suite\deviceQuery.exe&quot;</span><br><span class="hljs-string">C:\Program</span> <span class="hljs-string">Files\NVIDIA</span> <span class="hljs-string">GPU</span> <span class="hljs-string">Computing</span> <span class="hljs-string">Toolkit\CUDA\v11.1\extras\demo_suite\deviceQuery.exe</span> <span class="hljs-string">Starting...</span><br><br> <span class="hljs-string">CUDA</span> <span class="hljs-string">Device</span> <span class="hljs-string">Query</span> <span class="hljs-string">(Runtime</span> <span class="hljs-string">API)</span> <span class="hljs-string">version</span> <span class="hljs-string">(CUDART</span> <span class="hljs-string">static</span> <span class="hljs-string">linking)</span><br><br><span class="hljs-string">Detected</span> <span class="hljs-number">1</span> <span class="hljs-string">CUDA</span> <span class="hljs-string">Capable</span> <span class="hljs-string">device(s)</span><br><br><span class="hljs-attr">Device 0:</span> <span class="hljs-string">&quot;GeForce GTX 1660&quot;</span><br>  <span class="hljs-string">CUDA</span> <span class="hljs-string">Driver</span> <span class="hljs-string">Version</span> <span class="hljs-string">/</span> <span class="hljs-string">Runtime</span> <span class="hljs-string">Version</span>          <span class="hljs-number">11.2</span> <span class="hljs-string">/</span> <span class="hljs-number">11.1</span><br>  <span class="hljs-attr">CUDA Capability Major/Minor version number:</span>    <span class="hljs-number">7.5</span><br>  <span class="hljs-attr">Total amount of global memory:</span>                 <span class="hljs-number">6144 </span><span class="hljs-string">MBytes</span> <span class="hljs-string">(6442450944</span> <span class="hljs-string">bytes)</span><br>  <span class="hljs-string">(22)</span> <span class="hljs-string">Multiprocessors,</span> <span class="hljs-string">(</span> <span class="hljs-number">64</span><span class="hljs-string">)</span> <span class="hljs-attr">CUDA Cores/MP:</span>     <span class="hljs-number">1408 </span><span class="hljs-string">CUDA</span> <span class="hljs-string">Cores</span><br>  <span class="hljs-attr">GPU Max Clock rate:</span>                            <span class="hljs-number">1815 </span><span class="hljs-string">MHz</span> <span class="hljs-string">(1.81</span> <span class="hljs-string">GHz)</span><br>  <span class="hljs-attr">Memory Clock rate:</span>                             <span class="hljs-number">4001 </span><span class="hljs-string">Mhz</span><br>  <span class="hljs-attr">Memory Bus Width:</span>                              <span class="hljs-number">192</span><span class="hljs-string">-bit</span><br>  <span class="hljs-attr">L2 Cache Size:</span>                                 <span class="hljs-number">1572864</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-string">Maximum</span> <span class="hljs-string">Texture</span> <span class="hljs-string">Dimension</span> <span class="hljs-string">Size</span> <span class="hljs-string">(x,y,z)</span>         <span class="hljs-string">1D=(131072),</span> <span class="hljs-string">2D=(131072,</span> <span class="hljs-number">65536</span><span class="hljs-string">),</span> <span class="hljs-string">3D=(16384,</span> <span class="hljs-number">16384</span><span class="hljs-string">,</span> <span class="hljs-number">16384</span><span class="hljs-string">)</span><br>  <span class="hljs-string">Maximum</span> <span class="hljs-string">Layered</span> <span class="hljs-string">1D</span> <span class="hljs-string">Texture</span> <span class="hljs-string">Size,</span> <span class="hljs-string">(num)</span> <span class="hljs-string">layers</span>  <span class="hljs-string">1D=(32768),</span> <span class="hljs-number">2048 </span><span class="hljs-string">layers</span><br>  <span class="hljs-string">Maximum</span> <span class="hljs-string">Layered</span> <span class="hljs-string">2D</span> <span class="hljs-string">Texture</span> <span class="hljs-string">Size,</span> <span class="hljs-string">(num)</span> <span class="hljs-string">layers</span>  <span class="hljs-string">2D=(32768,</span> <span class="hljs-number">32768</span><span class="hljs-string">),</span> <span class="hljs-number">2048 </span><span class="hljs-string">layers</span><br>  <span class="hljs-attr">Total amount of constant memory:</span>               <span class="hljs-string">zu</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-attr">Total amount of shared memory per block:</span>       <span class="hljs-string">zu</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-attr">Total number of registers available per block:</span> <span class="hljs-number">65536</span><br>  <span class="hljs-attr">Warp size:</span>                                     <span class="hljs-number">32</span><br>  <span class="hljs-attr">Maximum number of threads per multiprocessor:</span>  <span class="hljs-number">1024</span><br>  <span class="hljs-attr">Maximum number of threads per block:</span>           <span class="hljs-number">1024</span><br>  <span class="hljs-string">Max</span> <span class="hljs-string">dimension</span> <span class="hljs-string">size</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">thread</span> <span class="hljs-string">block</span> <span class="hljs-string">(x,y,z):</span> <span class="hljs-string">(1024,</span> <span class="hljs-number">1024</span><span class="hljs-string">,</span> <span class="hljs-number">64</span><span class="hljs-string">)</span><br>  <span class="hljs-string">Max</span> <span class="hljs-string">dimension</span> <span class="hljs-string">size</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">grid</span> <span class="hljs-string">size</span>    <span class="hljs-string">(x,y,z):</span> <span class="hljs-string">(2147483647,</span> <span class="hljs-number">65535</span><span class="hljs-string">,</span> <span class="hljs-number">65535</span><span class="hljs-string">)</span><br>  <span class="hljs-attr">Maximum memory pitch:</span>                          <span class="hljs-string">zu</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-attr">Texture alignment:</span>                             <span class="hljs-string">zu</span> <span class="hljs-string">bytes</span><br>  <span class="hljs-attr">Concurrent copy and kernel execution:</span>          <span class="hljs-literal">Yes</span> <span class="hljs-string">with</span> <span class="hljs-number">6</span> <span class="hljs-string">copy</span> <span class="hljs-string">engine(s)</span><br>  <span class="hljs-attr">Run time limit on kernels:</span>                     <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Integrated GPU sharing Host Memory:</span>            <span class="hljs-literal">No</span><br>  <span class="hljs-attr">Support host page-locked memory mapping:</span>       <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Alignment requirement for Surfaces:</span>            <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Device has ECC support:</span>                        <span class="hljs-string">Disabled</span><br>  <span class="hljs-string">CUDA</span> <span class="hljs-string">Device</span> <span class="hljs-string">Driver</span> <span class="hljs-string">Mode</span> <span class="hljs-string">(TCC</span> <span class="hljs-string">or</span> <span class="hljs-string">WDDM):</span>         <span class="hljs-string">WDDM</span> <span class="hljs-string">(Windows</span> <span class="hljs-string">Display</span> <span class="hljs-string">Driver</span> <span class="hljs-string">Model)</span><br>  <span class="hljs-string">Device</span> <span class="hljs-string">supports</span> <span class="hljs-string">Unified</span> <span class="hljs-string">Addressing</span> <span class="hljs-string">(UVA):</span>      <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Device supports Compute Preemption:</span>            <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Supports Cooperative Kernel Launch:</span>            <span class="hljs-literal">Yes</span><br>  <span class="hljs-attr">Supports MultiDevice Co-op Kernel Launch:</span>      <span class="hljs-literal">No</span><br>  <span class="hljs-attr">Device PCI Domain ID / Bus ID / location ID:</span>   <span class="hljs-number">0</span> <span class="hljs-string">/</span> <span class="hljs-number">1</span> <span class="hljs-string">/</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">Compute Mode:</span><br>     <span class="hljs-string">&lt;</span> <span class="hljs-string">Default</span> <span class="hljs-string">(multiple</span> <span class="hljs-string">host</span> <span class="hljs-string">threads</span> <span class="hljs-string">can</span> <span class="hljs-string">use</span> <span class="hljs-string">::cudaSetDevice()</span> <span class="hljs-string">with</span> <span class="hljs-string">device</span> <span class="hljs-string">simultaneously)</span> <span class="hljs-string">&gt;</span><br><br><span class="hljs-string">deviceQuery,</span> <span class="hljs-string">CUDA</span> <span class="hljs-string">Driver</span> <span class="hljs-string">=</span> <span class="hljs-string">CUDART,</span> <span class="hljs-string">CUDA</span> <span class="hljs-string">Driver</span> <span class="hljs-string">Version</span> <span class="hljs-string">=</span> <span class="hljs-number">11.2</span><span class="hljs-string">,</span> <span class="hljs-string">CUDA</span> <span class="hljs-string">Runtime</span> <span class="hljs-string">Version</span> <span class="hljs-string">=</span> <span class="hljs-number">11.1</span><span class="hljs-string">,</span> <span class="hljs-string">NumDevs</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-string">Device0</span> <span class="hljs-string">=</span> <span class="hljs-string">GeForce</span> <span class="hljs-string">GTX</span> <span class="hljs-number">1660</span><br><span class="hljs-string">Result</span> <span class="hljs-string">=</span> <span class="hljs-string">PASS</span><br></code></pre></td></tr></table></figure><ul><li>将<code>CUDA Capability Major/Minor version number:    7.5</code>里的值填进<code>TORCH_CUDA_ARCH_LIST</code>中</li></ul><h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim"># build<br><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> build_ext # <span class="hljs-keyword">if</span> success, <span class="hljs-keyword">cl</span> will <span class="hljs-keyword">be</span> launched <span class="hljs-keyword">to</span> compile ops<br># install<br><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> develop<br></code></pre></td></tr></table></figure><h5 id="检查安装情况"><a href="#检查安装情况" class="headerlink" title="检查安装情况"></a>检查安装情况</h5><ul><li>查看pip包列表<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">C:\&gt;pip show mmcv-full</span><br><span class="hljs-section">Name: mmcv-full</span><br><span class="hljs-section">Version: 1.3.6</span><br><span class="hljs-section">Summary: OpenMMLab Computer Vision Foundation</span><br><span class="hljs-section">Home-page: https://github.com/open-mmlab/mmcv</span><br><span class="hljs-section">Author: MMCV Authors</span><br><span class="hljs-section">Author-email: openmmlab@gmail.com</span><br><span class="hljs-section">License: UNKNOWN</span><br><span class="hljs-section">Location: f:\mmcv</span><br><span class="hljs-section">Requires: addict, numpy, Pillow, pyyaml, yapf, regex</span><br><span class="hljs-section">Required-by:</span><br></code></pre></td></tr></table></figure></li><li>查看编译文件，55个<br><img src="http://photos.zywvvd.com/feng_matrixtime/20210616102150.png"></li><li>查看 <code>_ext.cp38-win_amd64.pyd</code>文件是否生成<br><img src="https://photos.zywvvd.com/feng_matrixtime/20210616102405.png"></li><li>上述文件生成正常说明安装成功<blockquote><p>正常情况下整个过程纵享丝滑，不需要改任何源码</p></blockquote></li></ul><h3 id="未解决的问题"><a href="#未解决的问题" class="headerlink" title="未解决的问题"></a>未解决的问题</h3><ul><li>其实上述步骤我重复了很多遍，一直提示 <code>error: Microsoft Visual C++ 14.0 is required</code> 尝试各种办法，装了啥都不行</li><li>最终重装系统解决的问题</li><li>最后分享我编译的<code>_ext.cp38-win_amd64.pyd</code><a href="https://photos.zywvvd.com/feng_matrixtime/_ext.cp38-win_amd64.pyd">文件</a>，可以安装mmcv-full之后直接放在安装目录中，不需要编译直接可用</li></ul><blockquote><p>前提是CUDA、python、torch等版本需要和我一致才能用</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/lebusini/article/details/117525764">https://blog.csdn.net/lebusini/article/details/117525764</a></li><li><a href="http://allophane.com/index.php/2021/05/26/win10_build_mmcv-full_from_source/">http://allophane.com/index.php/2021/05/26/win10_build_mmcv-full_from_source/</a></li><li><a href="https://github.com/open-mmlab/mmcv">https://github.com/open-mmlab/mmcv</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cmd/powershell/anaconda prompt提示“系统找不到指定的路径”</title>
    <link href="/2021/06/15/windows/win-cmd-no-path-found/win-cmd-no-path-found/"/>
    <url>/2021/06/15/windows/win-cmd-no-path-found/win-cmd-no-path-found/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在Win10 cmd 或 anaconda 命令行中，会遇到输入命令前先弹出<code>“系统找不到指定的路径”</code>的问题。本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><blockquote><p>打开命令行 (cmd.exe)或者powershell，anaconda prompt等，提示“系统找不到指定的路径”(“The system cannot find the path specified”)</p></blockquote><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><ul><li>在windows系统中，打开一个命令行 (cmd.exe)或者类似的anaconda prompt, 下面两个注册表项会被自动检测:</li></ul><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>oftware<span class="hljs-symbol">\M</span>icrosoft<span class="hljs-symbol">\C</span>ommand Processor<br>HKEY_CURRENT_USER<span class="hljs-symbol">\S</span>oftware<span class="hljs-symbol">\M</span>icrosoft<span class="hljs-symbol">\C</span>ommand Processor<br></code></pre></td></tr></table></figure><ul><li>如果这两项中存在存在名为”AutoRun”的值，则其值（可能是一个exe文件或者bat文件）将被“预执行”（autoexec-like)，因此需要你检查这两个注册表项的内容(两个项都可以包含”AutoRun”，且都会执行，先后顺序没详细看——有心人可以去写两个.bat文件去看看）</li></ul><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><ul><li>键盘按下win+r键入regedit（或者在命令行中键入regedit）打开注册表，查看下面两个注册表项</li></ul><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">HKEY_LOCAL_MACHINE<span class="hljs-symbol">\S</span>oftware<span class="hljs-symbol">\M</span>icrosoft<span class="hljs-symbol">\C</span>ommand Processor<br>HKEY_CURRENT_USER<span class="hljs-symbol">\S</span>oftware<span class="hljs-symbol">\M</span>icrosoft<span class="hljs-symbol">\C</span>ommand Processor<br></code></pre></td></tr></table></figure><ul><li>找到”AutoRun”项后双击”AutoRun”查看其值，检查其值要执行的文件（命令）是否存在（合理）。</li></ul><h3 id="关于win-r命令"><a href="#关于win-r命令" class="headerlink" title="关于win+r命令"></a>关于win+r命令</h3><ul><li>win+r键入的文件名如果是.exe, .bat等应该与cmd直接键入效果相同</li><li>win+r可以快捷地以管理员权限运行程序，比如输入win+r键入cmd，按下CTRL + SHIFT + ENTER，相当于以管理员方式运行了程序。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_34769162/article/details/107792932">https://blog.csdn.net/qq_34769162/article/details/107792932</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows 10</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>Windows 10</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Win 10 安装NVIDIA CUDA 11.1 Nsight Visual Studio Edition 安装失败</title>
    <link href="/2021/06/15/deep_learning/environment/cuda-install-error/cuda-install-error/"/>
    <url>/2021/06/15/deep_learning/environment/cuda-install-error/cuda-install-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在Win 10 安装 CUDA 11.1 时出现安装失败的提示，经检查发现是<code>Nsight Visual Studio Edition</code>安装失败，本文记录跳过安装的方法。</p></blockquote><span id="more"></span><h3 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h3><p><img src="https://photos.zywvvd.com/images_matrixtime/20210615165319.png"></p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>在安装时选择自定义</li><li>关闭 <code>Nsight VSE</code> 安装选项即可</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210615165547.png"></p><blockquote><p>目前没发现什么副作用</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://bbs.csdn.net/topics/398305834">https://bbs.csdn.net/topics/398305834</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>泊松编辑 （Poisson Image Editing）</title>
    <link href="/2021/06/08/image_processing/poisson-editing/poisson-editing/"/>
    <url>/2021/06/08/image_processing/poisson-editing/poisson-editing/</url>
    
    <content type="html"><![CDATA[<blockquote><p>图像融合在cv领域有着广泛用途，其中2003年的论文 <a href="http://xeds.eu/upload/files/poisson.pdf">Poisson Image Editing - 2003</a> 因其开创性与效果拔群成为了相关领域的经典之作。而且该算法在传统图像融合算法中效果拔群，对该领域影响深远。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>泊松图像编辑是一种全自动的“无缝融合”两张图像的技术，由Microsoft Research UK的Patrick Perez，Michel Gangnet, and Andrew Blake在论文“Poisson Image Editing”中首次提出。</p></blockquote><ul><li>泊松编辑主要解决的是两个不同来源信号的无缝融合（seamless cloning）问题</li><li>目的是将源图像$g$的一部分内容$\Omega$融合到目标图像$f*$同样大小区域上，并使其自然融合过渡</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210608235148.png"></p><blockquote><p>左上：目标图像$f*$，区域$\Omega$是被源图像内容替换的部分；</p><p>左下：源图像$g$，区域$\Omega$内的内容需要贴到目标图像去</p><p>右上：直接将源图像信息贴过去会有违和的边缘过渡</p><p>右下：将源的信号按照原始梯度关系变化到目标图像边界，达到了无缝融合的效果</p></blockquote><ul><li>泊松编辑的目标是自然地融合来源不同的图像</li><li>将源图像粘贴到目标图像上</li><li>为了保持过渡平滑，顾及了源图像粘贴区域的梯度信息与目标图像的边缘信息</li><li>结合已知信息求解方程组得到泊松编辑图像的结果</li></ul><h3 id="理论介绍"><a href="#理论介绍" class="headerlink" title="理论介绍"></a>理论介绍</h3><p><img src="https://photos.zywvvd.com/icey-mate-book/20210612170823.png"></p><h4 id="符号定义"><a href="#符号定义" class="headerlink" title="符号定义"></a>符号定义</h4><blockquote><p>如上图所示：</p></blockquote><ul><li>图像融合是要把源图像$g$的指定区域$\Omega$融合到目标图像$S$中，边缘区域为$ \partial \Omega $，源图像区域函数$f^*$，目标图像区域函数$f$。</li><li>这里面$g$，$\Omega$，$S$，$ \partial \Omega $，$f^*$都是已知量，需要求的是$f$</li></ul><h4 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h4><blockquote><p>泊松图像编辑的目的是保留源图像的纹理，无缝融入到新图像中。</p><p>实现的思路就是将源图像的梯度保留，应用到目标图像的边界中，解出同时满足梯度和边缘约束条件的方程，得到目标区域像素。</p></blockquote>$$\min _{f} \iint_{\Omega}|\nabla f-\mathbf{v}|^{2} \quad with  \left.\quad f\right|_{\partial \Omega}=\left.f^{*}\right|_{\partial \Omega}$$<ul><li>$∇f$ 指的是图像函数 $f$ 的梯度</li></ul><p>$$<br>\nabla .=\left[\frac{\partial_{.}}{\partial x}, \frac{\partial}{\partial y}\right]<br>$$</p><ul><li>$v$ 在原论文中是指一个<strong>引导向量场（guidance field）</strong>，当用于图像合成时，它指的就是源图像的梯度。</li><li>这意味着上面的变分方程是指在$Ω$ 的区域内，$f$的梯度和源图像的梯度一致，而在$Ω$ 的边缘处f的值则和源图像$f^*$的值一致。这个变分方程的解是如下<strong>泊松方程</strong>在Dirichlet边界条件时的解，这也是为什么我们的融合方式叫做<strong>泊松融合</strong>。</li></ul>$$\Delta f=\operatorname{div} \mathbf{v}\text{ }  over \text{ } \Omega , \text{ }with  \left.f\right|_{\partial \Omega}=\left.f^{*}\right|_{\partial \Omega}$$<h4 id="几个关键和符号说明"><a href="#几个关键和符号说明" class="headerlink" title="几个关键和符号说明"></a>几个关键和符号说明</h4><ul><li>梯度 Gradient：</li></ul><p>$$<br>  \mathbf{v}=(u, v)=\nabla g<br>$$</p><ul><li><a href="https://www.zywvvd.com/2021/06/04/image_processing/laplace-operator/laplace-operator/">拉普拉斯算子  Laplacian</a></li></ul><p>$$<br>\quad \Delta f=\frac{\partial^{2} f}{\partial x^{2}}+\frac{\partial^{2} f}{\partial y^{2}}<br>$$</p><ul><li>散度 Divergence </li></ul>$$\begin{aligned} \operatorname{div} \mathbf{v} &=\frac{\partial u}{\partial x}+\frac{\partial v}{\partial y} \\ &=\frac{\partial^{2} g}{\partial x^{2}}+\frac{\partial^{2} g}{\partial y^{2}} \\ &=\Delta g \end{aligned}$$<h4 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h4><ul><li>也就是$f^*$和$f$的散度对应相等</li><li>同时保证$f^*$和$f$的边界对应相等</li></ul><p>$$<br>\Delta f=\Delta f^* \text{ over }   \Omega , \text{ with } \left.f\right|_{\partial \Omega}=f^{*} \mid \partial \Omega<br>$$</p><h4 id="求解方程"><a href="#求解方程" class="headerlink" title="求解方程"></a>求解方程</h4><ul><li>将泊松方程表示为线性向量形式 $Af=b$</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210616003153.jpg"></p><ul><li>等号的右边是图像$g$中每一个像素的拉普拉斯滤波结果$∆gp$，这很容易理解。未知函数$f$的每个元素构成了等号左边的列向量。而系数矩阵$A$则描述了最关键的$f$的拉普拉斯滤波算子。</li><li>列出方程后就是解方程组了，$A$是稀疏矩阵，每行元素不超过5个，可以用 $f = b / A$计算得到</li></ul><h3 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h3><ul><li>参考了一份github上星星最多的<a href="https://github.com/willemmanuel/poisson-image-editing">泊松图像编辑代码</a>，改成了python3并封装成类方法，供大家参考。</li></ul><blockquote><p>核心类函数为<code>channel_process</code>，输入图像为单通道，<code>mask</code>为0-1的浮点数</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Poisson Image Editing</span><br><span class="hljs-string">William Emmanuel</span><br><span class="hljs-string">wemmanuel3@gatech.edu</span><br><span class="hljs-string">CS 6745 Final Project Fall 2017</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> scipy.sparse <span class="hljs-keyword">import</span> linalg <span class="hljs-keyword">as</span> linalg<br><span class="hljs-keyword">from</span> scipy.sparse <span class="hljs-keyword">import</span> lil_matrix <span class="hljs-keyword">as</span> lil_matrix<br><br><span class="hljs-keyword">import</span> cv2<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Poission</span>:</span><br>    <span class="hljs-comment"># Helper enum</span><br>    OMEGA = <span class="hljs-number">0</span><br>    DEL_OMEGA = <span class="hljs-number">1</span><br>    OUTSIDE = <span class="hljs-number">2</span><br><br>    <span class="hljs-comment"># Determine if a given index is inside omega, on the boundary (del omega),</span><br>    <span class="hljs-comment"># or outside the omega region</span><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">point_location</span>(<span class="hljs-params">cls, index, mask</span>):</span><br>        <span class="hljs-keyword">if</span> cls.in_omega(index, mask) == <span class="hljs-literal">False</span>:<br>            <span class="hljs-keyword">return</span> cls.OUTSIDE<br>        <span class="hljs-keyword">if</span> cls.edge(index, mask) == <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">return</span> cls.DEL_OMEGA<br>        <span class="hljs-keyword">return</span> cls.OMEGA<br><br>    <span class="hljs-comment"># Determine if a given index is either outside or inside omega</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">in_omega</span>(<span class="hljs-params">index, mask</span>):</span><br>        <span class="hljs-keyword">return</span> mask[index] == <span class="hljs-number">1</span><br><br>    <span class="hljs-comment"># Deterimine if a given index is on del omega (boundary)</span><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edge</span>(<span class="hljs-params">cls, index, mask</span>):</span><br>        <span class="hljs-keyword">if</span> cls.in_omega(index, mask) == <span class="hljs-literal">False</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">for</span> pt <span class="hljs-keyword">in</span> cls.get_surrounding(index):<br>            <span class="hljs-comment"># If the point is inside omega, and a surrounding point is not,</span><br>            <span class="hljs-comment"># then we must be on an edge</span><br>            <span class="hljs-keyword">if</span> cls.in_omega(pt, mask) == <span class="hljs-literal">False</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-comment"># Apply the Laplacian operator at a given index</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">lapl_at_index</span>(<span class="hljs-params">source, index</span>):</span><br><br>        i, j = index<br>        edge_num = <span class="hljs-number">0</span><br>        minus_data = <span class="hljs-number">0</span><br><br>        <span class="hljs-keyword">try</span>:<br>            temp = source[i+<span class="hljs-number">1</span>, j]<br>            edge_num += <span class="hljs-number">1</span><br>            minus_data += temp<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">pass</span><br><br>        <span class="hljs-keyword">try</span>:<br>            temp = source[i-<span class="hljs-number">1</span>, j]<br>            edge_num += <span class="hljs-number">1</span><br>            minus_data += temp<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">pass</span><br><br>        <span class="hljs-keyword">try</span>:<br>            temp = source[i, j+<span class="hljs-number">1</span>]<br>            edge_num += <span class="hljs-number">1</span><br>            minus_data += temp<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">pass</span><br><br>        <span class="hljs-keyword">try</span>:<br>            temp = source[i, j-<span class="hljs-number">1</span>]<br>            edge_num += <span class="hljs-number">1</span><br>            minus_data += temp<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">pass</span><br><br>        val = source[i, j] * edge_num - minus_data<br><br>        <span class="hljs-comment"># val = (4 * source[i, j])    \</span><br>        <span class="hljs-comment">#     - (1 * source[i+1, j]) \</span><br>        <span class="hljs-comment">#     - (1 * source[i-1, j]) \</span><br>        <span class="hljs-comment">#     - (1 * source[i, j+1]) \</span><br>        <span class="hljs-comment">#     - (1 * source[i, j-1])</span><br>        <span class="hljs-keyword">return</span> val<br><br>    <span class="hljs-comment"># Find the indicies of omega, or where the mask is 1</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mask_indicies</span>(<span class="hljs-params">mask</span>):</span><br>        nonzero = np.nonzero(mask)<br>        <span class="hljs-keyword">return</span> nonzero[<span class="hljs-number">0</span>], nonzero[<span class="hljs-number">1</span>]<br><br>    <span class="hljs-comment"># Get indicies above, below, to the left and right</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_surrounding</span>(<span class="hljs-params">index</span>):</span><br>        i, j = index<br>        <span class="hljs-keyword">return</span> [(i + <span class="hljs-number">1</span>, j), (i - <span class="hljs-number">1</span>, j), (i, j + <span class="hljs-number">1</span>), (i, j - <span class="hljs-number">1</span>)]<br><br>    <span class="hljs-comment"># Create the A sparse matrix</span><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">poisson_sparse_matrix</span>(<span class="hljs-params">cls, rows, cols</span>):</span><br>        <span class="hljs-comment"># N = number of points in mask</span><br>        N = <span class="hljs-built_in">len</span>(<span class="hljs-built_in">list</span>(rows))<br>        A = lil_matrix((N, N))<br>        <span class="hljs-comment"># Set up row for each point in mask</span><br><br>        points = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(rows, cols))<br>        <span class="hljs-keyword">for</span> i, index <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(points):<br>            <span class="hljs-comment"># Should have 4&#x27;s diagonal</span><br>            A[i, i] = <span class="hljs-number">4</span><br>            <span class="hljs-comment"># Get all surrounding points</span><br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> cls.get_surrounding(index):<br>                <span class="hljs-comment"># If a surrounding point is in the mask, add -1 to index&#x27;s</span><br>                <span class="hljs-comment"># row at correct position</span><br>                <span class="hljs-keyword">if</span> x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> points:<br>                    <span class="hljs-keyword">continue</span><br>                j = points.index(x)<br>                A[i, j] = -<span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> A<br><br>    <span class="hljs-comment"># Main method</span><br>    <span class="hljs-comment"># Does Poisson image editing on one channel given a source, target, and mask</span><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">channel_process</span>(<span class="hljs-params">cls, source, target, mask</span>):</span><br>        rows, cols = cls.mask_indicies(mask)<br><br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(rows) == <span class="hljs-built_in">len</span>(cols)<br>        N = <span class="hljs-built_in">len</span>(rows)<br>        <span class="hljs-comment"># Create poisson A matrix. Contains mostly 0&#x27;s, some 4&#x27;s and -1&#x27;s</span><br>        A = cls.poisson_sparse_matrix(rows, cols)<br>        <span class="hljs-comment"># Create B matrix</span><br>        b = np.zeros(N)<br>        points = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(rows, cols))<br>        <span class="hljs-keyword">for</span> i, index <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(points):<br>            <span class="hljs-comment"># Start with left hand side of discrete equation</span><br>            b[i] = cls.lapl_at_index(source, index)<br>            <span class="hljs-comment"># If on boundry, add in target intensity</span><br>            <span class="hljs-comment"># Creates constraint lapl source = target at boundary</span><br>            <span class="hljs-keyword">if</span> cls.point_location(index, mask) == cls.DEL_OMEGA:<br>                <span class="hljs-keyword">for</span> pt <span class="hljs-keyword">in</span> cls.get_surrounding(index):<br>                    <span class="hljs-keyword">if</span> cls.in_omega(pt, mask) == <span class="hljs-literal">False</span>:<br>                        b[i] += target[pt]<br><br>        <span class="hljs-comment"># Solve for x, unknown intensities</span><br>        x = linalg.cg(A, b)<br>        <span class="hljs-comment"># Copy target photo, make sure as int</span><br>        composite = np.copy(target).astype(<span class="hljs-built_in">int</span>)<br>        <span class="hljs-comment"># Place new intensity on target at given index</span><br>        <span class="hljs-keyword">for</span> i, index <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(points):<br>            composite[index] = x[<span class="hljs-number">0</span>][i]<br><br>        composite = np.clip(composite, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)<br>        <span class="hljs-keyword">return</span> composite.astype(<span class="hljs-string">&#x27;uint8&#x27;</span>)<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gray_channel_3_image</span>(<span class="hljs-params">image</span>):</span><br>        <span class="hljs-keyword">assert</span> image.ndim == <span class="hljs-number">3</span><br>        <span class="hljs-keyword">if</span> (image[:, :, <span class="hljs-number">0</span>] == image[:, :, <span class="hljs-number">1</span>]).<span class="hljs-built_in">all</span>() <span class="hljs-keyword">and</span> (image[:, :, <span class="hljs-number">0</span>] == image[:, :, <span class="hljs-number">2</span>]).<span class="hljs-built_in">all</span>():<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">image_resize</span>(<span class="hljs-params">img_source, shape=<span class="hljs-literal">None</span>, factor=<span class="hljs-literal">None</span></span>):</span><br>        image_H, image_W = img_source.shape[:<span class="hljs-number">2</span>]<br>        <span class="hljs-keyword">if</span> shape <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> cv2.resize(img_source, shape)<br><br>        <span class="hljs-keyword">if</span> factor <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            resized_H = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">round</span>(image_H * factor))<br>            resized_W = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">round</span>(image_W * factor))<br>            <span class="hljs-keyword">return</span> cv2.resize(img_source, [resized_W, resized_H])<br><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> img_source<br><br></code></pre></td></tr></table></figure><h3 id="效果示例"><a href="#效果示例" class="headerlink" title="效果示例"></a>效果示例</h3><table>    <tr>        <td ><center><img src="https://photos.zywvvd.com/icey-mate-book/20210612151903.png"  height="240" width="360"> </center></td>        <td ><center><img src="https://photos.zywvvd.com/icey-mate-book/20210612164021.png"  height="240" width="360"> </center></td>    </tr>    <tr>        <td ><center> 源图像  </center></td>        <td ><center> 融合区域 </center></td>    </tr>      <tr>        <td ><center><img src="https://photos.zywvvd.com/icey-mate-book/20210612164055.png"  height="240" width="360"> </center></td>        <td ><center><img src="https://photos.zywvvd.com/icey-mate-book/20210612164155.png"  height="240" width="360"> </center></td>    </tr>    <tr>        <td ><center> 目标图像  </center></td>        <td ><center> 融合结果</center></td>    </tr></table><blockquote><p>源图像的指定区域融合到目标图像中，纵享丝滑。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://github.com/willemmanuel/poisson-image-editing">https://github.com/willemmanuel/poisson-image-editing</a></p></li><li><p><a href="http://xeds.eu/upload/files/poisson.pdf">Poisson Image Editing - 2003</a></p></li><li><p><a href="https://blog.csdn.net/zhaoyin214/article/details/88196575">https://blog.csdn.net/zhaoyin214/article/details/88196575</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/58867397">https://zhuanlan.zhihu.com/p/58867397</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>image_processing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>image_processing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 性能分析 profile 使用方法</title>
    <link href="/2021/06/04/python/python-profile/python-profile/"/>
    <url>/2021/06/04/python/python-profile/python-profile/</url>
    
    <content type="html"><![CDATA[<blockquote><p>代码性能至关重要，但有时难以弄清性能瓶颈的位置，python的<code>profile</code>包可以解决这个问题并指导提升代码性能。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>代码优化的前提是需要了解性能瓶颈在什么地方，程序运行的主要时间是消耗在哪里，对于比较复杂的代码可以借助一些工具来定位，python 内置了丰富的性能分析工具，如 <code>profile</code>, <code>cProfile</code> 与 <code>hotshot</code> 等。其中 Profiler 是 python 自带的一组程序，能够描述程序运行时候的性能，并提供各种统计帮助用户定位程序的性能瓶颈。Python 标准模块提供三种 <code>profilers:cProfile</code>, <code>profile</code> 以及 <code>hotshot</code>。</p><p>pycharm 专业版带有 <code>profile</code> 工具，vs code 等其他 ide 的 python 用户就需要自己调用<code>profile</code>了。</p><h3 id="性能分析方法"><a href="#性能分析方法" class="headerlink" title="性能分析方法"></a>性能分析方法</h3><ol><li><h4 id="引入python自带的profile或cProfile"><a href="#引入python自带的profile或cProfile" class="headerlink" title="引入python自带的profile或cProfile"></a>引入python自带的<code>profile</code>或<code>cProfile</code></h4></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cProfile<br><span class="hljs-comment"># or</span><br><span class="hljs-keyword">import</span> profile<br></code></pre></td></tr></table></figure><ol start="2"><li><h4 id="确定需要分析性能的函数"><a href="#确定需要分析性能的函数" class="headerlink" title="确定需要分析性能的函数"></a>确定需要分析性能的函数</h4></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sub_fun</span>():</span><br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>        <span class="hljs-built_in">sum</span> += i<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun</span>():</span><br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>        <span class="hljs-built_in">sum</span> += sub_fun()<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span><br></code></pre></td></tr></table></figure><blockquote><p>我们分析函数 <code>fun</code> 的性能</p></blockquote><ol start="3"><li><h4 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h4></li></ol><h5 id="python-脚本中分析"><a href="#python-脚本中分析" class="headerlink" title="python 脚本中分析"></a>python 脚本中分析</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">cProfile.run(<span class="hljs-string">&#x27;fun()&#x27;</span>)<br><span class="hljs-comment"># or</span><br>profile.run(<span class="hljs-string">&#x27;fun()&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>输出</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache">  <span class="hljs-attribute">104</span> function calls in <span class="hljs-number">0</span>.<span class="hljs-number">000</span> seconds<br><br><span class="hljs-attribute">Ordered</span> by: standard name<br><br><span class="hljs-attribute">ncalls</span>  tottime  percall  cumtime  percall filename:lineno(function)<br>     <span class="hljs-attribute">1</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span> &lt;string&gt;:<span class="hljs-number">1</span>(&lt;module&gt;)<br>   <span class="hljs-attribute">100</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span> test.py:<span class="hljs-number">23</span>(sub_fun)<br>     <span class="hljs-attribute">1</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span> test.py:<span class="hljs-number">30</span>(fun)<br>     <span class="hljs-attribute">1</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span> &#123;built-in method builtins.exec&#125;<br>     <span class="hljs-attribute">1</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span>    <span class="hljs-number">0</span>.<span class="hljs-number">000</span> &#123;method &#x27;disable&#x27; of &#x27;_lsprof.Profiler&#x27; objects&#125;<br></code></pre></td></tr></table></figure><ul><li>其中输出每列的具体解释如下：</li></ul><table><thead><tr><th>参数名称</th><th>参数信息</th></tr></thead><tbody><tr><td>ncalls</td><td>表示函数调用的次数</td></tr><tr><td>tottime</td><td>表示指定函数的总的运行时间，除掉函数中调用子函数的运行时间</td></tr><tr><td>percall</td><td>（第一个 percall）等于 tottime/ncalls</td></tr><tr><td>cumtime</td><td>表示该函数及其所有子函数的调用运行的时间，即函数开始调用到返回的时间</td></tr><tr><td>percall</td><td>（第二个 percall）即函数运行一次的平均时间，等于 cumtime/ncalls</td></tr><tr><td>filename:lineno(function)</td><td>每个函数调用的具体信息</td></tr></tbody></table><ul><li>保存日志</li></ul><blockquote><p>如果需要将输出以日志的形式保存，只需要在调用的时候加入另外一个参数。</p><p>可以在当前文件夹存下日志信息到prof文件中。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">profile.run(“fun()”, filename=”result.prof”)<br></code></pre></td></tr></table></figure><h5 id="命令行分析"><a href="#命令行分析" class="headerlink" title="命令行分析"></a>命令行分析</h5><blockquote><p>如果不想在程序中调用profile库使用，可以在命令行使用命令。</p></blockquote><ul><li>运行命令查看性能分析结果</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python -m cProfile test.py<br></code></pre></td></tr></table></figure><ul><li>将性能分析结果保存到result文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python -m cProfile -o result.prof test.py<br></code></pre></td></tr></table></figure><h5 id="读取prof文件中的分析日志"><a href="#读取prof文件中的分析日志" class="headerlink" title="读取prof文件中的分析日志"></a>读取prof文件中的分析日志</h5><ul><li>可以用 <code>pstats</code> 读取prof文件中的日志</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pstats<br>p=pstats.Stats(<span class="hljs-string">&#x27;result.prof&#x27;</span>)<br>p.sort_stats(<span class="hljs-string">&#x27;time&#x27;</span>).print_stats()<br></code></pre></td></tr></table></figure><ol start="4"><li><h4 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h4></li></ol><blockquote><p>比较推荐的是使用 <code>snakeviz</code>可视化代码运行时间</p><p>官网：<a href="https://jiffyclub.github.io/snakeviz/">https://jiffyclub.github.io/snakeviz/</a></p></blockquote><ul><li>安装 <code>snakeviz</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">pip install snakeviz<br></code></pre></td></tr></table></figure><ul><li><p>运行Python代码的同时用<code>cProfile</code>保存运行时间数据</p><blockquote><p><strong>注意：要用<code>cProfile</code>，使用 <code>profile</code> 会导致 <code>snakeviz</code> 无法读取日志</strong></p><p>相关错误信息：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vim">Traceback (most recent <span class="hljs-keyword">call</span> <span class="hljs-keyword">last</span>):<br>  File <span class="hljs-string">&quot;.../site-packages/tornado/web.py&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">1413</span>, in _execute<br>    result = method(*self.path_args, **self.path_kwargs)<br>  File <span class="hljs-string">&quot;.../site-packages/snakeviz/main.py&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">30</span>, in <span class="hljs-built_in">get</span><br>    table_rows=table_rows(s), callees=json_stats(s))<br>  File <span class="hljs-string">&quot;.../site-packages/snakeviz/stats.py&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">65</span>, in json_stats<br>    (keyfmt(*ck), <span class="hljs-keyword">list</span>(cv)) <span class="hljs-keyword">for</span> ck, cv in stats.stats[<span class="hljs-keyword">k</span>][-<span class="hljs-number">1</span>].<span class="hljs-built_in">items</span>())<br>  File <span class="hljs-string">&quot;.../site-packages/snakeviz/stats.py&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">65</span>, in <span class="hljs-symbol">&lt;genexpr&gt;</span><br>    (keyfmt(*ck), <span class="hljs-keyword">list</span>(cv)) <span class="hljs-keyword">for</span> ck, cv in stats.stats[<span class="hljs-keyword">k</span>][-<span class="hljs-number">1</span>].<span class="hljs-built_in">items</span>())<br>TypeError: <span class="hljs-string">&#x27;int&#x27;</span> object <span class="hljs-keyword">is</span> not iterable<br></code></pre></td></tr></table></figure><p>相关 issues ：</p><p><a href="https://github.com/jiffyclub/snakeviz/issues/137">https://github.com/jiffyclub/snakeviz/issues/137</a></p><p><a href="https://github.com/jiffyclub/snakeviz/issues/60">https://github.com/jiffyclub/snakeviz/issues/60</a></p></blockquote></li><li><p>在命令行中调用<code>snakeviz</code>作用于我们需要观察的日志文件：</p></li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">snakeviz <span class="hljs-literal">result</span>.prof<br></code></pre></td></tr></table></figure><ul><li>在浏览器中可以看到函数时间消耗信息：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210604143956.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.jb51.net/article/174589.htm">https://www.jb51.net/article/174589.htm</a></li><li><a href="https://zhuanlan.zhihu.com/p/58535923">https://zhuanlan.zhihu.com/p/58535923</a></li><li><a href="https://blog.csdn.net/weixin_56336619/article/details/115862343">https://blog.csdn.net/weixin_56336619/article/details/115862343</a></li><li><a href="https://zhuanlan.zhihu.com/p/110105273">https://zhuanlan.zhihu.com/p/110105273</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laplace(拉普拉斯)算子</title>
    <link href="/2021/06/04/image_processing/laplace-operator/laplace-operator/"/>
    <url>/2021/06/04/image_processing/laplace-operator/laplace-operator/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Laplace算子作为边缘检测之一，和Sobel算子一样也是工程数学中常用的一种积分变换，属于空间锐化滤波操作。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul><li><p>拉普拉斯算子（Laplace Operator）是n维欧几里德空间中的一个二阶微分算子，定义为梯度（$▽f$）的散度（$▽·f$）。拉普拉斯算子也可以推广为定义在黎曼流形上的椭圆型算子，称为拉普拉斯-贝尔特拉米算子。</p></li><li><p>拉普拉斯算子是二阶微分线性算子，在图像边缘处理中，二阶微分的边缘定位能力更强，锐化效果更好，因此在进行图像边缘处理时，直接采用二阶微分算子而不使用一阶微分。</p></li></ul><h3 id="拉普拉斯算子"><a href="#拉普拉斯算子" class="headerlink" title="拉普拉斯算子"></a>拉普拉斯算子</h3><ul><li>离散函数的导数退化成了差分，一维一阶差分公式和二阶差分公式分别为：</li></ul><p>$$<br>\frac{\partial f}{\partial x}=f(x+1)-f(x)<br>$$<br>$$<br>\frac{\partial^{2} f}{\partial x^{2}}=f(x+1)+f(x-1)-2 f(x)<br>$$</p><ul><li>分别对Laplace算子x,y两个方向的二阶导数进行差分就得到了离散函数的Laplace算子。在一个二维函数f(x,y)中，x,y两个方向的二阶差分分别为：</li></ul><p>$$<br>\frac{\partial^{2} f}{\partial x^{2}}=f(x+1, y)+f(x-1, y)-2 f(x, y)<br>$$<br>$$<br>\frac{\partial^{2} f}{\partial y^{2}}=f(x, y+1)+f(x, y-1)-2 f(x, y)<br>$$</p><ul><li>Laplace算子将两个方向的差分直接累加，得到的差分形式为：</li></ul><p>$$<br>\nabla^{2} f(x, y)=f(x+1, y)+f(x-1, y)+f(x, y+1)+f(x, y-1)-4 f(x, y)<br>$$</p><ul><li>写成卷积核的形式如下：</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210604002807.png"></p><ul><li> 拉普拉斯算子符号为$ \Delta $，$ \varphi $ 是在流形上的实数或复数值的方程，它的拉普拉斯变换可表示为：</li></ul><p>$$<br> \Delta \varphi<br>$$</p><h3 id="源"><a href="#源" class="headerlink" title="源"></a>源</h3><ul><li>另一种解释是 <strong>拉普拉斯算子其实就是针对空间标量函数的一种“操作”，即先求该标量函数的梯度场，再求梯度场的散度</strong>。</li><li>物理意义是求<strong>标量函数梯度场的散度</strong>。</li><li><strong>求散度就可以知道空间中“源”的分布。</strong></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/hellocsz/article/details/102485387">https://blog.csdn.net/hellocsz/article/details/102485387</a></li><li><a href="https://www.zhihu.com/question/26822364">https://www.zhihu.com/question/26822364</a></li><li><a href="https://baike.baidu.com/item/%E6%B3%8A%E6%9D%BE%E6%96%B9%E7%A8%8B/251923?fr=aladdin">https://baike.baidu.com/item/%E6%B3%8A%E6%9D%BE%E6%96%B9%E7%A8%8B/251923?fr=aladdin</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>image_processing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>image_processing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 10 删除 grub 引导</title>
    <link href="/2021/06/03/windows/rm-grub-screen/rm-grub-screen/"/>
    <url>/2021/06/03/windows/rm-grub-screen/rm-grub-screen/</url>
    
    <content type="html"><![CDATA[<blockquote><p>曾经在原始Win10下装了双系统，开机时用 grub 选择启动哪个系统。随后又把linux删了，但是grub启动还在，每次开机都要选择一下，很麻烦，本文记录删除grub启动的方法。</p></blockquote><span id="more"></span><h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><ul><li>本文的内容适用于和我一样经历的电脑，一定脱离grub后自己可以启动的那种才行，即：<strong>原始Windows</strong> -&gt; <strong>双系统，自带 grub</strong> -&gt; <strong>需要删除grub</strong></li><li>安装双系统时会在Win的启动区安装grub，这样就算删除了双系统grub也是要运行的</li><li>解决思路就是找到这个grub直接删掉，然后就会使用原来的Win引导自动启动系统</li></ul><h3 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h3><h4 id="具象化启动磁盘"><a href="#具象化启动磁盘" class="headerlink" title="具象化启动磁盘"></a>具象化启动磁盘</h4><blockquote><p>我们需要修改系统启动磁盘的信息，这部分磁盘默认都是隐藏的，我们无法操作，因此需要将他们映射到某个盘符，便于我们修改</p></blockquote><ol><li>启动<code>cmd.exe</code></li><li>在<code>cmd</code>中运行<code>diskpart</code>命令，启动<code>diskpart</code>工具</li><li>在<code>diskpart</code>中运行<code>list disk</code></li></ol><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">DISKPART&gt; list disk<br><br>  磁盘 <span class="hljs-comment">###  状态           大小     可用     Dyn  Gpt</span><br>  <span class="hljs-params">--------</span>  <span class="hljs-params">-------------</span>  <span class="hljs-params">-------</span>  <span class="hljs-params">-------</span>  <span class="hljs-params">---</span>  <span class="hljs-params">---</span><br>  磁盘 0    联机              111 GB  3072 KB        *<br>  磁盘 1    联机              931 GB      0 B        *<br></code></pre></td></tr></table></figure><blockquote><p>我的磁盘0是Win系统磁盘</p></blockquote><ol start="4"><li>选择boot文件所在的磁盘，运行命令<code>sel disk X</code>（我的是0，大家根据各自情况填入）</li></ol><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">DISKPART&gt; </span>sel <span class="hljs-keyword">disk </span><span class="hljs-number">0</span><br><br>磁盘 <span class="hljs-number">0</span> 现在是所选磁盘。<br></code></pre></td></tr></table></figure><ol start="5"><li>运行命令<code>list vol</code></li></ol><blockquote><p>查看磁盘上的所有分区（卷）（EFI卷将被格式化为FAT，其他卷将被格式化为NTFS）</p></blockquote><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><br>DISKPART&gt; list vol<br><br>  卷 <span class="hljs-comment">###      LTR  标签         FS     类型        大小     状态       信息</span><br>  <span class="hljs-params">----------</span>  <span class="hljs-params">---</span>  <span class="hljs-params">-----------</span>  <span class="hljs-params">-----</span>  <span class="hljs-params">----------</span>  <span class="hljs-params">-------</span>  <span class="hljs-params">---------</span>  <span class="hljs-params">--------</span><br>  卷     0     C                NTFS   磁盘分区          74 GB  正常         启动<br>  卷     1     D   代码区          NTFS   磁盘分区          28 GB  正常         页面文件<br>  卷     2     L                FAT32  磁盘分区         200 MB  正常         系统<br>  卷     3                      NTFS   磁盘分区         588 MB  正常         已隐藏<br>  卷     4     E                NTFS   磁盘分区         234 GB  正常<br>  卷     5     F                NTFS   磁盘分区         465 GB  正常<br>  卷     6                      FAT32  磁盘分区         513 MB  正常         已隐藏<br></code></pre></td></tr></table></figure><ol start="6"><li>选择EFI分区，启动信息都在上面，运行命令<code>sel vol X</code></li></ol><blockquote><p>X 就是后面写着系统的那个卷的标号（我的是2）</p></blockquote><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">DISKPART</span>&gt; <span class="hljs-keyword">sel</span> vol <span class="hljs-number">2</span><br><br>卷 <span class="hljs-number">2</span> 是所选卷。<br></code></pre></td></tr></table></figure><ol start="7"><li>将其映射到某个盘符上<code>assign letter=L:</code>（L是我电脑上没有使用的盘符，不要忘了有冒号）</li></ol><blockquote><p>此时会多一个L磁盘，第一步就成功了</p><p>打是打不开的，而且这部分文件最好不要轻举妄动，可能一不小心就启动不起来了</p></blockquote><h4 id="删除ubuntu引导文件夹"><a href="#删除ubuntu引导文件夹" class="headerlink" title="删除ubuntu引导文件夹"></a>删除ubuntu引导文件夹</h4><blockquote><p>我们已经把引导磁盘抓出来了，删除grub引导文件就可以了</p></blockquote><ol><li>以<strong>系统管理员身份</strong>启动<code>cmd.exe</code></li><li>输入<code>L:</code>，进入L磁盘</li><li>输入<code>dir</code>命令，查看当前磁盘目录</li></ol><blockquote><p>这一步就是为了检查我们此时操作是否正确，正常的话应该只有一个名为<code>EFI</code>的文件夹</p></blockquote><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol"></span><br><span class="hljs-symbol">L:</span>\&gt;dir<br> 驱动器 L 中的卷没有标签。<br> 卷的序列号是 <span class="hljs-number">3</span>A1C<span class="hljs-number">-7752</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol"> L:</span>\ 的目录<br><br><span class="hljs-number">2020</span>/<span class="hljs-number">01</span>/<span class="hljs-number">13</span>  <span class="hljs-number">03</span>:<span class="hljs-number">23</span>    <span class="hljs-params">&lt;DIR&gt;</span>          EFI<br>               <span class="hljs-number">0</span> 个文件              <span class="hljs-number">0</span> 字节<br>               <span class="hljs-number">1</span> 个目录    <span class="hljs-number">171</span>,<span class="hljs-number">151</span>,<span class="hljs-number">360</span> 可用字节<br></code></pre></td></tr></table></figure><ol start="4"><li>进入<code>EFI</code>文件夹，<code>cd EFI</code></li><li>输入<code>dir</code>查看<code>EFI</code>文件夹中文件内容</li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>L:\EFI&gt;dir<br> 驱动器 L 中的卷没有标签。<br> 卷的序列号是 <span class="hljs-number">3</span>A1C-<span class="hljs-number">7752</span><br><br> L:\EFI 的目录<br><br><span class="hljs-number">2019</span><span class="hljs-regexp">/12/</span><span class="hljs-number">23</span>  <span class="hljs-number">10</span>:<span class="hljs-number">19</span>    &lt;DIR&gt;          .<br><span class="hljs-number">2019</span><span class="hljs-regexp">/12/</span><span class="hljs-number">23</span>  <span class="hljs-number">10</span>:<span class="hljs-number">19</span>    &lt;DIR&gt;          ..<br><span class="hljs-number">2019</span><span class="hljs-regexp">/12/</span><span class="hljs-number">23</span>  <span class="hljs-number">10</span>:<span class="hljs-number">19</span>    &lt;DIR&gt;          Microsoft<br><span class="hljs-number">2020</span><span class="hljs-regexp">/01/</span><span class="hljs-number">13</span>  <span class="hljs-number">03</span>:<span class="hljs-number">24</span>    &lt;DIR&gt;          Boot<br><span class="hljs-number">2020</span><span class="hljs-regexp">/01/</span><span class="hljs-number">13</span>  <span class="hljs-number">03</span>:<span class="hljs-number">24</span>    &lt;DIR&gt;          ubuntu<br>               <span class="hljs-number">0</span> 个文件              <span class="hljs-number">0</span> 字节<br>               <span class="hljs-number">5</span> 个目录    <span class="hljs-number">171</span>,<span class="hljs-number">151</span>,<span class="hljs-number">360</span> 可用字节<br></code></pre></td></tr></table></figure><ol start="6"><li>删除<code>ubuntu</code>文件夹，输入命令<code>rmdir /S ubuntu</code></li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>L:\EFI&gt;rmdir /S ubuntu<br>ubuntu, 是否确认(Y/N)? Y<br><br>L:\EFI&gt;dir<br> 驱动器 L 中的卷没有标签。<br> 卷的序列号是 <span class="hljs-number">3</span>A1C-<span class="hljs-number">7752</span><br><br> L:\EFI 的目录<br><br><span class="hljs-number">2019</span><span class="hljs-regexp">/12/</span><span class="hljs-number">23</span>  <span class="hljs-number">10</span>:<span class="hljs-number">19</span>    &lt;DIR&gt;          .<br><span class="hljs-number">2019</span><span class="hljs-regexp">/12/</span><span class="hljs-number">23</span>  <span class="hljs-number">10</span>:<span class="hljs-number">19</span>    &lt;DIR&gt;          ..<br><span class="hljs-number">2019</span><span class="hljs-regexp">/12/</span><span class="hljs-number">23</span>  <span class="hljs-number">10</span>:<span class="hljs-number">19</span>    &lt;DIR&gt;          Microsoft<br><span class="hljs-number">2020</span><span class="hljs-regexp">/01/</span><span class="hljs-number">13</span>  <span class="hljs-number">03</span>:<span class="hljs-number">24</span>    &lt;DIR&gt;          Boot<br>               <span class="hljs-number">0</span> 个文件              <span class="hljs-number">0</span> 字节<br>               <span class="hljs-number">4</span> 个目录    <span class="hljs-number">174</span>,<span class="hljs-number">960</span>,<span class="hljs-number">640</span> 可用字节<br></code></pre></td></tr></table></figure><blockquote><p>假设您只有两个操作系统（Win 10 和 Ubuntu），您现在应该能够直接启动到 Windows 而不会碰到黑色的 grub 屏幕。</p></blockquote><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><ul><li>重启计算机，计算机正常启动，跳过了grub</li></ul><h4 id="删除EFI分区盘符"><a href="#删除EFI分区盘符" class="headerlink" title="删除EFI分区盘符"></a>删除EFI分区盘符</h4><blockquote><p>正常情况下重启后L磁盘就没有了，如果没有重启或重启后还在可以手动删除</p></blockquote><ol><li>启动<code>cmd.exe</code></li><li>启动<code>diskpart</code>工具</li><li><code>remove letter=L</code></li></ol><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://askubuntu.com/questions/429610/uninstall-grub-and-use-windows-bootloader">https://askubuntu.com/questions/429610/uninstall-grub-and-use-windows-bootloader</a></li><li><a href="https://blog.csdn.net/bubbleyang/article/details/98469145">https://blog.csdn.net/bubbleyang/article/details/98469145</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>图像边缘检测——一阶微分算子 Roberts、Sobel、Prewitt、Kirsch、Robinson</title>
    <link href="/2021/06/02/image_processing/image-operators/image-operators/"/>
    <url>/2021/06/02/image_processing/image-operators/image-operators/</url>
    
    <content type="html"><![CDATA[<blockquote><p><strong>边缘检测</strong>指的是从图像中检测边缘点和边缘段，并且描述边缘方向的过程。本文记录常用边缘检测一阶微分算子。</p></blockquote><span id="more"></span><h3 id="图像边缘"><a href="#图像边缘" class="headerlink" title="图像边缘"></a><strong>图像边缘</strong></h3><p><strong>图像边缘一般指图像的灰度变化率最大的位置。</strong></p><p>成因主要如下：</p><ol><li><p>图像灰度在表面法向变化不连续；</p></li><li><p>图像中物体在空间上的深度不一致；</p></li><li><p>在光滑的表面上颜色不一致；</p></li><li><p>图像中物体的光影</p></li></ol><h3 id="边缘检测"><a href="#边缘检测" class="headerlink" title="边缘检测"></a><strong>边缘检测</strong></h3><ul><li>边缘检测指的是从图像中检测边缘点和边缘段，并且描述边缘方向的过程。图像可以看成二元函数f（x,y），（x，y）是pixel的位置，f(x,y)是该处的灰度值，这样图像就可以想象成是一个曲面。看作曲面以后，就可以用数学的方法来处理了。边缘即曲面上变化最剧烈的位置，这个位置也是曲面的局部极值点的位置，求极值大家都知道，可以用导数来求。</li></ul><h4 id="一阶微分算子检测边缘"><a href="#一阶微分算子检测边缘" class="headerlink" title="一阶微分算子检测边缘"></a>一阶微分算子检测边缘</h4><ul><li>图像的梯度场（相邻像素差值）：</li></ul><p>$$<br>\nabla \mathrm{f}(\mathrm{x}, \mathrm{y})=\left(\frac{\partial \mathrm{f}}{\partial x}, \frac{\partial \mathrm{f}}{\partial y}\right)<br>$$</p><ul><li>梯度的模值为：<br>$$<br>|\nabla \mathrm{f}(\mathrm{x}, \mathrm{y})|=\sqrt{\left(\frac{\partial \mathrm{f}}{\partial x}\right)^{2}+\left(\frac{\partial \mathrm{f}}{\partial y}\right)^{2}}<br>$$</li><li>梯度方向为：<br>$$<br>\angle \nabla \mathrm{f}(\mathrm{x}, \mathrm{y})=\arctan \left(\frac{\partial \mathrm{f}}{\partial x}\right) /\left(\frac{\partial \mathrm{f}}{\partial x}\right)<br>$$<blockquote><p>由此我们得到，图像某一点（x,y）变化最快的方向是梯度的方向，变化最慢的方向是与梯度垂直的方向。</p></blockquote></li></ul><h3 id="一阶算子"><a href="#一阶算子" class="headerlink" title="一阶算子"></a>一阶算子</h3><h4 id="Roberts算子"><a href="#Roberts算子" class="headerlink" title="Roberts算子"></a>Roberts算子</h4><ul><li>在 $ (\mathrm{i}+1 / 2, j+1 / 2) $ 处差分</li></ul><p>$$<br>|\nabla \mathrm{f}(1, j)|=|f(\mathrm{i}, j)-\mathrm{f}(\mathrm{i}+1, j+1)|+|f(1+1, j)-\mathrm{f}(\mathrm{i}, \mathrm{j}+1)|<br>$$</p><ul><li>转化为模板即为 </li></ul><p>$$<br>R_{x}=\left[\begin{array}{cc}1 &amp; 0 \ 0 &amp; -1\end{array}\right], R_{y}=\left[\begin{array}{cc}0 &amp; -1 \ 1 &amp; 0\end{array}\right]<br>$$</p><blockquote><p>对于所有的微分算子而言，若只对$|Rxf|$进行阈值判决，则选择的是与x方向垂直的边缘；若只对$|Ryf|$进行阈值判决，则选择的是与y方向垂直的边缘;若选择的是对$|Rxf|+|Ryf|$ 进行判决, 则获得一般方向的边缘。</p></blockquote><h4 id="Sobel算子"><a href="#Sobel算子" class="headerlink" title="Sobel算子"></a>Sobel算子</h4><ul><li>中心差分 , 对于水平线和垂直线的四个点权重高，模板为：</li></ul><p>$$<br>S_{x}=\left[\begin{array}{lll}<br>-1 &amp; 0 &amp; 1 \<br>-2 &amp; 0 &amp; 2 \<br>-1 &amp; 0 &amp; 1<br>\end{array}\right], S_{y}=\left[\begin{array}{ccc}<br>1 &amp; 2 &amp; 1 \<br>0 &amp; 0 &amp; 0 \<br>-1 &amp; -2 &amp; -1<br>\end{array}\right]<br>$$</p><blockquote><p>在实际运用中较多</p></blockquote><h4 id="Prewitt算子"><a href="#Prewitt算子" class="headerlink" title="Prewitt算子"></a>Prewitt算子</h4><ul><li>模板为</li></ul><p>$$<br>P_{x}=\left[\begin{array}{lll}<br>-1 &amp; 0 &amp; 1 \<br>-1 &amp; 0 &amp; 1 \<br>-1 &amp; 0 &amp; 1<br>\end{array}\right], P_{y}=\left[\begin{array}{ccc}<br>1 &amp; 1 &amp; 1 \<br>0 &amp; 0 &amp; 0 \<br>-1 &amp; -1 &amp; -1<br>\end{array}\right]<br>$$</p><h4 id="Kirsch算子"><a href="#Kirsch算子" class="headerlink" title="Kirsch算子"></a>Kirsch算子</h4><p>8个模板，对应8个方向，最大值被选出<br>$$<br>K_{N}=\left[\begin{array}{ccc}5 &amp; 5 &amp; 5 \ -3 &amp; 0 &amp; 3 \ -3 &amp; -3 &amp; -3\end{array}\right], \mathrm{K}<em>{N \mathbb{X}}=\left[\begin{array}{ccc}-3 &amp; 5 &amp; 5 \ -3 &amp; 0 &amp; 5 \ -3 &amp; -3 &amp; -3\end{array}\right]<br>$$<br>$$<br>K</em>{\bar{I}}=\left[\begin{array}{ccc}-3 &amp; -3 &amp; 5 \ -3 &amp; 0 &amp; 5 \ -3 &amp; -3 &amp; 5\end{array}\right], \mathrm{K}<em>{S B}=\left[\begin{array}{ccc}-3 &amp; -3 &amp; -3 \ -3 &amp; 0 &amp; 5 \ -3 &amp; 5 &amp; 5\end{array}\right]<br>$$<br>$$<br>K</em>{s}=\left[\begin{array}{ccc}-3 &amp; -3 &amp; -3 \ -3 &amp; 0 &amp; -3 \ 5 &amp; 5 &amp; 5\end{array}\right], \mathrm{K}<em>{\text {SW }}=\left[\begin{array}{ccc}-3 &amp; -3 &amp; -3 \ 5 &amp; 0 &amp; -3 \ 5 &amp; 5 &amp; -3\end{array}\right]<br>$$<br>$$<br>K</em>{W}=\left[\begin{array}{ccc}5 &amp; -3 &amp; -3 \ 5 &amp; 0 &amp; -3 \ 5 &amp; -3 &amp; -3\end{array}\right], \mathrm{K}_{N W}=\left[\begin{array}{ccc}5 &amp; 5 &amp; -3 \ 5 &amp; 0 &amp; -3 \ -3 &amp; -3 &amp; -3\end{array}\right]<br>$$</p><h4 id="Robinson算子"><a href="#Robinson算子" class="headerlink" title="Robinson算子"></a>Robinson算子</h4><ul><li>规则同上，也是8个模板</li></ul><p>$$<br>R_{N}=\left[\begin{array}{ccc}1 &amp; 2 &amp; 1 \ 0 &amp; 0 &amp; 0 \ -1 &amp; -2 &amp; 1\end{array}\right], \mathrm{R}<em>{N \mathbb{}}=\left[\begin{array}{ccc}0 &amp; 1 &amp; 2 \ -1 &amp; 0 &amp; 1 \ -2 &amp; -1 &amp; 0\end{array}\right]<br>$$<br>$$<br>R</em>{\bar{g}}=\left[\begin{array}{ccc}-1 &amp; 0 &amp; 1 \ -2 &amp; 0 &amp; 2 \ -1 &amp; 0 &amp; 1\end{array}\right], \mathrm{R}<em>{S \mathbb{X}}=\left[\begin{array}{ccc}-2 &amp; -1 &amp; 0 \ -1 &amp; 0 &amp; 1 \ 0 &amp; 1 &amp; 2\end{array}\right]<br>$$<br>$$<br>R</em>{s}=\left[\begin{array}{ccc}-1 &amp; -2 &amp; -1 \ 0 &amp; 0 &amp; 0 \ 1 &amp; 2 &amp; 5\end{array}\right], \mathrm{R}<em>{S W}=\left[\begin{array}{ccc}0 &amp; -1 &amp; -2 \ 1 &amp; 0 &amp; -1 \ 2 &amp; 1 &amp; 0\end{array}\right]<br>$$<br>$$<br>R</em>{W}=\left[\begin{array}{ccc}1 &amp; 0 &amp; -1 \ 2 &amp; 0 &amp; -2 \ 1 &amp; 0 &amp; -1\end{array}\right], \mathrm{R}_{N W}=\left[\begin{array}{ccc}2 &amp; 1 &amp; 0 \ 1 &amp; 0 &amp; -1 \ 0 &amp; -1 &amp; -2\end{array}\right]<br>$$</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/u014485485/article/details/78339420">https://blog.csdn.net/u014485485/article/details/78339420</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>image_processing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>image_processing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python 动态获取当前运行函数名称</title>
    <link href="/2021/05/31/python/python-function-name/python-function-name/"/>
    <url>/2021/05/31/python/python-function-name/python-function-name/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Python动态获取函数名称的方法。</p></blockquote><span id="more"></span><h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><blockquote><p>使用 <code>sys</code> 库</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br>sys._getframe().f_code.co_name<br></code></pre></td></tr></table></figure><h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><blockquote><p>使用 <code>inspect</code> 库</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> inspect<br>inspect.stack()[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/yoyoketang/p/9231320.html">https://www.cnblogs.com/yoyoketang/p/9231320.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>傅里叶变换</title>
    <link href="/2021/05/29/math/fourier-transform/fourier-transform/"/>
    <url>/2021/05/29/math/fourier-transform/fourier-transform/</url>
    
    <content type="html"><![CDATA[<blockquote><p>傅立叶变换，表示能将满足一定条件的某个函数表示成三角函数（正弦和/或余弦函数）或者它们的积分的线性组合。在不同的研究领域，傅立叶变换具有多种不同的变体形式，如连续傅立叶变换和离散傅立叶变换。本文梳理基本知识。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p><strong>Fourier transform</strong>或<strong>Transformée de Fourier</strong>有多个中文译名，常见的有“<strong>傅里叶变换</strong>”、“<strong>付立叶变换</strong>”、“<strong>傅立叶转换</strong>”、“<strong>傅氏转换</strong>”、“<strong>傅氏变换</strong>”、等等。</p></blockquote><ul><li>傅立叶变换是一种分析信号的方法，它可分析信号的成分，也可用这些成分合成信号。所谓信号，从狭义上说可以认为是自然界中作为信息载体的各类波，一般来说简谐震动产生的正弦波是最常见的研究对象。许多波形可作为信号的成分，比如正弦波、方波、锯齿波等，傅立叶变换用正弦波作为信号的成分。</li><li>对于自然界存在的所有波，我们可以利用所谓的傅立叶级数展开法将它们分解为有限或无限个不同频率不同振幅的正弦、余弦波的集合</li></ul><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><h4 id="连续傅里叶变换"><a href="#连续傅里叶变换" class="headerlink" title="连续傅里叶变换"></a>连续傅里叶变换</h4><ul><li>$f(t)$是$t$的周期函数，如果$t$满足<strong>狄里赫莱条件</strong>：在一个以 $2T$ 为周期内$f(X)$连续或只有有限个第一类间断点，附$f(x)$单调或可划分成有限个单调区间，则$F(x)$以$2T$为周期的傅里叶级数收敛，和函数$S(x)$也是以$2T$为周期的周期函数，且在这些间断点上，函数是有限值；在一个周期内具有有限个极值点；绝对可积。</li><li>则有下式成立，称为积分运算$f(t)$的傅立叶变换:</li></ul><p>$$<br>F(\omega)=\mathcal{F}[f(t)]=\int_{-\infty}^{\infty} f(t) e^{-i w t} d t<br>$$</p><blockquote><p>$ F(\omega) $ 叫做 $ {f}(\mathrm{t}) $ 的象函数， $ {f}({t}) $ 叫做$ {F}(\omega) $ 的象原函数。</p><p>$ F (\omega) $ 是 $ {f}(\mathrm{t}) $ 的象， $ \mathrm{f}({t}) $ 是$F(\omega)$原象。</p></blockquote><ul><li>傅里叶变换可以通过逆变换将象函数变换为象原函数</li></ul><p>$$<br>f(t)=\mathcal{F}^{-1}[F(\omega)]=\frac{1}{2 \pi} \int_{-\infty}^{\infty} F(\omega) e^{i w t} d \omega<br>$$</p><blockquote><p>其中$F(ω)$叫做$f(t)$的象函数，$f(t)$叫做$F(\omega)$ 的象原函数。 $\mathrm{F}(\omega)$ 是 $f(\mathrm{t})$ 的象。 ${f}({t})$ 是 $\mathrm{F}(\omega)$ 原象。</p></blockquote><ul><li>傅立叶逆变换</li></ul><p>$$<br>f(t)=\mathcal{F}^{-1}[F(\omega)]=\frac{1}{2 \pi} \int_{-\infty}^{\infty} F(\omega) e^{i w t} d \omega<br>$$</p><h4 id="离散傅里叶变换"><a href="#离散傅里叶变换" class="headerlink" title="离散傅里叶变换"></a>离散傅里叶变换</h4><ul><li>设 $x(n)$ 是一个长度为 $M$ 的有限长序列，则定义 $x(n)$ 的 $N$ 点离散傅里叶变换为</li></ul><p>$$<br>X(k)=\operatorname{DFT}[x(n)]=\sum_{n=0}^{N-1} x(n) W_{N}^{k n} \quad k=0,1, \cdots, N-1<br>$$</p><ul><li>$X(k)$ 的离散傅里叶逆变换(Inverse Discrete Fourier Transform, IDFT)为</li></ul><p>$$<br>x(n)=\operatorname{IDFT}[X(k)]=\frac{1}{N} \sum_{k=0}^{N-1} X(k) W_{N}^{-k n} \quad n=0,1, \cdots, N-1<br>$$</p><blockquote><p>式中, $W_{N}=\mathrm{e}^{-j\frac{2\pi}{N}}, N$ 称为 $\mathrm{DFT}$ 变换区间长度, $(N \geqslant M)$ 通常称上述两式为离散傅里叶变换对。</p><p>为了叙述简洁，常常用 ${DFT[x(n)]} _ { N}$ 和 $IDFT[X(k)]_{N}$ 分别表示 $N$ 点离散傅里叶变换和 $N$ 点离散傅里叶逆变换。</p></blockquote><h3 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h3><blockquote><p>虽然讲了定义，相信没人能直接看懂，了解一些相关概念明白一下傅里叶变换是在干嘛。</p></blockquote><h4 id="时域"><a href="#时域" class="headerlink" title="时域"></a>时域</h4><p>是描述数学函数或物理信号对时间的关系。例如一个信号的时域波形可以表达信号随着时间的变化。是真实世界，是惟一实际存在的域。因为我们的经历都是在时域中发展和验证的，已经习惯于事件按时间的先后顺序地发生。</p><h4 id="频域"><a href="#频域" class="headerlink" title="频域"></a>频域</h4><p>频域（frequency domain）是描述信号在频率方面特性时用到的一种坐标系。在电子学，控制系统工程和统计学中，频域图显示了在一个频率范围内每个给定频带内的信号量。频域，尤其在射频和通信系统中运用较多，在高速数字应用中也会遇到频域。频域最重要的性质是：它不是真实的，而是一个数学构造。时域是惟一客观存在的域，而频域是一个遵循特定规则的数学范畴，频域也被一些学者称为上帝视角。</p><h4 id="时域频域的关系"><a href="#时域频域的关系" class="headerlink" title="时域频域的关系"></a>时域频域的关系</h4><p>时域分析与频域分析是对模拟信号的两个观察面。时域分析是以时间轴为坐标表示动态信号的关系；频域分析是把信号变为以频率轴为坐标表示出来。一般来说，时域的表示较为形象与直观，频域分析则更为简练，剖析问题更为深刻和方便。信号分析的趋势是从时域向频域发展。然而，它们是互相联系，缺一不可，相辅相成的。</p><ul><li>傅里叶正变换和反变换，就是将信号在二者之间变换。</li><li>不同频率的正弦波相互正交，构成了频域空间上的基</li><li>傅里叶正变换就是当前的信号与所有频率不同相位的正弦信号计算点积，得到各个频率波上的分量，叠加构成当前的时域信号</li></ul><h3 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h3><ul><li>给出一幅图像，我们求出图像中圆形的周期和相位</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/bcc10054575391a7ddc020a17e956c69.png"></p><ul><li>将图像极坐标变换</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/bd985648a8a0ed737dc746b56a5d31fa.png"></p><ul><li>叠加减去均值得到时域信号：</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/503f843ca1a714c02d483bd0ccdc2b98.png"></p><ul><li>离散傅里叶变换，计算模长</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/06b263e3d14f008788ccfc9615f5437d.png"></p><ul><li><p>其中能量最大的就是信号的周期 12，与实际相符</p></li><li><p>计算频率为12的相位，得到 -10.279644688897708，与实际相符</p></li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/3b66d94e81f89cde5cd16de1167bd4b7.png"></p><h4 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> scipy.fftpack <span class="hljs-keyword">import</span> fft<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    image_path = <span class="hljs-string">&#x27;test.png&#x27;</span><br>    image = cv2.imread(image_path)<br><br>    center = (np.array(image.shape[:<span class="hljs-number">2</span>]) / <span class="hljs-number">2</span>).astype(<span class="hljs-string">&#x27;int&#x27;</span>)[::-<span class="hljs-number">1</span>].tolist()<br>    <span class="hljs-keyword">assert</span> center[<span class="hljs-number">0</span>] == center[<span class="hljs-number">1</span>]<br>    radius = center[<span class="hljs-number">0</span>]<br><br>    size_x = <span class="hljs-number">200</span><br>    size_y = <span class="hljs-number">200</span><br><br>    output_img = cv2.warpPolar(image, (size_x, size_y), <span class="hljs-built_in">tuple</span>(center), radius, <span class="hljs-number">12</span>)<br><br>    output_img = output_img[:, :, <span class="hljs-number">0</span>]<br><br>    signal = np.<span class="hljs-built_in">sum</span>(output_img, axis=<span class="hljs-number">1</span>)<br><br>    signal = signal - signal.mean()<br><br>    scipy_fft_y = fft(signal)<br><br>    scipy_fft_y = scipy_fft_y[:<span class="hljs-built_in">len</span>(scipy_fft_y)//<span class="hljs-number">2</span>]<br><br>    <span class="hljs-comment"># energy_fft</span><br>    abs_y = np.<span class="hljs-built_in">abs</span>(scipy_fft_y)<br><br>    <span class="hljs-comment"># phase_fft</span><br>    angle_y = np.angle(scipy_fft_y)<br><br>    cycle_num = np.argmax(abs_y)<br>    <span class="hljs-comment"># cycle angle</span><br>    cycle_angle = <span class="hljs-number">360</span> / cycle_num<br>    <span class="hljs-comment"># phase</span><br>    phase = cycle_angle / <span class="hljs-number">2</span> / np.pi * angle_y[cycle_num]<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;周期 : <span class="hljs-subst">&#123;cycle_num&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;角度 : <span class="hljs-subst">&#123;cycle_angle&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;相位 : <span class="hljs-subst">&#123;phase&#125;</span>&quot;</span>)<br><br>    plt.plot(abs_y)<br>    plt.show()<br><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://baike.baidu.com/item/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/7119029?fr=aladdin">https://baike.baidu.com/item/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/7119029?fr=aladdin</a></p></li><li><p><a href="https://www.cnblogs.com/amanlikethis/p/3505248.html">https://www.cnblogs.com/amanlikethis/p/3505248.html</a></p></li><li><p><a href="https://www.zhihu.com/question/21040374">https://www.zhihu.com/question/21040374</a></p></li><li><p><a href="https://baike.baidu.com/item/%E6%97%B6%E5%9F%9F%E9%A2%91%E5%9F%9F/9399325?fr=aladdin">https://baike.baidu.com/item/%E6%97%B6%E5%9F%9F%E9%A2%91%E5%9F%9F/9399325?fr=aladdin</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>信息论 - KL散度</title>
    <link href="/2021/05/29/information-theory/cross-entropy-KL-divergence/KL-divergence/"/>
    <url>/2021/05/29/information-theory/cross-entropy-KL-divergence/KL-divergence/</url>
    
    <content type="html"><![CDATA[<blockquote><p>信息熵是一种信息不确定性的度量，而两个随机变量分布匹配程度的度量可以使用KL散度。</p></blockquote><span id="more"></span><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>KL 散度（Kullback–Leibler divergence，简称KLD），也称作相对嫡（relative entropy），信息散度（information divergence），信息增益（information gain）。</p><ul><li>KL散度是两个概率分布$P$和$Q$差别的非对称性的度量。</li><li>KL散度是用来度量使用基于$Q$的编码来编码来自P的样本平均所需的额外的比特个数。 典型情况下，$P$表示数据的真实分布，$Q$表示数据的理论分布，模型分布，或$P$的近似分布。</li><li>根据 shannon 的信息论，给定一个字符集的概率分布，我们可以设计一种编码，使得表示该字符集组成的字符串平均需要的比特数最少。假设这个字符集是X，对$x∈X$，其出现概率为$P(x)$，那么其最优编码平均需要的比特数等于这个字符集的熵：</li></ul><p>$$<br>H\left( X \right) =  - \sum\nolimits_{x \in X} {P\left( x \right)logP\left( x \right)}<br>$$</p><blockquote><p>字符$x$出现的概率为$P(x)$，那么编码$x$需要的最优长度为$log(P(x))$，$H(X)$即为编码字符集$X$的期望编码长度，即按照概率加权平均，也不失为信息熵的一种理解方法。</p></blockquote><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><p>在同样的字符集上，假设存在另一个概率分布$Q(X)$。如果用概率分布$P(X)$的最优编码（即字符$x$的编码长度等于$log[1/P(x)]$，来为符合分布$Q(X)$的字符编码，那么表示这些字符就会比理想情况多用一些比特数。KL散度就是用来衡量这种情况下平均每个字符多用的比特数，因此可以用来衡量两个分布的距离。即： </p>$$\begin{array}{l} D_{KL}({Q||P}) &= {\sum _{x \in X}}Q\left( x \right){\rm{log}}\frac{1}{{P(x)}}{\rm{ }} - {\rm{ }}{\sum _{x \in X}}Q\left( x \right){\rm{log}}\frac{1}{{Q(x)}}\\ &= {\sum _{x \in X}}Q\left( x \right)log\left[ {Q\left( x \right)/P\left( x \right)} \right]\end{array}$$<blockquote><p>$D_{KL}({Q||P})$的意思就是用$P$的最优编码方法（$\rm{log}\frac{1}{{P(X)}}$）来编码$Q$分布中的变量，这种编码需要付出的额外编码长度</p></blockquote><h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><h4 id="mathrm-KL-散度非负"><a href="#mathrm-KL-散度非负" class="headerlink" title="$ \mathrm{KL} $ 散度非负"></a>$ \mathrm{KL} $ 散度非负</h4><ul><li>当它为 0 时, 当且仅当 $ \mathrm{P} $ 和 $ \mathrm{Q} $ 是同一个分布 $ ( $ 对于离散型随机变量), 或者两个分布几乎 处处相等 (对于连续型随机变量) 。</li></ul><p>证明：</p>$$\begin{array}{l}{D_{KL}}\left( {Q||P} \right){\rm{ }} &= {\rm{ }} - {\sum _{x \in X}}Q\left( x \right)log\left[ {P\left( x \right)/Q\left( x \right)} \right]{\rm{ }}\\ &= {\rm{ }}E\left[ { - logP\left( x \right)/Q\left( x \right)} \right]\end{array}$$<p>由于$-log(x)$是凸函数，因此有：</p>$$E\left[ { - logP\left( x \right)/Q\left( x \right)} \right]{\rm{ }} \ge  - logE\left[ {P\left( x \right)/Q\left( x \right)} \right]$$$$ - logE\left[ {P\left( x \right)/Q\left( x \right)} \right] = {\rm{  - }}log{\sum _{x \in X}}Q\left( x \right)P\left( x \right)/Q\left( x \right){\rm{ }} = {\rm{ }}0$$<p>当$P(x)=Q(x)$时等式成立</p><h4 id="mathrm-KL-散度不对称"><a href="#mathrm-KL-散度不对称" class="headerlink" title="$ \mathrm{KL} $ 散度不对称"></a>$ \mathrm{KL} $ 散度不对称</h4><p>$$<br>D_{K L}(P | Q) \neq D_{K L}(Q | P)<br>$$</p><blockquote><p>直观上看对于 $ D_{K L}(P | Q) $, 当 $ P(x) $ 较大的地方, $ Q(x) $ 也应该较大，这样才能使得 $ P(x) \log \frac{P(x)}{Q(x)} $ 较 小。</p><p>对于 $ P(x) $ 较小的地方, $ Q(x) $ 就没有什么限制就能够使得 $ P(x) \log \frac{P(x)}{Q(x)} $ 较小。这就是 $ \mathrm{KL} $ 散度不满足对 称性的原因。</p></blockquote><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>假设真实分布 $ P $ 为混合高斯分布，它由两个高斯分布的分量组成。如果希望用普通的高斯分布 $ Q $ 来近 似 $ P $, 则有两种方案:</p>$$\begin{aligned}Q_{1}^{*} &=\arg \min _{Q} D_{K L}(P \| Q) \\Q_{2}^{*} &=\arg \min _{Q} D_{K L}(Q \| P)\end{aligned}$$<p><img src="https://photos.zywvvd.com/icey-mate-book/20210529153555.png"></p><p>如果选择 $ Q_{1}^{*} $, 则:</p><ul><li>当 $ P(x) $ 较大的时候 $ Q(x) $ 也必须较大。如果 $ P(x) $ 较大时 $ Q(x) $ 较小, 则 $ P(x) \log \frac{P(x)}{Q(x)} $ 较大。</li><li>当 $ P(x) $ 较小的时候 $ Q(x) $ 可以较大，也可以较小<br>因此 $ Q_{1}^{<em>} $ 会贴近 $ P(x) $ 的峰值。由于 $ P(x) $ 的峰值有两个, 因此 $ Q_{1}^{</em>} $ 无法偏向任意一个峰值，最终结果就 是 $ Q_{1}^{*} $ 的峰值在 $ P(x) $ 的两个峰值之间。</li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20210529154313.png"></p><p>如果选择 $ Q_{2}^{*} $, 则:</p><ul><li>当 $ P(x) $ 较小的时候, $ Q(x) $ 必须较小。如果 $ P(x) $ 较小的时 $ Q(x) $ 较大，则 $ Q(x) \log \frac{Q(x)}{P(x)} $ 较大</li><li>当 $ P(x) $ 较大的时候, $ Q(x) $ 可以较大，也可以较小。</li><li>因此 $ Q_{2}^{<em>} $ 会贴近 $ P(x) $ 的谷值。最终结果就是 $ Q_{2}^{</em>} $ 会贴合 $ P(x) $ 峰值的任何一个。</li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20210529154547.png"></p><p>绝大多数场合使用 $ D_{K L}(P | Q) $</p><blockquote><p>原因是：当用分布 $ Q $ 拟合 $ P $ 时我们希望对于常见的事件, 二者概率相 差不大。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></p></li><li><p><a href="https://www.cnblogs.com/hxsyl/p/4910218.html">https://www.cnblogs.com/hxsyl/p/4910218.html</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>information theory</category>
      
    </categories>
    
    
    <tags>
      
      <tag>information theory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>信息论 - 交叉熵</title>
    <link href="/2021/05/29/information-theory/cross-entropy-KL-divergence/cross-entropy/"/>
    <url>/2021/05/29/information-theory/cross-entropy-KL-divergence/cross-entropy/</url>
    
    <content type="html"><![CDATA[<blockquote><p>交叉熵（Cross Entropy）是Shannon信息论中一个重要概念，主要用于度量两个概率分布间的差异性信息。</p></blockquote><span id="more"></span><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>在信息论中，交叉熵（Cross Entropy）是表示两个概率分布p,q，其中p表示真实分布，q表示非真实分布，在相同的一组事件中，其中，用非真实分布q来表示某个事件发生所需要的平均比特数。。</p><ul><li>假设现在有一个样本集中两个概率分布p,q，其中p为真实分布，q为非真实分布。假如，按照真实分布p来衡量识别一个样本所需要的编码长度的期望为：</li></ul><p>$$<br>\mathrm{H}(\mathrm{p})=\sum_{i} p(i) \cdot \log \left(\frac{1}{p(i)}\right)<br>$$</p><ul><li><p>但是，如果采用错误的分布q来表示来自真实分布p的平均编码长度，则应该是:<br>$$<br>\mathrm{H}(\mathrm{p}, \mathrm{q})=\sum_{i} p(i) \cdot \log \left(\frac{1}{q(i)}\right)<br>$$</p></li><li><p>此时就将H(p,q)称之为交叉嫡。交叉嫡的计算方式如下:</p><ul><li>对于离散变量采用以下的方式计算:<br>$$<br>\mathrm{H}(\mathrm{p}, \mathrm{q})=\sum_{x} p(x) \cdot \log   \left(\frac{1}{q(x)}\right)<br>$$</li><li>对于连续变量采用以下的方式计算: </li></ul></li></ul><p>$$<br>\mathrm{H}(\mathrm{p}, \mathrm{q})=-\int_{X} P(x) \log Q(x) d r(x)=E_{p}[-\log Q]<br>$$</p><h3 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h3><ul><li>交叉熵可以看作真实分布的熵与估计分布与真实分布的KL散度的和</li></ul><p>$$<br>H(P, Q)=H(P)+D_{K L}(P | Q)=-\mathbb{E}_{X \sim P(X)} \log Q(x)<br>$$</p><ul><li>KL散度不对称，不同分布熵值不同，因此交叉熵不对称</li><li>交叉嫡刻画了使用错误分布 $ Q $ 来表示真实分布 $ P $ 中的样本的平均编码长度。</li><li>$ D_{K L(P|| Q)} $ 刻画了错误分布 $ Q $ 编码真实分布 $ P $ 带来的平均编码长度的增量。</li></ul><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><blockquote><p>交叉熵在深度学习的损失函数中得到广泛应用</p></blockquote><p>真实数据分布（标签）为$Y$，预测分布为$P$</p><p>事实上我们用的交叉熵为$H(Y,P)$，即使用Y的分布，用P的编码方式度量信息熵大小</p><ul><li>二分类时</li></ul><p>$$<br>L=\frac{1}{N} \sum_{i} L_{i}=\frac{1}{N} \sum_{i}-\left[y_{i} \cdot \log \left(p_{i}\right)+\left(1-y_{i}\right) \cdot \log \left(1-p_{i}\right)\right]<br>$$</p><blockquote><p>其中: $ y_{i}$ 表示样本 $ i $ 的label, 正类为 1, 负类为 0 $ p_{i} \longrightarrow $ 表示样本 $ i $ 预测为正的概率</p></blockquote><ul><li>多分类</li></ul><p>$$<br>L=\frac{1}{N} \sum_{i} L_{i}=\frac{1}{N} \sum_{i}-\sum_{c=1}^{M} y_{i c} \log \left(p_{i c}\right)<br>$$</p><blockquote><p>至于为什么不用$H(P,Y)$，可能是因为$y$的值很容易取到0，超出了$log$运算的变量取值范围无法计算吧（个人猜测）</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li><li><a href="https://baike.baidu.com/item/%E4%BA%A4%E5%8F%89%E7%86%B5/8983241?fr=aladdin">https://baike.baidu.com/item/%E4%BA%A4%E5%8F%89%E7%86%B5/8983241?fr=aladdin</a></li><li><a href="https://zhuanlan.zhihu.com/p/35709485">https://zhuanlan.zhihu.com/p/35709485</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>information theory</category>
      
    </categories>
    
    
    <tags>
      
      <tag>information theory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python ONNX-GPU 使用记录</title>
    <link href="/2021/05/28/deep_learning/deploy/onnx-gpu/onnx-gpu/"/>
    <url>/2021/05/28/deep_learning/deploy/onnx-gpu/onnx-gpu/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Microsoft 和合作伙伴社区创建了 ONNX 作为表示机器学习模型的开放标准。 许多框架（包括 TensorFlow、PyTorch、SciKit-Learn、Keras、Chainer、MXNet、MATLAB 和 SparkML）中的模型都可以导出或转换为标准 ONNX 格式。 模型采用 ONNX 格式后，可在各种平台和设备上运行。<br>本文记录Python 平台 ONNX-GPU 相关内容。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ul><li>官网：<a href="https://github.com/microsoft/onnxruntime">https://github.com/microsoft/onnxruntime</a></li></ul><p>ONNX Runtime是一个跨平台的推理和训练机器学习加速器。</p><p>支持Linux和Windows平台CPU和GPU运算，对mac和手机终端也有相应支持。</p><table><thead><tr><th>System</th><th>CPU</th><th>GPU</th><th>EPs</th></tr></thead><tbody><tr><td>Windows</td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=9"><img src="https://camo.githubusercontent.com/be880d22fe303c2f6ffbe8d73f424d8ddeac9fcf532e3ec3627fdc180f183e1f/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f57696e646f77732532304350552532304349253230506970656c696e653f6c6162656c3d57696e646f77732b435055" alt="Build Status"></a></td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=10"><img src="https://camo.githubusercontent.com/e33aca450d284558ffc63bf21927d447d01f488a1d7df6e090c6cbccf037cac5/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f57696e646f77732532304750552532304349253230506970656c696e653f6c6162656c3d57696e646f77732b475055" alt="Build Status"></a></td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=47"><img src="https://camo.githubusercontent.com/2c2bd99ffe7f972aa4c183eba8544503a158714dd223a992988509815bdb1c11/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f57696e646f777325323047505525323054656e736f7252542532304349253230506970656c696e653f6c6162656c3d57696e646f77732b4750552b54656e736f725254" alt="Build Status"></a></td></tr><tr><td>Linux</td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=11"><img src="https://camo.githubusercontent.com/bcd33ff670e84f7132dd34ff37a8bd57ec1b1be818ac1b8cf34c132f7f10c87a/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4c696e75782532304350552532304349253230506970656c696e653f6c6162656c3d4c696e75782b435055" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=64"><img src="https://camo.githubusercontent.com/85426588bfb8fbf42f41aa0c32096b631efbb809dd0a936017732b04dab69a50/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4c696e75782532304350552532304d696e696d616c2532304275696c642532304532452532304349253230506970656c696e653f6c6162656c3d4c696e75782b4350552b4d696e696d616c2b4275696c64" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=110"><img src="https://camo.githubusercontent.com/8289099bfbf822bbc320451ed69cb7adb15607f8568ca7643752999a16a6533b/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4c696e75782532304350552532307836342532304e6f436f6e747269626f70732532304349253230506970656c696e653f6c6162656c3d4c696e75782b4350552b7836342b4e6f2b436f6e747269622b4f7073" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=78"><img src="https://camo.githubusercontent.com/50de544334d5d7f29061f1fb3f558227b1c3a3920f11de7934750f65960dfd34/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f63656e746f73375f6370753f6c6162656c3d4c696e75782b43656e744f5337" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=86"><img src="https://camo.githubusercontent.com/066e8e60036d9e0aecdf3753c113f33f8697fda89ae9914acaea7f913a6e4769/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f6f7274747261696e696e672d6c696e75782d63692d706970656c696e653f6c6162656c3d4c696e75782b4350552b547261696e696e67" alt="Build Status"></a></td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=12"><img src="https://camo.githubusercontent.com/72d213d439fccb5d33324bd00071daccacb8ab2df5323060af696e6f82ace6e8/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4c696e75782532304750552532304349253230506970656c696e653f6c6162656c3d4c696e75782b475055" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=45"><img src="https://camo.githubusercontent.com/f110d4576f50405da2854a1e9d1bba0c0627044c5ad82013e16449d22798f526/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4c696e757825323047505525323054656e736f7252542532304349253230506970656c696e653f6c6162656c3d4c696e75782b4750552b54656e736f725254" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=140"><img src="https://camo.githubusercontent.com/bc7f031f8438e7a661261d9c8967842d9793751ce2a3e0c9807b5248050f0de0/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f6f7274747261696e696e672d64697374726962757465643f6c6162656c3d44697374726962757465642b547261696e696e67" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=84"><img src="https://camo.githubusercontent.com/a4c8f48b2efbd684894b44e682783b9ff03b23f05b5c4a597e1c8f14f60f36f9/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f6f7274747261696e696e672d6c696e75782d6770752d63692d706970656c696e653f6c6162656c3d4c696e75782b4750552b547261696e696e67" alt="Build Status"></a></td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=110"><img src="https://camo.githubusercontent.com/787d2230b6d423bda5990762536e8f86c9dd948e7ce1185807c0d4439a35d91a/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4c696e75782532304e55504841522532304349253230506970656c696e653f6c6162656c3d4c696e75782b4e5550484152" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=108"><img src="https://camo.githubusercontent.com/5cf8f65642cc2a92b1bf086c85508cc1bbb97e7845c1ae2375bf7dc459e43f03/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4c696e75782532304f70656e56494e4f2532304349253230506970656c696e6525323076323f6c6162656c3d4c696e75782b4f70656e56494e4f" alt="Build Status"></a></td></tr><tr><td>Mac</td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=13"><img src="https://camo.githubusercontent.com/ef7087dee28345cd8e82f7a064c57494abd10b7e686e3233f8b5051b9cded120/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4d61634f532532304349253230506970656c696e653f6c6162656c3d4d61634f532b435055" alt="Build Status"></a> <a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=65"><img src="https://camo.githubusercontent.com/1aba99d56e516ed581f0559974642fd07e1ebcc1b9f7ca765542e5360f5969b4/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f4d61634f532532304e6f436f6e747269626f70732532304349253230506970656c696e653f6c6162656c3d4d61634f532b4e6f436f6e747269626f7073" alt="Build Status"></a></td><td></td><td></td></tr><tr><td>Android</td><td></td><td></td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=53"><img src="https://camo.githubusercontent.com/dacddb7b5ea5a7748e13edd2e3264043cc2fafa941bccd47fb12f52d1b4f5681/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f416e64726f69642532304349253230506970656c696e653f6c6162656c3d416e64726f6964" alt="Build Status"></a></td></tr><tr><td>iOS</td><td></td><td></td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=134"><img src="https://camo.githubusercontent.com/15d5515030d3afc962dd5ba49171f26ffee4b70142869a65ceb3bd15d1fb449b/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f694f532532304349253230506970656c696e653f6c6162656c3d694f53" alt="Build Status"></a></td></tr><tr><td>WebAssembly</td><td></td><td></td><td><a href="https://dev.azure.com/onnxruntime/onnxruntime/_build/latest?definitionId=161"><img src="https://camo.githubusercontent.com/4c63c39a9901a1b61ffe2183592a778aa3d70445d4ad4153bbfbb89c498efc4e/68747470733a2f2f6465762e617a7572652e636f6d2f6f6e6e7872756e74696d652f6f6e6e7872756e74696d652f5f617069732f6275696c642f7374617475732f57696e646f7773253230576562417373656d626c792532304349253230506970656c696e653f6c6162656c3d5741534d" alt="Build Status"></a></td></tr></tbody></table><ul><li><strong>ONNX Runtime inference</strong></li></ul><p>ONNX运行时推断可以实现更快的客户体验和更低的成本，支持来自深度学习框架（如PyTorch和TensorFlow/Keras）的模型，以及经典的机器学习库（如scikit learn、LightGBM、XGBoost等）。ONNX运行时与不同的硬件、驱动程序和操作系统兼容，并通过在适用的情况下利用硬件加速器以及图形优化和转换提供最佳性能。</p><blockquote><p>官方文档：<a href="https://www.onnxruntime.ai/docs/#onnx-runtime-for-inferencing">https://www.onnxruntime.ai/docs/#onnx-runtime-for-inferencing</a></p></blockquote><p><strong>ONNX Runtime training</strong></p><p>通过对现有PyTorch培训脚本进行单行添加，ONNX Runtime培训可加快多节点NVIDIA GPU上变压器模型的模型培训时间。</p><blockquote><p>官方文档：<a href="https://www.onnxruntime.ai/docs/#onnx-runtime-for-training">https://www.onnxruntime.ai/docs/#onnx-runtime-for-training</a></p></blockquote><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul><li>在Python下安装，CPU版：</li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> onnxruntime<br></code></pre></td></tr></table></figure><ul><li>在Python下安装，GPU版：</li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> onnxruntime-gpu<br></code></pre></td></tr></table></figure><h3 id="版本要求"><a href="#版本要求" class="headerlink" title="版本要求"></a>版本要求</h3><h4 id="onnx与onnxruntime版本关系"><a href="#onnx与onnxruntime版本关系" class="headerlink" title="onnx与onnxruntime版本关系"></a>onnx与onnxruntime版本关系</h4><blockquote><p>官方链接：<a href="https://github.com/microsoft/onnxruntime/blob/master/docs/Versioning.md#version-matrix">https://github.com/microsoft/onnxruntime/blob/master/docs/Versioning.md#version-matrix</a></p></blockquote><table><thead><tr><th>ONNX Runtime release version</th><th>ONNX release version</th><th>ONNX opset version</th><th>ONNX ML opset version</th><th>Supported ONNX IR version</th><th><a href="https://docs.microsoft.com/en-us/windows/ai/windows-ml/release-notes/">Windows ML Availability</a></th></tr></thead><tbody><tr><td>1.8.0</td><td><strong>1.8</strong> down to 1.2</td><td>13</td><td>2</td><td>7</td><td>Windows AI 1.8+</td></tr><tr><td>1.7.0</td><td><strong>1.8</strong> down to 1.2</td><td>13</td><td>2</td><td>7</td><td>Windows AI 1.7+</td></tr><tr><td>1.6.0</td><td><strong>1.8</strong> down to 1.2</td><td>13</td><td>2</td><td>7</td><td>Windows AI 1.6+</td></tr><tr><td>1.5.3</td><td><strong>1.7</strong> down to 1.2</td><td>12</td><td>2</td><td>7</td><td>Windows AI 1.5+</td></tr><tr><td>1.5.2</td><td><strong>1.7</strong> down to 1.2</td><td>12</td><td>2</td><td>7</td><td>Windows AI 1.5+</td></tr><tr><td>1.5.1</td><td><strong>1.7</strong> down to 1.2</td><td>12</td><td>2</td><td>7</td><td>Windows AI 1.5+</td></tr><tr><td>1.4.0</td><td><strong>1.7</strong> down to 1.2</td><td>12</td><td>2</td><td>7</td><td>Windows AI 1.4+</td></tr><tr><td>1.3.1</td><td><strong>1.7</strong> down to 1.2</td><td>12</td><td>2</td><td>7</td><td>Windows AI 1.4+</td></tr><tr><td>1.3.0</td><td><strong>1.7</strong> down to 1.2</td><td>12</td><td>2</td><td>7</td><td>Windows AI 1.3+</td></tr><tr><td>1.2.0 1.1.2 1.1.1 1.1.0</td><td><strong>1.6</strong> down to 1.2</td><td>11</td><td>2</td><td>6</td><td>Windows AI 1.3+</td></tr><tr><td>1.0.0</td><td><strong>1.6</strong> down to 1.2</td><td>11</td><td>2</td><td>6</td><td>Windows AI 1.3+</td></tr><tr><td>0.5.0</td><td><strong>1.5</strong> down to 1.2</td><td>10</td><td>1</td><td>5</td><td>Windows AI 1.3+</td></tr><tr><td>0.4.0</td><td><strong>1.5</strong> down to 1.2</td><td>10</td><td>1</td><td>5</td><td>Windows AI 1.3+</td></tr><tr><td>0.3.1 0.3.0</td><td><strong>1.4</strong> down to 1.2</td><td>9</td><td>1</td><td>3</td><td>Windows 10 2004+</td></tr><tr><td>0.2.1 0.2.0</td><td><strong>1.3</strong> down to 1.2</td><td>8</td><td>1</td><td>3</td><td>Windows 10 1903+</td></tr><tr><td>0.1.5 0.1.4</td><td><strong>1.3</strong> down to 1.2</td><td>8</td><td>1</td><td>3</td><td>Windows 10 1809+</td></tr></tbody></table><h4 id="onnxruntime-与-CUDA-cuDNN版本要求"><a href="#onnxruntime-与-CUDA-cuDNN版本要求" class="headerlink" title="onnxruntime 与 CUDA cuDNN版本要求"></a>onnxruntime 与 CUDA cuDNN版本要求</h4><blockquote><p>官方链接：<a href="https://www.onnxruntime.ai/docs/reference/execution-providers/CUDA-ExecutionProvider.html#requirements">https://www.onnxruntime.ai/docs/reference/execution-providers/CUDA-ExecutionProvider.html#requirements</a></p></blockquote><table><thead><tr><th>ONNX Runtime</th><th>CUDA</th><th>cuDNN</th><th>Notes</th></tr></thead><tbody><tr><td>1.8</td><td>11.0.3</td><td>8.0.4 (Linux) 8.0.2.39 (Windows)</td><td>libcudart 11.0.221 libcufft 10.2.1.245 libcurand 10.2.1.245 libcublasLt 11.2.0.252 libcublas 11.2.0.252 libcudnn 8.0.4 libcupti.so 2020.1.1</td></tr><tr><td>1.7</td><td>11.0.3</td><td>8.0.4 (Linux) 8.0.2.39 (Windows)</td><td>libcudart 11.0.221 libcufft 10.2.1.245 libcurand 10.2.1.245 libcublasLt 11.2.0.252 libcublas 11.2.0.252 libcudnn 8.0.4</td></tr><tr><td>1.5-1.6</td><td>10.2</td><td>8.0.3</td><td>CUDA 11 can be built from source</td></tr><tr><td>1.2-1.4</td><td>10.1</td><td>7.6.5</td><td>Requires cublas10-10.2.1.243; cublas 10.1.x will not work</td></tr><tr><td>1.0-1.1</td><td>10.0</td><td>7.6.4</td><td>CUDA versions from 9.1 up to 10.1, and cuDNN versions from 7.1 up to 7.4 should also work with Visual Studio 2017</td></tr></tbody></table><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://github.com/microsoft/onnxruntime">https://github.com/microsoft/onnxruntime</a></li><li><a href="https://blog.csdn.net/zxgmlcj/article/details/103279869">https://blog.csdn.net/zxgmlcj/article/details/103279869</a></li><li><a href="https://zhuanlan.zhihu.com/p/261307813">https://zhuanlan.zhihu.com/p/261307813</a></li><li><a href="https://github.com/open-mmlab/mmdetection/blob/master/docs/tutorials/pytorch2onnx.md">https://github.com/open-mmlab/mmdetection/blob/master/docs/tutorials/pytorch2onnx.md</a></li><li><a href="https://www.jianshu.com/p/3a51f7d3357f">https://www.jianshu.com/p/3a51f7d3357f</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>deep learning</category>
      
      <category>deploy</category>
      
      <category>onnx</category>
      
    </categories>
    
    
    <tags>
      
      <tag>deep learning</tag>
      
      <tag>deploy</tag>
      
      <tag>onnx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>信息论 - 基础概念</title>
    <link href="/2021/05/27/information-theory/basic_knowledge/basic_knowledge/"/>
    <url>/2021/05/27/information-theory/basic_knowledge/basic_knowledge/</url>
    
    <content type="html"><![CDATA[<blockquote><p>信息论是运用概率论与数理统计的方法研究信息、信息熵、通信系统、数据传输、密码学、数据压缩等问题的应用数学学科。本文介绍基本概念。</p></blockquote><span id="more"></span><h3 id="信息"><a href="#信息" class="headerlink" title="信息"></a>信息</h3><ul><li><strong>信息</strong>是用来<strong>消除</strong>事情的<strong>不确定性</strong>的，<strong>不确定性的减少量</strong>等于*<em>信息的信息量。</em></li><li>信息论背后的原理是：从不太可能发生的事件中能学到更多的有用信息。<ul><li>发生可能性较大的事件包含较少的信息。</li><li>发生可能性较小的事件包含较多的信息。</li><li>独立事件包含额外的信息 。</li></ul></li></ul><h3 id="熵"><a href="#熵" class="headerlink" title="熵"></a>熵</h3><ul><li>对于事件 $ X=x $, 定义自信息 （self-information） 为：</li></ul><p>$$<br>I(x)=-\log P(x)<br>$$</p><ul><li> 自信息仅仅处理单个输出，但是如果计算自信息的期望，它就是嫡:</li></ul>$$H(X)=\mathbb{E}_{X \sim P(X)}[I(x)]=-\mathbb{E}_{X \sim P(X)}[\log P(x)]$$<ul><li><p>记作 $ H(P) $ </p></li><li><p>熵刻画了按照真实分布 $ P $ 来识别一个样本所需要的编码长度的期望（即平均编码长度）。</p><blockquote><p>如：含有4个字母 $ (A, B, C, D) $ 的样本集中，真实分布 $ P=\left(\frac{1}{2}, \frac{1}{2}, 0,0\right) $, 则只需要1位编码即可识别样本。 </p></blockquote></li><li><p>对于离散型随机变量 $ X $, 假设其取值集合大小为 $ k $, 则</p><h4 id="可以证明-0-leq-H-X-leq-log-k"><a href="#可以证明-0-leq-H-X-leq-log-k" class="headerlink" title="可以证明: $ 0 \leq H(X) \leq \log k $"></a>可以证明: $ 0 \leq H(X) \leq \log k $</h4><h5 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h5><p>已知：</p><p>$$<br>P(X=i)=p_i<br>$$</p><p>$$<br>H(X)=\sum_{i=1}^{k} P_{i} \log P_{i}<br>$$</p><p>$$<br>\sum_{i=1}^{k} P_{i}=1<br>$$</p><p>建立拉格朗日方程：</p><p>$$<br>L=\sum_{i=1}^{k} P_{i} \log P_{i}+\lambda \sum_{i=1}^{k} P_{i}<br>$$</p><p>解方程组：</p>  $$  \left\{\begin{array}{l}\frac{\partial L}{\partial P_{i}}=0 \\     \sum_{i=1}^{k} P_{i}=1\end{array}\right.  $$  <p>有：<br>$$<br>\frac{\partial L}{\partial P_{i}}=\log P_{i}+1+\lambda=0<br>$$<br>$$<br>\log P_{i}=-1-\lambda<br>$$<br>$$<br>P_{i}=2^{-1-\lambda}<br>$$</p><p>由于$P_i$之间两两相等，且和为1</p><p>因此有：<br>$$<br>P_i=\frac{1}{k}<br>$$<br>即当所有可能性的概率相等时熵最大</p><p>此时熵：<br>$$<br>H(X) = \sum\nolimits_{i = 1}^{i = k} {\frac{1}{k}\log \frac{1}{k} = \log \frac{1}{k}}<br>$$</p></li></ul><h3 id="条件熵"><a href="#条件熵" class="headerlink" title="条件熵"></a>条件熵</h3><ul><li>对于随机变量 $ Y $ 和 $ X $, 条件嫡 $ H(Y \mid X) $ 表示：已知随机变量 $ X $ 的条件下，随机变量 $ Y $ 的不确定性。<br>它定义为： $ X $ 给定条件下 $ Y $ 的条件概率分布的嫡对 $ X $ 的期望：</li></ul>$$H(Y \mid X)=\mathbb{E}_{X \sim P(X)}[H(Y \mid X=x)]=-\mathbb{E}_{(X, Y) \sim P(X, Y)} \log P(Y \mid X)$$<ul><li>对于离散型随机变量，有.</li></ul><p>$$<br>H(Y \mid X)=\sum_{x} p(x) H(Y \mid X=x)=-\sum_{x} \sum_{y} p(x, y) \log p(y \mid x)<br>$$</p><ul><li>对于连续型随机变量，有:</li></ul><p>$$<br>H(Y \mid X)=\int p(x) H(Y \mid X=x) d x=-\iint p(x, y) \log p(y \mid x) d x d y<br>$$</p><ul><li><p>根据定义可以证明： $ H(X, Y)=H(Y \mid X)+H(X) $ 。</p><blockquote><p>即：描述 $ X $ 和 $ Y $ 所需要的信息是：描述 $ X $ 所需要的信息加上给定 $ X $ 条件下描述 $ Y $ 所需的额外信息。</p></blockquote></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://zhuanlan.zhihu.com/p/85779990">https://zhuanlan.zhihu.com/p/85779990</a></p></li><li><p><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></p></li><li><p><a href="https://baike.baidu.com/item/%E4%BF%A1%E6%81%AF%E8%AE%BA/302185?fr=aladdin">https://baike.baidu.com/item/%E4%BF%A1%E6%81%AF%E8%AE%BA/302185?fr=aladdin</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>information theory</category>
      
    </categories>
    
    
    <tags>
      
      <tag>information theory</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>线性回归 - MAP</title>
    <link href="/2021/05/25/math/regression/ridge-regression-MAP/ridge-regression-map/"/>
    <url>/2021/05/25/math/regression/ridge-regression-MAP/ridge-regression-map/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录岭回归角度进行线性回归的方法。</p></blockquote><span id="more"></span><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><blockquote><p>考虑一个线性模型 ${y}=f({\bf{x}})$</p><p>其中$y$是模型的输出值，是标量，$\bf{x}$为$d$维实数空间的向量</p></blockquote><ul><li>线性模型可以表示为:</li></ul><p>$$<br>f(\bf{x})=\bf{w} ^Tx,w\in \mathbb{R}<br>$$</p><ul><li>线性回归的任务是利用$n$个训练样本：</li></ul>$$X=\left[\begin{array}{lll}\bf{x}_{1} & \cdots & \bf{x}_{n}\end{array}\right]^{T}=\left[\begin{array}{c}\bf{x}_{1}^{T} \\ \vdots \\ \bf{x}_{n}^{T}\end{array}\right] \quad \bf{x} \in \mathbb{R}$$<ul><li>和样本对应的标签：</li></ul><p>$$<br>Y = [ y _ { 1 } \cdots \quad y _ { n } ] ^ { T } \quad y \in \mathbb{R}<br>$$</p><ul><li>来预测线性模型中的参数 $\bf{\omega}$，使得模型尽可能准确输出预测值</li></ul><h3 id="线性回归-MAP"><a href="#线性回归-MAP" class="headerlink" title="线性回归 / MAP"></a>线性回归 / MAP</h3><blockquote><p>岭回归就是带有$L_2$正则的线性回归，也可以从最大后验概率的角度推出</p></blockquote><ul><li>根据贝叶斯公式  $$  \begin{aligned}  P(w \mid Y, X) &=\frac{P(Y, X, w)}{P(Y, X)} \\  &=\frac{P(Y \mid X, w) P(X \mid w) P(w)}{P(Y, X)} \\  & \propto P(Y \mid X, w) P(w)  \end{aligned}  $$</li></ul><ul><li><p>其中 $ P(Y \mid X, w) $ 和 $ P(w) $ 分别是似然和先验, 并且$ y \mid x, w \sim \mathcal{N}\left(w^{T} x, \sigma^{2}\right) $，$ w \sim \mathcal{N}(0, \Sigma) $</p></li><li><p>接着，其中第一项：</p>  $$  \begin{aligned}  P(Y \mid X, w) &=\prod_{i=1}^{n} P\left(y_{i} \mid x_{i}, w\right) \\  &=\prod_{i=1}^{n} \frac{1}{\sqrt{2 \pi} \sigma} \exp \left(-\frac{\left(y_{i}-w^{T} x_{i}\right)^{2}}{2 \sigma^{2}}\right) \\  &=\frac{1}{(2 \pi)^{\frac{n}{2}} \sigma^{n}} \prod_{i=1}^{n} \exp \left(-\frac{\left(y_{i}-w^{T} x_{i}\right)^{2}}{2 \sigma^{2}}\right)\end{aligned}  $$  </li><li><p>第二项：</p></li></ul><p>$$<br>P(w)=\frac{1}{\sqrt{2 \pi}|\Sigma|^{\frac{1}{2}}} \exp \left(-\frac{w^{T} \Sigma^{-1} w}{2}\right)<br>$$</p><ul><li>然后对 $ P(Y \mid X, w) P(w) $ 取对数, 得到：</li></ul>$$\begin{array}{l}\log P(Y \mid X, w) P(w) \\=\log \left(\frac{1}{(2 \pi)^{\frac{n}{2}} \sigma^{n}}\left(\prod_{i=1}^{n} \exp \left(-\frac{\left(y_{i}-w^{T} x_{i}\right)^{2}}{2 \sigma^{2}}\right)\right) \cdot \frac{1}{\sqrt{2 \pi}|\Sigma|^{\frac{1}{2}}} \exp \left(-\frac{w^{T} \Sigma^{-1} w}{2}\right)\right) \\=\log \frac{1}{(2 \pi)^{\frac{n}{2}} \sigma^{n}}+\log \frac{1}{\sqrt{2 \pi}|\Sigma|^{\frac{1}{2}}}-\frac{1}{2 \sigma^{2}} \sum_{i=1}^{n}\left(y_{i}-w^{T} x_{i}\right)^{2}-\frac{1}{2} w^{T} \Sigma^{-1} w\end{array}$$<ul><li>同样的套路, 针对对数函数求解最优参数</li></ul>$$\begin{array}{l}\hat{w}=\arg \max _{w} P(Y \mid X, w) P(w) \\=\arg \max _{w} \log \frac{1}{(2 \pi)^{\frac{n}{2}} \sigma^{n}}+\log \frac{1}{\sqrt{2 \pi}|\Sigma|^{\frac{1}{2}}}-\frac{1}{2 \sigma^{2}} \sum_{i=1}^{n}\left(y_{i}-w^{T} x_{i}\right)^{2}-\frac{1}{2} w^{T} \Sigma^{-1} w \\=\arg \min _{w} \frac{1}{2 \sigma^{2}} \sum_{i=1}^{n}\left(y_{i}-w^{T} x_{i}\right)^{2}+\frac{1}{2} w^{T} \Sigma^{-1} w \\=\arg \min _{w} \sum_{i=1}^{n}\left(y_{i}-w^{T} x_{i}\right)^{2}+w^{T}\left(\sigma^{2} \Sigma^{-1}\right) w\end{array}$$<ul><li>将上式看作损失函数</li></ul>$$\begin{aligned}L(w) &=\sum_{i=1}^{n}\left(y_{i}-w^{T} x_{i}\right)^{2}+w^{T}\left(\sigma^{2} \Sigma^{-1}\right) w \\&=w^{T} X^{T} X w-2 w^{T} X^{T} Y+Y^{T} Y+w^{T}\left(\sigma^{2} \Sigma^{-1}\right) w \\&=w^{T}\left(X^{T} X+\sigma^{2} \Sigma^{-1}\right) w-2 w^{T} X^{T} Y+Y^{T} Y\end{aligned}$$<ul><li>然后对其求导</li></ul><p>$$<br>\frac{\partial L(w)}{\partial w}=2\left(X^{T} X+\sigma^{2} \Sigma^{-1}\right) w-2 X^{T} Y=0<br>$$</p><ul><li>得到:</li></ul><p>$$<br>\hat{w}=\left(X^{T} X+\sigma^{2} \Sigma^{-1}\right)^{-1} X^{T} Y<br>$$</p><ul><li>令 $ \sigma^{2} \Sigma^{-1}=\lambda $ 就得到了岭回归的结果</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/86009986">https://zhuanlan.zhihu.com/p/86009986</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>regression</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>regression</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>线性回归 - 岭回归</title>
    <link href="/2021/05/25/math/regression/ridge-regression/ridge-regression/"/>
    <url>/2021/05/25/math/regression/ridge-regression/ridge-regression/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录岭回归角度进行线性回归的方法。</p></blockquote><span id="more"></span><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><blockquote><p>考虑一个线性模型 ${y}=f({\bf{x}})$</p><p>其中$y$是模型的输出值，是标量，$\bf{x}$为$d$维实数空间的向量</p></blockquote><ul><li>线性模型可以表示为:</li></ul><p>$$<br>f(\bf{x})=\bf{w} ^Tx,w\in \mathbb{R}<br>$$</p><ul><li>线性回归的任务是利用$n$个训练样本：</li></ul>$$X=\left[\begin{array}{lll}\bf{x}_{1} & \cdots & \bf{x}_{n}\end{array}\right]^{T}=\left[\begin{array}{c}\bf{x}_{1}^{T} \\ \vdots \\ \bf{x}_{n}^{T}\end{array}\right] \quad \bf{x} \in \mathbb{R}$$<ul><li>和样本对应的标签：</li></ul><p>$$<br>Y = [ y _ { 1 } \cdots \quad y _ { n } ] ^ { T } \quad y \in \mathbb{R}<br>$$</p><ul><li>来预测线性模型中的参数 $\bf{\omega}$，使得模型尽可能准确输出预测值</li></ul><h3 id="线性回归-岭回归"><a href="#线性回归-岭回归" class="headerlink" title="线性回归 / 岭回归"></a>线性回归 / 岭回归</h3><blockquote><p>岭回归就是带有$L_2$正则的线性回归&gt;</p></blockquote><ul><li>之前最小二乘法的损失函数：</li></ul><p>$$<br>L(w)= w^{T} X^{T^{\prime}} X w-2 w^{T} X^{T} Y+Y^{T} Y<br>$$</p><ul><li>岭回归的代价函数：</li></ul>$$ \begin{aligned} J(w) &=L(w)+\lambda w^{T} w \\ &=w^{T} X^{T} X w-2 w^{T} X^{T} Y+Y^{T} Y+\lambda w^{T} w \\ &=w^{T}\left(X^{T} X+\lambda I\right) w-2 w^{T} X^{T} Y+Y^{T} Y \end{aligned} $$<ul><li><p>上式中 $ \lambda $ 是正则化系数，现在优化的目标就转为 $ J(w) $ 函数了</p>  $$  \begin{aligned}  \hat{w} &=\arg \min _{w} J(w) \\  &=\arg \min _{w} w^{T}\left(X^{T} X+\lambda I\right) w-2 w^{T} X^{T} Y+Y^{T} Y \\  &=\arg \min _{w} w^{T}\left(X^{T} X+\lambda I\right) w-2 w^{T} X^{T} Y  \end{aligned}  $$</li><li><p>对上面的函数求导并令导数为0, 得到<br>$$<br>\frac{\partial J(w)}{\partial w}=2\left(X^{T} X+\lambda I\right) w-2 X^{T} Y=0<br>$$</p></li><li><p>从上式不难得到：<br>$$<br>\hat{w}=\left(X^{T} X+\lambda I\right)^{-1} X^{T} Y<br>$$</p></li><li><p>要更直观的理解 $ \lambda $ 的作用, 可以假设每个样本只有一个属性, $ \quad X^{T} X $ 就是一个实数, 所以:</p></li></ul><p>$$<br>\hat{w}=\frac{X^{T} Y}{X^{T} X+\lambda}, \quad \lambda&gt;0<br>$$</p><blockquote><p>可以看到，随着 $ \lambda $ 的增大, $ \quad \hat{w} $ 的值会渐渐减小, 对 $ \hat{w} $ 起到了抑制作用</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/86009986">https://zhuanlan.zhihu.com/p/86009986</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>regression</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>regression</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>线性回归 - MLE</title>
    <link href="/2021/05/25/math/regression/linear-regression-MLE/linear-regression-MLE/"/>
    <url>/2021/05/25/math/regression/linear-regression-MLE/linear-regression-MLE/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录极大似然估计角度进行线性回归，得到最小二乘法结果的方法。</p></blockquote><span id="more"></span><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><blockquote><p>考虑一个线性模型 ${y}=f({\bf{x}})$</p><p>其中$y$是模型的输出值，是标量，$\bf{x}$为$d$维实数空间的向量</p></blockquote><ul><li>线性模型可以表示为:</li></ul><p>$$<br>f(\bf{x})=\bf{w} ^Tx,w\in \mathbb{R}<br>$$</p><ul><li>线性回归的任务是利用$n$个训练样本：</li></ul>$$X=\left[\begin{array}{lll}\bf{x}_{1} & \cdots & \bf{x}_{n}\end{array}\right]^{T}=\left[\begin{array}{c}\bf{x}_{1}^{T} \\ \vdots \\ \bf{x}_{n}^{T}\end{array}\right] \quad \bf{x} \in \mathbb{R}$$<ul><li>和样本对应的标签：</li></ul><p>$$<br>Y = [ y _ { 1 } \cdots \quad y _ { n } ] ^ { T } \quad y \in \mathbb{R}<br>$$</p><ul><li>来预测线性模型中的参数 $\bf{\omega}$，使得模型尽可能准确输出预测值</li></ul><h3 id="线性回归-MLE"><a href="#线性回归-MLE" class="headerlink" title="线性回归 / MLE"></a>线性回归 / MLE</h3><blockquote><p>最小二乘法的损失函数是启发式定义来的，我们从另一个角度进行线性回归</p></blockquote><ul><li>我们可以认为真实模型是带有噪声的，即：</li></ul><p>$$<br>y=\bf{w}^Tx+\epsilon<br>$$</p><ul><li>其中噪声分布为：</li></ul><p>$$<br>\epsilon \sim \mathcal{N}\left(0, \sigma^{2}\right)<br>$$</p><ul><li>$  x $ 是给定的, $  w $ 虽然是未知的，但是也是固定的, 所以 $ w^{T} x $ 是一个常量, 因此 $ y $ 也可以看作是一个关于随机变量 $ \epsilon $ 的函数,</li></ul><p>$$<br>y=g(\epsilon)<br>$$</p><ul><li>估计$y$的均值:</li></ul>$$ \begin{aligned} \mathbb{E}[y] &=\mathbb{E}[g(\epsilon)] \\ &=\mathbb{E}\left[w^{T} x+\epsilon\right] \\ &=\mathbb{E}\left[w^{T} x\right]+\mathbb{E}[\epsilon] \\ &=w^{T} x \end{aligned} $$<ul><li>方差:</li></ul>$$\begin{aligned}\operatorname{Var}[y] &=\operatorname{Var}[g(\epsilon)] \\&=\operatorname{Var}\left[w^{T} x+\epsilon\right] \\&=\operatorname{Var}\left[w^{T} x\right]+\operatorname{Var}[\epsilon] \\&=\sigma^{2}\end{aligned}$$<ul><li>因此$y$的分布可以确定:</li></ul><p>$$<br>y \sim \mathcal{N}\left(w^{T} x, \sigma^{2}\right)<br>$$</p><ul><li>接着就可以通过<strong>最大似然估计</strong>来求解$\bf{w}$，首先定义对数似然函数:</li></ul>$$ \begin{aligned} \ell(w) &=\log P(Y \mid X, w) \\ &=\log \prod_{i=1}^{n} P\left(y_{i} \mid x_{i}, w\right) \\ &=\log \prod_{i=1}^{n} \frac{1}{\sqrt{2 \pi} \sigma} \exp \left(-\frac{1}{2 \sigma}\left(y_{i}-w^{T} x\right)^{2}\right) \\ &=\log \frac{1}{(2 \pi)^{\frac{n}{2}} \sigma^{n}}+\sum_{i}^{n}\left(-\frac{1}{2 \sigma}\left(y_{i}-w^{T} x\right)^{2}\right) \end{aligned} $$<ul><li>求解最优值：</li></ul>$$\begin{aligned} \hat{w} &=\arg \max _{w} \ell(w) \\ &=\arg \max _{w} \log \frac{1}{(2 \pi)^{\frac{n}{2}} \sigma^{n}}+\sum_{i}^{n}\left(-\frac{1}{2 \sigma}\left(y_{i}-w^{T} x_{i}\right)^{2}\right) \\ &=\arg \max _{w}-\frac{1}{2 \sigma} \sum_{i}^{n}\left(y_{i}-w^{T} x_{i}\right)^{2} \\ &=\arg \min _{w} \sum_{i}^{n}\left(y_{i}-w^{T} x_{i}\right)^{2} \\ &=\arg \min _{w} L(w) \end{aligned}$$<ul><li>此时得到的优化方程和最小二乘法得到的已经一样了，之后的求解过程也相同，</li><li>求解优化方程：</li></ul>$$\begin{aligned} \hat{w} &=\arg \max _{w} L(w) \\ &=\arg \max _{w} w^{T} X^{T} X w-2 w^{T} X^{T} Y+Y^{T} Y \\ &=\arg \max _{w} w^{T} X^{T} X w-2 w^{T} X^{T} Y \end{aligned}$$<ul><li>求导并令倒数为0：</li></ul><p>$$<br>\frac{\partial L(w)}{\partial w}=2 X^{T} X w-2 X^{T} Y=0<br>$$</p><ul><li>得到:</li></ul><p>$$<br>X^{T} X w=X^{T} Y \Rightarrow \hat{w}=\left(X^{T} X\right)^{-1} X^{T} Y<br>$$</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/86009986">https://zhuanlan.zhihu.com/p/86009986</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>regression</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>regression</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windows 调用 from shapely.geos import lgeos 时报错</title>
    <link href="/2021/05/21/python/windows-shapely-error/windows-shapely-error/"/>
    <url>/2021/05/21/python/windows-shapely-error/windows-shapely-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在Windows python中使用 <strong><code>from shapely.geos import lgeos</code></strong> 会报错，错误一般由于调用了依赖<code>**shapely**</code> 库的代码，比如我就是在调用 <code>imgaug</code>中<code>clip_out_of_image</code>函数时报错，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">poly.clip_out_of_image(image_aug)<br><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;string&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;C:\Users\Admin\AppData\Roaming\Python\Python37\site-packages\imgaug\augmentables\polys.py&quot;</span>, line <span class="hljs-number">575</span>, <span class="hljs-keyword">in</span> clip_out_of_image<br>    <span class="hljs-keyword">import</span> shapely.geometry<br>  File <span class="hljs-string">&quot;C:\Users\Admin\AppData\Roaming\Python\Python37\site-packages\shapely\geometry\__init__.py&quot;</span>, line <span class="hljs-number">4</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">from</span> .base <span class="hljs-keyword">import</span> CAP_STYLE, JOIN_STYLE<br>  File <span class="hljs-string">&quot;C:\Users\Admin\AppData\Roaming\Python\Python37\site-packages\shapely\geometry\base.py&quot;</span>, line <span class="hljs-number">18</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">from</span> shapely.coords <span class="hljs-keyword">import</span> CoordinateSequence<br>  File <span class="hljs-string">&quot;C:\Users\Admin\AppData\Roaming\Python\Python37\site-packages\shapely\coords.py&quot;</span>, line <span class="hljs-number">8</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">from</span> shapely.geos <span class="hljs-keyword">import</span> lgeos<br>  File <span class="hljs-string">&quot;C:\Users\Admin\AppData\Roaming\Python\Python37\site-packages\shapely\geos.py&quot;</span>, line <span class="hljs-number">145</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    _lgeos = CDLL(os.path.join(sys.prefix, <span class="hljs-string">&#x27;Library&#x27;</span>, <span class="hljs-string">&#x27;bin&#x27;</span>, <span class="hljs-string">&#x27;geos_c.dll&#x27;</span>))<br>  File <span class="hljs-string">&quot;E:\Program_Files\Annoconda\lib\ctypes\__init__.py&quot;</span>, line <span class="hljs-number">356</span>, <span class="hljs-keyword">in</span> __init__<br>    self._handle = _dlopen(self._name, mode)<br>OSError: [WinError <span class="hljs-number">126</span>] 找不到指定的模块。<br></code></pre></td></tr></table></figure><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><blockquote><p>我们看到里面有一个关于<strong>geos_c.dll</strong>的文件，而报错的主要原因就出现在<strong>geos_c.dll</strong>这里，看了网上很多文章大部分说是geos_c.dll文件缺失的原因。</p></blockquote><ul><li>卸载原来安装的<strong>shapely</strong>包</li><li>在 <a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#shapely">https://www.lfd.uci.edu/~gohlke/pythonlibs/#shapely</a> 下载对应版本的 whl 文件并安装</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.it610.com/article/1281933879980081152.htm">https://www.it610.com/article/1281933879980081152.htm</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>线性回归 - 最小二乘法</title>
    <link href="/2021/05/20/math/regression/linear-regression/linear-regression/"/>
    <url>/2021/05/20/math/regression/linear-regression/linear-regression/</url>
    
    <content type="html"><![CDATA[<blockquote><p>故名思意，线性回归是一种<strong>线性模型</strong>，线性模型形式简单、易于建模。许多功能更为强大的<strong>非线性模型</strong>可在线性模型的基础上通过引入层级结构或者高维映射而得。本文记录最基本的线性回归方法。</p></blockquote><span id="more"></span><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><blockquote><p>考虑一个线性模型 ${y}=f({\bf{x}})$</p><p>其中$y$是模型的输出值，是标量，$\bf{x}$为$d$维实数空间的向量</p></blockquote><ul><li>线性模型可以表示为:</li></ul><p>$$<br>f(\bf{x})=\bf{w} ^Tx,w\in \mathbb{R}<br>$$</p><ul><li>线性回归的任务是利用$n$个训练样本：</li></ul>$$X=\left[\begin{array}{lll}\bf{x}_{1} & \cdots & \bf{x}_{n}\end{array}\right]^{T}=\left[\begin{array}{c}\bf{x}_{1}^{T} \\ \vdots \\ \bf{x}_{n}^{T}\end{array}\right] \quad \bf{x} \in \mathbb{R}$$<ul><li>和样本对应的标签：</li></ul><p>$$<br>Y = [ y _ { 1 } \cdots \quad y _ { n } ] ^ { T } \quad y \in \mathbb{R}<br>$$</p><ul><li>来预测线性模型中的参数 $\bf{\omega}$，使得模型尽可能准确输出预测值</li></ul><h3 id="线性回归-最小二乘法"><a href="#线性回归-最小二乘法" class="headerlink" title="线性回归 / 最小二乘法"></a>线性回归 / 最小二乘法</h3><ul><li>定义损失函数：</li></ul><p>$$<br>L(w)=\sum_{i=1}^{n}\left(w^{T} x_{i}-y_{i}\right)^{2}<br>$$</p><ul><li>推导损失函数：</li></ul>$$\begin{aligned} L(w) &=\sum_{i=1}^{n}\left(w^{T} x_{i}-y_{i}\right)^{2} \\ &=\left(w^{T} x_{1}-y_{1}\right)^{2}+\left(w^{T} x_{2}-y_{2}\right)^{2}+\ldots+\left(w^{T} x_{n}-y_{n}\right)^{2} \\ &=[w^{T} x_{1}-y_{1} , \cdots ,w^{T} x_{n}-y_{n}]\left[\begin{array} & w^{T} x_{1}-y_{1} \\ \vdots \\ w^{T} x_{n}-y_{n}\end{array}\right] \\ &=\left(w^{T}\left[\begin{array}{lll}x_{1} & \cdots & x_{n}\end{array}\right]-Y^{T}\right)\left(\left[\begin{array}{c}x_{1}^{T} \\ \vdots \\ x_{n}^{T}\end{array}\right] w-Y\right) \\ &=\left(w^{T} X^{T}-Y^{T}\right)(X w-Y) \\ &=w^{T} X^{T} X w-w^{T} X^{T} Y-Y^{T} X w+Y^{T} Y \\ &=w^{T} X^{T} X w-2 w^{T} X^{T} Y+Y^{T} Y \\\end{aligned}$$<ul><li>优化方程：</li></ul>$$\begin{aligned} \hat{w} &=\arg \max _{w} L(w) \\ &=\arg \max _{w} w^{T} X^{T} X w-2 w^{T} X^{T} Y+Y^{T} Y \\ &=\arg \max _{w} w^{T} X^{T} X w-2 w^{T} X^{T} Y \end{aligned}$$<ul><li>求导并令倒数为0：</li></ul><p>$$<br>\frac{\partial L(w)}{\partial w}=2 X^{T} X w-2 X^{T} Y=0<br>$$</p><ul><li>得到:</li></ul><p>$$<br>X^{T} X w=X^{T} Y \Rightarrow \hat{w}=\left(X^{T} X\right)^{-1} X^{T} Y<br>$$</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/86009986">https://zhuanlan.zhihu.com/p/86009986</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>regression</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>regression</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windows 10 使用localhost作为地址执行网络请求延迟问题的解决方案</title>
    <link href="/2021/05/20/windows/localhost-post-slow/localhost-post-slow/"/>
    <url>/2021/05/20/windows/localhost-post-slow/localhost-post-slow/</url>
    
    <content type="html"><![CDATA[<blockquote><p>使用localhost作为地址执行网络请求时会有2s的延时，这个问题在Linux并不存在，本文分析并提出解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>主要体现在windows 下，python 使用 flask 将 localhost 作为地址时有2s延迟</p></blockquote><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><blockquote><p>问题在于解析localhost时，优先按照ipv6地址解析，这个可以通过ping命令验证：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">C:\Users\Admin&gt;ping localhost<br><br>正在 Ping VVD [::1] 具有 32 字节的数据:<br>来自 ::1 的回复: 时间&lt;1ms<br>来自 ::1 的回复: 时间&lt;1ms<br></code></pre></td></tr></table></figure><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><blockquote><p>关闭ipv6的方案尝试过几次，都没有效果</p><p>修改host文件添加 <code>127.0.0.1 localhost</code> 也没有用</p></blockquote><blockquote><p>问题症结在于ipv6和ipv4的优先级，如果ipv4的更高，则会优先使用ipv4地址</p></blockquote><h4 id="查看优先级"><a href="#查看优先级" class="headerlink" title="查看优先级"></a>查看优先级</h4><p>命令：<code>netsh interface ipv6 show prefixpolicies</code></p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">C:\WINDOWS\system32&gt;netsh interface ipv6 show prefixpolicies<br>查询活动状态<span class="hljs-string">...</span><br><br>优先顺序    标签   前缀<br><span class="hljs-params">----------</span>  <span class="hljs-params">-----</span>  <span class="hljs-params">--------------------------------</span><br>        50      0  :<span class="hljs-function">:1</span>/128<br>        40      1  ::<span class="hljs-string">/0</span><br>        35      4  :<span class="hljs-function">:ffff</span><span class="hljs-function">:0</span><span class="hljs-function">:0</span>/96<br>        30      2  2002::<span class="hljs-string">/16</span><br>         5      5  2001::<span class="hljs-string">/32</span><br>         3     13  fc00::<span class="hljs-string">/7</span><br>         1     11  fec0::<span class="hljs-string">/10</span><br>         1     12  3ffe::<span class="hljs-string">/16</span><br>         1      3  ::<span class="hljs-string">/96</span><br></code></pre></td></tr></table></figure><ul><li>其中<code>::1/128</code>和<code>::/0</code>是ipv6的地址，<code>::/96</code>是ipv4</li><li>我们需要将ipv4地址前移到最高优先级</li></ul><h4 id="修改优先级"><a href="#修改优先级" class="headerlink" title="修改优先级"></a>修改优先级</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">netsh</span> int ipv<span class="hljs-number">6</span> set prefix ::/<span class="hljs-number">96</span> <span class="hljs-number">50</span> <span class="hljs-number">0</span><br><span class="hljs-attribute">netsh</span> int ipv<span class="hljs-number">6</span> set prefix ::ffff:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>/<span class="hljs-number">96</span> <span class="hljs-number">40</span> <span class="hljs-number">1</span><br><span class="hljs-attribute">netsh</span> int ipv<span class="hljs-number">6</span> set prefix ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> <span class="hljs-number">10</span> <span class="hljs-number">4</span><br><span class="hljs-attribute">netsh</span> int ipv<span class="hljs-number">6</span> set prefix ::/<span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><ul><li>此时优先级关系位：</li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">C:\Users\Admin&gt;netsh interface ipv6 show prefixpolicies<br>查询活动状态<span class="hljs-string">...</span><br><br>优先顺序    标签   前缀<br><span class="hljs-params">----------</span>  <span class="hljs-params">-----</span>  <span class="hljs-params">--------------------------------</span><br>        50      0  ::<span class="hljs-string">/96</span><br>        40      1  :<span class="hljs-function">:ffff</span><span class="hljs-function">:0</span><span class="hljs-function">:0</span>/96<br>        30      2  2002::<span class="hljs-string">/16</span><br>        10      4  :<span class="hljs-function">:1</span>/128<br>         5      5  2001::<span class="hljs-string">/32</span><br>         5      5  ::<span class="hljs-string">/0</span><br>         3     13  fc00::<span class="hljs-string">/7</span><br>         1     12  3ffe::<span class="hljs-string">/16</span><br>         1     11  fec0::<span class="hljs-string">/10</span><br></code></pre></td></tr></table></figure><blockquote><p>问题解决</p></blockquote><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">C:\Users\Admin&gt;ping localhost<br><br>正在<span class="hljs-built_in"> Ping </span>VVD [127.0.0.1] 具有 32 字节的数据:<br>来自 127.0.0.1 的回复: 字节=32 时间&lt;1ms <span class="hljs-attribute">TTL</span>=64<br>来自 127.0.0.1 的回复: 字节=32 时间&lt;1ms <span class="hljs-attribute">TTL</span>=64<br></code></pre></td></tr></table></figure><blockquote><p>而且使用localhost做地址执行各种任务都快了很多</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://cache.baiducontent.com/c?m=7nuW37g3ClnQQ4TESYoMV19XOKkNHhXUETAL5Gd1cAHho68Clboy-NpJhHQwM7-KzLJm3K6xlH7bkQPB168FqRbbiTQ_BBXAt5gnV_T5WcCviPr-g7bk_9TCft1XFmmNZAt-uKNslVspTU6xdNnnmMpFzmUBhgaU3jY5_kernRW&amp;p=90759a45d4995be006be9b7c547a&amp;newp=8c769a47cd9d50fe08e2947c5c4292695d0fc20e3ddcda01298ffe0cc4241a1a1a3aecbf2c261104d3c77e6700ab4a57e0f53c783d0034f1f689df08d2ecce7e34d63665&amp;s=f05fb18fe7e5de06&amp;user=baidu&amp;fm=sc&amp;query=windows+ping+localhost+::1&amp;qid=b2a232ff00233ded&amp;p1=1">http://cache.baiducontent.com/c?m=7nuW37g3ClnQQ4TESYoMV19XOKkNHhXUETAL5Gd1cAHho68Clboy-NpJhHQwM7-KzLJm3K6xlH7bkQPB168FqRbbiTQ_BBXAt5gnV_T5WcCviPr-g7bk_9TCft1XFmmNZAt-uKNslVspTU6xdNnnmMpFzmUBhgaU3jY5_kernRW&amp;p=90759a45d4995be006be9b7c547a&amp;newp=8c769a47cd9d50fe08e2947c5c4292695d0fc20e3ddcda01298ffe0cc4241a1a1a3aecbf2c261104d3c77e6700ab4a57e0f53c783d0034f1f689df08d2ecce7e34d63665&amp;s=f05fb18fe7e5de06&amp;user=baidu&amp;fm=sc&amp;query=windows+ping+localhost+%3A%3A1&amp;qid=b2a232ff00233ded&amp;p1=1</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>极大似然估计（MLE）和最大后验概率估计（MAP）</title>
    <link href="/2021/05/18/math/probability/distributions/mle-map/mle-map/"/>
    <url>/2021/05/18/math/probability/distributions/mle-map/mle-map/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍极大似然估计（MLE，Maximum Likelihood Estimation）和最大后验概率估计（MAP，Maximum A Posteriori Estimation）。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>MLE与MAP分别对应两种学派的参数估计方法，频率派和贝叶斯派。</p></blockquote><ul><li>频率派认为参数是未知的常量，而样本是随机变量，可以通过样本的概率分布估计参数的值。</li><li>贝叶斯派认为参数是随机变量，其符合某种潜在先验概率分布prior。根据获取的信息（likelihood/evidence）去不断调整先验分布，从而得到后验概率分布.</li></ul><blockquote><p>重要前提：训练样本的分布能代表样本的真实分布。每个样本集中的样本都是所谓独立同分布的随机变量 (iid条件)，且有充分的训练样本。</p></blockquote><h3 id="极大似然估计MLE"><a href="#极大似然估计MLE" class="headerlink" title="极大似然估计MLE"></a><strong>极大似然估计MLE</strong></h3><p>极大似然估计是建立在极大似然原理的基础上的一个统计方法，是概率论在统计学中的应用。极大似然估计提供了一种给定观察数据来评估模型参数的方法，即：“模型已定，参数未知”。通过若干次试验，观察其结果，利用试验结果得到某个参数值能够使样本出现的概率为最大，则称为极大似然估计。</p><blockquote><p>MLE认为每个事件的发生都不是偶然的，存在即合理，为了解释这些事件的出现，决定系统的参数必须使得这些事件的出现更加合理才更好。因此MLE是求使得事件发生的概率最大化的情况下的参数。</p></blockquote><ul><li>似然函数:</li></ul><p>$$<br>l(\theta)=p(D \mid \theta)=p\left(x_{1}, x_{2}, \cdots, x_{N} \mid \theta\right)=\prod_{i=1}^{N} p\left(x_{i} \mid \theta\right)<br>$$</p><ul><li>MLE</li></ul>$$\hat{\theta}=\arg \max _{\theta} l(\theta)=\arg \max _{\theta} \prod_{i=1}^{N} p\left(x_{i} \mid \theta\right)$$<blockquote><p>为了便于计算, 我们对似然函数两边取对数，生成新的对数似然函数 (因为对数函数是单调增函数, 因此求似然函数最大化就可以转换成对数似然函数最大化) :</p></blockquote><p>$$<br>p(X \mid \theta)=\prod_{x_1}^{x_n} p(x_i \mid \theta)=\sum_{x_1}^{x_n} \log _{t}(x_i \mid \theta)<br>$$</p>$$\hat{\theta}=\arg \max _{\theta} \sum_{x_1}^{x_n} \log _{t}(x_i \mid \theta)$$<p>如果 $ \hat{\theta} $是参数空间中能使似然函数 $ l(\theta) $ 最大的 $ \theta$值, 则 $ \hat{\theta}$减该是“最可能”的参数值, 那么 $ \hat{\theta}$ 就是 $ \theta$的极大似然估计量。它是样本集的函数。</p><blockquote><p>可以看出，MLE的参数估计值仅取决于样本，在数据量大的情况下还算靠谱，但是数据量小或者数据不靠谱的时候，结果也不靠谱。</p></blockquote><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><ul><li>设样本服从正态分布 $ N\left(\mu, \sigma^{2}\right) $</li><li>则似然函数为:</li></ul><p>$$<br>L\left(\mu, \sigma^{2}\right)=\prod_{i=1}^{N} \frac{1}{\sqrt{2 \pi} \sigma} e^{-\frac{\left(x_{i}-\mu\right)^{2}}{2 \sigma^{2}}}=\left(2 \pi \sigma^{2}\right)^{-\frac{n}{2}} e^{\frac{1}{2 \sigma^{2}} \sum^{n}\left(x_{i}-\mu\right)^{2}}<br>$$</p><ul><li>它的对数:</li></ul><p>$$<br>\ln L\left(\mu, \sigma^{2}\right)=-\frac{n}{2} \ln (2 \pi)-\frac{n}{2} \ln \left(\sigma^{2}\right)-\frac{1}{2 \sigma^{2}} \sum_{i=1}^{n}\left(x_{i}-\mu\right)^{2}<br>$$</p><ul><li>求导, 得方程组:</li></ul>$$\left\{\begin{array}{l}\frac{\partial \ln L\left(\mu, \sigma^{2}\right)}{\partial \mu}=\frac{1}{\sigma^{2}} \sum_{i=1}^{n}\left(x_{i}-\mu\right) \\\frac{\partial \ln L\left(\mu, \sigma^{2}\right)}{\partial \sigma^{2}}=-\frac{n}{2 \sigma^{2}}+\frac{1}{2 \sigma^{4}} \sum_{i=1}^{n}\left(x_{i}-\mu\right)^{2}=0\end{array}\right.$$<ul><li>联合解得:</li></ul>$$\left\{\begin{array}{l}\mu^{*}=\bar{x}=\frac{1}{n} \sum_{i=1}^{n} x_{i} \\\sigma^{* 2}=\frac{1}{n} \sum_{i=1}^{n}\left(x_{i}-\bar{x}\right)^{2}\end{array}\right.$$<ul><li>似然方程有唯一解 $\left(\mu^{ * }, \sigma^{ * 2}\right)$ , 而且它一定是最大值点, 这是因为当 $ |\mu| \rightarrow \infty $ 或 $ \sigma^{2} \rightarrow \infty $ 或 $ 0_{\text {时, }} $ 非负函数</li><li>$ L\left(\mu, \sigma^{2}\right) \rightarrow 0 $.于是U和 $ \sigma^{2} $ 的极大似然估计为 $ \left(\mu^{ * }, \sigma^{ *  2}\right) $.</li></ul><h3 id="最大后验概率估计MAP"><a href="#最大后验概率估计MAP" class="headerlink" title="最大后验概率估计MAP"></a><strong>最大后验概率估计MAP</strong></h3><blockquote><p>MAP的思想类似，但是加入了参数的先验分布的假设。估计的过程就是根据样本的信息对参数的先验概率分布进行调整的过程，进而得到参数相对于样本的后验概率分布。为了满足事件发生即合理，即参数的后验概率应尽可能大，从而保证这些事件出现的情况更加合理，因此通过最大化后验概率来确定最终的参数的概率分布。</p></blockquote><p>$$<br>\operatorname{argmaxp}(\theta \mid X)=\operatorname{argmax} \frac{p(X \mid \theta) p(\theta)}{p(X)}=\operatorname{argmaxp}(X \mid \theta) p(\theta)=\operatorname{argmax}\left(\prod_{x_1}^{x_n} p(x_i \mid \theta)\right) p(\theta)<br>$$</p><ul><li>为了便于计算，对两边取对数，后验概率最大化就变成了：</li></ul><p>$$<br>\operatorname{argmax}\left(\sum_{x_1}^{x_n} \operatorname{logp}(x_i \mid \theta)+\log p(\theta)\right)<br>$$</p><h3 id="二者的关系"><a href="#二者的关系" class="headerlink" title="二者的关系"></a>二者的关系</h3><p>相同点：MLE和MAP均是通过直接求数值解的方式估计参数。</p><p>不同点：MAP加入先验假设$p(\theta)$，相当于在MLE的基础上增加一个先验项，即$logp(\theta)$。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/weixin_39976413/article/details/110842039">https://blog.csdn.net/weixin_39976413/article/details/110842039</a></li><li> <a href="https://blog.csdn.net/qq_39355550/article/details/81809467">https://blog.csdn.net/qq_39355550/article/details/81809467</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows10 &#39;telnet&#39; 不是内部或外部命令，也不是可运行的程序或批处理文件</title>
    <link href="/2021/05/17/windows/telnet-launch/telnet-launch/"/>
    <url>/2021/05/17/windows/telnet-launch/telnet-launch/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录 <code>&#39;telnet&#39; 不是内部或外部命令，也不是可运行的程序或批处理文件</code> 错误的解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs node-repl"><span class="hljs-meta">&gt;</span> <span class="javascript">telnet <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.8</span> <span class="hljs-number">9090</span></span><br>&#x27;telnet&#x27; 不是内部或外部命令，也不是可运行的程序<br>或批处理文件。<br></code></pre></td></tr></table></figure><h4 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h4><blockquote><p>出现这个问题是因为我们的系统默认把telnet的功能关闭了，需要我们手动去打开</p></blockquote><h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><ul><li>进入控制面板 -&gt; 程序和功能 -&gt; 启用或关闭windows功能</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210517151412.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_45163122/article/details/104963285">https://blog.csdn.net/qq_45163122/article/details/104963285</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windwos</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windwos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python 多进程</title>
    <link href="/2021/05/13/python/multi-processing/multi-processing/"/>
    <url>/2021/05/13/python/multi-processing/multi-processing/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍Python多进程模块。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p>Python中的多进程是通过multiprocessing包来实现的，和多线程的threading.Thread差不多，它可以利用multiprocessing.Process对象来创建一个进程对象。这个进程对象的方法和线程对象的方法差不多也有start(), run(), join()等方法，其中有一个方法不同Thread线程对象中的守护线程方法是setDeamon，而Process进程对象的守护进程是通过设置deamon属性来完成的。</p></blockquote><h3 id="Python多进程实现"><a href="#Python多进程实现" class="headerlink" title="Python多进程实现"></a>Python多进程实现</h3><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span>  Process<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun1</span>(<span class="hljs-params">name</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;测试%s多进程&#x27;</span> %name)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    process_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):  <span class="hljs-comment">#开启5个子进程执行fun1函数</span><br>        p = Process(target=fun1,args=(<span class="hljs-string">&#x27;Python&#x27;</span>,)) <span class="hljs-comment">#实例化进程对象</span><br>        p.start()<br>        process_list.append(p)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> process_list:<br>        p.join()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;结束测试&#x27;</span>)<br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">测试Python多进程<br>测试Python多进程<br>测试Python多进程<br>测试Python多进程<br>测试Python多进程<br>结束测试<br><br>Process finished with exit code 0<br></code></pre></td></tr></table></figure><p>上面的代码开启了5个子进程去执行函数，我们可以观察结果，是同时打印的，这里实现了真正的并行操作，就是多个CPU同时执行任务。我们知道进程是python中最小的资源分配单元，也就是进程中间的数据，内存是不共享的，每启动一个进程，都要独立分配资源和拷贝访问的数据，所以进程的启动和销毁的代价是比较大了，所以在实际中使用多进程，要根据服务器的配置来设定。</p><h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>还记得python多线程的第二种实现方法吗?是通过类继承的方法来实现的，python多进程的第二种实现方式也是一样的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span>  Process<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyProcess</span>(<span class="hljs-params">Process</span>):</span> <span class="hljs-comment">#继承Process类</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,name</span>):</span><br>        <span class="hljs-built_in">super</span>(MyProcess,self).__init__()<br>        self.name = name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;测试%s多进程&#x27;</span> % self.name)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    process_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):  <span class="hljs-comment">#开启5个子进程执行fun1函数</span><br>        p = MyProcess(<span class="hljs-string">&#x27;Python&#x27;</span>) <span class="hljs-comment">#实例化进程对象</span><br>        p.start()<br>        process_list.append(p)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> process_list:<br>        p.join()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;结束测试&#x27;</span>)<br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs text">测试Python多进程<br>测试Python多进程<br>测试Python多进程<br>测试Python多进程<br>测试Python多进程<br>结束测试<br><br>Process finished with exit code 0<br></code></pre></td></tr></table></figure><p>效果和第一种方式一样。</p><p>我们可以看到Python多进程的实现方式和多线程的实现方式几乎一样。</p><h3 id="Process类的其他方法"><a href="#Process类的其他方法" class="headerlink" title="Process类的其他方法"></a><strong>Process类的其他方法</strong></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs text">构造方法：<br><br>Process([group [, target [, name [, args [, kwargs]]]]])<br>　　group: 线程组 <br>　　target: 要执行的方法<br>　　name: 进程名<br>　　args/kwargs: 要传入方法的参数<br><br>实例方法：<br>　　is_alive()：返回进程是否在运行,bool类型。<br>　　join([timeout])：阻塞当前上下文环境的进程程，直到调用此方法的进程终止或到达指定的timeout（可选参数）。<br>　　start()：进程准备就绪，等待CPU调度<br>　　run()：strat()调用run方法，如果实例进程时未制定传入target，这star执行t默认run()方法。<br>　　terminate()：不管任务是否完成，立即停止工作进程<br><br>属性：<br>　　daemon：和线程的setDeamon功能一样<br>　　name：进程名字<br>　　pid：进程号<br></code></pre></td></tr></table></figure><p>关于join，daemon的使用和python多线程一样，这里就不在复述了，大家可以看看以前的python多线程系列文章。</p><h3 id="Python多线程的通信"><a href="#Python多线程的通信" class="headerlink" title="Python多线程的通信"></a>Python多线程的通信</h3><blockquote><p>进程是系统独立调度核分配系统资源（CPU、内存）的基本单位，进程之间是相互独立的，每启动一个新的进程相当于把数据进行了一次克隆，子进程里的数据修改无法影响到主进程中的数据，不同子进程之间的数据也不能共享，这是多进程在使用中与多线程最明显的区别。但是难道Python多进程中间难道就是孤立的吗？当然不是，python也提供了多种方法实现了多进程中间的通信和数据共享（可以修改一份数据）</p></blockquote><h4 id="进程队列Queue"><a href="#进程队列Queue" class="headerlink" title="进程队列Queue"></a><strong>进程队列Queue</strong></h4><p>Queue在多线程中也说到过，在生成者消费者模式中使用，是线程安全的，是生产者和消费者中间的数据管道，那在python多进程中，它其实就是进程之间的数据管道，实现进程通信。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process,Queue<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun1</span>(<span class="hljs-params">q,i</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;子进程%s 开始put数据&#x27;</span> %i)<br>    q.put(<span class="hljs-string">&#x27;我是%s 通过Queue通信&#x27;</span> %i)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    q = Queue()<br><br>    process_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>        p = Process(target=fun1,args=(q,i,))  <span class="hljs-comment">#注意args里面要把q对象传给我们要执行的方法，这样子进程才能和主进程用Queue来通信</span><br>        p.start()<br>        process_list.append(p)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> process_list:<br>        p.join()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;主进程获取Queue数据&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(q.get())<br>    <span class="hljs-built_in">print</span>(q.get())<br>    <span class="hljs-built_in">print</span>(q.get())<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;结束测试&#x27;</span>)<br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">子进程<span class="hljs-number">0</span> 开始put数据<br>子进程<span class="hljs-number">1</span> 开始put数据<br>子进程<span class="hljs-number">2</span> 开始put数据<br>主进程获取Queue数据<br>我是<span class="hljs-number">0</span> 通过Queue通信<br>我是<span class="hljs-number">1</span> 通过Queue通信<br>我是<span class="hljs-number">2</span> 通过Queue通信<br>结束测试<br><br>Process finished <span class="hljs-keyword">with</span> exit code <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>上面的代码结果可以看到我们主进程中可以通过Queue获取子进程中put的数据，实现进程间的通信。</p><h4 id="管道Pipe"><a href="#管道Pipe" class="headerlink" title="管道Pipe"></a><strong>管道Pipe</strong></h4><p>管道Pipe和Queue的作用大致差不多，也是实现进程间的通信，下面之间看怎么使用吧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Pipe<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun1</span>(<span class="hljs-params">conn</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;子进程发送消息：&#x27;</span>)<br>    conn.send(<span class="hljs-string">&#x27;你好主进程&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;子进程接受消息：&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(conn.recv())<br>    conn.close()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    conn1, conn2 = Pipe() <span class="hljs-comment">#关键点，pipe实例化生成一个双向管</span><br>    p = Process(target=fun1, args=(conn2,)) <span class="hljs-comment">#conn2传给子进程</span><br>    p.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;主进程接受消息：&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(conn1.recv())<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;主进程发送消息：&#x27;</span>)<br>    conn1.send(<span class="hljs-string">&quot;你好子进程&quot;</span>)<br>    p.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;结束测试&#x27;</span>)<br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs text">主进程接受消息：<br>子进程发送消息：<br>子进程接受消息：<br>你好主进程<br>主进程发送消息：<br>你好子进程<br>结束测试<br><br>Process finished with exit code 0<br></code></pre></td></tr></table></figure><p>上面可以看到主进程和子进程可以相互发送消息</p><h4 id="Managers"><a href="#Managers" class="headerlink" title="Managers"></a><strong>Managers</strong></h4><p>Queue和Pipe只是实现了数据交互，并没实现数据共享，即一个进程去更改另一个进程的数据。那么久要用到Managers</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Manager<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun1</span>(<span class="hljs-params">dic,lis,index</span>):</span><br><br>    dic[index] = <span class="hljs-string">&#x27;a&#x27;</span><br>    dic[<span class="hljs-string">&#x27;2&#x27;</span>] = <span class="hljs-string">&#x27;b&#x27;</span>    <br>    lis.append(index)    <span class="hljs-comment">#[0,1,2,3,4,0,1,2,3,4,5,6,7,8,9]</span><br>    <span class="hljs-comment">#print(l)</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">with</span> Manager() <span class="hljs-keyword">as</span> manager:<br>        dic = manager.<span class="hljs-built_in">dict</span>()<span class="hljs-comment">#注意字典的声明方式，不能直接通过&#123;&#125;来定义</span><br>        l = manager.<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>))<span class="hljs-comment">#[0,1,2,3,4]</span><br><br>        process_list = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>            p = Process(target=fun1, args=(dic,l,i))<br>            p.start()<br>            process_list.append(p)<br><br>        <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> process_list:<br>            res.join()<br>        <span class="hljs-built_in">print</span>(dic)<br>        <span class="hljs-built_in">print</span>(l)<br></code></pre></td></tr></table></figure><p>结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs text">&#123;0: &#x27;a&#x27;, &#x27;2&#x27;: &#x27;b&#x27;, 3: &#x27;a&#x27;, 1: &#x27;a&#x27;, 2: &#x27;a&#x27;, 4: &#x27;a&#x27;, 5: &#x27;a&#x27;, 7: &#x27;a&#x27;, 6: &#x27;a&#x27;, 8: &#x27;a&#x27;, 9: &#x27;a&#x27;&#125;<br>[0, 1, 2, 3, 4, 0, 3, 1, 2, 4, 5, 7, 6, 8, 9]<br></code></pre></td></tr></table></figure><p>可以看到主进程定义了一个字典和一个列表，在子进程中，可以添加和修改字典的内容，在列表中插入新的数据，实现进程间的数据共享，即可以共同修改同一份数据</p><h4 id="进程锁"><a href="#进程锁" class="headerlink" title="进程锁"></a>进程锁</h4><p>在多进程程序运行时，可能会有部分内存或硬盘可以同时被多个进程操作，如果不小心管理很可能导致冲突。此时可以用进程锁有效解决问题。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Manager<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun1</span>(<span class="hljs-params">dic,lis,index, lock</span>):</span><br>    lock.acquire()<br>    dic[index] = <span class="hljs-string">&#x27;a&#x27;</span><br>    dic[<span class="hljs-string">&#x27;2&#x27;</span>] = <span class="hljs-string">&#x27;b&#x27;</span>    <br>    lis.append(index)    <span class="hljs-comment">#[0,1,2,3,4,0,1,2,3,4,5,6,7,8,9]</span><br>    lock.release()<br>    <span class="hljs-comment">#print(l)</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">with</span> Manager() <span class="hljs-keyword">as</span> manager:<br>        dic = manager.<span class="hljs-built_in">dict</span>()<span class="hljs-comment">#注意字典的声明方式，不能直接通过&#123;&#125;来定义</span><br>        l = manager.<span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>))<span class="hljs-comment">#[0,1,2,3,4]</span><br>        lock = manager.Lock()<br><br>        process_list = []<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>            p = Process(target=fun1, args=(dic,l,i,lock))<br>            p.start()<br>            process_list.append(p)<br><br>        <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> process_list:<br>            res.join()<br>        <span class="hljs-built_in">print</span>(dic)<br>        <span class="hljs-built_in">print</span>(l)<br></code></pre></td></tr></table></figure><h3 id="进程池"><a href="#进程池" class="headerlink" title="进程池"></a>进程池</h3><blockquote><p>进程池内部维护一个进程序列，当使用时，则去进程池中获取一个进程，如果进程池序列中没有可供使用的进进程，那么程序就会等待，直到进程池中有可用进程为止。就是固定有几个进程可以使用。</p></blockquote><h4 id="常规进程池"><a href="#常规进程池" class="headerlink" title="常规进程池"></a>常规进程池</h4><p>进程池中有两个方法：</p><p>apply：同步，一般不使用</p><p>apply_async：异步</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span>  multiprocessing <span class="hljs-keyword">import</span> Process,Pool<br><span class="hljs-keyword">import</span> os, time, random<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fun1</span>(<span class="hljs-params">name</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Run task %s (%s)...&#x27;</span> % (name, os.getpid()))<br>    start = time.time()<br>    time.sleep(random.random() * <span class="hljs-number">3</span>)<br>    end = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Task %s runs %0.2f seconds.&#x27;</span> % (name, (end - start)))<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pool = Pool(<span class="hljs-number">5</span>) <span class="hljs-comment">#创建一个5个进程的进程池</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        pool.apply_async(func=fun1, args=(i,))<br><br>    pool.close()<br>    pool.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;结束测试&#x27;</span>)<br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs text">Run task 0 (37476)...<br>Run task 1 (4044)...<br>Task 0 runs 0.03 seconds.<br>Run task 2 (37476)...<br>Run task 3 (17252)...<br>Run task 4 (16448)...<br>Run task 5 (24804)...<br>Task 2 runs 0.27 seconds.<br>Run task 6 (37476)...<br>Task 1 runs 0.58 seconds.<br>Run task 7 (4044)...<br>Task 3 runs 0.98 seconds.<br>Run task 8 (17252)...<br>Task 5 runs 1.13 seconds.<br>Run task 9 (24804)...<br>Task 6 runs 1.46 seconds.<br>Task 4 runs 2.73 seconds.<br>Task 8 runs 2.18 seconds.<br>Task 7 runs 2.93 seconds.<br>Task 9 runs 2.93 seconds.<br>结束测试<br></code></pre></td></tr></table></figure><p>对<code>Pool</code>对象调用<code>join()</code>方法会等待所有子进程执行完毕，调用<code>join()</code>之前必须先调用<code>close()</code>，调用<code>close()</code>之后就不能继续添加新的<code>Process</code>了。</p><h4 id="进程池map方法"><a href="#进程池map方法" class="headerlink" title="进程池map方法"></a><strong>进程池map方法</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os <br><span class="hljs-keyword">import</span> PIL <br><br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool <br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br>SIZE = (<span class="hljs-number">75</span>,<span class="hljs-number">75</span>)<br>SAVE_DIRECTORY = \<span class="hljs-string">&#x27;thumbs\&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">def get_image_paths(folder):</span><br><span class="hljs-string">    return (os.path.join(folder, f) </span><br><span class="hljs-string">            for f in os.listdir(folder) </span><br><span class="hljs-string">            if \&#x27;jpeg\&#x27; in f)</span><br><span class="hljs-string"></span><br><span class="hljs-string">def create_thumbnail(filename): </span><br><span class="hljs-string">    im = Image.open(filename)</span><br><span class="hljs-string">    im.thumbnail(SIZE, Image.ANTIALIAS)</span><br><span class="hljs-string">    base, fname = os.path.split(filename) </span><br><span class="hljs-string">    save_path = os.path.join(base, SAVE_DIRECTORY, fname)</span><br><span class="hljs-string">    im.save(save_path)</span><br><span class="hljs-string"></span><br><span class="hljs-string">if __name__ == \&#x27;__main__\&#x27;:</span><br><span class="hljs-string">    folder = os.path.abspath(</span><br><span class="hljs-string">        \&#x27;11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840\&#x27;)</span><br><span class="hljs-string">    os.mkdir(os.path.join(folder, SAVE_DIRECTORY))</span><br><span class="hljs-string"></span><br><span class="hljs-string">    images = get_image_paths(folder)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    pool = Pool()</span><br><span class="hljs-string">    pool.map(creat_thumbnail, images) #关键点，images是一个可迭代对象</span><br><span class="hljs-string">    pool.close()</span><br><span class="hljs-string">    pool.join()</span><br></code></pre></td></tr></table></figure><p>上边这段代码的主要工作就是将遍历传入的文件夹中的图片文件，一一生成缩略图，并将这些缩略图保存到特定文件夹中。 map 函数并不支持手动线程管理，反而使得相关的 debug 工作也变得异常简单。</p><h3 id="多进程启动方式"><a href="#多进程启动方式" class="headerlink" title="多进程启动方式"></a>多进程启动方式</h3><blockquote><p>multiprocessing 支持三种方式 启动进程</p></blockquote><ul><li>在python中可以显示设置启动方式</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> multiprocessing <span class="hljs-keyword">as</span> mp <br>mp = mp.get_context(<span class="hljs-string">&#x27;spawn&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h4><p>父进程启动一个新的python解释器进程.子进程只继承运行 Run()方法所需的资源。<br>来自父进程的不必要的文件描述符和句柄将不会被继承,运行速度比较慢</p><blockquote><p>适用系统：unix and windows</p></blockquote><h4 id="fork"><a href="#fork" class="headerlink" title="fork"></a>fork</h4><p>父进程使用os.fork()方法对Python解释器进行fork。子进程开始时实际上与父进程相同。<br>父进程的所有资源都由子进程继承。请注意，安全的fork多线程的进程是有问题的。</p><blockquote><p>适用系统：unix</p></blockquote><h4 id="forkserver"><a href="#forkserver" class="headerlink" title="forkserver"></a>forkserver</h4><p>当程序启动并选择forkserver的启动方法时，将启动服务器进程。<br>从那时起，每当需要一个新进程时，父进程就会连接到服务器，并请求它fork一个新进程。<br>fork server进程是单线程的，所以使用os.fork()是安全的。没有任何不必要的资源被继承</p><blockquote><p>适用系统：unix</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://zhuanlan.zhihu.com/p/64702600">https://zhuanlan.zhihu.com/p/64702600</a></li><li><a href="https://blog.csdn.net/zy13270867781/article/details/82499108">https://blog.csdn.net/zy13270867781/article/details/82499108</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorch - model.train(), model.eval() 以及 torch.no_grad() 简介</title>
    <link href="/2021/05/13/deep_learning/pytorch/train-eval-nograd/train-eval-nograd/"/>
    <url>/2021/05/13/deep_learning/pytorch/train-eval-nograd/train-eval-nograd/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录pytorch框架中模型的几种状态，主要分为训练和测试两种情况来说。</p></blockquote><span id="more"></span><h3 id="model-train"><a href="#model-train" class="headerlink" title="model.train()"></a>model.train()</h3><blockquote><p>启用 Batch Normalization 和 Dropout。</p></blockquote><ul><li> 如果模型中有BN层(Batch Normalization）和Dropout，需要在训练时添加model.train()。model.train()是保证BN层能够用到每一批数据的均值和方差。对于Dropout，model.train()是随机取一部分网络连接来训练更新参数。</li></ul><h3 id="model-eval"><a href="#model-eval" class="headerlink" title="model.eval()"></a>model.eval()</h3><blockquote><p>不启用 Batch Normalization 和 Dropout。</p></blockquote><ul><li><p> 如果模型中有BN层(Batch Normalization）和Dropout，在测试时添加model.eval()。model.eval()是保证BN层能够用全部训练数据的均值和方差，即测试过程中要保证BN层的均值和方差不变。对于Dropout，model.eval()是利用到了所有网络连接，即不进行随机舍弃神经元。</p></li><li><p>训练完train样本后，生成的模型model要用来测试样本。在model(test)之前，需要加上model.eval()，否则的话，有输入数据，即使不训练，它也会改变权值。这是model中含有BN层和Dropout所带来的的性质。</p></li></ul><h3 id="torch-no-grad"><a href="#torch-no-grad" class="headerlink" title="torch.no_grad()"></a>torch.no_grad()</h3><blockquote><p>model.eval()切换到测试模式，在该模式下：</p><p>主要用于通知dropout层和BN层在train和validation/test模式间切换：<br>在train模式下，dropout网络层会按照设定的参数p设置保留激活单元的概率（保留概率=p); BN层会继续计算数据的mean和var等参数并更新。<br>在eval模式下，dropout层会让所有的激活单元都通过，而BN层会停止计算和更新mean和var，直接使用在训练阶段已经学出的mean和var值。</p></blockquote><ul><li>torch.no_grad() 用于测试 / 推断时使用</li></ul><blockquote><p>而with torch.no_grad()则主要是用于停止autograd模块的工作，以起到加速和节省显存的作用。它的作用是将该with语句包裹起来的部分停止梯度的更新，从而节省了GPU算力和显存，但是并不会影响dropout和BN层的行为。</p><p>该模式不会影响各层的gradient计算行为，即gradient计算和存储与training模式一样，只是不进行反向传播（back probagation)。</p></blockquote><ul><li>如果不在意显存大小和计算时间的话，仅仅使用model.eval()已足够得到正确的validation/test的结果；而with torch.no_grad()则是更进一步加速和节省gpu空间（因为不用计算和存储梯度），从而可以更快计算，也可以跑更大的batch来测试。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_38410428/article/details/101102075">https://blog.csdn.net/qq_38410428/article/details/101102075</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>先验概率、后验概率、似然函数概念与联系</title>
    <link href="/2021/05/04/math/probability/priori-poster-pro/priori-poster-pro/"/>
    <url>/2021/05/04/math/probability/priori-poster-pro/priori-poster-pro/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文解释了标题三个概念之间的关系，给出了后验概率的求法。</p></blockquote><span id="more"></span><h3 id="贝叶斯公式"><a href="#贝叶斯公式" class="headerlink" title="贝叶斯公式"></a>贝叶斯公式</h3><p>我们熟知的贝叶斯公式是这样的:<br>$$<br>P(A \mid B)=\frac{P(B \mid A) * P(A)}{P(B)}<br>$$<br>但在这里我们采用如下形式:</p><p>$$<br>p(\theta \mid x)=\frac{p(x \mid \theta) p(\theta)}{p(x)}<br>$$</p><blockquote><p>贝叶斯公式是这几个概念的理论基础</p></blockquote><ul><li>$x$是样本</li><li> $\theta$ 是决定样本如何分布的参数</li></ul><blockquote><p>可以把这里的 $\theta$ 理解为原因， $x$ 理解为结果，因为$\theta$决定了$x$是什么样的。</p></blockquote><ul><li>解释如下：</li></ul><table><thead><tr><th>标识</th><th>含义</th></tr></thead><tbody><tr><td>$p(x)$</td><td>${\text {证据 evidence }}$</td></tr><tr><td>$p(\theta \mid x)$</td><td>${\text {后验概率 posterior }}$</td></tr><tr><td>$p(\theta)$</td><td>${\text {先验分布 prior }}$</td></tr><tr><td>$p(x \mid \theta)$</td><td>${\text {似然分布 }}$ likelihood</td></tr></tbody></table><ul><li>也就是说，有这样的公式表示三者之间的关系：</li></ul><p>$$<br>\text { 后验概率 }=\frac{\text { 似然估计 } * \text { 先验概率 }}{\text { 证据 }}<br>$$</p><blockquote><p>随后介绍概念，再使用一个例子加深理解</p></blockquote><h3 id="概念介绍"><a href="#概念介绍" class="headerlink" title="概念介绍"></a>概念介绍</h3><h4 id="先验概率-p-x"><a href="#先验概率-p-x" class="headerlink" title="先验概率 $p(x)$"></a>先验概率 $p(x)$</h4><ul><li>由历史求因</li></ul><p>事情还没有发生，根据以往的经验来判断事情发生的概率，反映人们在抽样前对 θ 的认识。</p><blockquote><p>扔一个硬币，在扔之前我们无法根据实验结果给出结果的概率分布；</p><p>但根据日常经验和对硬币的观察，我们可以假定正面向上的概率为0.5；</p><p>这里根据我们之前的经验得到的0.5就是先验概率。</p></blockquote><h4 id="后验概率-p-theta-mid-x"><a href="#后验概率-p-theta-mid-x" class="headerlink" title="后验概率 $p(\theta \mid x)$"></a>后验概率 $p(\theta \mid x)$</h4><ul><li>知果求因</li></ul><p>事情已经发生了，导致事情发生的原因很多，根据结果来判断各个由不同原因导致的概率。</p><p>后验分布 p(θ|X) 是反映人们在抽样后对 θ 的认识，之间的差异是由于样本的出现后人们对 θ 认识的一种调整，所以<strong>后验分布 p(θ|X) 可以看作是人们用总体信息和样本信息（抽样信息）对先验分布 p(θ) 作调整的结果</strong>。</p><h4 id="似然分布-p-x-mid-theta"><a href="#似然分布-p-x-mid-theta" class="headerlink" title="似然分布 $p(x \mid \theta)$"></a>似然分布 $p(x \mid \theta)$</h4><ul><li>由因求果</li></ul><p>已经获得了样本，导致产生这些样本的原因很多，不同原因可以导致某个固定结果的概率。</p><p>用似然分布的方法根据样本确定参数的估计路数叫做似然估计，这种估计方式没有考虑先验知识，仅使用了获得的样本信息。</p><h3 id="案例应用"><a href="#案例应用" class="headerlink" title="案例应用"></a>案例应用</h3><p><img src="https://photos.zywvvd.com/icey-mate-book/20210515172724.jpg"></p><blockquote><p>已知：</p><p>有两个外观看上去一模一样的密封箱子 A, B</p><p>A 箱中有 3 个白球和 1 个黑球</p><p>B 箱中有 2 个白球和 2 个黑球</p></blockquote><ul><li>随便摸一个球是 白(w) / 黑(b) 的概率为：</li></ul><p>$$<br>P(w) = \frac{1}{2} \times \frac{3}{4} + \frac{1}{2} \times \frac{2}{4} = \frac{5}{8}<br>$$</p><p>$$<br>P(b) = \frac{1}{2} \times \frac{1}{4} + \frac{1}{2} \times \frac{2}{4} = \frac{3}{8}<br>$$</p><blockquote><p>这可以看作是随机摸一个球的先验分布，白色黑色的概率为先验概率</p><p>在计算过程中其实运用了全概率公式，枚举了选择两个箱子的情况</p><p>这里面认定了选择箱子A和箱子B的概率是1/2，这也是一种先验概率/先验分布</p></blockquote><ul><li>随便摸一个球是白球，那么摸的这个箱子是A的概率是多大？</li></ul><blockquote><p>贝叶斯公式：</p></blockquote>$$\begin{array}{l}P(A|w) &= \frac{{P(w|A) \cdot P(A)}}{{P(w)}}\\ &= \frac{{\frac{3}{4} \cdot \frac{1}{2}}}{{\frac{5}{8}}} \\ &= \frac{3}{5}\end{array}$$<blockquote><p>这个过程就是采样过后，对先验概率进行调整，得到后验概率。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_23947237/article/details/78265026">https://blog.csdn.net/qq_23947237/article/details/78265026</a></li><li><a href="https://zhuanlan.zhihu.com/p/157677467">https://zhuanlan.zhihu.com/p/157677467</a></li><li><a href="https://www.jianshu.com/p/0aeae4d82daa">https://www.jianshu.com/p/0aeae4d82daa</a></li><li><a href="https://blog.csdn.net/qq_23947237/article/details/78265026">https://blog.csdn.net/qq_23947237/article/details/78265026</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 15 - 伽马分布</title>
    <link href="/2021/05/01/math/probability/distributions/gamma-dis/gamma-dis/"/>
    <url>/2021/05/01/math/probability/distributions/gamma-dis/gamma-dis/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录伽马分布。</p></blockquote><span id="more"></span><h3 id="整数次数的伽马分布"><a href="#整数次数的伽马分布" class="headerlink" title="整数次数的伽马分布"></a>整数次数的伽马分布</h3><blockquote><p>若事件服从泊松分布，泊松分布参数为$\lambda$，则事件第$i$ 次发生和第$i+k$ 次发生的时间间隔$t$的分布为伽玛分布。</p></blockquote><h4 id="概率密度函数"><a href="#概率密度函数" class="headerlink" title="概率密度函数"></a>概率密度函数</h4><p>$$<br>p(t ; \lambda, k)=\frac{t^{(k-1)} \lambda^{k} e^{(-\lambda t)}}{\Gamma(k)}<br>$$</p><blockquote><p> 其中$ t $ 为时间间隔。</p></blockquote><h4 id="期望"><a href="#期望" class="headerlink" title="期望"></a>期望</h4><p>$$<br>\mathbb{E}[t]=\frac{k}{\lambda}<br>$$</p><h4 id="方差"><a href="#方差" class="headerlink" title="方差"></a>方差</h4><p>$$<br> \operatorname{Var}[t]=\frac{k}{\lambda^{2}}<br>$$</p><blockquote><p>上面的定义中 $ k $ 必须是整数。</p></blockquote><h3 id="更一般的伽马分布"><a href="#更一般的伽马分布" class="headerlink" title="更一般的伽马分布"></a>更一般的伽马分布</h3><ul><li>事实上，若随机变量 $ X $ 服从伽马分布，则其概率密度函数为：</li></ul><p>$$<br>p(X ; \alpha, \beta)=\frac{\beta^{\alpha}}{\Gamma(\alpha)} X^{\alpha-1} e^{-\beta X}, \quad X&gt;0<br>$$<br>​        记做 $ \Gamma(\alpha, \beta) $ 。其中 $ \alpha $ 称作形状参数， $ \beta $ 称作尺度参数。</p><h4 id="期望-1"><a href="#期望-1" class="headerlink" title="期望"></a>期望</h4><p>$$<br> \mathbb{E}[X]=\frac{\alpha}{\beta}<br>$$</p><h4 id="方差-1"><a href="#方差-1" class="headerlink" title="方差"></a>方差</h4><p>$$<br>\operatorname{Var}[X]=\frac{\alpha}{\beta^{2}}<br>$$</p><blockquote><p>当 $ \alpha \leq 1 $ 时, $ p(X ; \alpha, \beta) $ 为递减函数。 当 $ \alpha&gt;1 $ 时, $ p(X ; \alpha, \beta) $ 为单峰函数。</p></blockquote><h3 id="整数次数伽马分布的理解"><a href="#整数次数伽马分布的理解" class="headerlink" title="整数次数伽马分布的理解"></a>整数次数伽马分布的理解</h3><ul><li>已知Gamma分布的密度函数为:<br>$$<br>f(x, \alpha, \lambda)=\frac{\lambda^{\alpha} x^{\alpha-1} e^{-\lambda x}}{\Gamma(\alpha)}, x&gt;0<br>$$</li><li> 则其在时间 $ (t,+\infty) $ 上的积分为</li></ul>$$\begin{aligned}\int_{t}^{+\infty} f(x, \alpha, \lambda) \cdot d x &=\int_{t}^{+\infty} \frac{\lambda^{\alpha} x^{\alpha-1} e^{-\lambda x}}{\Gamma(\alpha)} \cdot d x \\ &=\frac{\lambda^{\alpha}}{\Gamma(\alpha)} \int_{t}^{+\infty} x^{\alpha-1} e^{-\lambda x} \cdot d x \\& =\frac{\lambda^{\alpha}}{\Gamma(\alpha)} \int_{t}^{+\infty} x^{\alpha-1} \cdot\left(-\frac{1}\\{\lambda}\right) \cdot d e^{-\lambda x} \\ &=\frac{-\lambda^{\alpha-1}}{\Gamma(\alpha)} \int_{t}^{+\infty} x^{\alpha-1} \cdot d e^{-\lambda x} (分部积分)\\ &=\frac{-\lambda^{\alpha-1}}{\Gamma(\alpha)}\left[\left(x^{\alpha-1} \cdot e^{-\lambda x}\right)_{t}^{+\infty}-\int_{t}^{+\infty} e^{-\lambda x} \cdot d x^{\alpha-1}\right] \\&=\frac{-\lambda^{\alpha-1}}{\Gamma(\alpha)}\left[\left(x^{\alpha-1} \cdot e^{-\lambda x}\right)_{t}^{+\infty}-\int_{t}^{+\infty}(\alpha-1) x^{\alpha-2} \cdot e^{-\lambda x} \cdot d x\right] \\ &=\left[\frac{ \left.-\lambda^{\alpha-1} \cdot x^{\alpha-1} \cdot e^{-\lambda x}\right)}{\Gamma(\alpha)}\right]^{+\infty}+\int_{t}^{+\infty} \frac{\lambda^{\alpha-1}}{\Gamma(\alpha-1)} x^{\alpha-2} \cdot e^{-\lambda x} \cdot d x \\ &=\left[\frac{ \left.-\lambda^{\alpha-1} \cdot x^{\alpha-1} \cdot e^{-\lambda x}\right)}{\Gamma(\alpha)}\right]_{t}^{+\infty}+\int_{t}^{+\infty} f(x, \alpha-1, \lambda) \cdot d x  \end{aligned}$$<ul><li>即有：</li></ul>$$\int_{t}^{+\infty} f(x, \alpha, \lambda) \cdot d x=\int_{t}^{+\infty} f(x, \alpha-1, \lambda) \cdot d x+\frac{(\lambda t)^{\alpha-1} \cdot e^{-\lambda t}}{\Gamma(\alpha)} $$<ul><li>令 $ \alpha $ 为 $ n, \quad n=0,1,2, \cdots $, 有</li></ul><p>$$<br>\int_{t}^{+\infty} f(x, n, \lambda) \cdot d x=\int_{t}^{+\infty} f(x, n-1, \lambda) \cdot d x+\frac{(\lambda t)^{n-1} \cdot e^{-\lambda t}}{(n-1) !}<br>$$</p><ul><li>叠加求和, 得:</li></ul><p>$$<br>\int_{t}^{+\infty} f(x, n, \lambda) \cdot d x=\sum_{k=0}^{n-1} \frac{(\lambda t)^{k} \cdot e^{-\lambda t}}{k !}<br>$$</p><blockquote><p>Gamma分布上述积分形式即可理解为: 第 $ n $ 个事件恰好发生在时间 $ (t,+\infty) $ 的概率, 相当于 在时间 $ (0, t) $ 内发生恰好发生 $ 0,1,2, \cdots, n-1 $ 个事件的概率总和。</p></blockquote><blockquote><p>也可以反过来说，伽马分布是$n$个独立的指数分布随机变量的和。</p></blockquote><h3 id="伽马函数"><a href="#伽马函数" class="headerlink" title="伽马函数"></a>伽马函数</h3><blockquote><p>伽玛函数（Gamma Function）作为阶乘的延拓，是定义在复数范围内的亚纯函数，通常写成 $ \Gamma(x) $ 。</p><p>在$x$取值为正整数时与阶乘是统一的。</p></blockquote><ul><li>在实数域上伽玛函数定义为:</li></ul><p>$$<br>\Gamma(x)=\int_{0}^{+\infty} t^{x-1} e^{-t} \mathrm{~d} t(x&gt;0)<br>$$</p><ul><li>在复数域上伽玛函数定义为:</li></ul><p>$$<br>\Gamma(z)=\int_{0}^{+\infty} t^{z-1} e^{-t} \mathrm{~d} t<br>$$</p><blockquote><p>其中 $ \operatorname{Re}(z)&gt;0 $, 此定义可以用解析延拓原理拓展到整个复数域上，非正整数除外。</p></blockquote><ul><li>除了以上定义之外，伽马函数公式还有另外一个写法:</li></ul><p>$$<br>\Gamma(x)=2 \int_{0}^{+\infty} t^{2 x-1} e^{-t^{2}} \mathrm{~d} t<br>$$</p><blockquote><p>我们都知道 $ \int_{0}^{+\infty} e^{-t^{2}} \mathrm{~d} t=\frac{\sqrt{\pi}}{2} $ 是一个常用积分结果</p><p>上述公式可以用 $ \Gamma\left(\frac{1}{2}\right)=2 \int_{0}^{\perp \infty} e^{-t^{2}} \mathrm{~d} t=\sqrt{\pi} $ 来验证</p></blockquote><ul><li>伽马函数还可以定义为无穷乘积:</li></ul>$$\Gamma(x+1)=\lim _{n \rightarrow+\infty} \frac{n ! n^{x}}{\prod_{m=1}^{n}(x+m)}$$<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li><li><a href="https://www.zhihu.com/question/34866983">https://www.zhihu.com/question/34866983</a></li><li><a href="https://www.jianshu.com/p/6ee90ba47b4a">https://www.jianshu.com/p/6ee90ba47b4a</a></li><li><a href="https://baike.baidu.com/item/%E4%BC%BD%E7%8E%9B%E5%87%BD%E6%95%B0/3540177?fromtitle=%E4%BC%BD%E9%A9%AC%E5%87%BD%E6%95%B0&amp;fromid=11217190&amp;fr=aladdin">https://baike.baidu.com/item/%E4%BC%BD%E7%8E%9B%E5%87%BD%E6%95%B0/3540177?fromtitle=%E4%BC%BD%E9%A9%AC%E5%87%BD%E6%95%B0&amp;fromid=11217190&amp;fr=aladdin</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 14 - 指数分布</title>
    <link href="/2021/05/01/math/probability/distributions/index-dis/index-dis/"/>
    <url>/2021/05/01/math/probability/distributions/index-dis/index-dis/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录指数分布。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>在概率理论和统计学中，指数分布（也称为负指数分布）是描述泊松过程中的事件之间的时间的概率分布，即事件以恒定平均速率连续且独立地发生的过程。 这是<a href="https://baike.baidu.com/item/%E4%BC%BD%E9%A9%AC%E5%88%86%E5%B8%83/7245468">伽马分布</a>的一个特殊情况。 它是几何分布的连续模拟，它具有无记忆的关键性质。 除了用于分析泊松过程外，还可以在其他各种环境中找到。</p></blockquote><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul><li>指数分布自变量$x$，其概率密度函数为：</li></ul>$$f(x)=\left\{\begin{array}{ll}\lambda e^{-\lambda x} & x>0 \\ 0 & x \leq 0\end{array}\right.$$<ul><li>其中$λ &gt; 0$是分布的一个参数，常被称为率参数(rate parameter)，即每单位时间内发生某事件的次数。指数分布的<a href="https://baike.baidu.com/item/%E5%8C%BA%E9%97%B4/1273117">区间</a>是$[0,∞)$。 如果一个<a href="https://baike.baidu.com/item/%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F">随机变量</a><em>X</em>呈指数分布，则可以写作：$X \sim  E(λ)$或$Exp(\lambda)$。</li><li>累积概率密度函数：</li></ul><p>$$<br>P{X \leq x}=F(x)=1-e^{-\frac{x}{\theta}}, x&gt;0<br>$$</p><h3 id="期望"><a href="#期望" class="headerlink" title="期望"></a>期望</h3>$$\begin{aligned} f(x) &=\lambda e^{-\lambda x} \\ E(x) &=\int_{-\infty}^{+\infty} x f(x) d(x) \\ &=\int_{0}^{+\infty} x \lambda e^{-\lambda x} d x \\ &=-\int_{0}^{+\infty} x d e^{-\lambda x} \\ &=-\left(\left.x \cdot e^{-\lambda x}\right|_{0} ^{+\infty}-\int_{0}^{+\infty} e^{-\lambda x} d x\right)  \\ &= f-\frac{1}{x} \int_{0}^{+\infty} d e^{-\lambda x}\\&=\frac{1}{\lambda}\end{aligned}$$<h3 id="方差"><a href="#方差" class="headerlink" title="方差"></a>方差</h3>$$\begin{aligned} E\left(x^{2}\right) &=\int_{-\infty}^{+\infty} x^{2} f(x) d x \\ &=\int_{0}^{+\infty} \lambda x^{2} e^{-\lambda x} d x \\ &=-\int_{0}^{+\infty} x^{2} d e^{-\lambda x} \\ &=-\left(\left.x^{2} e^{-\lambda x}\right|_{0} ^{+\infty}-\int_{0}^{+\infty} 2 x e^{-\lambda x} d x\right) \\ &=\frac{2}{\lambda} \cdot \int_{0}^{+\infty} \lambda x e^{-\lambda x} d x \\ &=\frac{2}{\lambda} \cdot E(x) \\  &=\frac{1}{\lambda}\end{aligned} $$$$\begin{aligned} Var(x) &=E(x)^{2}-(E(x))^{2} \\ &=\frac{2}{\lambda^{2}}-\frac{1}{\lambda^{2}} \\ &=\frac{1}{\lambda^{2}} \end{aligned}$$<h3 id="指数分布的来源"><a href="#指数分布的来源" class="headerlink" title="指数分布的来源"></a>指数分布的来源</h3><blockquote><p>指数分布表示事件发生两次的间隔的概率分布，我们利用泊松分布的一些结论来推导</p></blockquote><ul><li>事件单位时间发生的期望次数为$\lambda$，两次事件发生的时间间隔随机变量用$Y$表示</li><li>那么两次事件发生的时间间隔大于$t$的概率等于时间$t$内没有发生事件的概率，而后者的概率可以用泊松分布刻画：</li></ul><p>$$<br>P(Y&gt;t)=P(X=0, t)=\frac{(\lambda t)^{0}}{0 !} e^{-\lambda t}=e^{-\lambda t}, \quad t \geq 0<br>$$</p><ul><li>进而有:</li></ul><p>$$<br>P(Y \leq t)=1-P(Y&gt;t)=1-e^{-\lambda t}<br>$$</p><ul><li>$  Y $ 的累积分布函数:</li></ul>$$F(y)=P(Y \leq y)=\left\{\begin{array}{ll}1-e^{-\lambda y}, & y \geq 0 \\0, & y<0\end{array}\right.$$<ul><li>求导得到概率密度函数:</li></ul>$$p(y)=\left\{\begin{array}{ll}\lambda e^{-\lambda y}, & y \geq 0 \\0, & y<0\end{array}\right.$$<ul><li>至此得到了指数分布概率密度函数</li></ul><h3 id="无记忆性"><a href="#无记忆性" class="headerlink" title="无记忆性"></a>无记忆性</h3><ul><li><p>指数函数的一个重要特征是无记忆性（Memoryless Property, 又称遗失记忆性）</p></li><li><p>这表示如果一个随机变量呈指数分布，当 $ s, t \geq 0 $ 时有:</p></li></ul><p>$$<br>P(T&gt;s+t \mid T&gt;t)=P(T&gt;s)<br>$$</p><blockquote><p>举例：如果T是某一元件的寿命，已知元件使用了t小时，它总共使用至少 $ s+t $ 小时的条件概率，与从开始使用时算起它使用至少s小时的概率相等。</p></blockquote><script src="/js/deployggb.js"></script><script>var parameters = {"id": "ggbApplet2","width":1000,"height":500,"enableShiftDragZoom":true,"showZoomButtons":true,"appletOnLoad":function(api){ /* api.evalCommand('Segment((1,2),(3,4))');*/ },"showFullscreenButton":true,"language":"en", "filename":"https://photos.zywvvd.com/icey-mate-book/20210501125514.ggb",};var views = {'is3D': 0,'AV': 1,'SV': 0,'CV': 0,'EV2': 0,'CP': 0,'PC': 0,'DA': 0,'FI': 0,'macro': 0};var applet = new GGBApplet(parameters, '5.0', views);window.onload = function(){applet.inject('ggbApplet');};</script><div id="ggbApplet"></div><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li><li><a href="https://baike.baidu.com/item/%E6%8C%87%E6%95%B0%E5%88%86%E5%B8%83/776702?fr=aladdin">https://baike.baidu.com/item/%E6%8C%87%E6%95%B0%E5%88%86%E5%B8%83/776702?fr=aladdin</a></li><li><a href="https://www.zhihu.com/question/24796044">https://www.zhihu.com/question/24796044</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 13 - 泊松分布（Poisson分布）</title>
    <link href="/2021/05/01/math/probability/distributions/poisson-dis/poisson-dis/"/>
    <url>/2021/05/01/math/probability/distributions/poisson-dis/poisson-dis/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录泊松分布。</p></blockquote><span id="more"></span><h3 id="泊松分布"><a href="#泊松分布" class="headerlink" title="泊松分布"></a>泊松分布</h3><ul><li>假设已知事件在单位时间 (或者单位面积) 内发生的平均次数为 $\lambda$, 则泊松分布描述了：<strong>事件在单位时间 (或者单位面积) 内发生的具体次数为 $k$ 的概率</strong>。</li><li>概率质量函数： $ p(X=k | \lambda)=\frac{e^{-\lambda} \lambda^{k}}{k !} $.</li><li>期望: $ \mathbb{E}[X]=\lambda $ </li><li>方差: $ \operatorname{Var}[X]=\lambda$</li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20210501100524.png"></p><h4 id="泊松分布的来源"><a href="#泊松分布的来源" class="headerlink" title="泊松分布的来源"></a>泊松分布的来源</h4><ul><li>泊松分布单位时间发生的次数为$X$，平均次数为$\lambda$</li><li>设所观察的这段时间为[0,1),取一个很大的自然数n，把时间段[0,1)分为等长的n段：</li></ul><p>$$<br>l_{1}=\left[0, \frac{1}{n}\right], l_{2}=\left[\frac{1}{n}, \frac{2}{n}\right], \ldots, l_{i}=\left[\frac{i-1}{n}, \frac{i}{n}\right], \ldots, l_{n}=\left[\frac{n-1}{n}, 1\right]<br>$$</p><ul><li>我们做如下两个假定:</li></ul><ol><li>在每段 $ l_{i} $ 内, 恰发生一个事故的概率，近似的与这段时间的长 $ \frac{1}{n} $ 成正比，可设为 $ \frac{\lambda}{n} $ 。当n很大时， $ \frac{1}{n} $ 很小时，在 $ l_{i} $ 这么短暂的一段时间内，要发生两次或者更多次事故是不可能的。因此在 $ l_{i} $ 这段时间内不发生事故的概率为 $ 1-\frac{\lambda}{n} $ 。</li><li>$ l_{i}, \ldots, l_{n} $ 各段是否发生事故是独立的<br>把在 $ [0,1) $ 时段内发生的事故数 X视作在n个划分之后的小时段 $ l_{i}, \ldots, l_{n} $ 内有事故的时段数，则按照上述两个假定， $ X $ 应服 从二项分布 $ B\left(n, \frac{\lambda}{n}\right) $ 。于是，我们有</li></ol><p>$$<br>P(X=i)=\left(\begin{array}{c}<br>n \<br>i<br>\end{array}\right)\left(\frac{\lambda}{n}\right)^{i}\left(1-\frac{\lambda}{n}\right)^{n-i}<br>$$</p><ul><li>注意到当 $ n \rightarrow \infty $ 取极限时，我们有</li></ul><p>$$<br>\frac{\left(\begin{array}{l}<br>n \<br>i<br>\end{array}\right)}{n^{i}} \rightarrow \frac{1}{i !},\left(1-\frac{\lambda}{n}\right)^{n} \rightarrow e^{-\lambda}<br>$$</p><ul><li>因此</li></ul><p>$$<br>\begin{aligned}<br>P(X=i) &amp;=\left(\begin{array}{c}<br>n \<br>i<br>\end{array}\right)\left(\frac{\lambda}{n}\right)^{i}\left(1-\frac{\lambda}{n}\right)^{n-i} \<br>&amp;=\frac{e^{-\lambda} \lambda^{i}}{i !}<br>\end{aligned}<br>$$</p><blockquote><p>从上述推导可以看出：泊松分布可作为二项分布的极限而得到。一般的说，若 $ X \sim B(n, p) $,其中n很大， p很小，因而 $ n p=\lambda $ 不太大时， X的分布接近于泊松分布 $ P(\lambda) $ 。这个事实有时可将较难计算的二项分布转化为泊松分布去计算。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li><li><a href="https://baike.baidu.com/item/%E6%B3%8A%E6%9D%BE%E5%88%86%E5%B8%83/1442110?fr=aladdin">https://baike.baidu.com/item/%E6%B3%8A%E6%9D%BE%E5%88%86%E5%B8%83/1442110?fr=aladdin</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 12 - 拉普拉斯分布（Laplace分布）</title>
    <link href="/2021/05/01/math/probability/distributions/laplace-dis/laplace-dis/"/>
    <url>/2021/05/01/math/probability/distributions/laplace-dis/laplace-dis/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录拉普拉斯分布。</p></blockquote><span id="more"></span><h3 id="拉普拉斯分布"><a href="#拉普拉斯分布" class="headerlink" title="拉普拉斯分布"></a>拉普拉斯分布</h3><ul><li>概率密度函数： </li></ul><p>$$<br>p(x | \mu, \gamma)=\frac{1}{2 \gamma} \exp \left(-\frac{|x-\mu|}{\gamma}\right)<br>$$</p><blockquote><p>拉普拉斯分布的密度函数，可以看作是两个指数分布函数的概率密度“背靠背”拼接在一起。</p></blockquote><ul><li>期望： </li></ul><p>$$<br>\quad \mathbb{E}[X]=\mu<br>$$</p><ul><li>方差: </li></ul><p>$$<br>\operatorname{Var}[X]=2 \gamma^{2}<br>$$</p><script src="/js/deployggb.js"></script><script>var parameters = {"id": "ggbApplet2","width":1000,"height":500,"enableShiftDragZoom":true,"showZoomButtons":true,"appletOnLoad":function(api){ /* api.evalCommand('Segment((1,2),(3,4))');*/ },"showFullscreenButton":true,"language":"en", "filename":"https://photos.zywvvd.com/image_canglan/20210417165539.ggb",};var views = {'is3D': 0,'AV': 1,'SV': 0,'CV': 0,'EV2': 0,'CP': 0,'PC': 0,'DA': 0,'FI': 0,'macro': 0};var applet = new GGBApplet(parameters, '5.0', views);window.onload = function(){applet.inject('ggbApplet');};</script><div id="ggbApplet"></div><h4 id="拉普拉斯分布与正态分布"><a href="#拉普拉斯分布与正态分布" class="headerlink" title="拉普拉斯分布与正态分布"></a>拉普拉斯分布与正态分布</h4><blockquote><p>拉普拉斯分布的概率密度与正态分布看起来很像，但是会比正态分布更尖（集中）一些</p></blockquote><p>标准拉普拉斯分布的0.99分位点是3.91，而标准正态分布是2.32，这说明，<strong>服从拉普拉斯分布的随机变量，出现极端大的值的概率，要远远大于正态分布。</strong></p><h4 id="拉普拉斯分布的一些性质"><a href="#拉普拉斯分布的一些性质" class="headerlink" title="拉普拉斯分布的一些性质"></a>拉普拉斯分布的一些性质</h4><ul><li>如果 $ X \sim \operatorname{Exp}(\lambda), Y \sim \operatorname{Exp}(\mu) $, 那么 $ \lambda X-\mu Y \sim \operatorname{Laplace}(0,1) $</li><li>如果 $ X, Y \sim U(0,1) $, 那么 $ \ln \frac{X}{Y} \sim \operatorname{Laplace}(0,1) $</li><li>如果 $ X_{i} \sim \operatorname{Laplace}(\mu, b) $, 那么 $ \frac{2}{b} \sum_{i=1}^{n}\left|X_{i}-\mu\right| \sim \chi^{2}(2 n) $</li><li>如果 $ X, Y \sim \operatorname{Laplace}(\mu, b) $, 那么 $ \frac{|X-\mu|}{|Y-\mu|} \sim \mathrm{F}(2,2) $</li></ul><h4 id="拉普拉斯分布的参数估计"><a href="#拉普拉斯分布的参数估计" class="headerlink" title="拉普拉斯分布的参数估计"></a>拉普拉斯分布的参数估计</h4><ul><li>拉普拉斯分布的样本中位数即为参数$\mu$的极大似然估计</li></ul><p> $$ \quad \hat{b}=\frac{1}{N} \sum_{i=1}^{N}\left|x_{i}-\hat{\mu}\right| $$</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/156234503">https://zhuanlan.zhihu.com/p/156234503</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 11 - 高斯分布 / 正态分布</title>
    <link href="/2021/05/01/math/probability/distributions/gauss-dis/gauss-dis/"/>
    <url>/2021/05/01/math/probability/distributions/gauss-dis/gauss-dis/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录高斯分布。</p></blockquote><span id="more"></span><h3 id="高斯分布-正态分布"><a href="#高斯分布-正态分布" class="headerlink" title="高斯分布 / 正态分布"></a>高斯分布 / 正态分布</h3><blockquote><p>正态分布是很多应用中的合理选择。如果某个随机变量取值范围是实数，且对它的概率分布一无所知，通常会假设它服从正态分布。有两个原因支持这一选择：</p><ul><li>建模的任务的真实分布通常都确实接近正态分布。</li><li>中心极限定理表明，多个独立随机变量的和近似正态分布。</li><li>在具有相同方差的所有可能的概率分布中，正态分布的熵最大（即不确定性最大）。</li></ul></blockquote><h4 id="一维正态分布"><a href="#一维正态分布" class="headerlink" title="一维正态分布"></a>一维正态分布</h4><ul><li>正态分布的概率密度函数为:</li></ul><p>$$<br>p(x)=\frac{1}{\sqrt{2 \pi} \sigma} e^{-(x-\mu)^{2} /\left(2 \sigma^{2}\right)},-\infty&lt;x&lt;\infty<br>$$</p><ul><li><p>其中 $ \mu, \sigma(\sigma&gt;0) $ 为常数。<br>若随机变量 $ X $ 的概率密度函数如上所述, 则称 $ X $ 服从参数为 $ \mu, \sigma $ 的正态分布或者高斯分布，记作 $ X \sim N\left(\mu, \sigma^{2}\right) $<br>特别的, 当 $ \mu=0, \sigma=1 $ 时，称为标准正态分布，其概率密度函数记作 $ \varphi(x) $, 分布函数记作 $ \Phi(x) $ </p></li><li><p>为了计算方便, 有时也记作: </p></li></ul><p>$$<br>\mathcal{N}\left(x ; \mu, \beta^{-1}\right)=\sqrt{\frac{\beta}{2 \pi}} \exp \left(-\frac{1}{2} \beta(x-\mu)^{2}\right)<br>$$</p><ul><li>,其中 $ \beta \in(0, \infty)$</li><li>期望： $ \mathbb{E}[X]=\mu$</li><li>方差: $ \operatorname{Var}[X]=\sigma^{2} $ </li></ul><h5 id="正态分布的概率密度函数性贡"><a href="#正态分布的概率密度函数性贡" class="headerlink" title="正态分布的概率密度函数性贡"></a>正态分布的概率密度函数性贡</h5><ul><li>曲线关于 $ x=\mu $ 对称</li><li>Q 曲线在 $ x=\mu $ 时取最大值</li><li>曲线在 $ x=\mu \pm \sigma $ 处有抛点</li><li>参数 $ \mu $ 决定曲线的位置</li><li>$ \sigma $ 决定图形的胖瘦</li></ul><h4 id="二维正态分布"><a href="#二维正态分布" class="headerlink" title="二维正态分布"></a>二维正态分布</h4><ul><li>二维正态随机变量 $ (X, Y) $ 的概率密度为:</li></ul>$$\begin{aligned}p(x, y) &=\frac{1}{2 \pi \sigma_{1} \sigma_{2} \sqrt{1-\rho^{2}}} \exp \left\{\frac { - 1 } { 2 ( 1 - \rho ^ { 2 } ) } \left[\frac{\left(x-\mu_{1}\right)^{2}}{\sigma_{1}^{2}}\right.\right.\left.\left.-2 \rho \frac{\left(x-\mu_{1}\right)\left(y-\mu_{2}\right)}{\sigma_{1} \sigma_{2}}+\frac{\left(y-\mu_{2}\right)^{2}}{\sigma_{2}^{2}}\right]\right\}\end{aligned}$$<ul><li>根据定义，可以计算出:</li></ul><p>$$ p_{X}(x)=\frac{1}{\sqrt{2 \pi} \sigma_{1}} e^{-\left(x-\mu_{1}\right)^{2} /\left(2 \sigma_{1}^{2}\right)},-\infty&lt;x&lt;\infty $$<br>$$ p_{Y}(y)=\frac{1}{\sqrt{2 \pi} \sigma_{2}} e^{-\left(y-\mu_{2}\right)^{2} /\left(2 \sigma_{3}^{2}\right)},-\infty&lt;y&lt;\infty $$<br>$$ \mathbb{E}[X]=\mu_{1} $$<br>$$ \mathbb{E}[Y]=\mu_{2} $$<br>$$ \operatorname{Var}[X]=\sigma_{1}^{2} $$<br>$$ \operatorname{Var}[Y]=\sigma_{2}^{2} $$<br>$$ \operatorname{Cov}[X, Y]=\int_{-\infty}^{\infty} \int_{-\infty}^{\infty}\left(x-\mu_{1}\right)\left(y-\mu_{2}\right) p(x, y) d x d y=\rho \sigma_{1} \sigma_{2} $$<br>$$ \rho_{X Y}=\rho $$</p><ul><li><p>引入矩阵:</p>  $$  \overrightarrow{\mathbf{x}}=\left[\begin{array}{l}  x \\  y  \end{array}\right] \quad \vec{\mu}=\left[\begin{array}{c}  \mu_{1} \\  \mu_{2}  \end{array}\right] \quad \mathbf{\Sigma}=\left[\begin{array}{ll}  c_{11} & c_{12} \\  c_{21} & c_{22}  \end{array}\right]=\left[\begin{array}{cc}  \sigma_{1}^{2} & \rho \sigma_{1} \sigma_{2} \\  \rho \sigma_{1} \sigma_{2} & \sigma_{2}^{2}  \end{array}\right]  $$  <p>$ \mathbf{\Sigma} $ 为 $ (X, Y) $ 的协方差矩阵。其行列式为 $ \operatorname{det} \mathbf{\Sigma}=\sigma_{1}^{2} \sigma_{2}^{2}\left(1-\rho^{2}\right) $, 其逆矩阵为:</p>  $$  \mathbf{\Sigma}^{-1}=\frac{1}{\operatorname{det} \mathbf{\Sigma}}\left[\begin{array}{cc}  \sigma_{2}^{2} & -\rho \sigma_{1} \sigma_{2} \\  -\rho \sigma_{1} \sigma_{2} & \sigma_{1}^{2}  \end{array}\right]  $$  <p>于是 $ (X, Y) $ 的概率密度函数可以写作：</p></li></ul>$$  p(x, y)=\frac{1}{(2 \pi)(\operatorname{det} \mathbf{\Sigma})^{1 / 2}} \exp \left\{-\frac{1}{2}(\overrightarrow{\mathbf{x}}-\vec{\mu})^{T} \mathbf{\Sigma}^{-1}(\overrightarrow{\mathbf{x}}-\vec{\mu})\right\}$$  <ul><li><p>其中：</p><ul><li>均值 $ \mu_{1}, \mu_{2} $ 决定了曲面的位置 </li><li>标准差 $ \sigma_{1}, \sigma_{2} $ 决定了曲面的陡肖程度</li><li>$ \rho $ 决定了协方差矩阵的形状，从而决定了曲面的形状：</li><li>$ \rho=0 $ 时, 协方差矩阵对角线非零，其他位置均为零。此时表示随机变量之间不相关，曲面在 $ z=0 $ 平面的截面是个圆形</li><li>$ \rho=0.5 $ 时，协方差矩阵对角线非零，其他位置非零。此时表示随机变量之间相关。曲面在 $ z=0 $ 平面的截面是个格圆，相当于圆形沿着直线 $ y=x $ 方向压缩</li><li>$ \rho=1 $ 时, 协方差矩阵对角线非零, 其他位置非零。此时表示随机变量之间完全相关。此时的联合分布概率函数形状为：曲面在 $ z=0 $ 平面的截面是直线 $ y=x $, 相当于圆形沿着直线 $ y=x $ 方向压缩成一条直线</li></ul></li></ul><h4 id="多维正态分布"><a href="#多维正态分布" class="headerlink" title="多维正态分布"></a>多维正态分布</h4><ul><li>多维正态随机变量 $ \left(X_{1}, X_{2}, \cdots, X_{n}\right) $, 引入列矩阵：</li></ul>$$\overrightarrow{\mathbf{x}}=\left[\begin{array}{c}x_{1} \\x_{2} \\\vdots \\x_{n}\end{array}\right] \quad \vec{\mu}=\left[\begin{array}{c}\mu_{1} \\\mu_{2} \\\vdots \\\mu_{n}\end{array}\right]=\left[\begin{array}{c}\mathbb{E}\left[X_{1}\right] \\\mathbb{E}\left[X_{2}\right] \\\vdots \\\mathbb{E}\left[X_{n}\right]\end{array}\right]$$<ul><li>$ \mathbf{\Sigma} $ 为 $ \left(X_{1}, X_{2}, \cdots, X_{n}\right) $ 的协方差矩阵。则:</li></ul>$$\begin{array}{r}p\left(x_{1}, x_{2}, x_{3}, \cdots, x_{n}\right)=\frac{1}{(2 \pi)^{n / 2}(\operatorname{det} \mathbf{\Sigma})^{1 / 2}} \exp \left\{-\frac{1}{2}(\overrightarrow{\mathbf{x}}-\vec{\mu})^{T} \mathbf{\Sigma}^{-1}(\overrightarrow{\mathbf{x}}-\vec{\mu})\right\} \\\end{array}$$<ul><li>记做：</li></ul><p>$$<br>\mathcal{N}(\overrightarrow{\mathbf{x}} ; \vec{\mu}, \mathbf{\Sigma})=\sqrt{\frac{1}{(2 \pi)^{n} \operatorname{det}(\mathbf{\Sigma})}} \exp \left(-\frac{1}{2}(\overrightarrow{\mathbf{x}}-\vec{\mu})^{T} \mathbf{\Sigma}^{-1}(\overrightarrow{\mathbf{x}}-\vec{\mu})\right)<br>$$</p><h5 id="四条性质"><a href="#四条性质" class="headerlink" title="四条性质"></a>四条性质</h5><ul><li>$ n $ 维正态变量的每一个分量都是正态变量; 反之, 若 $ X_{1}, X_{2}, \cdots, X_{n} $ 都是正态变量, 且相互独立, 则 $ \left(X_{1}, X_{2}, \cdots, X_{n}\right) $ 是 $ n $ 维正态变量。</li><li>$  n $ 维随机变量 $ \left(X_{1}, X_{2}, \cdots, X_{n}\right) $ 服从 $ n $ 维正态分布的充要条件是: <ul><li>$ X_{1}, X_{2}, \cdots, X_{n_{n}} $ 的任意线性组合$ l_{1} X_{1}+l_{2} X_{2}+\cdots+l_{n} X_{n} $ 服从一维正态分布, 其中 $ l_{1}, l_{2}, \cdots, l_{n} $ 不全为 $ 0_{\circ} $</li></ul></li><li>若 $ \left(X_{1}, X_{2}, \cdots, X_{n}\right) $ 服从 $ n $ 维正态分布, 设 $ Y_{1}, Y_{2}, \cdots, Y_{k} $ 是 $ X_{j}, j=1,2, \cdots, n $ 的线性函数, 则 $ \left(Y_{1}, Y_{2}, \cdots, Y_{k}\right) $ 也服从多维正态分布。这一性质称为正态变量的线性变换不变性。</li><li>设 $ \left(X_{1}, X_{2}, \cdots, X_{n}\right) $ 服从 $ n $ 维正态分布, 则 $ X_{1}, X_{2}, \cdots, X_{n} $ 相互独立 $ \Longleftrightarrow X_{1}, X_{2}, \cdots, X_{n} $ 两两不相关。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Xshell 链接 WSL2 Ubuntu 18.04</title>
    <link href="/2021/04/23/windows/about_wsl/wsl2-xshell-connect/wsl2-xshell-connect/"/>
    <url>/2021/04/23/windows/about_wsl/wsl2-xshell-connect/wsl2-xshell-connect/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Microsoft Store 应用启动的终端经常莫名其妙地消失，采用Xshell连接会稳定一些。</p></blockquote><span id="more"></span><h3 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h3><ul><li>安装好WSL2的Linux(<a href="https://www.zywvvd.com/2021/04/22/windows/about_wsl/wsl-build/wsl-build/">参考教程</a>)</li><li>安装好Xshell</li></ul><h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><h4 id="重新安装-ssh-server"><a href="#重新安装-ssh-server" class="headerlink" title="重新安装 ssh-server"></a>重新安装 ssh-server</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get remove --purge openssh-server   ## 删ssh<br>sudo apt-get install openssh-server          ## 安装ssh  <br></code></pre></td></tr></table></figure><h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo vim /etc/ssh/sshd_config<br></code></pre></td></tr></table></figure><ul><li>配置：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">Port 6954<br>ListenAddress 0.0.0.0<br>PasswordAuthentication yes<br></code></pre></td></tr></table></figure><h4 id="重启ssh"><a href="#重启ssh" class="headerlink" title="重启ssh"></a>重启ssh</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">sudo service ssh <span class="hljs-comment">--full-restart</span><br></code></pre></td></tr></table></figure><ul><li>正常输出为</li></ul><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">* </span>Stopping OpenBSD Secure Shell server sshd                                                                     [ OK ]<br><span class="hljs-bullet">* </span>Starting OpenBSD Secure Shell server sshd                                                                     [ OK ]<br></code></pre></td></tr></table></figure><h4 id="Xshell-端设置新会话"><a href="#Xshell-端设置新会话" class="headerlink" title="Xshell 端设置新会话"></a>Xshell 端设置新会话</h4><ul><li>填入本地 Host IP 与我们在WSL中配置的端口号</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423150315.png"></p><ul><li>配置用户身份验证的用户名与密码</li><li>或配置ssh key设置密钥登录</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423150500.png"></p><blockquote><p>登录成功</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://blog.csdn.net/qq_42437577/article/details/110664557">https://blog.csdn.net/qq_42437577/article/details/110664557</a></p></li><li><p><a href="https://www.zywvvd.com/2021/04/22/windows/about_wsl/wsl-build/wsl-build/">https://www.zywvvd.com/2021/04/22/windows/about_wsl/wsl-build/wsl-build/</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
      <category>WSL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>WSL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>错误 WslRegisterDistribution failed with error 0x80370102 解决方案</title>
    <link href="/2021/04/22/windows/about_wsl/wsl-rd-failed-80370102/wsl-rd-failed-80370102/"/>
    <url>/2021/04/22/windows/about_wsl/wsl-rd-failed-80370102/wsl-rd-failed-80370102/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录<code>WslRegisterDistribution failed with error: 0x80370102</code> 解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>安装<strong>微软应用商店</strong>里的<strong>ubuntu</strong>完成后，双击打开，出现如下报错：</p></blockquote><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs subunit">Installing, this may take a few minutes...<br>WslRegisterDistribution failed with error: 0x80370102<br><span class="hljs-keyword">Error: </span>0x80370102 ???????????????????<br></code></pre></td></tr></table></figure><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><ul><li>没有开启<strong>虚拟化</strong></li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ol><li>重启电脑，进入 BIOS 开启虚拟化技术</li><li>控制面板-&gt;启用或关闭windows功能，勾选 Hyper-V、适用于 Linux 的 Windows 子系统、虚拟机平台，勾选这三个选项。</li><li>重启电脑</li></ol><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/xiangsui/p/14258385.html">https://www.cnblogs.com/xiangsui/p/14258385.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 10 系统存储 - 清理C盘空间</title>
    <link href="/2021/04/22/windows/win-storage-clean-up/win-storage-clean-up/"/>
    <url>/2021/04/22/windows/win-storage-clean-up/win-storage-clean-up/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Windows 在使用过程中 C 盘就像一根蜡烛，眼瞅着越烧越短，奄奄一息。除了使用各个平台的电脑管家清理外，Windows自带的存储功能也可以辅助腾出很大空间来。</p></blockquote><span id="more"></span><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><blockquote><p>Win + S 搜索 <code>存储设置</code></p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422174334.png"></p><ul><li>在其中可以删除各种占用大量资源的文件</li></ul><h3 id="实用对比"><a href="#实用对比" class="headerlink" title="实用对比"></a>实用对比</h3><ul><li>付费金山垃圾清理</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423105504.png"></p><blockquote><p>其中深度清理都是下载的往期文件，不在C盘</p></blockquote><ul><li>付费金山C盘瘦身专家</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423105652.png"></p><ul><li>系统存储</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423105321.png"></p><blockquote><p>呐，高下立判</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决Windows 预览体验计划没有用户选择界面的问题</title>
    <link href="/2021/04/22/windows/about_wsl/no-windows-user-plan/no-windows-user-plan/"/>
    <url>/2021/04/22/windows/about_wsl/no-windows-user-plan/no-windows-user-plan/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Windows 预览体验计划没有用户选择界面问题的解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><ul><li><code>Win+S</code> 搜索<strong>预览体验计划</strong></li></ul><blockquote><p> 然后没有用户选择界面.</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422154039.png"></p><ul><li>此时没有办法加入用户体验计划</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>使用管理员权限打开 powershell，运行命令：</li></ul><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection&quot;</span><br><span class="hljs-comment"># Telemetry level: 1 - basic, 3 - full</span><br><span class="hljs-variable">$value</span> = <span class="hljs-string">&quot;3&quot;</span><br>New-ItemProperty -Path <span class="hljs-variable">$path</span> -<span class="hljs-keyword">Name</span> AllowTelemetry -Value <span class="hljs-variable">$value</span> -Type Dword -Force<br>New-ItemProperty -Path <span class="hljs-variable">$path</span> -<span class="hljs-keyword">Name</span> MaxTelemetryAllowed -Value <span class="hljs-variable">$value</span> -Type Dword -Force<br></code></pre></td></tr></table></figure><ul><li>重启计算机，问题解决：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422154541.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="http://bbs.pcbeta.com/viewthread-1885143-1-1.html">http://bbs.pcbeta.com/viewthread-1885143-1-1.html</a></p></li><li><p><a href="https://blog.csdn.net/weixin_49192027/article/details/114701895">https://blog.csdn.net/weixin_49192027/article/details/114701895</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows Subsystem for Linux (WSL) 创建、运行带CUDA支持的Ubuntu系统</title>
    <link href="/2021/04/22/windows/about_wsl/wsl-build/wsl-build/"/>
    <url>/2021/04/22/windows/about_wsl/wsl-build/wsl-build/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Windows Subsystem for Linux （WSL）是适用于 Linux 的 Windows 子系统可让开发人员直接在 Windows 上按原样运行 GNU/Linux 环境（包括大多数命令行工具、实用工具和应用程序），且不会产生传统虚拟机或双启动设置开销。</p></blockquote><span id="more"></span><h3 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h3><ul><li>中文文档：<a href="https://docs.microsoft.com/zh-cn/windows/wsl/">https://docs.microsoft.com/zh-cn/windows/wsl/</a></li><li>win10安装文档：<a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a></li><li>Nvidia WSL 支持文档：<a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#abstract">https://docs.nvidia.com/cuda/wsl-user-guide/index.html#abstract</a></li><li>Nvidia WSL 开发文档：<a href="https://developer.nvidia.com/cuda/wsl">https://developer.nvidia.com/cuda/wsl</a></li></ul><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>Windows Linux子系统（WSL）是Windows 10的一项功能，使用户可以直接在Windows上运行本机Linux命令行工具。 WSL是一个容器化的环境，用户可以在其中从Windows 10 Shell的命令行运行Linux本机应用程序，而无需双启动环境的复杂性。在内部，WSL与Microsoft Windows操作系统紧密集成，从而使其可以与传统的Windows桌面和现代商店应用程序一起运行Linux应用程序。</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422120707.png" alt=" *CUDA WSL* "></p><ul><li>借助WSL 2和GPU半虚拟化技术，Microsoft使开发人员能够在Windows上运行GPU加速的应用程序</li></ul><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a><a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#installing-wip">安装步骤</a></h3><blockquote><p>以下文档描述了在WSL 2环境中开始运行CUDA应用程序或容器的工作流程</p><p>注意：从开普勒架构开始，在GPU上启用了WSL 2上的CUDA。但是，官方建议在Turing或更新的体系结构上的WSL 2上运行CUDA。</p></blockquote><ul><li>从Microsoft Windows Insider程序安装最新版本</li><li>为WSL2安装 NVIDIA 驱动</li><li>安装WSL2</li><li>安装Linux发行版</li><li>为WSL配置CUDA环境</li><li>为WSL安装 nvidia-docker</li></ul><h3 id="从Microsoft-Windows-Insider程序安装最新版本"><a href="#从Microsoft-Windows-Insider程序安装最新版本" class="headerlink" title="从Microsoft Windows Insider程序安装最新版本"></a><a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#installing-wip">从Microsoft Windows Insider程序安装最新版本</a></h3><h4 id="注册加入微软Windows内部人员计划"><a href="#注册加入微软Windows内部人员计划" class="headerlink" title="注册加入微软Windows内部人员计划"></a>注册加入微软Windows内部人员计划</h4><ul><li>链接： <a href="https://insider.windows.com/en-us/getting-started/#register">Microsoft Windows Insider Program</a></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422142030.png"></p><ul><li>登录微软账号</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422142057.png"></p><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422142759.png"></p><ul><li>注册成功</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422142833.png"></p><h4 id="安装-Win-10-的最新版本"><a href="#安装-Win-10-的最新版本" class="headerlink" title="安装 Win 10 的最新版本"></a>安装 Win 10 的最新版本</h4><h5 id="查看Windows-10-版本"><a href="#查看Windows-10-版本" class="headerlink" title="查看Windows 10 版本"></a>查看Windows 10 版本</h5><ul><li>Win + R 在运行中输入命令 <strong>winver</strong> </li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422143841.png"></p><ul><li>可以看到我的系统版本 1919 内部版本18363，这是不够的</li><li>需要版本2004以上 内部版本<strong>19041</strong> 或更高</li></ul><h4 id="加入Windows预览体验计划"><a href="#加入Windows预览体验计划" class="headerlink" title="加入Windows预览体验计划"></a>加入Windows预览体验计划</h4><ul><li><code>Win+S</code> 搜索<strong>预览体验计划</strong></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422155348.png"></p><blockquote><p>如果没有这个开始按钮，一片空白，请移步<a href="https://www.zywvvd.com/2021/04/22/windows/about_wsl/no-windows-user-plan/no-windows-user-plan/">解决Windows 预览体验计划没有用户选择界面的问题</a></p></blockquote><ul><li><p>然后链接到自己的微软账户</p></li><li><p>CUDA建议使用Dev渠道，以获得最新的更新与最高的cuda性能，此处我们选择Dev渠道：</p></li></ul><blockquote><p>求稳的用户建议选择Beat渠道</p></blockquote><ul><li>重启计算机</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422155714.png"></p><ul><li>成功加入预览成员</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422171126.png"></p><h4 id="进行-Windows-更新"><a href="#进行-Windows-更新" class="headerlink" title="进行 Windows 更新"></a>进行 Windows 更新</h4><ul><li><code>Win+S</code> 搜索<strong>windows更新</strong></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422160458.png"></p><ul><li>开启高级选项中的<code>更新Windows时接收其他Microsoft产品的更新</code>以更新Linux内核</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422171321.png"></p><ul><li>更新吧</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422165956.jpg"></p><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422165855.jpg"></p><blockquote><p>这个更新可能需要分步<br>也就是一次重启更新一部分文件<br>需要不停更新，直到无新可更</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423092112.png"></p><h4 id="更新后检查Windows-版本"><a href="#更新后检查Windows-版本" class="headerlink" title="更新后检查Windows 版本"></a>更新后检查Windows 版本</h4><ul><li>win + R  命令 winver</li><li>Beta 渠道更新结果：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422170547.png"></p><ul><li>Dev渠道更新结果</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422193325.png"></p><blockquote><p>21364.1已经超过了CUDA建议的21332内部版本号</p></blockquote><h4 id="检查历史更新记录"><a href="#检查历史更新记录" class="headerlink" title="检查历史更新记录"></a>检查历史更新记录</h4><ul><li>在<code>Windows 更新</code> 面板中<code>查看更新历史记录</code></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422173527.png"></p><blockquote><p>如果没有 Linux 内核更新请返回开启<code>更新Windows时接收其他Microsoft产品的更新</code>开关</p><p>CUDA建议Linux内核版本 5.4.91+获得最好性能，当前没有达到，应该也是够用的</p></blockquote><h4 id="安装-NVIDIA-驱动"><a href="#安装-NVIDIA-驱动" class="headerlink" title="安装 NVIDIA 驱动"></a><a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#installing-nvidia-drivers">安装 NVIDIA 驱动</a></h4><blockquote><p>从WSL页面CUDA的下载部分下载NVIDIA驱动程序。根据您系统中的NVIDIA GPU的类型选择合适的驱动程序-GeForce和Quadro。</p></blockquote><ul><li>官网链接： <a href="https://developer.nvidia.com/cuda/wsl">CUDA on WSL</a></li></ul><h4 id="下载驱动"><a href="#下载驱动" class="headerlink" title="下载驱动"></a>下载驱动</h4><ul><li>下载链接：<a href="https://developer.nvidia.com/cuda/wsl/download">https://developer.nvidia.com/cuda/wsl/download</a></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422142520.png"></p><ul><li>选择自己的驱动类型</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422142558.png"></p><ul><li><p>登录英伟达账号</p></li><li><p>下载驱动</p></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422145127.png"></p><h4 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h4><ul><li>使用可执行文件安装驱动程序，这是我们需要安装的唯一驱动程序。</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422171549.png"></p><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422171756.png"></p><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422171724.png"></p><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422171831.png"></p><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422172229.png"></p><blockquote><p>DirectX WSL驱动程序会与其他驱动程序组件一起自动安装，因此不需要其他操作。该驱动程序通过支持DX12 API在WSL2.0上启用图形。在WSL上具有DirectML支持的TensorFlow将获得用于训练和推理工作量的NV GPU硬件加速。 </p><p>更多信息：<a href="https://docs.microsoft.com/en-us/windows/win32/direct3d12/gpu-tensorflow-wsl">https://docs.microsoft.com/en-us/windows/win32/direct3d12/gpu-tensorflow-wsl</a></p></blockquote><h4 id="查看驱动版本"><a href="#查看驱动版本" class="headerlink" title="查看驱动版本"></a>查看驱动版本</h4><ul><li>cmd 运行 <code>nvidia-smi</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">C:\Users\Admin&gt;nvidia-smi<br>Thu Apr 22 17:27:03 2021<br>+-----------------------------------------------------------------------------+<br>| NVIDIA-SMI 470.14       Driver Version: 470.14       CUDA Version: 11.3     |<br>|-------------------------------+----------------------+----------------------+<br>| GPU  Name            TCC/WDDM | Bus-Id        Disp.A | Volatile Uncorr. ECC |<br>| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |<br>|                               |                      |               MIG M. |<br>|===============================+======================+======================|<br>|   0  NVIDIA GeForce ... WDDM  | 00000000:01:00.0  On |                  N/A |<br>|  0%   48C    P8    14W / 135W |    250MiB /  6144MiB |      0%      Default |<br>|                               |                      |                  N/A |<br>+-------------------------------+----------------------+----------------------+<br><br>+-----------------------------------------------------------------------------+<br>| Processes:                                                                  |<br>|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |<br>|        ID   ID                                                   Usage      |<br>|=============================================================================|<br>|    0   N/A  N/A      1308    C+G   Insufficient Permissions        N/A      |<br>|    0   N/A  N/A     10776    C+G   Insufficient Permissions        N/A      |<br>|    0   N/A  N/A     14460    C+G   ...s (x86)\YYNote\YYNote.exe    N/A      |<br>+-----------------------------------------------------------------------------+<br></code></pre></td></tr></table></figure><blockquote><p>官方提醒：</p><ol><li>不要在WSL中安装任何Linux显示驱动程序。 Windows显示驱动程序将同时安装用于本机Windows和WSL支持的常规驱动程序组件。</li><li>NVIDIA了解到在移动平台上报告的特定安装问题，该问题在2020年11月16日发布了WIP驱动程序465.12。已知的解决方法是在系统启动时从设备管理器中禁用和重新启用GPU适配器。我们正在努力解决此问题，并将很快提供更新的驱动程序。</li></ol></blockquote><h3 id="安装-WSL-2"><a href="#安装-WSL-2" class="headerlink" title="安装 WSL 2"></a><a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#installing-wsl2">安装 WSL 2</a></h3><h4 id="安装-WSL-1"><a href="#安装-WSL-1" class="headerlink" title="安装 WSL 1"></a>安装 WSL 1</h4><blockquote><p>现在的我们有三种方法安装WSL 1</p></blockquote><ol><li><p>使用简化安装命令</p><blockquote><p>此方法需要有三个前提:</p><ol><li>加入 <a href="https://insider.windows.com/getting-started">Windows 预览体验计划</a></li><li>安装 Windows 10 的预览版（OS 版本 20262 或更高版本）。</li><li>使用管理员特权打开命令行窗口</li></ol></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wsl --install<br></code></pre></td></tr></table></figure></li><li><p><code>控制面板</code> –&gt; <code>程序与功能</code> –&gt; <code>启动或关闭Windows功能</code> 勾选 <code>适用于Linux的Windows子系统</code></p></li><li><p>或使用<strong>管理员</strong>权限打开powershell，输入命令：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">dism.exe <span class="hljs-string">/online</span> <span class="hljs-string">/enable-feature</span> <span class="hljs-string">/featurename</span><span class="hljs-function">:Microsoft-Windows-Subsystem-Linux</span> <span class="hljs-string">/all</span> <span class="hljs-string">/norestart</span><br></code></pre></td></tr></table></figure></li></ol><blockquote><p>此时为了成功安装 WSL 事实上需要重启电脑，但是升级 WSL2 还需要重启一次，所以此处可以选择等会再重启</p></blockquote><h4 id="开启虚拟化功能"><a href="#开启虚拟化功能" class="headerlink" title="开启虚拟化功能"></a>开启虚拟化功能</h4><blockquote><p>有两种方法完成开启</p></blockquote><ol><li><p>管理员权限开启 powershell，执行命令：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">C:\WINDOWS\system32&gt; dism.exe <span class="hljs-string">/online</span> <span class="hljs-string">/enable-feature</span> <span class="hljs-string">/featurename</span><span class="hljs-function">:VirtualMachinePlatform</span> <span class="hljs-string">/all</span> <span class="hljs-string">/norestart</span><br><br>部署映像服务和管理工具<br>版本: 10.0.21364.1<br><br>映像版本: 10.0.21364.1<br><br>启用一个或多个功能<br>[==========================100.0%==========================]<br>操作成功完成。<br></code></pre></td></tr></table></figure></li><li><p><code>控制面板</code> –&gt; <code>程序与功能</code> –&gt; <code>启动或关闭Windows功能</code> 勾选 <code>虚拟机平台</code></p></li></ol><ul><li>执行上述之一的步骤后，重启计算机，完成 WSL 安装并更新到 WSL 2</li></ul><h4 id="开启Hyper-V"><a href="#开启Hyper-V" class="headerlink" title="开启Hyper-V"></a>开启Hyper-V</h4><ul><li><code>控制面板</code> –&gt; <code>程序与功能</code> –&gt; <code>启动或关闭Windows功能</code> 勾选 <code>Hyper-V</code> 选项。</li></ul><h4 id="在BIOS中开启虚拟化功能"><a href="#在BIOS中开启虚拟化功能" class="headerlink" title="在BIOS中开启虚拟化功能"></a>在BIOS中开启虚拟化功能</h4><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422201747.jpg"></p><h4 id="下载Linux内核更新包"><a href="#下载Linux内核更新包" class="headerlink" title="下载Linux内核更新包"></a>下载Linux内核更新包</h4><ul><li>下载最新包：<ul><li><a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">适用于 x64 计算机的 WSL2 Linux 内核更新包</a></li></ul></li></ul><blockquote><p>如果使用的是 ARM64 计算机，请下载 <a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_arm64.msi">ARM64 包</a>。 如果不确定自己计算机的类型，请打开命令提示符或 PowerShell，并输入：<code>systeminfo</code></p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422194557.png"></p><blockquote><p>系统类型可以看到本机基于 x64 需要下载x64包</p></blockquote><ul><li><p>运行上一步中下载的更新包。 （双击以运行 - 系统将提示你提供提升的权限，选择“是”以批准此安装。）</p></li><li><p>如果提示当前WSL版本更新就忽略这个包吧</p></li></ul><h4 id="将-WSL-2-设置为默认版本"><a href="#将-WSL-2-设置为默认版本" class="headerlink" title="将 WSL 2 设置为默认版本"></a>将 WSL 2 设置为默认版本</h4><ul><li>打开 PowerShell，然后在安装新的 Linux 发行版时运行以下命令，将 WSL 2 设置为默认版本：</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wsl -<span class="hljs-literal">-set</span><span class="hljs-literal">-default</span><span class="hljs-literal">-version</span> <span class="hljs-number">2</span><br>--&gt;<br>有关与 WSL <span class="hljs-number">2</span> 的主要区别的信息，请访问 https://aka.ms/wsl2<br>操作成功完成。<br></code></pre></td></tr></table></figure><h4 id="查看-wsl-版本"><a href="#查看-wsl-版本" class="headerlink" title="查看 wsl 版本"></a>查看 wsl 版本</h4><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">wsl <span class="hljs-params">--list</span> <span class="hljs-params">--verbose</span><br><span class="hljs-string">//</span> 或<br>wsl -l -v<br></code></pre></td></tr></table></figure><ul><li>输出：</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">C:\Windows\system32&gt;wsl -l -v<br>  <span class="hljs-type">NAME</span>            STATE           <span class="hljs-keyword">VERSION</span><br>* Ubuntu<span class="hljs-number">-18.04</span>    Running         <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><blockquote><p>由于我之前安装了wsl1的ubuntu，列表中有一个Version为1的开发版</p></blockquote><h3 id="安装Linux发行版"><a href="#安装Linux发行版" class="headerlink" title="安装Linux发行版"></a>安装Linux发行版</h3><h4 id="安装Linux"><a href="#安装Linux" class="headerlink" title="安装Linux"></a>安装Linux</h4><ul><li>选择自己需要的Linux发行版：</li></ul><blockquote><p>事实上我尝试了 16.04和18.04的ubuntu 均出现安装CUDA时闪退的问题，没有解决</p><p>换成了20.04 顺利安装CUDA</p></blockquote><details>    <summary>Linux 分发版链接</summary><ul><li><a href="https://www.microsoft.com/store/apps/9pjn388hp8c9">Ubuntu 16.04 LTS</a></li><li><a href="https://www.microsoft.com/store/apps/9N9TNGVNDL3Q">Ubuntu 18.04 LTS</a></li><li><a href="https://www.microsoft.com/store/apps/9n6svws3rx71">Ubuntu 20.04 LTS</a></li><li><a href="https://www.microsoft.com/store/apps/9NJFZK00FGKV">openSUSE Leap 15.1</a></li><li><a href="https://www.microsoft.com/store/apps/9MZ3D1TRP8T1">SUSE Linux Enterprise Server 12 SP5</a></li><li><a href="https://www.microsoft.com/store/apps/9PN498VPMF3Z">SUSE Linux Enterprise Server 15 SP1</a></li><li><a href="https://www.microsoft.com/store/apps/9PKR34TNCV07">Kali Linux</a></li><li><a href="https://www.microsoft.com/store/apps/9MSVKQC78PK6">Debian GNU/Linux</a></li><li><a href="https://www.microsoft.com/store/apps/9n6gdm4k2hnc">Fedora Remix for WSL</a></li><li><a href="https://www.microsoft.com/store/apps/9NV1GV1PXZ6P">Pengwin</a></li><li><a href="https://www.microsoft.com/store/apps/9N8LP0X93VCP">Pengwin Enterprise</a></li><li><a href="https://www.microsoft.com/store/apps/9p804crf0395">Alpine WSL</a></li></ul></details><ul><li>在分发版的页面中，选择“获取”</li><li>进入到Microsoft Store 获取发行版，我安装成功了的是20.04版</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423145122.png"></p><h4 id="安装-Windows-Terminal-可选"><a href="#安装-Windows-Terminal-可选" class="headerlink" title="安装 Windows Terminal (可选)"></a>安装 Windows Terminal (可选)</h4><blockquote><p>Windows Terminal启用多个选项卡（在多个Linux命令行，Windows命令提示符，PowerShell，Azure CLI等之间快速切换），创建自定义键绑定（用于打开或关闭选项卡的快捷键，复制+粘贴等），使用搜索功能和自定义主题（配色方案，字体样式和大小，背景图像/模糊/透明度）</p></blockquote><p><a href="https://docs.microsoft.com/en-us/windows/terminal/get-started">Install Windows Terminal</a></p><ul><li>和 Xshell 差不多感觉</li></ul><h4 id="测试-Linux"><a href="#测试-Linux" class="headerlink" title="测试 Linux"></a>测试 Linux</h4><ul><li>在Microsoft Store 或开始菜单搜索 Ubuntu 启动 Ubuntu 终端</li></ul><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Installing, this may take <span class="hljs-keyword">a</span> few minutes...<br>Please <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> default UNIX user account. The username does <span class="hljs-keyword">not</span> need <span class="hljs-built_in">to</span> match your Windows username.<br>For more information visit: <span class="hljs-keyword">https</span>://aka.ms/wslusers<br>Enter <span class="hljs-built_in">new</span> UNIX username: zywvvd<br>Enter <span class="hljs-built_in">new</span> UNIX password:<br>Retype <span class="hljs-built_in">new</span> UNIX password:<br>passwd: password updated successfully<br>Installation successful!<br>To run <span class="hljs-keyword">a</span> <span class="hljs-keyword">command</span> <span class="hljs-title">as</span> <span class="hljs-title">administrator</span> (<span class="hljs-title">user</span> <span class="hljs-string">&quot;root&quot;</span>), <span class="hljs-title">use</span> <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br></code></pre></td></tr></table></figure><blockquote><p>说明发行版正常运行</p></blockquote><h4 id="检查发行版WSL版本"><a href="#检查发行版WSL版本" class="headerlink" title="检查发行版WSL版本"></a>检查发行版WSL版本</h4><ul><li>在powershell中输入命令：</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">wsl -l -v</span><br></code></pre></td></tr></table></figure><p>–&gt;</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">C:\Users\<span class="hljs-keyword">Admin</span>&gt; wsl -l -v<br>  <span class="hljs-type">NAME</span>      STATE           <span class="hljs-keyword">VERSION</span><br>* Ubuntu    Running         <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><ul><li>显示VERSION为2，表明WSL2发行版安装成功</li></ul><h3 id="为WSL配置CUDA环境"><a href="#为WSL配置CUDA环境" class="headerlink" title="为WSL配置CUDA环境"></a>为WSL配置CUDA环境</h3><blockquote><p>当前CUDA WSL仅对Ubuntu 做了支持</p><p>恰好我装的发行版是Ubuntu，需要安装 WSL-Ubuntu 的CUDA</p></blockquote><ul><li>当前<strong>支持WSL的CUDA最早版本为11.1</strong></li><li>我安装CUDA成功的发行版是20.04（16.04和18.04均失败了，原因还没有找到）</li></ul><h4 id="Ubuntu-18-04"><a href="#Ubuntu-18-04" class="headerlink" title="Ubuntu 18.04"></a><a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#running-cuda">Ubuntu 18.04</a></h4><ul><li>这个版本受到CUDA官方眷顾，官网直接给出了安装命令</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ apt-key adv --fetch-keys http:<span class="hljs-regexp">//</span>developer.download.nvidia.com<span class="hljs-regexp">/compute/</span>cuda<span class="hljs-regexp">/repos/u</span>buntu1804<span class="hljs-regexp">/x86_64/</span><span class="hljs-number">7</span>fa2af80.pub<br><br>$ sh -c <span class="hljs-string">&#x27;echo &quot;deb http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64 /&quot; &gt; /etc/apt/sources.list.d/cuda.list&#x27;</span><br><br>$ apt-get update<br></code></pre></td></tr></table></figure><ul><li>安装WSL2 的CUDA</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">$ apt-<span class="hljs-builtin-name">get</span> install -y cuda-toolkit-11-0<br></code></pre></td></tr></table></figure><blockquote><p>事实上，我并没有运行成功，所以个人建议用下面的安装方法</p></blockquote><h4 id="Ubuntu-16-04-或其他Ubuntu版本"><a href="#Ubuntu-16-04-或其他Ubuntu版本" class="headerlink" title="Ubuntu 16.04 或其他Ubuntu版本"></a>Ubuntu 16.04 或其他Ubuntu版本</h4><ul><li><p>Nvidia 下载官网 ：</p><p><a href="https://developer.nvidia.cn/zh-cn/cuda-downloads?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=WSLUbuntu&amp;target_version=20&amp;target_type=deblocal">https://developer.nvidia.cn/zh-cn/cuda-downloads?target_os=Linux&amp;target_arch=x86_64&amp;target_distro=WSLUbuntu&amp;target_version=20&amp;target_type=deblocal</a></p></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423105153.png"></p><ul><li>使用命令：</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://developer.download.nvidia.com/compute/cuda/repos/wsl-ubuntu/x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>/cuda-wsl-ubuntu.pin<br><span class="hljs-attribute">sudo</span> mv cuda-wsl-ubuntu.pin /etc/apt/preferences.d/cuda-repository-pin-<span class="hljs-number">600</span><br><span class="hljs-attribute">wget</span> https://developer.download.nvidia.com/compute/cuda/<span class="hljs-number">11</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>/local_installers/cuda-repo-wsl-ubuntu-<span class="hljs-number">11</span>-<span class="hljs-number">1</span>-local_<span class="hljs-number">11</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1</span>_amd<span class="hljs-number">64</span>.deb<br><span class="hljs-attribute">sudo</span> dpkg -i cuda-repo-wsl-ubuntu-<span class="hljs-number">11</span>-<span class="hljs-number">1</span>-local_<span class="hljs-number">11</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1</span>_amd<span class="hljs-number">64</span>.deb<br><span class="hljs-attribute">sudo</span> apt-key add /var/cuda-repo-wsl-ubuntu-<span class="hljs-number">11</span>-<span class="hljs-number">1</span>-local/<span class="hljs-number">7</span>fa<span class="hljs-number">2</span>af<span class="hljs-number">80</span>.pub<br><span class="hljs-attribute">sudo</span> apt-get update<br><span class="hljs-attribute">sudo</span> apt-get -y install cuda<br></code></pre></td></tr></table></figure><ul><li>或下载 runfile(local)</li></ul><blockquote><p>下载完成后</p></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">apt-<span class="hljs-keyword">get</span> install -y gcc g++ make<br>./cuda_11<span class="hljs-number">.1</span><span class="hljs-number">.0</span>_455<span class="hljs-number">.23</span><span class="hljs-number">.05</span>_linux.<span class="hljs-built_in">run</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/images_matrixtime/20210423144039.png"></p><h4 id="测试CUDA"><a href="#测试CUDA" class="headerlink" title="测试CUDA"></a>测试CUDA</h4><blockquote><p>注意此时是没有 nvidia-smi的，因为没有在WSL中安装驱动，驱动是在Win中装的</p></blockquote><ol><li><p>nvcc</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda/</span>bin/nvcc -V<br>nvcc: NVIDIA (R) Cuda compiler driver<br>Copyright (c) <span class="hljs-number">2005</span>-<span class="hljs-number">2020</span> NVIDIA Corporation<br>Built on Tue_Sep_15_19:<span class="hljs-number">10</span>:<span class="hljs-number">02</span>_PDT_2020<br>Cuda compilation tools, release <span class="hljs-number">11.1</span>, V11.<span class="hljs-number">1.74</span><br>Build cuda_11.<span class="hljs-number">1</span>.TC455_06.<span class="hljs-number">29069683</span>_0<br></code></pre></td></tr></table></figure></li><li><p>cuda sample</p><ul><li>使用cuda sample的<code>1_Utilities</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /usr/local/cuda/samples/1_Utilities/deviceQuery<br>sudo make<br>./deviceQuery<br></code></pre></td></tr></table></figure><ul><li>输出</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ./deviceQuery</span><br>./deviceQuery Starting...<br><br> CUDA Device Query (Runtime API) version (CUDART static linking)<br><br>Detected 1 CUDA Capable device(s)<br><br>Device 0: &quot;NVIDIA GeForce GTX 1660&quot;<br>  CUDA Driver Version / Runtime Version          11.4 / 11.1<br>  CUDA Capability Major/Minor version number:    7.5<br>  Total amount of global memory:                 6144 MBytes (6442450944 bytes)<br>  (22) Multiprocessors, ( 64) CUDA Cores/MP:     1408 CUDA Cores<br>  GPU Max Clock rate:                            1860 MHz (1.86 GHz)<br>  Memory Clock rate:                             4001 Mhz<br>  Memory Bus Width:                              192-bit<br>  L2 Cache Size:                                 1572864 bytes<br>  Maximum Texture Dimension Size (x,y,z)         1D=(131072), 2D=(131072, 65536), 3D=(16384, 16384, 16384)<br>  Maximum Layered 1D Texture Size, (num) layers  1D=(32768), 2048 layers<br>  Maximum Layered 2D Texture Size, (num) layers  2D=(32768, 32768), 2048 layers<br>  Total amount of constant memory:               65536 bytes<br>  Total amount of shared memory per block:       49152 bytes<br>  Total shared memory per multiprocessor:        65536 bytes<br>  Total number of registers available per block: 65536<br>  Warp size:                                     32<br>  Maximum number of threads per multiprocessor:  1024<br>  Maximum number of threads per block:           1024<br>  Max dimension size of a thread block (x,y,z): (1024, 1024, 64)<br>  Max dimension size of a grid size    (x,y,z): (2147483647, 65535, 65535)<br>  Maximum memory pitch:                          2147483647 bytes<br>  Texture alignment:                             512 bytes<br>  Concurrent copy and kernel execution:          Yes with 2 copy engine(s)<br>  Run time limit on kernels:                     Yes<br>  Integrated GPU sharing Host Memory:            No<br>  Support host page-locked memory mapping:       Yes<br>  Alignment requirement for Surfaces:            Yes<br>  Device has ECC support:                        Disabled<br>  Device supports Unified Addressing (UVA):      Yes<br>  Device supports Managed Memory:                Yes<br>  Device supports Compute Preemption:            Yes<br>  Supports Cooperative Kernel Launch:            Yes<br>  Supports MultiDevice Co-op Kernel Launch:      No<br>  Device PCI Domain ID / Bus ID / location ID:   0 / 1 / 0<br>  Compute Mode:<br>     &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;<br><br>deviceQuery, CUDA Driver = CUDART, CUDA Driver Version = 11.4, CUDA Runtime Version = 11.1, NumDevs = 1<br>Result = PASS<br></code></pre></td></tr></table></figure></li></ol><h3 id="为WSL安装-nvidia-docker"><a href="#为WSL安装-nvidia-docker" class="headerlink" title="为WSL安装 nvidia-docker"></a><a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#setting-containers">为WSL安装 nvidia-docker</a></h3><h4 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl https://get.docker.com | sh<br></code></pre></td></tr></table></figure><ul><li>检查docker是否安装成功</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker --version</span><br>Docker version 20.10.6, build 370c289<br></code></pre></td></tr></table></figure><h4 id="安装nvidia-docker2"><a href="#安装nvidia-docker2" class="headerlink" title="安装nvidia-docker2"></a>安装nvidia-docker2</h4><blockquote><p>从nvidia-docker2 v2.3和基础运行库（libnvidia-container&gt; = 1.2.0-rc.1）开始，为WSL 2提供支持。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">distribution=$(. /etc/os-release;echo $ID$VERSION_ID)<br><br>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -<br><br>curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list<br><br>curl -s -L https://nvidia.github.io/libnvidia-container/experimental/$distribution/libnvidia-container-experimental.list | sudo tee /etc/apt/sources.list.d/libnvidia-container-experimental.list<br><br>sudo apt-get update<br><br>sudo apt-get install -y nvidia-docker2<br></code></pre></td></tr></table></figure><ul><li>检查nvidia-docker是否安装成功</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$ nvidia-docker <span class="hljs-comment">--version</span><br>Docker <span class="hljs-built_in">version</span> <span class="hljs-number">20.10</span><span class="hljs-number">.6</span>, build <span class="hljs-number">370</span>c289<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://docs.microsoft.com/zh-cn/windows/wsl/">https://docs.microsoft.com/zh-cn/windows/wsl/</a></li><li><a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a></li><li><a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html#abstract">https://docs.nvidia.com/cuda/wsl-user-guide/index.html#abstract</a></li><li><a href="https://developer.nvidia.com/cuda/wsl">https://developer.nvidia.com/cuda/wsl</a></li><li><a href="http://www.xitongtang.com/class/win10/25354.html">http://www.xitongtang.com/class/win10/25354.html</a></li><li><a href="https://blog.csdn.net/huiruwei1020/article/details/107551106?utm_medium=distribute.pc_feed.none-task-blog-personrec_tag-5.nonecase&amp;depth_1-utm_source=distribute.pc_feed.none-task-blog-personrec_tag-5.nonecase&amp;request_id=5f209e2a9cc79f6252ce650a">https://blog.csdn.net/huiruwei1020/article/details/107551106?utm_medium=distribute.pc_feed.none-task-blog-personrec_tag-5.nonecase&amp;depth_1-utm_source=distribute.pc_feed.none-task-blog-personrec_tag-5.nonecase&amp;request_id=5f209e2a9cc79f6252ce650a</a></li><li><a href="https://www.cnblogs.com/xiangsui/p/14258385.html">https://www.cnblogs.com/xiangsui/p/14258385.html</a></li><li><a href="https://blog.csdn.net/fleaxin/article/details/108911522">https://blog.csdn.net/fleaxin/article/details/108911522</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
      <category>WSL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>WSL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WSL 解决 The Windows Subsystem for Linux optional component is not enabled. Please enable it and try again.</title>
    <link href="/2021/04/22/windows/about_wsl/wsl-2/wsl-2/"/>
    <url>/2021/04/22/windows/about_wsl/wsl-2/wsl-2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Windows 10 安装 Linux 子系统时报错的解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>在Microsoft Store 启动Ubuntu 时报错：</p></blockquote><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">Installing, <span class="hljs-keyword">this</span> may take a few minutes...<br>WslRegisterDistribution failed with error: <span class="hljs-number">0x8007019e</span><br>The Windows Subsystem <span class="hljs-keyword">for</span> Linux optional component <span class="hljs-keyword">is</span> not enabled. Please enable it and <span class="hljs-keyword">try</span> again.<br>See https:<span class="hljs-comment">//aka.ms/wslinstall for details.</span><br>Press any key to <span class="hljs-keyword">continue</span>...<br></code></pre></td></tr></table></figure><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="开启子系统支持"><a href="#开启子系统支持" class="headerlink" title="开启子系统支持"></a>开启子系统支持</h4><ul><li><code>控制面板</code> –&gt; <code>程序与功能</code> –&gt; <code>启动或关闭Windows功能</code> 勾选 <code>适用于Linux的Windows子系统</code>，重启即可。</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422112632.png"></p><h4 id="开启-开发者模式"><a href="#开启-开发者模式" class="headerlink" title="开启 开发者模式"></a>开启 开发者模式</h4><p><img src="https://photos.zywvvd.com/images_matrixtime/20210422112927.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_35067322/article/details/104817434">https://blog.csdn.net/qq_35067322/article/details/104817434</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
      <category>WSL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>WSL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>错误 AttributeError type object &#39;Callable&#39; has no attribute &#39;_abc_registry&#39; 解决方案</title>
    <link href="/2021/04/21/python/python-error-abc-registry/python-error-abc-registry/"/>
    <url>/2021/04/21/python/python-error-abc-registry/python-error-abc-registry/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录python错误 <code>AttributeError: type object &#39;Callable&#39; has no attribute &#39;_abc_registry&#39;</code>的解决方案。</p></blockquote><span id="more"></span><h3 id="错误原因"><a href="#错误原因" class="headerlink" title="错误原因"></a>错误原因</h3><blockquote><p>Python升级到3.7后会遇到该问题</p></blockquote><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><blockquote><p>卸载 <code>typing</code></p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">pip uninstall typing</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://stackoverflow.com/questions/55833509/attributeerror-type-object-callable-has-no-attribute-abc-registry">https://stackoverflow.com/questions/55833509/attributeerror-type-object-callable-has-no-attribute-abc-registry</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python CUDA 编程 - 6 - 共享内存</title>
    <link href="/2021/04/21/deep_learning/speed_up/cuda-shared-memory/cuda-shared-memory/"/>
    <url>/2021/04/21/deep_learning/speed_up/cuda-shared-memory/cuda-shared-memory/</url>
    
    <content type="html"><![CDATA[<blockquote><p>CUDA编程中内存分为主机内存（内存条）与设备内存（显存），为提高计算效率，需要设计程序降低内存的数据搬运，或使用快速的内存寄存数据。</p></blockquote><span id="more"></span><h3 id="共享内存"><a href="#共享内存" class="headerlink" title="共享内存"></a>共享内存</h3><blockquote><p>CPU和GPU组成异构计算架构，如果想从内存上优化程序，我们必须尽量减少主机与GPU设备间的数据拷贝，并将更多计算从主机端转移到GPU设备端，我们要尽量在设备端初始化数据，并计算中间数据，并尽量不做无意义的数据回写。</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20210421010630.png" alt="*GPU内存结构*"></p><p>GPU的内存结构如图所示：GPU的计算核心都在Streaming Multiprocessor（SM）上，SM里有计算核心可直接访问的寄存器（Register）和<strong>共享内存（Shared Memory）</strong>；多个SM可以读取显卡上的显存，包括<strong>全局内存（Global Memory）</strong>。</p><p>每个SM上的Shared Memory相当于该SM上的一个缓存，一般都很小，Telsa V100的Shared Memory也只有96KB。注意，Shared Memory和Global Memory的字面上都有共享的意思，但是不要将两者的概念混淆，Shared Memory离计算核心更近，延迟很低；Global Memory是整个显卡上的全局内存，延迟高。</p><p><img src="https://photos.zywvvd.com/image_canglan/20210421010740.png"></p><p>从软件角度来看，CUDA的线程可以访问不同级别的存储，每个Thread有独立的私有内存；每个Block中多个Thread都可以在该Block的Shared Memory中读写数据；整个Grid中所有Thread都可以读写Global Memory。Shared Memory的读写访问速度会远高于Global Memory。内存优化一般主要利用Shared Memory技术。下文将以矩阵乘法为例，展示如何使用Shared Memory来优化程序。</p><h3 id="普通矩阵乘法"><a href="#普通矩阵乘法" class="headerlink" title="普通矩阵乘法"></a>普通矩阵乘法</h3><p><img src="https://photos.zywvvd.com/image_canglan/20210421010824.png"></p><blockquote><p>一个<code>C = AB</code>的矩阵乘法运算，需要我们把A的某一行与B的某一列的所有元素一一相乘，求和后，将结果存储到结果矩阵C的(row, col)上。在这种实现中，每个线程都要读取A的一整行和B的一整列，共计算M行*P列。以计算第row行为例，计算C[row, 0]、C[row, 1]…C[row, p-1]这些点时都需要从显存的Global Memory中把整个第row行读取一遍。可以算到，A矩阵中的每个点需要被读 B.width 次，B矩阵中的每个点需要被读 A.height 次。这样比较浪费时间。因此，可以将多次访问的数据放到Shared Memory中，减少重复读取的次数，并充分利用Shared Memory的延迟低的优势。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> cuda<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time<br><br><span class="hljs-meta">@cuda.jit</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">matmul</span>(<span class="hljs-params">A, B, C</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;  矩阵乘法 C = A * B</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># Numba库提供了更简易的计算方法</span><br>    <span class="hljs-comment"># x, y = cuda.grid(2)</span><br>    <span class="hljs-comment"># 具体计算公式如下</span><br>    row = cuda.threadIdx.x + cuda.blockDim.x * cuda.blockIdx.x<br>    col = cuda.threadIdx.y + cuda.blockDim.y * cuda.blockIdx.y<br>    <br>    <br>    <span class="hljs-keyword">if</span> row &lt; C.shape[<span class="hljs-number">0</span>] <span class="hljs-keyword">and</span> col &lt; C.shape[<span class="hljs-number">1</span>]:<br>        tmp = <span class="hljs-number">0.</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(A.shape[<span class="hljs-number">1</span>]):<br>            tmp += A[row, k] * B[k, col]<br>        C[row, col] = tmp<br>        <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-comment"># 初始化矩阵</span><br>    M = <span class="hljs-number">6000</span><br>    N = <span class="hljs-number">4800</span><br>    P = <span class="hljs-number">4000</span><br>    A = np.random.random((M, N)) <span class="hljs-comment"># 随机生成的 [M x N] 矩阵</span><br>    B = np.random.random((N, P)) <span class="hljs-comment"># 随机生成的 [N x P] 矩阵</span><br>    <br>    start = time()<br>    A = cuda.to_device(A)<br>    B = cuda.to_device(B)<br>    C_gpu = cuda.device_array((M, P))<br><br>    <span class="hljs-comment"># 执行配置</span><br>    threads_per_block = (<span class="hljs-number">16</span>, <span class="hljs-number">16</span>)<br>    blocks_per_grid_x = <span class="hljs-built_in">int</span>(math.ceil(A.shape[<span class="hljs-number">0</span>] / threads_per_block[<span class="hljs-number">0</span>]))<br>    blocks_per_grid_y = <span class="hljs-built_in">int</span>(math.ceil(B.shape[<span class="hljs-number">1</span>] / threads_per_block[<span class="hljs-number">1</span>]))<br>    blocksPerGrid = (blocks_per_grid_x, blocks_per_grid_y)<br>    <br>    <span class="hljs-comment"># 启动核函数</span><br>    matmul[blocksPerGrid, threads_per_block](A, B, C_gpu)<br><br>    <span class="hljs-comment"># 数据拷贝</span><br>    C = C_gpu.copy_to_host()<br>    cuda.synchronize()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gpu matmul time :&quot;</span> + <span class="hljs-built_in">str</span>(time() - start))<br><br>    start = time()<br>    C_cpu = np.empty((M, P), np.<span class="hljs-built_in">float</span>)<br>    np.matmul(A, B, C_cpu)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cpu matmul time :&quot;</span> + <span class="hljs-built_in">str</span>(time() - start))<br><br>    <span class="hljs-comment"># 验证正确性</span><br>    <span class="hljs-keyword">if</span> np.allclose(C_cpu, C):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gpu result correct&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="基于Shared-Memory的矩阵乘法"><a href="#基于Shared-Memory的矩阵乘法" class="headerlink" title="基于Shared Memory的矩阵乘法"></a>基于Shared Memory的矩阵乘法</h3><blockquote><p>接下来的程序利用了Shared Memory来做矩阵乘法。这个实现中，跟未做优化的版本相同的是，每个Thread计算结果矩阵中的一个元素，不同的是，每个CUDA Block会以一个 BLOCK_SIZE * BLOCK_SIZE 子矩阵为基本的计算单元。具体而言，需要声明Shared Memory区域，数据第一次会从Global Memory拷贝到Shared Memory上，接下来可多次重复利用Shared Memory上的数据。</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20210421011058.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> cuda, float32<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># thread per block</span><br><span class="hljs-comment"># 每个block有 BLOCK_SIZE x BLOCK_SIZE 个元素</span><br>BLOCK_SIZE = <span class="hljs-number">16</span><br><br><span class="hljs-meta">@cuda.jit</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">matmul</span>(<span class="hljs-params">A, B, C</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;  矩阵乘法 C = A * B</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    row = cuda.threadIdx.x + cuda.blockDim.x * cuda.blockIdx.x<br>    col = cuda.threadIdx.y + cuda.blockDim.y * cuda.blockIdx.y<br>    <br>    <span class="hljs-keyword">if</span> row &lt; C.shape[<span class="hljs-number">0</span>] <span class="hljs-keyword">and</span> col &lt; C.shape[<span class="hljs-number">1</span>]:<br>        tmp = <span class="hljs-number">0.</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(A.shape[<span class="hljs-number">1</span>]):<br>            tmp += A[row, k] * B[k, col]<br>        C[row, col] = tmp<br><br><span class="hljs-meta">@cuda.jit</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">matmul_shared_memory</span>(<span class="hljs-params">A, B, C</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    使用Shared Memory的矩阵乘法 C = A * B</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 在Shared Memory中定义向量</span><br>    <span class="hljs-comment"># 向量可被整个Block的所有Thread共享</span><br>    <span class="hljs-comment"># 必须声明向量大小和数据类型</span><br>    sA = cuda.shared.array(shape=(BLOCK_SIZE, BLOCK_SIZE), dtype=float32)<br>    sB = cuda.shared.array(shape=(BLOCK_SIZE, BLOCK_SIZE), dtype=float32)<br>    <br>    tx = cuda.threadIdx.x<br>    ty = cuda.threadIdx.y<br>    row = cuda.threadIdx.x + cuda.blockDim.x * cuda.blockIdx.x<br>    col = cuda.threadIdx.y + cuda.blockDim.y * cuda.blockIdx.y<br>    <br>    <span class="hljs-keyword">if</span> row &gt;= C.shape[<span class="hljs-number">0</span>] <span class="hljs-keyword">and</span> col &gt;= C.shape[<span class="hljs-number">1</span>]:<br>        <span class="hljs-comment"># 当(x, y)越界时退出</span><br>        <span class="hljs-keyword">return</span><br><br>    tmp = <span class="hljs-number">0.</span><br>    <span class="hljs-comment"># 以一个 BLOCK_SIZE x BLOCK_SIZE 为单位</span><br>    <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(math.ceil(A.shape[<span class="hljs-number">1</span>] / BLOCK_SIZE)):<br>        sA[tx, ty] = A[row, ty + m * BLOCK_SIZE]<br>        sB[tx, ty] = B[tx + m * BLOCK_SIZE, col]<br>        <span class="hljs-comment"># 线程同步，等待Block中所有Thread预加载结束</span><br>        <span class="hljs-comment"># 该函数会等待所有Thread执行完之后才执行下一步</span><br>        cuda.syncthreads()<br>        <span class="hljs-comment"># 此时已经将A和B的子矩阵拷贝到了sA和sB</span><br><br>        <span class="hljs-comment"># 计算Shared Memory中的向量点积</span><br>        <span class="hljs-comment"># 直接从Shard Memory中读取数据的延迟很低</span><br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(BLOCK_SIZE):<br>            tmp += sA[tx, n] * sB[n, ty]<br><br>        <span class="hljs-comment"># 线程同步，等待Block中所有Thread计算结束</span><br>        cuda.syncthreads()<br><br>    <span class="hljs-comment"># 循环后得到每个BLOCK的点积之和</span><br>    C[row, col] = tmp<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-comment"># 初始化矩阵</span><br>    M = <span class="hljs-number">6000</span><br>    N = <span class="hljs-number">4800</span><br>    P = <span class="hljs-number">4000</span><br>    A = np.random.random((M, N)) <span class="hljs-comment"># 随机生成的 [M x N] 矩阵</span><br>    B = np.random.random((N, P)) <span class="hljs-comment"># 随机生成的 [N x P] 矩阵</span><br><br>    A_device = cuda.to_device(A)<br>    B_device = cuda.to_device(B)<br>    C_device = cuda.device_array((M, P)) <span class="hljs-comment"># [M x P] 矩阵</span><br><br>    <span class="hljs-comment"># 执行配置</span><br>    threads_per_block = (BLOCK_SIZE, BLOCK_SIZE)<br>    blocks_per_grid_x = <span class="hljs-built_in">int</span>(math.ceil(A.shape[<span class="hljs-number">0</span>] / BLOCK_SIZE))<br>    blocks_per_grid_y = <span class="hljs-built_in">int</span>(math.ceil(B.shape[<span class="hljs-number">1</span>] / BLOCK_SIZE))<br>    blocks_per_grid = (blocks_per_grid_x, blocks_per_grid_y)<br><br>    start = time()<br>    matmul[blocks_per_grid, threads_per_block](A_device, B_device, C_device)<br>    cuda.synchronize()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;matmul time :&quot;</span> + <span class="hljs-built_in">str</span>(time() - start))<br><br>    start = time()<br>    matmul_shared_memory[blocks_per_grid, threads_per_block](A_device, B_device, C_device)<br>    cuda.synchronize()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;matmul with shared memory time :&quot;</span> + <span class="hljs-built_in">str</span>(time() - start))<br>    C = C_device.copy_to_host()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>进行Shared Memory优化后，计算部分的耗时减少了近一半：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">matmul</span> time :<span class="hljs-number">1</span>.<span class="hljs-number">4370720386505127</span><br><span class="hljs-attribute">matmul</span> with shared memory time :<span class="hljs-number">0</span>.<span class="hljs-number">7994928359985352</span><br></code></pre></td></tr></table></figure><h3 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h3><ol><li>声明Shared Memory。这里使用了<code>cuda.shared.array(shape,type)</code>，<code>shape</code>为这块数据的向量维度大小，<code>type</code>为Numba数据类型，例如是int32还是float32。这个函数只能在设备端使用。定义好后，这块数据可被同一个Block的所有Thread共享。需要注意的是，这块数据虽然在核函数中定义，但它不是单个Thread的私有数据，<strong>它可被同Block中的所有Thread读写</strong>。</li><li>数据加载。每个Thread会将A中的一个元素加载到sA中，一个Block的 BLOCK_SIZE x BLOCK_SIZE 个Thread可以把sA填充满。<code>cuda.syncthreads()</code>会等待Block中所有Thread执行完之后才执行下一步。所以，当执行完这个函数的时候，sA和sB的数据已经拷贝好了。</li><li>数据复用。A中的某个点，只会被读取 B.width / BLOCK_SIZE 次；B中的某个点，只会被读 A.height / BLOCK_SIZE 次。<code>for n in range(BLOCK_SIZE)</code>这个循环做子矩阵向量乘法时，可多次复用sA和sB的数据。</li><li>子矩阵的数据汇总。我们以一个 BLOCK_SIZE x BLOCK_SIZE 的子矩阵为单位分别对A从左到右，对B从上到下平移并计算，共循环 A.width / BLOCK_SIZE 次。在某一步平移，会得到子矩阵的点积。<code>for m in range(math.ceil(A.shape[1] / BLOCK_SIZE))</code>这个循环起到了计算A从左到右与B从上到下点积的过程。</li></ol><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://lulaoshi.info/gpu/python-cuda/shared-memory.html">https://lulaoshi.info/gpu/python-cuda/shared-memory.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 10 安装 mmcv 1.2.7 踩坑</title>
    <link href="/2021/04/20/deep_learning/windows-mmcv-1-2-7-install/windows-mmcv-1-2-7-install/"/>
    <url>/2021/04/20/deep_learning/windows-mmcv-1-2-7-install/windows-mmcv-1-2-7-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>商汤科技的 <a href="https://openmmlab.com/">open-mmlab</a> 是集成当前优秀深度学习成果的基于 python pytorch 的集成平台，功能强大，配置化工程。mmcv是其中重要的组件库，linux安装相对方便，Windows支持得不是很友好，本文记录Win10 安装mmcv踩坑过程。</p></blockquote><span id="more"></span><h3 id="MMCV"><a href="#MMCV" class="headerlink" title="MMCV"></a>MMCV</h3><ul><li><p><a href="https://download.openmmlab.com/mmcv/dist/index.html">whl 包下载链接</a></p></li><li><p><a href="https://github.com/open-mmlab/mmcv">github 链接</a></p></li><li><p>mmcv 是一个基础库，主要分为两个部分，一部分是和 deep learning framework 无关的一些工具函数，比如 IO/Image/Video 相关的一些操作，另一部分是为 PyTorch 写的一套训练工具，可以大大减少用户需要写的代码量，同时让整个流程的定制变得容易。 </p></li><li><p>官方介绍：</p></li></ul><blockquote><p>MMCV is a foundational library for computer vision research and supports many research projects as below:</p><ul><li><a href="https://github.com/open-mmlab/mmdetection">MMDetection</a>: Detection toolbox and benchmark</li><li><a href="https://github.com/open-mmlab/mmdetection3d">MMDetection3D</a>: General 3D object detection toolbox and benchmark</li><li><a href="https://github.com/open-mmlab/mmsegmentation">MMSegmentation</a>: Semantic segmentation toolbox and benchmark</li><li><a href="https://github.com/open-mmlab/mmediting">MMEditing</a>: Image and video editing toolbox</li><li><a href="https://github.com/open-mmlab/mmpose">MMPose</a>: Pose estimation toolbox and benchmark</li><li><a href="https://github.com/open-mmlab/mmaction2">MMAction2</a>: Action understanding toolbox and benchmark</li><li><a href="https://github.com/open-mmlab/mmtracking">MMTracking</a>: Video perception toolbox and benchmark</li><li><a href="https://github.com/open-mmlab/mmclassification">MMClassification</a>: Image classification toolbox and benchmark</li><li><a href="https://github.com/open-mmlab/mmocr">MMOCR</a>: A Comprehensive Toolbox for Text Detection, Recognition and Understanding</li></ul><p>It provides the following functionalities.</p><ul><li>Universal IO APIs</li><li>Image/Video processing</li><li>Image and annotation visualization</li><li>Useful utilities (progress bar, timer, …)</li><li>PyTorch runner with hooking mechanism</li><li>Various CNN architectures</li><li>High-quality implementation of common CUDA ops</li></ul></blockquote><ul><li>但是在Windows上安装mmcv真的全是坑</li></ul><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><table><thead><tr><th>条目</th><th>内容</th></tr></thead><tbody><tr><td>操作系统</td><td>Windows 10</td></tr><tr><td>显卡型号</td><td>GTX 1660</td></tr><tr><td>显卡驱动</td><td>456.71</td></tr><tr><td>CUDA</td><td>10.1</td></tr><tr><td>cuDNN</td><td>8.0.3</td></tr><tr><td>torch 版本</td><td>1.7.0</td></tr><tr><td>torchvision 版本</td><td>0.8.0</td></tr><tr><td>visual studio</td><td>2019</td></tr><tr><td>cl.exe 版本</td><td>19.28.29914</td></tr><tr><td><strong>目标mmcv版本</strong></td><td>1.2.7</td></tr></tbody></table><blockquote><p>这些都是我们的目标，慢慢装不着急</p></blockquote><h3 id="基础安装过程"><a href="#基础安装过程" class="headerlink" title="基础安装过程"></a>基础安装过程</h3><h4 id="显卡驱动-CUDA-cuDNN"><a href="#显卡驱动-CUDA-cuDNN" class="headerlink" title="显卡驱动-CUDA-cuDNN"></a>显卡驱动-CUDA-cuDNN</h4><ul><li>参考：<a href="https://www.zywvvd.com/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/">https://www.zywvvd.com/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/</a></li></ul><h4 id="安装-visual-studio-2019"><a href="#安装-visual-studio-2019" class="headerlink" title="安装 visual studio 2019"></a>安装 visual studio 2019</h4><ul><li>下载：<a href="https://visualstudio.microsoft.com/zh-hans/vs/">https://visualstudio.microsoft.com/zh-hans/vs/</a></li><li>下载后安装  visual studio 2019 professional C++ 桌面开发组件</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210420210601.png"></p><ul><li>将<code>E:\Program Files (x86)\Microsoft Visual Studio\2019\Professional\VC\Tools\MSVC\14.28.29910\bin\Hostx64\x64</code>添加到环境变量 Path 中</li><li>在cmd中输入<code>cl</code></li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">C:\Users\Admin&gt;cl<br>用于 x64 的 Microsoft <span class="hljs-params">(R)</span> C/C++ 优化编译器 19.28.29914 版<br>版权所有<span class="hljs-params">(C)</span> Microsoft Corporation。保留所有权利。<br><br>用法: cl [ 选项<span class="hljs-string">...</span> ] 文件名<span class="hljs-string">...</span> [ <span class="hljs-string">/link</span> 链接选项<span class="hljs-string">...</span> ]<br></code></pre></td></tr></table></figure><blockquote><p>目的就是使用这个 cl.exe</p></blockquote><h4 id="安装torch和torchvision"><a href="#安装torch和torchvision" class="headerlink" title="安装torch和torchvision"></a>安装torch和torchvision</h4><ul><li>下载官网：<a href="https://pytorch.org/get-started/previous-versions/">https://pytorch.org/get-started/previous-versions/</a></li><li>历史版本：<a href="https://download.pytorch.org/whl/torch_stable.html">https://download.pytorch.org/whl/torch_stable.html</a></li><li>选择合适自己的命令</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210420210656.png"></p><ul><li>测试</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">C:\Users\Admin&gt;pip show torch<br>Name: torch<br>Version: 1.7.0<br>Summary: Tensors and Dynamic neural networks in Python with strong GPU acceleration<br>Home-page: https://pytorch.org/<br>Author: PyTorch Team<br>Author-email: packages@pytorch.org<br>License: BSD-3<br>Location: e:\program_files\annoconda\envs\purple\lib\site-packages<br>Requires: future, typing-extensions, dataclasses, numpy<br>Required-by: torchvision, torchaudio<br><br><br>C:\Users\Admin&gt;pip show torchvision<br>Name: torchvision<br>Version: 0.8.0<br>Summary: image and video datasets and models for torch deep learning<br>Home-page: https://github.com/pytorch/vision<br>Author: PyTorch Core Team<br>Author-email: soumith@pytorch.org<br>License: BSD<br>Location: e:\program_files\annoconda\envs\purple\lib\site-packages<br>Requires: numpy, torch, pillow<br>Required-by:<br></code></pre></td></tr></table></figure><h4 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h4><table><thead><tr><th>变量名称</th><th>变量值</th></tr></thead><tbody><tr><td>MMCV_WITH_OPS</td><td>1</td></tr><tr><td>MAX_JOBS</td><td>8</td></tr><tr><td>CUDA_HOME</td><td>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.1\</td></tr><tr><td>TORCH_CUDA_ARCH_LIST</td><td>6.1 # 支持 GTX 1080 1660</td></tr></tbody></table><h4 id="下载mmcv源码"><a href="#下载mmcv源码" class="headerlink" title="下载mmcv源码"></a>下载mmcv源码</h4><ul><li>链接：<a href="https://github.com/open-mmlab/mmcv">https://github.com/open-mmlab/mmcv</a></li><li>clone 到本地后切换到 1.2.7版本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout v1.2.7<br></code></pre></td></tr></table></figure><h4 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h4><ul><li><p>直接 pip install 安装的mmcv-full没有c++编译的文件，会报出<code>No module named &#39;mmcv._ext&#39;</code>的错误</p></li><li><p>所以我们需要老老实实编译安装mmcv</p></li><li><p>编译cpp文件并链接</p></li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> build_ext # 如果成功, <span class="hljs-keyword">cl</span> 将会自动弹出来编译 flow_warp<br><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> develop # 安装<br></code></pre></td></tr></table></figure><h3 id="踩坑安装"><a href="#踩坑安装" class="headerlink" title="踩坑安装"></a>踩坑安装</h3><blockquote><p>讲道理这么复杂的环境配置已经足够折磨人了，但是在编译过程中也会冒出层出不穷、连绵不绝、匪夷所思的错误</p></blockquote><h4 id="错误-calling-a-host-function-“-floorf”-from-a-device-function-“deformable-im2col-bilinear-lt-float-gt-“-is-not-allowed"><a href="#错误-calling-a-host-function-“-floorf”-from-a-device-function-“deformable-im2col-bilinear-lt-float-gt-“-is-not-allowed" class="headerlink" title="错误  calling a host function(“__floorf”) from a device function(“deformable_im2col_bilinear&lt; float &gt; “) is not allowed"></a>错误  calling a <strong>host</strong> function(“__floorf”) from a <strong>device</strong> function(“deformable_im2col_bilinear&lt; float &gt; “) is not allowed</h4><h4 id="错误-calling-a-host-function-“-ceilf”-from-a-global-function-“deform-roi-pool-forward-cuda-kernel-lt-float-gt-“-is-not-allowed"><a href="#错误-calling-a-host-function-“-ceilf”-from-a-global-function-“deform-roi-pool-forward-cuda-kernel-lt-float-gt-“-is-not-allowed" class="headerlink" title="错误  calling a host function(“__ceilf”) from a global function(“deform_roi_pool_forward_cuda_kernel&lt; float &gt; “) is not allowed"></a>错误  calling a <strong>host</strong> function(“__ceilf”) from a <strong>global</strong> function(“deform_roi_pool_forward_cuda_kernel&lt; float &gt; “) is not allowed</h4><ul><li><p>看到上述两个错误去找mmcv源码中对应的行</p></li><li><p>不要取找torch代码中报错对应的行</p></li><li><p>错误原因是cuda与cpu编程时函数名不一样</p></li><li><p>将报错文件中的 <code>floor</code> 替换为 <code>floorf</code> </p></li><li><p>将报错文件中的 <code>ceil</code> 替换为 <code>ceilf</code> </p></li><li><p>具体有以下文件：</p></li></ul><table><thead><tr><th>需要修改的文件</th></tr></thead><tbody><tr><td>mmcv\mmcv\ops\csrc\deform_conv_cuda_kernel.cuh</td></tr><tr><td>mmcv\mmcv\ops\csrc\deform_roi_pool_cuda_kernel.cuh</td></tr><tr><td>mmcv\mmcv\ops\csrc\modulated_deform_conv_cuda_kernel.cuh</td></tr><tr><td>mmcv\mmcv\ops\csrc\roi_align_cuda_kernel.cuh</td></tr><tr><td>mmcv\mmcv\ops\csrc\roi_pool_cuda_kernel.cuh</td></tr></tbody></table><h4 id="错误-subprocess-CalledProcessError-Command-‘-‘ninja’-‘-v’-‘-j’-‘8’-’-returned-non-zero-exit-status-1"><a href="#错误-subprocess-CalledProcessError-Command-‘-‘ninja’-‘-v’-‘-j’-‘8’-’-returned-non-zero-exit-status-1" class="headerlink" title="错误 subprocess.CalledProcessError: Command ‘[‘ninja’, ‘-v’, ‘-j’, ‘8’]’ returned non-zero exit status 1."></a>错误 subprocess.CalledProcessError: Command ‘[‘ninja’, ‘-v’, ‘-j’, ‘8’]’ returned non-zero exit status 1.</h4><h4 id="错误-subprocess-CalledProcessError-Command-‘-‘ninja’-‘-v’-’-returned-non-zero-exit-status-1"><a href="#错误-subprocess-CalledProcessError-Command-‘-‘ninja’-‘-v’-’-returned-non-zero-exit-status-1" class="headerlink" title="错误 subprocess.CalledProcessError: Command ‘[‘ninja’, ‘-v’]’ returned non-zero exit status 1."></a>错误 subprocess.CalledProcessError: Command ‘[‘ninja’, ‘-v’]’ returned non-zero exit status 1.</h4><ul><li>上述两个错误是因为 <code>ninja</code> 库输出版本的命令是</li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">ninja <span class="hljs-comment">--version</span><br></code></pre></td></tr></table></figure><ul><li>因此解决方案是进入到 <code>Annoconda\lib\site-packages\torch\utils\cpp_extension.py</code> 文件中，在 1500 行附近，将<code>[&#39;ninja&#39;, &#39;-v&#39;]</code>改为<code>[&#39;ninja&#39;, &#39;--version&#39;]</code></li></ul><h4 id="错误-member-“torch-jit-ProfileOptionalOp-Kind”-may-not-be-initialized"><a href="#错误-member-“torch-jit-ProfileOptionalOp-Kind”-may-not-be-initialized" class="headerlink" title="错误 member “torch::jit::ProfileOptionalOp::Kind” may not be initialized"></a>错误 member “torch::jit::ProfileOptionalOp::Kind” may not be initialized</h4><ul><li>到现在我也没有找到这个问题的原因，也没有解决</li><li>但是这个错误在使用ninja编译文件时不会报出来</li></ul><h4 id="错误-error-a-member-with-an-in-class-initializer-must-be-const"><a href="#错误-error-a-member-with-an-in-class-initializer-must-be-const" class="headerlink" title="错误 error: a member with an in-class initializer must be const"></a>错误 error: a member with an in-class initializer must be const</h4><ul><li>我是在<code>Lib\site-packages\torch\include\torch\csrc\jit\api\module.h</code>中报错</li><li>解决方案是<strong>将报错位置的 static 改为 const</strong></li></ul><h4 id="错误-Error-checking-compiler-version-for-cl-‘utf-8’-codec-can’t-decode-byte-0xd3-in-position-0-invalid-continuation-byte"><a href="#错误-Error-checking-compiler-version-for-cl-‘utf-8’-codec-can’t-decode-byte-0xd3-in-position-0-invalid-continuation-byte" class="headerlink" title="错误 Error checking compiler version for cl: ‘utf-8’ codec can’t decode byte 0xd3 in position 0: invalid continuation byte"></a>错误 Error checking compiler version for cl: ‘utf-8’ codec can’t decode byte 0xd3 in position 0: invalid continuation byte</h4><ul><li>不用管，语言不通，系统 utf-8 微软让 cl.exe 用 gbk 了，不影响正常编译</li></ul><h4 id="编译文件不完整"><a href="#编译文件不完整" class="headerlink" title="编译文件不完整"></a>编译文件不完整</h4><ul><li>默认命令行会使用 ninja 多核并行编译，可以编译出来很多文件</li><li>如果有文件想单独编译，可以进入 <code>Lib\site-packages\torch\utils\cpp_extension.py</code> 文件的第335行</li><li>加入一句：</li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">self.use_ninja</span> = <span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><ul><li>编译程序会一个一个编译，也可以找到编译的循环，选择自己想要编译的文件进行编译，从而得到完整的obj文件套装</li></ul><h3 id="编译完成的文件"><a href="#编译完成的文件" class="headerlink" title="编译完成的文件"></a>编译完成的文件</h3><ul><li>分享我千辛万苦编译出来的结果</li></ul><table><thead><tr><th>运行方式</th><th>下载链接</th></tr></thead><tbody><tr><td>gpu 版</td><td><a href="https://photos.zywvvd.com/images_matrixtime/20210421100448.pyd">https://photos.zywvvd.com/images_matrixtime/20210421100448.pyd</a></td></tr><tr><td>cpu 版</td><td><a href="https://photos.zywvvd.com/images_matrixtime/20210421144546.pyd">https://photos.zywvvd.com/images_matrixtime/20210421144546.pyd</a></td></tr></tbody></table><ul><li>将文件重命名为<code>_ext.cp37-win_amd64.pyd</code>放在安装好的 mmcv-full 包内</li></ul><blockquote><p>也就是说，在没有这个文件时，你运行mmdet会报错<code>No module named &#39;mmcv._ext&#39;</code></p><p>此时把这个文件放上</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210421100708.png"></p><ul><li>之后就可以正常使用mmcv了</li><li><strong>注意：GPU版的pyd文件一定要在 <code>CUDA 10.1</code> ，<code>mmcv 1.2.7</code>， <code>torch 1.7.0</code>， <code>torchvision 0.8.0</code> 的环境下才<code>有可能</code>可用</strong></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://zhuanlan.zhihu.com/p/126725557">https://zhuanlan.zhihu.com/p/126725557</a></p></li><li><p><a href="https://blog.csdn.net/flying_ant2018/article/details/105069608">https://blog.csdn.net/flying_ant2018/article/details/105069608</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/308281195?utm_source=wechat_session">https://zhuanlan.zhihu.com/p/308281195?utm_source=wechat_session</a></p></li><li><p><a href="https://blog.csdn.net/baobei0112/article/details/114521271">https://blog.csdn.net/baobei0112/article/details/114521271</a></p></li><li><p><a href="https://blog.csdn.net/weixin_44313626/article/details/114778118">https://blog.csdn.net/weixin_44313626/article/details/114778118</a></p></li><li><p><a href="https://pytorch.org/get-started/locally/">https://pytorch.org/get-started/locally/</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/340973730">https://zhuanlan.zhihu.com/p/340973730</a></p></li><li><p><a href="https://ask.csdn.net/questions/1452822">https://ask.csdn.net/questions/1452822</a></p></li><li><p><a href="https://github.com/open-mmlab/mmcv">https://github.com/open-mmlab/mmcv</a></p></li><li><p><a href="https://blog.csdn.net/baidu_33008169/article/details/115568783">https://blog.csdn.net/baidu_33008169/article/details/115568783</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python CUDA 编程 - 5 - 多流</title>
    <link href="/2021/04/19/deep_learning/speed_up/cuda-multistream/cuda-multistream/"/>
    <url>/2021/04/19/deep_learning/speed_up/cuda-multistream/cuda-multistream/</url>
    
    <content type="html"><![CDATA[<blockquote><p>之前讨论的并行，都是线程级别的，即CUDA开启多个线程，并行执行核函数内的代码。GPU最多就上千个核心，同一时间只能并行执行上千个任务。当我们处理千万级别的数据，整个大任务无法被GPU一次执行，所有的计算任务需要放在一个队列中，排队顺序执行。CUDA将放入队列顺序执行的一系列操作称为流（Stream）。</p></blockquote><span id="more"></span><h3 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h3><p>由于异构计算的硬件特性，CUDA中以下操作是相互独立的，通过编程，是可以操作他们并发地执行的：</p><ul><li>主机端上的计算</li><li>设备端的计算（核函数）</li><li>数据从主机和设备间相互拷贝</li><li>数据从设备内拷贝或转移</li><li>数据从多个GPU设备间拷贝或转移</li></ul><p>针对这种互相独立的硬件架构，CUDA使用<strong>多流</strong>作为一种高并发的方案：</p><ul><li>把一个大任务中的上述几部分拆分开，放到多个流中，每次只对一部分数据进行拷贝、计算和回写，并把这个流程做成流水线。</li><li>因为数据拷贝不占用计算资源，计算不占用数据拷贝的总线（Bus）资源，因此计算和数据拷贝完全可以并发执行。</li><li>如图所示，将数据拷贝和函数计算<strong>重叠</strong>起来的，形成流水线，能获得非常大的性能提升。</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210420001828.png"></p><blockquote><p>实际上，流水线作业的思想被广泛应用于CPU和GPU等计算机芯片设计上，以加速程序。</p></blockquote><h3 id="多流"><a href="#多流" class="headerlink" title="多流"></a>多流</h3><p>以向量加法为例，上图中第一行的Stream 0部分是我们之前的逻辑，没有使用多流技术，程序的三大步骤是顺序执行的：</p><ol><li><p>先从主机拷贝初始化数据到设备（Host To Device）；</p></li><li><p>在设备上执行核函数（Kernel）；</p></li><li><p>将计算结果从设备拷贝回主机（Device To Host）。</p></li></ol><p>当数据量很大时，每个步骤的耗时很长，后面的步骤必须等前面执行完毕才能继续，整体的耗时相当长。</p><blockquote><p>以2000万维的向量加法为例，向量大约有几十M大小，将整个向量在主机和设备间拷贝将占用占用上百毫秒的时间，有可能远比核函数计算的时间多得多。将程序改为多流后，每次只计算一小部分，流水线并发执行，会得到非常大的性能提升。</p></blockquote><h4 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h4><p>默认情况下，CUDA使用0号流，又称默认流。不使用多流时，所有任务都在默认流中顺序执行，效率较低。在使用多流之前，必须先了解多流的一些规则：</p><ul><li>给定流内的所有操作会按序执行。</li><li>非默认流之间的不同操作，无法保证其执行顺序。</li><li>所有非默认流执行完后，才能执行默认流；默认流执行完后，才能执行其他非默认流。</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210420002151.png"></p><p>参照上图，可将这三个规则解释为：</p><ul><li>非默认流1中，根据进流的先后顺序，核函数1和2是顺序执行的。</li><li>无法保证核函数2与核函数4的执行先后顺序，因为他们在不同的流中。他们执行的开始时间依赖于该流中前一个操作结束时间，例如核函数2的开始依赖于核函数1的结束，与核函数3、4完全不相关。</li><li>默认流有阻塞的作用。如图中红线所示，如果调用默认流，那么默认流会等非默认流都执行完才能执行；同样，默认流执行完，才能再次执行其他非默认流。</li></ul><p><strong>某个流内的操作是顺序的，非默认流之间是异步的，默认流有阻塞作用</strong>。</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote><p>如果想使用多流时，必须先定义流：</p></blockquote><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs glsl"><span class="hljs-keyword">stream</span> = numba.cuda.<span class="hljs-keyword">stream</span>()<br></code></pre></td></tr></table></figure><p>CUDA的数据拷贝以及核函数都有专门的<code>stream</code>参数来接收流，以告知该操作放入哪个流中执行：</p><ul><li><code>numba.cuda.to_device(obj, stream=0, copy=True, to=None)</code></li><li><code>numba.cuda.copy_to_host(self, ary=None, stream=0)</code></li></ul><p>核函数调用的地方除了要写清执行配置，还要加一项<code>stream</code>参数：</p><ul><li><code>kernel[blocks_per_grid, threads_per_block, stream=0]</code></li></ul><p>根据这些函数定义也可以知道，不指定<code>stream</code>参数时，这些函数都使用默认的0号流。</p><p>对于程序员来说，需要将数据和计算做拆分，分别放入不同的流里，构成一个流水线操作。</p><p>将之前的向量加法的例子改为多流处理，完整的代码为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> cuda<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time<br><br><span class="hljs-meta">@cuda.jit</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">vector_add</span>(<span class="hljs-params">a, b, result, n</span>):</span><br>    idx = cuda.threadIdx.x + cuda.blockDim.x * cuda.blockIdx.x<br>    <span class="hljs-keyword">if</span> idx &lt; n :<br>        result[idx] = a[idx] + b[idx]<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    n = <span class="hljs-number">20000000</span><br>    x = np.random.uniform(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,n)<br>    y = np.random.uniform(<span class="hljs-number">10</span>,<span class="hljs-number">20</span>,n)<br>    <span class="hljs-comment"># x = np.arange(n).astype(np.int32)</span><br>    <span class="hljs-comment"># y = 2 * x</span><br><br>    start = time()<br>    <span class="hljs-comment"># 使用默认流</span><br>    <span class="hljs-comment"># Host To Device</span><br>    x_device = cuda.to_device(x)<br>    y_device = cuda.to_device(y)<br>    z_device = cuda.device_array(n)<br>    z_streams_device = cuda.device_array(n)<br><br>    threads_per_block = <span class="hljs-number">1024</span><br>    blocks_per_grid = math.ceil(n / threads_per_block)<br><br>    <span class="hljs-comment"># Kernel</span><br>    vector_add[blocks_per_grid, threads_per_block](x_device, y_device, z_device, n)<br>    <br>    <span class="hljs-comment"># Device To Host</span><br>    default_stream_result = z_device.copy_to_host()<br>    cuda.synchronize()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gpu vector add time &quot;</span> + <span class="hljs-built_in">str</span>(time() - start))<br><br>    start = time()<br><br>    <span class="hljs-comment"># 使用5个流</span><br>    number_of_streams = <span class="hljs-number">5</span><br>    <span class="hljs-comment"># 每个流处理的数据量为原来的 1/5</span><br>    <span class="hljs-comment"># 符号//得到一个整数结果</span><br>    segment_size = n // number_of_streams<br><br>    <span class="hljs-comment"># 创建5个cuda stream</span><br>    stream_list = <span class="hljs-built_in">list</span>()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span> (<span class="hljs-number">0</span>, number_of_streams):<br>        stream = cuda.stream()<br>        stream_list.append(stream)<br><br>    threads_per_block = <span class="hljs-number">1024</span><br>    <span class="hljs-comment"># 每个stream的处理的数据变为原来的1/5</span><br>    blocks_per_grid = math.ceil(segment_size / threads_per_block)<br>    streams_result = np.empty(n)<br><br>    <span class="hljs-comment"># 启动多个stream</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, number_of_streams):<br>        <span class="hljs-comment"># 传入不同的参数，让函数在不同的流执行</span><br>        <br>        <span class="hljs-comment"># Host To Device</span><br>        x_i_device = cuda.to_device(x[i * segment_size : (i + <span class="hljs-number">1</span>) * segment_size], stream=stream_list[i])<br>        y_i_device = cuda.to_device(y[i * segment_size : (i + <span class="hljs-number">1</span>) * segment_size], stream=stream_list[i])<br><br>        <span class="hljs-comment"># Kernel</span><br>        vector_add[blocks_per_grid, threads_per_block, stream_list[i]](<br>                x_i_device,<br>                y_i_device,<br>                z_streams_device[i * segment_size : (i + <span class="hljs-number">1</span>) * segment_size],<br>                segment_size)<br><br>        <span class="hljs-comment"># Device To Host</span><br>        streams_result[i * segment_size : (i + <span class="hljs-number">1</span>) * segment_size] = z_streams_device[i * segment_size : (i + <span class="hljs-number">1</span>) * segment_size].copy_to_host(stream=stream_list[i])<br><br>    cuda.synchronize()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;gpu streams vector add time &quot;</span> + <span class="hljs-built_in">str</span>(time() - start))<br><br>    <span class="hljs-keyword">if</span> (np.array_equal(default_stream_result, streams_result)):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;result correct&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><blockquote><p>运行结果：</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">gpu</span> vector add time <span class="hljs-number">7</span>.<span class="hljs-number">996402740478516</span><br><span class="hljs-attribute">gpu</span> streams vector add time <span class="hljs-number">0</span>.<span class="hljs-number">3867764472961426</span><br></code></pre></td></tr></table></figure><blockquote><p>多流不仅需要程序员掌握流水线思想，还需要用户对数据和计算进行拆分，并编写更多的代码，但是收益非常明显。对于计算密集型的程序，这种技术非常值得认真研究。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://lulaoshi.info/gpu/python-cuda/streams.html">https://lulaoshi.info/gpu/python-cuda/streams.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python CUDA 编程 - 4 - 网格跨步</title>
    <link href="/2021/04/19/deep_learning/speed_up/cuda-grid-step/cuda-grid-step/"/>
    <url>/2021/04/19/deep_learning/speed_up/cuda-grid-step/cuda-grid-step/</url>
    
    <content type="html"><![CDATA[<blockquote><p>当核心数量不够或想限制当前任务使用的GPU核心数时可以使用网格跨步的思路编写CUDA程序。</p></blockquote><span id="more"></span><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><blockquote><p>CUDA的执行配置：<code>[gridDim, blockDim]</code>中的<code>blockDim</code>最大只能是1024，但是并没提到<code>gridDim</code>的最大限制。英伟达给出的官方回复是gridDim最大为一个32位整数的最大值，也就是2,147,483,648，大约二十亿。这个数字已经非常大了，足以应付绝大多数的计算，但是如果对并行计算的维度有更高需求呢？答案是网格跨步，它能提供更优的并行计算效率。</p></blockquote><h3 id="网格跨步"><a href="#网格跨步" class="headerlink" title="网格跨步"></a>网格跨步</h3><p><img src="https://photos.zywvvd.com/image_canglan/20210419235044.png" alt="假如我们需要并行度为32，但只有8个Thread，并行度大于线程数"></p><ul><li>这里仍然以<code>[2, 4]</code>的执行配置为例，该执行配置中整个grid只能并行启动8个线程，假如我们要并行计算的数据是32，会发现后面8号至31号数据共计24个数据无法被计算。</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210419235647.png" alt="使用网格跨步解决上述问题，0号线程执行第0、8、16、24号数据"></p><ul><li>我们可以在0号线程中，处理第0、8、16、24号数据，这样就能解决数据远大于执行配置中的线程总数的问题，用程序表示，就是在核函数里再写个for循环。</li></ul><h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ol><li>扩展性：可以解决数据量比线程数大的问题</li><li>线程复用：CUDA线程启动和销毁都有开销，主要是线程内存空间初始化的开销；不使用网格跨步，CUDA需要启动大于计算数的线程，每个线程内只做一件事情，做完就要被销毁；使用网格跨步，线程内有<code>for</code>循环，每个线程可以干更多事情，所有线程的启动销毁开销更少。</li><li>方便调试：我们可以把核函数的执行配置写为<code>[1, 1]</code>，如下所示，那么核函数的跨步大小就成为了1，核函数里的<code>for</code>循环与CPU函数中顺序执行的<code>for</code>循环的逻辑一样，非常方便验证CUDA并行计算与原来的CPU函数计算逻辑是否一致。</li></ol><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://lulaoshi.info/gpu/python-cuda/stride.html">https://lulaoshi.info/gpu/python-cuda/stride.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - mmap 共享内存</title>
    <link href="/2021/04/19/python/python-memory-share/python-memory-share/"/>
    <url>/2021/04/19/python/python-memory-share/python-memory-share/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在程序运行过程中，可能遇到需要进程间或不同平台的语言之间进行信息交互，存在硬盘是一种解决方案但是速度太慢。python的mmap库提供了共享内存的实践方案可以完成信息在内存间交互。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><h4 id="共享内存"><a href="#共享内存" class="headerlink" title="共享内存"></a>共享内存</h4><blockquote><p>内存共享是两个不同的进程共享内存的意思：同一块物理内存被映射到两个进程的各自的进程地址空间。这个物理内存已经被规定了大小（大小一定要比实际写入的东东大）以及名称。当需要写入时，找到内存名称，然后写入内存，等需要读取时候， 首先要知道你要读取多大（因为物理内存比你要读取的东东大，全部读取的话会读到一些“空”的东西），然后寻找对应名称的物理块，然后读取，就是这么简单。</p></blockquote><h4 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h4><blockquote><p>mmap是一种虚拟内存映射文件的方法，即将一个文件或者其它对象映射到进程的地址空间，实现文件磁盘地址和进程虚拟地址空间中一段虚拟地址的一一对映关系。关于系统中mmap的理论说明可以看<a href="http://baike.baidu.com/link?url=Kqpi1-pKjcYICdf0v3nRaaVs5_bnqG6tIDDeuEF_KeC-6840A-Ol9rcxz1ZJ_WSTaSb7SlmD6ipKlxGjHse_a_">百度百科</a>和<a href="https://en.wikipedia.org/wiki/Mmap">维基百科</a>说明以及<a href="http://www.cnblogs.com/xmphoenix/archive/2011/08/20/2146938.html">mmap函数介绍</a>，这里的说明是针对在Python下mmap块的使用说明。</p></blockquote><ul><li>官网文档：<a href="https://docs.python.org/2/library/mmap.html">https://docs.python.org/2/library/mmap.html</a></li></ul><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="创建：创建并返回一个-mmap-对象"><a href="#创建：创建并返回一个-mmap-对象" class="headerlink" title="创建：创建并返回一个 mmap 对象"></a>创建：创建并返回一个 mmap 对象</h4><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">m = mmap.mmap(fileno, length<span class="hljs-comment">[, flags<span class="hljs-comment">[, prot<span class="hljs-comment">[, access<span class="hljs-comment">[, offset]</span>]</span>]</span>]</span>)<br></code></pre></td></tr></table></figure><ul><li><strong>fileno：</strong> 文件描述符，可以是file对象的fileno()方法，或者来自os.open()，在调用mmap()之前打开文件，不再需要文件时要关闭。</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-built_in">os</span>.O_RDONLY   以只读的方式打开 Read only<br><span class="hljs-built_in">os</span>.O_WRONLY   以只写的方式打开 Write only<br><span class="hljs-built_in">os</span>.O_RDWR     以读写的方式打开 Read <span class="hljs-keyword">and</span> <span class="hljs-built_in">write</span><br><span class="hljs-built_in">os</span>.O_APPEND  以追加的方式打开  <br><span class="hljs-built_in">os</span>.O_CREAT   创建并打开一个新文件<br><span class="hljs-built_in">os</span>.O_EXCL     <span class="hljs-built_in">os</span>.O_CREAT| <span class="hljs-built_in">os</span>.O_EXCL 如果指定的文件存在，返回错误<br><span class="hljs-built_in">os</span>.O_TRUNC    打开一个文件并截断它的长度为零（必须有写权限）<br><span class="hljs-built_in">os</span>.O_BINARY          以二进制模式打开文件（不转换）<br><span class="hljs-built_in">os</span>.O_NOINHERIT        阻止创建一个共享的文件描述符<br><span class="hljs-built_in">os</span>.O_SHORT_LIVED<br><span class="hljs-built_in">os</span>.O_TEMPORARY        与O_CREAT一起创建临时文件<br><span class="hljs-built_in">os</span>.O_RANDOM         缓存优化,但不限制从磁盘中随机存取<br><span class="hljs-built_in">os</span>.O_SEQUENTIAL   缓存优化,但不限制从磁盘中序列存取<br><span class="hljs-built_in">os</span>.O_TEXT           以文本的模式打开文件（转换）<br></code></pre></td></tr></table></figure><ul><li><p><strong>length：</strong>要映射文件部分的大小（以字节为单位），这个值为0，则映射整个文件，如果大小大于文件当前大小，则扩展这个文件。</p></li><li><p><strong>flags</strong>：MAP_PRIVATE：这段内存映射只有本进程可用；mmap.MAP_SHARED：将内存映射和其他进程共享，所有映射了同一文件的进程，都能够看到其中一个所做的更改；</p></li><li><p><strong>prot：</strong>mmap.PROT_READ, mmap.PROT_WRITE 和 mmap.PROT_WRITE | mmap.PROT_READ。最后一者的含义是同时可读可写。</p></li><li><p><strong>access：</strong>在mmap中有可选参数access的值有:</p></li></ul><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tp"><span class="hljs-keyword">ACC</span>ESS_READ：读访问。<br><span class="hljs-keyword">ACC</span>ESS_WRITE：写访问，默认。<br><span class="hljs-keyword">ACC</span>ESS_COPY：拷贝访问，不会把更改写入到文件，使用flush把更改写到文件。<br></code></pre></td></tr></table></figure><h4 id="对象方法"><a href="#对象方法" class="headerlink" title="对象方法"></a>对象方法</h4><ul><li><p>m.close()</p><blockquote><p>关闭 m 对应的文件；</p></blockquote></li><li><p>m.find(str, start=0)</p><blockquote><p>从 start 下标开始，在 m 中从左往右寻找子串 str 最早出现的下标；</p></blockquote></li><li><p>m.flush([offset, n])</p><blockquote><p>把 m 中从offset开始的n个字节刷到对应的文件中；</p></blockquote></li><li><p>m.move(dstoff, srcoff, n)</p><blockquote><p>等于 m[dstoff:dstoff+n] = m[srcoff:srcoff+n]，把从 srcoff 开始的 n 个字节复制到从 dstoff 开始的n个字节，可能会覆盖重叠的部分。</p></blockquote></li><li><p>m.read(n)</p><blockquote><p>返回一个字符串，从 m 对应的文件中最多读取 n 个字节，将会把 m 对应文件的位置指针向后移动；</p></blockquote></li><li><p>m.read_byte() </p><blockquote><p>返回一个1字节长的字符串，从 m 对应的文件中读1个字节，要是已经到了EOF还调用 read_byte()，则抛出异常 ValueError；</p></blockquote></li><li><p>m.readline()</p><blockquote><p>返回一个字符串，从 m 对应文件的当前位置到下一个’\n’，当调用 readline() 时文件位于 EOF，则返回空字符串；</p></blockquote></li><li><p>m.resize(n) </p><blockquote><p>把 m 的长度改为 n，m 的长度和 m 对应文件的长度是独立的；</p></blockquote></li><li><p>m.seek(pos, how=0)</p><blockquote><p>同 file 对象的 seek 操作，改变 m 对应的文件的当前位置；</p></blockquote></li><li><p>m.size()</p><blockquote><p>返回 m 对应文件的长度（不是 m 对象的长度len(m)）；</p></blockquote></li><li><p>m.tell()</p><blockquote><p>返回 m 对应文件的当前位置；</p></blockquote></li><li><p>m.write(str)</p><blockquote><p>把 str 写到 m 对应文件的当前位置，如果从 m 对应文件的当前位置到 m 结尾剩余的空间不足len(str)，则抛出 ValueError；</p></blockquote></li><li><p>m.write_byte(byte)</p><blockquote><p>把1个字节（对应一个字符）写到 m 对应文件的当前位置，实际上 m.write_byte(ch) 等于 m.write(ch)。如果 m 对应文件的当前位置在 m 的结尾，也就是 m 对应文件的当前位置到 m 结尾剩余的空间不足1个字节，write() 抛出异常ValueError，而 write_byte() 什么都不做。</p></blockquote></li></ul><h3 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h3><h4 id="写入数据进共享内存"><a href="#写入数据进共享内存" class="headerlink" title="写入数据进共享内存"></a>写入数据进共享内存</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> ctypes<br><span class="hljs-keyword">import</span> mmap   <span class="hljs-comment"># 核心库</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-comment"># 创建内存映射文件句柄</span><br>fd = os.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;tmp/mmaptest&#x27;</span>, os.O_CREAT | os.O_TRUNC | os.O_RDWR)<br><br><span class="hljs-comment"># 建立内存缓冲区</span><br><span class="hljs-comment"># not win32</span><br>buf = mmap.mmap(fd, mmap.PAGESIZE, mmap.MAP_SHARED, mmap.PROT_WRITE)<br><span class="hljs-comment"># win32</span><br>buf = mmap.mmap(fd, <span class="hljs-number">67108864</span>, access = mmap.ACCESS_WRITE)<br><br><span class="hljs-comment"># 向buf中写入文件(二进制格式)</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;tmp/test2.bmp&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>).read()<br>buf.write(<span class="hljs-string">b&#x27;abc&#x27;</span>) <span class="hljs-comment"># 写入字符串</span><br>buf.write(f) <span class="hljs-comment"># 写入文件</span><br><br><span class="hljs-comment"># 当前指针位置</span><br>buf.tell()<br><br><span class="hljs-comment"># 移动指针到第11个字节</span><br>buf.seek(<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># 将内存中的信息写入文件</span><br>buf.flush(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>)<br><br><span class="hljs-comment"># 关闭</span><br>buf.close()<br></code></pre></td></tr></table></figure><h4 id="从共享内存中读取数据"><a href="#从共享内存中读取数据" class="headerlink" title="从共享内存中读取数据"></a>从共享内存中读取数据</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> mmap<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> struct<br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> nps<br><br><span class="hljs-comment"># 创建内存映射文件句柄</span><br>fd = os.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;share_memory/tmp/mmaptest&#x27;</span>, os.O_RDONLY)<br><br><span class="hljs-comment"># 建立内存缓冲区</span><br><span class="hljs-comment"># not win32</span><br>buf = mmap.mmap(fd, mmap.PAGESIZE, mmap.MAP_SHARED, mmap.PROT_READ)<br><span class="hljs-comment"># win32</span><br>buf = mmap.mmap(fd, <span class="hljs-number">67108864</span>, access = mmap.ACCESS_READ)<br><br><span class="hljs-comment"># 读取并打印缓冲区中指定区域内存</span><br>string_length = <span class="hljs-number">136</span><br>string, = struct.unpack(<span class="hljs-string">&#x27;&#123;&#125;s&#x27;</span>.<span class="hljs-built_in">format</span>(string_length), buf[:string_length])<br><span class="hljs-built_in">print</span>(string)<br><br><span class="hljs-comment"># 将部分区域转换为需要的格式并使用(图像)</span><br>np_str = np.fromstring(buf[:string_length], dtype=<span class="hljs-string">&#x27;uint8&#x27;</span>)<br>img = cv2.imdecode(np_str, flags=-<span class="hljs-number">1</span>)<br><br><span class="hljs-comment"># 纯图像像素数据(仅需转换字符串为uint8)即可</span><br>data = np.fromstring(buf[:string_length], dtype=<span class="hljs-string">&#x27;uint8&#x27;</span>)<br>img = data.reshape([<span class="hljs-number">10</span>,<span class="hljs-number">10</span>])<br><br></code></pre></td></tr></table></figure><blockquote><p>代码运行不会顺畅,仅提供使用思路</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://docs.python.org/2/library/mmap.html">https://docs.python.org/2/library/mmap.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/166330573">https://zhuanlan.zhihu.com/p/166330573</a></li><li><a href="https://www.cnblogs.com/zhoujinyi/p/6062907.html">https://www.cnblogs.com/zhoujinyi/p/6062907.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python CUDA 编程 - 3 - GPU编程介绍</title>
    <link href="/2021/04/18/deep_learning/speed_up/numba-usage/numba-usage/"/>
    <url>/2021/04/18/deep_learning/speed_up/numba-usage/numba-usage/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍GPU编程的一些重要概念。</p></blockquote><span id="more"></span><h3 id="GPU编程"><a href="#GPU编程" class="headerlink" title="GPU编程"></a>GPU编程</h3><blockquote><p>GPU编程与CPU编程的思考角度不尽相同，举皮皮鲁老师的一个例子：</p></blockquote><p>以加法计算为例，CPU就像大学数学教授，GPU就像几千个小学生，现在需要不借助外界，只通过纸笔，对2000个数字进行加法计算，得到1000个加法结果，在这个过程中，大学教授要协调指挥小学生完成任务。</p><p>在计算过程中，每个小学生需要按照大学教授的提出的规范，基于一个加法函数，完成计算。每个小学生就像GPU的一个计算核心，加法函数就是核函数，一个小学生完成本次计算就像一次线程计算。在整个计算过程中，只能通过纸笔交流，无论是计算任务本身，还是计算的中间结果都需要落地到纸上进行计算，作为记录的纸就像是计算机中的存储，</p><p>假设我们有2000个数字需要加到一起，得到1000个加法结果。如果只依赖20个大学教授，那每个教授需要执行50次计算，耗时很长。如果大学教授可以借助1000个小学生同时计算，那么大学教授可以这样设计GPU并行算法：</p><ol><li>设计一个加法函数，加法函数可以将两个数字加在一起。</li><li>每个小学生分配2个数字，使用加法函数，对这2个数字执行计算。</li><li>大学教授给1000个小学生分配数字，并告知他们使用怎样的加法函数进行计算。</li><li>1000个小学生同时计算，得到1000个结果数字，写到纸上，返回给大学教授。</li></ol><p>实际上，CUDA并行算法和上面的流程基本相似，就是设计核函数，在存储上合理分配数据，告知GPU以一定的并行度执行配置来并行计算。核函数的设计与所要解决的问题本身高度相关。</p><h3 id="主机与设备"><a href="#主机与设备" class="headerlink" title="主机与设备"></a>主机与设备</h3><p>在CUDA中，CPU和主存被称为<strong>主机（Host）</strong>，GPU和显存（显卡内存）被称为<strong>设备（Device）</strong>，CPU无法直接读取显存数据，GPU无法直接读取主存数据，主机与设备必须通过总线（Bus）相互通信。</p><p><img src="https://photos.zywvvd.com/image_canglan/20210418004055.png"></p><h3 id="GPU程序与CPU程序的区别"><a href="#GPU程序与CPU程序的区别" class="headerlink" title="GPU程序与CPU程序的区别"></a>GPU程序与CPU程序的区别</h3><h4 id="CPU程序"><a href="#CPU程序" class="headerlink" title="CPU程序"></a>CPU程序</h4><ol><li>初始化。</li><li>CPU计算。</li><li>得到计算结果。</li></ol><p><img src="https://photos.zywvvd.com/image_canglan/20210418010401.png"></p><h4 id="GPU程序"><a href="#GPU程序" class="headerlink" title="GPU程序"></a>GPU程序</h4><ol><li>初始化，并将必要的数据拷贝到GPU设备的显存上。</li><li>CPU调用GPU函数，启动GPU多个核心同时进行计算。</li><li>CPU与GPU异步计算。</li><li>将GPU计算结果拷贝回主机端，得到计算结果</li></ol><p><img src="https://photos.zywvvd.com/image_canglan/20210418010429.png"></p><h3 id="Thread层次结构"><a href="#Thread层次结构" class="headerlink" title="Thread层次结构"></a>Thread层次结构</h3><p>在进行GPU并行编程时，需要定义执行配置来告知以怎样的方式去并行执行核函数。CUDA将核函数所定义的运算称为<strong>线程（Thread）</strong>，多个线程组成一个<strong>块（Block）</strong>，多个块组成<strong>网格（Grid）</strong>。这样一个Grid可以定义成千上万个线程，也就解决了并行执行上万次操作的问题。</p><p><img src="https://photos.zywvvd.com/image_canglan/20210418012102.png"></p><p>实际上，线程（Thread）是一个编程上的软件概念。从硬件来看，Thread运行在一个CUDA核心上，多个Thread组成的Block运行在Streaming Multiprocessor（SM），多个Block组成的Grid运行在一个GPU显卡上。</p><p><img src="https://photos.zywvvd.com/image_canglan/20210418012441.png" alt="Thread运行在一个核心上，Block运行在SM上，Grid运行在整个GPU卡上">)</p><p>CUDA提供了一系列内置变量，以记录Thread和Block的大小及索引下标。以<code>[2, 4]</code>这样的配置为例：<code>blockDim.x</code>变量表示Block的大小是4，即每个Block有4个Thread，<code>threadIdx.x</code>变量是一个从0到<code>blockDim.x - 1</code>（4-1=3）的索引下标，记录这是第几个Thread；<code>gridDim.x</code>变量表示Grid的大小是2，即每个Grid有2个Block，<code>blockIdx.x</code>变量是一个从0到<code>gridDim.x - 1</code>（2-1=1）的索引下标，记录这是第几个Block。</p><p>某个Thread在整个Grid中的位置编号为：<code>threadIdx.x + blockIdx.x * blockDim.x</code>。</p><p><img src="https://photos.zywvvd.com/image_canglan/20210418012608.png"></p><h3 id="Block大小设置"><a href="#Block大小设置" class="headerlink" title="Block大小设置"></a>Block大小设置</h3><p>不同的执行配置会影响GPU程序的速度，一般需要多次调试才能找到较好的执行配置，在实际编程中，执行配置<code>[gridDim, blockDim]</code>应参考下面的方法：</p><ul><li>Block运行在SM上，不同硬件架构（Turing、Volta、Pascal…）的CUDA核心数不同，一般需要根据当前硬件来设置Block的大小<code>blockDim</code>（执行配置中第二个参数）。一个Block中的Thread数最好是32、128、256的倍数。注意，限于当前硬件的设计，Block大小不能超过1024。</li><li>Grid的大小<code>gridDim</code>（执行配置中第一个参数），即一个Grid中Block的个数可以由总次数<code>N</code>除以<code>blockDim</code>，并向上取整。</li></ul><p>例如，我们想并行启动1000个Thread，可以将blockDim设置为128，<code>1000 ÷ 128 = 7.8</code>，向上取整为8。使用时，执行配置可以写成<code>gpuWork[8, 128]()</code>，CUDA共启动<code>8 * 128 = 1024</code>个Thread，实际计算时只使用前1000个Thread，多余的24个Thread不进行计算。</p><p>这几个变量比较容易混淆，再次明确一下：<code>blockDim</code>是Block中Thread的个数，一个Block中的<code>threadIdx</code>最大不超过<code>blockDim</code>；<code>gridDim</code>是Grid中Block的个数，一个Grid中的<code>blockIdx</code>最大不超过<code>gridDim</code>。</p><p>以上讨论中，Block和Grid大小均是一维，实际编程使用的执行配置常常更复杂，Block和Grid的大小可以设置为二维甚至三维：</p><p><img src="https://photos.zywvvd.com/image_canglan/20210418013021.png" alt="*二维Block和Grid设置*"></p><p>一个二维的执行配置如上图所示，其中，每个Block有(3 * 4)个Thread，每个Grid有(2 * 3)个Block。 二维块大小为 *(Dx, Dy)*，某个线程号 <em>(x, y)</em> 的公式为 **(x + y Dx)**；三维块大小为 <em>(Dx, Dy, Dz)<em>，某个线程号</em>(x, y, z)</em> 的公式为 **(x + y Dx + z Dx Dy)**。各个内置变量中<code>.x</code> <code>.y</code>和<code>.z</code>为不同维度下的值。</p><p>例如，一个二维配置，某个线程在矩阵中的位置可以表示为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">col</span> = cuda.threadIdx.y + cuda.blockDim.y * cuda.blockIdx.y<br><span class="hljs-attr">row</span> = cuda.threadIdx.x + cuda.blockDim.x * cuda.blockIdx.x<br></code></pre></td></tr></table></figure><p>如何将二维Block映射到自己的数据上并没有固定的映射方法，一般情况将<code>.x</code>映射为矩阵的行，将<code>.y</code>映射为矩阵的列。Numba提供了一个更简单的方法帮我们计算线程的编号：</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">row</span>, <span class="hljs-built_in">col</span> = cuda.<span class="hljs-built_in">grid</span>(<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>其中，参数2表示这是一个2维的执行配置。1维或3维的时候，可以将参数改为1或3。</p><p>对应的执行配置也要改为二维：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">threads_per_block</span> = (<span class="hljs-number">16</span>, <span class="hljs-number">16</span>)<br><span class="hljs-attribute">blocks_per_grid</span> = (<span class="hljs-number">32</span>, <span class="hljs-number">32</span>)<br><span class="hljs-attribute">gpu_kernel</span>[blocks_per_grid, threads_per_block]<br></code></pre></td></tr></table></figure><p><code>(16, 16)</code>的二维Block是一个常用的配置，共256个线程。之前也曾提到过，每个Block的Thread个数最好是128、256或512，这与GPU的硬件架构高度相关。</p><h3 id="内存分配"><a href="#内存分配" class="headerlink" title="内存分配"></a>内存分配</h3><p>前文提到，GPU计算时直接从显存中读取数据，因此每当计算时要将数据从主存拷贝到显存上，用CUDA的术语来说就是要把数据从主机端拷贝到设备端。用小学生计算的例子来解释，大学教授需要将计算任务写在纸上，分发给各组小学生。CUDA强大之处在于它能自动将数据从主机和设备间相互拷贝，不需要程序员在代码中写明。这种方法对编程者来说非常方便，不必对原有的CPU代码做大量改动。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://lulaoshi.info/gpu/python-cuda/cuda-intro.html">https://lulaoshi.info/gpu/python-cuda/cuda-intro.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在 Hexo 页面中嵌入多个 geogebra 动态图</title>
    <link href="/2021/04/17/tools/geogebra/multi-geogebra/multi-geogebra/"/>
    <url>/2021/04/17/tools/geogebra/multi-geogebra/multi-geogebra/</url>
    
    <content type="html"><![CDATA[<blockquote><p>geogebra 动态图可以在网页中显示数学公式，本文记录显示多个geogebra的方法。</p></blockquote><span id="more"></span><h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><ul><li>需要在 hexo 中可以<a href="https://www.zywvvd.com/2020/12/19/tools/geogebra/geogebra-html-embed/geogebra-html-embed/">嵌入 geogebra 图像</a></li><li>在 <code>script</code> 语句中建立多个 <code>GGBApplet</code> 对象</li><li>在 <code>window.onload</code> 函数中调用多个函数</li></ul><h3 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h3><ol><li>引入 js 文件</li></ol><ul><li>本地文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/js/deployggb.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>  //路径指向自己建立的js文件<br></code></pre></td></tr></table></figure><ul><li>官网文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.geogebra.org/apps/deployggb.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>建立 <code>GGBApplet</code> 对象并显示</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"></span><br><span class="javascript"><span class="hljs-comment">// 建立自己的 ggb 参数</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> parameters = &#123;</span><br><span class="javascript"><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">1000</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">500</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;enableShiftDragZoom&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;showZoomButtons&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;appletOnLoad&quot;</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">api</span>)</span>&#123; <span class="hljs-comment">/* api.evalCommand(&#x27;Segment((1,2),(3,4))&#x27;);*/</span> &#125;,</span><br><span class="javascript"><span class="hljs-string">&quot;showFullscreenButton&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;en&quot;</span>,</span><br><span class="javascript"> <span class="hljs-string">&quot;filename&quot;</span>:<span class="hljs-string">&quot;https://photos.zywvvd.com/image_canglan/20210417165539.ggb&quot;</span>,</span><br><span class="javascript">&#125;;</span><br><span class="javascript"></span><br><span class="javascript"><span class="hljs-comment">// views 参数</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> views = &#123;<span class="hljs-string">&#x27;is3D&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;AV&#x27;</span>: <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;SV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;CV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;EV2&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;CP&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;PC&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;DA&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;FI&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;macro&#x27;</span>: <span class="hljs-number">0</span>&#125;;</span><br><span class="javascript"></span><br><span class="javascript"><span class="hljs-comment">// GGBApplet 对象</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> applet = <span class="hljs-keyword">new</span> GGBApplet(parameters, <span class="hljs-string">&#x27;5.0&#x27;</span>, views);</span><br><span class="javascript"></span><br><span class="javascript"><span class="hljs-comment">// 展示 geogebra 图像</span></span><br><span class="javascript"><span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span></span><br><span class="hljs-function"><span class="javascript"></span>&#123;applet.inject(<span class="hljs-string">&#x27;ggbApplet&#x27;</span>);&#125;;</span><br><span class="javascript"></span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>//展示对象<br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ggbApplet&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><ol start="3"><li>多个 geogebra 图像显示</li></ol><ul><li>建立多个 <code>parameters</code> 对象，对象中指定不同的 <code>id</code>，定制不同的 geogebra 内容</li></ul><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">var</span> parameters1 = &#123;<br><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet1&quot;</span>,<br><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">1000</span>,<br><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">500</span>,<br><span class="hljs-string">&quot;enableShiftDragZoom&quot;</span>:<span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;showZoomButtons&quot;</span>:<span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;appletOnLoad&quot;</span>:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(api)</span></span>&#123; <span class="hljs-comment">/* api.evalCommand(&#x27;Segment((1,2),(3,4))&#x27;);*/</span> &#125;,<br><span class="hljs-string">&quot;showFullscreenButton&quot;</span>:<span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;en&quot;</span>,<br> <span class="hljs-string">&quot;filename&quot;</span>:<span class="hljs-string">&quot;https://photos.zywvvd.com/image_canglan/20210417165539.ggb&quot;</span>,<br>&#125;;<br><br><span class="hljs-keyword">var</span> parameters2 = &#123;<br><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet2&quot;</span>,<br><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">1000</span>,<br><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">500</span>,<br><span class="hljs-string">&quot;enableShiftDragZoom&quot;</span>:<span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;showZoomButtons&quot;</span>:<span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;appletOnLoad&quot;</span>:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(api)</span></span>&#123; <span class="hljs-comment">/* api.evalCommand(&#x27;Segment((1,2),(3,4))&#x27;);*/</span> &#125;,<br><span class="hljs-string">&quot;showFullscreenButton&quot;</span>:<span class="hljs-literal">true</span>,<br><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;en&quot;</span>,<br> <span class="hljs-string">&quot;filename&quot;</span>:<span class="hljs-string">&quot;https://photos.zywvvd.com/image_canglan/20210417220853.ggb&quot;</span>,<br>&#125;;<br></code></pre></td></tr></table></figure><ul><li>建立views对象（可以复用）</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">var</span> views = &#123;&#x27;is<span class="hljs-number">3</span>D&#x27;: <span class="hljs-number">0</span>,&#x27;AV&#x27;: <span class="hljs-number">1</span>,&#x27;SV&#x27;: <span class="hljs-number">0</span>,&#x27;CV&#x27;: <span class="hljs-number">0</span>,&#x27;EV<span class="hljs-number">2</span>&#x27;: <span class="hljs-number">0</span>,&#x27;CP&#x27;: <span class="hljs-number">0</span>,&#x27;PC&#x27;: <span class="hljs-number">0</span>,&#x27;DA&#x27;: <span class="hljs-number">0</span>,&#x27;FI&#x27;: <span class="hljs-number">0</span>,&#x27;macro&#x27;: <span class="hljs-number">0</span>&#125;;<br></code></pre></td></tr></table></figure><ul><li>建立多个GGBApplet 对象</li></ul><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">// GGBApplet 对象 applet1</span><br><span class="hljs-keyword">var</span> applet1 = <span class="hljs-keyword">new</span> <span class="hljs-type">GGBApplet</span>(parameters1, <span class="hljs-string">&#x27;5.0&#x27;</span>, views);<br><span class="hljs-comment">// GGBApplet 对象 applet2</span><br><span class="hljs-keyword">var</span> applet2 = <span class="hljs-keyword">new</span> <span class="hljs-type">GGBApplet</span>(parameters2, <span class="hljs-string">&#x27;5.0&#x27;</span>, views);<br></code></pre></td></tr></table></figure><ul><li>window.onload 展示多个函数</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 展示 geogebra 图像<br>window.onload = <span class="hljs-keyword">function</span>()<br>&#123;applet1.inject(<span class="hljs-string">&#x27;ggbApplet1&#x27;</span>); <span class="hljs-regexp">//</span> 参数与 parameters 中的 id 对应<br>applet2.inject(<span class="hljs-string">&#x27;ggbApplet2&#x27;</span>);&#125;;<br></code></pre></td></tr></table></figure><ul><li>在 Hexo页面引用对象</li></ul><h3 id="效果展示"><a href="#效果展示" class="headerlink" title="效果展示"></a>效果展示</h3><script src="/js/deployggb.js"></script><script>// 参数 parameters1var parameters1 = {"id": "ggbApplet1","width":1000,"height":500,"enableShiftDragZoom":true,"showZoomButtons":true,"appletOnLoad":function(api){ /* api.evalCommand('Segment((1,2),(3,4))');*/ },"showFullscreenButton":true,"language":"en", "filename":"https://photos.zywvvd.com/image_canglan/20210417165539.ggb",};// 参数 parameters2var parameters2 = {"id": "ggbApplet2","width":1000,"height":500,"enableShiftDragZoom":true,"showZoomButtons":true,"appletOnLoad":function(api){ /* api.evalCommand('Segment((1,2),(3,4))');*/ },"showFullscreenButton":true,"language":"en", "filename":"https://photos.zywvvd.com/image_canglan/20210417220853.ggb",};// views 参数var views = {'is3D': 0,'AV': 1,'SV': 0,'CV': 0,'EV2': 0,'CP': 0,'PC': 0,'DA': 0,'FI': 0,'macro': 0};// GGBApplet 对象 applet1var applet1 = new GGBApplet(parameters1, '5.0', views);// GGBApplet 对象 applet2var applet2 = new GGBApplet(parameters2, '5.0', views);// 展示 geogebra 图像window.onload = function(){applet1.inject('ggbApplet1');applet2.inject('ggbApplet2');};</script><ul><li><p>geogebra 图像 1</p><div id="ggbApplet1"></div></li><li><p>geogebra 图像 2</p><div id="ggbApplet2"></div></li></ul><h3 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h3><details>  <summary>示例代码</summary>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/js/deployggb.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-comment">// 参数 parameters1</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> parameters1 = &#123;</span><br><span class="javascript"><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet1&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">1000</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">500</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;enableShiftDragZoom&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;showZoomButtons&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;appletOnLoad&quot;</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">api</span>)</span>&#123; <span class="hljs-comment">/* api.evalCommand(&#x27;Segment((1,2),(3,4))&#x27;);*/</span> &#125;,</span><br><span class="javascript"><span class="hljs-string">&quot;showFullscreenButton&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;en&quot;</span>,</span><br><span class="javascript"> <span class="hljs-string">&quot;filename&quot;</span>:<span class="hljs-string">&quot;https://photos.zywvvd.com/image_canglan/20210417165539.ggb&quot;</span>,</span><br><span class="javascript">&#125;;</span><br><span class="javascript"><span class="hljs-comment">// 参数 parameters2</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> parameters2 = &#123;</span><br><span class="javascript"><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet2&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">1000</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">500</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;enableShiftDragZoom&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;showZoomButtons&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;appletOnLoad&quot;</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">api</span>)</span>&#123; <span class="hljs-comment">/* api.evalCommand(&#x27;Segment((1,2),(3,4))&#x27;);*/</span> &#125;,</span><br><span class="javascript"><span class="hljs-string">&quot;showFullscreenButton&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;en&quot;</span>,</span><br><span class="javascript"> <span class="hljs-string">&quot;filename&quot;</span>:<span class="hljs-string">&quot;https://photos.zywvvd.com/image_canglan/20210417220853.ggb&quot;</span>,</span><br><span class="javascript">&#125;;</span><br><span class="javascript"><span class="hljs-comment">// views 参数</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> views = &#123;<span class="hljs-string">&#x27;is3D&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;AV&#x27;</span>: <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;SV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;CV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;EV2&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;CP&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;PC&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;DA&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;FI&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;macro&#x27;</span>: <span class="hljs-number">0</span>&#125;;</span><br><span class="javascript"></span><br><span class="javascript"><span class="hljs-comment">// GGBApplet 对象 applet1</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> applet1 = <span class="hljs-keyword">new</span> GGBApplet(parameters1, <span class="hljs-string">&#x27;5.0&#x27;</span>, views);</span><br><span class="javascript"><span class="hljs-comment">// GGBApplet 对象 applet2</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> applet2 = <span class="hljs-keyword">new</span> GGBApplet(parameters2, <span class="hljs-string">&#x27;5.0&#x27;</span>, views);</span><br><span class="javascript"></span><br><span class="javascript"><span class="hljs-comment">// 展示 geogebra 图像</span></span><br><span class="javascript"><span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span></span><br><span class="hljs-function"><span class="javascript"></span>&#123;applet1.inject(<span class="hljs-string">&#x27;ggbApplet1&#x27;</span>);</span><br><span class="javascript">applet2.inject(<span class="hljs-string">&#x27;ggbApplet2&#x27;</span>);&#125;;</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br>- geogebra 图像 1<br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ggbApplet1&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>- geogebra 图像 2<br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ggbApplet2&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure></details><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.zywvvd.com/2020/12/19/tools/geogebra/geogebra-html-embed/geogebra-html-embe">https://www.zywvvd.com/2020/12/19/tools/geogebra/geogebra-html-embed/geogebra-html-embe</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>tools</category>
      
      <category>geogebra</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
      <tag>geogebra</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows10 配置 Nvidia 驱动与 Cuda 环境搭建</title>
    <link href="/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/"/>
    <url>/2021/04/17/coding/environment/win-10-nvidia-drier-cuda-env-build/win-10-nvidia-drier-cuda-env-build/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Windows 配置GPU加速编程环境可能问题比Linux多一些，本文记录配置过程。</p></blockquote><span id="more"></span><h3 id="环境需求"><a href="#环境需求" class="headerlink" title="环境需求"></a>环境需求</h3><h4 id="当前配置"><a href="#当前配置" class="headerlink" title="当前配置"></a>当前配置</h4><ul><li>操作系统：Windows 10</li><li>显卡型号：Nvidia GeForce GTX 960M</li><li>当前驱动：391.25</li></ul><h4 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h4><ul><li>升级显卡驱动</li><li>安装适用的Cuda</li><li>安装配套的Cudnn</li><li>测试安装结果</li></ul><h3 id="升级显卡驱动"><a href="#升级显卡驱动" class="headerlink" title="升级显卡驱动"></a>升级显卡驱动</h3><h4 id="查看当前驱动信息"><a href="#查看当前驱动信息" class="headerlink" title="查看当前驱动信息"></a>查看当前驱动信息</h4><ul><li>打开Nvidia控制面板</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417130313.png"></p><blockquote><p>可以看到自己的显卡和驱动</p></blockquote><h4 id="查看并下载自己可用的驱动版本"><a href="#查看并下载自己可用的驱动版本" class="headerlink" title="查看并下载自己可用的驱动版本"></a>查看并下载自己可用的驱动版本</h4><ul><li>登录官网：<a href="https://www.nvidia.cn/geforce/drivers/">https://www.nvidia.cn/geforce/drivers/</a></li><li>选择自己的系统和显卡型号，查看自己可以使用的显卡驱动列表：</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417130626.png"></p><p><img src="https://photos.zywvvd.com/image_canglan/20210417130741.png"></p><blockquote><p>虽然显卡菜了些，驱动还是很先进的</p><p>这里建议驱动版本稍新一些，CUDA对显卡驱动的依赖是向下兼容的</p><p>我选择了466.11的驱动</p></blockquote><p><strong>Tips</strong>：如果浏览器下载时快时慢，可以将下载链接放到迅雷里下载，速度感人</p><h4 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h4><ul><li>启动我们下载的驱动程序</li><li><code>466.11-notebook-win10-64bit-international-dch-whql.exe</code></li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417131354.png"></p><p><img src="https://photos.zywvvd.com/image_canglan/20210417132841.png"></p><p><img src="https://photos.zywvvd.com/image_canglan/20210417132905.png"></p><p><img src="https://photos.zywvvd.com/image_canglan/20210417132941.png"></p><ul><li>图形驱动程序安装成功就行</li><li>重新打开Nvidia控制面板</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417133744.png"></p><ul><li>显卡驱动更新成功</li></ul><h3 id="CUDA下载安装配置"><a href="#CUDA下载安装配置" class="headerlink" title="CUDA下载安装配置"></a>CUDA下载安装配置</h3><h4 id="下载CUDA"><a href="#下载CUDA" class="headerlink" title="下载CUDA"></a>下载CUDA</h4><ul><li>登录中文官网：<a href="https://developer.nvidia.com/zh-cn/cuda-downloads">https://developer.nvidia.com/zh-cn/cuda-downloads</a></li><li>选择合适自己的系统和选项：</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417132424.png"></p><blockquote><p>此时推荐的链接为当前最新版的Cuda，如果需要可以直接下载</p><p>但是经常我们需要的Cuda是早期的某个版本</p></blockquote><ul><li><p>CUDA 产品下载列表：<a href="https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu1604/x86_64/">https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu1604/x86_64/</a></p></li><li><p>早期版本Cuda下载链接：</p></li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417132711.png"></p><p><img src="https://photos.zywvvd.com/image_canglan/20210417133047.png" alt="https://developer.nvidia.com/cuda-toolkit-archive"></p><blockquote><p>在此页面下载自己需要的CUDA版本</p><p>我下载的是CUDA 10.2</p></blockquote><h4 id="CUDA安装"><a href="#CUDA安装" class="headerlink" title="CUDA安装"></a>CUDA安装</h4><ul><li>打开下载的 <code>cuda_10.2.89_441.22_win10.exe</code>文件</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417133953.png"></p><p><img src="https://photos.zywvvd.com/image_canglan/20210417134035.png"></p><p><img src="https://photos.zywvvd.com/image_canglan/20210417150030.png"></p><p><img src="https://photos.zywvvd.com/image_canglan/20210417150113.png"></p><ul><li>不要安装 <code>Visual Studio Integration</code> ，装也装不上</li><li>驱动我们已经更新过了，就不要装CUDA里的驱动了</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417150518.png"></p><ul><li>下一步开始安装</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417150633.png"></p><h4 id="如果-Visual-Studio-Integration不慎安装了"><a href="#如果-Visual-Studio-Integration不慎安装了" class="headerlink" title="如果 Visual Studio Integration不慎安装了"></a>如果 <code>Visual Studio Integration</code>不慎安装了</h4><ul><li>电脑就会重启</li><li>命令 <code>nvidia-smi</code>：</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417140834.png"></p><ul><li>这个是假的，真实的CUDA并没有装上</li><li>需要重新安装CUDA，选择自定义，按照上述要求重装就行</li><li>添加路径到Path环境变量中（如一切工作正常可以不着急添加）：</li></ul><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\N</span>VIDIA GPU Computing Toolkit<span class="hljs-symbol">\C</span>UDA<span class="hljs-symbol">\v</span>10.2<span class="hljs-symbol">\l</span>ib<span class="hljs-symbol">\x</span>64<br>C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\N</span>VIDIA GPU Computing Toolkit<span class="hljs-symbol">\C</span>UDA<span class="hljs-symbol">\v</span>10.2<span class="hljs-symbol">\i</span>nclude<br>C:<span class="hljs-symbol">\P</span>rogram Files<span class="hljs-symbol">\N</span>VIDIA GPU Computing Toolkit<span class="hljs-symbol">\C</span>UDA<span class="hljs-symbol">\v</span>10.2<span class="hljs-symbol">\e</span>xtras<span class="hljs-symbol">\C</span>UPTI<span class="hljs-symbol">\l</span>ib64<br>C:<span class="hljs-symbol">\P</span>rogramData<span class="hljs-symbol">\N</span>VIDIA Corporation<span class="hljs-symbol">\C</span>UDA Samples<span class="hljs-symbol">\v</span>10.2<span class="hljs-symbol">\b</span>in<span class="hljs-symbol">\w</span>in64<br>C:<span class="hljs-symbol">\P</span>rogramData<span class="hljs-symbol">\N</span>VIDIA Corporation<span class="hljs-symbol">\C</span>UDA Samples<span class="hljs-symbol">\v</span>10.2<span class="hljs-symbol">\c</span>ommon<span class="hljs-symbol">\l</span>ib<span class="hljs-symbol">\x</span>64<br></code></pre></td></tr></table></figure><h4 id="测试CUDA"><a href="#测试CUDA" class="headerlink" title="测试CUDA"></a>测试CUDA</h4><ul><li>打开cmd</li><li>命令 <code>nvcc -V</code></li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417151718.png"></p><h3 id="cuDNN-下载安装"><a href="#cuDNN-下载安装" class="headerlink" title="cuDNN 下载安装"></a>cuDNN 下载安装</h3><h4 id="cuDNN下载"><a href="#cuDNN下载" class="headerlink" title="cuDNN下载"></a>cuDNN下载</h4><ul><li><p>中文官网：<a href="https://developer.nvidia.com/zh-cn/cudnn">https://developer.nvidia.com/zh-cn/cudnn</a></p></li><li><p>下载官网：<a href="https://developer.nvidia.com/cudnn-download-survey">https://developer.nvidia.com/cudnn-download-survey</a></p></li><li><p>此时需要登录自己的Nvidia账号（没有的需要注册一个）</p></li><li><p>选择合适自己的版本</p></li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417143109.png"></p><h4 id="安装cuDNN"><a href="#安装cuDNN" class="headerlink" title="安装cuDNN"></a>安装cuDNN</h4><ul><li>解压cuDNN文件</li><li>得到<code>cuda</code>文件夹，其中文件包括：</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210417152620.png"></p><ul><li>将所有文件复制到cuda安装文件夹</li></ul><blockquote><p>例如我的是：C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2</p></blockquote><h4 id="测试cuDNN"><a href="#测试cuDNN" class="headerlink" title="测试cuDNN"></a>测试cuDNN</h4><ul><li>打开文件夹 ：<code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2\include</code></li></ul><h5 id="对于-cudnn-version-lt-8-0-的情况"><a href="#对于-cudnn-version-lt-8-0-的情况" class="headerlink" title="对于 cudnn version &lt; 8.0 的情况"></a>对于 cudnn version &lt; 8.0 的情况</h5><ul><li>打开<code>cudnn.h</code>文件</li></ul><h5 id="对于-cudnn-version-gt-8-0-的情况"><a href="#对于-cudnn-version-gt-8-0-的情况" class="headerlink" title="对于 cudnn version &gt; 8.0 的情况"></a>对于 cudnn version &gt; 8.0 的情况</h5><ul><li>打开<code>cudnn_version.h</code>文件</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUDNN_MAJOR 8</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUDNN_MINOR 1</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUDNN_PATCHLEVEL 1</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CUDNN_VERSION (CUDNN_MAJOR * 1000 + CUDNN_MINOR * 100 + CUDNN_PATCHLEVEL)</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/bingo_liu/article/details/103224730">https://blog.csdn.net/bingo_liu/article/details/103224730</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
      <category>environment</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>environment</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>无法定位程序输入点 OPENSSL_sk_new_reserve 于动态链接库Anaconda3\Library\bin\libssl-1_1-x64.dll上”的解决办法</title>
    <link href="/2021/04/16/coding/environment/openssl-not-found/openssl-not-found/"/>
    <url>/2021/04/16/coding/environment/openssl-not-found/openssl-not-found/</url>
    
    <content type="html"><![CDATA[<blockquote><p> Windows 10 Anaconda “无法定位程序输入点 OPENSSL_sk_new_reserve 于动态链接库 E：\ProgramData\Anaconda3\Library\bin\libssl-1_1-x64.dll上”的解决办法。</p></blockquote><span id="more"></span><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><ul><li><p>操作系统 Windows 10</p></li><li><p>由于种种原因，anaconda 环境中的<code>libssl-1_1-x64.dll</code>不能被正常调用，导致不能创建新的conda环境</p></li><li><p>同时 <code>Anaconda3\DLLs</code> 下的<code>libssl-1_1-x64.dll</code>文件和<code>Anaconda3\Library\bin</code>下的<code>libssl-1_1-x64.dll</code>的日期和大小都不一样。</p></li></ul><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ul><li>将<strong>DLLs里的libssl-1_1-x64.dll文件复制粘贴到bin里</strong></li><li>删除<code>libssl-1_1-x64.pdb</code>文件</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/weixin_42329133/article/details/102640763">https://blog.csdn.net/weixin_42329133/article/details/102640763</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>conda</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>conda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python CUDA 编程 - 2 - Numba 简介</title>
    <link href="/2021/04/15/deep_learning/speed_up/numba-intro/numba-intro/"/>
    <url>/2021/04/15/deep_learning/speed_up/numba-intro/numba-intro/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Numba是一个针对Python的开源JIT编译器，由Anaconda公司主导开发，可以对Python原生代码进行CPU和GPU加速。Numba对NumPy数组和函数非常友好。</p></blockquote><span id="more"></span><h3 id="Numba简介"><a href="#Numba简介" class="headerlink" title="Numba简介"></a>Numba简介</h3><blockquote><p>计算机只能执行二进制的机器码，C、C++等编译型语言依靠编译器将源代码转化为可执行文件后才能运行，Python、Java等解释型语言使用解释器将源代码翻译后在虚拟机上执行。对于Python，由于解释器的存在，其执行效率比C语言慢几倍甚至几十倍。</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20210416001939.png" alt="以C语言为基准，不同编程语言性能测试比较"></p><blockquote><p>C语言经过几十年的发展，优化已经达到了极致。以C语言为基准，大多数解释语言，如Python、R会慢十倍甚至一百倍。Julia这个解释语言是个“奇葩”，因为它采用了JIT编译技术。</p></blockquote><ul><li>我们平时研发深度学习重度依赖 python，除了numpy矩阵运算速度快以外执行效率并不够高</li><li>解决Python执行效率低的问题，一种解决办法是使用C/C++语言重写Python函数，但是这要求程序员对C/C++语言熟悉，且调试速度慢</li><li>另外一种非常方便快捷的解决办法就是使用<code>Just-In-Time（JIT）</code>技术</li></ul><h3 id="Python解释器工作原理"><a href="#Python解释器工作原理" class="headerlink" title="Python解释器工作原理"></a>Python解释器工作原理</h3><blockquote><p>Python是一门解释语言，Python为我们提供了基于硬件和操作系统的一个虚拟机，并使用解释器将源代码转化为虚拟机可执行的字节码。字节码在虚拟机上执行，得到结果。</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20210416002635.png" alt="Python解释器工作原理"></p><ul><li>我们使用<code>python example.py</code>来执行一份源代码时，Python解释器会在后台启动一个字节码编译器（Bytecode Compiler），将源代码转换为字节码</li><li>字节码是一种只能运行在虚拟机上的文件，Python的字节码默认后缀为<code>.pyc</code></li><li>Python生成<code>.pyc</code>后一般放在内存中继续使用，并不是每次都将<code>.pyc</code>文件保存到磁盘上</li><li>pyc字节码通过Python虚拟机与硬件交互</li><li>虚拟机的出现导致程序和硬件之间增加了中间层，运行效率大打折扣</li><li>在虚拟机上再运行一个其他系统，经常感觉速度下降，体验变差，这与Python虚拟机导致程序运行慢是一个原理</li></ul><h3 id="Just-In-Time（JIT）"><a href="#Just-In-Time（JIT）" class="headerlink" title="Just-In-Time（JIT）"></a>Just-In-Time（JIT）</h3><blockquote><p>Just-In-Time（JIT）技术为解释语言提供了一种优化，它能克服上述效率问题，极大提升代码执行速度，同时保留Python语言的易用性。</p><p>使用JIT技术时，JIT编译器将Python源代码编译成机器直接可以执行的机器语言，并可以直接在CPU等硬件上运行。这样就跳过了原来的虚拟机，执行速度几乎与用C语言编程速度并无二致。</p></blockquote><h3 id="Python-Numba"><a href="#Python-Numba" class="headerlink" title="Python Numba"></a>Python Numba</h3><blockquote><p>Numba是一个针对Python的开源JIT编译器，由Anaconda公司主导开发，可以对Python原生代码进行CPU和GPU加速。Numba对NumPy数组和函数非常友好。</p></blockquote><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>官方文档：<a href="http://numba.pydata.org/numba-doc/latest/reference/pysupported.html">http://numba.pydata.org/numba-doc/latest/reference/pysupported.html</a></p><p>使用Numba非常方便，只需要在Python原生函数上增加一个装饰器（Decorator）。Numba会将这些函数使用即时编译JIT方式编译成机器码，这些代码将以近乎机器码的速度运行。</p><p>目前，Numba对以下环境进行了支持：</p><ul><li>操作系统：Windows（32位和64位），macOS，Linux（32位和64位）</li><li>CPU微架构：x86，x86_64，ppc64，armv7l和armv8l</li><li>GPU：NVIDIA CUDA和AMD ROCm</li><li>CPython</li><li>NumPy 1.15以后的版本</li></ul><h4 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h4><p>使用<code>conda</code>安装Numba：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">$ conda <span class="hljs-keyword">install</span> numba<br></code></pre></td></tr></table></figure><p>或者使用<code>pip</code>安装：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">$ pip <span class="hljs-keyword">install</span> numba<br></code></pre></td></tr></table></figure><h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><blockquote><p>使用时，只需要在原来的函数上添加一行”注释”：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> jit<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>SIZE = <span class="hljs-number">2000</span><br>x = np.random.random((SIZE, SIZE))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">给定n*n矩阵，对矩阵每个元素计算tanh值，然后求和。</span><br><span class="hljs-string">因为要循环矩阵中的每个元素，计算复杂度为 n*n。</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-meta">@jit</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">jit_tan_sum</span>(<span class="hljs-params">a</span>):</span>   <span class="hljs-comment"># 函数在被调用时编译成机器语言</span><br>    tan_sum = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(SIZE):   <span class="hljs-comment"># Numba 支持循环</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(SIZE):<br>            tan_sum += np.tanh(a[i, j])   <span class="hljs-comment"># Numba 支持绝大多数NumPy函数</span><br>    <span class="hljs-keyword">return</span> tan_sum<br><br><span class="hljs-built_in">print</span>(jit_tan_sum(x))<br></code></pre></td></tr></table></figure><blockquote><p>我们只需要在原来的代码上添加一行<code>@jit</code>，即可将一个函数编译成机器码，其他地方都不需要更改。<code>@</code>符号装饰了原来的代码，所以称类似写法为<strong>装饰器</strong>。</p></blockquote><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><blockquote><p>Numba简单到只需要在函数上加一个装饰就能加速程序，但也有缺点。目前Numba只支持了Python原生函数和部分NumPy函数，其他一些场景可能不适用。</p></blockquote><ul><li>比如类似pandas这样的库是更高层次的封装，Numba其实不能理解它里面做了什么，所以无法对其加速。一些大家经常用的机器学习框架，如<code>scikit-learn</code>，<code>tensorflow</code>，<code>pytorch</code>等，已经做了大量的优化，不适合再使用Numba做加速。</li><li>此外，Numba不支持：<ul><li><code>try...except</code> 异常处理</li><li><code>with</code> 语句</li><li>类定义<code>class</code></li><li><code>yield from</code></li></ul></li></ul><h4 id="Numba-工作模式"><a href="#Numba-工作模式" class="headerlink" title="Numba 工作模式"></a>Numba 工作模式</h4><ul><li>Numba的<code>@jit</code>装饰器就像自动驾驶，用户不需要关注到底是如何优化的，Numba去尝试进行优化，如果发现不支持，那么Numba会继续用Python原来的方法去执行该函数，即<em>图 Python解释器工作原理</em>中左侧部分。这种模式被称为<code>object</code>模式。前文提到的pandas的例子，Numba发现无法理解里面的内容，于是自动进入了<code>object</code>模式。<code>object</code>模式还是和原生的Python一样慢，还有可能比原来更慢。</li><li>Numba真正优秀之处在于其<code>nopython</code>模式。将装饰器改为<code>@jit(nopython=True)</code>或者<code>@njit</code>，Numba会假设你已经对所加速的函数非常了解，强制使用加速的方式，不会进入<code>object</code>模式，如编译不成功，则直接抛出异常。<code>nopython</code>的名字会有点歧义，我们可以理解为不使用很慢的Python，强制进入<em>图 Python解释器工作原理</em>中右侧部分。</li></ul><blockquote><p>实践上，一般推荐将代码中计算密集的部分作为单独的函数提出来，并使用<code>nopython</code>方式优化，这样可以保证我们能使用到Numba的加速功能。其余部分还是使用Python原生代码，在计算加速的前提下，避免过长的编译时间。Numba可以与NumPy紧密结合，两者一起，常常能够得到近乎C语言的速度。尽管Numba不能直接优化pandas，但是我们可以将pandas中处理数据的<code>for</code>循环作为单独的函数提出来，再使用Numba加速。</p></blockquote><h3 id="编译开销"><a href="#编译开销" class="headerlink" title="编译开销"></a>编译开销</h3><blockquote><p>编译源代码需要一定的时间。C/C++等编译型语言要提前把整个程序先编译好，再执行可执行文件。Numba库提供的是一种懒编译（Lazy Compilation）技术，即在运行过程中第一次发现代码中有<code>@jit</code>，才将该代码块编译。用到的时候才编译，看起来比较懒，所以叫懒编译。</p></blockquote><p>使用Numba时，总时间 = 编译时间 + 运行时间。相比所能节省的计算时间，编译的时间开销很小，所以物有所值。对于一个需要多次调用的Numba函数，只需要编译一次，后面再调用时就不需要编译了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> jit<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> time<br><br>SIZE = <span class="hljs-number">2000</span><br>x = np.random.random((SIZE, SIZE))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">给定n*n矩阵，对矩阵每个元素计算tanh值，然后求和。</span><br><span class="hljs-string">因为要循环矩阵中的每个元素，计算复杂度为 n*n。</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-meta">@jit</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">jit_tan_sum</span>(<span class="hljs-params">a</span>):</span>   <span class="hljs-comment"># 函数在被调用时编译成机器语言</span><br>    tan_sum = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(SIZE):   <span class="hljs-comment"># Numba 支持循环</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(SIZE):<br>            tan_sum += np.tanh(a[i, j])   <span class="hljs-comment"># Numba 支持绝大多数NumPy函数</span><br>    <span class="hljs-keyword">return</span> tan_sum<br><br><span class="hljs-comment"># 总时间 = 编译时间 + 运行时间</span><br>start = time.time()<br>jit_tan_sum(x)<br>end = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Elapsed (with compilation) = %s&quot;</span> % (end - start))<br><br><span class="hljs-comment"># Numba将加速的代码缓存下来</span><br><span class="hljs-comment"># 总时间 = 运行时间</span><br>start = time.time()<br>jit_tan_sum(x)<br>end = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Elapsed (after compilation) = %s&quot;</span> % (end - start))<br></code></pre></td></tr></table></figure><p>代码中两次调用Numba优化函数，第一次执行时需要编译，第二次使用缓存的代码，运行时间将大大缩短：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Elapsed</span> (with compilation) = <span class="hljs-number">0</span>.<span class="hljs-number">49199914932250977</span><br><span class="hljs-attribute">Elapsed</span> (after compilation) = <span class="hljs-number">0</span>.<span class="hljs-number">0364077091217041</span><br></code></pre></td></tr></table></figure><h3 id="类型推断编译加速"><a href="#类型推断编译加速" class="headerlink" title="类型推断编译加速"></a>类型推断编译加速</h3><blockquote><p>原生Python速度慢的另一个重要原因是变量类型不确定。声明一个变量的语法很简单，如<code>a = 1</code>，但没有指定<code>a</code>到底是一个整数和一个浮点小数。Python解释器要进行大量的类型推断，会非常耗时。</p><p>引入Numba后，Numba也要推断输入输出的类型，才能转化为机器码。针对这个问题，Numba给出了名为Eager Compilation的优化方式。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> jit, int32<br><br><span class="hljs-meta">@jit(<span class="hljs-params"><span class="hljs-string">&quot;int32(int32, int32)&quot;</span>, nopython=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f2</span>(<span class="hljs-params">x, y</span>):</span><br>    <span class="hljs-keyword">return</span> x + y<br></code></pre></td></tr></table></figure><p><code>@jit(int32(int32, int32))</code>告知Numba你的函数在使用什么样的输入和输出，括号内是输入，括号左侧是输出。这样不会加快执行速度，但是会加快编译速度，可以更快将函数编译到机器码上。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://lulaoshi.info/gpu/python-cuda/numba.html">https://lulaoshi.info/gpu/python-cuda/numba.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用 pip 离线复制 python 运行环境</title>
    <link href="/2021/04/15/coding/environment/pip-env-install-off-line/pip-env-install-off-line/"/>
    <url>/2021/04/15/coding/environment/pip-env-install-off-line/pip-env-install-off-line/</url>
    
    <content type="html"><![CDATA[<blockquote><p>python 运行时会有不同环境需求，在其他机器部署时需要重新配置python环境，当需要离线部署时可以使用pip的离线复制环境的功能。</p></blockquote><span id="more"></span><h3 id="工作思路"><a href="#工作思路" class="headerlink" title="工作思路"></a>工作思路</h3><ol><li>获取环境所需的库和对应版本</li><li>确定运行平台（Linux，Windows）</li><li>在指定平台下载库的离线包</li><li>将库列表与离线包迁移到新机器</li><li>在新机器上安装python</li><li>安装离线包</li><li>程序调试</li></ol><h3 id="具体操作流程"><a href="#具体操作流程" class="headerlink" title="具体操作流程"></a>具体操作流程</h3><h4 id="获取环境所需的库和对应版本"><a href="#获取环境所需的库和对应版本" class="headerlink" title="获取环境所需的库和对应版本"></a>获取环境所需的库和对应版本</h4><ul><li>在源机器安装<code>pipreqs</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install pipreqs<br></code></pre></td></tr></table></figure><blockquote><p>pipreqs可以帮你找到当前项目的所有组件及其版本。</p></blockquote><ul><li>获取库与版本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pipreqs ./  # 报错就执行下面这条<br>pipreqs ./ --encoding=utf-8<br></code></pre></td></tr></table></figure><blockquote><p>成功后会在当前目录生成 <code>requirements.txt</code>文件</p><p>例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs txt">numba==0.53.1<br>matplotlib==3.3.2<br>opencv_python_headless==4.5.1.48<br>pynvml==8.0.4<br>tqdm==4.49.0<br>numpy==1.19.2<br>pathlib2==2.3.5<br>line_profiler==3.1.0<br>Pillow==8.2.0<br></code></pre></td></tr></table></figure></blockquote><h4 id="下载库的离线包"><a href="#下载库的离线包" class="headerlink" title="下载库的离线包"></a>下载库的离线包</h4><ul><li>获取<code>requirements.txt</code>后下载对应包，使用<code>pip download</code>命令将包存入<code>packages</code>文件夹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir packages<br>pip download -r requirements.txt -d e:/packages/<br></code></pre></td></tr></table></figure><blockquote><p>目标路径不是绝对路径有可能出问题</p><p>也可以不用手动创建文件夹，pip会自动创建对应文件夹</p></blockquote><ul><li>也可以下载指定的包</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip download numpy -d e:/packages/<br></code></pre></td></tr></table></figure><blockquote><p><strong>注意：</strong>这个命令如果中途遇到问题报错没有执行完则不会将所有之前下载的包放到目标文件夹，需要逐个解决问题后才会移动到指定位置</p><p><strong>Tips</strong>：建议将pip源换成阿里云，成功率高很多</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210415171821.png" alt="上述包文件下载后的结果"></p><h4 id="安装离线包"><a href="#安装离线包" class="headerlink" title="安装离线包"></a>安装离线包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install --no-index --find-links=e:/packages/ -r requirements.txt<br></code></pre></td></tr></table></figure><table><thead><tr><th>选项</th><th>含义</th></tr></thead><tbody><tr><td>–no-index</td><td>忽略包索引（只查看–find-links）</td></tr><tr><td>–find-links</td><td>指向 URL,html 文件 tar.gz,whl 或者目录，不支持指向VCS项目URL的链接</td></tr><tr><td>–ignore-installed</td><td>忽略已安装的软件包，覆盖它们</td></tr></tbody></table><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.cnblogs.com/believepd/p/10423094.html">https://www.cnblogs.com/believepd/p/10423094.html</a></li><li><a href="https://blog.csdn.net/u010383467/article/details/112274008">https://blog.csdn.net/u010383467/article/details/112274008</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>pip</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>pip</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>降维算法 - SNE</title>
    <link href="/2021/04/15/machine_learning/sne-alg/sne-alg/"/>
    <url>/2021/04/15/machine_learning/sne-alg/sne-alg/</url>
    
    <content type="html"><![CDATA[<blockquote><p>SNE是一种数据降维算法，最早出现在2002年，它改变了MDS和ISOMAP中基于距离不变的思想，将高维映射到低维的同时，尽量保证相互之间的分布概率不变，SNE将高维和低维中的样本分布都看作高斯分布，而Tsne将低维中的坐标当做T分布，这样做的好处是为了让距离大的簇之间距离拉大，从而解决了拥挤问题。。</p></blockquote><span id="more"></span><h3 id="SNE"><a href="#SNE" class="headerlink" title="SNE"></a>SNE</h3><ul><li>高维数据用X表示，Xi表示第i个样本，低维数据用Y表示，则高维中的分布概率矩阵P定义如下：</li></ul><p>$$<br>p _ { j |i } = \frac { exp ( - ||  x _ { i } - x _ { j }|| ^ { 2 } ( 2 \sigma _ { i } ^ { 2 } ) } { \sum _ {<br>k \neq 1 }  ( - || x _ { i } - x _ { k }  ^ { 2 } || ^ { 2 } ( 2 \sigma _ { i } ^ { 2 } )}<br>$$</p><ul><li><p>$P(i,j)$表示第$i$个样本分布在样本$j$周围的概率。$\sigma$是依据最大熵原理来决定，以每个样本点作为中心的$\sigma$都需要使得最后分布的熵较小，通常以$log(k)$为上限，$k$为你所决定的邻域点的个数</p></li><li><p>低维中的分布概率矩阵计算如下：<br>$$<br>q_{j \mid i}=\frac{\exp \left(-\left|y_{i}-y_{j}\right|^{2}\right)}{\sum_{k \neq i} \exp \left(-\left|y_{i}-y_{k}\right|^{2}\right)}<br>$$</p></li><li><p>这里我们把低维中的分布看作是均衡的，每个delta都是0.5，由此可以基本判断最后降维之后生成的分布也是一个相对均匀的分布。</p></li><li><p>随机给定一个初始化的Y，进行优化，使得Y的分布矩阵逼近X的分布矩阵。我们给定目的函数，用KL散度来定义两个不同分布之间的差距：</p></li></ul><p>$$<br>C=\sum_{i} K L\left(P_{i} | Q_{i}\right)=\sum_{i} \sum_{j} p_{j \mid i} \log \frac{p_{j \mid i}}{q_{j \mid i}}<br>$$</p><ul><li>则可以计算梯度为：</li></ul><p>$$<br>\frac{\delta C}{\delta y_{i}}=2 \sum_{j}\left(p_{j \mid i}-q_{j \mid i}+p_{i \mid j}-q_{i \mid j}\right)\left(y_{i}-y_{j}\right)<br>$$</p><ul><li>每次梯度下降的步长可设定固定或者自适应、随机等，也可以加上一个动量的梯度，初始值一般设为1e-4的随机正态分布。</li></ul><p>$$ \mathcal{Y}^{(t)}=\mathcal{Y}^{(t-1)}+\eta \frac{\delta C}{\delta \mathcal{Y}}+\alpha(t)\left(\gamma^{(t-1)}-\mathcal{Y}^{(t-2)}\right) $$</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/zhangweiguo_717/article/details/70188517">https://blog.csdn.net/zhangweiguo_717/article/details/70188517</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>dimension reduction</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>dimension reduction</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python CUDA 编程 - 1 - 基础概念</title>
    <link href="/2021/04/15/deep_learning/speed_up/numba/numba/"/>
    <url>/2021/04/15/deep_learning/speed_up/numba/numba/</url>
    
    <content type="html"><![CDATA[<blockquote><p>基于CPU和GPU的异构计算已经逐步发展成为高性能计算的主流模式。CUDA作为GPU高性能计算的主要开发工具之一，已经在各个领域取得广泛应用。</p></blockquote><span id="more"></span><h3 id="什么是GPU"><a href="#什么是GPU" class="headerlink" title="什么是GPU"></a>什么是GPU</h3><blockquote><p>GPU全名为Graphics Processing Unit，又称视觉处理器、图形显示卡。GPU负责渲染出2D、3D、VR效果，主要专注于计算机图形图像领域。后来人们发现，GPU非常适合并行计算，可以加速现代科学计算，GPU也因此不再局限于游戏和视频领域。</p></blockquote><h3 id="加速原理"><a href="#加速原理" class="headerlink" title="加速原理"></a>加速原理</h3><blockquote><p>为了同时并行地处理更多任务，芯片公司开发出了多核架构，只要相互之间没有依赖，每个核心做自己的事情，多核之间互不干扰，就可以达到<strong>并行计算</strong>的效果，极大缩短计算时间。</p></blockquote><h3 id="CPU与GPU"><a href="#CPU与GPU" class="headerlink" title="CPU与GPU"></a>CPU与GPU</h3><p><img src="https://photos.zywvvd.com/image_canglan/20210415014639.png"></p><blockquote><p>CPU主要从主存（Main Memory）中读写数据，并通过总线（Bus）与GPU交互。GPU除了有超多计算核心外，也有自己独立的存储，被称之为显存。一台服务器上可以安装多块GPU卡，但GPU卡的发热量极大，普通的空调系统难以给大量GPU卡降温，所以大型数据中心通常使用水冷散热，并且选址在温度较低的地方。</p></blockquote><h3 id="主机与设备"><a href="#主机与设备" class="headerlink" title="主机与设备"></a>主机与设备</h3><blockquote><p>由于CPU和GPU是分开的，在英伟达的设计理念里，CPU和主存被称为<strong>主机（Host）</strong>，GPU被称为<strong>设备（Device）</strong>。Host和Device概念会贯穿整个英伟达GPU编程，甚至包括OpenCL等其他平台。</p><p>以上结构也被称为<strong>异构计算</strong>：使用CPU+GPU组合来加速计算。绝大多数的高性能计算中心会使用上图所示的结构，比如一台服务器上有2至4块Intel Xeon CPU和1至8块英伟达GPU显卡，多台机器之间通过InfiniBand高速网络互联。</p></blockquote><h3 id="英伟达GPU硬件架构"><a href="#英伟达GPU硬件架构" class="headerlink" title="英伟达GPU硬件架构"></a>英伟达GPU硬件架构</h3><blockquote><p>在英伟达的设计里，多个核心组成一个Streaming Multiprocessor（<strong>SM</strong>），一张GPU卡有多个SM。从“Multiprocessor”这个名字上也可以看出SM包含了多个处理器。实际上，英伟达主要以SM为运算和调度的基本单元。</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20210415015000.png"></p><p>英伟达不同时代产品的芯片设计不同，每代产品背后有一个微架构代号，微架构均以著名的物理学家为名，以向先贤致敬。当前比较火热的架构有：</p><ul><li>Ampere 安培<ul><li>2020年5月发布</li><li>专业显卡：Telsa A100</li></ul></li><li>Turing 图灵<ul><li>2018年发布</li><li>消费显卡：GeForce RTX 2080 Ti、Titan RTX</li></ul></li><li>Volta 伏特<ul><li>2017年末发布</li><li>专业显卡：Telsa V100 (16或32GB显存 5120个CUDA核心)</li></ul></li><li>Pascal 帕斯卡<ul><li>2016年发布</li><li>专业显卡：Telsa P100(12或16GB显存 3584个CUDA核心)</li></ul></li></ul><h3 id="软件生态"><a href="#软件生态" class="headerlink" title="软件生态"></a>软件生态</h3><blockquote><p>英伟达能够在人工智能时代成功，除了他们在长期深耕显卡芯片领域，更重要的是他们率先提供了可编程的软件架构，确切地说，软硬件一体方案帮他们赢得了市场。2007年，英伟达发布了CUDA（Compute Unified Device Architecture）编程模型，软件开发人员从此可以使用CUDA在英伟达的GPU上进行并行编程。在此之前，GPU编程并不友好。CUDA简单到什么程度？有经验的程序员经过半天的培训，掌握一些基础概念后，能在半小时内将一份CPU程序修改成为GPU并行程序。</p></blockquote><blockquote><p>继CUDA之后，英伟达不断丰富其软件技术栈，提供了科学计算所必需的cuBLAS线性代数库，cuFFT快速傅里叶变换库等，当深度学习大潮到来时，英伟达提供了cuDNN深度神经网络加速库，目前常用的TensorFlow、PyTorch深度学习框架的底层大多基于cuDNN库。</p></blockquote><p>关于英伟达的软件栈，可以总结为：</p><ul><li>最底层是GPU硬件，包括各类GPU显卡，DGX工作站等。</li><li>操作系统是基于硬件的第一层软件，在操作系统上我们需要安装GPU驱动。</li><li>CUDA在GPU驱动之上，有了CUDA，我们可以进行一些GPU编程。</li><li>英伟达对相似计算进一步抽象，进而有了cuBLAS、cuFFT、cuDNN等库，这些库基于CUDA提供常见的计算。</li><li>最顶层是应用，包括TensorFlow和PyTorch的模型训练和推理过程。</li></ul><h3 id="CUDA"><a href="#CUDA" class="headerlink" title="CUDA"></a>CUDA</h3><blockquote><p>英伟达能在人工智能时代击败Intel、AMD等强大对手，很大一部分是因为它丰富的软件体系。这些软件工具库使研发人员专注于自己的研发领域，不用再去花大量时间学习GPU底层知识。CUDA对于GPU就像个人电脑上的Windows、手机上的安卓系统，一旦建立好生态，吸引了开发者，用户非常依赖这套软件生态体系。</p></blockquote><ul><li>GPU编程可以直接使用CUDA的C/C++版本进行编程，也可以使用其他语言包装好的库，比如Python可使用Numba库调用CUDA。CUDA的编程思想在不同语言上都很相似。</li></ul><p>CUDA及其软件栈的优势是方便易用，缺点也显而易见：</p><ol><li>软件环境复杂，库以及版本很多，顶层应用又严重依赖底层工具库，入门者很难快速配置好一整套环境；多环境配置困难。</li><li>用户只能使用英伟达的显卡，成本高，个人用户几乎负担不起。</li></ol><h3 id="英伟达之外的选项"><a href="#英伟达之外的选项" class="headerlink" title="英伟达之外的选项"></a>英伟达之外的选项</h3><ul><li><p>前文对GPU的描述主要基于英伟达旗下产品。在GPU领域，AMD也提供了独立显卡产品，价格较低。历史上，AMD的显卡产品线是收购ATI而获得的。相对来说，AMD的显卡在人工智能和超级计算领域并没有英伟达强势。为了与CUDA对抗，AMD提供的软件开发平台名为ROCm（Radeon Open Compute platforM ）。</p></li><li><p>与相对封闭的CUDA不同，OpenCL（Open Computing Language)也是当前重要的计算加速平台，可以兼容英伟达和AMD的GPU，以及一些FPGA等硬件。一些上层软件为了兼容性，在计算加速部分并没有使用CUDA，而是使用了OpenCL。比如，决策树算法框架LightGBM主要基于OpenCL进行GPU加速。</p></li></ul><blockquote><p>无论是ROCm还是OpenCL，其编程思想与CUDA都非常相似，如果掌握了CUDA，那上手OpenCL也会很容易。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://lulaoshi.info/gpu/gpu-basic/gpu.html">https://lulaoshi.info/gpu/gpu-basic/gpu.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 10 - 常见概率分布</title>
    <link href="/2021/04/14/math/probability/distributions/distributions/distributions/"/>
    <url>/2021/04/14/math/probability/distributions/distributions/distributions/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录常见的概率分布。</p></blockquote><span id="more"></span><h3 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h3><h4 id="probability-mass-function-PMF"><a href="#probability-mass-function-PMF" class="headerlink" title="probability mass function:PMF"></a>probability mass function:PMF</h4><ul><li>概率质量函数（离散随机变量密度函数）</li><li>和为1</li></ul><h4 id="probability-density-function：PDF"><a href="#probability-density-function：PDF" class="headerlink" title="probability density function：PDF"></a>probability density function：PDF</h4><ul><li>概率密度函数（连续随机变量）</li><li>积分为1</li></ul><h3 id="常见分布"><a href="#常见分布" class="headerlink" title="常见分布"></a>常见分布</h3><h4 id="均匀分布"><a href="#均匀分布" class="headerlink" title="均匀分布"></a>均匀分布</h4><h5 id="离散随机变量的均匀分布"><a href="#离散随机变量的均匀分布" class="headerlink" title="离散随机变量的均匀分布"></a>离散随机变量的均匀分布</h5><ul><li>假设 $ X $ 有 $ k $ 个取值: $ x_{1}, x_{2}, \cdots, x_{k} $, 则均匀分布的概率密度函数( probability mass function:PMF )为:</li></ul><p>$$<br>p\left(X=x_{i}\right)=\frac{1}{k}, \quad i=1,2, \cdots, k<br>$$</p><h5 id="连续随机变量的均匀分布"><a href="#连续随机变量的均匀分布" class="headerlink" title="连续随机变量的均匀分布"></a>连续随机变量的均匀分布</h5><ul><li>假设 $ X $ 在 $ [\mathrm{a}, \mathrm{b}] $ 上均匀分布，则其概率密度函数( probability density function: PDF )为:</li></ul>$$p(X=x)=\left\{\begin{array}{ll}0, & x \notin[a, b] \\\frac{1}{b-a}, & x \in[a, b]\end{array}\right.$$<ul><li>期望：</li></ul>$$\begin{array}{l}\mu  &= \int_a^b {\frac{1}{{b - a}}xdx} \\ &= \frac{{{b^2} - {a^2}}}{{2(b - a)}}\\ &= \frac{{b - a}}{2}\end{array}$$<ul><li>方差：</li></ul>$$\begin{array}{l}{\sigma ^2} &= \int_a^b {\frac{1}{{b - a}}{{(x - \mu )}^2}dx} \\ &= \frac{1}{{3(b - a)}}\int_a^b {d{{(x - \mu )}^3}} \\ &= \frac{1}{{3(b - a)}}[{(\frac{{b - a}}{2})^3} - {(\frac{{a - b}}{2})^3}]\\ &= \frac{{{{(b - a)}^2}}}{{12}}\end{array}$$<h4 id="伯努利分布"><a href="#伯努利分布" class="headerlink" title="伯努利分布"></a>伯努利分布</h4><ol><li>伯努利分布：参数为 $ \phi \in[0,1]_{\circ} $ 随机变量 $ X \in{0,1} $ 。</li></ol><ul><li>概率分布函数： $ p(X=x)=\phi^{x}(1-\phi)^{1-x}, x \in{0,1} $ </li><li>期望: $ \mathbb{E}[X]=\phi $ </li><li>方差: $ \operatorname{Var}[X]=\phi(1-\phi) $ </li></ul><ol start="2"><li>categorical 分布：它是二项分布的推广, 也称作 multinoulli 分布。假设随机变量 $ X \in{1,2, \cdots, K} $, 其概率分布函数为:</li></ol>$$\begin{array}{c}p(X=1)=\theta_{1} \\p(X=2)=\theta_{2} \\\vdots \\p(X=K-1)=\theta_{K-1} \\p(X=K)=1-\sum_{i=1}^{K-1} \theta_{i}\end{array}$$​<p>​        其中 $ \theta_{i} $ 为参数, 它满足 $ \theta_{i} \in[0,1] $, 且 $ \sum_{i=1}^{K-1} \theta_{i} \in[0,1] $ 。</p><h4 id="二项分布"><a href="#二项分布" class="headerlink" title="二项分布"></a>二项分布</h4><ol><li>假设试验只有两种结果：成功的概率为 $ \phi $, 失败的概率为 $ 1-\phi_{\circ} $ 则二项分布描述了：独立重复地进行 $ n $ 次 试验中，成功 $ x $ 次的概率。</li></ol><ul><li>概率质量函数:<br>$$<br>p(X=x)=\frac{n !}{x !(n-x) !} \phi^{x}(1-\phi)^{n-x}, x \in{0,1, \cdots, n}<br>$$<ul><li>期望: $ \mathbb{E}[X]=n \phi_{\circ} $</li><li>方差: $ \operatorname{Var}[X]=n \phi(1-\phi) $ </li></ul></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>表面模糊原理与 python 实现</title>
    <link href="/2021/04/13/image_processing/surface-blur/surface-blur/"/>
    <url>/2021/04/13/image_processing/surface-blur/surface-blur/</url>
    
    <content type="html"><![CDATA[<blockquote><p>常规的模糊算法如高斯模糊等会模糊图像边缘，很多场景中我们需要保留图像纹理并模糊一些细节，这就可以使用PS中的表面模糊。</p></blockquote><span id="more"></span><h3 id="表面模糊"><a href="#表面模糊" class="headerlink" title="表面模糊"></a>表面模糊</h3><ul><li>表面模糊有两个参数，半径Radius和阈值Threshold。 如果我们知道了以某点为中心，半径为Radius范围内的直方图数据Hist，以及该点的像素值，那根据原始的算法，其计算公式为：</li></ul><p>$$<br>x = \frac { \sum _ { i = 1 } ^ { ( 2 r + 1 ) ^ { 2 } } [ ( 1 - \frac { | x _ { i } - x _ { 1 } | } { 2.5 Y } ) x _ { i } ] } { \sum _ { i = 1 } ^ { ( 2 r + 1 ) ^ { 2 } } ( 1 - \frac { | x _ { i } - x _ { 1 } | } { 2.5 Y } ) }<br>$$</p><blockquote><p>其中：$r $为半径，$Y$为阈值， $x_1$为当前像素阶值，$x_i$为模板中某个像素值，$x$为当前像素结果阶值</p></blockquote><ul><li>主要思想还是计算当前像素X的邻域范围内不同像素的加权求和，边缘地方的像素，加权比较大，平滑的地方加权比较小，以此来保留边缘信息，平滑平坦区域；</li><li>python 代码：</li></ul><blockquote><p>参考了网络流行的Python版本，做了一点点优化和修正</p><p>使用了numba cpu加速，可以提速10倍，但还是没有c++快</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@nb.jit(<span class="hljs-params">nopython=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Surface_blur</span>(<span class="hljs-params">I_in, thre, radius</span>):</span><br><br>    I_out = I_in.copy()<br>    row, col = I_in.shape<br><br>    <span class="hljs-keyword">for</span> ii <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(radius, row-<span class="hljs-number">1</span>-radius):<br>        <span class="hljs-keyword">for</span> jj <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(radius, col - <span class="hljs-number">1</span> - radius):<br>            p0 = I_in[ii, jj]<br>            aa = I_in[ii-radius: ii+radius+<span class="hljs-number">1</span>, jj-radius: jj + radius + <span class="hljs-number">1</span>]<br><br>            mask_2 = <span class="hljs-number">1</span>-np.<span class="hljs-built_in">abs</span>(aa-p0)/(<span class="hljs-number">2.5</span>*thre)<br>            mask_3 = mask_2 * (mask_2 &gt; <span class="hljs-number">0</span>)<br>            t1 = aa * mask_3<br>            I_out[ii, jj] = t1.<span class="hljs-built_in">sum</span>()/mask_3.<span class="hljs-built_in">sum</span>()<br><br>    <span class="hljs-keyword">return</span> I_out<br><br></code></pre></td></tr></table></figure><ul><li>numba CUDA 加速代码：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> numba <span class="hljs-keyword">import</span> cuda<br><br><span class="hljs-meta">@cuda.jit</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">image_process_cuda</span>(<span class="hljs-params">img_cuda, result_img_cuda, y_size, x_size</span>):</span><br>    y = cuda.threadIdx.y + cuda.blockDim.y * cuda.blockIdx.y<br>    x = cuda.threadIdx.x + cuda.blockDim.x * cuda.blockIdx.x<br><br>    radius = <span class="hljs-number">8</span><br>    thre = <span class="hljs-number">20</span><br>    <span class="hljs-keyword">if</span> radius &lt; y &lt; y_size-radius <span class="hljs-keyword">and</span> radius &lt; x &lt; x_size-radius:<br>        a = <span class="hljs-number">0.0</span><br>        b = <span class="hljs-number">0.0</span><br>        x_1 = <span class="hljs-built_in">float</span>(img_cuda[y, x, <span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">for</span> x_index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(x-radius, x+radius+<span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">for</span> y_index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(y-radius, y+radius+<span class="hljs-number">1</span>):<br>                x_i = <span class="hljs-built_in">float</span>(img_cuda[y_index, x_index, <span class="hljs-number">0</span>])<br>                <br>                temp_b = (<span class="hljs-number">1</span> - <span class="hljs-built_in">abs</span>(x_i - x_1) / <span class="hljs-number">2.5</span> / thre)<br>                <span class="hljs-keyword">if</span> temp_b &lt;= <span class="hljs-number">0</span>:<br>                    <span class="hljs-keyword">continue</span><br>                b += temp_b<br>                a += temp_b * x_i<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>            result_img_cuda[y, x, i] = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">round</span>(a / b))<br></code></pre></td></tr></table></figure><blockquote><p>调用：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">img = ...<br>ori_image_cuda = cuda.to_device(img)<br>copy_image_cuda = cuda.to_device(copy_image)<br>image_process_cuda[blocks_per_grid, threads_per_block](ori_image_cuda, copy_image_cuda, y_size, x_size)<br>result_img = copy_image_cuda.copy_to_host()<br></code></pre></td></tr></table></figure><blockquote><p>相比于 cpu 加速运算可以有百倍以上的速度提升</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/matrix_space/article/details/52818857">https://blog.csdn.net/matrix_space/article/details/52818857</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>image_processing</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>image_processing</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>错误 Stale NFS file handle 解决方法</title>
    <link href="/2021/04/08/linux/mount/Stale-NFS-file-handle/Stale-NFS-file-handle/"/>
    <url>/2021/04/08/linux/mount/Stale-NFS-file-handle/Stale-NFS-file-handle/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录错误 <code> Stale NFS file handle</code> 的解决方法 。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">@ mount -o nfsvers=3 10.0.1.84:/home/share /mnt<br>mount.nfs: Stale NFS file handle<br></code></pre></td></tr></table></figure><blockquote><p>错误原因是客户端之前挂载的mnt目录在没有卸载的情况下，服务器侧把这个目录移除了，才会出现这样的错误提示。</p></blockquote><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><blockquote><p>解决的办法就是在客户端 <code>umount</code> 一下，重新挂载就好。</p></blockquote><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">umount <span class="hljs-string">/mnt</span><br>mount -t nfs <span class="hljs-string">/share</span> <span class="hljs-string">/mnt</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.51cto.com/naonao/1412212">https://blog.51cto.com/naonao/1412212</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>调用 Mathpix AIP 实现每月1000次免费识别</title>
    <link href="/2021/04/07/tools/math-pix-api-usage/math-pix-api-usage/"/>
    <url>/2021/04/07/tools/math-pix-api-usage/math-pix-api-usage/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Mathpix 是优秀的img2latax工具，对于普通用户来说每月有50-100次免费机会，对于需求量大的用户无法满足需求。有一种方法是调用Mathpix官方的API，每月1000次免费机会。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p><a href="https://mathpix.com/">Mathpix</a>是一款跨平台（Windows、macOS、Linux）的 OCR 工具，它能够识别复杂的数学公式，并将其转换为 LaTeX 语法。</p><p>LaTeX 是一个十分强大切流行的排版系统，除了能编写数学公式，还能非常完整的撰写学术论文，并且被国际各大机构接受，但一直以入门难著称。</p><p>Mathpix 能够直接截取数学公式的图片，将截图转换为 LaTeX 语法，非常简单方便，并且支持三大主流系统。</p></blockquote><ul><li>当前Mathpix收费，无限次识别的Pro账户每个月需要4.99$</li><li>但是如果调用Mathpix的API的话，每个账户每个月的前 1000 次请求免费；随后的第 1-100 千次，每次 0.004 美元；第 100- 300 千次，每次 0.002 美元。这种收费模式显然比较合理，至少每个月有1000次的免费调用机会。</li><li>官网链接：<a href="https://mathpix.com/">https://mathpix.com/</a></li></ul><h3 id="注册账号"><a href="#注册账号" class="headerlink" title="注册账号"></a>注册账号</h3><ul><li><a href="https://accounts.mathpix.com/login">https://accounts.mathpix.com/login</a></li><li>注册 MathPix 账号</li><li>登录账号</li></ul><h3 id="创建API"><a href="#创建API" class="headerlink" title="创建API"></a>创建API</h3><ul><li>选择 OCR API</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210407002527.png"></p><ul><li>接受一个激活协议</li><li>使用信用卡激活</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210407002800.png"></p><ul><li><p>此处只能使用信用卡</p><ul><li>卡号填卡号</li><li>日期填卡上的日期</li><li>CVC是卡背面数字的后三位</li></ul></li><li><p><strong>此处会有1$的消费</strong></p></li><li><p>成功后会获得 <code>App ID</code>和 <code>App Key</code></p><p><img src="https://photos.zywvvd.com/image_canglan/20210407003041.png"></p></li></ul><h3 id="调用官方API"><a href="#调用官方API" class="headerlink" title="调用官方API"></a>调用官方API</h3><ul><li>官方文档 <a href="https://docs.mathpix.com/">https://docs.mathpix.com</a></li><li>API的示例<a href="https://github.com/Mathpix/api-examples">https://github.com/Mathpix/api-examples</a></li><li>核心调用代码（python）：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> requests<br><br>env = os.environ<br><br>default_headers = &#123;<br>    <span class="hljs-string">&#x27;app_id&#x27;</span>: env.get(<span class="hljs-string">&#x27;APP_ID&#x27;</span>, <span class="hljs-string">&#x27;你的APP_ID&#x27;</span>),<br>    <span class="hljs-string">&#x27;app_key&#x27;</span>: env.get(<span class="hljs-string">&#x27;APP_KEY&#x27;</span>, <span class="hljs-string">&#x27;你的APP_KEY&#x27;</span>),<br>    <span class="hljs-string">&#x27;Content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>&#125;<br><br>service = <span class="hljs-string">&#x27;https://api.mathpix.com/v3/latex&#x27;</span><br><br>...<br><br>r = requests.post(service, data=json.dumps(args), headers=headers, timeout=timeout)<br><br><span class="hljs-keyword">return</span> json.loads(r.text)<br><br></code></pre></td></tr></table></figure><h3 id="python-桌面应用"><a href="#python-桌面应用" class="headerlink" title="python 桌面应用"></a>python 桌面应用</h3><ul><li>我们使用一位大佬的python应用为例</li><li><a href="https://github.com/Joshua-li-yi/img2latex">https://github.com/Joshua-li-yi/img2latex</a><ul><li>代码中 <code>def grapclipboard(self):</code> 应为  <code>def grabclipboard(self): </code></li></ul></li><li>代码如下：</li></ul><details>  <summary>python 代码</summary><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> PyQt5.QtGui<br><span class="hljs-keyword">import</span> PyQt5.QtCore<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QApplication, QLabel, QPushButton, QWidget, QGridLayout, QLineEdit<br><span class="hljs-keyword">from</span> PyQt5.QtCore <span class="hljs-keyword">import</span> Qt<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> ImageGrab<br><span class="hljs-keyword">import</span> pyperclip<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br>env = os.environ<br><br>default_headers = &#123;<br>    <span class="hljs-string">&#x27;app_id&#x27;</span>: env.get(<span class="hljs-string">&#x27;APP_ID&#x27;</span>, <span class="hljs-string">&#x27;你的APP_ID&#x27;</span>),<br>    <span class="hljs-string">&#x27;app_key&#x27;</span>: env.get(<span class="hljs-string">&#x27;APP_KEY&#x27;</span>, <span class="hljs-string">&#x27;你的APP_KEY&#x27;</span>),<br>    <span class="hljs-string">&#x27;Content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span><br>&#125;<br><br>service = <span class="hljs-string">&#x27;https://api.mathpix.com/v3/latex&#x27;</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Img2Latex</span>(<span class="hljs-params">QWidget</span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.initUI()<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">initUI</span>(<span class="hljs-params">self</span>):</span><br>        self.setGeometry(<span class="hljs-number">300</span>, <span class="hljs-number">300</span>, <span class="hljs-number">800</span>, <span class="hljs-number">700</span>)<br>        self.setWindowTitle(<span class="hljs-string">&#x27;Img2Latex&#x27;</span>)<br>    <br>        <span class="hljs-comment"># copy latex</span><br>        self.Latex1copyBtn = QPushButton()<br>        self.Latex2copyBtn = QPushButton()<br>        self.Latex3copyBtn = QPushButton()<br>        <span class="hljs-comment"># set copy btn icon</span><br>        self.Latex1copyBtn.setIcon(PyQt5.QtGui.QIcon(<span class="hljs-string">r&quot;.\img\copy.png&quot;</span>))<br>        self.Latex2copyBtn.setIcon(PyQt5.QtGui.QIcon(<span class="hljs-string">r&quot;.\img\copy.png&quot;</span>))<br>        self.Latex3copyBtn.setIcon(PyQt5.QtGui.QIcon(<span class="hljs-string">r&quot;.\img\copy.png&quot;</span>))<br>    <br>        <span class="hljs-comment"># edit latex</span><br>        self.Latex1EditBtn = QPushButton()<br>        self.Latex2EditBtn = QPushButton()<br>        self.Latex3EditBtn = QPushButton()<br>        <span class="hljs-comment"># set edit btn icon</span><br>        self.Latex1EditBtn.setIcon(PyQt5.QtGui.QIcon(<span class="hljs-string">r&quot;.\img\edit.png&quot;</span>))<br>        self.Latex2EditBtn.setIcon(PyQt5.QtGui.QIcon(<span class="hljs-string">r&quot;.\img\edit.png&quot;</span>))<br>        self.Latex3EditBtn.setIcon(PyQt5.QtGui.QIcon(<span class="hljs-string">r&quot;.\img\edit.png&quot;</span>))<br>    <br>        <span class="hljs-comment"># img to latex convert btn</span><br>        self.img2latexBtn = QPushButton(<span class="hljs-string">&#x27;convert&#x27;</span>)<br>    <br>        <span class="hljs-comment"># show the picture on clipboard</span><br>        self.imgLable = QLabel()<br>    <br>        <span class="hljs-comment"># show the formula in latex</span><br>        self.Latex1Edit = QLineEdit()<br>        self.Latex2Edit = QLineEdit()<br>        self.Latex3Edit = QLineEdit()<br>        self.Latex1Edit.setEnabled(<span class="hljs-literal">False</span>)<br>        self.Latex2Edit.setEnabled(<span class="hljs-literal">False</span>)<br>        self.Latex3Edit.setEnabled(<span class="hljs-literal">False</span>)<br>    <br>        <span class="hljs-comment"># # show the convert latex result</span><br>        <span class="hljs-comment"># self.reviewImgLable = QLabel()</span><br>        <span class="hljs-comment"># self.reviewImgLable.setStyleSheet(&quot;border: 2px solid red&quot;)</span><br>    <br>        grid = QGridLayout()<br>        grid.setSpacing(<span class="hljs-number">20</span>)<br>    <br>        <span class="hljs-comment"># 排版</span><br>        grid.addWidget(self.imgLable, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<br>    <br>        grid.addWidget(self.img2latexBtn,<span class="hljs-number">6</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br>    <br>        grid.addWidget(self.Latex1Edit, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>)<br>        grid.addWidget(self.Latex1copyBtn, <span class="hljs-number">7</span>, <span class="hljs-number">1</span>)<br>        <span class="hljs-comment"># grid.addWidget(self.Latex1EditBtn, 7, 2)</span><br>    <br>        grid.addWidget(self.Latex2copyBtn, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>)<br>        grid.addWidget(self.Latex2Edit, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>)<br>        <span class="hljs-comment"># grid.addWidget(self.Latex2EditBtn, 8, 2)</span><br>    <br>        grid.addWidget(self.Latex3copyBtn, <span class="hljs-number">9</span>, <span class="hljs-number">1</span>)<br>        grid.addWidget(self.Latex3Edit, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>)<br>        <span class="hljs-comment"># grid.addWidget(self.Latex3EditBtn, 9, 2)</span><br>    <br>        <span class="hljs-comment"># grid.addWidget(self.reviewImgLable, 10, 0, 4, 3)</span><br>    <br>        self.setLayout(grid)<br>    <br>        <span class="hljs-comment"># sign and slot</span><br>    <br>        <span class="hljs-comment"># img to latex convert</span><br>        self.img2latexBtn.clicked.connect(self.convert)<br>    <br>        <span class="hljs-comment"># copy latex</span><br>        self.Latex1copyBtn.clicked.connect(self.copyLatex1)<br>        self.Latex2copyBtn.clicked.connect(self.copyLatex2)<br>        self.Latex3copyBtn.clicked.connect(self.copyLatex3)<br>    <br>        <span class="hljs-comment"># edit latex</span><br>        <span class="hljs-comment"># self.Latex1EditBtn.clicked.connect(self.Latex1EditImg)</span><br>        <span class="hljs-comment"># self.Latex1Edit.textChanged.connect(self.Latex1EditImg)</span><br>    <br>        <span class="hljs-comment"># self.Latex2EditBtn.clicked.connect(self.Latex2EditImg)</span><br>        <span class="hljs-comment"># self.Latex2Edit.textChanged.connect(self.Latex2EditImg)</span><br>    <br>        <span class="hljs-comment"># self.Latex3EditBtn.clicked.connect(self.Latex3EditImg)</span><br>        <span class="hljs-comment"># self.Latex3Edit.textChanged.connect(self.Latex3EditImg)</span><br>    <br>        <span class="hljs-comment"># beautify the window</span><br>        self.Beautify()<br>        self.show()<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Beautify</span>(<span class="hljs-params">self</span>):</span><br>        self.setWindowOpacity(<span class="hljs-number">0.9</span>)  <span class="hljs-comment"># 设置窗口透明度</span><br>        <span class="hljs-comment"># self.setAttribute(qtpy.QtCore.Qt.WA_TranslucentBackground) # 设置窗口背景透明</span><br>        <span class="hljs-comment"># self.setWindowFlag(qtpy.QtCore.Qt.FramelessWindowHint) # 隐藏边框</span><br>        pe = PyQt5.QtGui.QPalette()<br>        self.setAutoFillBackground(<span class="hljs-literal">True</span>)<br>        <span class="hljs-comment"># pe.setColor(PyQt5.QtGui.QPalette.Window, Qt.Black)  #设置背景色</span><br>        pe.setColor(PyQt5.QtGui.QPalette.Background, Qt.black)<br>        self.setPalette(pe)<br>        self.imgLable.setStyleSheet(<br>            <span class="hljs-string">&#x27;&#x27;&#x27; QLabel&#123;</span><br><span class="hljs-string">                border: 2px solid red;</span><br><span class="hljs-string">                border-radius:15px;</span><br><span class="hljs-string">                padding:2px 4px;</span><br><span class="hljs-string">                background-color:#aaa;</span><br><span class="hljs-string">            &#125;&#x27;&#x27;&#x27;</span>)<br>        <br>        self.Latex1Edit.setStyleSheet(<br>            <span class="hljs-string">&#x27;&#x27;&#x27;QLineEdit&#123;</span><br><span class="hljs-string">                border:1px solid gray;</span><br><span class="hljs-string">                border-radius:10px;</span><br><span class="hljs-string">                padding:2px 4px;</span><br><span class="hljs-string">                background-color:#ddd;</span><br><span class="hljs-string">                height:35px;</span><br><span class="hljs-string">                font-color:black;</span><br><span class="hljs-string">                font-weight:1000;</span><br><span class="hljs-string">                font-size:24px</span><br><span class="hljs-string">            &#125;&#x27;&#x27;&#x27;</span>)<br>        self.Latex2Edit.setStyleSheet(<br>            <span class="hljs-string">&#x27;&#x27;&#x27;QLineEdit&#123;</span><br><span class="hljs-string">                border:1px solid gray;</span><br><span class="hljs-string">                border-radius:10px;</span><br><span class="hljs-string">                padding:2px 4px;</span><br><span class="hljs-string">                background-color:#ddd;</span><br><span class="hljs-string">                height:35px;</span><br><span class="hljs-string">                font-color:black;</span><br><span class="hljs-string">                font-weight:1000;</span><br><span class="hljs-string">                font-size:24px</span><br><span class="hljs-string">            &#125;&#x27;&#x27;&#x27;</span>)<br>        self.Latex3Edit.setStyleSheet(<br>            <span class="hljs-string">&#x27;&#x27;&#x27;QLineEdit&#123;</span><br><span class="hljs-string">                border:1px solid gray;</span><br><span class="hljs-string">                border-radius:10px;</span><br><span class="hljs-string">                padding:2px 4px;</span><br><span class="hljs-string">                background-color:#ddd;</span><br><span class="hljs-string">                height:35px;</span><br><span class="hljs-string">                font-color:black;</span><br><span class="hljs-string">                font-weight:1000;</span><br><span class="hljs-string">                font-size:24px</span><br><span class="hljs-string">            &#125;&#x27;&#x27;&#x27;</span>)<br>    <br>        self.Latex1copyBtn.setStyleSheet(<br>            <span class="hljs-string">&#x27;&#x27;&#x27;QPushButton&#123;</span><br><span class="hljs-string">                border:1px solid gray;</span><br><span class="hljs-string">                border-radius:4px;</span><br><span class="hljs-string">                padding:5px 5px;</span><br><span class="hljs-string">                height:35px</span><br><span class="hljs-string">    </span><br><span class="hljs-string">            &#125;&#x27;&#x27;&#x27;</span>)<br>        self.Latex2copyBtn.setStyleSheet(<br>            <span class="hljs-string">&#x27;&#x27;&#x27;QPushButton&#123;</span><br><span class="hljs-string">                border:1px solid gray;</span><br><span class="hljs-string">                border-radius:4px;</span><br><span class="hljs-string">                padding:5px 5px;</span><br><span class="hljs-string">                height:35px</span><br><span class="hljs-string">            &#125;&#x27;&#x27;&#x27;</span>)<br>        self.Latex3copyBtn.setStyleSheet(<br>            <span class="hljs-string">&#x27;&#x27;&#x27;QPushButton&#123;</span><br><span class="hljs-string">                border:1px solid gray;</span><br><span class="hljs-string">                border-radius:4px;</span><br><span class="hljs-string">                padding:5px 5px;</span><br><span class="hljs-string">                height:35px</span><br><span class="hljs-string">            &#125;&#x27;&#x27;&#x27;</span>)<br>    <br>        self.img2latexBtn.setStyleSheet(<br>            <span class="hljs-string">&#x27;&#x27;&#x27;QPushButton&#123;</span><br><span class="hljs-string">                border:2px solid gray;</span><br><span class="hljs-string">                border-radius:10px;</span><br><span class="hljs-string">                padding:5px 5px;</span><br><span class="hljs-string">                background-color:#555;</span><br><span class="hljs-string">                font-size:24px;</span><br><span class="hljs-string">                font-color:#fff;</span><br><span class="hljs-string">                font-weight:700;</span><br><span class="hljs-string">                font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;</span><br><span class="hljs-string">            &#125;&#x27;&#x27;&#x27;</span>)<br>    <br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># Return the base64 encoding of an image with the given filename.</span><br>    <span class="hljs-comment">#</span><br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">image_uri</span>(<span class="hljs-params">self,filename</span>):</span><br>        image_data = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&quot;rb&quot;</span>).read()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;data:image/jpg;base64,&quot;</span> + base64.b64encode(image_data).decode()<br>    <br>    <span class="hljs-comment"># Call the Mathpix service with the given arguments, headers, and timeout.</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">latex</span>(<span class="hljs-params">self,args, headers=default_headers, timeout=<span class="hljs-number">30</span></span>):</span><br>        r = requests.post(service,<br>                          data=json.dumps(args), headers=headers, timeout=timeout)<br>        <span class="hljs-keyword">return</span> json.loads(r.text)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">convert</span>(<span class="hljs-params">self</span>):</span><br>        self.grapclipboard()<br>        r = self.latex(&#123;<br>            <span class="hljs-string">&#x27;src&#x27;</span>:self.image_uri(<span class="hljs-string">r&quot;.\img\equa.png&quot;</span>),<br>            <span class="hljs-string">&#x27;formats&#x27;</span>: [<span class="hljs-string">&#x27;latex_simplified&#x27;</span>]<br>        &#125;)<br>        <span class="hljs-comment"># print(r[&#x27;latex_simplified&#x27;])</span><br>        latex1 = r[<span class="hljs-string">&#x27;latex_simplified&#x27;</span>]<br>    <br>        <span class="hljs-comment"># test</span><br>        <span class="hljs-comment"># latex1=&#x27;111&#x27;</span><br>        latex2 = <span class="hljs-string">&#x27;$&#x27;</span> + latex1 + <span class="hljs-string">&#x27;$&#x27;</span><br>        latex3 = <span class="hljs-string">&#x27;$$&#x27;</span> + latex1 + <span class="hljs-string">&#x27;$$&#x27;</span><br>        self.Latex1Edit.setText(latex1)<br>        self.Latex2Edit.setText(latex2)<br>        self.Latex3Edit.setText(latex3)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">copyLatex1</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># get the latex formula</span><br>        text = self.Latex1Edit.text()<br>        <span class="hljs-comment"># copy it to clipboard</span><br>        pyperclip.copy(text)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">copyLatex2</span>(<span class="hljs-params">self</span>):</span><br>        text = self.Latex2Edit.text()<br>        pyperclip.copy(text)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">copyLatex3</span>(<span class="hljs-params">self</span>):</span><br>        text = self.Latex3Edit.text()<br>        pyperclip.copy(text)<br>    <br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># 识别剪贴板公式</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">grabclipboard</span>(<span class="hljs-params">self</span>):</span><br>        im = ImageGrab.grabclipboard()<br>        im.save(<span class="hljs-string">r&#x27;.\img\equa.png&#x27;</span>, <span class="hljs-string">&#x27;PNG&#x27;</span>)<br>        self.imgLable.setPixmap(PyQt5.QtGui.QPixmap(<span class="hljs-string">r&#x27;.\img\equa.png&#x27;</span>))<br>    <br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># 为程序添加快捷键</span><br>    <span class="hljs-comment">#</span><br>    <span class="hljs-comment"># 可以自己定义</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">keyPressEvent</span>(<span class="hljs-params">self, event</span>):</span><br>        <span class="hljs-keyword">if</span> (event.key() == Qt.Key_T)<span class="hljs-keyword">and</span>(event.modifiers() == Qt.AltModifier):<br>            self.convert()<br>        <span class="hljs-keyword">if</span> (event.key() == Qt.Key_C)<span class="hljs-keyword">and</span>(event.modifiers() == Qt.AltModifier):<br>            self.copyLatex3()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app = QApplication(sys.argv)<br>    ex = Img2Latex()<br>    sys.exit(app.exec_())<br><br></code></pre></td></tr></table></figure></details><ul><li>需要将自己的 ID 和 Key 填入代码中</li></ul><h3 id="示例效果"><a href="#示例效果" class="headerlink" title="示例效果"></a>示例效果</h3><p><img src="https://photos.zywvvd.com/image_canglan/20210407004541.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/weixin_44984664/article/details/105242426">https://blog.csdn.net/weixin_44984664/article/details/105242426</a></li><li><a href="https://geomatlab.com/mathpix-api/">https://geomatlab.com/mathpix-api/</a></li></ul><p>```</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>tools</category>
      
      <category>mathpix</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
      <tag>mathpix</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 9 - 中心极限定理</title>
    <link href="/2021/04/03/math/probability/central-limit-theorem/central-limit-theorem/"/>
    <url>/2021/04/03/math/probability/central-limit-theorem/central-limit-theorem/</url>
    
    <content type="html"><![CDATA[<blockquote><p>中心极限定理（<strong>Central Limit Theorem</strong>，CTL），是指概率论中讨论随机变量序列部分和分布渐近于正态分布的一类定理。。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p>定理是数理统计学和误差分析的理论基础，指出了大量随机变量近似服从正态分布的条件。它是概率论中最重要的一类定理，有广泛的实际应用背景。在自然界与生产中，一些现象受到许多相互独立的随机因素的影响，如果每个因素所产生的影响都很微小时，总的影响可以看作是服从正态分布的。中心极限定理就是从数学上证明了这一现象。    ——<a href="https://baike.baidu.com/item/%E4%B8%AD%E5%BF%83%E6%9E%81%E9%99%90%E5%AE%9A%E7%90%86/829451?fr=aladdin">百度百科</a></p></blockquote><ul><li>中心极限定理（CLT）指出，如果样本量足够大，则变量均值的采样分布将近似于正态分布，而与该变量在总体中的分布无关。</li></ul><h3 id="独立同分布"><a href="#独立同分布" class="headerlink" title="独立同分布"></a>独立同分布</h3><ul><li>设随机变量$X_1, X_2,\dots,X_n$独立同分布，且具有数学期望$\mu$和方差$\sigma^2$，前$n$个变量之和为$\overline S  = \sum\limits_{i = 1}^n {{X_i}} \\$</li><li>那么$\overline S_n$的期望和方差为$n\mu$和$n\sigma^2$，$\overline S_n$的标准化变量为：</li></ul><p>$$<br>Y_n=\frac{\overline S_n - n\mu}{\sqrt n\sigma}<br>$$</p><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><ul><li>中心极限定理的内容为：$Y_n$的概率分布函数$F_n(x)$对于任意$x$满足：</li></ul>$$\begin{array}{c}\lim _{n \rightarrow \infty} F_{n}(x)=\lim \limits_{n \rightarrow \infty} P\left\{Y_{n} \leq x\right\}=\lim \limits_{n \rightarrow \infty} P\left\{\frac{\sum_{k=1}^{n} X_{k}-n \mu}{\sqrt{n} \sigma} \leq x\right\} \\=\int_{-\infty}^{x} \frac{1}{\sqrt{2 \pi}} e^{-t^{2} / 2} d t=\Phi(x)\end{array}$$<h4 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h4><blockquote><p>通过观察某个分布的采样均值可以发现近似服从正态分布，我们的目标就是证明这个变量与正态分布的特征函数相同</p></blockquote><ul><li>引入一些特征函数的<a href="https://www.zywvvd.com/2021/03/30/math/probability/Characteristic-Function/Characteristic-Function/">结论</a></li><li>正态分布的特征函数：</li></ul>$${\varphi (t)}{ = {e^{ - \frac{{{t^2}}}{2}}}}$$<p><a href="https://www.zywvvd.com/2021/03/30/math/probability/Characteristic-Function/Characteristic-Function/#%E6%A0%87%E5%87%86%E6%AD%A3%E6%80%81%E5%88%86%E5%B8%83%E7%9A%84%E7%89%B9%E5%BE%81%E5%87%BD%E6%95%B0">标准正态分布的特征函数</a></p><ul><li>随机变量$X_i$的特征函数用${\varphi_x (t)}$表示</li><li>$\overline S_n$的特征函数为：</li></ul>$${\varphi_{S_n} (t)}=[{\varphi_x (t)}]^n$$<blockquote><p><a href="https://www.zywvvd.com/2021/03/30/math/probability/Characteristic-Function/Characteristic-Function/#%E7%8B%AC%E7%AB%8B%E5%8F%98%E9%87%8F%E5%92%8C%E7%9A%84%E7%89%B9%E5%BE%81%E5%87%BD%E6%95%B0">独立变量和的特征函数</a></p></blockquote><ul><li>$X_i$均值$\overline X=\frac{1}{n}\overline {S_n}$的特征函数：</li></ul>$${\varphi_{\overline X} (t)}={\varphi_{S_n} (\frac{t}{n})}=[{\varphi_x (\frac{t}{n})}]^n$$<blockquote><p><a href="https://www.zywvvd.com/2021/03/30/math/probability/Characteristic-Function/Characteristic-Function/#%E5%B8%B8%E6%95%B0%E7%BA%BF%E6%80%A7%E5%8F%98%E6%8D%A2%E7%9A%84%E7%89%B9%E5%BE%81%E5%87%BD%E6%95%B0">常数线性变换的特征函数</a></p></blockquote><ul><li>$Y_n=\frac{\overline S_n - n\mu}{\sqrt n\sigma}=\frac{\overline X - \mu}{\frac{\sigma}{\sqrt n}}=\frac{\sqrt n}{\sigma}\overline X - \frac{\sqrt n}{\sigma} \mu$ 的特征函数：</li></ul>$$\varphi_{y}(t)=e^{i\left(-\frac{\sqrt{n}}{\sigma} \mu\right) t} \cdot \varphi_{\bar{x}}\left(\frac{\sqrt{n}}{\sigma} t\right)=e^{i\left(-\frac{\sqrt{n}}{\sigma} \mu\right) t} \cdot\left[\varphi_{x}\left(\frac{t}{\sigma \sqrt{n}}\right)\right]^{n}$$<h5 id="思路1"><a href="#思路1" class="headerlink" title="思路1"></a>思路1</h5><ul><li>取对数：</li></ul>$$\begin{aligned}\ln \varphi_{y}(t)&=\ln \left\{e^{i\left(-\frac{\sqrt{n}}{\sigma} \mu\right) t} \cdot\left[\varphi_{x}\left(\frac{t}{\sigma \sqrt{n}}\right)\right]^{n}\right\}\\&=-i \frac{\sqrt{n}}{\sigma} \mu t+n \ln \left[\varphi_{x}\left(\frac{t}{\sigma \sqrt{n}}\right)\right]\\&=\frac{-i \mu \frac{t}{\sigma \sqrt{n}}+\ln \left[\varphi_{x}\left(\frac{t}{\sigma \sqrt{n}}\right)\right]}{\frac{1}{n}}\\\end{aligned}$$<ul><li>令$p=\frac{t}{\sigma \sqrt{n}}$, 当 $ n \rightarrow \infty $ 时, $ p \rightarrow 0$ 又 ：</li></ul>$$\begin{aligned}&\varphi_{x}(0)=\int_{-\infty}^{\infty} f(x) d x=1\\&\varphi_{x}^{\prime}(0)=\int_{-\infty}^{\infty} i x f(x) d x=i \mu\\&\varphi_{x}^{\prime \prime}(0)=\int_{-\infty}^{\infty}-x^{2} f(x) d x=-E\left(X^{2}\right)=-\mu^{2}-\sigma^{2}\\\end{aligned}$$<ul><li>有 ：</li></ul>$$\begin{aligned}\lim _{n \rightarrow \infty} \ln \varphi_{y}(t)&=\lim _{n \rightarrow \infty} \frac{-i \mu \frac{t}{\sigma \sqrt{n}}+\ln \left[\varphi_{x}\left(\frac{t}{\sigma \sqrt{n}}\right)\right]}{\frac{1}{n}}\\&=\frac{t^{2}}{\sigma^{2}} \lim _{p \rightarrow 0} \frac{-i \mu p+\ln \left[\varphi_{x}(p)\right]}{p^{2}} \quad(\text { 洛必达) }\\&=\frac{t^{2}}{\sigma^{2}} \lim _{p \rightarrow 0} \frac{-i \mu+\frac{1}{\varphi_{x}(p)} \cdot \varphi_{x}^{\prime}(p)}{2 p} \quad(\text { 洛必达 })\\&=\frac{t^{2}}{\sigma^{2}} \lim _{p \rightarrow 0} \frac{\varphi_{x}^{\prime \prime}(p) \cdot \varphi_{x}(p)-\varphi_{x}^{\prime}(p) \cdot \varphi_{x}^{\prime}(p)}{2\left[\varphi_{x}(p)\right]^{2}}\\&=\frac{t^{2}}{\sigma^{2}} \cdot \frac{\varphi_{x}^{\prime \prime}(0) \cdot \varphi_{x}(0)-\varphi_{x}^{\prime}(0) \cdot \varphi_{x}^{\prime}(0)}{2\left[\varphi_{x}(0)\right]^{2}}\\&=\frac{t^{2}}{\sigma^{2}} \cdot \frac{\left(-\mu^{2}-\sigma^{2}\right) \cdot 1-i \mu \cdot i \mu}{2 \cdot 1}\\&=-\frac{t^{2}}{2}\end{aligned}$$<h5 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h5>$$\begin{array}{l}Y_{n}=\frac{n \bar{X}-\mu}{\sigma \sqrt{n}}=\frac{\sum_{i=1}^{n} \eta_{i}}{\sigma \sqrt{n}}\\\quad \eta_{i}=X_{i}-\mu \\\varphi(t)=E\left(e^{i t Y_{n}}\right)=E\left(e^{i t \frac{\eta_{1}}{\sigma \sqrt{n}}} \cdot e^{i t \frac{\eta_{2}}{\sigma \sqrt{n}}} \cdot \ldots \cdot e^{i t \frac{\eta_{n}}{\sigma \sqrt{n}}}\right)=\left[\phi\left(\frac{t}{\sigma \sqrt{n}}\right)\right]^{n}\end{array}$$<ul><li>$\phi(t)$ 为 $\eta_{i}$ 的特征函数</li><li>$\phi\left(\frac{t}{\sigma \sqrt{n}}\right)$ 在0点处的泰勒展开形式为:</li></ul>$$\begin{aligned}\phi\left(\frac{t}{\sigma \sqrt{n}}\right)=\phi(0) &+\phi^{\prime}(0) \frac{t}{\sigma \sqrt{n}}+\frac{\phi^{\prime \prime}(0)}{2 !}\left(\frac{t}{\sigma \sqrt{n}}\right)^{2}+o\left(\left(\frac{t}{\sigma \sqrt{n}}\right)^{2}\right) \\&=1+0-\frac{t^{2}}{2 n}+o\left(\left(\frac{t}{\sigma \sqrt{n}}\right)^{2}\right)\end{aligned}$$<ul><li>所以, $\varphi(t)$ 为:</li></ul>$$\varphi(t)=\left(1-\frac{t^{2}}{2 n}+o\left(\left(\frac{t}{\sigma \sqrt{n}}\right)^{2}\right)\right)^{\left(-\frac{2 n}{t^{2}}\right) \times\left(-\frac{t^{2}}{2}\right)}=e^{-\frac{t^{2}}{2}}, n \rightarrow+\infty$$<h5 id="都得出结论"><a href="#都得出结论" class="headerlink" title="都得出结论"></a>都得出结论</h5><ul><li>即有：</li></ul>$$\lim _{n \rightarrow \infty} \varphi_{y}(t)={e^{ - \frac{{{t^2}}}{2}}}$$<ul><li>$Y_n$特征函数与正态分布相同，故有当$ n \rightarrow \infty$时，$Y_n$服从正态分布的结论</li></ul><h4 id="应用思路"><a href="#应用思路" class="headerlink" title="应用思路"></a>应用思路</h4><ul><li>均值方差为$\mu$和$\sigma^2$，的独立同分布的随机变量$X_i$前$n$项之和$\overline S_n$的标准变化量$Y_n$，当$n$充分大时，其分布近似于标准正态分布</li><li>即在$n$充分大时，$\overline S_n$分布近似于$N(n\mu,n\sigma^2)$</li><li>一般情况下，很难求出$n$个随机变量之和的分布函数。因此当$n$充分大时，可以通过正态分布来做理论上的分析或者计算</li></ul><h3 id="独立不同分布"><a href="#独立不同分布" class="headerlink" title="独立不同分布"></a>独立不同分布</h3><ul><li><p><code>Liapunov </code>定理：设随机变量 $X_{1}, X_{2}, \cdots, X_{n}, \cdots$ 相互独立, 具有数学期望和方差:<br>$$<br>\mathbb{E}\left[X_{k}\right]=\mu_{k}, \operatorname{Var}\left[X_{k}\right]=\sigma_{k}^{2}<br>$$</p></li><li><p>记: $B_{n}^{2}=\sum_{k=1}^{n} \sigma_{k}^{2}$ 若存在正数 $\delta,$ 使得当 $n \rightarrow \infty$ 时，有：</p>  $$\frac{1}{B_{n}^{2+\delta}} \sum_{k=1}^{n} \mathbb{E}\left[\left|X_{k}-\mu_{k}\right|^{2+\delta}\right] \rightarrow 0  $$</li><li><p>则随机变量之和 $\overline{S X_{n}}=\sum_{k=1}^{n} X_{k}$ 的标准变化量:</p></li></ul>$$Z_{n}=\frac{\overline{S X_{n}}-\mathbb{E}\left[\overline{S X_{n}}\right]}{\sqrt{\operatorname{Var}\left[\overline{S X_{n}}\right]}}=\frac{\overline{S X_{n}}-\sum_{k=1}^{n} \mu_{k}}{B_{n}}$$<ul><li>概率分布函数 $F_{n}(x)$ 对于任意 $x$ 满足:</li></ul>$$\begin{array}{c}\lim _{n \rightarrow \infty} F_{n}(x)=\lim _{n \rightarrow \infty} P\left\{Z_{n} \leq x\right\}=\lim _{n \rightarrow \infty} P\left\{\frac{\sum_{k=1}^{n} X_{k}-\sum_{k=1}^{n} \mu_{k}}{B_{n}} \leq x\right\} \\=\int_{-\infty}^{x} \frac{1}{\sqrt{2 \pi}} e^{-t^{2} / 2} d t=\Phi(x)\end{array}$$<ul><li><p>其物理意义为：</p><p>相互独立的随机变量 $X_{1}, X_{2}, \cdots, X_{n}, \cdots$ 之和 $\overline{S X_{n}}=\sum_{k=1}^{n} X_{k}$ 的衍生随机变量序列 $Z_{n}=\frac{\overline{S X_{n}}-\sum_{k=1}^{n} \mu_{k}}{B_{n}},$ 当 $n$ 充分大时, 其分布近似与标准正态分布。</p></li><li><p>这里并不要求 $X_{1}, X_{2}, \cdots, X_{n}, \cdots$ 同分布。</p></li></ul><h3 id="棣莫佛－拉普拉斯定理"><a href="#棣莫佛－拉普拉斯定理" class="headerlink" title="棣莫佛－拉普拉斯定理"></a>棣莫佛－拉普拉斯定理</h3><ul><li><code>Demoiver-Laplace</code> 定理：设随机变量序列 $\eta_{n}, n=1,2, \ldots$ 服从参数为 $(n, p)$ 的二项分布，其中 $0&lt;p&lt;1$ 则对于任意 $x$, 有:</li></ul>$$\lim _{n \rightarrow \infty} P\left\{\frac{\eta_{n}-n p}{\sqrt{n p(1-p)}} \leq x\right\}=\int_{-\infty}^{x} \frac{1}{\sqrt{2 \pi}} e^{-t^{2} \mid 2} d t=\Phi(x)$$<ul><li>该定理表明, 正态分布是二项分布的极限分布。当 $n$ 充分大时，可以利用正态分布来计算二项分布的概率。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://baike.baidu.com/item/%E4%B8%AD%E5%BF%83%E6%9E%81%E9%99%90%E5%AE%9A%E7%90%86/829451?fr=aladdin">https://baike.baidu.com/item/%E4%B8%AD%E5%BF%83%E6%9E%81%E9%99%90%E5%AE%9A%E7%90%86/829451?fr=aladdin</a></p></li><li><p><a href="https://baijiahao.baidu.com/s?id=1665261046335447411&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1665261046335447411&amp;wfr=spider&amp;for=pc</a></p></li><li><p><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></p></li><li><p><a href="https://www.zhihu.com/question/25956080/answer/1375064657">https://www.zhihu.com/question/25956080/answer/1375064657</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/93738110">https://zhuanlan.zhihu.com/p/93738110</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VSCode 配置 C++ 运行环境</title>
    <link href="/2021/04/02/coding/environment/cpp-vscode/cpp-vscode/"/>
    <url>/2021/04/02/coding/environment/cpp-vscode/cpp-vscode/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录使用 vscode 配置c++编程环境的流程。</p></blockquote><span id="more"></span><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><table><thead><tr><th>项目</th><th>内容</th></tr></thead><tbody><tr><td>操作系统</td><td>Windows 10</td></tr><tr><td>软件安装</td><td><a href="https://vscode.en.softonic.com/">VS code</a></td></tr></tbody></table><ul><li>官网：<a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a></li></ul><h3 id="安装gcc编译器"><a href="#安装gcc编译器" class="headerlink" title="安装gcc编译器"></a>安装gcc编译器</h3><h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><ul><li>链接：<a href="https://sourceforge.net/projects/mingw-w64/files/">MinGW-w64 - for 32 and 64 bit Windows</a> </li></ul><blockquote><p>选最新版本中的<code>x86_64-posix-seh</code></p></blockquote><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><ul><li>解压压缩包</li><li>将目录中的<code>bin</code>添加到环境变量</li></ul><h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><ul><li>在cmd中输入命令</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&gt; gcc -v<br><br>Using built-in specs.<br><span class="hljs-attribute">COLLECT_GCC</span>=gcc<br><span class="hljs-attribute">COLLECT_LTO_WRAPPER</span>=E:/Program\ Files/mingw64/bin/<span class="hljs-built_in">..</span>/libexec/gcc/x86_64-w64-mingw32/8.1.0/lto-wrapper.exe<br>Target: x86_64-w64-mingw32<br>Configured with: <span class="hljs-built_in">..</span>/<span class="hljs-built_in">..</span>/<span class="hljs-built_in">..</span>/src/gcc-8.1.0/configure <span class="hljs-attribute">--host</span>=x86_64-w64-mingw32 <span class="hljs-attribute">--build</span>=x86_64-w64-mingw32 <span class="hljs-attribute">--target</span>=x86_64-w64-mingw32 <span class="hljs-attribute">--prefix</span>=/mingw64 <span class="hljs-attribute">--with-sysroot</span>=/c/mingw810/x86_64-810-posix-seh-rt_v6-rev0/mingw64 --enable-shared --enable-static --disable-multilib <span class="hljs-attribute">--enable-languages</span>=c,c++,fortran,lto <span class="hljs-attribute">--enable-libstdcxx-time</span>=<span class="hljs-literal">yes</span> <span class="hljs-attribute">--enable-threads</span>=posix --enable-libgomp --enable-libatomic --enable-lto --enable-graphite <span class="hljs-attribute">--enable-checking</span>=release --enable-fully-dynamic-string --enable-version-specific-runtime-libs --disable-libstdcxx-pch --disable-libstdcxx-<span class="hljs-builtin-name">debug</span> --enable-bootstrap --disable-rpath --disable-win32-registry --disable-nls --disable-werror --disable-symvers --with-gnu-as --with-gnu-ld <span class="hljs-attribute">--with-arch</span>=nocona <span class="hljs-attribute">--with-tune</span>=core2 --with-libiconv --with-system-zlib <span class="hljs-attribute">--with-gmp</span>=/c/mingw810/prerequisites/x86_64-w64-mingw32-static <span class="hljs-attribute">--with-mpfr</span>=/c/mingw810/prerequisites/x86_64-w64-mingw32-static <span class="hljs-attribute">--with-mpc</span>=/c/mingw810/prerequisites/x86_64-w64-mingw32-static <span class="hljs-attribute">--with-isl</span>=/c/mingw810/prerequisites/x86_64-w64-mingw32-static <span class="hljs-attribute">--with-pkgversion</span>=<span class="hljs-string">&#x27;x86_64-posix-seh-rev0, Built by MinGW-W64 project&#x27;</span> <span class="hljs-attribute">--with-bugurl</span>=https://sourceforge.net/projects/mingw-w64 <span class="hljs-attribute">CFLAGS</span>=<span class="hljs-string">&#x27;-O2 -pipe -fno-ident -I/c/mingw810/x86_64-810-posix-seh-rt_v6-rev0/mingw64/opt/include -I/c/mingw810/prerequisites/x86_64-zlib-static/include -I/c/mingw810/prerequisites/x86_64-w64-mingw32-static/include&#x27;</span> <span class="hljs-attribute">CXXFLAGS</span>=<span class="hljs-string">&#x27;-O2 -pipe -fno-ident -I/c/mingw810/x86_64-810-posix-seh-rt_v6-rev0/mingw64/opt/include -I/c/mingw810/prerequisites/x86_64-zlib-static/include -I/c/mingw810/prerequisites/x86_64-w64-mingw32-static/include&#x27;</span> <span class="hljs-attribute">CPPFLAGS</span>=<span class="hljs-string">&#x27; -I/c/mingw810/x86_64-810-posix-seh-rt_v6-rev0/mingw64/opt/include -I/c/mingw810/prerequisites/x86_64-zlib-static/include -I/c/mingw810/prerequisites/x86_64-w64-mingw32-static/include&#x27;</span> <span class="hljs-attribute">LDFLAGS</span>=<span class="hljs-string">&#x27;-pipe -fno-ident -L/c/mingw810/x86_64-810-posix-seh-rt_v6-rev0/mingw64/opt/lib -L/c/mingw810/prerequisites/x86_64-zlib-static/lib -L/c/mingw810/prerequisites/x86_64-w64-mingw32-static/lib &#x27;</span><br>Thread model: posix<br>gcc version 8.1.0 (x86_64-posix-seh-rev0, Built by MinGW-W64 project)<br></code></pre></td></tr></table></figure><h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><ul><li>C/C++：又名 cpptools，提供Debug和Format功能</li><li>Code Runner：右键即可编译运行单文件，很方便；但无法Debug</li></ul><blockquote><p>Bracket Pair Colorizer 2：彩虹花括号</p></blockquote><h3 id="建立配置文件"><a href="#建立配置文件" class="headerlink" title="建立配置文件"></a>建立配置文件</h3><h4 id="tasks-json"><a href="#tasks-json" class="headerlink" title="tasks.json"></a>tasks.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// https://code.visualstudio.com/docs/editor/tasks</span><br>&#123;<br>    <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;2.0.0&quot;</span>,<br>    <span class="hljs-attr">&quot;tasks&quot;</span>: [&#123;<br>        <span class="hljs-attr">&quot;label&quot;</span>: <span class="hljs-string">&quot;Compile&quot;</span>, <span class="hljs-comment">// 任务名称，与launch.json的preLaunchTask相对应</span><br>        <span class="hljs-attr">&quot;command&quot;</span>: <span class="hljs-string">&quot;g++&quot;</span>,   <span class="hljs-comment">// 要使用的编译器，C++用g++</span><br>        <span class="hljs-attr">&quot;args&quot;</span>: [<br>            <span class="hljs-string">&quot;$&#123;file&#125;&quot;</span>,<br>            <span class="hljs-string">&quot;-o&quot;</span>,    <span class="hljs-comment">// 指定输出文件名，不加该参数则默认输出a.exe，Linux下默认a.out</span><br>            <span class="hljs-string">&quot;$&#123;fileDirname&#125;/$&#123;fileBasenameNoExtension&#125;.exe&quot;</span>,<br>            <span class="hljs-string">&quot;-g&quot;</span>,    <span class="hljs-comment">// 生成和调试有关的信息</span><br>            <span class="hljs-string">&quot;-m64&quot;</span>,  <span class="hljs-comment">// 不知为何有时会生成16位程序而无法运行，此条可强制生成64位的</span><br>            <span class="hljs-string">&quot;-Wall&quot;</span>, <span class="hljs-comment">// 开启额外警告</span><br>            <span class="hljs-string">&quot;-static-libgcc&quot;</span>,     <span class="hljs-comment">// 静态链接libgcc，一般都会加上</span><br>            <span class="hljs-string">&quot;-fexec-charset=GBK&quot;</span>, <span class="hljs-comment">// 生成的程序使用GBK编码，不加这条会导致Win下输出中文乱码；繁体系统改成BIG5</span><br>            <span class="hljs-string">&quot;-D__USE_MINGW_ANSI_STDIO&quot;</span>, <span class="hljs-comment">// 用MinGW写C时留着，否则不需要，用于支持printf的%zd和%Lf等</span><br>        ], <span class="hljs-comment">// 编译的命令，其实相当于VSC帮你在终端中输了这些东西</span><br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;process&quot;</span>, <span class="hljs-comment">// process是把预定义变量和转义解析后直接全部传给command；shell相当于先打开shell再输入命令，所以args还会经过shell再解析一遍</span><br>        <span class="hljs-attr">&quot;group&quot;</span>: &#123;<br>            <span class="hljs-attr">&quot;kind&quot;</span>: <span class="hljs-string">&quot;build&quot;</span>,<br>            <span class="hljs-attr">&quot;isDefault&quot;</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 不为true时ctrl shift B就要手动选择了</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;presentation&quot;</span>: &#123;<br>            <span class="hljs-attr">&quot;echo&quot;</span>: <span class="hljs-literal">true</span>,<br>            <span class="hljs-attr">&quot;reveal&quot;</span>: <span class="hljs-string">&quot;always&quot;</span>, <span class="hljs-comment">// 执行任务时是否跳转到终端面板，可以为always，silent，never。具体参见VSC的文档，即使设为never，手动点进去还是可以看到</span><br>            <span class="hljs-attr">&quot;focus&quot;</span>: <span class="hljs-literal">false</span>,     <span class="hljs-comment">// 设为true后可以使执行task时焦点聚集在终端，但对编译C/C++来说，设为true没有意义</span><br>            <span class="hljs-attr">&quot;panel&quot;</span>: <span class="hljs-string">&quot;shared&quot;</span>   <span class="hljs-comment">// 不同的文件的编译信息共享一个终端面板</span><br>        &#125;,<br>        <span class="hljs-attr">&quot;problemMatcher&quot;</span>:<span class="hljs-string">&quot;$gcc&quot;</span> <span class="hljs-comment">// 捕捉编译时终端里的报错信息到问题面板中，修改代码后需要重新编译才会再次触发</span><br>        <span class="hljs-comment">// 本来有Lint，再开problemMatcher就有双重报错，但MinGW的Lint效果实在太差了；用Clangd可以注释掉</span><br>    &#125;]<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="launch-json"><a href="#launch-json" class="headerlink" title="launch.json"></a>launch.json</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// https://code.visualstudio.com/docs/cpp/launch-json-reference</span><br>&#123;<br>    <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.2.0&quot;</span>,<br>    <span class="hljs-attr">&quot;configurations&quot;</span>: [&#123;<br>        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;(gdb) Launch&quot;</span>, <span class="hljs-comment">// 配置名称，将会在启动配置的下拉菜单中显示</span><br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;cppdbg&quot;</span>, <span class="hljs-comment">// 配置类型，对于C/C++可认为此处只能是cppdbg，由cpptools提供；不同编程语言不同</span><br>        <span class="hljs-attr">&quot;request&quot;</span>: <span class="hljs-string">&quot;launch&quot;</span>, <span class="hljs-comment">// 可以为launch（启动）或attach（附加）</span><br>        <span class="hljs-attr">&quot;program&quot;</span>: <span class="hljs-string">&quot;$&#123;fileDirname&#125;/$&#123;fileBasenameNoExtension&#125;.exe&quot;</span>, <span class="hljs-comment">// 将要进行调试的程序的路径</span><br>        <span class="hljs-attr">&quot;args&quot;</span>: [], <span class="hljs-comment">// 程序调试时传递给程序的命令行参数，一般设为空</span><br>        <span class="hljs-attr">&quot;stopAtEntry&quot;</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 设为true时程序将暂停在程序入口处，相当于在main上打断点</span><br>        <span class="hljs-attr">&quot;cwd&quot;</span>: <span class="hljs-string">&quot;$&#123;workspaceFolder&#125;&quot;</span>, <span class="hljs-comment">// 调试程序时的工作目录，此为工作区文件夹；改成$&#123;fileDirname&#125;可变为文件所在目录</span><br>        <span class="hljs-attr">&quot;environment&quot;</span>: [], <span class="hljs-comment">// 环境变量</span><br>        <span class="hljs-attr">&quot;externalConsole&quot;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 使用单独的cmd窗口，与其它IDE一致；为false时使用内置终端</span><br>        <span class="hljs-attr">&quot;internalConsoleOptions&quot;</span>: <span class="hljs-string">&quot;neverOpen&quot;</span>, <span class="hljs-comment">// 如果不设为neverOpen，调试时会跳到“调试控制台”选项卡，你应该不需要对gdb手动输命令吧？</span><br>        <span class="hljs-attr">&quot;MIMode&quot;</span>: <span class="hljs-string">&quot;gdb&quot;</span>, <span class="hljs-comment">// 指定连接的调试器，可以为gdb或lldb。但我没试过lldb</span><br>        <span class="hljs-attr">&quot;miDebuggerPath&quot;</span>: <span class="hljs-string">&quot;gdb.exe&quot;</span>, <span class="hljs-comment">// 调试器路径，Windows下后缀不能省略，Linux下则不要</span><br>        <span class="hljs-attr">&quot;setupCommands&quot;</span>: [<br>            &#123; <span class="hljs-comment">// 模板自带，好像可以更好地显示STL容器的内容，具体作用自行Google</span><br>                <span class="hljs-attr">&quot;description&quot;</span>: <span class="hljs-string">&quot;Enable pretty-printing for gdb&quot;</span>,<br>                <span class="hljs-attr">&quot;text&quot;</span>: <span class="hljs-string">&quot;-enable-pretty-printing&quot;</span>,<br>                <span class="hljs-attr">&quot;ignoreFailures&quot;</span>: <span class="hljs-literal">false</span><br>            &#125;<br>        ],<br>        <span class="hljs-attr">&quot;preLaunchTask&quot;</span>: <span class="hljs-string">&quot;Compile&quot;</span> <span class="hljs-comment">// 调试前执行的任务，一般为编译程序。与tasks.json的label相对应</span><br>    &#125;]<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="settings-json"><a href="#settings-json" class="headerlink" title="settings.json"></a>settings.json</h3><blockquote><p>把这个文件里的东西放到“用户设置”里可以覆盖全局设置，否则只在当前工作区才有效。这两点各有自己的优势。</p><p>Code Runner的命令行和某些选项可以根据自己的需要在此处修改，想自定义或者想知道是什么意思还是参见此扩展的文档和百度gcc使用教程。如果终端用的是cmd（<strong>Win7</strong>默认）需要改用注释掉的，或者把<code>terminal.integrated.shell.windows</code>改为PowerShell；Win10默认就是PS就不用改。</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;files.defaultLanguage&quot;</span>: <span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-comment">// ctrl+N新建文件后默认的语言</span><br>    <span class="hljs-attr">&quot;editor.formatOnType&quot;</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 输入分号(C/C++的语句结束标识)后自动格式化当前这一行的代码</span><br>    <span class="hljs-attr">&quot;editor.suggest.snippetsPreventQuickSuggestions&quot;</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// clangd的snippets有很多的跳转点，不用这个就必须手动触发Intellisense了</span><br>    <span class="hljs-attr">&quot;editor.acceptSuggestionOnEnter&quot;</span>: <span class="hljs-string">&quot;off&quot;</span>, <span class="hljs-comment">// 我个人的习惯，按回车时一定是真正的换行，只有tab才会接受Intellisense</span><br>    <span class="hljs-comment">// &quot;editor.snippetSuggestions&quot;: &quot;top&quot;, // （可选）snippets显示在补全列表顶端，默认是inline</span><br><br>    <span class="hljs-attr">&quot;code-runner.runInTerminal&quot;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 设置成false会在“输出”中输出，无法输入</span><br>    <span class="hljs-attr">&quot;code-runner.executorMap&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;c&quot;</span>: <span class="hljs-string">&quot;gcc &#x27;$fileName&#x27; -o &#x27;$fileNameWithoutExt.exe&#x27; -Wall -O2 -m64 -lm -static-libgcc -fexec-charset=GBK -D__USE_MINGW_ANSI_STDIO &amp;&amp; &amp;&#x27;./$fileNameWithoutExt.exe&#x27;&quot;</span>,<br>        <span class="hljs-attr">&quot;cpp&quot;</span>: <span class="hljs-string">&quot;g++ &#x27;$fileName&#x27; -o &#x27;$fileNameWithoutExt.exe&#x27; -Wall -O2 -m64 -static-libgcc -fexec-charset=GBK &amp;&amp; &amp;&#x27;./$fileNameWithoutExt.exe&#x27;&quot;</span><br>        <span class="hljs-comment">// &quot;c&quot;: &quot;gcc $fileName -o $fileNameWithoutExt.exe -Wall -O2 -m64 -lm -static-libgcc -fexec-charset=GBK -D__USE_MINGW_ANSI_STDIO &amp;&amp; $dir$fileNameWithoutExt.exe&quot;,</span><br>        <span class="hljs-comment">// &quot;cpp&quot;: &quot;g++ $fileName -o $fileNameWithoutExt.exe -Wall -O2 -m64 -static-libgcc -fexec-charset=GBK &amp;&amp; $dir$fileNameWithoutExt.exe&quot;</span><br>    &#125;, <span class="hljs-comment">// 右键run code时运行的命令；未注释的仅适用于PowerShell（Win10默认）和pwsh，文件名中有空格也可以编译运行；注释掉的适用于cmd（win7默认）、PS和bash，但文件名中有空格时无法运行</span><br>    <span class="hljs-attr">&quot;code-runner.saveFileBeforeRun&quot;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// run code前保存</span><br>    <span class="hljs-attr">&quot;code-runner.preserveFocus&quot;</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 若为false，run code后光标会聚焦到终端上。如果需要频繁输入数据可设为false</span><br>    <span class="hljs-attr">&quot;code-runner.clearPreviousOutput&quot;</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 每次run code前清空属于code runner的终端消息，默认false</span><br>    <span class="hljs-attr">&quot;code-runner.ignoreSelection&quot;</span>: <span class="hljs-literal">true</span>,   <span class="hljs-comment">// 默认为false，效果是鼠标选中一块代码后可以单独执行，但C是编译型语言，不适合这样用</span><br>    <span class="hljs-attr">&quot;code-runner.fileDirectoryAsCwd&quot;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 将code runner终端的工作目录切换到文件目录再运行，对依赖cwd的程序产生影响；如果为false，executorMap要加cd $dir</span><br><br>    <span class="hljs-attr">&quot;C_Cpp.clang_format_sortIncludes&quot;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 格式化时调整include的顺序（按字母排序）</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.zhihu.com/question/30315894">https://www.zhihu.com/question/30315894</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>c++</category>
      
      <category>ide</category>
      
    </categories>
    
    
    <tags>
      
      <tag>c++</tag>
      
      <tag>ide</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker - Error Got permission denied &amp; response from daemon Unknown runtime specified nvidia 解决方案</title>
    <link href="/2021/03/30/docker/docker_error_fix/"/>
    <url>/2021/03/30/docker/docker_error_fix/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Docker 在使用过程中<code>docker: Error response from daemon: Unknown runtime specified nvidia.</code>问题的解决方案。</p></blockquote><span id="more"></span><h3 id="docker-Got-permission-denied-while-trying-to-connect-to-the-Docker-daemon-socket"><a href="#docker-Got-permission-denied-while-trying-to-connect-to-the-Docker-daemon-socket" class="headerlink" title="docker: Got permission denied while trying to connect to the Docker daemon socket"></a>docker: Got permission denied while trying to connect to the Docker daemon socket</h3><blockquote><p>这是因为用户没有加入到docker组中，因此将自己的用户加入到docker的用户组</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">sudo usermod -<span class="hljs-selector-tag">a</span> -G docker <span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure><h3 id="docker-Error-response-from-daemon-Unknown-runtime-specified-nvidia"><a href="#docker-Error-response-from-daemon-Unknown-runtime-specified-nvidia" class="headerlink" title="docker: Error response from daemon: Unknown runtime specified nvidia."></a>docker: Error response from daemon: Unknown runtime specified nvidia.</h3><blockquote><p>这个时候是我们需要安装nvidia-docker2</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo apt-<span class="hljs-builtin-name">get</span> install -y nvidia-docker2<br></code></pre></td></tr></table></figure><ul><li>运行：</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo docker <span class="hljs-builtin-name">run</span> <span class="hljs-attribute">--runtime</span>=nvidia --rm nvidia/cuda nvidia-smi<br></code></pre></td></tr></table></figure><ul><li>还是报错：</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker: <span class="hljs-builtin-name">Error</span> response <span class="hljs-keyword">from</span> daemon: Unknown runtime specified nvidia.<br></code></pre></td></tr></table></figure><ul><li>而运行显示镜像的命令是正常的，说明nvidia-docker2是安装成功了的</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nvidia-docker image ls<br></code></pre></td></tr></table></figure><ul><li>需要将docker重启</li></ul><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">sudo<span class="hljs-keyword"> system</span>ctl daemon-reload<br>sudo<span class="hljs-keyword"> system</span>ctl restart docker<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://zhuanlan.zhihu.com/p/68044009">https://zhuanlan.zhihu.com/p/68044009</a></p></li><li><p><a href="https://github.com/NVIDIA/nvidia-docker/issues/838">https://github.com/NVIDIA/nvidia-docker/issues/838</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nvidia 显卡 Failed to initialize NVML Driver/library version mismatch 错误解决方案</title>
    <link href="/2021/03/30/linux/driver/driver-library-version-mismatch/driver-library-version-mismatch/"/>
    <url>/2021/03/30/linux/driver/driver-library-version-mismatch/driver-library-version-mismatch/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录错误 <code>Failed to initialize NVML: Driver/library version mismatch</code> 错误解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvidia-smi</span> <br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">Failed to initialize NVML: Driver/library version mismatch</span><br></code></pre></td></tr></table></figure><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><ul><li>NVIDIA 内核驱动版本与系统驱动不一致</li></ul><h4 id="查看显卡驱动所使用的内核版本"><a href="#查看显卡驱动所使用的内核版本" class="headerlink" title="查看显卡驱动所使用的内核版本"></a>查看显卡驱动所使用的内核版本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /proc/driver/nvidia/version<br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">NVRM version: NVIDIA UNIX x86_64 Kernel Module  430.34  Wed Jun 26 12:19:48 CDT 2019</span><br>GCC version:  gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.12)<br></code></pre></td></tr></table></figure><ul><li>内核版本 Kernel Module 为 430.34， 系统内核 16.04.12</li></ul><h4 id="查看系统驱动日志"><a href="#查看系统驱动日志" class="headerlink" title="查看系统驱动日志"></a>查看系统驱动日志</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /var/log/dpkg.log | grep nvidia<br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">2021-03-30 14:04:55 install libnvidia-compute-460-server:amd64 &lt;none&gt; 460.32.03-0ubuntu0.18.04.2</span><br>2021-03-30 14:04:55 status half-installed libnvidia-compute-460-server:amd64 460.32.03-0ubuntu0.18.04.2<br>2021-03-30 14:04:57 status unpacked libnvidia-compute-460-server:amd64 460.32.03-0ubuntu0.18.04.2<br>2021-03-30 14:04:57 status unpacked libnvidia-compute-460-server:amd64 460.32.03-0ubuntu0.18.04.2<br>2021-03-30 14:05:15 install nvidia-cuda-dev:amd64 &lt;none&gt; 9.1.85-3ubuntu1<br>2021-03-30 14:05:15 status half-installed nvidia-cuda-dev:amd64 9.1.85-3ubuntu1<br>2021-03-30 14:05:34 status unpacked nvidia-cuda-dev:amd64 9.1.85-3ubuntu1<br>2021-03-30 14:05:34 status unpacked nvidia-cuda-dev:amd64 9.1.85-3ubuntu1<br>2021-03-30 14:05:34 install nvidia-cuda-doc:all &lt;none&gt; 9.1.85-3ubuntu1<br>2021-03-30 14:05:34 status half-installed nvidia-cuda-doc:all 9.1.85-3ubuntu1<br>2021-03-30 14:05:38 status unpacked nvidia-cuda-doc:all 9.1.85-3ubuntu1<br>2021-03-30 14:05:38 status unpacked nvidia-cuda-doc:all 9.1.85-3ubuntu1<br>2021-03-30 14:05:38 install nvidia-cuda-gdb:amd64 &lt;none&gt; 9.1.85-3ubuntu1<br>2021-03-30 14:05:38 status half-installed nvidia-cuda-gdb:amd64 9.1.85-3ubuntu1<br>2021-03-30 14:05:39 status unpacked nvidia-cuda-gdb:amd64 9.1.85-3ubuntu1<br>2021-03-30 14:05:39 status unpacked nvidia-cuda-gdb:amd64 9.1.85-3ubuntu1<br>2021-03-30 14:05:39 install nvidia-profiler:amd64 &lt;none&gt; 9.1.85-3ubuntu1<br>2021-03-30 14:05:39 status half-installed nvidia-profiler:amd64 9.1.85-3ubuntu1<br><br></code></pre></td></tr></table></figure><ul><li>可以看到曾经安装过系统内核 18.04 的 460.32 的驱动</li></ul><h4 id="查看驱动程序"><a href="#查看驱动程序" class="headerlink" title="查看驱动程序"></a>查看驱动程序</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo dpkg --list | grep nvidia-*<br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">ii  libnvidia-compute-460-server:amd64   460.32.03-0ubuntu0.18.04.2                 amd64        NVIDIA libcompute package</span><br>ii  libnvidia-container-tools            1.0.5-1                                    amd64        NVIDIA container runtime library (command-line tools)<br>ii  libnvidia-container1:amd64           1.0.5-1                                    amd64        NVIDIA container runtime library<br>ii  nvidia-container-runtime             3.1.4-1                                    amd64        NVIDIA container runtime<br>ii  nvidia-container-toolkit             1.0.5-1                                    amd64        NVIDIA container runtime hook<br>ii  nvidia-cuda-dev                      9.1.85-3ubuntu1                            amd64        NVIDIA CUDA development files<br>ii  nvidia-cuda-doc                      9.1.85-3ubuntu1                            all          NVIDIA CUDA and OpenCL documentation<br></code></pre></td></tr></table></figure><ul><li>可以看到系统安装了ubuntu 内核18.04 下的 nvidia 460 驱动</li><li>实际系统内核版本与驱动需求的版本不一致是问题产生的根源</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>卸载现有驱动，重新安装</li></ul><h4 id="卸载驱动"><a href="#卸载驱动" class="headerlink" title="卸载驱动"></a>卸载驱动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo /usr/bin/nvidia-uninstall<br>sudo apt-get --purge remove nvidia-*<br>sudo apt-get purge nvidia*<br>sudo apt-get purge libnvidia*<br></code></pre></td></tr></table></figure><ul><li>直到命令不输出任何内容</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo dpkg --list | grep nvidia-*<br></code></pre></td></tr></table></figure><ul><li>重新安装</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo chmod a+x NVIDIA-Linux-x86_64-450.80.02.run<br>sudo ./NVIDIA-Linux-x86_64-450.80.02.run -no-x-check -no-nouveau-check -no-opengl-files<br></code></pre></td></tr></table></figure><blockquote><p>–no-opengl-files 只安装驱动文件,不安装OpenGL文件</p><p>–no-x-check 安装驱动时不检查X服务</p><p>–no-nouveau-check 安装驱动时不检查nouveau</p></blockquote><h3 id="查看驱动更新结果"><a href="#查看驱动更新结果" class="headerlink" title="查看驱动更新结果"></a>查看驱动更新结果</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvidia-smi</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/images_matrixtime/20201203202133.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://blog.csdn.net/qq_40200387/article/details/90341107">https://blog.csdn.net/qq_40200387/article/details/90341107</a></p></li><li><p><a href="https://www.zywvvd.com/2020/12/03/linux/driver/nvidia-driver-install-linux/">https://www.zywvvd.com/2020/12/03/linux/driver/nvidia-driver-install-linux/</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>故障排除</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker - 占满根目录空间的解决方案</title>
    <link href="/2021/03/30/docker/docker_no_space_left/"/>
    <url>/2021/03/30/docker/docker_no_space_left/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Docker 默认会占用根目录的空间，时间久了就会吧根目录占满，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>不知不觉根目录已经没有空间，<code>ls</code> 的补全都会报错。</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">cannot <span class="hljs-built_in">create</span> temp <span class="hljs-built_in">file</span> <span class="hljs-keyword">for</span> here-document: No <span class="hljs-literal">space</span> left <span class="hljs-keyword">on</span> <span class="hljs-title">devic</span><br></code></pre></td></tr></table></figure><ul><li>可以看到 <code>/</code>已经没有空间了</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> df -h</span><br>Filesystem                           Size  Used Avail Use% Mounted on<br>udev                                  32G     0   32G   0% /dev<br>tmpfs                                6.3G  138M  6.2G   3% /run<br>/dev/mapper/MT3--vg-root             219G  208G     0 100% /<br>tmpfs                                 32G   32K   32G   1% /dev/shm<br>tmpfs                                5.0M     0  5.0M   0% /run/lock<br>tmpfs                                 32G     0   32G   0% /sys/fs/cgroup<br>/dev/sdb1                            3.6T  1.1T  2.4T  32% /gluster/data<br></code></pre></td></tr></table></figure><h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h3><h4 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo　apt-get autoclean   # 删除你已经卸载掉的软件包的命令为 <br><br>sudo apt-get clean       # 若你想清理出更多的空间，可以把电脑上存储的安装包全部卸载<br><br>sudo apt-get autoremove  # 删除已经被卸载的软件所依赖的（其他软件不依赖的）孤立的软件包<br></code></pre></td></tr></table></figure><h4 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h4><blockquote><p>空间仍不足：通过建立软链接将/var目录下占用空间较大的目录移动到富足的空间区块（如/home）下，使得/var下不再占用空间。 （具体实现）</p></blockquote><ul><li>查看文件夹下文件占用磁盘空间</li></ul><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gml">sudo du -ah -<span class="hljs-symbol">x</span> --<span class="hljs-built_in">max</span>-<span class="hljs-symbol">depth</span>=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><ul><li>通过排查发现<code>/var/lib/docker</code>中文件巨大，将其移到其他磁盘中</li><li>为了避免风险并提升速度（小文件很多），将其压缩到其他盘中再解压</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">tar -zcvf [压缩后的文件.tar.gz] var<span class="hljs-regexp">/lib/</span>docker<br></code></pre></td></tr></table></figure><ul><li>解压：</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf<span class="hljs-meta"> [压缩后的文件.tar.gz]</span><br></code></pre></td></tr></table></figure><ul><li>将<code>/var/lib/docker</code>重命名为<code>/var/lib/docker-old</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo mv /var/lib/docker /var/lib/docker-old<br></code></pre></td></tr></table></figure><blockquote><p>这时查看 <code>docker images</code> 是空的</p></blockquote><ul><li>建立软连接重现<code>docker</code></li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ln -s <span class="hljs-regexp">/var/</span>lib/docker [解压后的docker文件夹]<br></code></pre></td></tr></table></figure><ul><li>这时查看 <code>docker images</code> 一切正常的化已经可以看到之前的所有docker 数据了</li></ul><blockquote><p>但是如果这时新建容器或启动容器会报错：</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">OCI</span> runtime create failed: /var/lib/docker/overlay<span class="hljs-number">2</span>/c<span class="hljs-number">6</span>eb<span class="hljs-number">60</span>dada<span class="hljs-number">971</span>e<span class="hljs-number">57</span>fd<span class="hljs-number">5</span>d<span class="hljs-number">125</span>fb<span class="hljs-number">61</span>d<span class="hljs-number">294870</span>be<span class="hljs-number">347</span>a<span class="hljs-number">2</span>efb<span class="hljs-number">287862</span>f<span class="hljs-number">8</span>dfe<span class="hljs-number">52</span>d<span class="hljs-number">99</span>c<span class="hljs-number">57</span>b/merged is not an absolute path or is a symlink: unknown<br></code></pre></td></tr></table></figure><ul><li>需要重启 docker</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">service docker <span class="hljs-literal">stop</span><br>service docker <span class="hljs-literal">start</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">service docker restart</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/weixin_30710457/article/details/95471146">https://blog.csdn.net/weixin_30710457/article/details/95471146</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 8 - 大数定理</title>
    <link href="/2021/03/30/math/probability/law-of-large-numbers/law-of-large-numbers/"/>
    <url>/2021/03/30/math/probability/law-of-large-numbers/law-of-large-numbers/</url>
    
    <content type="html"><![CDATA[<blockquote><p>概率论历史上第一个极限定理属于伯努利，后人称之为“大数定律”。概率论中讨论随机变量序列的算术平均值向随机变量各数学期望的算术平均值收敛的定律。</p></blockquote><span id="more"></span><h3 id="依概率收敛"><a href="#依概率收敛" class="headerlink" title="依概率收敛"></a>依概率收敛</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><ul><li><p>设$Y_1,Y_2, \dots ,Y_n, \dots$ 是一个随机变量序列，$a$是一个常数。</p><p>若对于任意正数$\varepsilon $有 ：</p>$$\lim _{n \rightarrow \infty} P\left\{\left|Y_{n}-a\right| \leq \varepsilon\right\}=1$$​</li><li><p>则称序列依概率收敛于$a$，记作：</p></li></ul><p>$$<br>Y_{n} \stackrel{P}{\rightarrow} a<br>$$</p><h4 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h4><ul><li>收敛：表明这是一个随机变量序列，而不是某个随机变量；且序列是无限长，而不是有限长。</li><li>依概率：表明序列无穷远处的随机变量$Y_{\infty}$的分布规律为：绝大部分分布于点 $a$，极少数位于$a$  之外。且分布于$a$  之外的事件发生的概率之和为0。</li></ul><h3 id="大数定理"><a href="#大数定理" class="headerlink" title="大数定理"></a>大数定理</h3><ul><li>设随机变量$X_1,X_2, \dots ,X_n, \dots$ 相互独立，且具有相同的数学期望和方差：</li></ul><p>$$<br>\mathbb{E}\left[X_{k}\right]=\mu, \operatorname{Var}\left[X_{k}\right]=\sigma^{2}<br>$$</p><ul><li>则序列$X_i$依概率收敛于$\mu$：</li></ul>$$\lim _{n \rightarrow \infty} P\left\{\left|\frac{1}{n} \sum_{i=1}^{n} X_{i}-E\left(X_{i}\right)\right|<\varepsilon\right\}=1$$<ul><li>这里并没有要求随机变量$X_1,X_2, \dots ,X_n, \dots$ 同分布。</li></ul><blockquote><p>证明见 <a href="https://www.zywvvd.com/2021/03/30/math/probability/chebyshev-inequality/chebyshev-inequality/">切比雪夫不等式</a></p></blockquote><h3 id="辛钦定理"><a href="#辛钦定理" class="headerlink" title="辛钦定理"></a>辛钦定理</h3><ul><li>设随机变量$X_1,X_2, \dots ,X_n, \dots$ 相互独立，服从同一分布，且具有相同的数学期望$\mu$，则对于任意正数$\varepsilon$有：</li></ul>$$\lim _{n \rightarrow \infty} P\left\{\left|\frac{1}{n} \sum_{k=1}^{n} X_{k}-\mu\right|<\varepsilon\right\}=1$$<ul><li>注意：这里并没有要求随机变量$X_i$的方差存在</li></ul><h4 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h4><ul><li>由于$X_i$同分布，他们有相同的分布，也就具有相同的<a href="https://www.zywvvd.com/2021/03/30/math/probability/Characteristic-Function/Characteristic-Function/">特征函数</a>：</li></ul><p>$$<br>\varphi_{X}(t)=E\left[e^{i t X}\right]<br>$$</p><ul><li>其中$e^{i t X}$为：</li></ul><p>$$<br>e^{i t X}=1+\frac{i t X}{1}-\frac{t^{2} X^{2}}{2 !}+\cdots+\frac{(i t)^{n} X^{n}}{n !}<br>$$</p><ul><li>因此$X$的期望$E(X)$可以用特征函数在$t=0$处的一阶导数表示：</li></ul>$$\begin{array}{l}\varphi_{X}'(0)=iE(X)\\E(X)=\frac{\varphi_{X}'(0)}{i}\end{array}$$<ul><li>将特征函数在$t=0$处泰勒展开，有：</li></ul><p>$$<br>\varphi_{X}(t)=\varphi_{X}(0)+\varphi_{X}’(0)t+o(t)=1+i\mu t+o(t)<br>$$</p><ul><li>其中$\mu$=$E(X)$</li><li>由于$X_i$相互独立，变量$\frac{1}{n} \sum_{k=1}^{n} X_{k}$的特征函数为：</li></ul>$$\begin{array}{l}{g_n}(t) &= E[{e^{it\frac{1}{n}\sum\limits_{k = 1}^n {{X_k}} }}]\\ &= E[{e^{i\frac{{\rm{t}}}{n}{X_1}}} \cdot {e^{i\frac{{\rm{t}}}{n}{X_2}}} \cdot  \cdots  \cdot {e^{i\frac{{\rm{t}}}{n}{X_n}}}]\\ &= {\{ E[{e^{i\frac{{\rm{t}}}{n}X}}]\} ^n}\\ &= {[{\varphi _X}(\frac{t}{n})]^n}\\ &= {[1 + i\mu \frac{t}{n} + o(t)]^n}\end{array}$$<ul><li>根据（可由<a href="https://www.zywvvd.com/2021/03/30/math/LHolpitals-Rule/LHolpitals-Rule/">洛必达法则</a>推出）：</li></ul>$$\mathop {\lim }\limits_{n \to \infty } {\rm{(1 + }}\frac{{\rm{a}}}{n}{)^n} = {e^a}$$<ul><li>得：</li></ul><p>$$<br>{g_n}(t)=e^{i\mu t}=1+\frac{i t E(X)}{1}-\frac{t^{2} E(X^{2})}{2 !}+\cdots+\frac{(i t)^{n} E(X^{n})}{n !}<br>$$</p><ul><li>而$e^{i\mu t}$为：</li></ul><p>$$<br>e^{i\mu t}=1+\frac{i t \mu}{1}-\frac{t^{2} \mu^{2}}{2 !}+\cdots+\frac{(i t)^{n} \mu^{n}}{n !}<br>$$</p><ul><li>即$X$的$n$阶矩与期望的关系为：</li></ul><p>$$<br>E(X^n)=\mu^n<br>$$</p><ul><li>变量$\frac{1}{n} \sum_{k=1}^{n} X_{k}$与退化函数：</li></ul>$$F(X) = \left\{ {\begin{array}{*{20}{c}}{\mu,X = a}\\{0,X \ne a}\end{array}} \right.$$<ul><li>二者具有相同的特征函数，因此具有相同的分布，有：</li></ul>$$\lim _{n \rightarrow \infty} P\left\{\left|\frac{1}{n} \sum_{k=1}^{n} X_{k}-\mu\right|<\varepsilon\right\}=1$$<h3 id="伯努利大数定理"><a href="#伯努利大数定理" class="headerlink" title="伯努利大数定理"></a>伯努利大数定理</h3><ul><li>设$n_A$为$n$次独立重复实验中事件$A$发生的次数， $p$是事件$A$在每次试验中发生的概率。则对于任意正数$\varepsilon$有：</li></ul>$$\begin{aligned}& \lim _{n \rightarrow \infty} P\left\{\left|\frac{n_{A}}{n}-p\right|<\varepsilon\right\}=1 \\\text { or : } & \lim _{n \rightarrow \infty} P\left\{\left|\frac{n_{A}}{n}-p\right| \geq \varepsilon\right\}=0\end{aligned}$$<ul><li><p>当独立重复实验执行非常大的次数时，事件$A$发生的频率逼近于它的概率</p></li><li><p>伯努利大数定理是亲钦定理的特殊情况</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 7 - 特征函数</title>
    <link href="/2021/03/30/math/probability/Characteristic-Function/Characteristic-Function/"/>
    <url>/2021/03/30/math/probability/Characteristic-Function/Characteristic-Function/</url>
    
    <content type="html"><![CDATA[<blockquote><p>特征函数是随机变量的分布的不同表示形式。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p>一般而言，对于随机变量$X$的分布，大家习惯用概率密度函数来描述，虽然概率密度函数理解起来很直观，但是确实随机变量的分布还有另外的描述方式，比如特征函数。</p></blockquote><ul><li><p>特征函数的本质是概率密度函数的泰勒展开</p></li><li><p>每一个级数表示原始概率密度函数的一个特征</p></li><li><p>如果两个分布的所有特征都相同，那我们就认为这是两个相同的分布</p></li><li><p><code>矩</code>是描述概率分布的重要特征，期望、方差等概念都是矩的特殊形态</p></li><li><p>直觉上可以简单理解为：</p><ul><li>各阶矩相等 → 各个特征相等 → 分布相同</li></ul></li></ul><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul><li>随机变量$X$ 的特征函数定义为：</li></ul><p>$$<br>\varphi_{X}(t)=E\left[e^{i t X}\right]<br>$$</p><ul><li>针对概率密度函数为$f(x)$的连续随机变量$x$，特征函数写作：</li></ul>$$\varphi_x(t)=\int_{-\infty}^{\infty} e^{i t x} f(x) \cdot d x$$<ul><li>为什么这么定义呢? 首先, $e^{i t X}$ 的泰勒级数为:</li></ul><p>$$<br>e^{i t X}=1+\frac{i t X}{1}-\frac{t^{2} X^{2}}{2 !}+\cdots+\frac{(i t)^{n} X^{n}}{n !}<br>$$</p><ul><li>代入可以推出：</li></ul>$$\begin{aligned}\varphi_{X}(t) &=E\left[e^{i t X}\right] \\&=E\left(1+\frac{i t X}{1}-\frac{t^{2} X^{2}}{2 !}+\cdots+\frac{(i t)^{n} X^{n}}{n !}\right) \\&=E(1)+E\left(\frac{i t X}{1}\right)-E\left(\frac{t^{2} X^{2}}{2 !}\right)+\cdots+E\left(\frac{(i t)^{n} X^{n}}{n !}\right) \\&=1+\frac{i t \overbrace{E[X]}^{\text {一阶矩 }}}{1}-\frac{t^{2} \overbrace{E\left[X^{2}\right]}^{\text {二阶矩 }}}{2 !}+\cdots+\frac{(i t)^{n} \overbrace{E\left[X^{n}\right]}^{\text {n阶矩 }}}{n !}\end{aligned}$$<ul><li>也就是说特征函数包含了分布函数的所有<code>矩</code>，可以理解为包含了分布的所有特征</li><li>之前的结论可以进一步理解为：<ul><li>$\varphi_{X}(t) $相等 → 各阶矩相等 → 各个特征相等 → 分布相同</li></ul></li><li>所以，特征函数其实是随机变量$X$的分布的另外一种描述方式</li></ul><h3 id="一些推论"><a href="#一些推论" class="headerlink" title="一些推论"></a>一些推论</h3><ul><li>设随机变量$X$的概率密度函数为$f(x)$ ，其特征函数为：</li></ul>$$\varphi_x(t)=\int_{-\infty}^{\infty} e^{i t x} f(x) \cdot d x$$<h4 id="独立变量和的特征函数"><a href="#独立变量和的特征函数" class="headerlink" title="独立变量和的特征函数"></a>独立变量和的特征函数</h4><ul><li>$Y=X_1+X_2 $，其中$X_1,X_2$相互独立，特征函数：</li></ul>$$\begin{array}{l}\varphi_{y}(t)&=\varphi_{x_{1}+x_{2}}(t) \\&=\iint_{-\infty}^{\infty} e^{i t\left(x_{1}+x_{2}\right)} \cdot f\left(x_{1}\right) \cdot g\left(x_{2}\right) \cdot d x_{1} d x_{2} \\&=\int_{-\infty}^{\infty} e^{i t x_{1}} f\left(x_{1}\right) d x_{1} \cdot \int_{-\infty}^{\infty} e^{i t x_{2}} g\left(x_{2}\right) d x_{2} \\&=\varphi_{x_{1}}(t) \cdot \varphi_{x_{2}}(t)\end{array}$$<h4 id="常数线性变换的特征函数"><a href="#常数线性变换的特征函数" class="headerlink" title="常数线性变换的特征函数"></a>常数线性变换的特征函数</h4><ul><li>$Y=aX+b$ 的特征函数：</li></ul>$$\begin{array}{l}\varphi_{y}(t)&=\varphi_{a x+b}(t)=\int_{-\infty}^{\infty} e^{i t(a x+b)} f(x) d x \\&=e^{i t b} \int_{-\infty}^{\infty} e^{i(a t) x} f(x) d x \\&=e^{i t b} \cdot \varphi_{x}(a t)\end{array}$$<h4 id="标准正态分布的特征函数"><a href="#标准正态分布的特征函数" class="headerlink" title="标准正态分布的特征函数"></a>标准正态分布的特征函数</h4><ul><li>设 $X \sim N(0,1)$则其概率密度函数为：</li></ul>$$f(x)=\frac{1}{\sqrt{2 \pi}} e^{-\frac{x^{2}}{2}}$$<ul><li>特征函数为：</li></ul>$$\begin{array}{l}\varphi(t)&=\int_{-\infty}^{\infty} e^{i t x} \cdot \frac{1}{\sqrt{2 \pi}} e^{-\frac{x^{2}}{2}} \cdot d x \\&=e^{-\frac{t^{2}}{2}} \int_{-\infty}^{\infty} \frac{1}{\sqrt{2 \pi}} e^{-\frac{(x-i t)^{2}}{2}} d(x-i t) \\&=e^{-\frac{t^{2}}{2}}\end{array}$$<h3 id="特征函数是共轭傅立叶变换"><a href="#特征函数是共轭傅立叶变换" class="headerlink" title="特征函数是共轭傅立叶变换"></a>特征函数是共轭傅立叶变换</h3><ul><li>假设某连续随机变量$X$的概率密度函数为$f(x)$，那么可知：</li></ul><p>$$<br>{\rm{E(X) = }}\int\limits_{ - \infty }^{ + \infty } {xf(x)dx}<br>$$</p><ul><li>特征函数为：</li></ul>$$\begin{array}{l}{\varphi _X}(t) &= E[{e^{itX}}]\\ &= \int\limits_{ - \infty }^{ + \infty } {{e^{itX}}f(x)dx} \end{array}$$<ul><li>而$f(x)$的傅立叶变换为：</li></ul><p>$$<br>{\rm{F(X) = }}\int\limits_{ - \infty }^{ + \infty } {f(x)e^{-itx}dx}<br>$$</p><ul><li>二者是共轭关系：</li></ul><p>$$<br>{\varphi _X}(t) = \overline {F(t)}<br>$$</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://www.zhihu.com/question/23686709/answer/376439033">https://www.zhihu.com/question/23686709/answer/376439033</a></p></li><li><p><a href="https://www.zhihu.com/question/25956080/answer/1375064657">https://www.zhihu.com/question/25956080/answer/1375064657</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>洛必达法则</title>
    <link href="/2021/03/30/math/LHolpitals-Rule/LHolpitals-Rule/"/>
    <url>/2021/03/30/math/LHolpitals-Rule/LHolpitals-Rule/</url>
    
    <content type="html"><![CDATA[<blockquote><p>洛必达法则是在一定条件下通过分子分母分别求导再求极限来确定未定式值的方法。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>众所周知，两个无穷小之比或两个无穷大之比的极限可能存在，也可能不存在。因此，求这类极限时往往需要适当的变形，转化成可利用极限运算法则或重要极限的形式进行计算。</p></blockquote><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><h4 id="零比零型"><a href="#零比零型" class="headerlink" title="零比零型"></a>零比零型</h4><ul><li>若函数$f(x)$和$g(x)$满足如下条件：</li></ul><ol><li>在$a$点收敛于0</li></ol><p>$$<br>\lim _{x \rightarrow a} f(x)=0, \lim _{x \rightarrow a} g(x)=0<br>$$</p><ol start="2"><li>在点 $a$ 的某去心邻域内两者都可导，且 $g^{\prime}(x) \neq 0$</li><li>$\lim _{x \rightarrow a} \frac{f^{\prime}(x)}{g^{\prime}(x)}=A\left(A\right.$ 可为实数，也可为 $\left.\pm {\infty}\right),$ 则<br>$$<br>\lim _{x \rightarrow a} \frac{f(x)}{g(x)}=\lim _{x \rightarrow a} \frac{f^{\prime}(x)}{g^{\prime}(x)}=A<br>$$</li></ol><h4 id="无穷比无穷型"><a href="#无穷比无穷型" class="headerlink" title="无穷比无穷型"></a>无穷比无穷型</h4><ul><li>若函数$f(x)$和$g(x)$满足如下条件：</li></ul><ol><li>在$a$点收敛于无穷</li></ol><p>$$<br>\lim _{x \rightarrow a} f(x)=\infty , \lim _{x \rightarrow a} g(x)=\infty<br>$$</p><ol start="2"><li>在点 $a$ 的某去心邻域内两者都可导，且 $g^{\prime}(x) \neq 0$</li><li>$\lim _{x \rightarrow a} \frac{f^{\prime}(x)}{g^{\prime}(x)}=A\left(A\right.$ 可为实数，也可为$\left.\pm {\infty}\right),$ 则：</li></ol><p>$$<br>\lim _{x \rightarrow a} \frac{f(x)}{g(x)}=\lim _{x \rightarrow a} \frac{f^{\prime}(x)}{g^{\prime}(x)}=A<br>$$</p><h3 id="其他不定式"><a href="#其他不定式" class="headerlink" title="其他不定式"></a>其他不定式</h3><ul><li>不定式极限还包括<ul><li>$0  \cdot \infty $</li><li>$1^\infty$</li><li>$0^0$</li><li>$\infty^0$</li><li>$\infty - \infty$</li></ul></li><li>经过简单变化，一般可以转化为零比零和无穷比无穷型的极限</li></ul><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul><li>注意:不能在数列形式下直接用洛必达法则,因为对于离散变量$n∈N $是无法求导数的</li><li>在运用洛必达法则之前，首先要完成两项任务：<ul><li>一是分子分母的极限是否都等于零(或者无穷大)；</li><li>二是分子分母在限定的区域内是否分别可导。</li></ul></li><li>如果这两个条件都满足，接着求导并判断求导之后的极限是否存在：<ul><li>如果存在，直接得到答案；</li><li>如果不存在，则说明此种未定式不可用洛必达法则来解决；</li><li>如果不确定，即结果仍然为未定式，再在验证的基础上继续使用洛必达法则。</li></ul></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.gaosan.com/gaokao/317487.html">http://www.gaosan.com/gaokao/317487.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 6 - 切比雪夫不等式</title>
    <link href="/2021/03/30/math/probability/chebyshev-inequality/chebyshev-inequality/"/>
    <url>/2021/03/30/math/probability/chebyshev-inequality/chebyshev-inequality/</url>
    
    <content type="html"><![CDATA[<blockquote><p>切比雪夫不等式可以使人们在随机变量X的分布未知的情况下，对事件$|X-\mu|&lt;\varepsilon $ 概率作出估计。</p></blockquote><span id="more"></span><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul><li>假设随机变量$X$具有期望$E(X)=\mu$， 方差 $Var(X)=\sigma^2$，则对于任意正数$\varepsilon$ ，有不等式成立：</li></ul><p>$$<br>\mathbb P{|X-\mu| \geq \varepsilon} \leq \frac{\sigma^{2}}{\varepsilon^{2}}<br>$$</p><h3 id="含义"><a href="#含义" class="headerlink" title="含义"></a>含义</h3><ul><li><p>其意义是：对于距离$E(X)$足够远的地方（距离大于等于$\varepsilon$），事件出现的概率是小于等于$\frac{\sigma^{2}}{\varepsilon^{2}}$ 。即事件出现在区间$[\mu-\varepsilon, \mu+\varepsilon]$ 的概率大于$1-\frac{\sigma^2}{\varepsilon^2}$ </p></li><li><p>该不等式给出了随机变量$X$在分布未知的情况下， 事件$|X-\mu| \leq \varepsilon$ 的下限估计</p><blockquote><p>例如：</p></blockquote><p>$$<br>\mathbb P{|X-\mu|\ &lt; 3 \sigma } \ge 1-\frac{1}{9}=\frac{8}{9}<br>$$</p></li><li><p>切比雪夫不等式刻画了变量偏离均值的程度与发生概率大小之间的关系</p></li><li><p>在随机变量分布未知的情况下，我们只知道均值和方差，切比雪夫不等式给出了$X$落入以均值为中心的$ε$邻域概率的概率下界</p></li></ul><h3 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h3><h4 id="思路1"><a href="#思路1" class="headerlink" title="思路1"></a>思路1</h4><blockquote><p>利用取值范围建立不等式</p></blockquote>$$\begin{aligned}\mathbb P\{|X-\mu| \geq \varepsilon\} &=\int_{|x-\mu| \geq \varepsilon} p(x) d x \\&\leq \int_{|x-\mu| \geq \varepsilon} \frac{|x-\mu|^{2}}{\varepsilon^{2}} p(x) d x \\& \leq \frac{1}{\varepsilon^{2}} \int_{-\infty}^{\infty}(x-\mu)^{2} p(x) d x\\&=\frac{\sigma^{2}}{\varepsilon^{2}}\end{aligned}$$<h4 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h4><blockquote><p>利用<a href="https://www.zywvvd.com/2021/03/30/math/probability/markov-inequality/markov-inequality/">马尔可夫不等式</a></p></blockquote><p>$$<br>\mathbb{P}(X \geq a) \leq \frac{\mathbb{E}(X)}{a}<br>$$</p><ul><li>将$|X-\mu|$作为随机变量带入不等式，有：</li></ul><p>$$<br>\mathbb P(|X-\mu| \ge \varepsilon) \leq \frac{E(|X-\mu|)}{\varepsilon}<br>$$</p><ul><li>其中$\varepsilon &gt; 0$，而：</li></ul><p>$$<br>\mathbb P(|X-\mu| \ge \varepsilon) = \mathbb P(|X-\mu|^2 \ge \varepsilon^2)<br>$$</p><ul><li>再次套用马尔可夫不等式：</li></ul><p>$$<br>\mathbb P(|X-\mu| \ge \varepsilon) =\mathbb P(|X-\mu|^2 \ge \varepsilon^2) \le \frac{E(|X-\mu|^2)}{\varepsilon^2}=\frac{\sigma^2}{\varepsilon^2}<br>$$</p><h3 id="推论——切比雪夫定理"><a href="#推论——切比雪夫定理" class="headerlink" title="推论——切比雪夫定理"></a>推论——切比雪夫定理</h3><ul><li>对于相互独立具有相同期望和方差的随机变量$X_i$，$\frac{1}{n}\sum\limits_{i = 1}^n  $的方差为：</li></ul>$$\frac{{Var(X)}}{n}=\frac{{{\sigma ^2}}}{n}$$<ul><li>那么当 $n \to \infty $时，$\frac{1}{n}\sum\limits_{i = 1}^n  $的方差$\to 0 $，对于任意给定的$\varepsilon &gt; 0$，根据切比雪夫不等式有：</li></ul>$$\lim _{n \rightarrow \infty} P\left\{\left|\frac{1}{n} \sum_{i=1}^{n} X_{i}-E\left(X_{i}\right)\right|<\varepsilon\right\}=1$$<ul><li>即当样本个数趋于无穷时，样本的算数平均值会收敛于理论均值</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://baike.baidu.com/item/%E5%88%87%E6%AF%94%E9%9B%AA%E5%A4%AB%E5%AE%9A%E7%90%86/3647561?fromtitle=%E5%88%87%E6%AF%94%E9%9B%AA%E5%A4%AB%E4%B8%8D%E7%AD%89%E5%BC%8F&amp;fromid=8709330&amp;fr=aladdin">https://baike.baidu.com/item/%E5%88%87%E6%AF%94%E9%9B%AA%E5%A4%AB%E5%AE%9A%E7%90%86/3647561?fromtitle=%E5%88%87%E6%AF%94%E9%9B%AA%E5%A4%AB%E4%B8%8D%E7%AD%89%E5%BC%8F&amp;fromid=8709330&amp;fr=aladdin</a></li><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li><li><a href="https://blog.csdn.net/ukakasu/article/details/82688413">https://blog.csdn.net/ukakasu/article/details/82688413</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 5 - 马尔可夫不等式</title>
    <link href="/2021/03/30/math/probability/markov-inequality/markov-inequality/"/>
    <url>/2021/03/30/math/probability/markov-inequality/markov-inequality/</url>
    
    <content type="html"><![CDATA[<blockquote><p>马尔可夫不等式把概率关联到数学期望，给出了随机变量的累积分布函数一个宽泛但仍有用的界。</p></blockquote><span id="more"></span><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><blockquote><p>马尔可夫不等式用于估计尾事件的概率上界。</p></blockquote><ul><li>若随机变量$X$只取非负值，则$\forall a&gt;0$有：</li></ul><p>$$<br>\mathbb{P}(X \geq a) \leq \frac{\mathbb{E}(X)}{a}<br>$$</p><h3 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h3><h4 id="思路1"><a href="#思路1" class="headerlink" title="思路1"></a>思路1</h4><blockquote><p>放大概率，得到部分函数期望</p><p>截断函数期望，二者相比较</p></blockquote><ul><li>考虑 $X\ge a$的情况 → $\frac {X}{a} \ge 1$</li><li>对于不等式左边有：</li></ul><p>$$<br>\mathbb P(X \geq a)=\int_{a}^{+\infty} f(x) d x \leq \int_{a}^{+\infty} \frac{X}{a} f(x) d x<br>$$</p><ul><li>对于不等式右边有：</li></ul><p>$$<br>E\left(\frac{X}{a}\right)=\int_{-\infty}^{a} \frac{X}{a} f(x) d x+\int_{a}^{+\infty} \frac{X}{a} f(x) d x<br>$$</p><ul><li>由于：</li></ul><p>$$<br>\int_{-\infty}^{a} \frac{X}{a} f(x) d x \geq 0<br>$$</p><ul><li>因此：</li></ul><p>$$<br>\mathbb P(X \geq a) \leq \int_{a}^{+\infty} \frac{X}{a} f(x) d x \leq E\left(\frac{X}{a}\right)<br>$$</p><ul><li>即：</li></ul><p>$$<br>\mathbb P(X \geq a) \leq E\left(\frac{X}{a}\right)=\frac{E(X)}{a}<br>$$</p><h4 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h4><blockquote><p>原始期望大于截断部分非负值的期望</p><p>求取期望时缩小$X$得到$a$</p></blockquote><p>$$<br>\begin{aligned}<br>\mathbb{E}(X) &amp;=\int_{-\infty}^{\infty} x f(x) d x \<br>&amp; \geq \int_{a}^{\infty} x f(x) d x \quad(a \geq 0) \<br>&amp; \geq \int_{a}^{\infty} a f(x) d x \<br>&amp;=a \int_{a}^{\infty} f(x) d x \<br>&amp;=a \mathbb{P}(X \geq a)<br>\end{aligned}<br>$$</p><h3 id="图示"><a href="#图示" class="headerlink" title="图示"></a>图示</h3><blockquote><p>$a$越大于均值，$X&gt;a$的概率越小</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210330100709.gif" alt="转自知乎-马同学"></p><h3 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h3><ul><li>将概率与期望联系起来建立了不等式关系</li><li>约束较松，可以用来粗略估计尾部事件</li></ul><blockquote><p>例如：</p><p>如果$X$是工资，那么$E(X)$就是平均工资，假设$a=n  E(X)$，即平均工资的$n$倍。那么根据马尔可夫不等式，不超过$1/n$的人会有超过平均工资的$n$倍的工资。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://baike.baidu.com/item/%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E4%B8%8D%E7%AD%89%E5%BC%8F/7565874?fr=aladdin">https://baike.baidu.com/item/%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E4%B8%8D%E7%AD%89%E5%BC%8F/7565874?fr=aladdin</a></p></li><li><p><a href="https://www.zhihu.com/question/27821324">https://www.zhihu.com/question/27821324</a></p></li><li><p><a href="https://blog.csdn.net/ukakasu/article/details/82688413">https://blog.csdn.net/ukakasu/article/details/82688413</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 4 - 协方差、相关系数、协方差矩阵</title>
    <link href="/2021/03/27/math/probability/covariance/covariance/"/>
    <url>/2021/03/27/math/probability/covariance/covariance/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍协方差。</p></blockquote><span id="more"></span><h3 id="协方差"><a href="#协方差" class="headerlink" title="协方差"></a>协方差</h3><blockquote><p>协方差表示的是两个变量的总体的<a href="https://baike.baidu.com/item/%E8%AF%AF%E5%B7%AE/738024">误差</a>，这与只表示一个变量误差的<a href="https://baike.baidu.com/item/%E6%96%B9%E5%B7%AE/3108412">方差</a>不同。 如果两个<a href="https://baike.baidu.com/item/%E5%8F%98%E9%87%8F/5271">变量</a>的变化趋势一致，也就是说如果其中一个大于自身的期望值，另外一个也大于自身的期望值，那么两个变量之间的协方差就是正值。 如果两个变量的变化趋势相反，即其中一个大于自身的期望值，另外一个却小于自身的期望值，那么两个变量之间的协方差就是负值。 —— 百度百科</p></blockquote><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><ul><li>在概率论和统计学中，协方差用于衡量两个变量的总体误差。而<a href="https://www.zywvvd.com/2021/03/27/math/probability/expectation-and-variance/variance/">方差</a>是协方差的一种特殊情况，即当两个变量是相同的情况。</li><li>期望值分别为$E[X]$与$E[Y]$的两个实随机变量$X$与$Y$之间的**协方差$Cov(X,Y)$定义为：</li></ul>$$\begin{aligned}\operatorname{Cov}(X, Y) &=E[(X-E[X])(Y-E[Y])] \\&=E[X Y]-2 E[Y] E[X]+E[X] E[Y] \\&=E[X Y]-E[X] E[Y]\end{aligned}$$<h4 id="相关系数"><a href="#相关系数" class="headerlink" title="相关系数"></a>相关系数</h4><ul><li>定义随机变量$X$与$Y$的相关系数：</li></ul><p>$$<br>\rho_{X Y}=\frac{\operatorname{Cov}[X, Y]}{\sqrt{\operatorname{Var}[X]} \sqrt{\operatorname{Var}[Y]}}<br>$$</p><ul><li>相关系数是协方差的归一化</li></ul><h4 id="与方差的关系"><a href="#与方差的关系" class="headerlink" title="与方差的关系"></a>与方差的关系</h4><ul><li>由定义可知：</li></ul>$$\begin{array}{c}\operatorname{Cov}[X, Y]=\operatorname{Cov}[Y, X] \\\operatorname{Cov}[X, X]=\operatorname{Var}[X] \\\operatorname{Var}[X+Y]=\operatorname{Var}[X]+\operatorname{Var}[Y]+2 \operatorname{Cov}[X, Y]\end{array}$$<h4 id="协方差的性质"><a href="#协方差的性质" class="headerlink" title="协方差的性质"></a>协方差的性质</h4><ul><li><p>$a, b$ 为常数，有：<br>$$<br>\operatorname{Cov}[a X, b Y]=a b \operatorname{Cov}[X, Y]<br>$$</p></li><li><p>变量和的协方差：</p></li></ul><p>$$<br>\operatorname{Cov}\left[X_{1}+X_{2}, Y\right]=\operatorname{Cov}\left[X_{1}, Y\right]+\operatorname{Cov}\left[X_{2}, Y\right]<br>$$</p><ul><li>连续变量的协方差：</li></ul><p>$$<br>\operatorname{Cov}[f(X), g(Y)]=\mathbb{E}[(f(X)-\mathbb{E}[f(X)])(g(Y)-\mathbb{E}[g(Y)])]<br>$$</p><ul><li>连续变量的协方差系数：</li></ul><p>$$<br>\rho[f(X), g(Y)]=\frac{\operatorname{Cov}[f(X), g(Y)]}{\sqrt{\operatorname{Var}[f(X)]} \sqrt{\operatorname{Var}[g(Y)]}}<br>$$</p><h4 id="协方差的物理意义"><a href="#协方差的物理意义" class="headerlink" title="协方差的物理意义"></a>协方差的物理意义</h4><ul><li><p>协方差的绝对值越大，说明两个随机变量都远离它们的均值</p></li><li><p>协方差为正，则说明两个随机变量同时趋向于取较大的值或者同时趋向于取较小的值</p></li><li><p>协方差为负，则说明一个随变量趋向于取较大的值，另一个随机变量趋向于取较小的值</p></li><li><p>两个随机变量的独立性可以导出协方差为零，但是两个随机变量的协方差为零无法导出独立性——<a href="https://www.zywvvd.com/2021/03/12/math/probability/orthogonal-independent-uncorrelation/orthogonal-independent-uncorrelation/">正交-不相关-独立</a></p><blockquote><p>因为独立性也包括：没有非线性关系</p><p>有可能两个随机变量是非独立的，但是协方差为零</p><p>如：假设随机变量 $X \sim U[-1,1]$。定义随机变量 的概率分布函数为：<br>$$<br>P(S=1)=\frac{1}{2} P(S=-1)=\frac{1}{2}<br>$$<br>定义随机变量 $Y=SX$，则随机变量$X,Y$是非独立的，但是有：<br>$$<br>Cov[X,Y]=0<br>$$</p></blockquote></li></ul><h4 id="相关系数的物理意义"><a href="#相关系数的物理意义" class="headerlink" title="相关系数的物理意义"></a>相关系数的物理意义</h4><blockquote><p>考虑以随机变量$X$的线性函数$a+bX$ 来近似表示$Y$。</p></blockquote><ul><li>均方误差，$e$为：</li></ul><p>$$<br>e=\mathbb{E}\left[(Y-(a+b X))^{2}\right]=\mathbb{E}\left[Y^{2}\right]+b^{2} \mathbb{E}\left[X^{2}\right]+a^{2}-2 b \mathbb{E}[X Y]+2 a b \mathbb{E}[X]-2 a \mathbb{E}[Y]<br>$$</p><ul><li>e取极小值，该优化问题为凸优化，直接求导为0即可：</li></ul>$$\left\{ \begin{array}{l}\frac{{\partial e}}{{\partial a}} = 2a + 2b\mathbb{E}[X] - 2\mathbb{E}[Y] = 0\\\frac{{\partial e}}{{\partial b}} = 2b\mathbb{E}[{X^2}] - 2\mathbb{E}[XY] + 2a\mathbb{E}[X] = 0\end{array} \right.$$<ul><li>解得：</li></ul>$$\left\{ {\begin{array}{*{20}{c}}{a = \mathbb{E}[Y] - \frac{{Cov[X,Y]}}{{Var[X]}}\mathbb{E}[X]}\\{b = \frac{{Cov[X,Y]}}{{Var[X]}}}\end{array}} \right.$$<ul><li>带入$e$得：</li></ul><p>$$<br>\min (e)=\mathbb{E}\left[\left(Y-\left(a_{0}+b_{0} X\right)\right)^{2}\right]=\left(1-\rho_{X Y}^{2}\right) \operatorname{Var}[Y]<br>$$</p><ul><li><p>因此有以下定理：</p><ul><li>$\left|\rho_{X Y}\right| \leq 1$</li><li>$|\rho_{X Y}| = 1$的充要条件为：存在常数$a,b$使得$Y=a+bX$ </li></ul></li><li><p>当$\left|\rho_{X Y}\right|$较大时， $e$较小，意味着随机变量$X$和$Y$联系较紧密。于是$\rho_{X Y}$ 是一个表征 $X$、$Y$之间线性关系紧密程度的量</p></li><li><p>当$\rho_{X Y}=0$时，称$X$和$Y$ 不相关。</p><ul><li>不相关是就线性关系来讲的，而相互独立是一般关系而言的。</li><li>相互独立一定不相关；不相关则未必独立。</li></ul></li></ul><h3 id="矩"><a href="#矩" class="headerlink" title="矩"></a>矩</h3><ul><li>设$X$和$Y$是随机变量：<ul><li>若$\mathbb{E}\left[X^{k}\right], k=1,2, \cdots$存在，则称它为$X$的$k$阶原点矩，简称$k$阶矩。</li><li>若$\mathbb{E}\left[(X-\mathbb{E}[X])^{k}\right], k=2,3, \cdots$存在，则称它为$X$的$k$阶中心矩。</li><li>若$\mathbb{E}\left[X^{k} Y^{l}\right], k, l=1,2, \cdots$存在，则称它为$X$的$Y$的$k+l$阶混合矩。</li><li>若$\mathbb{E}\left[(X-\mathbb{E}[X])^{k}(Y-\mathbb{E}[Y])^{l}\right], k, l=1,2, \cdots$存在，则称它为$X$的$Y$的$k+l$阶混合中心矩。</li></ul></li><li>期望是一阶原点矩</li><li>方差是二阶中心矩</li><li>协方差是二阶混合中心矩</li></ul><h3 id="协方差矩阵"><a href="#协方差矩阵" class="headerlink" title="协方差矩阵"></a>协方差矩阵</h3><ul><li>设$n$维随机变量$(X_1,X_2, \dots,X_n)$的二阶混合中心矩</li></ul><p>$$<br>c_{i j}=\operatorname{Cov}\left[X_{i}, X_{j}\right]=\mathbb{E}\left[\left(X_{i}-\mathbb{E}\left[X_{i}\right]\right)\left(X_{j}-\mathbb{E}\left[X_{j}\right]\right)\right]<br>$$</p><ul><li>都存在，则称矩阵：</li></ul>$$\mathbf{C}=\left[\begin{array}{cccc}c_{11} & c_{12} & \cdots & c_{1 n} \\c_{21} & c_{22} & \cdots & c_{2 n} \\\vdots & \vdots & \ddots & \vdots \\c_{n 1} & c_{n 2} & \cdots & c_{n n}\end{array}\right]$$<ul><li>为$n$维随机变量$(X_1,X_2, \dots,X_n)$的协方差矩阵</li><li>由于$c_{ij} = c_{ji}$ 因此协方差矩阵是对称阵</li><li>由于对角线为各个变量的方差，因此对角线非负</li><li>通常$n$ 维随机变量的分布是不知道的，或者太复杂以致数学上不容易处理，因此实际中协方差矩阵非常重要。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></p></li><li><p><a href="https://baike.baidu.com/item/%E5%8D%8F%E6%96%B9%E5%B7%AE/2185936?fr=aladdin">https://baike.baidu.com/item/%E5%8D%8F%E6%96%B9%E5%B7%AE/2185936?fr=aladdin</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 3 - 方差</title>
    <link href="/2021/03/27/math/probability/expectation-and-variance/variance/"/>
    <url>/2021/03/27/math/probability/expectation-and-variance/variance/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍方差。</p></blockquote><span id="more"></span><h3 id="方差"><a href="#方差" class="headerlink" title="方差"></a>方差</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote><p>数学期望(mean)（或<a href="https://baike.baidu.com/item/%E5%9D%87%E5%80%BC/5922988">均值</a>，亦简称期望）是试验中每次可能结果的<a href="https://baike.baidu.com/item/%E6%A6%82%E7%8E%87/828845">概率</a>乘以其结果的总和，是最基本的<a href="https://baike.baidu.com/item/%E6%95%B0%E5%AD%A6/107037">数学</a>特征之一。它反映随机变量平均取值的大小。    ——百度百科</p></blockquote><ul><li>对随机变量$X$，若$\mathbb{E}\left[(X-\mathbb{E}[X])^{2}\right]$存在，则称它为$X$的方差，记作 $Var[X]$。</li><li>$X$的标准差为方差的开平方：$\sigma=\sqrt{\operatorname{Var}[X]}$<ul><li>方差度量了随机变量$X$与期望值偏离的程度，衡量了$X$取值分散程度的一个尺度。</li></ul></li><li>对于一个期望为$\mu$ ， 方差为$\sigma^2$的随机变量$X$ ，随机变量$X^{<em>}=\frac{X-\mu}{\sigma}$的数学期望为0，方差为1。 称$X^</em>$为$X$的标准化变量</li></ul><h4 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h4><ul><li>常数的方差恒为 0 </li><li>对常数$C$，有：</li></ul><p>$$<br>\operatorname{Var}[C X]=C^{2} \operatorname{Var}[X]<br>$$</p><ul><li>对两个随机变量$X,Y$，有： </li></ul><p>$$<br>\operatorname{Var}[X+Y]=\operatorname{Var}[X]+\operatorname{Var}[Y]+2 \mathbb{E}[(X-\mathbb{E}[X])(Y-\mathbb{E}[Y])]<br>$$</p><ul><li>当$X,Y$相互独立时，有：</li></ul><p>$$<br>\operatorname{Var}[X+Y]=\operatorname{Var}[X]+\operatorname{Var}[Y]<br>$$</p><ul><li>可以推广至任意有限多个相互独立的随机变量之和的情况。</li></ul><h4 id="样本方差的均值估计"><a href="#样本方差的均值估计" class="headerlink" title="样本方差的均值估计"></a>样本方差的均值估计</h4><blockquote><p>假设$X$为独立同分布的一组随机变量，总体为$M$，随机抽取$N$个随机变量构成一个样本，$\mathrm{E}\left(\mathrm{X}_{\mathrm{i}}\right)=\mu$和$\mathrm{D}\left(\mathrm{X}_{\mathrm{i}}\right)=\sigma^{2}$是总体的均值和方差, 是常数。    </p><p>$\overline{\mathrm{X}}, \mathrm{S}^{2}$是样本的均值和方差，由于样本是随机抽取的，$\overline{\mathrm{X}}, \mathrm{S}^{2}$也是随机的。</p><p>实际工作中，总体均数难以得到时，应用样本统计量代替总体参数。</p><p>我们接下来讨论用样本统计量代替总体样本参数会得到什么样的均值和方差结果。</p></blockquote><h5 id="样本均值-overline-mathrm-X"><a href="#样本均值-overline-mathrm-X" class="headerlink" title="样本均值$\overline{\mathrm{X}}$"></a>样本均值$\overline{\mathrm{X}}$</h5><ul><li>考虑$\overline{\mathrm{X}}$的均值：</li></ul>$$\mathrm{E}(\overline{\mathrm{X}})=\mathrm{E}\left(\frac{1}{\mathrm{n}} \sum_{\mathrm{i}=1}^{\mathrm{n}} \mathrm{X}_{\mathrm{i}}\right)=\frac{1}{\mathrm{n}} \sum_{\mathrm{i}=1}^{\mathrm{n}} \mathrm{E}\left(\mathrm{X}_{\mathrm{i}}\right)=\frac{1}{\mathrm{n}} \times \mathrm{nE}\left(\mathrm{X}_{\mathrm{i}}\right)=\mu$$<ul><li>考虑$\overline{\mathrm{X}}$的方差：</li></ul>$$\mathrm{D}(\overline{\mathrm{X}})=\mathrm{D}\left(\frac{1}{\mathrm{n}} \sum_{\mathrm{i}=1}^{\mathrm{n}} \mathrm{X}_{\mathrm{i}}\right)=\frac{1}{\mathrm{n}^{2}} \sum_{\mathrm{i}=1}^{\mathrm{n}} \mathrm{D}\left(\mathrm{X}_{\mathrm{i}}\right)=\frac{\sigma^{2}}{\mathrm{n}}$$<h5 id="样本方差-S-2"><a href="#样本方差-S-2" class="headerlink" title="样本方差$S^2$"></a>样本方差$S^2$</h5><ul><li>考虑$S^2$的均值：</li></ul>$$\begin{array}{l}\mathrm{E}\left(\mathrm{S}^{2}\right)&=\mathrm{E}\left[\frac{1}{\mathrm{n}} \sum_{\mathrm{i}=1}^{\mathrm{n}}\left(\mathrm{X}_{\mathrm{i}}-\overline{\mathrm{X}}\right)^{2}\right]\\&=\frac{1}{\mathrm{n}} \mathrm{E}\left[\sum_{\mathrm{i}=1}^{\mathrm{n}}\left(\mathrm{X}_{\mathrm{i}}^{2}-2 \mathrm{X}_{\mathrm{i}} \overline{\mathrm{X}}+\overline{\mathrm{X}}^{2}\right)\right] \\&=\frac{1}{\mathrm{n}} \mathrm{E}\left[\sum_{\mathrm{i}=1}^{\mathrm{n}}\left(\mathrm{X}_{\mathrm{i}}^{2}\right)\right]-\frac{1}{\mathrm{n}} \mathrm{E}\left(2 \overline{\mathrm{X}} \times \mathrm{n} \overline{\mathrm{X}}-\mathrm{n} \overline{\mathrm{X}}^{2}\right)\\&=\frac{1}{\mathrm{n}} \sum_{\mathrm{i}=1}^{\mathrm{n}} \mathrm{E}\left(\mathrm{X}_{i}^{2}\right)-\mathrm{E}\left(\overline{\mathrm{X}}^{2}\right) \\\end{array}$$<ul><li>根据样本方差计算公式：</li></ul><p>$$<br>D({X_i}) = {E^2}({X_i}) - E(X_i^2) = {\sigma ^2}<br>$$</p><ul><li>得：</li></ul><p>$$<br>E(X_i^2) = {E^2}({X_i}) + {\sigma ^2} = {\mu ^2} + {\sigma ^2}<br>$$</p><ul><li>根据$\overline{\mathrm{X}}$的方差推导结果：</li></ul>$$\begin{array}{l}{\rm{D}}(\overline {\rm{X}} ) = E({\overline {\rm{X}} ^2}) - {E^2}(\overline {\rm{X}} ) = \frac{{{\sigma ^2}}}{{\rm{n}}}\\E({\overline {\rm{X}} ^2}) = {E^2}(\overline {\rm{X}} ) + \frac{{{\sigma ^2}}}{{\rm{n}}}=\mu^2+\frac{{{\sigma^2}}}{{\rm{n}}}\end{array}$$<ul><li>将上述结果带入$E(S^2)$计算过程：</li></ul>$$\begin{array}{l}{\rm{E}}\left( {{{\rm{S}}^2}} \right) &= \frac{1}{{\rm{n}}}\sum\limits_{{\rm{i}} = 1}^{\rm{n}} {\rm{E}} \left( {{\rm{X}}_i^2} \right) - {\rm{E}}\left( {{{\overline {\rm{X}} }^2}} \right)\\ &= \frac{1}{n} \cdot n({\mu ^2} + {\sigma ^2}) - ({\mu ^2} + \frac{{{\sigma ^2}}}{{\rm{n}}})\\ &= {\mu ^2} + {\sigma ^2} - {\mu ^2} - \frac{{{\sigma ^2}}}{{\rm{n}}}\\ &= \frac{{n - 1}}{n}{\sigma ^2}\end{array}$$<ul><li>也就是说样本方差的期望并不等于总体样本的方差，这个估计$E(S^2)$被称为样本方差的有偏估计</li><li>如果想求样本方差的无偏估计，需要乘上一个系数：</li></ul><p>$$<br>\frac{\mathrm{n}}{\mathrm{n}-1} \mathrm{~S}^{2}=\frac{1}{\mathrm{n}-1} \sum_{\mathrm{i}=1}^{\mathrm{n}}\left(\mathrm{X}_{\mathrm{i}}-\overline{\mathrm{X}}\right)^{2}=\sigma^2<br>$$</p><ul><li>其中：$n-1$为自由度，就是说，在一个容量为$n$的样本里，当确定了$n-1$个变量以后，第$n$个变量就确定了，因为样本均值是无偏的。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></p></li><li><p><a href="http://blog.sina.com.cn/s/blog_c96053d60101n24f.html">http://blog.sina.com.cn/s/blog_c96053d60101n24f.html</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 2 - 期望</title>
    <link href="/2021/03/27/math/probability/expectation-and-variance/expectation/"/>
    <url>/2021/03/27/math/probability/expectation-and-variance/expectation/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍期望。</p></blockquote><span id="more"></span><h3 id="期望"><a href="#期望" class="headerlink" title="期望"></a>期望</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote><p>数学期望(mean)（或<a href="https://baike.baidu.com/item/%E5%9D%87%E5%80%BC/5922988">均值</a>，亦简称期望）是试验中每次可能结果的<a href="https://baike.baidu.com/item/%E6%A6%82%E7%8E%87/828845">概率</a>乘以其结果的总和，是最基本的<a href="https://baike.baidu.com/item/%E6%95%B0%E5%AD%A6/107037">数学</a>特征之一。它反映随机变量平均取值的大小。    ——百度百科</p></blockquote><ul><li>期望描述了随机变量的平均情况，衡量了随机变量 的均值。它是概率分布的泛函（函数的函数）。</li></ul><h4 id="计算方法"><a href="#计算方法" class="headerlink" title="计算方法"></a>计算方法</h4><h5 id="离散型"><a href="#离散型" class="headerlink" title="离散型"></a>离散型</h5><ul><li>离散随机变量$X$的期望：</li></ul><p>$$<br>\mathbb{E}[X]=\sum_{i=1}^{\infty} x_{i} p_{i}<br>$$</p><ul><li>若右侧级数不收敛，则期望不存在。</li></ul><h5 id="连续型"><a href="#连续型" class="headerlink" title="连续型"></a>连续型</h5><ul><li>连续随机变量$X$的期望：</li></ul><p>$$<br>\mathbb{E}[X]=\int_{-\infty}^{\infty} x p(x) d x<br>$$</p><ul><li>若右侧级数不收敛，则期望不存在。</li></ul><h4 id="定理"><a href="#定理" class="headerlink" title="定理"></a>定理</h4><ul><li>定理：对于随机变量$ X$, 设 $ Y=g(X) $ 也为随机变量,$ g(\cdot) $ 是连续函数。</li></ul><h5 id="离散型-1"><a href="#离散型-1" class="headerlink" title="离散型"></a>离散型</h5><ul><li>若$ X$为离散随机变量，若$ Y$的期望存在，则：</li></ul><p>$$<br>\mathbb{E}[Y]=\mathbb{E}[g(X)]=\sum_{i=1}^{\infty} g\left(x_{i}\right) p_{i}<br>$$</p><ul><li>也记作：</li></ul>$$\mathbb{E}_{X \sim P(X)}[g(X)]=\sum_{x} g(x) p(x)$$<h5 id="连续型-1"><a href="#连续型-1" class="headerlink" title="连续型"></a>连续型</h5><ul><li>若$ X$为连续随机变量，若$ Y$的期望存在，则：</li></ul><p>$$<br>\mathbb{E}[Y]=\mathbb{E}[g(X)]=\int_{-\infty}^{\infty} g(x) p(x) d x<br>$$</p><ul><li>也记作：</li></ul><p>$$<br>\mathbb{E}_{X \sim P(X)}[g(X)]=\int g(x) p(x) d x<br>$$</p><h5 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h5><ul><li>该定理的意义在于：当求$\mathbb{E}[Y]$ 时，不必计算出$Y$的分布，只需要利用$X$的分布即可。</li><li>该定理可以推广至两个或两个以上随机变量的情况。</li></ul><h4 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h4><ul><li><p>常数的期望就是常数本身</p></li><li><p>对常数$C$有 ：<br>$$<br>\mathbb{E}[C X]=C \mathbb{E}[X]<br>$$</p></li><li><p>对两个随机变量 $X,Y$，有：</p></li></ul><p>$$<br>\mathbb{E}[X+Y]=\mathbb{E}[X]+\mathbb{E}[Y]<br>$$</p><blockquote><p>该结论可以推广到任意有限个随机变量之和的情况</p></blockquote><ul><li>对两个相互独立的随机变量，有：</li></ul><p>$$<br>\mathbb{E}[X Y]=\mathbb{E}[X] \mathbb{E}[Y]<br>$$</p><blockquote><p>该结论可以推广到任意有限个相互独立的随机变量之积的情况</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 软件推荐 - 小黄条 全平台同步桌面便签</title>
    <link href="/2021/03/25/software/recommend/Windows/xiaohuangtiao-win-software/xiaohuangtiao-win-software/"/>
    <url>/2021/03/25/software/recommend/Windows/xiaohuangtiao-win-software/xiaohuangtiao-win-software/</url>
    
    <content type="html"><![CDATA[<blockquote><p>这是一款嵌入电脑桌面的Todolist工具，大小2.1M，也是免安装直接使用的，<strong>类似于电脑上的“便利贴”</strong>。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>每天的工作任务有很多，这个时候该如何有序的安排呢？「小黄条」将手机和电脑同步，自定义一个桌面便利贴，记录和标注待办事项，字体颜色和风格都可以自行设置。</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20210325011146.png"></p><ul><li>全平台同步简直是直击灵魂深处的需求</li><li>如果邀请了6个小伙伴点你的链接，可以以年费12元享受一年数据同步服务，不然得96</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210325011333.png"></p><h3 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h3><ul><li>官网下载：<a href="https://www.yynote.cn/">https://www.yynote.cn/</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>software</category>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>software</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 软件推荐 - listary —— Windows 上的高效启动器</title>
    <link href="/2021/03/25/software/recommend/Windows/listary-win-software/listary-win-software/"/>
    <url>/2021/03/25/software/recommend/Windows/listary-win-software/listary-win-software/</url>
    
    <content type="html"><![CDATA[<blockquote><p>如果你的日常工作需要经常处理邮件，你一定会为保存附件时，从我的电脑到X盘再一级一级的目录打开，直到找到你所想要的目录。这种频繁的文件夹点击将会极大的制约你的效率。本文介绍Windows快速启动神器 listary 。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>Windows虽以可视化所见即所得著称，系统不停的升级，但是核心的文档操作方式和方法并没有显著的改善，所以频繁双击、查找、另存都是系统的一个硬伤。</p></blockquote><ul><li>Listary首先是一款超高效的全局搜索软件。最常用的是搜索已安装的应用和寻找任何的文件、文件夹。</li><li>比如你要快速打开一个cmd，只需要用快捷键 <code>ctrl ctrl</code>调用Listary，输入“cmd”立马出现，类似地启动程序再也不用挨个翻找快接方式了</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210325011751.png"></p><ul><li>文件也可以快速定位</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210325012026.png"></p><h3 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h3><ul><li>官网：<a href="https://www.listary.com/">https://www.listary.com/</a></li><li>下载地址：<a href="https://www.listary.com/download">https://www.listary.com/download</a></li><li>下载链接：<a href="https://www.listary.com/download/Listary.exe?version=5.00.2843">https://www.listary.com/download/Listary.exe?version=5.00.2843</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>software</category>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
      <tag>software</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SVM 的推导</title>
    <link href="/2021/03/24/machine_learning/about-svm/about-svm/"/>
    <url>/2021/03/24/machine_learning/about-svm/about-svm/</url>
    
    <content type="html"><![CDATA[<blockquote><p>SVM（Support Vector Machine，支持向量机）是一个线性分类器，是最经典的分类算法，其核心目标就是找到最大间隔超平面。本文记录SVM的推导过程。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p>SVM就是一个分类器，只是相对于传统的线性分类器，它添加了一个支持向量的概念。</p></blockquote><ul><li>考虑一个分类任务</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210324120914.gif"></p><blockquote><p>从图片上解释，对于一组数据，SVM在使用直线的同时要求数据点距离这条直线的最小距离最大，也就是说分类器和数据之间要有足够大的“间隔”。这样做的好处是很明显的，越大的“间隔”代表了更大的转圜空间，在得到新的数据之后更容易将其正确分类。</p><p>而SVM的工作就是求解这个最大间隔，也就是最优化问题。对于线性可分的数据，可以直接套用线性规划的知识进行推导，但如果数据线性不可分，就需要核函数进行数据升维，进行超平面分类。</p></blockquote><h3 id="目标函数"><a href="#目标函数" class="headerlink" title="目标函数"></a>目标函数</h3><blockquote><p>SVM是一个线性分类器，SVM的目标就是找到最大间隔超平面。</p></blockquote><ul><li>定义任意的超平面函数为：</li></ul><p>$$<br>\bf{w}^{T} \bf{x}+b=0<br>$$</p><ul><li>二维空间点$(x,y)$到直线$Ax+By+C=0$的距离为：</li></ul><p>$$<br>\frac{|A x+B y+C|}{\sqrt{A^{2}+B^{2}}}<br>$$</p><ul><li>扩展到$k$维空间后，点$X=(x_1,x_2,\dots,x_k)$到超平面$w^{T} x+b=0$距离为：</li></ul><p>$$<br>\frac{\left|\bf{w}^{T} \bf{x}+b\right|}{|\bf{w}|}<br>$$</p><ul><li>其中：</li></ul><p>$$<br>|\bf{w}|=\sqrt{w_{1}^{2}+\ldots w_{n}^{2}}<br>$$</p><ul><li>我们希望这个超平面可以区分不同两类数据特征，这个分类决策函数就是：</li></ul><p>$$<br>f(x)=\operatorname{sign}\left(\bf{w}^T\bf{x}+b\right)<br>$$</p><ul><li>我们的数据为$({{\bf{x}}_i},{y_i}),i \in \{ 1,2, \ldots ,n\},y_i \in \{1,-1\} $，定义点$({{\bf{x}}_i},{y_i}) $到超平面的函数距离$\hat{\gamma}_{i}$：</li></ul>$$\hat{\gamma}_{i}=y_{i}\left(\bf{w} \cdot \bf{x}_{i}+b\right)$$<ul><li>而我们的目标是找到可以最大化数据到点几何距离的超平面，将几何距离用${\gamma}_{i}$表示，为：</li></ul>$$\gamma_{i}=|\frac{\bf{w}}{\|\bf{w}\|} \cdot \bf{x}_{i}+\frac{b}{\|\bf{w}\|}|=\frac{|\bf{w}^T\bf{x}_i+b|}{\|\bf{w}\|}=\frac{y_{i}\left(\bf{w} \cdot \bf{x}_{i}+b\right)}{\|\bf{w}\|}=\frac{\hat{\gamma}_{i}}{\|\bf{w}\|}$$<ul><li>因此优化函数为：</li></ul>$$\begin{array}{*{20}{l}}{\mathop {\max }\limits_{{\bf{w}},b} }&\gamma \\{{\rm{ s}}{\rm{.t}}{\rm{. }}}&{{y_i}\left( {\frac{{\bf{w}}}{{{||\bf{w}||}}} \cdot {x_i} + \frac{b}{{{||\bf{w}||}}}} \right) \ge \gamma ,\quad i = 1,2, \cdots ,n}\end{array}$$<ul><li>根据已有结论可以将优化函数转化为：</li></ul>$$\begin{array}{*{20}{l}}{\mathop {\max }\limits_{{\bf{w}},b} }&{\frac{{{{\hat \gamma }_i}}}{{{||\bf{w}||}}}}\\{{\rm{s}}.{\rm{t}}.}&{{y_i}\left( {{\bf{w}} \cdot {x_i} + b} \right) \ge {{\hat \gamma }_i},\quad i = 1,2, \cdots ,n}\end{array}$$- 事实上函数间隔${\hat \gamma }$并不影响最优化问题的解，假设将$\bf{w}$和$b$成倍的改变为$a\bf{w}，ab$，那么函数间隔也会相应变成$a{\hat \gamma }$，因此为简便，我们取 ${\hat \gamma }=1$，因此优化函数为最大化$1/||\bf{w}||$，这等价于最小化$||\bf{w}||$，考虑到求导方便，我们最小化$1/2||\bf{w}||^2$- 优化函数最终为：$$\begin{array}{*{20}{l}}{\mathop {\min }\limits_{{\bf{w}},b} }&{\frac{1}{2}||{\bf{w}}|{|^2}}\\{{\rm{s}}.{\rm{t}}.}&{{y_i}\left( {{\bf{w}} \cdot {{\bf{x}}_i} + b} \right) - 1 \ge 0,\quad i = 1,2, \cdots ,n}\end{array}$$<h3 id="拉格朗日对偶求极值"><a href="#拉格朗日对偶求极值" class="headerlink" title="拉格朗日对偶求极值"></a>拉格朗日对偶求极值</h3><ul><li>写成拉格朗日优化的格式：</li></ul>$$\begin{array}{*{20}{l}}{\mathop {\min }\limits_{{\bf{w}},b} }&{\frac{1}{2}||{\bf{w}}|{|^2}}\\{{\rm{s}}.{\rm{t}}.}&1-{{y_i}\left( {{\bf{w}} \cdot {{\bf{x}}_i} + b} \right) \le 0,\quad i = 1,2, \cdots ,n}\end{array}$$<ul><li>拉格朗日方程：</li></ul>$$L({\bf{w}},b,{\bf{\alpha }}) = \frac{1}{2}||{\bf{w}}|{|^2} + \sum\limits_{i = 1}^n {{\alpha _i}(1 - {y_i}\left( {{\bf{w}} \cdot {{\bf{x}}_i} + b} \right)} )$$<ul><li>原始问题为凸优化问题，我们按照KKT条件求解该问题的对偶问题，即可根据强对偶条件获得原始问题的解</li><li>对偶问题为：</li></ul>$$\mathop {max}\limits_{\bf{\alpha }} D({\bf{\alpha }}) = \mathop {max}\limits_{\bf{\alpha }} \mathop {\min }\limits_{{\bf{w}},b} L({\bf{w}},b,{\bf{\alpha }})$$<ul><li>先求最小化极值问题 $\mathop {\min }\limits_{{\bf{w}},b} L({\bf{w}},b,{\bf{\alpha }})$：</li></ul>$$\left\{ {\begin{array}{*{20}{c}}{\frac{{\partial {\rm{L}}}}{{\partial {\bf{w}}}} = 0}\\{\frac{{\partial {\rm{L}}}}{{\partial b}} = 0}\end{array}} \right.$$<ul><li>解得：</li></ul>$$\left\{ {\begin{array}{*{20}{c}}{{\bf{w}} = \sum\limits_{i = 1}^n {{\alpha _i}{y_i}{{\bf{x}}_i}} }\\{\sum\limits_{i = 1}^n {{\alpha _i}{y_i} = 0} }\end{array}} \right.$$<ul><li>带入$L({\bf{w}},b,{\bf{\alpha }})$得：</li></ul>$$\begin{aligned}L(\bf{w}, b, \bf{\alpha}) &=\frac{1}{2}\|\bf{w}\|^{2}+\sum_{i=1}^{n} \alpha_{i}\left[1-y_{i}\left(\bf{w}^{T} x_{i}+b\right)\right] \\&=\frac{1}{2} \bf{w}^{T} \bf{w}-\bf{w}^{T} \sum_{i=1}^{n} \alpha_{i} y_{i} x_{i}-b \sum_{i=1}^{n} \alpha_{i} y_{i}+\sum_{i=1}^{n} \alpha_{i} \\&=\frac{1}{2} \bf{w}^{T} \sum_{i=1}^{n} \alpha_{i} y_{i} x_{i}-\bf{w}^{T^{\prime}} \sum_{i=1}^{n} \alpha_{i} x_{i} y_{i}-b * 0+\sum_{i=1}^{n} \alpha_{i} \\&=\sum_{i=1}^{n} \alpha_{i}-\frac{1}{2}\left(\sum_{i=1}^{n} \alpha_{i} y_{i} x_{i}\right)^{T} \sum_{i=1}^{n} \alpha_{i} y_{i} x_{i} \\&=\sum_{i=1}^{n} \alpha_{i}-\frac{1}{2} \sum_{i, j=1}^{n} \alpha_{i} \alpha_{j} y_{i} y_{j} x_{i}^{T} x_{j}\end{aligned}$$<ul><li>此时我们需要解决的优化问题是：</li></ul>$$\begin{array}{*{20}{c}}{\mathop {\max }\limits_{\bf{\alpha }} \sum\limits_{i = 1}^n {{\alpha _i}}  - \frac{1}{2}\sum\limits_{i,j = 1}^n {{\alpha _i}} {\alpha _j}{y_i}{y_j}{\bf{x}}_i^T{{\bf{x}}_j}}\\{\qquad \begin{array}{*{20}{c}}{{\rm{ s}}{\rm{.t}}{\rm{. }}{\alpha _i} \ge 0,\quad i = 1,2, \ldots ,n}\\{\sum\limits_{i = 1}^n {{\alpha _i}} {y_i} = 0}\end{array}}\end{array}$$<ul><li><p>可以看到通过拉格朗日对偶，我们将原始拉格朗日方程$k+1+n$个未知数、$n$个复杂不等式约束条件的优化问题转换为了$n$个未知数，1个等式约束的问题，当然满足KKT条件是前提</p></li><li><p>对于这个问题，我们有更高效的优化算法，即序列最小优化（SMO）算法。我们通过这个优化算法能得到$\bf{α}$，再根据$\bf{α}$，我们就可以求解出$\bf{w}$和$b$，进而求得我们最初的目的：找到超平面，即”决策平面”。</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://www.jianshu.com/p/0f8f9d52abcf">https://www.jianshu.com/p/0f8f9d52abcf</a></p></li><li><p><a href="https://www.pianshen.com/article/15821257925/">https://www.pianshen.com/article/15821257925/</a></p></li><li><p><a href="https://blog.csdn.net/qq_40778406/article/details/79879434">https://blog.csdn.net/qq_40778406/article/details/79879434</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从服务器映射 jupyter 到本机应用</title>
    <link href="/2021/03/22/python/jupyter-map/jupyter-map/"/>
    <url>/2021/03/22/python/jupyter-map/jupyter-map/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Jupyter Notebook是基于网页的用于交互计算的应用程序，方便易用，本文记录将远程jupyter环境映射到本机的方法。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>Jupyter Notebook是基于网页的用于交互计算的应用程序。其可被应用于全过程计算：开发、文档编写、运行代码和展示结果。——<a href="https://link.jianshu.com/?t=https://jupyter-notebook.readthedocs.io/en/stable/notebook.html">Jupyter Notebook官方介绍</a></p></blockquote><p>简而言之，Jupyter Notebook是以网页的形式打开，可以在网页页面中<strong>直接</strong>编写代码和运行代码，代码的运行结果也会直接在代码块下显示。如在编程过程中需要编写说明文档，可在同一个页面中直接编写，便于作及时的说明和解释。</p><h3 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h3><ul><li>在服务器启动docker</li><li>在docker容器中启动jupyter服务</li><li>映射到本机浏览器实际使用</li></ul><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><blockquote><p>本质其实仅仅是端口映射</p></blockquote><ul><li>将docker端口映射到服务器指定端口</li><li>从本机访问服务器的指定端口并填入token即可</li></ul><h3 id="具体方法"><a href="#具体方法" class="headerlink" title="具体方法"></a>具体方法</h3><h4 id="创建docker时映射端口"><a href="#创建docker时映射端口" class="headerlink" title="创建docker时映射端口"></a>创建docker时映射端口</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nvidia-docker run -it --name vvd --shm-size=15g -p 4832:4832 -v /home:/workspace vvd_image bash<br></code></pre></td></tr></table></figure><h4 id="在docker启动jupyter服务"><a href="#在docker启动jupyter服务" class="headerlink" title="在docker启动jupyter服务"></a>在docker启动jupyter服务</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">jupyter notebook --allow-root --no-browser --ip 0.0.0.0 --port 4832 --notebook-dir /workspace/nfs/vvd_jupyter_lab/<br></code></pre></td></tr></table></figure><ul><li><p>返回访问地址：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">127.0.0.1:4832</span>/?token=<span class="hljs-number">34</span>d<span class="hljs-number">2</span>fd<span class="hljs-number">23</span>fxxxx<span class="hljs-number">3241</span>cb<span class="hljs-number">6519</span>ccab<span class="hljs-number">7</span>d<span class="hljs-number">66</span>cad<span class="hljs-number">355</span>ee<span class="hljs-number">2</span>xxxxxxx<br></code></pre></td></tr></table></figure></li></ul><h4 id="在本机访问地址"><a href="#在本机访问地址" class="headerlink" title="在本机访问地址"></a>在本机访问地址</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://&#123;remote ip&#125;:<span class="hljs-number">4832</span>/?token=<span class="hljs-number">34</span>d<span class="hljs-number">2</span>fd<span class="hljs-number">23</span>fxxxx<span class="hljs-number">3241</span>cb<span class="hljs-number">6519</span>ccab<span class="hljs-number">7</span>d<span class="hljs-number">66</span>cad<span class="hljs-number">355</span>ee<span class="hljs-number">2</span>xxxxxxx<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.jianshu.com/p/91365f343585">https://www.jianshu.com/p/91365f343585</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>jupyter</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>拉格朗日对偶问题</title>
    <link href="/2021/03/19/machine_learning/lagrangian-duality/lagrangian-duality/"/>
    <url>/2021/03/19/machine_learning/lagrangian-duality/lagrangian-duality/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在前文了解过拉格朗日乘数法后，进一步介绍拉格朗日对偶。</p></blockquote><span id="more"></span><h3 id="背景信息"><a href="#背景信息" class="headerlink" title="背景信息"></a>背景信息</h3><blockquote><p>在约束最优化问题中，常常利用拉格朗日对偶性（Lagrange duality）将原始问题转换为对偶问题，通过解对偶问题而得到原始问题的解。</p></blockquote><ul><li>拉格朗日对偶是在<a href="https://www.zywvvd.com/2021/03/13/machine_learning/lagrange-multiplier/lagrange-multiplier/">拉格朗日乘数法</a>基础之上，通过变换原始问题的求解形式得到的相对于原始优化问题的另一个优化问题</li></ul><h4 id="原始优化问题"><a href="#原始优化问题" class="headerlink" title="原始优化问题"></a>原始优化问题</h4><blockquote><p>假设$f(x)$, $c_i(x)$, $h_j(x)$ 是定义在$\mathbf{R}^{n}$上的连续可微函数，考虑约束最优化问题：</p></blockquote>$$\begin{array}{c}\min _{x \in \mathbf{R}^{n}} f(x)  \\\text { s.t. } \quad h_{i}(x) \leq 0, i=1,2, \ldots, k \\g_{j}(x)=0, j=1,2, \ldots, l\end{array}\tag{1} \label{eq1}$$<ul><li>定义此问题为原始优化问题</li></ul><h4 id="广义拉格朗日函数"><a href="#广义拉格朗日函数" class="headerlink" title="广义拉格朗日函数"></a>广义拉格朗日函数</h4><blockquote><p>来源见 ：<a href="https://www.zywvvd.com/2021/03/13/machine_learning/lagrange-multiplier/lagrange-multiplier/">拉格朗日乘数法</a></p></blockquote><p>$$<br>L(x, \alpha, \beta)=f(x)+\sum_{i=1}^{k} \alpha_{i} h_{i}(x)+\sum_{j=1}^{l} \beta_{j} g_{j}(x)\tag{2} \label{eq2}<br>$$</p><ul><li>其中 $x=\left(x_1, x_2, \ldots, x_n\right)^{T} \in \mathbf{R}^{n} , \alpha_{i}, \beta_{j}$是拉格朗日乘子，且$\alpha_{i} \geq 0$</li></ul><h3 id="拉格朗日对偶的来源"><a href="#拉格朗日对偶的来源" class="headerlink" title="拉格朗日对偶的来源"></a>拉格朗日对偶的来源</h3><blockquote><p>考虑原始优化问题$\eqref{eq1}$</p></blockquote><ul><li>想要求得$f(x)$的最小值，也就是要求$f(x)$的最大下界</li><li>对于方程组：</li></ul><p>$$<br>\begin{array}{l}<br>f(\mathbf{x})&lt;v \\<br>h_{i}(\mathbf{x}) \leq 0, i=1,2, \ldots, k<br>\end{array} \tag{3} \label{eq3}<br>$$</p><ul><li>若方程组$\eqref{eq3}$无解，则$v$是$f(x)$的一个下界，也就是说如果有渠道可以利用到方程组$\eqref{eq3}$无解，则可以利用其限制$f(x)$的下界</li><li>注意到若方程组$\eqref{eq3}$有解，可以推出对于任意$\lambda \ge 0$：</li></ul><p>$$<br>f(\mathbf{x})+\sum_{i=1}^{k} \lambda_{i} h_{i}(\mathbf{x})&lt;v   \tag{4}   \label{eq4}<br>$$</p><ul><li>方程$\eqref{eq4}$有解</li><li>即命题：<strong><em>if</em> 方程组$\eqref{eq3}$有解 <em>then</em> 方程$\eqref{eq4}$有解</strong> 成立</li><li>则其逆否命题 **<em>if</em> 方程$\eqref{eq4}$无解 <em>then</em>  方程组$\eqref{eq3}$无解 ** 成立</li><li>而 <strong>方程$\eqref{eq4}$无解</strong> 的充要（等价）条件是：</li></ul>$$\min _{ \mathbf{x} } f ( \mathbf {x} ) + \sum _ { i=1 } ^ {k} \lambda_{i} g_{i} ( \mathbf {x}) \geq v \tag{5} \label{eq5}$$<ul><li>方程$\eqref{eq5}$的自变量为$\lambda_i$，我们的目标是要找到其上界$v_{max}$，因此有：</li></ul>$$v_{max}=\max _{\boldsymbol{\lambda} \geq \mathbf{0}} \min _{\mathbf{x}} f(\mathbf{x})+\sum_{i=1}^{k} \lambda_{i} g_{i}(\mathbf{x}) \tag{6} \label{eq6}$$<ul><li>方程$\eqref{eq6}$即为拉格朗日对偶问题的核心，延续原始问题的标记，记为：</li></ul>$$\mathop {\max }\limits_{\alpha  \cdot \beta ;{\alpha _i} \ge 0}D(\alpha ,\beta ) = \mathop {\max }\limits_{\alpha  \cdot \beta ;{\alpha _i} \ge 0} \mathop {\min }\limits_x L(x,\alpha ,\beta )\tag{7} \label{eq7}$$<blockquote><p>可以说对偶问题就是从另一个方向逼近$f(x)$最小值的问题</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210324150300.gif"></p><h3 id="对偶问题的性质"><a href="#对偶问题的性质" class="headerlink" title="对偶问题的性质"></a>对偶问题的性质</h3><blockquote><p>之所以引入另一个优化问题是因为对偶问题之间有着良好的性质</p></blockquote><ul><li>对偶问题的对偶是原问题；</li><li>无论原始问题是否是凸的，对偶问题都是凸优化问题；</li><li>对偶问题可以给出原始问题一个下界；</li><li>当满足一定条件时，原始问题与对偶问题的解是完全等价的；</li></ul><h3 id="拉格朗日对偶问题的凹函数性质证明"><a href="#拉格朗日对偶问题的凹函数性质证明" class="headerlink" title="拉格朗日对偶问题的凹函数性质证明"></a>拉格朗日对偶问题的凹函数性质证明</h3><h4 id="按照定义"><a href="#按照定义" class="headerlink" title="按照定义"></a>按照定义</h4><blockquote><p>对偶问题有一个很好的性质是对偶函数为凹函数，证明如下</p></blockquote><ul><li>命题 <strong>拉格朗日对偶函数一定是凹函数，且其凹性与最优化函数和约束函数无关。</strong></li><li>考虑对偶问题$\eqref{eq7}$，按照凹函数定义，往证：</li></ul><p>$$<br>D(\theta {\alpha _1} + (1 - \theta ){\alpha _2},\theta {\beta _1} + (1 - \theta ){\beta _2}) \ge \theta D({\alpha _1},{\beta _1}) + (1 - \theta )D({\alpha _2},{\beta _2}) \tag{8} \label{eq8}<br>$$</p><ul><li>有：</li></ul>$$\begin{array}{l}&D(\theta {\alpha _1} + (1 - \theta ){\alpha _2},\theta {\beta _1} + (1 - \theta ){\beta _2}) \\&= \mathop {\min }\limits_x L(x,\theta {\alpha _1} + (1 - \theta ){\alpha _2},\theta {\beta _1} + (1 - \theta ){\beta _2})\\ &= \mathop {\min }\limits_x (f(x) + \sum\limits_{i = 1}^k {(\theta {\alpha _{1,i}} + (1 - \theta ){\alpha _{2,i}})} {h_i}(x) + \sum\limits_{j = 1}^l {(\theta {\beta _{1,j}} + (1 - \theta ){\beta _{2,j}})} {g_j}(x)\\ &= \mathop {\min }\limits_x (\theta (f(x) + \sum\limits_{i = 1}^k {{\alpha _{1,i}}} {h_i}(x) + \sum\limits_{j = 1}^l {{\beta _{1,j}}} {g_j}(x)) + (1 - \theta )(f(x) + \sum\limits_{i = 1}^k {{\alpha _{2,i}}} {h_i}(x) + \sum\limits_{j = 1}^l {{\beta _{2,j}}} {g_j}(x)))\\ &\ge \theta \mathop {\min }\limits_x (f(x) + \sum\limits_{i = 1}^k {{\alpha _{1,i}}} {h_i}(x) + \sum\limits_{j = 1}^l {{\beta _{1,j}}} {g_j}(x)) + (1 - \theta )\mathop {\min }\limits_x (f(x) + \sum\limits_{i = 1}^k {{\alpha _{2,i}}} {h_i}(x) + \sum\limits_{j = 1}^l {{\beta _{2,j}}} {g_j}(x))\\ &= \theta D({\alpha _1},{\beta _1}) + (1 - \theta )D({\alpha _2},{\beta _2})\end{array} \tag{9} \label{eq9}$$<ul><li><p>其中$\eqref{eq9}$的不等式来源于：</p><ul><li>对于实数集合$\bf{a},\bf{b}$：</li></ul>  $$  \begin{array}{l}  a=\left\{a_{1}, a_{2}, \cdots, a_{n}\right\} \\  b=\left\{b_{1}, b_{2}, \cdots, b_{n}\right\}  \end{array} \tag{10}  $$  <ul><li>对于任意$i$，有：</li></ul>  $$  \mathop {\min }\limits_i \left\{ {{a_i} + {b_i}} \right\} \ge \min \{ {\bf{a}}\}  + \min \{ {\bf{b}}\} ,\quad i \in {N^ + } \tag{11}  $$  </li><li><p>原命题得证。</p></li></ul><h4 id="仿射函数"><a href="#仿射函数" class="headerlink" title="仿射函数"></a>仿射函数</h4><blockquote><p>另一种思路是讨论$\eqref{eq2}$的后两项内容</p></blockquote><ul><li>因为对偶问题中$x$视作常数，$\alpha,\beta$为自变量，可以视作：</li></ul>$$\begin{array}{l}D(\alpha ,\beta {\rm{|x}}) &= f(x) + \sum\limits_{i = 1}^k {{\alpha _i}} {h_i}(x) + \sum\limits_{j = 1}^l {{\beta _j}} {g_j}(x)\\ &= A + \sum\limits_{i = 1}^k {{\alpha _i}} {B_i} + \sum\limits_{j = 1}^l {{\beta _j}} {C_j} \end{array} \tag{12}$$<ul><li>因此$D(\alpha, \beta)$是调整常数$A,B,C$的仿射函数，仿射函数<strong>既凸且凹</strong>，因此拉格朗日对偶问题具有凹函数性质</li></ul><h3 id="拉格朗日对偶"><a href="#拉格朗日对偶" class="headerlink" title="拉格朗日对偶"></a>拉格朗日对偶</h3><h4 id="原始问题"><a href="#原始问题" class="headerlink" title="原始问题"></a>原始问题</h4><ul><li>考虑$x$的函数：</li></ul>$$P(x)=\max _{\alpha, \beta ; \alpha_{i} \geq 0} L(x, \alpha, \beta) \tag{13}$$<blockquote><p>这里，$P$表示原始问题。将上式看做$x$ 的函数。</p><p>等式右边可以看做固定$x$ 的情况下，求关于$\alpha, \beta$的函数 $L $的最大值的问题。</p></blockquote><ul><li>可以推出：</li></ul>$$P(x)=\left\{\begin{array}{l}f(x), x \text { 满足原始问题约束 } \\+\infty, \text { otherwise }\end{array}\right. \tag{14}$$<ul><li>考虑极小化问题：</li></ul><p>$$<br>\min _{x} P(x)=\min _{x} \max _{\alpha, \beta ; \alpha \geq 0} L(x, \alpha, \beta) \tag{15} \label{eq15}<br>$$</p><ul><li>式$\eqref{eq15}$与$\eqref{eq7}$等价，因为固定$x$时剩余两项在约束范围内最大值为0，相当于在约束范围内求解$f(x)$的最小值。</li><li>定义原始问题的值为：</li></ul><p>$$<br>p^{*}=\min _{x} P(x) \tag{16}<br>$$</p><h4 id="对偶问题"><a href="#对偶问题" class="headerlink" title="对偶问题"></a>对偶问题</h4><ul><li>延续上文的对偶问题$\eqref{eq7}$</li><li>可以看到事实上对偶问题与原问题为极大极小的求解顺序问题</li><li>定义对偶问题的值：</li></ul>$$d^{*}=\max _{\alpha, \beta ; \alpha_{i} \geq 0} D(\alpha, \beta) \tag{17}$$<h4 id="原始问题与对偶问题的关系"><a href="#原始问题与对偶问题的关系" class="headerlink" title="原始问题与对偶问题的关系"></a>原始问题与对偶问题的关系</h4><ul><li>对偶问题的解不大于原始问题的解：</li><li>证明：</li></ul><p>$$<br>\begin{array}{c}\<br>D(a, \beta)=\min _{x} L(x, a, \beta) \leqslant L(x, a, \beta) \leqslant \max <em>{\sigma, \beta: a</em>{i} \geqslant 0} L(x, a, \beta)=P(x)\<br>D(\mathrm{a}, \beta) \leqslant P(x)\<br>\mathrm{d}^{<em>}=\max <em>{\mathrm{a}, \mathrm{B}: \mathrm{a}</em>{i} \geqslant 0} \min _{\mathrm{x}} L(x, \mathrm{a}, \beta) \leqslant \min _{\mathrm{x}} \max <em>{\mathrm{a}, \mathrm{\beta}: \mathrm{a}</em>{i} \geqslant 0} L(x, \mathrm{a}, \beta)=\mathrm{p}^{</em>}\<br>d ^ { * } \le p ^ { * }<br>\end{array}\tag{18}<br>$$</p><ul><li>该性质为弱对偶性（weak duality），该性质在任何情况下都成立</li><li>也因为弱对偶的存在，使得 <strong>对偶问题可以给出原始问题的下界</strong></li><li>与弱对偶性相对应的是强对偶性（strong duality），即：</li></ul><p>$$<br>d^{* } = p^{* } \tag{19}<br>$$</p><ul><li>若强对偶性成立，即原始问题与对偶问题的最优值相等，则可以通过求解对偶问题来得到原始问题的解</li></ul><h3 id="强对偶成立条件"><a href="#强对偶成立条件" class="headerlink" title="强对偶成立条件"></a>强对偶成立条件</h3><blockquote><p>强对偶的性质太过于美妙，如果我们的问题满足强对偶条件，直接求对偶问题就好了</p><p>这里列出两个常见的条件</p></blockquote><h4 id="Convex-Slater"><a href="#Convex-Slater" class="headerlink" title="Convex + Slater"></a>Convex + Slater</h4><ul><li>原问题是凸优化<ul><li>$f(x)$和$h(x)$是凸函数</li><li>$g(x)$是放射函数</li></ul></li><li>存在$x$使得不等式约束严格成立（严格成立不等号）</li></ul><h4 id="KKT-条件"><a href="#KKT-条件" class="headerlink" title="KKT 条件"></a>KKT 条件</h4><blockquote><p>原问题是否为凸函数的两种情况下，KKT的用法不同</p></blockquote><h5 id="原问题非凸"><a href="#原问题非凸" class="headerlink" title="原问题非凸"></a>原问题非凸</h5><blockquote><p>当原问题并非凸优化(或者不清楚、不关心是不是凸优化)时，KKT 条件是一种用来<strong>描述强对偶情况下最优解性质</strong>的条件<br>换而言之，若强对偶性质成立，那么满足最优解的<strong>点</strong>一定满足 KKT 条件；KKT 条件是强对偶一个<strong>必要条件</strong>，但无法作为充分条件来使用</p></blockquote><h5 id="原问题为凸函数"><a href="#原问题为凸函数" class="headerlink" title="原问题为凸函数"></a>原问题为凸函数</h5><blockquote><p>当原问题为凸优化时，KKT 条件在非凸的基础上有多了找到最优点的功能<br>在这种情况下，那么满足 KKT 条件的点一定是原问题和对偶问题的最优解；KKT 条件成了强对偶和最优解的充要条件</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_32742009/article/details/81413068">https://blog.csdn.net/qq_32742009/article/details/81413068</a></li><li><a href="https://blog.csdn.net/u014540876/article/details/79153913">https://blog.csdn.net/u014540876/article/details/79153913</a></li><li><a href="https://zhuanlan.zhihu.com/p/45431511">https://zhuanlan.zhihu.com/p/45431511</a></li><li><a href="https://www.zhihu.com/question/58584814">https://www.zhihu.com/question/58584814</a></li><li><a href="https://blog.csdn.net/frostime/article/details/90291392">https://blog.csdn.net/frostime/article/details/90291392</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>将训练好的 mmdetection 模型转为 tensorrt 模型</title>
    <link href="/2021/03/17/deep_learning/deploy/tensorrt-model-gen-mmdection/tensorrt-model-gen/"/>
    <url>/2021/03/17/deep_learning/deploy/tensorrt-model-gen-mmdection/tensorrt-model-gen/</url>
    
    <content type="html"><![CDATA[<blockquote><p>mmdetection 是商汤科技（2018 COCO 目标检测挑战赛冠军）和香港中文大学开源的基于Pytorch实现的深度学习目标检测工具箱，性能强大，运算效率高，配置化编程，比较容易训练、测试。但pytorch模型不易于部署，运算速度还有进一步提升的空间，当前比较有效的方法是将模型转换为行为相同的tensorrt模型，本文记录转换流程。</p></blockquote><span id="more"></span><h3 id="任务思路"><a href="#任务思路" class="headerlink" title="任务思路"></a>任务思路</h3><blockquote><p>转换mmdetection 的 pytorch模型到tensorrt模型有多种方法，本文使用 <a href="https://github.com/grimoire/mmdetection-to-tensorrt">mmdetection-to-tensorrt</a> 库作为核心，完成直接的模型转换。</p><p>该库跳过了通常的 pth -&gt; onnx -&gt; tensorrt 的转换步骤，直接从pth转成tensorrt模型，并且已经成功支持了很多mmdetection 的模型转换。</p></blockquote><details>    <summary>Support Model/Module </summary><ul><li><input checked="" disabled="" type="checkbox"> Faster R-CNN</li><li><input checked="" disabled="" type="checkbox"> Cascade R-CNN</li><li><input checked="" disabled="" type="checkbox"> Double-Head R-CNN</li><li><input checked="" disabled="" type="checkbox"> Group Normalization</li><li><input checked="" disabled="" type="checkbox"> Weight Standardization</li><li><input checked="" disabled="" type="checkbox"> DCN</li><li><input checked="" disabled="" type="checkbox"> SSD</li><li><input checked="" disabled="" type="checkbox"> RetinaNet</li><li><input checked="" disabled="" type="checkbox"> Libra R-CNN</li><li><input checked="" disabled="" type="checkbox"> FCOS</li><li><input checked="" disabled="" type="checkbox"> Fovea</li><li><input checked="" disabled="" type="checkbox"> CARAFE</li><li><input checked="" disabled="" type="checkbox"> FreeAnchor</li><li><input checked="" disabled="" type="checkbox"> RepPoints</li><li><input checked="" disabled="" type="checkbox"> NAS-FPN</li><li><input checked="" disabled="" type="checkbox"> ATSS</li><li><input checked="" disabled="" type="checkbox"> PAFPN</li><li><input checked="" disabled="" type="checkbox"> FSAF</li><li><input checked="" disabled="" type="checkbox"> GCNet</li><li><input checked="" disabled="" type="checkbox"> Guided Anchoring</li><li><input checked="" disabled="" type="checkbox"> Generalized Attention</li><li><input checked="" disabled="" type="checkbox"> Dynamic R-CNN</li><li><input checked="" disabled="" type="checkbox"> Hybrid Task Cascade</li><li><input checked="" disabled="" type="checkbox"> DetectoRS</li><li><input checked="" disabled="" type="checkbox"> Side-Aware Boundary Localization</li><li><input checked="" disabled="" type="checkbox"> YOLOv3</li><li><input checked="" disabled="" type="checkbox"> PAA</li><li><input disabled="" type="checkbox"> CornerNet(WIP)</li><li><input checked="" disabled="" type="checkbox"> Generalized Focal Loss</li><li><input checked="" disabled="" type="checkbox"> Grid RCNN</li><li><input checked="" disabled="" type="checkbox"> VFNet</li><li><input checked="" disabled="" type="checkbox"> GROIE</li><li><input checked="" disabled="" type="checkbox"> Mask R-CNN(experiment)</li><li><input checked="" disabled="" type="checkbox"> Cascade Mask R-CNN(experiment)</li><li><input checked="" disabled="" type="checkbox"> Cascade RPN</li></ul></details><h4 id="完成步骤"><a href="#完成步骤" class="headerlink" title="完成步骤"></a>完成步骤</h4><ul><li>配置环境</li><li>安装tensorrt 7.2.3.4</li><li>安装 mmdetection-to-tensorrt 库并安装依赖</li><li>使用 mmdetection-to-tensorrt 转换模型</li><li>结果测试</li></ul><h3 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h3><blockquote><p>本机 gpu Nvidia GTX 1080 服务器</p><p>时间 2021.03</p></blockquote><ul><li><p>操作系统 Ubuntu 16.04</p></li><li><p>Nvidia 显卡驱动 460.39</p></li><li><p>Cuda 版本 11.1</p></li><li><p>Cudnn 版本 8.1.1</p></li></ul><blockquote><p>具体配置方法教程很多，在此不再赘述，需要根据个人具体情况配置</p></blockquote><h3 id="安装-tensorrt并配置环境"><a href="#安装-tensorrt并配置环境" class="headerlink" title="安装 tensorrt并配置环境"></a>安装 tensorrt并配置环境</h3><blockquote><p>选择的版本是 tensorrt 7.2.3.4</p><p>建议Python环境安装 Anaconda</p></blockquote><h4 id="安装-PyCuda"><a href="#安装-PyCuda" class="headerlink" title="安装 PyCuda"></a>安装 PyCuda</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> pycuda<br></code></pre></td></tr></table></figure><h4 id="安装tensorrt"><a href="#安装tensorrt" class="headerlink" title="安装tensorrt"></a>安装tensorrt</h4><ul><li><p>下载tensorrt </p><ul><li><p>链接 <a href="https://developer.nvidia.com/zh-cn/tensorrt">https://developer.nvidia.com/zh-cn/tensorrt</a></p></li><li><p>选择 TensorRT-7.2.3.4.Ubuntu-16.04.x86_64-gnu.cuda-11.1.cudnn8.1.tar.gz</p></li></ul></li><li><p>解压</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar zxfv TensorRT-7.2.3.4.Ubuntu-16.04.x86_64-gnu.cuda-11.1.cudnn8.1.tar.gz<br></code></pre></td></tr></table></figure><blockquote><p>解压后文件夹内文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ls</span><br>TensorRT-Release-Notes.pdf  bin  data  doc  graphsurgeon  include  lib  onnx_graphsurgeon  python  samples  targets  uff<br></code></pre></td></tr></table></figure></blockquote><ul><li>安装tensorrt</li></ul><blockquote><p>根据自己的 Python 版本选择合适的包进行安装</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd TensorRT-7.2.3.4/python<br>pip install tensorrt-7.2.3.4-cp37-none-linux_x86_64.whl<br></code></pre></td></tr></table></figure><ul><li>安装graphsurgeon wheel</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd TensorRT-7.2.3.4/graphsurgeon<br>pip install graphsurgeon-0.4.5-py2.py3-none-any.whl<br></code></pre></td></tr></table></figure><ul><li>配置环境变量</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">export PATH=$PATH:/usr/local/cuda/bin<br>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64<br>export LIBRARY_PATH=$LIBRARY_PATH:/usr/local/cuda/lib64<br><br>export PATH=$PATH:&quot;your_path_to_TensorRT-7.2.3.4&quot;<br>export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:&quot;your_path_to_TensorRT-7.2.3.4/lib&quot;<br></code></pre></td></tr></table></figure><ul><li>测试</li></ul><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">python<br><span class="hljs-keyword">import</span> tensorrt<br>tensorrt.__version__<br><br>--&gt; <span class="hljs-string">&#x27;7.2.3.4&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="安装-mmdetection"><a href="#安装-mmdetection" class="headerlink" title="安装 mmdetection"></a>安装 mmdetection</h3><ul><li>链接 <a href="https://github.com/open-mmlab/mmdetection">https://github.com/open-mmlab/mmdetection</a></li><li>安装文档 <a href="https://github.com/open-mmlab/mmdetection/blob/master/docs/get_started.md">https://github.com/open-mmlab/mmdetection/blob/master/docs/get_started.md</a></li></ul><h4 id="安装-mmcv"><a href="#安装-mmcv" class="headerlink" title="安装 mmcv"></a>安装 mmcv</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install mmcv-full -f https://download.openmmlab.com/mmcv/dist/&#123;cu_version&#125;/&#123;torch_version&#125;/index.html<br></code></pre></td></tr></table></figure><h4 id="下载并安装-mmdetection"><a href="#下载并安装-mmdetection" class="headerlink" title="下载并安装 mmdetection"></a>下载并安装 mmdetection</h4><ul><li>下载</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone git@git.zhlh6.cn:open-mmlab/mmdetection.git<br></code></pre></td></tr></table></figure><ul><li>配置环境并安装</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd mmdetection<br>pip install -r requirements/build.txt<br>pip install -v -e .  # or &quot;python setup.py develop&quot;<br></code></pre></td></tr></table></figure><h3 id="安装-mmdetection-to-tensorrt"><a href="#安装-mmdetection-to-tensorrt" class="headerlink" title="安装 mmdetection-to-tensorrt"></a>安装 mmdetection-to-tensorrt</h3><ul><li>链接 <a href="https://github.com/grimoire/mmdetection-to-tensorrt">https://github.com/grimoire/mmdetection-to-tensorrt</a></li></ul><h4 id="安装-torch2trt-dynamic"><a href="#安装-torch2trt-dynamic" class="headerlink" title="安装 torch2trt_dynamic"></a>安装 <a href="https://github.com/grimoire/torch2trt_dynamic">torch2trt_dynamic</a></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone git@git.zhlh6.cn:grimoire/torch2trt_dynamic.git<br>cd torch2trt_dynamic<br>python setup.py develop<br></code></pre></td></tr></table></figure><h4 id="安装-amirstan-plugin"><a href="#安装-amirstan-plugin" class="headerlink" title="安装 amirstan_plugin"></a>安装 <a href="https://github.com/grimoire/amirstan_plugin">amirstan_plugin</a></h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">--depth</span>=<span class="hljs-number">1</span> git@git.zhlh6.cn:grimoire/amirstan_plugin.git<br>cd amirstan_plugin<br></code></pre></td></tr></table></figure><ul><li>更新子模块</li></ul><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">git</span> <span class="hljs-comment">submodule</span> <span class="hljs-comment">update</span> --<span class="hljs-comment">init</span> --<span class="hljs-comment">progress</span> --<span class="hljs-comment">depth=1</span><br></code></pre></td></tr></table></figure><p>讲道理一句话就可以了，不过我在执行这句命令时报错，如果没报错继续下面的步骤</p><details>    <summary> 子模块更新报错解决方案 </summary><blockquote><p>http协议不好用，需要改成git</p></blockquote><ul><li>修改 <code>amirstan_plugin/.gitmodules</code> 文件</li></ul><blockquote><p>将第三行地址改为 <code>git@github.com:NVIDIA/cub.git</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[submodule &quot;third_party/cub&quot;]<br>path = third_party/cub<br>url = git@github.com:NVIDIA/cub.git <br>branch = 1.8.0<br></code></pre></td></tr></table></figure><ul><li>修改 <code>amirstan_plugin/.git/modules/third_party/cub/config</code></li></ul><blockquote><p>将 <code>remote &quot;origin&quot;</code> 地址改为 <code>git@github.com:NVIDIA/cub.git</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">[core]<br>repositoryformatversion = 0<br>filemode = true<br>bare = false<br>logallrefupdates = true<br>worktree = ../../../../third_party/cub<br>[remote &quot;origin&quot;]<br>url = git@github.com:NVIDIA/cub.git <br>fetch = +refs/heads/main:refs/remotes/origin/main<br>[branch &quot;main&quot;]<br>remote = origin<br>merge = refs/heads/main<br></code></pre></td></tr></table></figure><ul><li>再次执行</li></ul><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">git</span> <span class="hljs-comment">submodule</span> <span class="hljs-comment">update</span> --<span class="hljs-comment">init</span> --<span class="hljs-comment">progress</span> --<span class="hljs-comment">depth=1</span><br></code></pre></td></tr></table></figure></details><ul><li>新建build文件夹</li></ul><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">mkdir</span> build<br><span class="hljs-built_in">cd</span> build<br></code></pre></td></tr></table></figure><ul><li>生成 makefile</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">cmake</span> -DTENSORRT_DIR=<span class="hljs-variable">$&#123;your_path_to_tensorrt&#125;</span> ..<br></code></pre></td></tr></table></figure><blockquote><p>若输出：</p></blockquote><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">-- Found TensorRT headers at ..<span class="hljs-regexp">/TensorRT-7.2.3.4/i</span>nclude<br>-- <span class="hljs-keyword">Find</span> TensorRT libs at  ..<span class="hljs-regexp">/TensorRT-7.2.3.4/</span>lib<span class="hljs-regexp">/libnvinfer.so; ../</span>TensorRT-<span class="hljs-number">7.2</span>.<span class="hljs-number">3.4</span><span class="hljs-regexp">/lib/</span>libnvparsers.so; ..<span class="hljs-regexp">/TensorRT-7.2.3.4/</span>lib/libnvinfer_plugin.so<br>-- Found TENSORRT:  ..<span class="hljs-regexp">/TensorRT-7.2.3.4/i</span>nclude  <br>-- WITH_DEEPSTREAM: <span class="hljs-keyword">false</span><br>-- GPU_ARCHS is not defined. Generating CUDA code <span class="hljs-keyword">for</span> <span class="hljs-keyword">default</span> SMs: <span class="hljs-number">35</span>;<span class="hljs-number">53</span>;<span class="hljs-number">61</span>;<span class="hljs-number">70</span>;<span class="hljs-number">75</span>;<span class="hljs-number">80</span><br>-- Configuring done<br>-- Generating done<br>-- Build files have been written to:  ..<span class="hljs-regexp">/amirstan_plugin/</span>build<br></code></pre></td></tr></table></figure><blockquote><p>则说明 makefile 生成成功，保存在 <code>build</code> 文件夹下</p></blockquote><ul><li>编译</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">make</span> -j<span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><p>此时在<code>build/lib</code>文件夹下生成了很多文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ls</span><br>libadaptivePoolPlugin_static.a  libcarafeFeatureReassemblePlugin_static.a  libexViewPlugin_static.a             liblayerNormPlugin_static.a     libroiPoolPlugin_static.a         libtorchEmbeddingPlugin_static.a <br>libamir_cuda_util.a             libdeformableConvPlugin_static.a           libgridAnchorDynamicPlugin_static.a  libmeshGridPlugin_static.a      libtorchBmmPlugin_static.a        libtorchFlipPlugin_static.a<br>libamirstan_plugin.so           libdeformablePoolPlugin_static.a           libgridSamplePlugin_static.a         librepeatDimsPlugin_static.a    libtorchCumMaxMinPlugin_static.a  libtorchGatherPlugin_static.a<br>libbatchedNMSPlugin_static.a    libdelta2bboxPlugin_static.a               libgroupNormPlugin_static.a          libroiExtractorPlugin_static.a  libtorchCumPlugin_static.a        libtorchNMSPlugin_static.a<br></code></pre></td></tr></table></figure><ul><li>配置环境变量</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export AMIRSTAN_LIBRARY_PATH=&lt;amirstan_plugin_root&gt;/build/lib<br></code></pre></td></tr></table></figure><h4 id="安装-mmdetection-to-tensorrt-1"><a href="#安装-mmdetection-to-tensorrt-1" class="headerlink" title="安装 mmdetection-to-tensorrt"></a>安装 mmdetection-to-tensorrt</h4><blockquote><p>进入 <code>mmdetection-to-tensorrt</code> 根目录</p></blockquote><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> develop<br></code></pre></td></tr></table></figure><ul><li>测试是否成功</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> pip show mmdet2trt</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">Name: mmdet2trt</span><br>Version: 0.3.0<br>Summary: mmdetection to tensorrt converter<br>Home-page: UNKNOWN<br>Author: UNKNOWN<br>Author-email: UNKNOWN<br>License: UNKNOWN<br>Location: /workspace/nfs/tensorrt_test/mmdetection-to-tensorrt<br>Requires: <br>Required-by: <br></code></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ul><li><p>在 <code>mmdetection-to-tensorrt</code> 项目中，运行 <code>demo</code> 文件夹下的 <code>inference.py</code> 文件</p></li><li><p>修改<code>inference.py</code> 文件中的 parser 参数 ：</p><ul><li>img：测试图像路径</li><li>config：mmdetection 的模型配置文件</li><li>checkpoint：模型 pth 文件路径</li><li>save_path：tensorrt 模型存放路径</li><li>score-thr：检测有效阈值</li></ul></li><li><p>配置好后运行该文件即可以生成模型在测试图像上的检测结果</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://github.com/grimoire/mmdetection-to-tensorrt">https://github.com/grimoire/mmdetection-to-tensorrt</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/165359425">https://zhuanlan.zhihu.com/p/165359425</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>deep learning</category>
      
      <category>deploy</category>
      
      <category>pytorch</category>
      
      <category>tensorrt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>deep learning</tag>
      
      <tag>deploy</tag>
      
      <tag>pytorch</tag>
      
      <tag>tensorrt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>拉格朗日乘数法</title>
    <link href="/2021/03/13/machine_learning/lagrange-multiplier/lagrange-multiplier/"/>
    <url>/2021/03/13/machine_learning/lagrange-multiplier/lagrange-multiplier/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在数学最优<a href="https://baike.baidu.com/item/%E9%97%AE%E9%A2%98/1067365">问题</a>中，拉格朗日乘数法（以数学家<a href="https://baike.baidu.com/item/%E7%BA%A6%E7%91%9F%E5%A4%AB%C2%B7%E8%B7%AF%E6%98%93%E6%96%AF%C2%B7%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5/7070424">约瑟夫·路易斯·拉格朗日</a>命名）是一种寻找变量受一个或多个条件所限制的<a href="https://baike.baidu.com/item/%E5%A4%9A%E5%85%83%E5%87%BD%E6%95%B0/2498728">多元函数</a>的<a href="https://baike.baidu.com/item/%E6%9E%81%E5%80%BC/5330918">极值</a>的方法。这种方法将一个有n 个变量与k 个<a href="https://baike.baidu.com/item/%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6/1046571">约束条件</a>的<a href="https://baike.baidu.com/item/%E6%9C%80%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98/9632567">最优化问题</a>转换为一个有n + k个变量的方程组的极值问题，其变量不受任何约束。本文介绍拉格朗日乘数法（Lagrange multiplier）。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ul><li><p>我们擅长解决的是无约束极值求解问题，这类问题仅需对所有变量求偏导，使得所有偏导数为0，即可找到所有极值点和鞍点。我们解决带约束条件的问题时便会尝试将其转化为无约束优化问题</p></li><li><p>事实上如果我们可以通过g得到某个变量的表示，例如$x_1 = h(x_2, …, x_n)$，将该式带入$y$即可抓换为无约束优化（初高中就是这么做的，所谓消元法是也），但有的时候我们无法得到这样的表示，便需要借助拉格朗日乘数法来避免消元法的困境。</p></li></ul><blockquote><p>作为一种优化算法，拉格朗日乘数法主要用于解决约束优化问题，它的基本思想就是通过引入拉格朗日乘子来将含有$n$个变量和$k个$约束条件的约束优化问题转化为含有$（n+k）$个变量的无约束优化问题。拉格朗日乘子背后的数学意义是其为约束方程梯度线性组合中每个向量的系数。</p></blockquote><h3 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h3><ul><li>考虑二元函数$f(x,y)$，在约束$g(x,y)=c$下的极值</li><li>首先我们可以绘制出$f(x,y)$的一层层等高线，当等高线与$g(x,y)=c$相切时即可能是该问题的极值点</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210324141929.jpg" alt="拉格朗日乘数法示意图（转自知乎）"></p><h3 id="拉格朗日乘数法"><a href="#拉格朗日乘数法" class="headerlink" title="拉格朗日乘数法"></a>拉格朗日乘数法</h3><h4 id="单个等式约束"><a href="#单个等式约束" class="headerlink" title="单个等式约束"></a>单个等式约束</h4><blockquote><p>考虑$n$元函数$y=f(x_1, x_2,…,x_n)$，在等式约束$g(x_1, x_2,…,x_n)=0$ 下的极值点求解问题</p></blockquote><ul><li>在极值点，必有$y$和$g$法向量平行</li><li>$y$的法向量为：</li></ul>$$[\frac{{\partial y}}{{\partial {x_1}}},\frac{{\partial y}}{{\partial {x_2}}},...,\frac{{\partial y}}{{\partial {x_n}}}]$$<ul><li>$g$的法向量为：</li></ul>$$[\frac{{\partial g}}{{\partial {x_1}}},\frac{{\partial g}}{{\partial {x_2}}},...,\frac{{\partial g}}{{\partial {x_n}}}]$$<ul><li>二者平行，则存在常数$\lambda$使得：</li></ul>$$[\frac{{\partial y}}{{\partial {x_1}}},\frac{{\partial y}}{{\partial {x_2}}},...,\frac{{\partial y}}{{\partial {x_n}}}] + \lambda [\frac{{\partial g}}{{\partial {x_1}}},\frac{{\partial g}}{{\partial {x_2}}},...,\frac{{\partial g}}{{\partial {x_n}}}] = 0$$<ul><li>即：</li></ul>$$\frac{{\partial y}}{{\partial {x_i}}} + \lambda \frac{{\partial g}}{{\partial {x_i}}} = 0,1 \le i \le n$$<ul><li>这样我们就得到了$n$个等式方程，再加上$g(x_1, x_2,…,x_n)=0$一起构成$n+1$个方程的方程组，未知数为$[x_1,x_2,…,x_n,\lambda]$共$n+1$个，方程组的解即为所有极值点和鞍点的集合，每组解中的$\lambda$即为两个平行法向量的倍数，该值在等式约束轨迹穿过$y$的极值点时为0。</li></ul><h4 id="多个等式约束"><a href="#多个等式约束" class="headerlink" title="多个等式约束"></a>多个等式约束</h4><blockquote><p>原理与单个等式约束情况类似</p><p>考虑$n$元函数$y=f(x_1, x_2,…,x_n)$，在$m$个等式约束($g_i(x_1, x_2,…,x_n)=0, 1 \le i \le m$) 下的极值点求解问题</p></blockquote><ul><li>$n$维空间由$m$个条件约束，会确定一个$n-m$维的曲面，我们讨论$y$在这个曲面上的极值问题</li><li>这个曲面由$m$个$n-1$维曲面交织而成，存在$m$个法向量，这$m$个法向量构成了$n-m$维曲面的法空间</li><li>在问题的极值点，$y$的法向量必然落在$n-m$维曲面的法空间之内，也就是说$y$的法向量可以由$n-m$维曲面的$m$个法向量的线性组合表示：</li></ul>$$[\frac{{\partial y}}{{\partial {x_1}}},\frac{{\partial y}}{{\partial {x_2}}},...,\frac{{\partial y}}{{\partial {x_n}}}] + \sum\limits_{i = 1}^m {{\lambda _i}[\frac{{\partial {g_i}}}{{\partial {x_1}}},\frac{{\partial {g_i}}}{{\partial {x_2}}},...,\frac{{\partial {g_i}}}{{\partial {x_n}}}]}  = 0$$<ul><li>即：</li></ul>$$\frac{{\partial y}}{{\partial {x_j}}} + \sum\limits_{i = 1}^m {{\lambda _i}\frac{{\partial {g_i}}}{{\partial {x_j}}}}  = 0,1 \le j \le n$$<ul><li>此时我们得到了$n$个等式方程，再加上$m$个等式约束($g_i(x_1, x_2,…,x_n)=0, 1 \le i \le m$) 一起构成$n+m$个方程的方程组，未知数为$[x_1,x_2,…,x_n,\lambda_1,\lambda_2,…,\lambda_m]$共$n+m$个，方程组的解即为所有极值点和鞍点的集合，每组解中的$\lambda_i$的值即为$y$的法向量在$n-m$维曲面的法空间中的线性组合系数。</li></ul><h4 id="单个不等式约束"><a href="#单个不等式约束" class="headerlink" title="单个不等式约束"></a>单个不等式约束</h4><blockquote><p>不等式约束其实是等式约束的扩展，等式约束表示一组确定的等高线（面），不等式约束则表示等高线（面）的某一边区域</p><p>考虑$n$元函数$y=f(x_1, x_2,…,x_n)$，在不等式约束$g(x_1, x_2,…,x_n) \le 0$ 下的极值点求解问题</p></blockquote><ul><li>若该问题有解，那么有两种情况</li></ul><ol><li>解在 $g(x_1, x_2,…,x_n) = 0$ 曲面上</li><li>解在$g(x_1, x_2,…,x_n) &lt; 0$ 范围内</li></ol><ul><li>当解在 $g(x_1, x_2,…,x_n) = 0$ 曲面上时，说明该不等式对$y$取最小值的区域进行了限制，最终解落在了$y$和约束相切的位置，那么此时二者的法向量方向必然相反（否则$y$会在$g(x_1, x_2,…,x_n) &lt; 0$ 范围内找到更小的值），按照等式情况构建方程：</li></ul>$$\frac{{\partial y}}{{\partial {x_i}}} + \lambda \frac{{\partial g}}{{\partial {x_i}}} = 0,1 \le i \le n$$<ul><li><p>便有结论：$\lambda \ge 0$</p></li><li><p>当解在$g(x_1, x_2,…,x_n) &lt; 0$ 范围内时，事实上这个不等式没有对$y$的求解起到约束作用，此时相当于$\lambda = 0$</p></li><li><p>而且两种情况下分别有 $g(x_1, x_2,…,x_n) = 0$和$\lambda = 0$，也就是二者必有一方为0</p></li><li><p>因此对于单个不等式约束的拉格朗日乘数法，仅需增加限制条件： $\lambda \ge 0$和$\lambda g(x_1, x_2,…,x_n) = 0$</p></li></ul><h4 id="多个不等式约束"><a href="#多个不等式约束" class="headerlink" title="多个不等式约束"></a>多个不等式约束</h4><blockquote><p>考虑$n$元函数$y=f(x_1, x_2,…,x_n)$，在$m$个不等式约束($g_i(x_1, x_2,…,x_n)\le0, 1 \le i \le m$) 下的极值点求解问题</p></blockquote><ul><li>本质上与单个不等式约束相同，只是数量变多了</li><li>此情况下需要在等式拉格朗日乘数法基础上增加条件：</li></ul>$$\begin{aligned}\lambda_i &\ge 0,1 \le i \le m\\\lambda_ig_i &= 0,1 \le i \le m\end{aligned}$$<h3 id="算法描述"><a href="#算法描述" class="headerlink" title="算法描述"></a>算法描述</h3><ul><li>基于上述原理，提出了拉格朗日乘数法：</li></ul><ol start="0"><li><p>考虑$n$元函数$y=f(x_1, x_2,…,x_n)$，在$m_1$个等式约束($g_i(x_1, x_2,…,x_n)=0, 1 \le i \le m_1$) 、$m_2$个不等式约束($h_j(x_1, x_2,…,x_n)\le0, 1 \le j \le m_2$) 下的极值点求解问题</p></li><li><p>加入常数$\lambda,\mu$构造方程：</p></li></ol>$$z = f({x_1},{x_2},...,{x_n}) + \sum\limits_{i = 1}^{{m_1}} {{\lambda _i}{g_i}({x_1},{x_2},...,{x_n})}  + \sum\limits_{j = 1}^{{m_2}} {{\mu _j}{h_j}({x_1},{x_2},...,{x_n})}$$2. 对所有变量求偏导，并令导数为0：$$\begin{aligned}\frac{{\partial z}}{{\partial {x_i}}} &= 0\\\frac{{\partial y}}{{\partial {x_k}}} + \sum\limits_{i = 1}^{{m_1}} {{\lambda _i}\frac{{\partial g}}{{\partial {x_k}}}}  + \sum\limits_{j = 1}^{{m_1}} {{\mu _j}\frac{{\partial h}}{{\partial {x_k}}}} {\rm{ }} &= 0\end{aligned}$$<blockquote><p>其中：$1 \le k \le n$</p></blockquote><ol start="3"><li>将上述$n$个方程与$m_1$个等式约束方程$g_i(x_1, x_2,…,x_n)=0, 1 \le i \le m_1$ 联立</li><li>将上述$n+m_1$个方程与$\mu_j h_j=0, 1 \le j \le m_2$联立，得到$n+m_1+m_2$个方程</li><li>加上限制条件$\mu_j \ge 0$，$h_j \le 0$$, 1 \le j \le m_2$</li><li>在限制条件下解$n+m_1+m_2$元方程即可得到极值点与鞍点集合</li><li>从所有解中筛选出极值点</li></ol><h3 id="KKT条件"><a href="#KKT条件" class="headerlink" title="KKT条件"></a>KKT条件</h3><ul><li>上述$n+m_1+m_2$元方程与限制条件即为<code>KKT条件</code></li><li><code>KKT</code>条件是拉格朗日函数取极值时的必要条件</li></ul>$$\left\{\begin{array}{l}\nabla f+\sum_{i}^{m_1} \lambda_{i} \nabla g_{i}+\sum_{j}^{m_2} \mu_{j} \nabla h_{j}=0 \\g_{i}=0,  \\h_{j} \leq 0,  \\\mu_{j} \geq 0, \\\mu_{j} h_{j}=0\\\end{array}\right.$$<blockquote><p>其中 $i \in { 1,2, \cdots, m_1}$ ，$j \in { 1,2, \cdots, m_2}$</p></blockquote><ul><li>总结一下所有条件的含义：</li></ul><table><thead><tr><th>内容</th><th>含义</th></tr></thead><tbody><tr><td>$\nabla f+\sum_{i}^{m_1} \lambda_{i} \nabla g_{i}+\sum_{j}^{m_2} \mu_{j} \nabla h_{j}=0$</td><td>求解极值需要在各个自变量方向上导数为0</td></tr><tr><td>$g_{i}=0$</td><td>等式约束</td></tr><tr><td>$h_{j} \le 0$</td><td>不等式约束</td></tr><tr><td>$\mu_{j} \geq 0$</td><td>不等式约束时的两种情况： <br />1. 不等式约束无效($\mu_{j} = 0$) <br />2. 不等式分界面法向量与原函数法向量方向相反($\mu_{j} &gt; 0$)</td></tr><tr><td>$\mu_{j} h_{j}=0$</td><td>不等式约束时的两种情况： <br />1. 不等式约束无效，极值点在$h_{j} &lt; 0$范围内 ($\mu_{j} = 0$) <br />2. 不等式约束有效，极值点在$h_{j} = 0$曲面上($h_{j} = 0$)</td></tr></tbody></table><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://baike.baidu.com/item/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E4%B9%98%E6%95%B0%E6%B3%95/8550443?fr=aladdin">https://baike.baidu.com/item/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E4%B9%98%E6%95%B0%E6%B3%95/8550443?fr=aladdin</a></p></li><li><p><a href="https://www.zhihu.com/question/38586401">https://www.zhihu.com/question/38586401</a></p></li><li><p><a href="https://www.zhihu.com/question/359162625">https://www.zhihu.com/question/359162625</a></p></li><li><p><a href="https://www.zhihu.com/question/23311674/answer/468804362">https://www.zhihu.com/question/23311674/answer/468804362</a></p></li><li><p><a href="https://blog.csdn.net/johnnyconstantine/article/details/46335763">https://blog.csdn.net/johnnyconstantine/article/details/46335763</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>正定，半正定矩阵</title>
    <link href="/2021/03/13/math/linear_algebra/cov-pos-sem/cov-pos-sem/"/>
    <url>/2021/03/13/math/linear_algebra/cov-pos-sem/cov-pos-sem/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍正定矩阵和半正定矩阵。</p></blockquote><span id="more"></span><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><blockquote><p>正定和半正定这两个词的英文分别是positive definite和positive semi-definite，其中，definite是一个形容词，表示“明确的、确定的”等意思。</p></blockquote><h4 id="正定"><a href="#正定" class="headerlink" title="正定"></a>正定</h4><ul><li>给定一个大小为$n \times n$ 的实方阵$A$ ，若对于任意长度为$n$的非零向量$x$ ，有$x^TAx&gt;0$ 恒成立，则矩阵$A$是一个正定矩阵。</li><li>此时，若$A$为对称方阵，则称$A$为对称正定矩阵。</li></ul><h4 id="半正定"><a href="#半正定" class="headerlink" title="半正定"></a>半正定</h4><ul><li>给定一个大小为$n \times n$ 的实方阵$A$ ，若对于任意长度为$n$的非零向量$x$ ，有$x^TAx  \ge  0$ 恒成立，则矩阵$A$是一个半正定矩阵。</li><li>此时，若$A$为对称方阵，则称$A$为对称半正定矩阵。</li></ul><blockquote><p>可以看到半正定矩阵包含了正定矩阵，仅多出了等于零的一种情况，类似于正数和非负数的关系。</p></blockquote><h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><blockquote><p>以正定矩阵为例，半正定矩阵仅多了等于零的情况。</p></blockquote><ul><li><p>正定矩阵的行列式恒为正；</p></li><li><p><a href="https://baike.baidu.com/item/%E5%AE%9E%E5%AF%B9%E7%A7%B0%E7%9F%A9%E9%98%B5/4773879">实对称矩阵</a>A正定当且仅当A与单位矩阵合同；</p></li><li><p>若A是正定矩阵，则A的逆矩阵也是正定矩阵；</p></li><li><p>两个正定矩阵的和是正定矩阵；</p></li><li><p>正实数与正定矩阵的乘积是正定矩阵。</p></li></ul><h3 id="等价命题"><a href="#等价命题" class="headerlink" title="等价命题"></a>等价命题</h3><blockquote><p>对于n阶实对称矩阵A，下列条件是等价的（以正定矩阵为例）：</p></blockquote><ul><li><p>A是正定矩阵；</p></li><li><p>A的一切<a href="https://baike.baidu.com/item/%E9%A1%BA%E5%BA%8F%E4%B8%BB%E5%AD%90%E5%BC%8F/3167642">顺序主子式</a>均为正；</p></li><li><p>A的一切主子式均为正；</p></li><li><p>A的特征值均为正；</p></li><li><p>存在实可逆矩阵C，使A=C′C；</p></li><li><p>存在秩为n的m×n实矩阵B，使A=B′B；</p></li><li><p>存在主对角线元素全为正的实三角矩阵R，使A=R′R 。</p></li></ul><h3 id="协方差矩阵半正定"><a href="#协方差矩阵半正定" class="headerlink" title="协方差矩阵半正定"></a>协方差矩阵半正定</h3><ul><li>在概率统计中，多维变量的协方差矩阵是对称矩阵，事实上同时它也是半正定矩阵：</li></ul><h4 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h4><ul><li>考虑一个由$n$个$m$维向量刻画的分布，即共$n$条数据，每条数据由一个$m$维向量表示：</li></ul>$$X = \left[ {\begin{array}{*{20}{c}}{{x_{11}}}&{{x_{12}}}& \cdots &{{x_{1n}}}\\{{x_{21}}}&{{x_{22}}}&{}&{{x_{2n}}}\\\vdots &{}& \ddots & \vdots \\{{x_{m1}}}&{{x_{m2}}}& \cdots &{{x_{mn}}}\end{array}} \right]$$<ul><li>$X$的均值为${\mu _X}$</li><li>$X$的协方差矩阵为:</li></ul><p>$$<br>\sum\nolimits_X  =  \frac{1}{n}(X - {\mu _X}){(X - {\mu _X})^T}<br>$$</p><ul><li>协方差矩阵 $\Sigma_{X}$，对其进行SVD分解：</li></ul><p>$$<br>{\Sigma_X} = U \Sigma {V ^ T }<br>$$</p><ul><li>由于 $\Sigma_{X}$ 是对称矩阵，可以得到：</li></ul><p>$$<br>U=V<br>$$</p><ul><li>而且$U$是正交矩阵，有：</li></ul>$$U^T{\Sigma _X}U = \Sigma$$$$\Sigma  = {U^T}(X - {\mu _X}){(X - {\mu _X})^T}U$$$$\Sigma  = ({U^T}X - {U^T}{\mu _X}){({U^T}X - {U^T}{\mu _X})^T}$$<ul><li>令$Y = {U^T}X - {U^T}{\mu _X}$：</li></ul><p>$$<br>\Sigma  = Y{Y^T}<br>$$</p><ul><li><p>由于$\Sigma$是特征值为对角线元素的对角阵，因此对角线外元素为0，表示$Y$中向量相互之间不相关。</p></li><li><p>对于任意一个$\Sigma$中的特征值$\lambda_i$，计算公式为：</p></li></ul><p>$$<br>{\lambda _ i } = { Y _ i } { Y _ i } ^ T = \sum \limits_ {j = 1} ^n { {Y_{ij} } ^ 2}  \ge 0<br>$$</p><ul><li>因此协方差矩阵的特征值非负，是半正定矩阵。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://zhuanlan.zhihu.com/p/44860862">https://zhuanlan.zhihu.com/p/44860862</a></p></li><li><p><a href="https://baike.baidu.com/item/%E6%AD%A3%E5%AE%9A%E7%9F%A9%E9%98%B5/11030459?fr=aladdin">https://baike.baidu.com/item/%E6%AD%A3%E5%AE%9A%E7%9F%A9%E9%98%B5/11030459?fr=aladdin</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>linear_algebra</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>linear_algebra</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>正交-不相关-独立</title>
    <link href="/2021/03/12/math/probability/orthogonal-independent-uncorrelation/orthogonal-independent-uncorrelation/"/>
    <url>/2021/03/12/math/probability/orthogonal-independent-uncorrelation/orthogonal-independent-uncorrelation/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍随机变量中正交、不相关、独立的区别和联系。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p>三者均是描述随机变量之间关系的概念，看似都可以表示两个随机变量的疏远关系，但定义和约束均有不同。</p></blockquote><ul><li>考察$m$维随机变量$X,Y$之间的关系。</li></ul><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><h4 id="正交"><a href="#正交" class="headerlink" title="正交"></a>正交</h4><blockquote><p>定义$R(X, Y) = E[XY]$为相关函数：若$R(X, Y)=0$，称$X,Y$正交</p></blockquote><h4 id="不相关"><a href="#不相关" class="headerlink" title="不相关"></a>不相关</h4><blockquote><p>定义 $E[XY] = E[X]E[Y]$，则$X,Y$不相关</p></blockquote><ul><li>$X,Y$的协方差：</li></ul><p>$$<br>Cov(X,Y)=E[XY]- E[X]E[Y]<br>$$</p><blockquote><p> 不相关也可以用协方差为0表示</p></blockquote><ul><li>$X,Y$的相关系数：</li></ul><p>$$<br>r(X, Y)=\frac{\operatorname{Cov}(X, Y)}{\sqrt{\operatorname{Var}[X] \operatorname{Var}[Y]}}<br>$$</p><blockquote><p>不相关也可以用相关系数为0表示</p></blockquote><h4 id="独立"><a href="#独立" class="headerlink" title="独立"></a>独立</h4><blockquote><p>独立一般用他们的概率密度函数来表示。联合分布等于他们各自的独立边缘分布的乘积，则称为独立：</p></blockquote><p>$$<br>p(X,Y) = p(X)p(Y)<br>$$</p><h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><h4 id="独立-gt-不相关"><a href="#独立-gt-不相关" class="headerlink" title="独立 -&gt; 不相关"></a>独立 -&gt; 不相关</h4><blockquote><p>独立是对变量更严苛的要求，如果两个随机变量独立，则必定不相关，也就是说独立是不相关的充分不必要条件。</p></blockquote><ul><li>若已知$X,Y$联合概率密度$f(x, y)$等于二者边缘密度函数$g(x), h(y)$的乘积，则有：</li></ul>$$E (X,Y)=\iint x y f(x, y) d x d y=\iint x y g(x) h(y) d x d y=\int x g(x) d x \int y h(y) d y=E (X) E(Y)$$<ul><li>因此独立变量不相关，而相反不相关无法直接推导出独立</li></ul><h4 id="不相关-–高斯分布–-gt-独立"><a href="#不相关-–高斯分布–-gt-独立" class="headerlink" title="不相关 –高斯分布–&gt; 独立"></a>不相关 –高斯分布–&gt; 独立</h4><blockquote><p>在随机变量服从高斯分布时，不相关可以推导出独立：</p></blockquote><ul><li>我们此时考虑稍复杂一些的情况，$X$为$n$维随机变量：</li></ul><p>$$<br>X^T=[x_1,x_2,…,x_n]<br>$$</p><ul><li>随机变量之间两两不相关，并且服从高斯分布：</li></ul>$$Cov(x_i,x_j)=0,i \ne j$$$$x_i \sim N\left(\mu_i, \sigma_i^{2}\right)$$<ul><li>那么此时$X$的联合概率密度函数为：</li></ul>$$f\left( {{x_1},{x_x} \ldots ,{x_n}} \right) = \frac{1}{{\sqrt {{{\left( {2\pi } \right)}^n}} {{\left| {\bf{\Sigma }} \right|}^{\frac{1}{2}}}}}{e^{ - \frac{1}{2}{{({\bf{X}} - {\bf{\mu }})}^T}{{\bf{\Sigma }}^{ - 1}}({\bf{X}} - {\bf{\mu }})}}$$<ul><li>其中${\bf{\Sigma } }$为协方差矩阵，因为随机变量之间两两不相关：</li></ul>$${\bf{\Sigma }} = \left( {\begin{array}{*{20}{c}}{\sigma _1^2}&{}&{}&{}\\{}&{\sigma _2^2}&{}&{}\\{}&{}& \ddots &{}\\{}&{}&{}&{\sigma _n^2}\end{array}} \right)$$<ul><li>其中$\sigma_i $为$x_i$的标准差，那么联合概率密度函数可以写为：</li></ul>$$\begin{aligned}f\left( {{x_1},{x_x} \ldots ,{x_n}} \right) &= \frac{1}{{\sqrt {{{\left( {2\pi } \right)}^n}} \prod\limits_{i = 1}^n {{\sigma _i}} }}{e^{ - \frac{1}{2}{{({\bf{X}} - {\bf{\mu }})}^T}\left( {\begin{array}{*{20}{c}}{\frac{1}{{\sigma _1^2}}}&{}&{}&{}\\{}&{\frac{1}{{\sigma _2^2}}}&{}&{}\\{}&{}& \ddots &{}\\{}&{}&{}&{\frac{1}{{\sigma _n^2}}}\\\end{array}} \right)({\bf{X}} - {\bf{\mu }})}}\\ &= \frac{1}{{\sqrt {{{\left( {2\pi } \right)}^n}} \prod\limits_{i = 1}^n {{\sigma _i}} }}{e^{ - \frac{1}{2}[\frac{{{x_1} - {\mu _1}}}{{\sigma _1^2}},\frac{{{x_2} - {\mu _2}}}{{\sigma _2^2}},...,\frac{{{x_n} - {\mu _n}}}{{\sigma _n^2}}]({\bf{X}} - {\bf{\mu }})}}\\ & = \frac{1}{{\sqrt {{{\left( {2\pi } \right)}^n}} \prod\limits_{i = 1}^n {{\sigma _i}} }}{e^{ - \frac{1}{2}\sum\limits_{i = 1}^n {\frac{{{{({x_n} - {\mu _n})}^2}}}{{\sigma _n^2}}} }}\\ & = \prod\limits_{i = 1}^n {\frac{1}{{\sqrt {2\pi } {\sigma _i}}}} {e^{ - \frac{1}{2}\frac{{{{({x_i} - {\mu _i})}^2}}}{{\sigma _i^2}}}}\\ & = \prod\limits_{i = 1}^n {f({x_i})}  \end{aligned}$$<ul><li>因此在随机变量服从高斯分布时，不相关与独立等价，互为充要条件。</li></ul><h4 id="正交-–-不相关"><a href="#正交-–-不相关" class="headerlink" title="正交 – 不相关"></a>正交 – 不相关</h4><ul><li>根据定义可以得知： 当$E[X]，E[Y]$至少有一个为0时正交等价于不相关。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://blog.sciencenet.cn/blog-812827-1096465.html">http://blog.sciencenet.cn/blog-812827-1096465.html</a></li><li><a href="https://blog.csdn.net/wjj5881005/article/details/53320403/">https://blog.csdn.net/wjj5881005/article/details/53320403/</a></li><li><a href="https://www.zhihu.com/question/26583332/answer/33327497">https://www.zhihu.com/question/26583332/answer/33327497</a></li><li><a href="https://baike.baidu.com/item/%E4%B8%8D%E7%9B%B8%E5%85%B3%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F/19126995?fr=aladdin">https://baike.baidu.com/item/%E4%B8%8D%E7%9B%B8%E5%85%B3%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F/19126995?fr=aladdin</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python PCV 库的安装与使用</title>
    <link href="/2021/03/11/python/PCV-install-for-python/PCV-install-for-python/"/>
    <url>/2021/03/11/python/PCV-install-for-python/PCV-install-for-python/</url>
    
    <content type="html"><![CDATA[<blockquote><p>python图像处理中会调用一些开源库，PCV是其中之一，由于该库比较古老，本文记录安装使用方法。</p></blockquote><span id="more"></span><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><ul><li><a href="https://github.com/jesolem/PCV">https://github.com/jesolem/PCV</a></li><li><a href="https://codechina.csdn.net/mirrors/jesolem/pcv?utm_source=csdn_github_accelerator">https://codechina.csdn.net/mirrors/jesolem/pcv?utm_source=csdn_github_accelerator</a></li></ul><blockquote><p>第二个是国内镜像，速度会快一些</p></blockquote><ul><li>git clone到任意目录，或者直接下载zip文件.</li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul><li>进入下载根目录运行命令：</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> install<br></code></pre></td></tr></table></figure><ul><li>如果你使用 python3 你就会发现很多 print 错误</li><li>这是由于库过于古老，仍沿用了python2 的print语法</li><li>需要逐个将print ‘hello’ 改为 print (‘hello’)</li></ul><h4 id="修改文件"><a href="#修改文件" class="headerlink" title="修改文件"></a>修改文件</h4><ul><li>报错信息包含的文件都在PCV子文件夹中，具体需要修改的文件列表如下: </li></ul><blockquote><p>在列表文件中搜索 print 并安装python3格式修改即可</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">.<span class="hljs-regexp">/PCV/</span>tools/ncut.py<br>.<span class="hljs-regexp">/PCV/</span>tools/imtools.py<br>.<span class="hljs-regexp">/PCV/</span>tools/ransac.py<br>.<span class="hljs-regexp">/PCV/im</span>agesearch/imagesearch.py<br>.<span class="hljs-regexp">/PCV/</span>classifiers/bayes.py<br>.<span class="hljs-regexp">/PCV/g</span>eometry/warp.py<br>.<span class="hljs-regexp">/PCV/</span>localdescriptors/dsift.py<br>.<span class="hljs-regexp">/PCV/</span>localdescriptors/sift.py<br></code></pre></td></tr></table></figure><h4 id="重新安装"><a href="#重新安装" class="headerlink" title="重新安装"></a>重新安装</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> install<br></code></pre></td></tr></table></figure><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><ul><li>执行</li></ul><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">python</span><br><span class="hljs-keyword">import</span> PCV<br><span class="hljs-title">from</span> <span class="hljs-type">PCV</span>.tools <span class="hljs-keyword">import</span> imtools<br></code></pre></td></tr></table></figure><blockquote><p>没有报错既说明安装成功。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.it610.com/article/1296222817162960896.htm">https://www.it610.com/article/1296222817162960896.htm</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>马氏距离 (马哈拉诺比斯距离) (Mahalanobis distance)</title>
    <link href="/2021/03/02/math/distance/mahalanobis-distance/"/>
    <url>/2021/03/02/math/distance/mahalanobis-distance/</url>
    
    <content type="html"><![CDATA[<blockquote><p>马氏距离(Mahalanobis distance)是由印度统计学家马哈拉诺比斯(P. C. Mahalanobis)提出的，表示点与一个分布之间的距离。它是一种有效的计算两个未知样本集的相似度的方法。与<a href="https://baike.baidu.com/item/%E6%AC%A7%E6%B0%8F%E8%B7%9D%E7%A6%BB/1798948">欧氏距离</a>不同的是，它考虑到各种特性之间的联系，本文介绍马氏距离相关内容。</p></blockquote><span id="more"></span><h3 id="欧氏距离的缺点"><a href="#欧氏距离的缺点" class="headerlink" title="欧氏距离的缺点"></a>欧氏距离的缺点</h3><blockquote><p>距离度量在各个学科中有着广泛用途，当数据表示为向量$\overrightarrow{\mathbf{x} }=\left(x_{1}, x_{2}, \cdots, x_{n}\right)^{T}$和$\overrightarrow{\mathbf{y}}=\left(y_{1}, y_{2}, \cdots, y_{n}\right)^{T}$时，最直观的距离度量就是欧式距离了：</p></blockquote>$$d(x, y):=\sqrt{\left(x_{1}-y_{1}\right)^{2}+\left(x_{2}-y_{2}\right)^{2}+\cdots+\left(x_{n}-y_{n}\right)^{2}}=\sqrt{\sum_{i=1}^{n}\left(x_{i}-y_{i}\right)^{2}}$$<blockquote><p>但是这种度量方式没有考虑到各个维度之间的差异和相关等因素，不同的向量度量距离时权重都相同，这可能会对结果可信度产生干扰。</p></blockquote><h3 id="马氏距离"><a href="#马氏距离" class="headerlink" title="马氏距离"></a>马氏距离</h3><blockquote><p>度量样本距离某个分布的距离，先将样本与分布标准化到多维标准正态分布后度量欧式距离</p></blockquote><h4 id="思想"><a href="#思想" class="headerlink" title="思想"></a>思想</h4><ul><li>将变量按照主成分进行旋转，消除维度间的相关性</li><li>对向量和分布进行标准化，让各个维度同为标准正态分布</li></ul><h4 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h4><ul><li>分布由$n$个$m$维向量刻画，即共$n$条数据，每条数据由一个$m$维向量表示：</li></ul>$$X = \left[ {\begin{array}{*{20}{c}}{{x_{11}}}&{{x_{12}}}& \cdots &{{x_{1n}}}\\{{x_{21}}}&{{x_{22}}}&{}&{{x_{2n}}}\\\vdots &{}& \ddots & \vdots \\{{x_{m1}}}&{{x_{m2}}}& \cdots &{{x_{mn}}}\end{array}} \right]$$<ul><li>$X$的均值为${\mu _X}$</li><li>$X$的协方差矩阵为:</li></ul><p>$$<br>\sum\nolimits_X  =  \frac{1}{n}(X - {\mu _X}){(X - {\mu _X})^T}<br>$$</p><ul><li>为消除维度间的相关性，通过一个$m \times m$的矩阵$Q^T$对$X$进行坐标表换，将数据映射到新的坐标系下，用$Y$表示：</li></ul><p>$$<br>Y=Q^TX<br>$$</p><blockquote><p>此时我们期望在$Q^T$的作用下，$Y$ 的向量表示中，不同维度之间是相互独立的，此时$Y$ 的协方差矩阵应该是一个对角矩阵（除对角线元素外，其余元素均为0）。</p></blockquote><ul><li>Y 的均值：$u_{Y}=Q^{T} u_{X}$</li><li>Y 的协方差矩阵：</li></ul>$$\begin{aligned}\Sigma_{Y} &=\frac{1}{n}\left[Y-u_{Y}\right]\left[y-u_{Y}\right]^{T} \\&=\frac{1}{n}\left[Q^{T}\left(X-u_{x}\right)\right]\left[Q^{T}\left(X-u_{X}\right)\right]^{T} \\&=Q^{T} \frac{1}{n}\left(X-u_{X}\right)\left(X-u_{X}\right)^{T} Q \\&=Q^{T} \Sigma_{X} Q\end{aligned}$$<ul><li><p>从这里可以发现，当 $Q $是$\Sigma_{X}$的特征向量组成的矩阵时，$\Sigma_{Y}$ 一定是对角矩阵，且值为每个特征向量对应的特征值。由于$\Sigma_{X}$是对称矩阵，因此肯定可以通过特征分解得到 $Q$ ，且 $Q$ 是正交矩阵。</p></li><li><p>$\Sigma_{Y}$的对角线元素含义为$Y$中每个向量的方差，因此均为非负值，从这个角度可以说明协方差矩阵的特征值为非负值。</p></li><li><p>而且事实上<a href="https://www.zywvvd.com/2021/03/13/math/linear_algebra/cov-pos-sem/cov-pos-sem/#%E5%8D%8F%E6%96%B9%E5%B7%AE%E7%9F%A9%E9%98%B5%E5%8D%8A%E6%AD%A3%E5%AE%9A">协方差矩阵本身就是半正定的</a>，特征值均非负</p></li><li><p>不相关与独立的问题：</p><ul><li>此处我们说明了变换后的向量之间相关系数为0，也就是向量之间不相关</li><li>而事实上独立是比不相关更强的约束，不相关往往不能推出独立</li><li>但在<a href="https://www.zywvvd.com/2021/03/12/math/probability/orthogonal-independent-uncorrelation/orthogonal-independent-uncorrelation/">高斯分布下，不相关和独立是等价的</a></li></ul></li></ul><blockquote><p>接下来我们对向量进行标准化</p></blockquote><ul><li><p>当我们减去均值后，向量已经变成了0均值的向量，距离标准化仅差将方差变为1</p></li><li><p>在经历了$Y=Q^TX$变换后，$Y$的协方差矩阵已经成为了对角阵，对角线元素为$Y$中各个维度数据的方差，那么我们仅需让$Y$中各个维度数据除以该维度数据的标准差即可。</p></li><li><p>我们将去相关化、0均值化、标准化过后的数据记为$Z$：</p>  $$  \begin{aligned}  Z &= \left[ {\begin{array}{*{20}{c}}  {\frac{1}{{{\sigma _1}}}}&{}&{}&{}\\  {}&{\frac{1}{{{\sigma _2}}}}&{}&{}\\  {}&{}& \ddots &{}\\  {}&{}&{}&{\frac{1}{{{\sigma _n}}}}  \end{array}} \right](Y - {\mu _Y})   \\&= \Sigma _Y^{ - \frac{1}{2}}{Q^T}(X - {\mu _X}) \\  &= ({Q^T}{\Sigma _X}Q)_{}^{ - \frac{1}{2}}{Q^T}(X - {\mu _X})\end{aligned}  $$  </li><li><p>而马氏距离就是度量纠正过后的向量$Z$到分布中心（原点）的欧式距离：</p>$$\begin{array}{l}{D_M}(X) & =\sqrt {{Z^T}Z}  \\&= \sqrt {{{\left( {X - {u_X}} \right)}^T}Q{{\left( {{Q^T}{\Sigma _X}Q} \right)}^{ - \frac{1}{2}}}{{\left( {{Q^T}{\Sigma _X}Q} \right)}^{ - \frac{1}{2}}}{Q^T}\left( {X - {u_X}} \right)} \\ &= \sqrt {{{\left( {X - {u_X}} \right)}^T}Q{{\left( {{Q^T}{\Sigma _X}Q} \right)}^{ - 1}}{Q^T}\left( {X - {u_X}} \right)} \\ &= \sqrt {{{\left( {X - {u_X}} \right)}^T}Q{Q^{ - 1}}\Sigma _X^{ - 1}Q{Q^T}\left( {X - {u_X}} \right)} \\ &= \sqrt {{{\left( {X - {u_X}} \right)}^T}\Sigma _X^{-1}\left( {X - {u_X}} \right)} \\\end{array}$$</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://baike.baidu.com/item/%E9%A9%AC%E6%B0%8F%E8%B7%9D%E7%A6%BB/8927833?fr=aladdin">https://baike.baidu.com/item/%E9%A9%AC%E6%B0%8F%E8%B7%9D%E7%A6%BB/8927833?fr=aladdin</a></li><li><a href="https://zhuanlan.zhihu.com/p/109100222">https://zhuanlan.zhihu.com/p/109100222</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorch can&#39;t optimize a non-leaf Tensor</title>
    <link href="/2021/03/02/deep_learning/pytorch/none-leaf_tensor/none-leaf_tensor/"/>
    <url>/2021/03/02/deep_learning/pytorch/none-leaf_tensor/none-leaf_tensor/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录 pytorch: can’t optimize a non-leaf Tensor 解决方案。</p></blockquote><span id="more"></span><h3 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h3><blockquote><p>运行优化时报错</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> optim<br> <br>weights = torch.rand(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">128</span>,<span class="hljs-number">416</span>)<br>weights.requires_grad = <span class="hljs-literal">True</span><br>weights = weights.cuda()<br>optimizer = optim.Adam([weights], lr=<span class="hljs-number">0.01</span>)<br><br></code></pre></td></tr></table></figure><ul><li>报错： can’t optimize a non-leaf Tensor</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><blockquote><p>需要先把Tensor放入到GPU中，然后再设置Tensor.requires_grad=True。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> optim<br> <br>weights = torch.rand(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">128</span>,<span class="hljs-number">416</span>)<br>weights = weights.cuda()<br>weights.requires_grad = <span class="hljs-literal">True</span><br>optimizer = optim.Adam([weights], lr=<span class="hljs-number">0.01</span>)<br><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/nkhgl/article/details/100047276">https://blog.csdn.net/nkhgl/article/details/100047276</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
      <category>pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>概率论基础 - 1 - 基础概念</title>
    <link href="/2021/03/01/math/probability/probability_basic_knowledge/"/>
    <url>/2021/03/01/math/probability/probability_basic_knowledge/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本系列记录概率论基础知识，本文介绍最基本的概率论概念。</p></blockquote><span id="more"></span><h3 id="概率与分布"><a href="#概率与分布" class="headerlink" title="概率与分布"></a>概率与分布</h3><h4 id="条件概率与独立事件"><a href="#条件概率与独立事件" class="headerlink" title="条件概率与独立事件"></a>条件概率与独立事件</h4><h5 id="条件概率"><a href="#条件概率" class="headerlink" title="条件概率"></a>条件概率</h5><ul><li>已知$A$事件发生的条件下$B$发生的概率，记作$P(B \mid A)$ ，它等于事件$AB$的概率相对于事件$A$的概率，即：</li></ul><p>$$<br>P(B \mid A)=\frac{P(A B)}{P(A)}<br>$$</p><ul><li>其中 ${P(A)} &gt; 0$</li></ul><h5 id="条件概率分布的链式法则"><a href="#条件概率分布的链式法则" class="headerlink" title="条件概率分布的链式法则"></a>条件概率分布的链式法则</h5><ul><li>对于$n$个随机变量${X_{1}, X_{2}, \cdots, X_{n}}$ ，有：</li></ul><p>$$<br>P\left(X_{1}, X_{2}, \cdots, X_{n}\right)=P\left(X_{1}\right) \prod_{i=2}^{n} P\left(X_{i} \mid X_{1}, \cdots, X_{i} 1\right)<br>$$</p><h5 id="变量相互独立"><a href="#变量相互独立" class="headerlink" title="变量相互独立"></a>变量相互独立</h5><ul><li>两个随机变量$X,Y$相互独立的数学描述：</li></ul><p>$$<br>P(X, Y)=P(X) P(Y)<br>$$</p><h5 id="变量相对独立"><a href="#变量相对独立" class="headerlink" title="变量相对独立"></a>变量相对独立</h5><ul><li>两个随机变量$X,Y$关于随机变量$Z$条件独立的数学描述：</li></ul><p>$$<br>P(X, Y \mid Z)=P(X \mid Z) P(Y \mid Z)<br>$$</p><h4 id="联合概率分布"><a href="#联合概率分布" class="headerlink" title="联合概率分布"></a>联合概率分布</h4><h5 id="联合分布"><a href="#联合分布" class="headerlink" title="联合分布"></a>联合分布</h5><ul><li>定义$X$和$Y$的联合分布为：</li></ul>$$P(a, b)=P\{X \leq a, Y \leq b\}, \quad-\infty < a , b < + \infty$$<ul><li>$X$的分布可以从联合分布中得到：</li></ul>$$P_{X}(a)=P\{X \leq a\}=P\{X \leq a, Y \leq \infty\}=P(a, \infty), \quad-\infty < a < + \infty$$<ul><li>$Y$的分布可以从联合分布中得到：</li></ul>$$P_{Y}(b)=P\{Y \leq b\}=P\{X \leq \infty, Y \leq b\}=P(\infty, b), \quad-\infty < b < + \infty$$<h5 id="联合概率质量函数"><a href="#联合概率质量函数" class="headerlink" title="联合概率质量函数"></a>联合概率质量函数</h5><ul><li>当$X$和$Y$都是离散随机变量时， 定义$X$和$Y$的联合概率质量函数为：</li></ul>$$p(x, y)=P\{X=x, Y=y\}$$<ul><li>$X$和$Y$的概率质量函数分布为：</li></ul><p>$$<br>p_{X}(x)=\sum_{y} p(x, y) \quad p_{Y}(y)=\sum_{x} p(x, y)<br>$$</p><h5 id="概率密度函数"><a href="#概率密度函数" class="headerlink" title="概率密度函数"></a>概率密度函数</h5><ul><li>当$X$和$Y$联合地连续时，即存在函数$p(x,y)$ ，使得对于所有的实数集合$\mathbb{A}$和$\mathbb{B}$满足：</li></ul>$$P\{X \in \mathbb{A}, Y \in \mathbb{B}\}=\int_{\mathbb{B}} \int_{\mathbb{A}} p(x, y) d x d y$$<ul><li>则函数$p(x,y)$称为$X$和$Y$的概率密度函数。</li><li>$X$和$Y$的联合分布为：</li></ul>$$P(a, b)=P\{X \leq a, Y \leq b\}=\int_{-\infty}^{a} \int_{-\infty}^{b} p(x, y) d x d y$$<ul><li>$X$和$Y$的分布函数：</li></ul><p>$$<br>P_{X}(a)=\int_{-\infty}^{a} \int_{-\infty}^{\infty} p(x, y) d x d y=\int_{-\infty}^{a} p_{X}(x) d x<br>$$</p><p>$$<br>P_{Y}(b)=\int_{\infty}^{\infty} \int_{\infty}^{b} p(x, y) d x d y=\int_{\infty}^{b} p_{Y}(y) d y<br>$$</p><ul><li>$X$和$Y$的概率密度函数：</li></ul><p>$$<br>p_{X}(x)=\int_{-\infty}^{\infty} p(x, y) d y<br>$$</p><p>$$<br>p_{Y}(y)=\int_{-\infty}^{\infty} p(x, y) d x<br>$$</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/2_probability.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>probability</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>probability</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>线性代数 - 1 - 基础知识</title>
    <link href="/2021/02/27/math/linear_algebra/basic_knowledge/"/>
    <url>/2021/02/27/math/linear_algebra/basic_knowledge/</url>
    
    <content type="html"><![CDATA[<blockquote><p>线性代数，基础知识，温故知新。</p></blockquote><span id="more"></span><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul><li>向量：</li></ul><blockquote><p>向量默认为列向量：</p></blockquote>$$\overrightarrow{\mathbf{x}}=\left(x_{1}, x_{2}, \cdots, x_{n}\right)^{T}=\left[\begin{array}{c}x_{1} \\x_{2} \\\vdots \\x_{n}\end{array}\right]$$<ul><li>矩阵 $\mathbf{X} \in \mathbb{R}^{m \times n}$，表示为：</li></ul>$$\mathbf{X}=\left[\begin{array}{cccc}x_{1,1} & x_{1,2} & \cdots & x_{1, n} \\x_{2,1} & x_{2,2} & \cdots & x_{2, n} \\\vdots & \vdots & \ddots & \vdots \\x_{m, 1} & x_{m, 2} & \cdots & x_{m, n}\end{array}\right]$$<h3 id="范数"><a href="#范数" class="headerlink" title="范数"></a>范数</h3><h4 id="向量范数"><a href="#向量范数" class="headerlink" title="向量范数"></a>向量范数</h4><h5 id="1-范数"><a href="#1-范数" class="headerlink" title="1-范数"></a><strong>1-范数</strong></h5><blockquote><p>各个元素的绝对值之和</p></blockquote>$$\|X\|_{1}=\sum_{i=1}^{n}\left|x_{i}\right|$$<h5 id="2-范数"><a href="#2-范数" class="headerlink" title="2-范数"></a>2-范数</h5><blockquote><p>每个元素的平方和再开平方根</p></blockquote>$$\|X\|_{2}=\left(\sum_{i=1}^{n} x_{i}^{2}\right)^{\frac{1}{2}}=\sqrt{\sum_{i=1}^{n} x_{i}^{2}}$$<h5 id="p-范数"><a href="#p-范数" class="headerlink" title="p-范数"></a><strong>p-范数</strong></h5>$$\|X\|_{p}=\left(\sum_{i=1}^{n}\left|x_{i}\right|^{p}\right)^{\frac{1}{p}}$$<ul><li>其中正整数<em>p</em>≥1，并且有 $\lim _{p \rightarrow \infty}\|X\|_{p}=\max _{1 \leq i \leq n}\left|x_{i}\right|$.</li></ul><h5 id="无穷范数"><a href="#无穷范数" class="headerlink" title="无穷范数"></a><strong>无穷范数</strong></h5>$$\|X\|_{\infty}=\max _ { 1 < i< n}\left|x_{i}\right | $$<blockquote><p>为向量中绝对值最大的元素的值。</p></blockquote><h4 id="矩阵范数"><a href="#矩阵范数" class="headerlink" title="矩阵范数"></a>矩阵范数</h4><h5 id="1-范数（列模）"><a href="#1-范数（列模）" class="headerlink" title="1-范数（列模）"></a><strong>1-范数（列模）</strong></h5><blockquote><p>矩阵的每一列上的元素绝对值先求和，再从中取个最大的，（列和最大）</p></blockquote>$$\|A\|_{1}=\max _{1 \leq j \leq n} \sum_{i=1}^{n} \mid a_{i j}\mid$$<h5 id="2-范数（谱模）："><a href="#2-范数（谱模）：" class="headerlink" title="2-范数（谱模）："></a><strong>2-范数（谱模）：</strong></h5><blockquote><p>最大特征值开平方根：</p></blockquote>$$\mid\mid A \|_{2}=\sqrt{\lambda_{\max }\left(A^{T} A\right)}=\sqrt{\max _{1 \leq i \leq n}\left|\lambda_{i}\right|}$$<h5 id="无穷范数（行模）："><a href="#无穷范数（行模）：" class="headerlink" title="无穷范数（行模）："></a><strong>无穷范数（行模）</strong>：</h5><blockquote><p>矩阵的每一行上的元素绝对值先求和，再从中取个最大的，（行和最大）</p></blockquote>$$\|A\|_{\infty}=\max _{1 \leq i \leq n} \sum_{j=1}^{n} \mid a_{i j}\mid$$<h5 id="L0范数："><a href="#L0范数：" class="headerlink" title="L0范数："></a><strong>L0范数</strong>：</h5><blockquote><p>矩阵的非0元素的个数，通常用它来表示稀疏，L0范数越小0元素越多，也就越稀疏</p></blockquote><h5 id="L1范数："><a href="#L1范数：" class="headerlink" title="L1范数："></a><strong>L1范数：</strong></h5><blockquote><p>矩阵中的每个元素绝对值之和，它是L0范数的最优凸近似，因此它也可以近似表示稀疏</p></blockquote><h5 id="F范数："><a href="#F范数：" class="headerlink" title="F范数："></a><strong>F范数：</strong></h5><blockquote><p>矩阵的各个元素平方之和再开平方根，它通常也叫做矩阵的L2范数，它的优点在它是一个凸函数，可以求导求解，易于计算</p></blockquote>$$\|\mathbf{A}\|_{F}=\sqrt{\sum_{i, j} a_{i, j}^{2}}$$<h3 id="行列式"><a href="#行列式" class="headerlink" title="行列式"></a>行列式</h3><ul><li>方阵 $A$ 的行列式，记作 $det(A)$或$|A|$：</li></ul>$$D=\left|\begin{array}{llll}a_{11} & a_{12} & \cdots & a_{1 n} \\a_{21} & a_{22} & \cdots & a_{2 n} \\\cdots & \cdots & \cdots & \cdots \\a_{n 1} & a_{n 2} & \cdots & a_{n n}\end{array}\right|$$<ul><li>计算公式：</li></ul><p>$$<br>D=\sum (- 1) ^ {k } a_{1 k_{ 1} } a_{2 k_{2} } \cdots a_ { n k _ { n} }<br>$$</p><ul><li>表示的是$n$个$n$维向量构成的n维平行多面体的体积，该体积有正负，若存在线性相关的向量，行列式为0</li><li>行列式$A$中某行(或列)用同一数$k$乘,其结果等于$kA$</li><li>行列式$A$等于其转置行列式$A^T$($A^T$的第i行为$A$的第$i$列)</li><li>行列式$A$中两行（或列）互换,其结果等于$-A$</li><li>把行列式$A$的某行（或列）中各元同乘一数后加到另一行（或列）中各对应元上，结果仍然是$A$</li></ul><h3 id="方阵的迹"><a href="#方阵的迹" class="headerlink" title="方阵的迹"></a>方阵的迹</h3><ul><li>方阵$\mathbf{A}=\left(a_{i, j}\right)_{n \times n}$的迹，记作$\operatorname{tr}(\mathbf{A})$，对角线元素之和，也等于特征值的和：</li></ul>$$\operatorname{tr}(\mathbf{A})=\sum_{i} a_{i, i}$$<h3 id="向量积"><a href="#向量积" class="headerlink" title="向量积"></a>向量积</h3><h4 id="点积（Dot-Product）"><a href="#点积（Dot-Product）" class="headerlink" title="点积（Dot Product）"></a>点积<strong>（Dot Product）</strong></h4><blockquote><p>对应元素乘积和，结果不是一个向量，而是一个标量（Scalar）</p></blockquote>$${\bf{A} } \cdot {\bf{B} } = \sum\limits_i { {a_i}{b_i} }  = \left| A \right|\left| B \right|Cos\left( \theta  \right)$$<h4 id="叉乘（cross-product）"><a href="#叉乘（cross-product）" class="headerlink" title="叉乘（cross product）"></a><strong>叉乘（cross product）</strong></h4><h5 id="三维向量的叉积："><a href="#三维向量的叉积：" class="headerlink" title="三维向量的叉积："></a>三维向量的叉积：</h5><blockquote><p>用三阶行列式表示</p></blockquote>$$\overrightarrow{\mathbf{u}}=u_{x} \overrightarrow{\mathbf{i}}+u_{y} \overrightarrow{\mathbf{j}}+u_{z} \overrightarrow{\mathbf{k}}, \quad \overrightarrow{\mathbf{v}}=v_{x} \overrightarrow{\mathbf{i}}+v_{y} \overrightarrow{\mathbf{j}}+v_{z} \overrightarrow{\mathbf{k}}$$<blockquote><p>其中$\overrightarrow{\mathbf{i}}, \overrightarrow{\mathbf{j}}, \overrightarrow{\mathbf{k}}$分别为$x, y, z$轴的单位向量。</p></blockquote>$$\overrightarrow{\mathbf{w}}=\overrightarrow{\mathbf{u}} \times \overrightarrow{\mathbf{v}}=\left[\begin{array}{ccc}\overrightarrow{\mathbf{i}} & \overrightarrow{\mathbf{j}} & \overrightarrow{\mathbf{k}} \\u_{x} & u_{y} & u_{z} \\v_{x} & v_{y} & v_{z}\end{array}\right]$$<ul><li>$\overrightarrow{\mathbf{u}}, \overrightarrow{\mathbf{v}}$的叉积垂直于$\overrightarrow{\mathbf{u}}, \overrightarrow{\mathbf{v}}$构成的平面，其方向符合右手规则</li><li>叉积的模等于$\overrightarrow{\mathbf{u}}, \overrightarrow{\mathbf{v}}$构成的平行四边形的面积</li></ul><h4 id="向量的并矢"><a href="#向量的并矢" class="headerlink" title="向量的并矢"></a>向量的并矢</h4><blockquote><p>给定两个向量 $\overrightarrow{\mathbf{x}}=\left(x_{1}, x_{2}, \cdots, x_{n}\right)^{T}, \overrightarrow{\mathbf{y}}=\left(y_{1}, y_{2}, \cdots, y_{m}\right)^{T}$  ，则向量的并矢记作：</p></blockquote>$$\overrightarrow{\mathbf{x}} \overrightarrow{\mathbf{y}}=\left[\begin{array}{cccc}x_{1} y_{1} & x_{1} y_{2} & \cdots & x_{1} y_{m} \\x_{2} y_{1} & x_{2} y_{2} & \cdots & x_{2} y_{m} \\\vdots & \vdots & \ddots & \vdots \\x_{n} y_{1} & x_{n} y_{2} & \cdots & x_{n} y_{m}\end{array}\right]$$<blockquote><p>也记作$\overrightarrow{\mathbf{x}} \otimes \overrightarrow{\mathbf{y}}$或者$\overrightarrow{\mathbf{x}} \overrightarrow{\mathbf{y}}^{T}$。</p></blockquote><h3 id="矩阵运算"><a href="#矩阵运算" class="headerlink" title="矩阵运算"></a>矩阵运算</h3><blockquote><p>给定两个矩阵$\mathbf{A}=\left(a_{i, j}\right) \in \mathbb{R}^{m \times n}, \mathbf{B}=\left(b_{i, j}\right) \in \mathbb{R}^{m \times n}$ ，定义：</p></blockquote><h4 id="阿达马积-Hadamard-product-（又称作逐元素积）"><a href="#阿达马积-Hadamard-product-（又称作逐元素积）" class="headerlink" title="阿达马积(Hadamard product)（又称作逐元素积）"></a>阿达马积(Hadamard product)（又称作逐元素积）</h4>$$\mathbf{A} \circ \mathbf{B}=\left[\begin{array}{cccc}a_{1,1} b_{1,1} & a_{1,2} b_{1,2} & \cdots & a_{1, n} b_{1, n} \\a_{2,1} b_{2,1} & a_{2,2} b_{2,2} & \cdots & a_{2, n} b_{2, n} \\\vdots & \vdots & \ddots & \vdots \\a_{m, 1} b_{m, 1} & a_{m, 2} b_{m, 2} & \cdots & a_{m, n} b_{m, n}\end{array}\right]$$<h4 id="克罗内积-Kronnecker-product"><a href="#克罗内积-Kronnecker-product" class="headerlink" title="克罗内积(Kronnecker product)"></a>克罗内积(Kronnecker product)</h4>$$\mathbf{A} \otimes \mathbf{B}=\left[\begin{array}{cccc}a_{1,1} \mathbf{B} & a_{1,2} \mathbf{B} & \cdots & a_{1, n} \mathbf{B} \\a_{2,1} \mathbf{B} & a_{2,2} \mathbf{B} & \cdots & a_{2, n} \mathbf{B} \\\vdots & \vdots & \ddots & \vdots \\a_{m, 1} \mathbf{B} & a_{m, 2} \mathbf{B} & \cdots & a_{m, n} \mathbf{B}\end{array}\right]$$<h3 id="偏导数"><a href="#偏导数" class="headerlink" title="偏导数"></a>偏导数</h3><ul><li>标量对标量的偏导数：$\frac{\partial u}{\partial v}$ 。</li><li>标量对向量（ $n$ 维向量）的偏导数 ： $\frac{\partial u}{\partial \overrightarrow{\mathbf{v}}}=\left(\frac{\partial u}{\partial v_{1}}, \frac{\partial u}{\partial v_{2}}, \cdots, \frac{\partial u}{\partial v_{n}}\right)^{T}$。</li><li>标量对矩阵( $m \times n$阶矩阵)的偏导数：</li></ul>$$\frac{\partial u}{\partial \mathbf{V}}=\left[\begin{array}{cccc}\frac{\partial u}{\partial V_{1,1}} & \frac{\partial u}{\partial V_{1,2}} & \cdots & \frac{\partial u}{\partial V_{1, n}} \\\frac{\partial u}{\partial V_{2,1}} & \frac{\partial u}{\partial V_{2,2}} & \cdots & \frac{\partial u}{\partial V_{2, n}} \\\vdots & \vdots & \ddots & \vdots \\\frac{\partial u}{\partial V_{m, 1}} & \frac{\partial u}{\partial V_{m, 2}} & \cdots & \frac{\partial u}{\partial V_{m, n}}\end{array}\right]$$<ul><li>向量（ $m$维向量）对标量的偏导数：$\frac{\partial \overrightarrow{\mathbf{u}}}{\partial v}=\left(\frac{\partial u_{1}}{\partial v}, \frac{\partial u_{2}}{\partial v}, \cdots, \frac{\partial u_{m}}{\partial v}\right)^{T}$ 。</li><li>向量（ $m$维向量）对向量 ( $n$维向量) 的偏导数（雅可比矩阵，行优先）如果为列优先，则为矩阵的转置。</li></ul>$$\frac{\partial \overrightarrow{\mathbf{u}}}{\partial \overrightarrow{\mathbf{v}}}=\left[\begin{array}{cccc}\frac{\partial u_{1}}{\partial v_{1}} & \frac{\partial u_{1}}{\partial v_{2}} & \cdots & \frac{\partial u_{1}}{\partial v_{n}} \\\frac{\partial u_{2}}{\partial v_{1}} & \frac{\partial u_{2}}{\partial v_{2}} & \cdots & \frac{\partial u_{2}}{\partial v_{n}} \\\vdots & \vdots & \ddots & \vdots \\\frac{\partial u_{m}}{\partial v_{1}} & \frac{\partial u_{m}}{\partial v_{2}} & \cdots & \frac{\partial u_{m}}{\partial v_{n}}\end{array}\right]$$<ul><li>矩阵( $m \times n$阶矩阵)对标量的偏导数</li></ul>$$\frac{\partial \mathbf{U}}{\partial v}=\left[\begin{array}{cccc}   \frac{\partial U_{1,1}}{\partial v} & \frac{\partial U_{1,2}}{\partial v} & \cdots & \frac{\partial U_{1, n}}{\partial v} \\   \frac{\partial U_{2,1}}{\partial v} & \frac{\partial U_{2,2}}{\partial v} & \cdots & \frac{\partial U_{2, n}}{\partial v} \\   \vdots & \vdots & \ddots & \vdots \\   \frac{\partial U_{m, 1}}{\partial v} & \frac{\partial U_{m, 2}}{\partial v} & \cdots & \frac{\partial U_{m, n}}{\partial v}   \end{array}\right]$$<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/1_algebra.html">http://www.huaxiaozhuan.com/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/chapters/1_algebra.html</a></p></li><li><p><a href="https://blog.csdn.net/zaishuiyifangxym/article/details/81673491">https://blog.csdn.net/zaishuiyifangxym/article/details/81673491</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>linear_algebra</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>linear_algebra</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VS code 显示远程 Linux 图形界面</title>
    <link href="/2021/02/20/software/ide/vs_code-remote-gui/vs-code-remote-gui/"/>
    <url>/2021/02/20/software/ide/vs_code-remote-gui/vs-code-remote-gui/</url>
    
    <content type="html"><![CDATA[<blockquote><p>VS code 在远程登录服务器后无法直接像 pycharm 一样显示远程图像，对分析数据十分不便。本文记录vscode实现远程gui的方法。</p></blockquote><span id="more"></span><h3 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h3><ul><li>本地电脑系统：window10</li><li>远程服务器系统：Ubuntu16.04</li></ul><h3 id="基础工作"><a href="#基础工作" class="headerlink" title="基础工作"></a>基础工作</h3><blockquote><p>由于直接用vscode尝试远程界面显示不易调试（不要问我怎么知道的），先实现脱离vscode，使用shell的远程显示</p></blockquote><ul><li>shell的远程显示：<a href="https://www.zywvvd.com/2021/02/20/linux/remote-linux-gui/remote-linux-gui/">Windows Xming +Xshell 实现远程 linux gui 界面本地展示</a></li></ul><blockquote><p>接下来实现VScode远程调试，实现ssh key免密连接远程服务器</p></blockquote><ul><li>vscode远程连接linux主机：<a href="https://www.zywvvd.com/2020/11/02/software/ide/vs_code_remote_debugging/vs_code_remote_debugging/">VS code 远程调试配置</a></li></ul><h3 id="远程显示实现"><a href="#远程显示实现" class="headerlink" title="远程显示实现"></a>远程显示实现</h3><blockquote><p>使用VS code 插件 <a href="https://marketplace.visualstudio.com/items?itemName=spadin.remote-x11">Remote X11</a> </p><p>需要在后台开启 Xming Server</p></blockquote><ul><li>本地安装插件 Remote X11(SSH) （远程端不用安装）</li><li>打开VS code <code>文件</code> -&gt; <code>首选项</code> -&gt; <code>设置</code> -&gt; <code>remote x11</code></li><li>设置私钥位置、远程Host、远程端口号：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210220152108.png"></p><ul><li>设置 .vscode/launch.json，加入 env</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210220152919.png"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-comment">// 使用 IntelliSense 了解相关属性。 </span><br>    <span class="hljs-comment">// 悬停以查看现有属性的描述。</span><br>    <span class="hljs-comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span><br>    <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.2.0&quot;</span>,<br>    <span class="hljs-attr">&quot;configurations&quot;</span>: [<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Python: 当前文件&quot;</span>,<br>            <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;python&quot;</span>,<br>            <span class="hljs-attr">&quot;request&quot;</span>: <span class="hljs-string">&quot;launch&quot;</span>,<br>            <span class="hljs-attr">&quot;program&quot;</span>: <span class="hljs-string">&quot;$&#123;file&#125;&quot;</span>,<br>            <span class="hljs-attr">&quot;console&quot;</span>: <span class="hljs-string">&quot;integratedTerminal&quot;</span>,<br>            <span class="hljs-attr">&quot;justMyCode&quot;</span>: <span class="hljs-literal">false</span>,<br>            <span class="hljs-attr">&quot;env&quot;</span>: &#123;<br>                <span class="hljs-attr">&quot;DISPLAY&quot;</span>:<span class="hljs-string">&quot;10.0.2.19:0.0&quot;</span><br>            &#125;,<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>这样在该工程中就可以使用显示图像的命令显示远程的图像了。</li></ul><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ul><li>在VS code 终端输入命令：</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">DISPLAY</span>=本机IP:0.0<br>xclock<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/images_matrixtime/20210220094136.png"></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://blog.csdn.net/Dteam_f/article/details/109806294?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;dist_request_id=4df63aa8-dedc-4bc9-a1af-5a4e70f6924d&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">https://blog.csdn.net/Dteam_f/article/details/109806294?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;dist_request_id=4df63aa8-dedc-4bc9-a1af-5a4e70f6924d&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control</a></p></li><li><p><a href="https://blog.csdn.net/zb12138/article/details/107160825/">https://blog.csdn.net/zb12138/article/details/107160825/</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>VS code</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDE</tag>
      
      <tag>VS code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows Xming + Xshell 实现远程 linux gui 界面本地展示</title>
    <link href="/2021/02/20/linux/remote-linux-gui/remote-linux-gui/"/>
    <url>/2021/02/20/linux/remote-linux-gui/remote-linux-gui/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Windows 远程登录服务器后，由于是使用终端远程登录，并且远程服务器没有图形界面，显示图像很不方便。本文记录使用 Xming +Xshell 6 实现远程打开Linux界面的方法。</p></blockquote><span id="more"></span><h3 id="基本环境"><a href="#基本环境" class="headerlink" title="基本环境"></a>基本环境</h3><ul><li><p>本地电脑系统：window10</p></li><li><p>远程服务器系统：Ubuntu16.04</p></li></ul><h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><ul><li>服务器没有图形界面，但是相应显示的信息事实上是可以生成的，需要使用X11将该显示转发到其他可以显示的计算机，再由该计算机进行显示。</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210220094812.png"></p><ul><li>X 协议由 X server 和 X client 组成（这里X server对应本地电脑，X Client对应服务器）：<ul><li>X server 管理主机上与显示相关的硬件设置（如显卡、硬盘、鼠标等），它负责屏幕画面的绘制与显示，以及将输入设置（如键盘、鼠标）的动作告知 X client。</li><li>X client (即 X 应用程序) 则主要负责事件的处理（即程序的逻辑）。</li></ul></li></ul><blockquote><p>举个例子，如果用户点击了鼠标左键，因为鼠标归 X server 管理，于是 X server 就捕捉到了鼠标点击这个动作，然后它将这个动作告诉 X client，因为 X client 负责程序逻辑，于是 X client 就根据程序预先设定的逻辑（例如画一个圆），告诉 X server 说：“请在鼠标点击的位置，画一个圆”。最后，X server 就响应 X client 的请求，在鼠标点击的位置，绘制并显示出一个圆。</p></blockquote><h3 id="工具下载安装与配置"><a href="#工具下载安装与配置" class="headerlink" title="工具下载安装与配置"></a>工具下载安装与配置</h3><ul><li>Xming 可以去下载免费版：<a href="https://xming.en.softonic.com/download">https://xming.en.softonic.com/download</a></li><li>Xshell 6个人免费版：<a href="https://www.netsarang.com/download/free_license.html">https://www.netsarang.com/download/free_license.html</a></li></ul><h4 id="XMing安装"><a href="#XMing安装" class="headerlink" title="XMing安装"></a>XMing安装</h4><ul><li>–&gt; Mutiple windows </li></ul><blockquote><p>需要记住安装时的display number 为 0。</p></blockquote><ul><li><p>–&gt; Start no client </p></li><li><p> –&gt;Clipbard</p></li></ul><blockquote><p>建议勾选一个 <code>no access control</code>可能会方便一些</p></blockquote><ul><li> –&gt; 完成</li></ul><h4 id="XMing配置"><a href="#XMing配置" class="headerlink" title="XMing配置"></a>XMing配置</h4><blockquote><p>这时还要设置IP充许，如果不设IP充许，将会被Xming拒绝而打不开：首先打开Xming安装文件夹找到 X*.hosts 文件(*号为上面Display Number 数字），如本例就是找到X0.hosts文件，打开并在localhost下面一行，添加Linux服务器的IP地址。</p></blockquote><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">localhost<br><span class="hljs-number">192.168.10.2</span><br><span class="hljs-number">192.168.10.3</span><br><span class="hljs-number">192.168.10.4</span><br></code></pre></td></tr></table></figure><blockquote><p>此处填需要被远程登录的服务器地址。</p></blockquote><h4 id="Xshell-6-安装"><a href="#Xshell-6-安装" class="headerlink" title="Xshell 6 安装"></a>Xshell 6 安装</h4><blockquote><p>没啥可说的，装就完了。</p></blockquote><h4 id="Xshell-6-配置"><a href="#Xshell-6-配置" class="headerlink" title="Xshell 6 配置"></a>Xshell 6 配置</h4><ul><li>设置用户身份认证，账号密码、ssh key都可以的</li><li>再SSH –&gt; 隧道选项卡里设置<code>转发X11连接到</code>：<code>X DISPLAY</code>:</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">localhost</span>:<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><blockquote><p>此处的 0.0 可以设置为其他，记录下来和服务器端配置相当即可</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20210220093437.png"></p><h3 id="远程配置"><a href="#远程配置" class="headerlink" title="远程配置"></a>远程配置</h3><ul><li>X shell 登录远程服务器</li><li>设置DISPLAY：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export DISPLAY=本机IP地址：0.0 <br></code></pre></td></tr></table></figure><blockquote><p>本机IP为当前使用的计算机， 0.0 对应在X shell 中转发的 0.0</p></blockquote><ul><li>建议将该设置添加到 <code>~/.bashrc</code> 文件中</li></ul><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>此时可以用显示图形的应用测试是否配置成功，此处使用 xclock， xterm进行测试</p></blockquote><ul><li>安装 x11-apps</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get install x11-apps<br><span class="hljs-meta">#</span><span class="bash"> 或</span><br>yum install xorg-x11-apps*<br></code></pre></td></tr></table></figure><ul><li>运行</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">xclock</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/images_matrixtime/20210220094136.png"></p><ul><li>安装 xterm</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> install xterm<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/images_matrixtime/20210220094401.png"></p><ul><li>显示上述界面说明图形界面转发成功</li><li>如果报错可以尝试安装图形界再面试一下</li></ul><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">apt-get <span class="hljs-keyword">install </span>xserver-<span class="hljs-keyword">xorg </span>x11-xserver-utils<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://blog.csdn.net/akuoma/article/details/82182913">https://blog.csdn.net/akuoma/article/details/82182913</a></p></li><li><p><a href="https://blog.csdn.net/lmyclever/article/details/7422243">https://blog.csdn.net/lmyclever/article/details/7422243</a></p></li><li><p><a href="https://blog.csdn.net/Dteam_f/article/details/109806294?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;dist_request_id=4df63aa8-dedc-4bc9-a1af-5a4e70f6924d&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">https://blog.csdn.net/Dteam_f/article/details/109806294?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;dist_request_id=4df63aa8-dedc-4bc9-a1af-5a4e70f6924d&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jupyter notebook 启动错误  “sys/un.h” No such file or directory</title>
    <link href="/2021/02/20/python/jupyter-error/jupyter-error/"/>
    <url>/2021/02/20/python/jupyter-error/jupyter-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Jupyter notebook 启动错误  “sys/un.h” No such file or directory 的解决方案。</p></blockquote><span id="more"></span><h3 id="错误复现"><a href="#错误复现" class="headerlink" title="错误复现"></a>错误复现</h3><blockquote><p>在运行 <code>jupyter notebook</code>命令时，报错如下：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> jupyter notebook</span><br>_cffi_ext.c<br>E:\ProgramData\Anaconda3\lib\site-packages\zmq\backend\cffi\__pycache__\_cffi_ext.c(213): fatal error C1083: 无法打开包 括文件: “sys/un.h”: No such file or directory<br>Traceback (most recent call last):<br>  File &quot;E:\ProgramData\Anaconda3\Scripts\jupyter-notebook-script.py&quot;, line 6, in &lt;module&gt;<br>    from notebook.notebookapp import main<br>  File &quot;E:\ProgramData\Anaconda3\lib\site-packages\notebook\notebookapp.py&quot;, line 46, in &lt;module&gt;<br>    from zmq.eventloop import ioloop<br>  File &quot;E:\ProgramData\Anaconda3\lib\site-packages\zmq\__init__.py&quot;, line 47, in &lt;module&gt;<br>    from zmq import backend<br>  File &quot;E:\ProgramData\Anaconda3\lib\site-packages\zmq\backend\__init__.py&quot;, line 40, in &lt;module&gt;<br>    reraise(*exc_info)<br>  File &quot;E:\ProgramData\Anaconda3\lib\site-packages\zmq\utils\sixcerpt.py&quot;, line 34, in reraise<br>    raise value<br>  File &quot;E:\ProgramData\Anaconda3\lib\site-packages\zmq\backend\__init__.py&quot;, line 27, in &lt;module&gt;<br>    _ns = select_backend(first)<br>  File &quot;E:\ProgramData\Anaconda3\lib\site-packages\zmq\backend\select.py&quot;, line 27, in select_backend<br>    mod = __import__(name, fromlist=public_api)<br>  File &quot;E:\ProgramData\Anaconda3\lib\site-packages\zmq\backend\cython\__init__.py&quot;, line 6, in &lt;module&gt;<br>    from . import (constants, error, message, context,<br>ImportError: DLL load failed: 找不到指定的模块。<br></code></pre></td></tr></table></figure><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>卸载pyzmq</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">pip uninstall pyzmq</span><br></code></pre></td></tr></table></figure><ul><li>安装pyzmq</li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">pip install pyzmq <span class="hljs-comment">--user</span><br></code></pre></td></tr></table></figure><ul><li>重新启动 jupyter notebook</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">jupyter notebook</span><br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>安装 Cuda 10.2 报错</title>
    <link href="/2021/02/18/deep_learning/environment/cuda10.2-install-error/cuda10.2-install-error/"/>
    <url>/2021/02/18/deep_learning/environment/cuda10.2-install-error/cuda10.2-install-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录 [ERROR]: boost::filesystem::remove: Directory not empty 解决方案。</p></blockquote><span id="more"></span><h3 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h3><blockquote><p>安装cuda 10.2 时报错（错误在日志中 /var/log/cuda-installer.log）</p></blockquote><ul><li>[ERROR]: boost::filesystem::remove: Directory not empty: “/var/log/nvidia/.uninstallManifests/“</li></ul><blockquote><p>Cuda 包 ：</p></blockquote><ul><li>cuda_10.2.89_440.33.01_linux.run</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>安装时加上参数<code> --librarypath=/usr/local/cuda-10.2</code></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sh</span> cuda_<span class="hljs-number">10</span>.<span class="hljs-number">2</span>.<span class="hljs-number">89</span>_<span class="hljs-number">440</span>.<span class="hljs-number">33</span>.<span class="hljs-number">01</span>_linux.run --librarypath=/usr/local/cuda-<span class="hljs-number">10</span>.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h3 id="测试CUDA是否安装成功"><a href="#测试CUDA是否安装成功" class="headerlink" title="测试CUDA是否安装成功"></a>测试CUDA是否安装成功</h3><ul><li>修改 ~/.bashrc 文件</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">export PATH=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda-10.2/</span>bin<span class="hljs-variable">$&#123;PATH:+:$&#123;PATH&#125;</span>&#125;<br>export LD_LIBRARY_PATH=<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda-10.2/</span>lib64<span class="hljs-variable">$&#123;LD_LIBRARY_PATH:+:$&#123;LD_LIBRARY_PATH&#125;</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>更新环境变量配置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source ~/.bashrc<br></code></pre></td></tr></table></figure><ul><li>使用<code>nvcc -V</code>测试是否能检测到Cuda</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> nvcc -V</span><br><br>nvcc: NVIDIA (R) Cuda compiler driver<br>Copyright (c) 2005-2019 NVIDIA Corporation<br>Built on Wed_Oct_23_19:24:38_PDT_2019<br>Cuda compilation tools, release 10.2, V10.2.89<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://www.freesion.com/article/54731320387/">https://www.freesion.com/article/54731320387/</a></p></li><li><p><a href="https://tieba.baidu.com/p/6848132251">https://tieba.baidu.com/p/6848132251</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Error unsupported compiler 9.3.0</title>
    <link href="/2021/02/18/deep_learning/pytorch/unsupported-compiler/unsupported-compiler/"/>
    <url>/2021/02/18/deep_learning/pytorch/unsupported-compiler/unsupported-compiler/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录 Error: unsupported compiler: 9.3.0 解决方案。</p></blockquote><span id="more"></span><h3 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h3><blockquote><p>安装cuda 10.2 时报错</p></blockquote><ul><li>Error: unsupported compiler: 9.3.0</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo apt-get remove gcc gcc-<span class="hljs-number">9</span><br>sudo apt-get remove g++<br><br>sudo apt install gcc-<span class="hljs-number">8</span> g++-<span class="hljs-number">8</span><br><br>sudo ln -s <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/gcc-8 /u</span>sr<span class="hljs-regexp">/bin/g</span>cc<br>sudo ln -s <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/g++-8 /u</span>sr<span class="hljs-regexp">/bin/g</span>++<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nosql 基础概念</title>
    <link href="/2021/02/10/dataset/nosql/nosql/"/>
    <url>/2021/02/10/dataset/nosql/nosql/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍非关系型数据库的基本概念，及其与关系型数据库直接的关联。</p></blockquote><span id="more"></span><h3 id="Nosql"><a href="#Nosql" class="headerlink" title="Nosql"></a>Nosql</h3><blockquote><p>NoSQL(NoSQL = Not Only SQL )，意即”不仅仅是SQL”。</p></blockquote><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><blockquote><p>NoSQL 是一项全新的数据库革命性运动，早期就有人提出，发展至2009年趋势越发高涨。NoSQL的拥护者们提倡运用非关系型的数据存储，相对于铺天盖地的关系型数据库运用，这一概念无疑是一种全新的思维的注入。</p><p>指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。</p><p>NoSQL用于超大规模数据的存储。（例如谷歌或Facebook每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。。</p></blockquote><h4 id="RDBMS-vs-NoSQL"><a href="#RDBMS-vs-NoSQL" class="headerlink" title="RDBMS vs NoSQL"></a>RDBMS vs NoSQL</h4><p><strong>RDBMS</strong></p><ul><li>高度组织化结构化数据</li><li>结构化查询语言（SQL） (SQL)</li><li>数据和关系都存储在单独的表中。</li><li>数据操纵语言，数据定义语言</li><li>严格的一致性</li><li>基础事务</li></ul><p><strong>NoSQL</strong></p><ul><li>代表着不仅仅是SQL</li><li>没有声明性查询语言</li><li>没有预定义的模式键 - 值对存储，列存储，文档存储，图形数据库</li><li>最终一致性，而非ACID属性</li><li>非结构化和不可预知的数据</li><li>CAP定理</li><li>高性能，高可用性和可伸缩性</li></ul><h4 id="NoSQL的优点-缺点"><a href="#NoSQL的优点-缺点" class="headerlink" title="NoSQL的优点/缺点"></a>NoSQL的优点/缺点</h4><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><ul><li>高可扩展性</li><li>分布式计算</li><li>低成本</li><li>架构的灵活性，半结构化数据</li><li>没有复杂的关系</li></ul><h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ul><li>没有标准化</li><li>有限的查询功能（到目前为止）</li><li>最终一致是不直观的程序</li></ul><h3 id="ACID-vs-BASE"><a href="#ACID-vs-BASE" class="headerlink" title="ACID vs BASE"></a>ACID vs BASE</h3><table><thead><tr><th align="left">ACID</th><th align="left">BASE</th></tr></thead><tbody><tr><td align="left">原子性(<strong>A</strong>tomicity)</td><td align="left">基本可用(<strong>B</strong>asically <strong>A</strong>vailable)</td></tr><tr><td align="left">一致性(<strong>C</strong>onsistency)</td><td align="left">软状态/柔性事务(<strong>S</strong>oft state)</td></tr><tr><td align="left">隔离性(<strong>I</strong>solation)</td><td align="left">最终一致性 (<strong>E</strong>ventual consistency)</td></tr><tr><td align="left">持久性 (<strong>D</strong>urable)</td><td align="left"></td></tr></tbody></table><h3 id="NoSQL-数据库分类"><a href="#NoSQL-数据库分类" class="headerlink" title="NoSQL 数据库分类"></a>NoSQL 数据库分类</h3><table><thead><tr><th>类型</th><th>部分代表</th><th>特点</th></tr></thead><tbody><tr><td>列存储</td><td>Hbase<br />Cassandra<br />Hypertable</td><td>顾名思义，是按列存储数据的。最大的特点是方便存储结构化和半结构化数据，方便做数据压缩，对针对某一列或者某几列的查询有非常大的IO优势。</td></tr><tr><td>文档存储</td><td>MongoDB<br />CouchDB</td><td>文档存储一般用类似json的格式存储，存储的内容是文档型的。这样也就有有机会对某些字段建立索引，实现关系数据库的某些功能。</td></tr><tr><td>key-value存储</td><td>Tokyo Cabinet / Tyrant<br />Berkeley DB<br />MemcacheDB<br />Redis</td><td>可以通过key快速查询到其value。一般来说，存储不管value的格式，照单全收。（Redis包含了其他功能）</td></tr><tr><td>图存储</td><td>Neo4J<br />FlockDB</td><td>图形关系的最佳存储。使用传统关系数据库来解决的话性能低下，而且设计使用不方便。</td></tr><tr><td>对象存储</td><td>db4o<br />Versant</td><td>通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据。</td></tr><tr><td>xml数据库</td><td>Berkeley DB XML<br />BaseX</td><td>高效的存储XML数据，并支持XML的内部查询语法，比如XQuery,Xpath。</td></tr></tbody></table><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.w3cschool.cn/mongodb/nosql.html">https://www.w3cschool.cn/mongodb/nosql.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>dataset</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dataset</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDB 简易教程</title>
    <link href="/2021/02/10/dataset/mangodb/MongoDB/"/>
    <url>/2021/02/10/dataset/mangodb/MongoDB/</url>
    
    <content type="html"><![CDATA[<blockquote><p>MongoDB 是一个基于分布式文件存储的数据库。由 C++ 语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案，本文记录相关基础知识。</p></blockquote><span id="more"></span><h3 id="MongoDB-概述"><a href="#MongoDB-概述" class="headerlink" title="MongoDB 概述"></a>MongoDB 概述</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote><p>MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似json的bson格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。</p></blockquote><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul><li><p>它的特点是<strong>高性能</strong>、<strong>易部署</strong> 、<strong>易使用</strong> 。</p></li><li><p>主要功能特性有：</p><ul><li><p>面向集合存储，易存储对象类型的数据。</p></li><li><p>模式自由。</p></li><li><p>支持动态查询。</p></li><li><p>支持完全索引，包含内部对象。</p></li><li><p>支持查询。</p></li><li><p>支持复制和故障恢复。</p></li><li><p>使用高效的二进制数据存储，包括大型对象（如视频等）。</p></li><li><p>自动处理碎片，以支持云计算层次的扩展性</p></li><li><p>支持RUBY，PYTHON，JAVA，C++，PHP，C#等多种语言。</p></li><li><p>文件存储格式为BSON（一种JSON的扩展）。</p></li><li><p>可通过网络访问。</p></li></ul></li></ul><h4 id="使用原理"><a href="#使用原理" class="headerlink" title="使用原理"></a>使用原理</h4><ul><li>面向集合（Collection-Oriented）<ul><li>数据被分组存储在数据集中，被称为一个集合（Collection)。每个集合在数据库中都有一个唯一的标识名，并且可以包含无限数目的文档。集合的概念类似关系型数据库（RDBMS）里的表（table），不同的是它不需要定义任何模式（schema)。Nytro MegaRAID技术中的闪存高速缓存算法，能够快速识别数据库内大数据集中的热数据，提供一致的性能改进。</li></ul></li><li>模式自由（schema-free)<ul><li>对于存储在mongodb数据库中的文件，我们不需要知道它的任何结构定义。如果需要的话，你完全可以把不同结构的文件存储在同一个数据库里。存储在集合中的文档，被存储为键-值对的形式。键用于唯一标识一个文档，为字符串类型，而值则可以是各种复杂的文件类型。我们称这种存储形式为BSON（Binary Serialized Document Format）。</li></ul></li></ul><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul><li>MongoDB 的主要目标是在键/值存储方式（提供了高性能和高度伸缩性）和传统的RDBMS 系统（具有丰富的功能）之间架起一座桥梁，它集两者的优势于一身。</li></ul><h5 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h5><p>网站数据：Mongo 非常适合实时的插入，更新与查询，并具备网站实时数据存储所需的复制及高度伸缩性。</p><ul><li><p>缓存：由于性能很高，Mongo 也适合作为信息基础设施的缓存层。在系统重启之后，由Mongo 搭建的持久化缓存层可以避免下层的数据源过载。</p></li><li><p>大尺寸、低价值的数据：使用传统的关系型数据库存储一些数据时可能会比较昂贵，在此之前，很多时候程序员往往会选择传统的文件进行存储。</p></li><li><p>高伸缩性的场景：Mongo 非常适合由数十或数百台服务器组成的数据库，Mongo 的路线图中已经包含对MapReduce 引擎的内置支持。</p></li><li><p>用于对象及JSON 数据的存储：Mongo 的BSON 数据格式非常适合文档化格式的存储及查询。</p></li></ul><h5 id="不适用场景"><a href="#不适用场景" class="headerlink" title="不适用场景"></a>不适用场景</h5><ul><li><p>高度事务性的系统：例如，银行或会计系统。传统的关系型数据库目前还是更适用于需要大量原子性复杂事务的应用程序。</p></li><li><p>传统的商业智能应用：针对特定问题的BI 数据库会产生高度优化的查询方式。对于此类应用，数据仓库可能是更合适的选择。</p></li><li><p>需要SQL 的复杂的跨文档（表）级联查询问题。</p></li></ul><h4 id="教程链接"><a href="#教程链接" class="headerlink" title="教程链接"></a>教程链接</h4><ul><li><p>官网链接: <a href="https://www.mongodb.com/">https://www.mongodb.com/</a></p></li><li><p>参考教程: <a href="https://www.w3cschool.cn/mongodb/">https://www.w3cschool.cn/mongodb/</a></p></li><li><p>The Little MongoDB Book 中文版: <a href="https://www.w3cschool.cn/kdxuu8/">https://www.w3cschool.cn/kdxuu8/</a></p></li><li><p>MongoDB官方文档: <a href="https://docs.mongodb.com/">https://docs.mongodb.com/</a></p></li><li><p>MongoDB下载: <a href="https://docs.mongodb.com/">https://docs.mongodb.com/</a></p></li></ul><h3 id="MongoDB-安装"><a href="#MongoDB-安装" class="headerlink" title="MongoDB 安装"></a>MongoDB 安装</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><ul><li><p>MongoDB 提供了可用于 32 位和 64 位系统的预编译二进制包，选择Windows相应的版本即可，你可以从 MongoDB 官网下载安装，MongoDB 预编译二进制包下载地址：<a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a></p></li><li><p>下载zip包后，解压安装包，并安装它。</p></li><li><p>强烈建议 <strong>安装选项 “install mongoDB compass” 不勾选</strong>（当然你也可以选择安装它，可能需要更久的安装时间）</p><blockquote><p>MongoDB Compass 是一个图形界面管理工具，我们可以在后面自己到官网下载安装，下载地址：<a href="https://www.mongodb.com/download-center/compass%E3%80%82">https://www.mongodb.com/download-center/compass。</a></p></blockquote></li></ul><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><ul><li>MongoDB 提供了可用于 32 位和 64 位系统的预编译二进制包，选择你使用的Linux系统相应的版本即可，你可以从 MongoDB 官网下载安装，MongoDB 预编译二进制包下载地址：<a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a></li><li>这里我们选择 tgz 下载，下载完安装包，并解压 <strong>tgz</strong>（以下演示的是 64 位 Linux上的安装） 。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-ubuntu1604-4.2.8.tgz        # 下载<br>tar -zxvf mongodb-linux-x86_64-ubuntu1604-4.2.8.tgz                                    # 解压<br>mv mongodb-src-r4.2.8  /usr/local/mongodb4 <br></code></pre></td></tr></table></figure><h4 id="运行-MongoDB-服务"><a href="#运行-MongoDB-服务" class="headerlink" title="运行 MongoDB 服务"></a>运行 MongoDB 服务</h4><blockquote><p>你可以再命令行中执行mongo安装目录中的bin目录执行mongod命令来启动mongdb服务。</p></blockquote><h4 id="MongoDB后台管理-Shell"><a href="#MongoDB后台管理-Shell" class="headerlink" title="MongoDB后台管理 Shell"></a>MongoDB后台管理 Shell</h4><blockquote><p>MongoDB Shell是MongoDB自带的交互式Javascript shell,用来对MongoDB进行操作和管理的交互式环境。</p></blockquote><ul><li>如果你需要进入MongoDB后台管理，你需要先打开mongodb装目录的下的bin目录，然后执行mongo命令文件。</li></ul><blockquote><p>此处我执行了<code>db.version()</code>命令，你也可以用这个命令判断shell是否正常运行。</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20210210172541.png"></p><ul><li>由于它是一个JavaScript shell，您可以运行一些简单的算术运算:</li></ul><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">5 </span>* <span class="hljs-number">5</span><br><span class="hljs-number">25</span><br><span class="hljs-symbol">25 </span>+ <span class="hljs-number">3</span><br><span class="hljs-number">28</span><br></code></pre></td></tr></table></figure><ul><li>现在的版本默认将数据存储在<code>bin</code>同级目录<code>data</code>中，可以尝试新建数据条目（默认数据库为<code>test</code>）：</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mongo">db.vvd.insert(&#123;x:10&#125;)<br>WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)<br>db.vvd.find()<br>&#123; &quot;_id&quot; : ObjectId(&quot;6023a73a728a5e21792ad6c8&quot;), &quot;x&quot; : 10 &#125;<br></code></pre></td></tr></table></figure><blockquote><p>该命令将数据 <code>10</code> 插入到<code>test</code>数据库的<code>vvd</code>集合的<code>x</code>字段里。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>dataset</category>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dataset</tag>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VS code 停用 justMyCode 调试库代码</title>
    <link href="/2021/02/08/software/ide/vs_code_justmycode/justmycode/"/>
    <url>/2021/02/08/software/ide/vs_code_justmycode/justmycode/</url>
    
    <content type="html"><![CDATA[<blockquote><p>VS code 调试时默认启用 <code>justMyCode</code> 配置，使得库代码无法调试，本文记录停用该选项调试一切代码的方法。</p></blockquote><span id="more"></span><h3 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h3><p>在调试非自己的代码时会自动跳过并给出如下提示：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Frame skipped <span class="hljs-keyword">from</span> debugging during step-<span class="hljs-keyword">in</span>.<br>Note: may have been skipped because <span class="hljs-keyword">of</span> &quot;justMyCode&quot; <span class="hljs-keyword">option</span> (default == <span class="hljs-keyword">true</span>). Try setting &quot;justMyCode&quot;: <span class="hljs-keyword">false</span> <span class="hljs-keyword">in</span> the <span class="hljs-keyword">debug</span> <span class="hljs-keyword">configuration</span> (e.g., launch.json).<br></code></pre></td></tr></table></figure><h3 id="修改-launch-json"><a href="#修改-launch-json" class="headerlink" title="修改 launch.json"></a>修改 launch.json</h3><blockquote><p>新建 <code>launch.json</code> 文件，在配置<code>configurations</code>中加入 <code>&quot;justMyCode&quot;: false,</code>一行：</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-comment">// 使用 IntelliSense 了解相关属性。 </span><br>    <span class="hljs-comment">// 悬停以查看现有属性的描述。</span><br>    <span class="hljs-comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span><br>    <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.2.0&quot;</span>,<br>    <span class="hljs-attr">&quot;configurations&quot;</span>: [<br>        &#123;<br>            <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;Python: 当前文件&quot;</span>,<br>            <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;python&quot;</span>,<br>            <span class="hljs-attr">&quot;request&quot;</span>: <span class="hljs-string">&quot;launch&quot;</span>,<br>            <span class="hljs-attr">&quot;program&quot;</span>: <span class="hljs-string">&quot;$&#123;file&#125;&quot;</span>,<br>            <span class="hljs-attr">&quot;console&quot;</span>: <span class="hljs-string">&quot;integratedTerminal&quot;</span>,<br>            <span class="hljs-attr">&quot;justMyCode&quot;</span>: <span class="hljs-literal">false</span>,<br>        &#125;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>“justMyCode”: false</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>VS code</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDE</tag>
      
      <tag>VS code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用 Python Socket 包搭建简易服务器</title>
    <link href="/2021/01/30/web/socket_server/socket-server/"/>
    <url>/2021/01/30/web/socket_server/socket-server/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录使用Python Socket包搭建简易服务器的代码。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p>平时访问网站底层大多是socket封装的http请求，都是基于tcp-ip协议进行通信的；角色分为服务器端和客户端。</p></blockquote><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-comment"># ipv4  # tcp-ip</span><br>    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># 监听本机 8000 端口</span><br>    sock.bind((<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-number">8000</span>))<br>    <span class="hljs-comment"># 最多同时5个链接</span><br>    sock.listen(<span class="hljs-number">5</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;start listening! &#x27;</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># 接受请求</span><br>        conn, addr = sock.accept()<br>        <span class="hljs-comment"># 获取数据</span><br>        data = conn.recv(<span class="hljs-number">1024</span>)<br>        <span class="hljs-built_in">print</span>(data)<br>        <span class="hljs-comment"># 返回网页显示内容</span><br>        conn.send(<span class="hljs-string">b&quot;HTTP/1.1 200 OK\r\nContent-Type:text/html; charset=utf-8\r\n\r\n&quot;</span>)<br>        conn.send(<span class="hljs-string">&quot;&lt;h2&gt;测试数据&lt;/h2&gt;&quot;</span>.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>        <span class="hljs-comment"># 关闭链接</span><br>        conn.close()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul><li>运行程序后，在浏览器访问 <code>localhost:8000</code>即可进入代码中的 while 循环内，收到返回并在浏览器显示</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20210130003002.png"></p><ul><li>同时终端收到信息打印出来：</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">start</span> listening!<br><span class="hljs-attribute">b</span>&#x27;GET / HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span>\r\nHost: localhost:<span class="hljs-number">8000</span>\r\nConnection: keep-alive\r\nCache-Control: max-age=<span class="hljs-number">0</span>\r\nUpgrade-Insecure-Requests: <span class="hljs-number">1</span>\r\nUser-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">87</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4280</span>.<span class="hljs-number">141</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span>\r\nAccept: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b<span class="hljs-number">3</span>;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>\r\nSec-Fetch-Site: none\r\nSec-Fetch-Mode: navigate\r\nSec-Fetch-User: ?<span class="hljs-number">1</span>\r\nSec-Fetch-Dest: document\r\nAccept-Encoding: gzip, deflate, br\r\nAccept-Language: zh,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,zh-TW;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,zh-CN;q=<span class="hljs-number">0</span>.<span class="hljs-number">6</span>\r\n\r\n&#x27;<br><span class="hljs-attribute">b</span>&#x27;GET /favicon.ico HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span>\r\nHost: localhost:<span class="hljs-number">8000</span>\r\nConnection: keep-alive\r\nPragma: no-cache\r\nCache-Control: no-cache\r\nUser-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">87</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4280</span>.<span class="hljs-number">141</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span>\r\nAccept: image/avif,image/webp,image/apng,image/*,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>\r\nSec-Fetch-Site: same-origin\r\nSec-Fetch-Mode: no-cors\r\nSec-Fetch-Dest: image\r\nReferer: http://localhost:<span class="hljs-number">8000</span>/\r\nAccept-Encoding: gzip, deflate, br\r\nAccept-Language: zh,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,zh-TW;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,zh-CN;q=<span class="hljs-number">0</span>.<span class="hljs-number">6</span>\r\n\r\n&#x27;<br><span class="hljs-attribute">b</span>&#x27;&#x27;<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>第一个 Django 工程搭建</title>
    <link href="/2021/01/23/web/back_end/django/django-first-porject/django-first-porject/"/>
    <url>/2021/01/23/web/back_end/django/django-first-porject/django-first-porject/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Django是当前最出色基于Python的Web应用开发平台之一，本文对其进行简要介绍并创建一个空的Django工程。</p></blockquote><span id="more"></span><h3 id="前后端"><a href="#前后端" class="headerlink" title="前后端"></a>前后端</h3><ul><li>Web开发的目的可以说是为用户提供一个可以获取信息或交互的服务场景，这其中涉及到几个重要的模块：显示模块、业务处理模块和数据存储模块。</li></ul><pre class="mermaid">graph TB    A(浏览器)    subgraph 服务器        B[解析请求]        C[生成html页面]        D[业务处理]    end    E(数据库)    D-->C -- 显示 --> A -- 交互 --> B-->D--数据交互-.-E</pre><ul><li>大框架就是用户向服务器提出服务请求，服务器接收请求从数据库中提取数据，送入处理模块处理后得到用户需要的内容，再经过显示模块将内容展现在用户面前。</li><li>这个过程中，当前把数据处理、业务处理的部分称为后端，向用户展示内容与设计和用户、后端的交互逻辑的部分称为前端。</li><li>为了解耦业务处理与界面显示，经过前辈多年开发经历，当前最佳实践为前后端分离，使得前端人员和后端人员约定好接口进行交互，之后前端只需要把界面做好，后端只需要做好业务逻辑处理。</li></ul><h3 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><blockquote><p>Django 是一个开放源代码的 Web 应用框架，由 Python 写成，其主要目的是简便、快速的开发数据库驱动的网站。它强调代码复用，多个组件可以很方便的以“插件”形式服务于整个框架，Django有许多功能强大的第三方插件，你甚至可以很方便的开发出自己的工具包。</p></blockquote><ul><li>项目源码：<a href="https://github.com/django/django">https://github.com/django/django</a></li><li>官网：<a href="https://www.djangoproject.com/">https://www.djangoproject.com/</a></li><li>Django中文网：<a href="https://www.django.cn/">https://www.django.cn/</a></li></ul><h4 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h4><blockquote><p>Django 开发组无比勤奋，版本计划很紧凑，迭代很频繁</p></blockquote><table><thead><tr><th>Release Series</th><th>Latest Release</th><th>End of mainstream support<a href="https://www.djangoproject.com/download/#ft1">1</a></th><th>End of extended support<a href="https://www.djangoproject.com/download/#ft2">2</a></th></tr></thead><tbody><tr><td>4.2 LTS</td><td>April 2023</td><td>December 2023</td><td>April 2026</td></tr><tr><td>4.1</td><td>August 2022</td><td>April 2023</td><td>December 2023</td></tr><tr><td>4.0</td><td>December 2021</td><td>August 2022</td><td>April 2023</td></tr><tr><td>3.2 LTS</td><td>April 2021</td><td>December 2021</td><td>April 2024</td></tr><tr><td>3.1</td><td>3.1.5</td><td>April 2021</td><td>December 2021</td></tr><tr><td>3.0</td><td>3.0.11</td><td>August, 2020</td><td>April, 2021</td></tr><tr><td>2.2 LTS</td><td>2.2.17</td><td>December 2, 2019</td><td>April 2022</td></tr><tr><td>2.1</td><td>2.1.15</td><td>April 1, 2019</td><td>December 2, 2019</td></tr><tr><td>2.0</td><td>2.0.13</td><td>August 1, 2018</td><td>April 1, 2019</td></tr><tr><td>1.11 LTS <a href="https://www.djangoproject.com/download/#ft3">3</a></td><td>1.11.29</td><td>December 2, 2017</td><td>April 1, 2020</td></tr><tr><td>1.10</td><td>1.10.8</td><td>April 4, 2017</td><td>December 2, 2017</td></tr><tr><td>1.9</td><td>1.9.13</td><td>August 1, 2016</td><td>April 4, 2017</td></tr><tr><td>1.8 LTS</td><td>1.8.19</td><td>December 1, 2015</td><td>April 1, 2018</td></tr><tr><td>1.7</td><td>1.7.11</td><td>April 1, 2015</td><td>December 1, 2015</td></tr><tr><td>1.6</td><td>1.6.11</td><td>September 2, 2014</td><td>April 1, 2015</td></tr><tr><td>1.5</td><td>1.5.12</td><td>November 6, 2013</td><td>September 2, 2014</td></tr><tr><td>1.4 LTS</td><td>1.4.22</td><td>February 26, 2013</td><td>October 1, 2015</td></tr><tr><td>1.3</td><td>1.3.7</td><td>March 23, 2012</td><td>February 26, 2013</td></tr></tbody></table><p><img src="https://photos.zywvvd.com/icey-mate-book/20210123141536.png"></p><ul><li>Django基于Python开发，并且基于Python环境运行，不同Django版本对Python版本有不同的需求：</li></ul><table><thead><tr><th align="left">Django 版本</th><th align="left">Python 版本</th></tr></thead><tbody><tr><td align="left">1.8</td><td align="left">2.7, 3.2 (until the end of 2016), 3.3, 3.4, 3.5</td></tr><tr><td align="left">1.9, 1.10</td><td align="left">2.7, 3.4, 3.5</td></tr><tr><td align="left">1.11</td><td align="left">2.7，3.4，3.5，3.6，3.7 (1.11.17添加)</td></tr><tr><td align="left">2.0</td><td align="left">3.4，3.5，3.6，3.7</td></tr><tr><td align="left">2.1，2.2</td><td align="left">3.5, 3.6, 3.7</td></tr><tr><td align="left">3.0</td><td align="left">3.6, 3.7, 3.8</td></tr><tr><td align="left">3.1</td><td align="left">3.6, 3.7, 3.8 or later</td></tr></tbody></table><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><ul><li>确定自己需要的Django版本，当前（2021年1月23日）最新的Django版本为3.1.5，我的python版本3.8.3</li><li>使用pip安装：</li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> Django<br></code></pre></td></tr></table></figure><blockquote><p>此时pip默认按装的是3.0.5版本</p></blockquote><ul><li>如果需要最新版本可以指定：</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pip</span> install Django==<span class="hljs-number">3</span>.<span class="hljs-number">1</span>.<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><ul><li>安装官网：<a href="https://www.djangoproject.com/download/">https://www.djangoproject.com/download/</a></li><li>安装后可以使用 <code>pip show</code>命令查看包信息：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip show django<br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">Name: Django</span><br>Version: 3.0.5<br>Summary: A high-level Python Web framework that encourages rapid development and clean, pragmatic design.<br>Home-page: https://www.djangoproject.com/<br>Author: Django Software Foundation<br>Author-email: foundation@djangoproject.com<br>License: BSD<br>Location: d:\program_files\anaconda3\lib\site-packages<br>Requires: pytz, asgiref, sqlparse<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">python -m django --version<br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">3.0.5</span><br></code></pre></td></tr></table></figure><h3 id="项目创建"><a href="#项目创建" class="headerlink" title="项目创建"></a>项目创建</h3><ul><li>找好一个存放Django工程的文件夹，在此处打开终端，键入命令：</li></ul><blockquote><p>假设我们想要创建名为 <code>vvd_django</code> 的工程：</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">django-admin startproject vvd_django</span><br></code></pre></td></tr></table></figure><ul><li>当前项目的目录结构：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">tree /F  # windows<br>tree -a  # Linux<br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">└─vvd_django</span><br>    │  manage.py<br>    └─vvd_django<br>            asgi.py<br>            settings.py<br>            urls.py<br>            wsgi.py<br>            __init__.py<br></code></pre></td></tr></table></figure><ul><li>这些目录和文件的用处是：<ul><li>最外层的 <code>vvd_django/</code> 根目录只是你项目的容器， 根目录名称对Django没有影响，你可以将它重命名为任何你喜欢的名称。</li><li><code>manage.py</code>: 一个让你用各种方式管理 Django 项目的命令行工具。你可以阅读 <a href="https://docs.djangoproject.com/zh-hans/3.0/ref/django-admin/">django-admin and manage.py</a> 获取所有 <code>manage.py</code> 的细节。</li><li>里面一层的 <code>vvd_django/</code> 目录包含你的项目，它是一个纯 Python 包。它的名字就是当你引用它内部任何东西时需要用到的 Python 包名。 (比如 <code>vvd_django.urls</code>).</li><li><code>vvd_django/__init__.py</code>：一个空文件，告诉 Python 这个目录应该被认为是一个 Python 包。如果你是 Python 初学者，阅读官方文档中的 <a href="https://docs.python.org/3/tutorial/modules.html#tut-packages">更多关于包的知识</a>。</li><li><code>vvd_django/settings.py</code>：Django 项目的配置文件。如果你想知道这个文件是如何工作的，请查看 <a href="https://docs.djangoproject.com/zh-hans/3.0/topics/settings/">Django 配置</a> 了解细节。</li><li><code>vvd_django/urls.py</code>：Django 项目的 URL 声明，就像你网站的“目录”。阅读 <a href="https://docs.djangoproject.com/zh-hans/3.0/topics/http/urls/">URL调度器</a> 文档来获取更多关于 URL 的内容。</li><li><code>vvd_django/asgi.py</code>：作为你的项目的运行在 ASGI 兼容的Web服务器上的入口。阅读 <a href="https://docs.djangoproject.com/zh-hans/3.0/howto/deployment/wsgi/">如何使用 WSGI 进行部署</a> 了解更多细节。</li><li><code>vvd_django/wsgi.py</code>：作为你的项目的运行在 WSGI 兼容的Web服务器上的入口。阅读 <a href="https://docs.djangoproject.com/zh-hans/3.0/howto/deployment/wsgi/">如何使用 WSGI 进行部署</a> 了解更多细节。</li><li>同步数据库文件：</li></ul></li></ul><blockquote><p>Django默认数据库为db.sqlite3</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd vvd_django<br>python manage.py migrate<br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">Operations to perform:</span><br>  Apply all migrations: admin, auth, contenttypes, sessions<br>Running migrations:<br>  Applying contenttypes.0001_initial... OK<br>  Applying auth.0001_initial... OK<br>  Applying admin.0001_initial... OK<br>  Applying admin.0002_logentry_remove_auto_add... OK<br>  Applying admin.0003_logentry_add_action_flag_choices... OK<br>  Applying contenttypes.0002_remove_content_type_name... OK<br>  Applying auth.0002_alter_permission_name_max_length... OK<br>  Applying auth.0003_alter_user_email_max_length... OK<br>  Applying auth.0004_alter_user_username_opts... OK<br>  Applying auth.0005_alter_user_last_login_null... OK<br>  Applying auth.0006_require_contenttypes_0002... OK<br>  Applying auth.0007_alter_validators_add_error_messages... OK<br>  Applying auth.0008_alter_user_username_max_length... OK<br>  Applying auth.0009_alter_user_last_name_max_length... OK<br>  Applying auth.0010_alter_group_name_max_length... OK<br>  Applying auth.0011_update_proxy_permissions... OK<br>  Applying sessions.0001_initial... OK<br></code></pre></td></tr></table></figure><ul><li>启动Django Server ，检查我们当前的项目状态：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">python manage.py runserver<br><span class="hljs-meta"></span><br><span class="hljs-meta">--&gt;</span><span class="bash"></span><br><span class="bash">Watching <span class="hljs-keyword">for</span> file changes with StatReloader</span><br>Performing system checks...<br><br>System check identified no issues (0 silenced).<br>January 23, 2021 - 15:42:03<br>Django version 3.0.5, using settings &#x27;vvd_django.settings&#x27;<br>Starting development server at http://127.0.0.1:8000/<br>Quit the server with CTRL-BREAK.<br></code></pre></td></tr></table></figure><ul><li>此时我们使用浏览器访问  <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a></li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20210123154326.png"></p><blockquote><p>出现小火箭说明我们的第一个Django工程正常运作。</p></blockquote><h3 id="编写第一个视图"><a href="#编写第一个视图" class="headerlink" title="编写第一个视图"></a>编写第一个视图</h3><h4 id="新建应用"><a href="#新建应用" class="headerlink" title="新建应用"></a>新建应用</h4><ul><li>在工程根目录终端运行：</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> startapp hello_world<br></code></pre></td></tr></table></figure><ul><li>当前项目文件结构</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus">│  db<span class="hljs-selector-class">.sqlite3</span><br>│  manage<span class="hljs-selector-class">.py</span><br>├─hello_world<br>│  │  admin<span class="hljs-selector-class">.py</span><br>│  │  apps<span class="hljs-selector-class">.py</span><br>│  │  models<span class="hljs-selector-class">.py</span><br>│  │  tests<span class="hljs-selector-class">.py</span><br>│  │  views<span class="hljs-selector-class">.py</span><br>│  │  __init__<span class="hljs-selector-class">.py</span><br>│  └─migrations<br>│          __init__<span class="hljs-selector-class">.py</span><br>└─vvd_django<br>    │  asgi<span class="hljs-selector-class">.py</span><br>    │  settings<span class="hljs-selector-class">.py</span><br>    │  urls<span class="hljs-selector-class">.py</span><br>    │  wsgi<span class="hljs-selector-class">.py</span><br>    └─ __init__.py<br></code></pre></td></tr></table></figure><h4 id="新建视图"><a href="#新建视图" class="headerlink" title="新建视图"></a>新建视图</h4><blockquote><p>打开 <code>hello_world/views.py</code>，把下面这些 Python 代码输入进去：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><span class="hljs-comment"># Create your views here.</span><br><span class="hljs-keyword">from</span> django.http <span class="hljs-keyword">import</span> HttpResponse<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-keyword">return</span> HttpResponse(<span class="hljs-string">&quot;Hello, world. You&#x27;re at the vvd hello_world index.&quot;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>这是 Django 中最简单的视图。如果想看见效果，我们需要将一个 URL 映射到它</p></blockquote><h4 id="应用url映射"><a href="#应用url映射" class="headerlink" title="应用url映射"></a>应用url映射</h4><ul><li>在 <code>hello_world</code>目录里新建一个 <code>urls.py</code> 文件，并输入代码：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path<br><br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> views<br><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, views.index, name=<span class="hljs-string">&#x27;index&#x27;</span>),<br>]<br></code></pre></td></tr></table></figure><h4 id="根url映射"><a href="#根url映射" class="headerlink" title="根url映射"></a>根url映射</h4><ul><li>在根 URLconf 文件中指定我们创建的 <code>hello_world.urls</code> 模块。在 <code>vvd_django/urls.py</code> 文件的 <code>urlpatterns</code> 列表里插入一个 <code>include()</code>， 如下：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin<br><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> include, path<br><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;hello_world/&#x27;</span>, include(<span class="hljs-string">&#x27;hello_world.urls&#x27;</span>)),<br>    path(<span class="hljs-string">&#x27;admin/&#x27;</span>, admin.site.urls),<br>]<br><br></code></pre></td></tr></table></figure><blockquote><p>函数 <a href="https://docs.djangoproject.com/zh-hans/3.0/ref/urls/#django.urls.include"><code>include()</code></a> 允许引用其它 URLconfs,  它的理念是使其可以即插即用。每当 Django 遇到 <a href="https://docs.djangoproject.com/zh-hans/3.0/ref/urls/#django.urls.include"><code>include()</code></a> 时，它会截断与此项匹配的 URL 的部分，并将剩余的字符串发送到 URLconf 以供进一步处理。他们能够被放在任何路径下，使得应用都能够正常工作。</p></blockquote><h4 id="运行服务"><a href="#运行服务" class="headerlink" title="运行服务"></a>运行服务</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> manage.<span class="hljs-keyword">py</span> runserver<br></code></pre></td></tr></table></figure><h4 id="访问应用"><a href="#访问应用" class="headerlink" title="访问应用"></a>访问应用</h4><ul><li>此时我们访问我们建立的 <code>serever/hello_world</code>链接——<a href="http://localhost:8000/hello_world/">http://localhost:8000/hello_world/</a></li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20210123170625.png"></p><ul><li>表明我们的应用被成功调用</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://github.com/django/django">https://github.com/django/django</a></li><li><a href="https://www.djangoproject.com/">https://www.djangoproject.com/</a></li><li><a href="https://www.django.cn/">https://www.django.cn/</a></li><li><a href="https://docs.djangoproject.com/zh-hans/3.0/intro/tutorial01/">https://docs.djangoproject.com/zh-hans/3.0/intro/tutorial01/</a></li><li><a href="https://blog.csdn.net/weixin_41666747/article/details/104026496">https://blog.csdn.net/weixin_41666747/article/details/104026496</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>back end</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>back end</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 配置 Linux nfs 磁盘读写权限</title>
    <link href="/2021/01/18/windows/linux_nfs_root/win-add-startup/"/>
    <url>/2021/01/18/windows/linux_nfs_root/win-add-startup/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Windows 挂载Linux磁盘时默认设置可能没有对磁盘的写权限，本文记录在Windows使用root用户登录nfs的方法。</p></blockquote><span id="more"></span><h3 id="在注册表中添加匿名用户的默认UID和GID"><a href="#在注册表中添加匿名用户的默认UID和GID" class="headerlink" title="在注册表中添加匿名用户的默认UID和GID"></a>在注册表中添加匿名用户的默认UID和GID</h3><h4 id="打开注册表编辑器"><a href="#打开注册表编辑器" class="headerlink" title="打开注册表编辑器"></a>打开注册表编辑器</h4><ul><li><p>按下 <code>win + R</code> 调出运行命令，在运行中输入 <code>regedit</code></p></li><li><p>找到键值：<code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ClientForNFS\CurrentVersion\Default</code></p></li></ul><h4 id="添加键值"><a href="#添加键值" class="headerlink" title="添加键值"></a>添加键值</h4><ul><li><p>添加 <code>QWORD</code> 键值</p></li><li><p><code>AnonymousGid </code> 和 <code>AnonymousUid</code></p></li><li><p>数值不用设置，默认即可</p></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20210118210624.png"></p><ul><li>重启计算机</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSH 命令介绍</title>
    <link href="/2021/01/15/linux/ssh/ssh-usage/ssh-usage/"/>
    <url>/2021/01/15/linux/ssh/ssh-usage/ssh-usage/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ssh命令多用于登录和文件传输，安全可靠，本文记录ssh命令用法。</p></blockquote><span id="more"></span><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote><p> SSH(远程连接工具)连接原理：ssh服务是一个守护进程(demon)，系统后台监听客户端的连接，ssh服务端的进程名为sshd,负责实时监听客户端的请求(IP 22端口)，包括公共秘钥等交换等信息。</p></blockquote><ul><li><p>SSH服务端由2部分组成： </p><ul><li><strong>openssh(提供ssh服务)</strong> </li><li> <strong>openssl(提供加密的程序)</strong></li></ul></li><li><p>SSH是安全的加密协议，用于远程连接Linux服务器        </p></li><li><p>SSH的默认端口是22，安全协议版本是SSH2</p></li><li><p>SSH服务器端主要包含2个服务功能SSH连接和SFTP服务器</p></li><li><p>SSH客户端包含ssh连接命令和远程拷贝scp命令等 </p></li></ul><h3 id="工作机制"><a href="#工作机制" class="headerlink" title="工作机制"></a>工作机制</h3><ul><li>服务器启动的时候自己产生一个密钥(768bit公钥)</li><li>本地的ssh客户端发送连接请求到ssh服务器</li><li>服务器检查连接点客户端发送的数据和IP地址，确认合法后发送密钥(768bits)给客户端</li><li>此时客户端将本地私钥(256bit)和服务器的公钥(768bit)结合成密钥对key(1024bit),发回给服务器端</li><li>建立连接通过key-pair数据传输。</li></ul><h3 id="加密技术"><a href="#加密技术" class="headerlink" title="加密技术"></a>加密技术</h3><ul><li>加密技术：传输过程，数据加密。      <ul><li>SSH1没有对客户端的秘钥进行校验，很容易被植入恶意代码</li><li>SSH2增加了一个确认联机正确性的Diffe_Hellman机制，每次数据的传输，Server都会检查数据来源的正确性，避免黑客入侵。          </li></ul></li><li> SSH2支持RSA和DSA密钥  </li><li>DSA(digital signature Algorithm):  数字签名</li><li>RSA: 既可以数字签名又可以加密</li></ul><h3 id="命令参数"><a href="#命令参数" class="headerlink" title="命令参数"></a>命令参数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh        [-1246AaCfgKkMNnqsTtVvXxYy] [-b bind_address] [-c cipher_spec]<br>           [-D [bind_address:]port] [-e escape_char] [-F configfile]<br>           [-i identity_file] [-L [bind_address:]port:host:hostport]<br>           [-l login_name] [-m mac_spec] [-O ctl_cmd] [-o option] [-p port]<br>           [-R [bind_address:]port:host:hostport] [-S ctl_path]<br>           [-W host:port] [-w local_tun[:remote_tun]]<br>           [user@]hostname [command]<br></code></pre></td></tr></table></figure><h3 id="功能用法"><a href="#功能用法" class="headerlink" title="功能用法"></a>功能用法</h3><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">ssh -<span class="hljs-selector-tag">p</span> <span class="hljs-number">22</span> username<span class="hljs-keyword">@servername</span><br></code></pre></td></tr></table></figure><blockquote><p>例如：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ssh root@<span class="hljs-number">192.168</span>.<span class="hljs-number">25.137</span> ls -ltr <span class="hljs-regexp">/backup/</span>data<br></code></pre></td></tr></table></figure></blockquote><h4 id="查看已知主机"><a href="#查看已知主机" class="headerlink" title="查看已知主机"></a>查看已知主机</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cat <span class="hljs-regexp">/root/</span>.ssh/known_hosts<br></code></pre></td></tr></table></figure><h4 id="ssh远程执行sudo命令"><a href="#ssh远程执行sudo命令" class="headerlink" title="ssh远程执行sudo命令"></a>ssh远程执行sudo命令</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">ssh -t omd@<span class="hljs-number">192.168</span>.<span class="hljs-number">25.137</span> sudo rsync hosts <span class="hljs-regexp">/etc/</span><br></code></pre></td></tr></table></figure><h4 id="传输文件"><a href="#传输文件" class="headerlink" title="传输文件"></a>传输文件</h4><h5 id="从服务器上下载文件"><a href="#从服务器上下载文件" class="headerlink" title="从服务器上下载文件"></a>从服务器上下载文件</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">scp username<span class="hljs-variable">@servername</span><span class="hljs-symbol">:/path/filename</span> /var/www/local_dir（本地目录）<br></code></pre></td></tr></table></figure><blockquote><p>例如: scp <a href="mailto:&#x72;&#x6f;&#111;&#x74;&#x40;&#49;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#x2e;&#48;&#46;&#49;&#48;&#49;">&#x72;&#x6f;&#111;&#x74;&#x40;&#49;&#x39;&#50;&#46;&#x31;&#54;&#x38;&#x2e;&#48;&#46;&#49;&#48;&#49;</a>:/var/www/test.txt 把192.168.0.101上的/var/www/test.txt 的文件下载到/var/www/local_dir（本地目录）</p></blockquote><h5 id="上传本地文件到服务器"><a href="#上传本地文件到服务器" class="headerlink" title="上传本地文件到服务器"></a>上传本地文件到服务器</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">scp /path/filename username<span class="hljs-variable">@servername</span><span class="hljs-symbol">:/path</span>  <br></code></pre></td></tr></table></figure><blockquote><p>例如: scp /var/www/test.php <a href="mailto:&#114;&#x6f;&#111;&#116;&#x40;&#x31;&#x39;&#50;&#46;&#49;&#x36;&#x38;&#46;&#48;&#x2e;&#49;&#x30;&#x31;">&#114;&#x6f;&#111;&#116;&#x40;&#x31;&#x39;&#50;&#46;&#49;&#x36;&#x38;&#46;&#48;&#x2e;&#49;&#x30;&#x31;</a>:/var/www/ 把本机/var/www/目录下的test.php文件上传到192.168.0.101这台服务器上的/var/www/目录中</p></blockquote><h5 id="从服务器下载整个目录"><a href="#从服务器下载整个目录" class="headerlink" title="从服务器下载整个目录"></a>从服务器下载整个目录</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">scp -r username<span class="hljs-variable">@servername</span><span class="hljs-symbol">:/var/www/remote_dir/</span>（远程目录） /var/www/local_dir（本地目录）<br></code></pre></td></tr></table></figure><blockquote><p>例如: scp -r <a href="mailto:&#114;&#111;&#111;&#x74;&#x40;&#x31;&#57;&#50;&#46;&#49;&#54;&#56;&#x2e;&#x30;&#46;&#49;&#x30;&#49;">&#114;&#111;&#111;&#x74;&#x40;&#x31;&#57;&#50;&#46;&#49;&#54;&#56;&#x2e;&#x30;&#46;&#49;&#x30;&#49;</a>:/var/www/test /var/www/  </p></blockquote><h5 id="上传目录到服务器"><a href="#上传目录到服务器" class="headerlink" title="上传目录到服务器"></a>上传目录到服务器</h5><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">scp -r local_dir username<span class="hljs-variable">@servername</span><span class="hljs-symbol">:remote_dir</span><br></code></pre></td></tr></table></figure><blockquote><p>例如：scp -r test  <a href="mailto:&#x72;&#x6f;&#111;&#116;&#64;&#49;&#57;&#x32;&#46;&#49;&#x36;&#x38;&#x2e;&#x30;&#x2e;&#x31;&#48;&#x31;">&#x72;&#x6f;&#111;&#116;&#64;&#49;&#57;&#x32;&#46;&#49;&#x36;&#x38;&#x2e;&#x30;&#x2e;&#x31;&#48;&#x31;</a>:/var/www/  把当前目录下的test目录上传到服务器的/var/www/ 目录</p></blockquote><h4 id="ssh自带的sftp功能"><a href="#ssh自带的sftp功能" class="headerlink" title="ssh自带的sftp功能"></a>ssh自带的sftp功能</h4><h5 id="Window和Linux的传输工具"><a href="#Window和Linux的传输工具" class="headerlink" title="Window和Linux的传输工具"></a>Window和Linux的传输工具</h5><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xl">wincp  filezip          <br><span class="hljs-function"><span class="hljs-title">sftp</span> --&gt;</span>基于 ssh 的安全加密传输<br></code></pre></td></tr></table></figure><h5 id="sftp客户端连接"><a href="#sftp客户端连接" class="headerlink" title="sftp客户端连接"></a>sftp客户端连接</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">sftp -oPort=<span class="hljs-number">22</span> root@<span class="hljs-number">192.168</span>.<span class="hljs-number">25.137</span>                   <br>put <span class="hljs-regexp">/etc/</span>hosts /tmp                   <br>get <span class="hljs-regexp">/etc/</span>hosts <span class="hljs-regexp">/home/</span>omd <br></code></pre></td></tr></table></figure><h5 id="sftp小结"><a href="#sftp小结" class="headerlink" title="sftp小结"></a>sftp小结</h5><ul><li>linux下使用命令： sftp -oPort=22 <a href="mailto:&#x72;&#111;&#x6f;&#116;&#x40;&#120;&#x2e;&#120;&#x2e;&#120;&#46;&#120;">&#x72;&#111;&#x6f;&#116;&#x40;&#120;&#x2e;&#120;&#x2e;&#120;&#46;&#120;</a>                   </li><li>put加客户端本地路径上传                  </li><li>get下载服务器端内容到本地                   </li><li>远程连接默认连接用户的家目录</li></ul><h3 id="后台服务"><a href="#后台服务" class="headerlink" title="后台服务"></a>后台服务</h3><h4 id="查询openssl软件"><a href="#查询openssl软件" class="headerlink" title="查询openssl软件"></a>查询openssl软件</h4><pre><code>rpm -qa openssh openssl</code></pre><h4 id="查询sshd进程"><a href="#查询sshd进程" class="headerlink" title="查询sshd进程"></a>查询sshd进程</h4><pre><code>ps -ef | grep ssh    --&gt; /usr/sbin/sshd</code></pre><h4 id="查看ssh端口"><a href="#查看ssh端口" class="headerlink" title="查看ssh端口"></a>查看ssh端口</h4><pre><code>netstat -lntup | grep ssh  ss | grep ssh                (效果同上，同下，好用)netstat -a | grep ssh(记住这个)netstat -lnt | grep 22    ==&gt;  查看22端口有没有开/ssh服务有没有开启技巧： netstat -lnt | grep ssh | wc -l --&gt;只要大于2个就是ssh服务就是好的</code></pre><blockquote><p>如果没有 <code>netstat</code> 这个命令，需要安装 <code>net-tools</code></p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> install net-tools<br></code></pre></td></tr></table></figure><h4 id="查看ssh的秘钥目录"><a href="#查看ssh的秘钥目录" class="headerlink" title="查看ssh的秘钥目录"></a>查看ssh的秘钥目录</h4><pre><code>ll /root/.ssh/known_hosts  # 当前用户家目录的.ssh目录下</code></pre><h4 id="ssh的配置文件"><a href="#ssh的配置文件" class="headerlink" title="ssh的配置文件"></a>ssh的配置文件</h4><pre><code>cat /etc/ssh/sshd_config   </code></pre><h4 id="ssh服务的关闭"><a href="#ssh服务的关闭" class="headerlink" title="ssh服务的关闭"></a>ssh服务的关闭</h4><pre><code>service sshd stop</code></pre><h4 id="ssh服务的开启："><a href="#ssh服务的开启：" class="headerlink" title="ssh服务的开启："></a>ssh服务的开启：</h4><pre><code>service sshd start</code></pre><h4 id="ssh服务的重启"><a href="#ssh服务的重启" class="headerlink" title="ssh服务的重启"></a>ssh服务的重启</h4><pre><code>service sshd reload    [停止进程后重启] ==&gt; 推荐service sshd restart   [干掉进程后重启] ==&gt; 不推荐</code></pre><h4 id="ssh远程登录"><a href="#ssh远程登录" class="headerlink" title="ssh远程登录"></a>ssh远程登录</h4><pre><code>ssh 192.168.1.100      # 默认利用当前宿主用户的用户名登录ssh omd@192.168.1.100  # 利用远程机的用户登录ssh omd@192.168.1.100  -o stricthostkeychecking=no # 首次登陆免输yes登录ssh omd@192.168.1.100 &quot;ls /home/omd&quot;  # 当前服务器A远程登录服务器B后执行某个命令ssh omd@192.168.1.100 -t &quot;sh /home/omd/ftl.sh&quot;  # 当前服务器A远程登录服务器B后执行某个脚本</code></pre><h3 id="免密设置"><a href="#免密设置" class="headerlink" title="免密设置"></a>免密设置</h3><ul><li>进入用户家目录中 <code>.ssh</code> 文件夹内</li><li>根据DSA算法生成私钥和公钥</li></ul><blockquote><p>加密协议可以使用<code>RSA</code> 或 <code>DSA</code>，新版本的openssl 与 ssh-keygen中也可以使用更安全更快速的 <code>ecdsa</code></p></blockquote><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livescript">ssh-keygen -t dsa / rsa     <span class="hljs-comment"># 一路回车即可</span><br>-&gt; id_dsa         --&gt;私钥<span class="hljs-function"><span class="hljs-params">(钥匙)</span> </span><br><span class="hljs-function">-&gt;</span> id_dsa.pub     --&gt;公钥(锁)<br></code></pre></td></tr></table></figure><ul><li>将<code>id_dsa.pub</code>的内容放入服务器<code>.ssh</code>目录下的<code>authorized_keys</code>文件中</li><li>免密码登录目标服务器：</li></ul><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir">ssh username<span class="hljs-variable">@servername</span><br>-&gt; ssh root<span class="hljs-variable">@192</span>.<span class="hljs-number">168.25</span>.<span class="hljs-number">110</span><br></code></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><blockquote><p>位置: <code>/etc/ssh/sshd_config</code></p></blockquote><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta"># cat /etc/ssh/sshd_config </span><br><span class="hljs-meta">#       $OpenBSD: sshd_config,v 1.80 2008/07/02 02:24:18 djm Exp $</span><br> <br><span class="hljs-meta"># This is the sshd server system-wide configuration file.  See</span><br><span class="hljs-meta"># sshd_config(5) for more information.</span><br> <br><span class="hljs-meta"># This sshd was compiled with PATH=/usr/local/bin:/bin:/usr/bin</span><br> <br><span class="hljs-meta"># The strategy used for options in the default sshd_config shipped with</span><br><span class="hljs-meta"># OpenSSH is to specify options with their default value where</span><br><span class="hljs-meta"># possible, but leave them commented.  Uncommented options change a</span><br><span class="hljs-meta"># default value.</span><br> <br><span class="hljs-meta">#Port 22</span><br><span class="hljs-meta">#AddressFamily any</span><br><span class="hljs-meta">#ListenAddress 0.0.0.0</span><br><span class="hljs-meta">#ListenAddress ::</span><br> <br><span class="hljs-meta"># Disable legacy (protocol version 1) support in the server for new</span><br><span class="hljs-meta"># installations. In future the default will change to require explicit</span><br><span class="hljs-meta"># activation of protocol 1</span><br>Protocol <span class="hljs-number">2</span><br> <br><span class="hljs-meta"># HostKey for protocol version 1</span><br><span class="hljs-meta">#HostKey /etc/ssh/ssh_host_key</span><br><span class="hljs-meta"># HostKeys for protocol version 2</span><br><span class="hljs-meta">#HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="hljs-meta">#HostKey /etc/ssh/ssh_host_dsa_key</span><br> <br><span class="hljs-meta"># Lifetime and size of ephemeral version 1 server key</span><br><span class="hljs-meta">#KeyRegenerationInterval 1h</span><br><span class="hljs-meta">#ServerKeyBits 1024</span><br> <br><span class="hljs-meta"># Logging</span><br><span class="hljs-meta"># obsoletes QuietMode and FascistLogging</span><br><span class="hljs-meta">#SyslogFacility AUTH</span><br>SyslogFacility AUTHPRIV<br><span class="hljs-meta">#LogLevel INFO</span><br> <br><span class="hljs-meta"># Authentication:</span><br> <br><span class="hljs-meta">#LoginGraceTime 2m</span><br><span class="hljs-meta">#PermitRootLogin yes</span><br><span class="hljs-meta">#StrictModes yes</span><br><span class="hljs-meta">#MaxAuthTries 6</span><br><span class="hljs-meta">#MaxSessions 10</span><br> <br><span class="hljs-meta">#RSAAuthentication yes</span><br><span class="hljs-meta">#PubkeyAuthentication yes</span><br><span class="hljs-meta">#AuthorizedKeysFile     .ssh/authorized_keys</span><br><span class="hljs-meta">#AuthorizedKeysCommand none</span><br><span class="hljs-meta">#AuthorizedKeysCommandRunAs nobody</span><br> <br><span class="hljs-meta"># For this to work you will also need host keys in /etc/ssh/ssh_known_hosts</span><br><span class="hljs-meta">#RhostsRSAAuthentication no</span><br><span class="hljs-meta"># similar for protocol version 2</span><br><span class="hljs-meta">#HostbasedAuthentication no</span><br><span class="hljs-meta"># Change to yes if you don&#x27;t trust ~/.ssh/known_hosts for</span><br><span class="hljs-meta"># RhostsRSAAuthentication and HostbasedAuthentication</span><br><span class="hljs-meta">#IgnoreUserKnownHosts no</span><br><span class="hljs-meta"># Don&#x27;t read the user&#x27;s ~/.rhosts and ~/.shosts files</span><br><span class="hljs-meta">#IgnoreRhosts yes</span><br> <br><span class="hljs-meta"># To disable tunneled clear text passwords, change to no here!</span><br><span class="hljs-meta">#PasswordAuthentication yes</span><br><span class="hljs-meta">#PermitEmptyPasswords no</span><br>PasswordAuthentication yes<br> <br><span class="hljs-meta"># Change to no to disable s/key passwords</span><br><span class="hljs-meta">#ChallengeResponseAuthentication yes</span><br>ChallengeResponseAuthentication no<br> <br><span class="hljs-meta"># Kerberos options</span><br><span class="hljs-meta">#KerberosAuthentication no</span><br><span class="hljs-meta">#KerberosOrLocalPasswd yes</span><br><span class="hljs-meta">#KerberosTicketCleanup yes</span><br><span class="hljs-meta">#KerberosGetAFSToken no</span><br><span class="hljs-meta">#KerberosUseKuserok yes</span><br> <br><span class="hljs-meta"># GSSAPI options</span><br><span class="hljs-meta">#GSSAPIAuthentication no</span><br>GSSAPIAuthentication yes<br><span class="hljs-meta">#GSSAPICleanupCredentials yes</span><br>GSSAPICleanupCredentials yes<br><span class="hljs-meta">#GSSAPIStrictAcceptorCheck yes</span><br><span class="hljs-meta">#GSSAPIKeyExchange no</span><br> <br><span class="hljs-meta"># Set this to &#x27;yes&#x27; to enable PAM authentication, account processing, </span><br><span class="hljs-meta"># and session processing. If this is enabled, PAM authentication will </span><br><span class="hljs-meta"># be allowed through the ChallengeResponseAuthentication and</span><br><span class="hljs-meta"># PasswordAuthentication.  Depending on your PAM configuration,</span><br><span class="hljs-meta"># PAM authentication via ChallengeResponseAuthentication may bypass</span><br><span class="hljs-meta"># the setting of &quot;PermitRootLogin without-password&quot;.</span><br><span class="hljs-meta"># If you just want the PAM account and session checks to run without</span><br><span class="hljs-meta"># PAM authentication, then enable this but set PasswordAuthentication</span><br><span class="hljs-meta"># and ChallengeResponseAuthentication to &#x27;no&#x27;.</span><br><span class="hljs-meta">#UsePAM no</span><br>UsePAM yes<br> <br><span class="hljs-meta"># Accept locale-related environment variables</span><br>AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES<br>AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT<br>AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE<br>AcceptEnv XMODIFIERS<br> <br><span class="hljs-meta">#AllowAgentForwarding yes</span><br><span class="hljs-meta">#AllowTcpForwarding yes</span><br><span class="hljs-meta">#GatewayPorts no</span><br><span class="hljs-meta">#X11Forwarding no</span><br>X11Forwarding yes<br><span class="hljs-meta">#X11DisplayOffset 10</span><br><span class="hljs-meta">#X11UseLocalhost yes</span><br><span class="hljs-meta">#PrintMotd yes</span><br><span class="hljs-meta">#PrintLastLog yes</span><br><span class="hljs-meta">#TCPKeepAlive yes</span><br><span class="hljs-meta">#UseLogin no</span><br><span class="hljs-meta">#UsePrivilegeSeparation yes</span><br><span class="hljs-meta">#PermitUserEnvironment no</span><br><span class="hljs-meta">#Compression delayed</span><br><span class="hljs-meta">#ClientAliveInterval 0</span><br><span class="hljs-meta">#ClientAliveCountMax 3</span><br><span class="hljs-meta">#ShowPatchLevel no</span><br><span class="hljs-meta">#UseDNS yes</span><br><span class="hljs-meta">#PidFile /var/run/sshd.pid</span><br><span class="hljs-meta">#MaxStartups 10</span><br><span class="hljs-meta">#PermitTunnel no</span><br><span class="hljs-meta">#ChrootDirectory none</span><br> <br><span class="hljs-meta"># no default banner path</span><br><span class="hljs-meta">#Banner none</span><br> <br><span class="hljs-meta"># override default of no subsystems</span><br>Subsystem       sftp    /usr/libexec/openssh/sftp-server<br> <br><span class="hljs-meta"># Example of overriding settings on a per-user basis</span><br><span class="hljs-meta">#Match User anoncvs</span><br><span class="hljs-meta">#       X11Forwarding no</span><br><span class="hljs-meta">#       AllowTcpForwarding no</span><br><span class="hljs-meta">#       ForceCommand cvs server</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://www.cnblogs.com/jiangyao/archive/2011/01/26/1945570.html">https://www.cnblogs.com/jiangyao/archive/2011/01/26/1945570.html</a></p></li><li><p><a href="https://www.cnblogs.com/machangwei-8/p/10352725.html">https://www.cnblogs.com/machangwei-8/p/10352725.html</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTTPIE 工具使用入门</title>
    <link href="/2021/01/14/tools/httpie/httpie/"/>
    <url>/2021/01/14/tools/httpie/httpie/</url>
    
    <content type="html"><![CDATA[<blockquote><p>HTTPie 是一个 HTTP 的命令行客户端，目标是让 CLI 和 web 服务之间的交互尽可能的人性化，本文介绍相关内容。</p></blockquote><span id="more"></span><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote><p>HTTPie 工具提供了简洁的 http 命令，允许通过自然的语法发送任意 HTTP 请求数据，展示色彩化的输出。HTTPie 可用于与 HTTP 服务器做测试、调试和常规交互     ——   <a href="https://blog.mimvp.com/2017/10/httpie-gong-ju-shi-yong-ru-men/"> 米扑博客</a></p></blockquote><ul><li>官网 <strong>Github</strong>：<a href="https://github.com/jakubroztocil/httpie">https://github.com/jakubroztocil/httpie</a></li></ul><h3 id="主要特性"><a href="#主要特性" class="headerlink" title="主要特性"></a>主要特性</h3><ul><li>直观的语法</li><li>格式化和色彩化的终端输出</li><li>内置 JSON 支持</li><li>支持上传表单和文件</li><li>HTTPS、代理和认证</li><li>任意请求数据</li><li>自定义头部</li><li>持久性会话</li><li>类 Wget 下载</li><li>支持 Python 2.6, 2.7 和 3.x</li><li>支持 Linux, Mac OS X 和 Windows</li><li>插件</li><li>文档</li><li>测试覆盖率</li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><blockquote><p>httpie 是跨平台命令，支持 Mac OS X、 Linux、 Windows</p></blockquote><h4 id="Mac-OS-X"><a href="#Mac-OS-X" class="headerlink" title="Mac OS X"></a>Mac OS X</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">brew install httpie      // brew 命令安装<br>port install httpie      // ports 命令安装<br></code></pre></td></tr></table></figure><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">easy_install httpie （CentOS 5.6/6.5/7.2 都成功）<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Debian, Ubuntu, etc.</span><br>apt-get install httpie<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Fedora, CentOS, RHEL, …</span><br>yum install httpie<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> Arch Linux</span><br>pacman -S httpie<br></code></pre></td></tr></table></figure><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Make sure we have an up-to-date version of pip and setuptools:</span><br>pip install --upgrade pip setuptools<br>pip install --upgrade httpie<br></code></pre></td></tr></table></figure><h3 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h3><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs inform7"># http<br>usage: http <span class="hljs-comment">[--json]</span> <span class="hljs-comment">[--form]</span> <span class="hljs-comment">[--pretty &#123;all,colors,format,none&#125;]</span><br>            <span class="hljs-comment">[--style STYLE]</span> <span class="hljs-comment">[--print WHAT]</span> <span class="hljs-comment">[--headers]</span> <span class="hljs-comment">[--body]</span> <span class="hljs-comment">[--verbose]</span><br>            <span class="hljs-comment">[--all]</span> <span class="hljs-comment">[--history-print WHAT]</span> <span class="hljs-comment">[--stream]</span> <span class="hljs-comment">[--output FILE]</span><br>            <span class="hljs-comment">[--download]</span> <span class="hljs-comment">[--continue]</span><br>            <span class="hljs-comment">[--session SESSION_NAME_OR_PATH | --session-read-only SESSION_NAME_OR_PATH]</span><br>            <span class="hljs-comment">[--auth USER<span class="hljs-comment">[:PASS]</span>]</span> <span class="hljs-comment">[--auth-type &#123;basic,digest&#125;]</span><br>            <span class="hljs-comment">[--proxy PROTOCOL:PROXY_URL]</span> <span class="hljs-comment">[--follow]</span><br>            <span class="hljs-comment">[--max-redirects MAX_REDIRECTS]</span> <span class="hljs-comment">[--timeout SECONDS]</span><br>            <span class="hljs-comment">[--check-status]</span> <span class="hljs-comment">[--verify VERIFY]</span><br>            <span class="hljs-comment">[--ssl &#123;ssl2.3,ssl3,tls1,tls1.1,tls1.2&#125;]</span> <span class="hljs-comment">[--cert CERT]</span><br>            <span class="hljs-comment">[--cert-key CERT_KEY]</span> <span class="hljs-comment">[--ignore-stdin]</span> <span class="hljs-comment">[--help]</span> <span class="hljs-comment">[--version]</span><br>            <span class="hljs-comment">[--traceback]</span> <span class="hljs-comment">[--default-scheme DEFAULT_SCHEME]</span> <span class="hljs-comment">[--debug]</span><br>            <span class="hljs-comment">[METHOD]</span> URL <span class="hljs-comment">[REQUEST_ITEM <span class="hljs-comment">[REQUEST_ITEM ...]</span>]</span><br>http: error: the following arguments <span class="hljs-keyword">are</span> required: URL<br></code></pre></td></tr></table></figure><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><h5 id="显示请求信息（包含返回头200）"><a href="#显示请求信息（包含返回头200）" class="headerlink" title="显示请求信息（包含返回头200）"></a>显示请求信息（包含返回头200）</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span> mimvp.com<br></code></pre></td></tr></table></figure><h5 id="显示详细的请求（包含请求和返回头200）"><a href="#显示详细的请求（包含请求和返回头200）" class="headerlink" title="显示详细的请求（包含请求和返回头200）"></a>显示详细的请求（包含请求和返回头200）</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span> -v mimvp.com<br></code></pre></td></tr></table></figure><h5 id="只显示Header"><a href="#只显示Header" class="headerlink" title="只显示Header"></a>只显示Header</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span> -h mimvp.com<br><span class="hljs-keyword">http</span> <span class="hljs-comment">--head mimvp.com</span><br><span class="hljs-keyword">http</span> <span class="hljs-comment">--header mimvp.com</span><br><span class="hljs-keyword">http</span> <span class="hljs-comment">--headers mimvp.com</span><br></code></pre></td></tr></table></figure><h5 id="只显示Body"><a href="#只显示Body" class="headerlink" title="只显示Body"></a>只显示Body</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span> -b mimvp.com<br><span class="hljs-keyword">http</span> <span class="hljs-comment">--body mimvp.com</span><br></code></pre></td></tr></table></figure><h5 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span> -d mimvp.com<br></code></pre></td></tr></table></figure><h5 id="模拟提交表单"><a href="#模拟提交表单" class="headerlink" title="模拟提交表单"></a>模拟提交表单</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span> -f POST mimvp.com username=<span class="hljs-string">&#x27;mimvp-user&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="请求删除的方法"><a href="#请求删除的方法" class="headerlink" title="请求删除的方法"></a>请求删除的方法</h5><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">http <span class="hljs-keyword">DELETE</span> mimvp.com<br></code></pre></td></tr></table></figure><h5 id="传递JSON数据请求-默认就是JSON数据请求"><a href="#传递JSON数据请求-默认就是JSON数据请求" class="headerlink" title="传递JSON数据请求(默认就是JSON数据请求)"></a>传递JSON数据请求(默认就是JSON数据请求)</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">http PUT mimvp.com <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;mimvp-user&#x27;</span> <span class="hljs-attribute">password</span>=<span class="hljs-string">&#x27;mimvp-pwd&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="如果JSON数据存在不是字符串则用-分隔，例如"><a href="#如果JSON数据存在不是字符串则用-分隔，例如" class="headerlink" title="如果JSON数据存在不是字符串则用:=分隔，例如"></a>如果JSON数据存在不是字符串则用:=分隔，例如</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">http PUT mimvp.com username=<span class="hljs-string">&#x27;mimvp-user&#x27;</span> password=<span class="hljs-string">&#x27;mimvp-pwd&#x27;</span> age:=<span class="hljs-number">28</span> a:=<span class="hljs-literal">true</span> streets:=<span class="hljs-string">&#x27;[&quot;a&quot;, &quot;b&quot;]&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="模拟Form的Post请求-Content-Type-application-x-www-form-urlencoded-charset-utf-8"><a href="#模拟Form的Post请求-Content-Type-application-x-www-form-urlencoded-charset-utf-8" class="headerlink" title="模拟Form的Post请求, Content-Type: application/x-www-form-urlencoded; charset=utf-8"></a>模拟Form的Post请求, Content-Type: application/x-www-form-urlencoded; charset=utf-8</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">http --<span class="hljs-selector-tag">form</span> POST mimvp<span class="hljs-selector-class">.com</span> username=<span class="hljs-string">&#x27;mimvp-user&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="模拟Form的上传-Content-Type-multipart-form-data"><a href="#模拟Form的上传-Content-Type-multipart-form-data" class="headerlink" title="模拟Form的上传, Content-Type: multipart/form-data"></a>模拟Form的上传, Content-Type: multipart/form-data</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span> -f POST example.com/jobs username=<span class="hljs-string">&#x27;mimvp-user&#x27;</span> <span class="hljs-built_in">file</span>@~/test.pdf<br></code></pre></td></tr></table></figure><h5 id="修改请求头-使用-分隔"><a href="#修改请求头-使用-分隔" class="headerlink" title="修改请求头, 使用:分隔"></a>修改请求头, 使用:分隔</h5><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">http mimvp.com  User-<span class="hljs-built_in">Agent</span>:mimvp-<span class="hljs-built_in">agent</span>/<span class="hljs-number">1.0</span>  <span class="hljs-string">&#x27;Cookie:a=b;b=c&#x27;</span>  Referer:http:<span class="hljs-comment">//mimvp.com/</span><br></code></pre></td></tr></table></figure><h5 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">http</span> -<span class="hljs-keyword">a</span> username:password mimvp.com<br><span class="hljs-keyword">http</span> <span class="hljs-comment">--auth-type=digest -a username:password mimvp.com</span><br></code></pre></td></tr></table></figure><h5 id="使用http代理"><a href="#使用http代理" class="headerlink" title="使用http代理"></a>使用http代理</h5><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-keyword">http</span> --proxy=<span class="hljs-keyword">http</span>:<span class="hljs-keyword">http</span>://<span class="hljs-number">217.107</span><span class="hljs-number">.197</span><span class="hljs-number">.174</span>:<span class="hljs-number">8081</span> proxy.mimvp.com<br><span class="hljs-keyword">http</span> --proxy=<span class="hljs-keyword">http</span>:<span class="hljs-keyword">http</span>://user:pass@<span class="hljs-number">217.107</span><span class="hljs-number">.197</span><span class="hljs-number">.174</span>:<span class="hljs-number">8081</span> proxy.mimvp.com<br><span class="hljs-keyword">http</span> --proxy=https:<span class="hljs-keyword">http</span>://<span class="hljs-number">112.114</span><span class="hljs-number">.96</span><span class="hljs-number">.34</span>:<span class="hljs-number">8118</span> proxy.mimvp.com<br><span class="hljs-keyword">http</span> --proxy=https:<span class="hljs-keyword">http</span>://user:pass@<span class="hljs-number">112.114</span><span class="hljs-number">.96</span><span class="hljs-number">.34</span>:<span class="hljs-number">8118</span> proxy.mimvp.com<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.mimvp.com/2017/10/httpie-gong-ju-shi-yong-ru-men/">https://blog.mimvp.com/2017/10/httpie-gong-ju-shi-yong-ru-men/</a></li><li><a href="https://www.cnblogs.com/new_2050/p/7745788.html">https://www.cnblogs.com/new_2050/p/7745788.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>tools</category>
      
      <category>httpie</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
      <tag>httpie</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python Opencv 错误记录</title>
    <link href="/2021/01/14/python/opencv-error/opencv-error/"/>
    <url>/2021/01/14/python/opencv-error/opencv-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录在使用Python中的Opencv库的过程中踩过的坑，以史为鉴。</p></blockquote><span id="more"></span><h3 id="cv2-rectangle"><a href="#cv2-rectangle" class="headerlink" title="cv2.rectangle"></a>cv2.rectangle</h3><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ul><li>{TypeError}an integer is required (got type tuple)</li><li>{TypeError}argument for rectangle() given by name (‘color’) and position (3)</li><li>{TypeError}argument for rectangle() given by name (‘thickness’) and position (4)</li><li>{TypeError}an integer is required (got type tuple)</li></ul><h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><ul><li>坐标pt1,pt2需要是整型</li><li>img=np.ascontiguousarray(img)，然后调用rectangle</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/csdn_zhishui/article/details/105878092">https://blog.csdn.net/csdn_zhishui/article/details/105878092</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 进度条神器 tqdm 用法</title>
    <link href="/2021/01/09/python/tqdm/tqdm/"/>
    <url>/2021/01/09/python/tqdm/tqdm/</url>
    
    <content type="html"><![CDATA[<blockquote><p>程序运行过程中进度条显示特别重要，Python中使用<code>tqdm</code>库作为进度条操作工具，本文简要介绍<code>tqdm</code>常用功能。</p></blockquote><span id="more"></span><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><blockquote><p><code>tqdm</code>源自阿拉伯语 taqaddum，意思是进程( “progress”)；</p><p>也是西班牙语中 “I love you so much” (te quiero demasiado)的缩写（这个是碰了巧了）</p></blockquote><ul><li>该模块的作用就是通过装饰<code>tqdm(iterable)</code>任何可迭代的对象，使代码中的循环(loop)在运行过程中为用户展示进度条。</li><li>盗了<a href="https://pypi.org/project/tqdm/">官网</a>的图直观展示一下效果</li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20210109164234.gif"></p><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="引入包"><a href="#引入包" class="headerlink" title="引入包"></a>引入包</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br></code></pre></td></tr></table></figure><h4 id="生成tqdm对象"><a href="#生成tqdm对象" class="headerlink" title="生成tqdm对象"></a>生成tqdm对象</h4><blockquote><p>tqdm类的构造函数：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">__init__(iterable=<span class="hljs-literal">None</span>, desc=<span class="hljs-literal">None</span>, total=<span class="hljs-literal">None</span>, leave=<span class="hljs-literal">True</span>, file=<span class="hljs-literal">None</span>, ncols=<span class="hljs-literal">None</span>, mininterval=<span class="hljs-number">0.1</span>, maxinterval=<span class="hljs-number">10.0</span>, miniters=<span class="hljs-literal">None</span>, <span class="hljs-built_in">ascii</span>=<span class="hljs-literal">None</span>, disable=<span class="hljs-literal">False</span>, unit=<span class="hljs-string">&#x27;it&#x27;</span>, unit_scale=<span class="hljs-literal">False</span>, dynamic_ncols=<span class="hljs-literal">False</span>, smoothing=<span class="hljs-number">0.3</span>, bar_format=<span class="hljs-literal">None</span>, initial=<span class="hljs-number">0</span>, position=<span class="hljs-literal">None</span>, postfix=<span class="hljs-literal">None</span>, unit_divisor=<span class="hljs-number">1000</span>, write_bytes=<span class="hljs-literal">None</span>, lock_args=<span class="hljs-literal">None</span>, nrows=<span class="hljs-literal">None</span>, colour=<span class="hljs-literal">None</span>, gui=<span class="hljs-literal">False</span>, **kwargs)<br></code></pre></td></tr></table></figure><blockquote><p>参数很复杂，这里介绍几个常用参数和方法，详细情况参考<a href="https://tqdm.github.io/docs/tqdm/#__init__">官网文档</a></p></blockquote><ul><li>iterable: 最常用的参数，表示使用这个迭代对象来初始化<code>tqdm</code>对象，如果手动更新进度条的话该参数可以为<code>None</code></li><li>desc: 进度条的描述信息</li><li>total: 进度条总格子数量</li><li>miniters: int, optional。迭代过程中进度显示的最小更新间隔。</li><li>unit : str, optional。定义每个迭代的单元。默认为<code>&quot;it&quot;</code>，即每个迭代，在下载或解压时，设为<code>&quot;B&quot;</code>，代表每个“字节”。</li><li>unit_scale: bool or int or float, optional。默认为<code>False</code>，如果设置为<code>1</code>或者<code>True</code>，会自动根据国际单位制进行转换 (kilo, mega, etc.) 。比如，在下载进度条的例子中，如果为<code>False</code>，数据大小是按照字节显示，设为<code>True</code>之后转换为Kb、Mb。</li></ul><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="自动控制进度"><a href="#自动控制进度" class="headerlink" title="自动控制进度"></a>自动控制进度</h4><ul><li>将<code>tqdm()</code> 直接包装在任意迭代器上：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>)):<br>    <span class="hljs-keyword">pass</span><br><br>&gt;&gt; <span class="hljs-number">100</span>%|██████████████████| <span class="hljs-number">10000</span>/<span class="hljs-number">10000</span> [<span class="hljs-number">00</span>:<span class="hljs-number">00</span>&lt;<span class="hljs-number">00</span>:<span class="hljs-number">00</span>, <span class="hljs-number">1248304.76</span>it/s]<br></code></pre></td></tr></table></figure><ul><li>加入描述：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>), desc=<span class="hljs-string">&#x27;test str:&#x27;</span>):<br>    <span class="hljs-keyword">pass</span><br><br>&gt;&gt; test <span class="hljs-built_in">str</span>:: <span class="hljs-number">100</span>%|█████████████████| <span class="hljs-number">10000</span>/<span class="hljs-number">10000</span> [<span class="hljs-number">00</span>:<span class="hljs-number">00</span>&lt;<span class="hljs-number">00</span>:<span class="hljs-number">00</span>, <span class="hljs-number">1666257.75</span>it/s] <br></code></pre></td></tr></table></figure><ul><li><code>trange(i)</code> 是对<code>tqdm(range(i))</code> 特殊优化过的实例：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> trange<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> trange(<span class="hljs-number">10000</span>):<br>    <span class="hljs-keyword">pass</span><br><br>&gt;&gt; <span class="hljs-number">100</span>%|██████████████████| <span class="hljs-number">10000</span>/<span class="hljs-number">10000</span> [<span class="hljs-number">00</span>:<span class="hljs-number">00</span>&lt;<span class="hljs-number">00</span>:<span class="hljs-number">00</span>, <span class="hljs-number">1191844.79</span>it/s]<br></code></pre></td></tr></table></figure><ul><li>如果要精细控制<code>tqdm</code>对象，需要提前生成对象，并在循环中加以控制：</li></ul><blockquote><p>使用外部对象可以直接建立对象，此时在循环之外需要关闭该对象：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br>pbar = tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> pbar:<br>    pbar.set_description(<span class="hljs-built_in">str</span>(i))<br>    <span class="hljs-keyword">pass</span><br>pbar.close()<br><br>&gt;&gt; <span class="hljs-number">9999</span>: <span class="hljs-number">100</span>%|█████████████████████████| <span class="hljs-number">10000</span>/<span class="hljs-number">10000</span> [<span class="hljs-number">00</span>:02&lt;<span class="hljs-number">00</span>:<span class="hljs-number">00</span>, <span class="hljs-number">4677.99</span>it/s] <br></code></pre></td></tr></table></figure><blockquote><p>也可以使用<code>with</code>功能，在循环体之外由编译器自动结束其生命周期：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">with</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>)) <span class="hljs-keyword">as</span> pbar:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> pbar:<br>        pbar.set_description(<span class="hljs-built_in">str</span>(i))<br>        <span class="hljs-keyword">pass</span><br>    <br>&gt;&gt; <span class="hljs-number">9999</span>: <span class="hljs-number">100</span>%|█████████████████████████| <span class="hljs-number">10000</span>/<span class="hljs-number">10000</span> [<span class="hljs-number">00</span>:02&lt;<span class="hljs-number">00</span>:<span class="hljs-number">00</span>, <span class="hljs-number">4659.45</span>it/s] <br></code></pre></td></tr></table></figure><h4 id="手动控制进度"><a href="#手动控制进度" class="headerlink" title="手动控制进度"></a>手动控制进度</h4><ul><li>手动运行时<code>tqdm</code>对象不需要迭代器作为初始化参数，但需要指定最大长度<code>total</code>的值：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">with</span> tqdm(total=<span class="hljs-number">10000</span>) <span class="hljs-keyword">as</span> pbar:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>):<br>        pbar.update(<span class="hljs-number">1</span>)<br>        <br>&gt;&gt; <span class="hljs-number">100</span>%|████████████████████████████| <span class="hljs-number">10000</span>/<span class="hljs-number">10000</span> [<span class="hljs-number">00</span>:<span class="hljs-number">00</span>&lt;<span class="hljs-number">00</span>:<span class="hljs-number">00</span>, <span class="hljs-number">99888.16</span>it/s] <br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://pypi.org/project/tqdm/">https://pypi.org/project/tqdm/</a></p></li><li><p><a href="https://tqdm.github.io/docs/tqdm">https://tqdm.github.io/docs/tqdm</a></p></li><li><p><a href="https://blog.csdn.net/qq_33472765/article/details/82940843">https://blog.csdn.net/qq_33472765/article/details/82940843</a></p></li><li><p><a href="https://blog.csdn.net/qq_40666028/article/details/79335961">https://blog.csdn.net/qq_40666028/article/details/79335961</a></p></li><li><p><a href="https://www.cnblogs.com/harp-yestar/articles/tqdm.html">https://www.cnblogs.com/harp-yestar/articles/tqdm.html</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>矩阵对变化的敏感程度评价指标 Condition Number</title>
    <link href="/2021/01/06/math/linear_algebra/condition-num/condition-num/"/>
    <url>/2021/01/06/math/linear_algebra/condition-num/condition-num/</url>
    
    <content type="html"><![CDATA[<blockquote><p>矩阵对变化的敏感程度可以用Condition Number来评估，本文对其进行简略介绍。</p></blockquote><span id="more"></span><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul><li><a href="https://bk.tw.lvfukeji.com/baike-%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90">数值分析</a>中，一个问题的<strong>条件数</strong>是该数量在数值计算中的容易程度的衡量，也就是该问题的<a href="https://bk.tw.lvfukeji.com/w/index.php?title=%E9%80%82%E5%AE%9A%E6%80%A7&action=edit&redlink=1">适定性</a>。一个低条件数的问题称为<strong>良置</strong>的，而高条件数的问题称为<strong>病态</strong>（或者说非良置）的。                                —— <a href="https://bk.tw.lvfukeji.com/baike-%E6%9D%A1%E4%BB%B6%E6%95%B0">维基百科</a></li></ul><blockquote><p>直白来说就是描述一个矩阵是否变化率在可控范围内，下方这个示例程序可以看到，当调整<code>a</code>, <code>b</code>, <code>c</code>的值使得条件数很大时，二次型描述的曲面在某个方向上会拉的很长；在这种情况下，曲面上的点沿着某个方向会得到巨大的变化率，而沿着某些方向变化率又很小，当条件数为无穷大时甚至这个比值甚至会变得无穷大。</p></blockquote><script src="/js/deployggb.js"></script><script>var parameters = {"id": "ggbApplet","width":888,"height":694,"showMenuBar":false,"showAlgebraInput":false,"showToolBar":false,"customToolBar":"0 73 62 | 1 501 67 , 5 19 , 72 75 76 | 2 15 45 , 18 65 , 7 37 | 4 3 8 9 , 13 44 , 58 , 47 | 16 51 64 , 70 | 10 34 53 11 , 24  20 22 , 21 23 | 55 56 57 , 12 | 36 46 , 38 49  50 , 71  14  68 | 30 29 54 32 31 33 | 25 17 26 60 52 61 | 40 41 42 , 27 28 35 , 6","showToolBarHelp":true,"showResetIcon":true,"enableLabelDrags":false,"enableShiftDragZoom":true,"enableRightClick":false,"errorDialogsActive":false,"useBrowserForJS":false,"allowStyleBar":false,"preventFocus":false,"showZoomButtons":true,"capturingThreshold":3,// add code here to run when the applet starts"appletOnLoad":function(api){ /* api.evalCommand('Segment((1,2),(3,4))');*/ },"showFullscreenButton":true,"scale":1,"disableAutoScale":false,"allowUpscale":false,"clickToLoad":false,"appName":"classic","showSuggestionButtons":true,"buttonRounding":0.7,"buttonShadows":false,"language":"zh",// use this instead of ggbBase64 to load a material from geogebra.org// "material_id":"RHYH3UQ8",// use this instead of ggbBase64 to load a .ggb file// "filename":"myfile.ggb","ggbBase64":"UEsDBBQACAgIAKBzKVIAAAAAAAAAAAAAAAAXAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWztmltz4yYUgJ+7v4LhqX2IDbJkO5koO9md6TQzSTbTZDp9xRKSaWRQBUrk/PoikCV5bWfjS9b2bvMQdBA3fedwOIDPPxaTBDzRTDLBfYg7CALKAxEyHvswV9HJEH68+HAeUxHTUUZAJLIJUT70ypJ1PS11+g4q80ia+jBIiJQsgCBNiCqr+FBEUcI4hQAUkp1xcUsmVKYkoPfBmE7ItQiIMm2NlUrPut3n5+fOrNeOyOKublh2Cxl241h1dAqBHjqXPqweznS7c7Wfe6aegxDu/n1zbfs5YVwqwgM9EP1ZIY1IniipH2lCJ5QroKYp9WEqGFcQJGREEx/elRL4Ncoo/Q2CqpKmheDFh1/O5Vg8AzH6hwY6T2U5resZoVuW0a8/i0RkIPPhYABBbJORDx3P09CSdEx8iGzhhExpBp5IUueQXInA1De5EUkknZXVPd2IkNo3blWes4nBCaSiWh+ogyGQKaWhHjWsvhEb9UyNplstBkJkoQSFD2/JLQTTKn2xqSli6Nyzl6pTr52rpgltjf28W4F9G+KQppSHutAcZ7wR5/7QcC6TkU2OG7P73pj7R4J5D5Dx+pS/8DZbZyO22PEMXJN+L2dxFK7iiv9JYz3mNuPe/4x3ynjegt2N6CLDFh3tUmeKWIqy/K9jGzFJE1rsEL2NiyqM10aosTubxRht7GhP0NHG0EsgFp8as+CRUylLtk275cMfLNQrmOlP6DiSKd0SHgxtC/RfPqc0pnXGdJnXFRHlPFDGqVRwP+fZU1sbPRftQx9Nmxt7lxXK2Jb0apaSxqVUc7mfyY1pbxbW/eymLXKVlD1fcaW3X9QYrFz4uEdK0wfd1Bf+kBEuyz3YvC2t1lxGpq9pzTsGrf1sOpt5Lv5EsloTba1tFhutXL07jrdv1a3hxtsgtg9jDsp817TNrYyov9nUd5C7nF5ncMBG9KQ/TzQY/qrEJhQ4isDswPzgkmiaZIpKRvi3difJNG7N6LuZXOtjYPWx/RjX3j96PaNTDy/YN0b2D7unCOM+dvat5tcBz+1D7uqMBjHeE+KDDflW8wwEL8+/Z/sIK9Uk3R/Meexgw8Ziyq3PlQAUyBSbIlP5BVU3EwU28hSbty/YZpv6euAZK8ClrXFpC146NunZxLWJVwPabJdoVJtqv9WKkr9aHNzNtjbH5Ep+SKV/h0id5xOatVzD7UyujcezzkG3l9M51b7BFayyk9VWIRMWahOaMK2kE629CSmMFslIiiRX9D7IKOXN9Zw142cWqnEZ2um+I1aU5mLbBGORsRfBVU0DlLPgMjEXeXNHGcvMx3ktcp0z1u3cM+Fx0szGSys1GrCn9abQ18d4yxTTZogqhP2OM+zhoddDAzw49Yb9NyLFwwapffFmoov2gdEOLGStee4sm+ckC5oz0h5a7nhQB+GB6/WcU8fDp6eufvB2vxX8vc5otjWHeKRnLGCh6Lud1iUiyGVzBm2lmtDwKMKVdU7qSF6whJFsup21r8VY0aIJGR6M0PopwUEijrTbAVKvT1HtevQ8vimXYNc+610BnK2k37jm0NqKm++5slLrkt8SiJhGz8lEV7BjYPwTCR7jTOQ8XFy9dsIL7zuYWg1tJERCSeO/Ps3k1tXyQrywClC1RO/TooIxDR5Hophb4l53TUw20+baCK0r3yXT5u1fubg8nrybKazjndY/1FvrJnJFZNNWQbf1y6ju7GdYF/8BUEsHCI//M80IBQAALiYAAFBLAwQUAAgICACgcylSAAAAAAAAAAAAAAAAFwAAAGdlb2dlYnJhX2RlZmF1bHRzM2QueG1s7ZjdbtMwFMev4Sks39PYaZIt0zJUwQVIgIZ2w62XnLaGxA62uzZ7Nd6BZ+LEzroUVsSqbRKIXvT46xzbv79zGvf05aapyRUYK7UqKJ8wSkCVupJqUdCVm784pi/Pnp8uQC/g0ggy16YRrqBpP3Lrh7VJFrO+TbRtQctaWCtLStpauN6loHo+r6UCSsjGyhOlP4gGbCtKuCiX0Ih3uhTOx1o6155E0Xq9ntzMOtFmEWFgG21sFS0WboKWEly6sgUdCicYd8d7PfV+MWM8+vT+XZjnhVTWCVXiQnBbFczFqnYWi1BDA8oR17WAG9BKllOcoxaXUBf0rXK4Vyj7JZJyZa7Qf3Au6JSnjJ49f3Zql3pN9OVnHFdQZ1aw9feVqB+D3a90rQ0xBY05JYiZM7SXaPMY+dXtUhSUTTgLH57kjPOMx8G/Fh0YciUwKAstYuV06UP61rmoLdyMxcnf6wpCTzKMV7LxrIl1gGLh5LYFqHwpbJ955Tp/CMbxUMAL19VA3FKWXxRYxJ+OnPrCG1lV0J+l4ANyAeoKiWhjUXvmZ+mYH37NhiO34b7ecd97zUOz98elGrkhs+AxCwNncTDTYJJg0i0S+KrCOm3/XdBWGDxuGKjs+0+jQexfZBcbaaevt6rNhupIaTY9SGnmhWZeZnYr8mNJiqfncUXdz5cMZcBdf//2e9z+QSqFcWClUKPH7VXf8TP57G8g/5jc94PE+ApG/M59fYcfpsGD+OW5Bxjz3CP0dpuj0ofCWGptKks2IQ2E5OC/19uQc9H/KA2z7M2Od0FlB0LVdbeEymh1y3XUdIt2OqA95Em6rxw8nXo9Uv7ziZ4kA5I0z1iSJQ+mzaFH/F5kZ6ZcygYqELtoUdinQhvz8HOcHHm0vfk32J53mJFltcv16Y6sTxm4+Dxwjf+ZM3tupG12qfInpJqFxByo5tlfSVWB2+7zQ18eZ9X0f1a9D8uvK1H5N7Bhqx9v6mOm/MCLyv7UmCV5/znKeHrMk5g/FKDHuGzcedXoG8N9ogvmOt4GvO/tg8yyYI6COQ4m33szkU1by1K630trV2aOV+W7XpWHrl2Vk8NURr87X5YnR3967G8DP9FFhf/pu100uutHN38snP0AUEsHCArjiZZLAwAAABEAAFBLAwQUAAgICACgcylSAAAAAAAAAAAAAAAAFgAAAGdlb2dlYnJhX2phdmFzY3JpcHQuanNLK81LLsnMz1NIT0/yz/PMyyzR0FSorgUAUEsHCNY3vbkZAAAAFwAAAFBLAwQUAAgICACgcylSAAAAAAAAAAAAAAAADAAAAGdlb2dlYnJhLnhtbO1b7Y/cxBn/DH/FyJVQUrK7nvE77AXtXdKClKQRl1aID1Re27fnxmsvtvdu95QPtKKCkFAqoUJAES8ilFA1CLU0DSjwgT8F3d6ln/gX+jwzttfe3cvt3h0QaE+3N563Z2Z+zzO/55lZX/OJQTcgG16c+FG4JNG6LBEvdCLXDztLUj9dq5nSEycfbna8qOO1Y5usRXHXTpckDVsW/SBX15mMZXavtyQ5gZ0kviORXmCn2GVJitbWAj/0JOK7S9KyohsrmrpSU1ZWaE21WqzWOtVSakz5xTI9faqltuRTEiGDxH8sjM7ZXS/p2Y636qx7XftM5NgpH3U9TXuPNRqbm5v1fH71KO40YApJY5C4jU6nXYdUIrDIMFmSsofHQG6l96bC+zFZpo1nzp4R49T8MEnt0IEpIwB9/+TDDzU3/dCNNsmm76brABdTDImse35nHSAxmC6RBrbqAS49z0n9DS+BvqUsX33a7Um8mR1i/UPiiQTFwiTi+hu+68VLklxnFtNVRbWYwmTKLFUiUex7YZq1pdmYjVxac8P3NoVYfOIjQqc0ioK2jRLJpUuEyUwmJzChImGiVBZZWREJE4kqEk20UUVPVTRVRRtVtFEVsAo/8duBtySt2UGCCg/XYlBhkU/SYeDxqWQF44XTE7CcxN+CxooMxiTghnJZPoEfHT4qVjSq6zNL66O4iEuE4ux5ohCcN+Xzx0TNsrrIGjyhclZqilILs/ohF6McaDGqbBmLDJzG/b1AVOmMcQ34aNr0uLQ0qJC5wGLHS9XZ/EtlhwK4GJOh6NRuL0mtM788vfx0a3oGTJs9A3pIHc/UMIzFf/lnakhloVVPafcAI+qV/X80C9b2Mml9FsrMPJpRVXPuRRvyTNITKc3So1GFNb8qNMqq0yKUaEBYGqEWMKiObMQI1YgKJSaUGETBMo2qRCHYhCqEk63KiUuHGqyGv7CnCUVShoURIHRYJEMe1zSiQTMD+yIl6haXJ8MHW8OM4KNgmaLAh5cpKnyQ2TUQpAkxMA9N0fmTxv8iVWowioawEl4FZaoFw2GBZlCiwEwgb8gE5Co4COWrAR+Cv5QI92EQZhIulcuX2WGoaLxDmLEPFTUbubNsZjohyTq2zgZNvW6CWjIUorNCVzpCmSnMYMTQiKGX1HYCFadrY92h5syK7jSzqkAdCw1uDYAUYi80ydRcmScydV6aUifgro6hhwmiKEoIGAzRUUWZDmAWrNAC01ARTCegKY0RHW1oD4VAEBclfgHtuhf0CtA5hn7Y66cV3Jyumz+mEbS2Ax6cZe3dyLm4XCCdSfLsJC2LhXhmHDWJ+KYSVD3UDOy2BxFlZxUtgZANO0CPwEdYi8KUZEYABM/LnChMzsdRuhIF/W6YEOJEgVxMOApo6ZkVM4GMUqpQyxVaqUIvPRt5o8q4EdSQfuLB+FGcFHJs130Km4wNG1D5VRgMl2PPvtiL/DBNSvKaDR6INr2+E/iub4e/AfvNg75z/W7biwl/jFBZfAIIA8kjVu6d84BVN1g+xyh2V4cJmDsZPOvF0JnVIdY0dNjelqrLCt+SQ1GlmUqdGha1TMMygRE0mLRj41ZVlbpqapasWVTWmaFh1XB2HbgkPrS3seqlKagxIfbAG8PQiZEtS5mnkuUoGBdxZFbsXtqP+VEFYoEYV9UKO4HHTYJ7OojknYvtaLAq4gRdyLow7HmFsbQ7XCUEqIRpMOFOlrZFytvg1IpWMm8j8xayqEehRT21GG/B07ZIeSs8/whrFUul+TLlfBQ/ISJf3Rzc1PFY0A/99EyeSX3nYrZSKjoIA0gyW6zKpEcls9mYML65jJHNMEatbIymfB9jtGhhfaoFh83SDx1bn1W3yj+mPrY+Td7D3MSu/V+wNnlfa8vim6M0tkOKnLa1Xhy17bYf+OlwxQ6cfmCnUcy9ip+ksd/uo6MiKYccFuYnK/0uNgKvMdamjaFEykeCoEDKvBgUgBMh3cgVfQNcQA1dHqg6o9NmgufuBKaOGgrQHcFwMCnHc/sx9Hv27OnWud9eOL16QSJdzwafec4+B6tzs4e8wIn6YZo9YztWNMyfiiLetCjtB8GTw16WC7wNxFKuWxoegHx47oeutwaqd8G3OJVlI8KnB+hCPbdSeMpfW6sUPB1tnvdixwvTSjGseLLYEd4UNph0sgkV8VA4Yo7V//M/bL4xy1hPQiQ1ew81szAtZ3HcCEIazZk5COxe4rmiVBaDVHo1L3px6AXYGmKdRDklmo4pAmIdoN9+1E9ETSlSgg7n7XS9FbpPex2Y6flim04KcT3H70JHUZ7xnY1c/GsgGFHqep3Yy3lJTFGwYRYokqQHEZabrHteWnCi8D3jZtkS80U1UxuOJPws1/VhJ9eAcrv2gN9jgL/qFSThxH4PvQxpw7HkYmm7AUuhCLcc0lUoTjm1hw+syRB0GYqhQfRELVnRLVUtnCJU6rKhUAisTMVSDVUH2trK6midalTTmMosxTRkwyo8pq7VFUuHOE5VoVo3odOAuzRYCAjfyp5ruvl9eM8pX/lj8FAlkezIROKtuVcJ1+aOHcCUej20PNhNFfIeZ8SxKBspjn6XObHcZ067XbRJfo6BGWZt/RRXAC6mn65HMb+xhilDivYceF2gokxg2O96MX4VkOFh86tv2F39bI+p9cy6cJYkauN8JjAcIwPVe0RGxA566zb6QppHhqolU6rTPB6yhxiPFts6O0GenWS5JMCb93yDy/kOxxHaCbi71Ft1gFnC8fcQYq5ZUMvvIgcYz8LuBKF437PmD0ocAID5W0CDBadx/bQER5UXO47g0nUwm9BL8NCA11p5eIMPT/qu64XF9O0QqJErCU7LnrD0oj0Y1pBvwdKBMlPXvoprTypOq7OfsuIM5SeiOGdScTX209ScYXLNMUX/8WhuAFFIgl+i5sCvSQQKl6QtskSO2eTnZPDcMXb8OHmUHGtDbljkjjlYeRzLjufjPd+3Xa76xpRVFFXFOHMYAPE28MvDKTtglHJLUA1uCpgUtqCr/PRt6FQzqcronKaQlXK9TcZ7M7Wi3V8pnt/xwg1YVwTxIxnIODVDNwwNNjbYqKkxA6+0ZDFl2YCgSbGYqkEbkLwlc7kDKmKraj3GXXS2vC0q+jGeDEWyxfg369WfbIuA4cT+gLRgvBp6QtLCIZFaSUv0bikiUVEIwN7SRF4XiSESUyQWTisLBbznQwFaIuINiAji/e0v9QYpy2zwkef7Ufr49hdXd/7+/uidK7vvfvyfa//69u7bolyaNjLsLFUl3d/K8ttfNDN5br5ZzKRmcwgShqJwwlAUeT5clAou4i9uRYc0CMNNKYq+fo/w36JBu6jKkJuxP6egUx5o6OBIIbAz6f7YdTLcOseAr4DWjg1IjdhIXfypDYRWIw4yGwCpzkJnrR/yyFMai5xCp3qxeV/+EuBQ+ZDwHAVZkahnO3ASx4jDnM8M6WwztKcMsGyDk0a6gCXS+S3R/AEMkWWbeA5DXM+QG4IVFk6dv5Y0DYN4W6noeHhz+y6MjV8UJIhDFrWCtxnLOaQlzudCnKjbtUOXhPzr2afwGjUBgKTxV4O2zCnAplwBNit8dNRP8/qWEJsJm1IGv0IowG4dShu6ydWBSVskB1PIGHulbprU0nWIA5gmU1njusAwG1+M0mXVgmKFKl4NXzfZGp++cVX4ZUF2Ei6XTl1CHQ5xNoX48iKILz9giOt1CLlkRbFM01At0/qOEZ/Nw+oe4cDgWOv4gYhWfbCJVkRLqqLOB4+2JzzLB4NHe5DhYVTO4FHmg0evwDP68KXR3T+MXrg7f2ytP9ABoqJlcMzhlnE1RgWOlSh0+Tsn5/rd+RExfhSImPsR+toEk4PIjFMe6cAWElnYQ4Lgi1pB9OPaScLv3p/wJ6+NupPXRtOce7j7oQMh8M3lGwcGIFwMgHASgGk3f3QAzN4U5h4U2oVYPjwQh5oP9BZhNNsjhj4fQFaVRL98ffvOje07fyvYdPTnqzu3Pth58/a3d6+K6wvIjj55G7I71y/vXH9h9OlrSLo/G9iPOznnkFC8u3Lv9itQDX+377wqJPJ2Qs7u2y9i9xsfjV67Nrr6xu6fXhLNeRN8/OTznWuvb9/FytFXb45e/rQYbTyXFz6699lNaLx7858wqfmJzlpci+PV8TfMsl64bwSrLKBs4g5hn/pOXM50yhnRwUFBq/ifG0fJoiq3EE2dM0hDt7yfidz77N2yiUC2YiKg4z1MZA8L2VP9XNLh1Q9rmvvydh/1L4P6g8XUP6lIekBF0gUVSScVKVAsFInagr1+/fKEOnf+8T5WvfP7haIrusCtx/1B5s4J7+p53PtDoc0ytOe9Y6reAX/93taSTQbPsUfbZAh/HTIgwwXA/J7uge8Ljp+csS94z0xeofCXhRPw/GuVr8jPll4kl6X8AmT/U5IqjgHMmhNnZfZd+84bn+/evLLQXTv9nm6MD7ff1XmBUSe3+5ixb10bXb8piz0+RqzqjbfvfLHz5nu7H/+bM/LOrRvQ/N6VD0d/vL395Vu7lz8ffYV8gK1ufQBiRi+/Bc+jV18R8YFgDt61NMBlkLjzl0/Be5R9+ei1V7c/v7L9xV93X7y9gLYWOOwvwi/fXH73O6OXJLXj9DxelvAbx7ohwzFA1gxNN5hmUaFg/L6M6oZuWYahyAwCZmV8A1PWe6P8Sgl/tT37J86T/wVQSwcI1k8N1cYNAACWOgAAUEsBAhQAFAAICAgAoHMpUo//M80IBQAALiYAABcAAAAAAAAAAAAAAAAAAAAAAGdlb2dlYnJhX2RlZmF1bHRzMmQueG1sUEsBAhQAFAAICAgAoHMpUgrjiZZLAwAAABEAABcAAAAAAAAAAAAAAAAATQUAAGdlb2dlYnJhX2RlZmF1bHRzM2QueG1sUEsBAhQAFAAICAgAoHMpUtY3vbkZAAAAFwAAABYAAAAAAAAAAAAAAAAA3QgAAGdlb2dlYnJhX2phdmFzY3JpcHQuanNQSwECFAAUAAgICACgcylS1k8N1cYNAACWOgAADAAAAAAAAAAAAAAAAAA6CQAAZ2VvZ2VicmEueG1sUEsFBgAAAAAEAAQACAEAADoXAAAAAA==",    };// is3D=is 3D applet using 3D view, AV=Algebra View, SV=Spreadsheet View, CV=CAS View, EV2=Graphics View 2, CP=Construction Protocol, PC=Probability Calculator DA=Data Analysis, FI=Function Inspector, macro=Macrosvar views = {'is3D': 1,'AV': 0,'SV': 0,'CV': 0,'EV2': 0,'CP': 0,'PC': 0,'DA': 0,'FI': 0,'macro': 0};var applet = new GGBApplet(parameters, '5.0', views);window.onload = function() {applet.inject('ggbApplet')};applet.setPreviewImage('data:image/gif;base64,R0lGODlhAQABAAAAADs=','https://www.geogebra.org/images/GeoGebra_loading.png','https://www.geogebra.org/images/applet_play.png');</script><div id="ggbApplet"></div><blockquote><p>以优化二次型为例，我们的目的时找到矩阵的极值，然而在摸索过程中，沿着有些方向走一小步结果就产生了巨大的变化，如果往另一个方向还走这么大步子又可能对结果没什么影响，这样的二次型矩阵相对那些各个方向变化率差异小的二次型就更加难以优化。</p></blockquote><ul><li>矩阵${\bf{A} } (n\times n)$的<code>条件数</code>，用$Cond(\bf{A})$表示，数学上的定义为矩阵绝对值最大的奇异值(用$\lambda$表示)与绝对值最小的奇异值的商：</li></ul><p>$$<br>Cond({\bf{A} }) = \frac{ { {\lambda _1} } } { { {\lambda _n} } }<br>$$</p><blockquote><p>这个定义的解释是直观的，最大的奇异值表示矩阵的能量主轴，表示可能产生的最大变化率：</p></blockquote><p>$$<br>\max \frac{ {\left|| { {\bf{A}}x} \right||} }{ {\left|| x \right||} } = {\lambda _1}<br>$$</p><blockquote><p>然后最小奇异值$\lambda _n$对应最小的变化率：</p></blockquote><p>$$<br>\min \frac{ {\left|| { {\bf{A}}x} \right||} }{ {\left|| x \right||} } = {\lambda _n}<br>$$</p><blockquote><p>二者的商就是矩阵的<code>条件数</code>。</p></blockquote><h3 id="另一种推导思路"><a href="#另一种推导思路" class="headerlink" title="另一种推导思路"></a>另一种推导思路</h3><ul><li><p>在衡量某个函数敏感度与稳定性时，常使用的一种方法是求导。即观察导数 $df(x)/dx$ 的大小。</p></li><li><p>考虑线性系统$\bf{A}x=b$，其中矩阵$\bf{A}$为$n$阶可逆方阵</p></li><li><p>在$\bf{x}$上加入一个小扰动$\delta $，系统变为：</p></li></ul><p>$$<br>{\bf{A} }( {\bf{x}} + {\bf{\delta } }) = b + {\bf{A\delta } }<br>$$</p><ul><li>用在$\bf{b}$上的变化率与$\bf{x}$上的变化率的比值表示线性系统的稳定程度，这个稳定程度我们用字母$C$表示：</li></ul>$$\begin{array}{l}C &= \frac{{\left| {\left| {{\bf{A\delta }}} \right|} \right|/\left| {\left| {\bf{b}} \right|} \right|}}{{\left| {\left| {\bf{\delta }} \right|} \right|/\left| {\left| {\bf{x}} \right|} \right|}}\\ &= \frac{{\left| {\left| {{\bf{A\delta }}} \right|} \right|}}{{\left| {\left| {\bf{\delta }} \right|} \right|}} \cdot \frac{{\left| {\left| {\bf{x}} \right|} \right|}}{{\left| {\left| {\bf{b}} \right|} \right|}}\\ &= \frac{{\left| {\left| {{\bf{A\delta }}} \right|} \right|}}{{\left| {\left| {\bf{\delta }} \right|} \right|}} \cdot \frac{{\left| {\left| {{{\bf{A}}^{ - 1}}{\bf{b}}} \right|} \right|}}{{\left| {\left| {\bf{b}} \right|} \right|}}\end{array}$$<ul><li>其中模长为范数操作，根据范数的<a href="https://baike.baidu.com/item/%E7%9F%A9%E9%98%B5%E8%8C%83%E6%95%B0/5296169?fr=aladdin">相容性</a>，有：</li></ul>$$\begin{array}{l}C &= \frac{{\left| {\left| {{\bf{A\delta }}} \right|} \right|}}{{\left| {\left| {\bf{\delta }} \right|} \right|}} \cdot \frac{{\left| {\left| {{{\bf{A}}^{ - 1}}{\bf{b}}} \right|} \right|}}{{\left| {\left| {\bf{b}} \right|} \right|}}\\ &\le \frac{{\left| {\left| {\bf{A}} \right|} \right|\left| {\left| {\bf{\delta }} \right|} \right|}}{{\left| {\left| {\bf{\delta }} \right|} \right|}} \cdot \frac{{\left| {\left| {{{\bf{A}}^{ - 1}}} \right|} \right|\left| {\left| {\bf{b}} \right|} \right|}}{{\left| {\left| {\bf{b}} \right|} \right|}}\\ &= \left| {\left| {\bf{A}} \right|} \right|\left| {\left| {{{\bf{A}}^{ - 1}}} \right|} \right|\end{array}$$<h3 id="条件数的性质"><a href="#条件数的性质" class="headerlink" title="条件数的性质"></a>条件数的性质</h3><ul><li><p>对任何非零矩阵$ \bf{A}$, $Cond{\rm{ } }\left( A \right){\rm{ } } \ge {\rm{ } }1$</p></li><li><p>$Cond\left( \bf{I} \right){\rm{ } } = {\rm{ } }1$, $\bf{I}$ 是单位矩阵</p></li><li><p>$Cond\left( {s{\bf{A} } } \right){\rm{ } } = {\rm{ } }Cond\left( {\bf{A} } \right)$, 其中$s$是一个标量</p></li><li><p>对于任何对角矩阵${\bf{A} }{\rm{ } } = {\rm{ } }diag\left( {\bf{d} } \right)$，$Cond\left( {\bf{A} } \right){\rm{ } } = {\rm{ } }max({\bf{d} }){\rm{ } }/{\rm{ }}min({\bf{d} })$</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/bitcarmanlee/article/details/51945271">https://blog.csdn.net/bitcarmanlee/article/details/51945271</a></li><li><a href="https://blog.csdn.net/adminabcd/article/details/46619627">https://blog.csdn.net/adminabcd/article/details/46619627</a></li><li><a href="https://zhuanlan.zhihu.com/p/81053589">https://zhuanlan.zhihu.com/p/81053589</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>math</category>
      
      <category>linear_algebra</category>
      
    </categories>
    
    
    <tags>
      
      <tag>math</tag>
      
      <tag>linear_algebra</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 读取大图片</title>
    <link href="/2021/01/05/python/load-large-image/load-large-image/"/>
    <url>/2021/01/05/python/load-large-image/load-large-image/</url>
    
    <content type="html"><![CDATA[<blockquote><p>python 在读取大图像时会报错，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="读取大图像"><a href="#读取大图像" class="headerlink" title="读取大图像"></a>读取大图像</h3><ul><li>open cv 在读取超过 1G 的图像时会返回 None</li><li>PIL 读取超过一定像素个数的图像会报错</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>解除PIL最大像素个数限制</li><li>之后可以使用skimage或matplot读取大图像</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> skimage <span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> matplotlib.image <span class="hljs-keyword">as</span> gImage<br><br>image_file = <span class="hljs-string">&#x27;test.bmp&#x27;</span><br><br>Image.MAX_IMAGE_PIXELS = <span class="hljs-literal">None</span><br>img_sk = io.imread(image_file)<br>img_ml = gImage.imread(image_file)<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>二次型优化问题 - 6 - 共轭梯度法</title>
    <link href="/2020/12/26/machine_learning/conjugate-gradient-algorithm/conjugate-alg/conjugate-alg/"/>
    <url>/2020/12/26/machine_learning/conjugate-gradient-algorithm/conjugate-alg/conjugate-alg/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍二次型优化方法中比较优秀的迭代方法——共轭梯度法。</p></blockquote><span id="more"></span><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><blockquote><p>重述我们需要优化的问题：</p></blockquote><p>$$<br>f({\bf{x} }) = \frac{1}{2}{\bf{x^TAx} } - { {\bf{b} }^{\bf{T} } }{\bf{x} } + {\bf{c} } \tag{1} \label{1}<br>$$</p><ul><li>矩阵$\bf{A}$正定对称</li><li>目标为优化$\bf{x}$，使得$f(\bf{x})$取得最小值</li></ul><h3 id="最速下降法的问题"><a href="#最速下降法的问题" class="headerlink" title="最速下降法的问题"></a>最速下降法的问题</h3><ul><li>贪心计算局部最小值</li><li>没有全局视野，没有使用真正的模型建模</li><li>导致优化过程需要反复迭代才能逐步逼近最优值</li></ul><h3 id="轭"><a href="#轭" class="headerlink" title="轭"></a>轭</h3><blockquote><p>轭是一个汉字，读作è，本意是指驾车时套在牲口脖子上的曲木，引申义是束缚，控制。该文字在《仪礼·既夕礼》和《荀子·正论》等文献均有记载。        ——百度百科</p></blockquote><p><img src="https://photos.zywvvd.com/icey-mate-book/20201226144811.jpg"></p><ul><li>数学中很多轭相关的内容，此处的共轭表示相互约束，在某个条件下可以相互作用的意思。</li></ul><h3 id="共轭梯度法思想来源"><a href="#共轭梯度法思想来源" class="headerlink" title="共轭梯度法思想来源"></a>共轭梯度法思想来源</h3><ul><li>为解决最速下降法来回往复的问题，人们开始思考是否有可以直接在需要优化的二次函数定义下直接对其进行优化，是否可以通过有限步计算得到真正的最优解</li><li>那么假设我们使用关于该问题精确的模型而不是近似的局部最优模型，我们如果可以在某个N维空间中，分别计算出最优解的各个维度的坐标，就可以达到上述目的</li><li>那么如何设计这个空间，如何可以分步计算并且可以整合成真正的结果，是共轭梯度法来解决的问题</li><li>该方法的核心思想是建立一组N维空间线性无关的一组基，理论上这组基的线性组合可以表示空间中任意一点，共轭梯度法通过多次计算，精确求解目标在空间中位置在这组基空间中的各个系数分量，达到求解最优值的目的</li><li>该方法和最速下降法却别在精确建模，有了上帝视角，每次迭代计算将该方向需要调整的分量值调整到极致，也就是说之后的计算再也不用考虑该方向上的运动分量了，这是一个精确求解问题的过程，不是逐步简单建模向最优值挪动的逼近过程</li></ul><h3 id="共轭基的定义"><a href="#共轭基的定义" class="headerlink" title="共轭基的定义"></a>共轭基的定义</h3><p>设$\bf{A}$为$n$阶实对称正定矩阵，如果有两个$n$维列<a href="https://baike.baidu.com/item/%E5%90%91%E9%87%8F">向量</a>$\bf{s}_1$和$\bf{s}_2$满足</p>$${\bf{s}}_1^T{\bf{A}}{{\bf{s}}_2} = 0 \tag{2} \label{2}$$<p>则称向量$\bf{s}_1$和$\bf{s}_2$对于矩阵$\bf{A}$共轭。如果$\bf{A}$为单位矩阵，则式$\eqref{2}$即成为$\bf{s}_1$$\bf{s}_2$，这样两个向量的点积为零，此二向量在几何上是正交的，它是共轭的一种特例。</p><p>设A为对称正定矩阵，若一组非零向量$\bf{s}_1$,$\bf{s}_2$,…,$\bf{s}_n$满足</p>$${\bf{s}}_i^T{\bf{A}}{{\bf{s}}_j} = 0   (i≠j) \tag{3}$$则称向量系${{\bf{s}}_i}(1 \le i \le n)$为关于矩阵$\bf{A}$共轭。若${{\bf{s}}_i}(1 \le i \le n)$之间线性无关，那么我们称该向量集合为$n$维空间中关于矩阵$\bf{A}$的一组共轭基。<h3 id="共轭基的作用"><a href="#共轭基的作用" class="headerlink" title="共轭基的作用"></a>共轭基的作用</h3><ul><li>假设有一组关于矩阵$\bf{A}$的共轭基$\bf{D}$：</li></ul><p>$$<br>\bf{D}={ {\bf{d}_1},{\bf{d}_2},…,{\bf{d}_n}}  \tag{4}<br>$$</p><ul><li>设二次型函数$\eqref{1}$的极值为$\bf{x}^*$，用$\bf{D}$表似为：</li></ul>$${ {\bf{x} }^*} = {\lambda _1}{ {\bf{d} }_1} + {\lambda _2}{ {\bf{d} }_2} +  \cdots  + {\lambda _n}{ {\bf{d} }_n} \tag{5}$$<ul><li>因为函数极值处在各个方向的导数为0有：</li></ul>$$\begin{array}{l}f'({{\bf{x}}^*}) = {\bf{A}}{{\bf{x}}^*} - {\bf{b}} = 0\\ \Rightarrow {\bf{A}}{{\bf{x}}^*} = {\bf{b}}\end{array} \tag{6}$$<ul><li>我们计算${\bf{d}}_i^T{\bf{A}}{{\bf{x}}^*}$，根据不同共轭基之间相互共轭：</li></ul>$$\begin{array}{l}{\bf{d}}_i^T{\bf{A}}{{\bf{x}}^*} &= {\bf{d}}_i^T{\bf{A}}\left( {{\lambda _0}{{\bf{d}}_0} +  \ldots  + {\lambda _{n - 1}}{{\bf{d}}_{n - 1}}} \right)\\ &= {\lambda _i}{\bf{d}}_i^T{\bf{A}}{{\bf{d}}_i} + 0\\ \tag{7}\end{array} $$<ul><li>得到：</li></ul>$${\lambda _i} = \frac{{{\bf{d}}_i^T{\bf{A}}{{\bf{x}}^*}}}{{{\bf{d}}_i^T{\bf{A}}{{\bf{d}}_i}}} = \frac{{{\bf{d}}_i^T{\bf{b}}}}{{{\bf{d}}_i^T{\bf{A}}{{\bf{d}}_i}}} \tag{8} \label{8}$$<ul><li>对于${\lambda _i}$的求解，我们已知的变量为$\bf{b}$和$\bf{A}$，如果我们已经得到了空间中关于$\bf{A}$的共轭基（任意一组），我们都可以直接解得${\lambda _i}$</li><li>这是一个令人振奋的结论，所以我们当前的工作重点转为了如何快速地求得一组关于$\bf{A}$的共轭基</li></ul><h3 id="根据定义获取共轭基"><a href="#根据定义获取共轭基" class="headerlink" title="根据定义获取共轭基"></a>根据定义获取共轭基</h3><ul><li>有了定义，我们不难想到暴力获取共轭基的方法：</li></ul><pre class="mermaid">    graph TB        A(随机生成n个n维向量)        B{i=1-n循环}        C[剔除向量j=1-i的分量]        E[收集向量1-n]        D[得到向量i]                A-->B        C --> D        D --> B        B-- 循环结束 --> E --> F(输出共轭基)        B-- 循环未结束 -->C</pre><ul><li>这套方法下来，我们就可以得到根据定义计算出来的共轭基，带入$\eqref{8}$计算得到极值，没有任何问题</li><li>但事实上这个运算量与代数法解${\bf{A}}{{\bf{x}}} = {\bf{b}}$的过程具有相当的运算复杂度，没有给该优化问题带来性能收益</li></ul><h3 id="共轭梯度法"><a href="#共轭梯度法" class="headerlink" title="共轭梯度法"></a>共轭梯度法</h3><blockquote><p>此算法核心步骤与最速下降法相同，分别为寻找共轭方向与计算运动步长。</p></blockquote><h4 id="寻找共轭方向"><a href="#寻找共轭方向" class="headerlink" title="寻找共轭方向"></a>寻找共轭方向</h4><blockquote><p>由于计算梯度简单，寻找共轭梯度的过程依附于梯度方向的计算。</p></blockquote><ul><li>优化目标为$\bf{x}^*$，初始位置为$\bf{x}_1$，需要求得的共轭基为 $\bf{D}={ {\bf{d}_1},{\bf{d}_2},…,{\bf{d}_n}}$</li><li>计算初始$\bf{x}_1$位置的梯度，第一个共轭基为梯度的反方向：</li></ul>$${{\bf{d}}_1} =  - {{\bf{g}}_1} =  - ({\bf{A}}{{\bf{x}}_1} - {\bf{b}}) = {\bf{b}} - {\bf{A}}{{\bf{x}}_1} \tag{9}$$<ul><li>第$i$个梯度若要剔除掉第$j$个共轭基$(j&lt;i)$方向的分量，需要减去该方向的$\beta_j $分量：</li></ul>$$\begin{array}{l}{\bf{d}}_j^T{\bf{A}}({{\bf{g}}_i} - \beta_j {{\bf{d}}_j}) = 0\\{\bf{d}}_j^T{\bf{A}}{{\bf{g}}_i} = \beta_j {\bf{d}}_j^T{\bf{A}}{{\bf{d}}_j}\\\beta_j  = \frac{{{\bf{d}}_j^T{\bf{A}}{{\bf{g}}_i}}}{{{\bf{d}}_j^T{\bf{A}}{{\bf{d}}_j}}}\end{array} \tag{10} \label{10}$$<ul><li>因此第$k$个共轭基为：</li></ul>$$\begin{array}{l}{{\bf{d}}_k} = {{\bf{g}}_k} - \sum\limits_{i = 1}^{k - 1} {\frac{{{\bf{d}}_i^T{\bf{A}}{{\bf{g}}_k}}}{{{\bf{d}}_i^T{\bf{A}}{{\bf{d}}_i}}}{{\bf{d}}_i}} \\{{\bf{d}}_k}={{\bf{g}}_k} -\sum\limits_{i = 1}^{k - 1}\beta_i{{\bf{d}}_i}\end{array} \tag{11} \label{11}$$<ul><li>目前，我们如果可以确定每一次迭代移动的$\bf{x}_i$的位置，求得$\bf{g}_i$，那么就可以根据第1到第$i-1$个共轭基确定当前第$i$个共轭基</li><li>因此当前我们的目标是在有了共轭方向后，如何确定在该方向上的运动距离</li></ul><h4 id="确定运动距离"><a href="#确定运动距离" class="headerlink" title="确定运动距离"></a>确定运动距离</h4><blockquote>已经运动到了$\bf{x}_k$的位置，下一个前进方向为${{\bf{d}}_k}$，前进步长${\alpha _k}$，误差为$\bf{e}_{k}=\bf{x}^*-x_{k}$，也就是说：$${{\bf{x}}_{k + 1}}={{\bf{x}}_k} + {\alpha _k}{{\bf{d}}_k} \tag{12}$$</blockquote><blockquote><p>这里介绍两种求前进步长${\alpha _k}$的思路。</p></blockquote><h5 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h5><blockquote><p>确定第$k$步的运动步长${\alpha _k}$，也就是一个共轭基的系数，限制该系数的条件为：</p></blockquote><ul><li>当前共轭基的方向$\bf{d}_{k}$与误差向量$\bf{e}_{k+1}=\bf{x}^*-x_{k+1}$共轭：$$\begin{aligned}\bf{d}_{k}^{T^{\prime}} A e_{k+1} &=\bf{d}_{k}^{T} A\left(x^{*}-x_{k+1}\right) \\&=\bf{d}_{k}^{T} A\left(x^{*}-x_{k}+x_{k}-x_{k+1}\right) \\&=\bf{d}_{k}^{T} A\left(e_{k}-\alpha_{k} \bf{d}_{k}\right) \\&=\bf{d}_{k}^{T} A e_{k}-\alpha_{k} \bf{d}_{k}^{T} A \bf{d}_{k}=0\end{aligned} \tag{13} \label{13}$$</li><li><p>有：</p></li></ul>$$\begin{aligned}\alpha_{k} &=\frac{\bf{d}_{k}^{T} A e_{k}}{\bf{d}_{k}^{T} A \bf{d}_{k}} \\&=\frac{\bf{d}_{k}^{T} A\left(x^{*}-x_{k}\right)}{\bf{d}_{k}^{T} A \bf{d}_{k}} \\&=\frac{\bf{d}_{k}^{T}\left(A x^{*}-A x_{k}\right)}{\bf{d}_{k}^{T} A \bf{d}_{k}} \\&=\frac{\bf{d}_{k}^{T}\left(b-A x_{k}\right)}{\bf{d}_{k}^{T} A \bf{d}_{k}} \\&=-\frac{\bf{d}_{k}^{T} g_{k}}{\bf{d}_{k}^{T} A \bf{d}_{k}}\end{aligned} \tag{14}$$<h5 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h5><blockquote>对$f({{\bf{x}}_{k + 1}})$中的${\alpha _k}$求导，使得导数为0，计算${\alpha _k}$:</blockquote><ul><li>用${{\bf{x}}_k}$表示${{\bf{x}}_{k+1}}$:$$\begin{array}{l}f({{\bf{x}}_{k + 1}}) &= f({{\bf{x}}_k} + {\alpha _k}{{\bf{d}}_k})\\ &= \frac{1}{2}{\bf{x}}_{k + 1}^T{\bf{A}}{{\bf{x}}_{k + 1}} - {{\bf{b}}^T}({{\bf{x}}_k} + {\alpha _k}{{\bf{d}}_k}) + c\end{array} \tag{15}$$</li><li>对$f({{\bf{x}}_{k + 1}})$中${\alpha _k}$求导:$$\begin{array}{l}f'({{\bf{x}}_{k + 1}}|{\alpha _k}) &= \frac{{\partial f({{\bf{x}}_{k + 1}})}}{{\partial {{\bf{x}}_{k + 1}}}}\frac{{\partial {{\bf{x}}_{k + 1}}}}{{\partial {\alpha _k}}}\\ &= {({\bf{A}}{{\bf{x}}_{k + 1}} - {\bf{b}})^T}{{\bf{d}}_k}\\ &= {({\bf{A}}{{\bf{x}}_k} + {\alpha _k}{\bf{A}}{{\bf{d}}_k} - {\bf{b}})^T}{{\bf{d}}_k}\\ &= {({\alpha _k}{\bf{A}}{{\bf{d}}_k} + {{\bf{g}}_k})^T}{{\bf{d}}_k}\\ &= {\alpha _k}{\bf{d}}_k^TA{{\bf{d}}_k} + {\bf{g}}_k^T{{\bf{d}}_k}\end{array} \tag{16}$$</li><li>使导数为0，有:$$\begin{array}{l}{\alpha _k}{\bf{d}}_k^TA{{\bf{d}}_k} + {\bf{g}}_k^T{{\bf{d}}_k} = 0\\{\alpha _k} =  - \frac{{{\bf{g}}_k^T{{\bf{d}}_k}}}{{{\bf{d}}_k^TA{{\bf{d}}_k}}} =  - \frac{{{\bf{d}}_k^T{{\bf{g}}_k}}}{{{\bf{d}}_k^TA{{\bf{d}}_k}}}\end{array} \tag{17}$$</li></ul><blockquote><p>此时我们已经计算得到了一系列计算共轭梯度的方法，能够依次求得一套共轭基了，但是其中有些步骤仍然可以继续简化计算。</p></blockquote><h4 id="简化计算与一些推论"><a href="#简化计算与一些推论" class="headerlink" title="简化计算与一些推论"></a>简化计算与一些推论</h4><h5 id="推论一"><a href="#推论一" class="headerlink" title="推论一"></a>推论一</h5><ul><li>第$k$步计算的梯度$\bf{g}_k$和前$k-1$步的共轭向量${\bf{d}_1,\bf{d}_1,...,\bf{d}_{k-1}}$正交:</li><li>证明，当$i < j$时：$$\begin{array}{l}\bf{d}_i^T{g_j} &= \bf{d}_i^T(A{x_j} - b)\\ &= \bf{d}_i^T(A{x_j} - A{x^*})\\ &=  - \bf{d}_i^T(A{x^*} - {x_{i + 1}} + {x_{i + 1}} - {x_j})\\ &=  - \bf{d}_i^TA({e_{i + 1}} - \sum\limits_{k = i + 1}^{j - 1} {{\alpha _k}{d_k})} \\ &=  - \bf{d}_i^TA{e_{i + 1}} + \sum\limits_{k = i + 1}^{j - 1} {{\alpha _k}d_i^TA{d_k}} \end{array} \tag{18} \label{18}$$</li><li><p>式$\eqref{18}$左边由于$\bf{d}_i$计算过程$\eqref{13}$为0，右边由于不同的共轭向量间两两共轭值为0，所以最终的值也为0</p></li><li>因此证明了：第$ k $步计算的梯度 $ \bf{g}_k$ 和前$k-1$步的共轭向量 $ { \bf{d}_1,\bf{d}_1,...,\bf{d}_{k-1}}$正交。</li></ul><h5 id="推论二"><a href="#推论二" class="headerlink" title="推论二"></a>推论二</h5><ul><li>第$k$步计算的梯度$\bf{g}_k$和前$k-1$步的梯度${\bf{g}_1,\bf{g}_1,...,\bf{g}_{k-1}}$正交:</li><li>证明，当$i < j$时：</li><li><p>由$\eqref{11}$得：</p></li></ul>$${{\bf{g}}_i}={{\bf{d}}_i} +\sum\limits_{k = 1}^{i - 1}\beta_k{{\bf{d}}_k} \tag{19}$$<ul><li>有：</li></ul>$$\begin{array}{l}{\bf{g}}_i^T{{\bf{g}}_j} &= {({{\bf{d}}_i} + \sum\limits_{k = 1}^{i - 1} {{\beta _k}} {{\bf{d}}_k})^T}{{\bf{g}}_j}\\ &= \sum\limits_{k = 1}^i {{\beta _k}} {{\bf{d}}_k}^T{{\bf{g}}_j} \qquad ({\beta _i} = 1) \tag{20} \label{20}\end{array}$$<ul><li>根据<strong>推论一</strong>，式$\eqref{20}$值为0</li><li>证得结论：第$k$步计算的梯度$\bf{g}_k$和前$k-1$步的梯度${\bf{g}_1,\bf{g}_1,...,\bf{g}_{k-1}}$正交。</li><li>那么对于两个不同的梯度$\bf{g}_i, \bf{g}_j(i \ne j)$，那么二者必分前后，因此各个梯度之间相互正交，即${\bf{G}} = \{ {{\bf{g}}_{1,}}{{\bf{g}}_2},...,{{\bf{g}}_n}\} $组成了$n$维空间中的一组正交基</li></ul><h5 id="推论三"><a href="#推论三" class="headerlink" title="推论三"></a>推论三</h5><ul><li>计算${\bf{g}}_{j + 1}^T{{\bf{g}}_i}$:$$\begin{array}{l}{\bf{g}}_{j + 1}^T{{\bf{g}}_i} &= {({\bf{A}}{{\bf{x}}_{j + 1}} - {\bf{b}})^T}{{\bf{g}}_i}\\ &= {({\bf{A}}({{\bf{x}}_j} + {\alpha _j}{{\bf{d}}_j}) - {\bf{b}})^T}{{\bf{g}}_i}\\ &= {({\bf{A}}{{\bf{x}}_j} - {\bf{b}} + {\alpha _j}{\bf{A}}{{\bf{d}}_j})^T}{{\bf{g}}_i}\\& = {({{\bf{g}}_j} + {\alpha _j}{\bf{A}}{{\bf{d}}_j})^T}{{\bf{g}}_i}\\ &= {\bf{g}}_j^T{{\bf{g}}_i} + {\alpha _j}{\bf{d}}_j^TA{{\bf{g}}_i}\\{\bf{d}}_j^TA{{\bf{g}}_i}& = \frac{1}{{{\alpha _j}}}({\bf{g}}_{j + 1}^T{{\bf{g}}_i} - {\bf{g}}_j^T{{\bf{g}}_i})\end{array} \tag{21} \label{21}$$</li><li><p>根据式$\eqref{21}$和<strong>推论二</strong>，由于一般情况下$\alpha _j$不为0，因此对于所有情况为保证$\eqref{20}$成立，需要当$i \ne j$且$i \ne j+1$时，${\bf{d}}_j^TA{{\bf{g}}_i}=0$ </p></li><li><p>这意味着当前的梯度方向与上一个共轭方向之前的和当前之后的所有共轭方向共轭正交</p></li></ul><h5 id="简化计算"><a href="#简化计算" class="headerlink" title="简化计算"></a>简化计算</h5><ul><li>对于式$\eqref{11}$中，在求解$\bf{d}_k$过程中产生的系数$\beta$，此处强调一下$\eqref{10}$:</li></ul>$${\beta _i} = \frac{{{\bf{d}}_i^T{\bf{A}}{{\bf{g}}_k}}}{{{\bf{d}}_i^T{\bf{A}}{{\bf{d}}_i}}}$$ <ul><li><p>由<strong>推论三</strong>，$\eqref{10}$中当$i\ne k$且$i \ne k-1$时，${{\bf{d}}_i^T{\bf{A}}{{\bf{g}}_k}}$值为0 </p></li><li>因此式$\eqref{11}$可以简化为：$$\begin{array}{l}{{\bf{d}}_k} &= {{\bf{g}}_k} - \sum\limits_{i = 1}^{k - 1} {{\beta _i}} {{\bf{d}}_i}\\&= {{\bf{g}}_k} -  {{\beta _{k-1}}} {{\bf{d}}_{k-1}}\end{array} \tag{22} \label{22}$$ </li><li><p>即在求解第$k$个共轭基时，仅需要在当前梯度$\bf{g}_k$上减去第$k-1$个共轭基的共轭分量即可</p></li></ul><h5 id="推论四"><a href="#推论四" class="headerlink" title="推论四"></a>推论四</h5><ul><li>根据<strong>简化计算</strong>的公式$\eqref{22}$，有:</li></ul>$$\begin{array}{l}{{\bf{d}}_k} &= {{\bf{g}}_k} - {\beta _{k - 1}}{{\bf{d}}_{k - 1}}\\ &= {{\bf{g}}_k} - {\beta _{k - 1}}({{\bf{g}}_{k - 1}} - {\beta _{k - 2}}{{\bf{d}}_{k - 2}})\\ &= {{\bf{g}}_k} + {\gamma _{k - 1}}{{\bf{g}}_{k - 1}} + {\gamma _{k - 2}}{{\bf{g}}_{k - 2}} +  \cdots {\gamma _1}{{\bf{g}}_1}\\ &= \sum\limits_{i = 1}^k {{\gamma _i}{{\bf{g}}_i}} \end{array} \tag{23}$$ <ul><li>其中固定的常数系数用$\gamma$表示</li><li>那么有：</li></ul>$$\begin{array}{l}{\bf{g}}_i^T{{\bf{d}}_j} &= {\bf{g}}_i^T\sum\limits_{k = 1}^j {{\gamma _k}{{\bf{g}}_k}} \\& = \sum\limits_{k = 1}^j {{\gamma _k}{\bf{g}}_i^T{{\bf{g}}_k}} \end{array} \tag{24} \label{24}$$ <ul><li>式$\eqref{24}$根据<strong>推论二</strong>的结论，值为：</li></ul>$${\bf{g}}_i^T{{\bf{d}}_j} = \left\{ {\begin{array}{*{20}{c}}{0,i > j}\\{\gamma_i{\bf{g}}_i^T{{\bf{g}}_i},i \le j}\end{array}} \right. \tag{25}$$ <ul><li>即某个梯度与所有共轭基的投影为0或一个常数（对该方法来说不是一个有实用性的结论）</li></ul><h4 id="共轭梯度法实操步骤"><a href="#共轭梯度法实操步骤" class="headerlink" title="共轭梯度法实操步骤"></a>共轭梯度法实操步骤</h4><ul><li>初始条件：已知$\bf{A}, \bf{b}$，初始位置$\bf{x}_1$</li><li>$\bf{g}_1=\bf{A}\bf{x}_1-\bf{b}$ </li><li>${{\bf{d}}_1} =  - {{\bf{g}}_{\bf{1}}}$ </li><li>$k=1$</li><li>$while  \quad k \le  n:$<ul><li>$\alpha_{k}  = - \frac{{{\bf{d}}_k^T{{\bf{g}}_k}}}{{{\bf{d}}_k^TA{{\bf{d}}_k}}}$ </li><li>$\bf{x}_{k+1}=\bf{x}_k+\alpha_{k}{\bf{d}}_k$ </li><li>$\bf{g}_{k+1}=\bf{A}\bf{x}_{k+1}-\bf{b}$ </li><li>${\beta _k} = \frac{{{\bf{d}}_k^T{\bf{A}}{{\bf{g}}_{k+1}}}}{{{\bf{d}}_k^T{\bf{A}}{{\bf{d}}_k}}}$ </li><li>${{\bf{d}}_{k+1}}={{\bf{g}}_{k+1}} -  {{\beta _{k}}} {{\bf{d}}_{k}}$ </li><li>$k=k+1$</li></ul></li><li>$return  \quad  \bf{x}_{n+1}$</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://baike.baidu.com/item/%E5%85%B1%E8%BD%AD%E6%96%B9%E5%90%91/9312634?fr=aladdin">https://baike.baidu.com/item/%E5%85%B1%E8%BD%AD%E6%96%B9%E5%90%91/9312634?fr=aladdin</a></li><li><a href="https://blog.csdn.net/lusongno1/article/details/78550803">https://blog.csdn.net/lusongno1/article/details/78550803</a></li><li><a href="https://blog.csdn.net/weixin_37895339/article/details/84640137">https://blog.csdn.net/weixin_37895339/article/details/84640137</a></li><li><a href="https://zhuanlan.zhihu.com/p/64227658">https://zhuanlan.zhihu.com/p/64227658</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -16- 折叠博客内容</title>
    <link href="/2020/12/26/hexo/16_fold-content/fold-content/"/>
    <url>/2020/12/26/hexo/16_fold-content/fold-content/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在写博客时，可能会遇到需要读者选读的内容，此时出现了折叠博客内容的需求。本文介绍在Hexo中自定义折叠部分内容的方法。</p></blockquote><span id="more"></span><h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><ul><li>可折叠部分内容，暴露标题，在读者需要查看标题下内容时点击展开</li><li>支持尽可能多的markdown语法</li><li>方便快速</li></ul><h3 id="方法一：-HTML语法-使用-details-元素"><a href="#方法一：-HTML语法-使用-details-元素" class="headerlink" title="方法一： HTML语法 - 使用 details 元素"></a>方法一： HTML语法 - 使用 details 元素</h3><h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><blockquote><p>使用 <code>&lt;details&gt; &lt;/details&gt;</code> 标签包裹需要隐藏的内容<br>在其中使用<code>&lt;summary&gt; &lt;/summary&gt;</code>标签包裹需要隐藏内容的标题</p></blockquote><details>  <summary>隐藏内容的标题</summary><p>隐藏文字隐藏文字隐藏文字。  </p><p>支持 <code>markdown</code> 语法</p><h5 id="支持标题"><a href="#支持标题" class="headerlink" title="支持标题"></a>支持标题</h5><h5 id="支持简单文本编辑"><a href="#支持简单文本编辑" class="headerlink" title="支持简单文本编辑"></a>支持简单文本编辑</h5><ul><li>支持 <strong>粗体</strong>、<em>斜体</em></li></ul><h5 id="支持列表"><a href="#支持列表" class="headerlink" title="支持列表"></a>支持列表</h5><ul><li>列表1</li><li>列表2</li></ul><h5 id="支持图片"><a href="#支持图片" class="headerlink" title="支持图片"></a>支持图片</h5><ul><li>md插入图片语法：<img src="https://www.zywvvd.com/about/index/1.png" alt="markdown 图片"></li><li>html插入图片语法：</li></ul><div style='margin:0 auto'><img src="https://www.baidu.com/img/baidu_jgylogo3.gif"  /></div><h5 id="支持代码块"><a href="#支持代码块" class="headerlink" title="支持代码块"></a>支持代码块</h5><ul><li>行内代码 <code>markdown</code></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;initializer_list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">A</span> &#123;</span><br><span class="hljs-built_in">A</span>() &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;1&quot;</span>; &#125;<br><span class="hljs-built_in">A</span>(<span class="hljs-keyword">int</span>) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;2&quot;</span>; &#125;<br><span class="hljs-built_in">A</span>(std::initializer_list&lt;<span class="hljs-keyword">int</span>&gt;) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;3&quot;</span>; &#125;<br>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>&#123;<br>A a1;<br>A a2&#123;&#125;;<br>A a3&#123; <span class="hljs-number">1</span> &#125;;<br>A a4&#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span> &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="支持表格"><a href="#支持表格" class="headerlink" title="支持表格"></a>支持表格</h5><table><thead><tr><th>文字</th><th>文字</th></tr></thead><tbody><tr><td>文字</td><td>文字</td></tr></tbody></table><h5 id="支持公式"><a href="#支持公式" class="headerlink" title="支持公式"></a>支持公式</h5><ul><li>行内公式$Y=aX^2+bX+c$<br>$$<br>Y=aX^2+bX+c<br>$$</li></ul></details><h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><blockquote><p>上述示例代码如下(由于markdown解码问题，示例cpp代码段前后的 ``` 请自行补全)：</p></blockquote><details>  <summary>示例代码</summary><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs clean">&lt;details&gt;<br>  &lt;summary&gt;隐藏内容的标题&lt;/summary&gt;<br><br>隐藏文字隐藏文字隐藏文字。  <br><br>支持 `markdown` 语法<br><br>##### 支持标题<br><br>##### 支持简单文本编辑<br>- 支持 **粗体**、*斜体*<br><br>##### 支持列表<br>- 列表<span class="hljs-number">1</span><br>- 列表<span class="hljs-number">2</span><br><br>##### 支持图片<br>- md插入图片语法：![markdown 图片](https:<span class="hljs-comment">//www.zywvvd.com/about/index/1.png)</span><br>- html插入图片语法：<br><br>&lt;div style=<span class="hljs-string">&#x27;margin:0 auto&#x27;</span>&gt;<br>&lt;img src=<span class="hljs-string">&quot;https://www.baidu.com/img/baidu_jgylogo3.gif&quot;</span>  /&gt;<br>&lt;/div&gt;<br><br>##### 支持代码块<br>- 行内代码 `markdown`<br><br>cpp<br>#include &lt;initializer_list&gt;<br>#include &lt;iostream&gt;<br>struct A &#123;<br>    A() &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;1&quot;</span>; &#125;<br>    A(int) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;2&quot;</span>; &#125;<br>    A(std::initializer_list&lt;int&gt;) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;3&quot;</span>; &#125;<br>&#125;;<br>int main(int argc, char *argv[]) &#123;<br>    A a1;<br>    A a2&#123;&#125;;<br>    A a3&#123; <span class="hljs-number">1</span> &#125;;<br>    A a4&#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span> &#125;;<br>&#125;<br><br>##### 支持表格<br><br>| 文字 | 文字 |<br>| ---- | ---- |<br>| 文字 | 文字 |<br><br>##### 支持公式<br>- 行内公式$Y=aX^<span class="hljs-number">2</span>+bX+c$<br>$$<br>Y=aX^<span class="hljs-number">2</span>+bX+c<br>$$<br><br>&lt;/details&gt;<br></code></pre></td></tr></table></figure></details><h3 id="方法二：-使用hexo-sliding-spoiler插件"><a href="#方法二：-使用hexo-sliding-spoiler插件" class="headerlink" title="方法二： 使用hexo-sliding-spoiler插件"></a>方法二： 使用hexo-sliding-spoiler插件</h3><h4 id="官网链接"><a href="#官网链接" class="headerlink" title="官网链接"></a>官网链接</h4><p><a href="https://github.com/fletchto99/hexo-sliding-spoiler">hexo-sliding-spoiler</a></p><h4 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install hexo-sliding-spoiler <span class="hljs-comment">--save</span><br></code></pre></td></tr></table></figure><h4 id="自定义设置"><a href="#自定义设置" class="headerlink" title="自定义设置"></a>自定义设置</h4><ul><li>可以修改<code>css</code>文件来自定义配置样式</li></ul><blockquote><p>例如：可以自定义修改默认的 <code>show hide</code> 关键字</p><ul><li>打开文件 <code>hexo\node_modules\hexo-sliding-spoiler\assets\spoiler.css</code>，找到25-31行，修改其中的 <code>content</code>。</li><li>例如： 将<code>Show</code> 改为 <code>▶</code> ，<code>Hide</code>改为<code>▼</code></li></ul></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-class">.spoiler</span><span class="hljs-selector-class">.collapsed</span> <span class="hljs-selector-class">.spoiler-title</span>:before &#123;<br>    <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;Show: &quot;</span>;<br>&#125;<br><br><span class="hljs-selector-class">.spoiler</span><span class="hljs-selector-class">.expanded</span> <span class="hljs-selector-class">.spoiler-title</span>:before &#123;<br>    <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;Hide: &quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="使用方法-1"><a href="#使用方法-1" class="headerlink" title="使用方法"></a>使用方法</h4><blockquote><p>安装好插件后，使用 <code> {% spoiler "隐藏内容的标题" %} </code> 和<code> {% endspoiler %}</code>包裹需要隐藏的内容即可。</p></blockquote><div class='spoiler collapsed'>    <div class='spoiler-title'>        隐藏内容的标题    </div>    <div class='spoiler-content'>        <p>隐藏文字隐藏文字隐藏文字。  </p><p>支持 <code>markdown</code> 语法</p><h5 id="支持标题"><a href="#支持标题" class="headerlink" title="支持标题"></a>支持标题</h5><h5 id="支持简单文本编辑"><a href="#支持简单文本编辑" class="headerlink" title="支持简单文本编辑"></a>支持简单文本编辑</h5><ul><li>支持 <strong>粗体</strong>、<em>斜体</em></li></ul><h5 id="支持列表"><a href="#支持列表" class="headerlink" title="支持列表"></a>支持列表</h5><ul><li>列表1</li><li>列表2</li></ul><h5 id="支持图片"><a href="#支持图片" class="headerlink" title="支持图片"></a>支持图片</h5><ul><li>md插入图片语法：<img src="https://www.zywvvd.com/about/index/1.png" alt="markdown 图片"></li><li>html插入图片语法：</li></ul><div style='margin:0 auto'><img src="https://www.baidu.com/img/baidu_jgylogo3.gif"  /></div><h5 id="支持代码块"><a href="#支持代码块" class="headerlink" title="支持代码块"></a>支持代码块</h5><ul><li>行内代码 <code>markdown</code></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;initializer_list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">A</span> &#123;</span><br>    <span class="hljs-built_in">A</span>() &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;1&quot;</span>; &#125;<br>    <span class="hljs-built_in">A</span>(<span class="hljs-keyword">int</span>) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;2&quot;</span>; &#125;<br>    <span class="hljs-built_in">A</span>(std::initializer_list&lt;<span class="hljs-keyword">int</span>&gt;) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;3&quot;</span>; &#125;<br>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span> </span>&#123;<br>    A a1;<br>    A a2&#123;&#125;;<br>    A a3&#123; <span class="hljs-number">1</span> &#125;;<br>    A a4&#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span> &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="支持表格"><a href="#支持表格" class="headerlink" title="支持表格"></a>支持表格</h5><table><thead><tr><th>文字</th><th>文字</th></tr></thead><tbody><tr><td>文字</td><td>文字</td></tr></tbody></table><h5 id="支持公式"><a href="#支持公式" class="headerlink" title="支持公式"></a>支持公式</h5><ul><li>行内公式$Y=aX^2+bX+c$<br>$$<br>Y=aX^2+bX+c<br>$$</li></ul>    </div></div><h4 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h4><blockquote><p>上述示例代码如下(由于markdown解码问题，示例cpp代码段前后的 ``` 请自行补全)：</p></blockquote><div class='spoiler collapsed'>    <div class='spoiler-title'>        示例代码    </div>    <div class='spoiler-content'>        <figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs clean">&#123;% spoiler <span class="hljs-string">&quot;隐藏内容的标题&quot;</span> %&#125;<br><br>隐藏文字隐藏文字隐藏文字。  <br><br>支持 `markdown` 语法<br><br>##### 支持标题<br><br>##### 支持简单文本编辑<br>- 支持 **粗体**、*斜体*<br><br>##### 支持列表<br>- 列表<span class="hljs-number">1</span><br>- 列表<span class="hljs-number">2</span><br><br>##### 支持图片<br>- md插入图片语法：![markdown 图片](https:<span class="hljs-comment">//www.zywvvd.com/about/index/1.png)</span><br>- html插入图片语法：<br><br>&lt;div style=<span class="hljs-string">&#x27;margin:0 auto&#x27;</span>&gt;<br>&lt;img src=<span class="hljs-string">&quot;https://www.baidu.com/img/baidu_jgylogo3.gif&quot;</span>  /&gt;<br>&lt;/div&gt;<br><br>##### 支持代码块<br>- 行内代码 `markdown`<br><br>cpp<br>#include &lt;initializer_list&gt;<br>#include &lt;iostream&gt;<br>struct A &#123;<br>    A() &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;1&quot;</span>; &#125;<br>    A(int) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;2&quot;</span>; &#125;<br>    A(std::initializer_list&lt;int&gt;) &#123; std::cout &lt;&lt; <span class="hljs-string">&quot;3&quot;</span>; &#125;<br>&#125;;<br>int main(int argc, char *argv[]) &#123;<br>    A a1;<br>    A a2&#123;&#125;;<br>    A a3&#123; <span class="hljs-number">1</span> &#125;;<br>    A a4&#123; <span class="hljs-number">1</span>, <span class="hljs-number">2</span> &#125;;<br>&#125;<br><br><br>##### 支持表格<br><br>| 文字 | 文字 |<br>| ---- | ---- |<br>| 文字 | 文字 |<br><br>##### 支持公式<br>- 行内公式$Y=aX^<span class="hljs-number">2</span>+bX+c$<br>$$<br>Y=aX^<span class="hljs-number">2</span>+bX+c<br>$$<br><br>&#123;% endspoiler %&#125;<br></code></pre></td></tr></table></figure>    </div></div><h3 id="方法对比"><a href="#方法对比" class="headerlink" title="方法对比"></a>方法对比</h3><table><thead><tr><th></th><th>details</th><th>endspoiler</th></tr></thead><tbody><tr><td>markdown支持</td><td>基本支持常用语法</td><td>基本支持常用语法</td></tr><tr><td>使用</td><td>直接使用</td><td>需要安装插件</td></tr><tr><td>外观</td><td>简洁清爽，保留原始格式</td><td>默认灰色底边，内容带框</td></tr><tr><td>动画</td><td>无</td><td>有过渡动画</td></tr><tr><td>配置</td><td>不需要/无法配置</td><td>可以自定义配置显示样式</td></tr></tbody></table><blockquote><p>个人建议使用 <code>endspoiler</code>插件，毕竟是为hexo设计的插件，可以进行自定义配置。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_36408085/article/details/104323711">https://blog.csdn.net/qq_36408085/article/details/104323711</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -15- 解决 Hexo Mathjax 无法显示多行公式的问题</title>
    <link href="/2020/12/22/hexo/15_formula/formula-error/"/>
    <url>/2020/12/22/hexo/15_formula/formula-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Hexo比较好用的公式插件是Mathjax，但由于swig的文件解析机制，使得多行公式无法在Hexo中正常显示，本文介绍该问题的解决方法。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><ul><li>准备输入一个矩阵：</li></ul>$$A = \left( {\begin{array}{*{20}{c}}1&{}&{}&{}\\{}&1&{}&{}\\{}&{}&1&{}\\{}&{}&{}&1\end{array}} \right)$$<ul><li>再输入一个多行公式</li></ul>$$\begin{array}{l}z &= {(x + y)^2}\\ &= {x^2} + {y^2} + 2xy\end{array}$$<h4 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h4><ul><li>此时运行 <code>hexo g</code> 或<code>hexo s</code>有可能报错：</li></ul><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">Unhandled rejection Nunjucks <span class="hljs-literal">Error</span>:  [<span class="hljs-literal">Line</span> <span class="hljs-number">11</span>, Column <span class="hljs-number">65</span>] expected <span class="hljs-keyword">variable</span> <span class="hljs-keyword">end</span><br>    =====               <span class="hljs-keyword">Context</span> Dump               =====<br>    === (<span class="hljs-literal">line</span> number probably different from source) ===<br><br></code></pre></td></tr></table></figure><h4 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h4><ul><li>或者显示公式不正常，多行公式会挤成一行：</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20201222003739.png"></p><h3 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h3><h4 id="问题1-1"><a href="#问题1-1" class="headerlink" title="问题1"></a>问题1</h4><ul><li>由于hexo解码时关注{{，}}，%% 等连续字符，会将这部分代码解读为其他带有特殊含义的内容</li><li>如果公式中恰巧出现了此类字符，会报出上述错误</li></ul><h4 id="问题2-1"><a href="#问题2-1" class="headerlink" title="问题2"></a>问题2</h4><ul><li>由于hexo在公式中的<code>\\</code>错会成了转义符，也就是说他只看见了一个反斜杠，不会执行换行命令，导致公式堆成一行</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><h4 id="临时方案"><a href="#临时方案" class="headerlink" title="临时方案"></a>临时方案</h4><h5 id="针对问题1"><a href="#针对问题1" class="headerlink" title="针对问题1"></a>针对问题1</h5><ul><li>可以在连续的 <code>&#123;</code> <code>&#125;</code> <code>%</code>中间插入空格，分开就没事了</li></ul><h5 id="针对问题2"><a href="#针对问题2" class="headerlink" title="针对问题2"></a>针对问题2</h5><ul><li>可以将<code>\\</code>换成<code>\\\\</code>，可以实现公式的多行正确显示</li></ul><h4 id="终极方案"><a href="#终极方案" class="headerlink" title="终极方案"></a>终极方案</h4><ul><li><p>在官方文档中提到了可以为hexo提供标记，阻止其按照自己的规则解释我们的字符串，显示其原本的含义</p></li><li><p>标记为 </p><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name">raw</span> %&#125;</span><span class="xml"></span><br><span class="xml">...</span><br><span class="xml"></span><span class="hljs-template-tag">&#123;% <span class="hljs-name">endraw</span> %&#125;</span><br></code></pre></td></tr></table></figure></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>geogebra 图形嵌入网页，Hexo文章</title>
    <link href="/2020/12/19/tools/geogebra/geogebra-html-embed/geogebra-html-embed/"/>
    <url>/2020/12/19/tools/geogebra/geogebra-html-embed/geogebra-html-embed/</url>
    
    <content type="html"><![CDATA[<blockquote><p>geogebra是优秀的数学绘图工具，可以描述数学图像并演示，支持互动，功能强大。本文介绍将geogebra嵌入网页的方法。</p></blockquote><span id="more"></span><h3 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h3><blockquote><p><code>geogebra</code>的强大功能勾引着我想要在自己的博客里实现演示功能，有一些自己设定的需求：</p></blockquote><ul><li>可以展示我自己设计的<code>geogebra</code>图形；</li><li>带有滑块可以互动控制；</li><li>可以支持动画自动演示；</li><li>不要带其他编辑控件，仅能控制我设计的部分；</li><li>可以控制显示的图形按钮；</li><li>不依赖<code>geogebra</code>官网，搭建属于自己的服务；</li><li>可以方便地在博客/网页中插入、编辑、删除各个演示内容；</li><li>不依赖已经分享好的链接，仅依赖实际演示图信息；</li><li>速度不能太慢；</li><li>演示图形要居中。</li></ul><h3 id="调研报告"><a href="#调研报告" class="headerlink" title="调研报告"></a>调研报告</h3><blockquote><p>为满足上述需求我做了几天的调研，网上清楚明白说这个事情的信息很少，而且很杂乱，我把我获取到的信息汇总在这里。</p></blockquote><h4 id="geogebra"><a href="#geogebra" class="headerlink" title="geogebra"></a>geogebra</h4><ul><li><p>官方网站：<a href="https://www.geogebra.org/">https://www.geogebra.org/</a></p></li><li><p>当前流行的版本主要是<code>geogebra 5</code> 和 <code>geogebra 6</code></p></li><li><p><code>geogebra 5</code>更加经典，可以导出动画，6不支持动画导出</p></li><li><p>二者可以导出<code>ggb文件</code>和html代码</p></li><li><p>但是使用官方html代码得到的演示图必须带编辑工具控件，删除会使图形失效</p></li></ul><h4 id="desmos"><a href="#desmos" class="headerlink" title="desmos"></a>desmos</h4><ul><li><code>desmos</code>也是类似的数学画板工具，加载很快，嵌入链接分享很方便，使用逻辑和<code>geogebra</code>几乎相同</li><li>有一个不得不弃用的问题是导出的演示图不带滑块，无法动态互动</li></ul><h4 id="geogebra-图形信息"><a href="#geogebra-图形信息" class="headerlink" title="geogebra 图形信息"></a>geogebra 图形信息</h4><ul><li>事实上绘制好的图形信息是有固定格式的</li><li>为了唯一确定该信息并在别处引用，我目前了解到四种方法：<ul><li><code>material_id</code> ： 一些在<code>geogebra</code>官网上的图形有固定的唯一ID，可以将其作为确定内容的标识</li><li><code>ggb文件</code>： 直接记录和保存图形信息的文件</li><li><code>ggbBase64代码</code>：将图形信息编码成字符串的一种信息保存方式，从信息量来看和<code>ggb文件</code>是等价的</li><li>分享链接：可以将编辑好的图形上传到<code>geogebra</code>官网上，官网生成唯一的链接返回来用于分享</li></ul></li><li>四种方式中，分享链接是最方便的，不需要对博客/网页项目进行任何修改，用<code>iframe</code>插入引用控件，直接引入来自官网的图形</li><li>material_id我还不知道如何获取，了解不多，而且因为这个ID不包含任何内容信息，总有一种不靠谱的感觉</li><li>我比较信赖的<code>geogebra</code>图形引用形式还是<code>ggb文件</code>和<code>ggbBase64代码</code>的引用方式</li><li>选中别人分享的图形，按下快捷键<code>ctrl + shift + B</code>可以复制该图形的<code>ggbBase64</code>代码</li></ul><h4 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h4><ul><li><code>geogebra</code>制作的教程千千万，在此不表，本文主要关注图形嵌入网页的教程</li><li>网页嵌入官方教程：<a href="https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters">https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters</a></li></ul><blockquote><p>目前见到满足我需求最靠谱的站长，在此感谢大神分享，大家有需要也可以去他的站点学习</p></blockquote><ul><li><a href="https://kz16.top/">https://kz16.top/</a></li></ul><blockquote><p>也是这位大佬，在B站发布的视频教程，很良心</p></blockquote><ul><li><a href="https://www.bilibili.com/video/av80321187/">https://www.bilibili.com/video/av80321187/</a></li></ul><h3 id="网页嵌入方法"><a href="#网页嵌入方法" class="headerlink" title="网页嵌入方法"></a>网页嵌入方法</h3><h4 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h4><blockquote><p><code>iframe</code> 元素会创建包含另外一个文档的内联框架（即行内框架）。</p></blockquote><h5 id="获取geogebra图形的iframe代码"><a href="#获取geogebra图形的iframe代码" class="headerlink" title="获取geogebra图形的iframe代码"></a>获取<code>geogebra</code>图形的<code>iframe</code>代码</h5><ul><li>打开<code>geogebra 6</code>（网页版、客户端都可以），<a href="https://www.geogebra.org/classic">https://www.geogebra.org/classic</a> 并编辑内容</li><li>分享后获得分享链接，替换<code>src</code>内容部分</li><li>此处以<a href="https://blog.csdn.net/fatty_zhu/article/details/77411254%E7%9A%84%E7%A4%BA%E4%BE%8Bsrc%E4%B8%BA%E4%BE%8B%EF%BC%9A">https://blog.csdn.net/fatty_zhu/article/details/77411254的示例src为例：</a></li></ul><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs abnf">&lt;iframe <br><span class="hljs-attribute">scrolling</span>=<span class="hljs-string">&quot;no&quot;</span> <br><span class="hljs-attribute">title</span>=<span class="hljs-string">&quot;布丰投针实验&quot;</span> src=<span class="hljs-string">&quot;https://www.geogebra.org/material/iframe/id/A25F9Tzs/width/1347/height/598/border/888888/smb/false/stb/false/stbh/false/ai/false/asb/false/sri/true/rc/false/ld/false/sdz/true/ctl/false&quot;</span> <br><span class="hljs-attribute">width</span>=<span class="hljs-string">&quot;800px&quot;</span> <br><span class="hljs-attribute">height</span>=<span class="hljs-string">&quot;400px&quot;</span>&gt;<br>&lt;/iframe&gt;<br></code></pre></td></tr></table></figure><ul><li>上述代码放在单独的html文件中即可运行</li></ul><h4 id="官网js解析ggb文件信息"><a href="#官网js解析ggb文件信息" class="headerlink" title="官网js解析ggb文件信息"></a>官网js解析ggb文件信息</h4><ul><li>将画好的图形下载成<code>ggb文件</code>格式</li><li>将该文件上传到网络（不允许读取本地的文件），链接必须为<code>http, data, chrome, chrome-extension, chrome-untrusted, https</code>类型之一。</li><li>获取文件链接，以我的链接 <a href="https://photos.zywvvd.com/images_matrixtime/20201219164932.ggb">https://photos.zywvvd.com/images_matrixtime/20201219164932.ggb</a> 为例</li><li>向html文件黏贴代码：</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.geogebra.org/apps/deployggb.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ggbApplet&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">var</span> parameters = &#123;</span><br><span class="javascript"><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">468</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">492</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;showToolBar&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;zh&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;filename&quot;</span>:<span class="hljs-string">&quot;https://photos.zywvvd.com/images_matrixtime/20201219164932.ggb&quot;</span>,</span><br><span class="javascript">&#125;;</span><br><span class="javascript"><span class="hljs-comment">// is3D=is 3D applet using 3D view, AV=Algebra View, SV=Spreadsheet View, CV=CAS View, EV2=Graphics View 2, CP=Construction Protocol, PC=Probability Calculator DA=Data Analysis, FI=Function Inspector, macro=Macros</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> views = &#123;<span class="hljs-string">&#x27;is3D&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;AV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;SV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;CV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;EV2&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;CP&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;PC&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;DA&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;FI&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;macro&#x27;</span>: <span class="hljs-number">0</span>&#125;;</span><br><span class="javascript"><span class="hljs-keyword">var</span> applet = <span class="hljs-keyword">new</span> GGBApplet(parameters, <span class="hljs-string">&#x27;5.0&#x27;</span>, views);</span><br><span class="javascript"><span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;applet.inject(<span class="hljs-string">&#x27;ggbApplet&#x27;</span>)&#125;;</span><br><span class="javascript">applet.setPreviewImage(<span class="hljs-string">&#x27;data:image/gif;base64,R0lGODlhAQABAAAAADs=&#x27;</span>,<span class="hljs-string">&#x27;https://www.geogebra.org/images/GeoGebra_loading.png&#x27;</span>,<span class="hljs-string">&#x27;https://www.geogebra.org/images/applet_play.png&#x27;</span>);</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="官网js解析ggbBase64信息"><a href="#官网js解析ggbBase64信息" class="headerlink" title="官网js解析ggbBase64信息"></a>官网js解析ggbBase64信息</h4><ul><li><h5 id="事实上就是按照官方教程行事-https-wiki-geogebra-org-en-Reference-GeoGebra-App-Parameters"><a href="#事实上就是按照官方教程行事-https-wiki-geogebra-org-en-Reference-GeoGebra-App-Parameters" class="headerlink" title="事实上就是按照官方教程行事 https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters"></a>事实上就是按照官方教程行事 <a href="https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters">https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters</a></h5></li><li><p>获取<code>ggbBase64</code>可以在 <a href="https://geogebra.kz16.top/">https://geogebra.kz16.top/</a> 上作图，直接得到代码</p></li><li><p>也可以将画好的图形下载成<code>网页.html</code>格式</p></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201219152843.png"></p><ul><li>得到如下这段代码，这段代码直接黏贴到一个空的html文件联网即可运行。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.geogebra.org/apps/deployggb.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ggbApplet&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">var</span> parameters = &#123;</span><br><span class="javascript"><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">468</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">492</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;showToolBar&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;zh&quot;</span>,</span><br><span class="javascript"><span class="hljs-comment">// use this instead of ggbBase64 to load a material from geogebra.org</span></span><br><span class="javascript"><span class="hljs-comment">// &quot;material_id&quot;:&quot;RHYH3UQ8&quot;,</span></span><br><span class="javascript"><span class="hljs-comment">// use this instead of ggbBase64 to load a .ggb file</span></span><br><span class="javascript"><span class="hljs-comment">// &quot;filename&quot;:&quot;myfile.ggb&quot;,</span></span><br><span class="javascript"><span class="hljs-string">&quot;ggbBase64&quot;</span>:<span class="hljs-string">&quot;UEsDBBQACAgIABxZk1EAAAAAAAAAAAAAAAAXAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWztmk9z4jYUwM/dT+HRqT0EJIOBZOLsZHem08xks5km0+lV2MKoEZJrycHk01eWjG0WnAZDFpLdHCI/WX9/7+npSeb8YzZjziNJJBXcB6gDgUN4IELKIx+kanIyAh8vPpxHRERknGBnIpIZVj7w8pJlPS11Bi7M83Ac+yBgWEoaACdmWOVVfCAmE0Y5AY6TSXrGxQ2eERnjgNwFUzLD1yLAyrQ1VSo+63bn83ln2WtHJFFXNyy7mQy7UaQ6OgWOHjqXPigeznS7K7XnPVPPhRB1//5ybfs5oVwqzAM9ED2tkExwypTUj4SRGeHKUYuY+CAWlCvgMDwmzAe3ueT8OkkI+Q04RSVNC4KLD7+cy6mYO2L8Dwl0nkpSUtYzQjcvo19/FkwkTuKD4RA4kU3GPnA9T0Nj8RT7ANrCDC9I4jxiVubgVInA1De5E8wkWZbVPX0RIbFv+kV5TmcGpyMV0fqAHQQcGRMS6lGDYo7IqGdhNF1rMRAiCaWT+eAG3wBnUaRPNjVFDJ07+lR06tVz1YKR2tjPuwXYlyEOSUx4qAutcEatOA9GhnOejG3y2phfE3L/tSEPfkJugoy2p/yV19m6rdgi1zNwTfq9XMWbcBRX/E8S6THXGfd+Mt4r41UL7reiCw1b+EbJmiKWocz/67hGzGJGsj2CtzFRAfHaCCV0t118UYcODxRbwNbQcyAWn5rS4IETKXO2Vbv5wx801PuX6U/oGJIq3RIajmwL5F++ojSqdUZ1mecVMUl5oIxLKeB+TpPHujZ6fXgIfVRttl4BDcrYlXQzS0miXCq53C3lyrTbhXQ/ummLVLG85yuu9NGLGIOVa5N7ICS+10195fcJ5jI/f63aUrPmErx4TmveW9Daj6azpefijzgpNVHXWrvIqHHv7rjeoVW3hRuvg9g9iDkq893SNncyokG7pe/C/mZ6neERG9Gjnp6oMPxViFUo8CYCsyPzgxuiaZwoIinm/3c2YYuotqJvl3Kpj6HVx+5j3Pr06PWMTj20Zt8I2j/UP4UIDZB7aDU/D3jlHHJbZlSI0YEQH23I18wzEDy/+16eI6xUkuy/M+exhwMbjQi3Plc6TgZNsQU0lZ9g8VUiQ0ZeIPP2CdlsU18PPKGZc2lrXNqCl65Nejbp28QrAbU7JRrVxtpv1aLkbzaHfrujzVtyJe9S6d8hUufpjCQ113CzlEvj8axz0O2lZEW1L3AFTXbSbBWS0VCb0IxqJZ1o7c1wZrSIx1KwVJG7ICGEV5/mrBnPaaimeWin+57QLDcX26YzFQl9ElyVNJx8FVwy8xFv5Spjk/m4z0WuK8a6m3vGPGLVary0UqUBe1dvCn17jbdJMXWGsEA46LijHhp5PThEw1NvNHghUjSqkNoXLya6bh8I7sFCtlrn7qZ1jpOguiPtwc2OB3YgGva9nnvqeuj0tK8fvP0fBX8vM6pjzTFe6RkLWCv6ard1TASprO6grVQSGr2zcAWnGWUUJ4vdbH0rwopkVcBwb4TajwiOEHDzVDT2qBralZVqX+rtZCZUU+R4pivYTij/hIOHKBEpD9e3ob1MHR3atpqhjYVgBFeO6NNSrn0hXtv4mwAVe+0hV18wJcHDWGQre9XzPobKagVcG6H25XbDCnj5LNf3uZODm0Kbu7mtPig2BCh1BXRrP27qLn9JdfEfUEsHCHwZzHbqBAAA8SUAAFBLAwQUAAgICAAcWZNRAAAAAAAAAAAAAAAAFwAAAGdlb2dlYnJhX2RlZmF1bHRzM2QueG1s7ZjNbts4EMfP7VMQvFciZUmJgiiF0T3sAm2Qope9MtLYZlciVZKOrbxa36HP1BGpOHI3CRojCdCiPmT4NUPy9x9RYk7fbtuGXIGxUquS8ohRAqrStVTLkq7d4s0xfXv2+nQJegmXRpCFNq1wJc2GkTs/rEV5woY20XUlrRphrawo6RrhBpeS6sWikQooIVsrT5Q+Fy3YTlTwqVpBK97rSjgfa+VcdxLHm80mupk10mYZY2Abb20dL5cuQksJLl3Zko6FE4y7572Zeb+EMR7/++F9mOeNVNYJVeFCcFs1LMS6cRaL0EALyhHXd4Ab0EpWM5yjEZfQlPQf5XCvUA1LJNXaXKH/6FzSGc8YPXv96tSu9Iboy884rqTOrGHn7yvxMAa73+lGG2JKmnBKEDNnaC/RFgnya7qVKCmLOAs/nhaM85wnwb8RPRhyJTAoCy1i7XTlQ/rWhWgs3IzFyT/oGkJPOo5XsvWsiXWAYuHktgOofSlsn3nlep8E03go4CfXN0DcSlb/KbCIP5s4DYW/ZV3DkEvBB+QS1BUS0cai9szP0jM//JqNKbflvt5z33vNQ7P3x6UauSXz4DEPA+dJMLNg0mCyHRL4osI67fC3pJ0wmG4YqBr6T+NR7P/JLrbSzv7aqTYfqxOl2ewgpZkXmnmZ2a3IzyUpZs/zino/XzKWAXf97evDuP2DVAnjwEqhJo/bu6HjR/L5r0D+ObnfDxLjK5jwu/D1PX54DB7Eryg8wIQXHqG3uzMqeyqMldamtmRb0nNxjgfBaK9HuwnWD12I4eU0zhbxB2CyA2Hqpl9BbbS65TlpukU6G5Ee8gQ9VgaezbwOGf8xk6N0fFFkRc7SPH0yTQ5N7UeRnZtqJVuoQeyjxdfdS6FNeHgNp0ce7WB+D7YXPZ7Est7n+nIp648KXHwRuCa/Tc5eGGnbfar8Banm4UAOVIv8l6SqwO32eT6Up6dq9udUfQzLL2tR+y+vcasfb+pTpvzAC8r9R2OeFsPvKOfZMU8T/lSAnuOScecVY2gM94g+mOtkF/Cxtw4yz4M5CuY4mOLeG4lsu0ZW0j0srV2bBV6R7/pEHrv2VU4PUxn97vxIjo5+Nu1vA7/IZzL/2S+7eHLDj2/+nXD2HVBLBwgHivsrUgMAAPYQAABQSwMEFAAICAgAHFmTUQAAAAAAAAAAAAAAABYAAABnZW9nZWJyYV9qYXZhc2NyaXB0LmpzSyvNSy7JzM9TSE9P8s/zzMss0dBUqK4FAFBLBwjWN725GQAAABcAAABQSwMEFAAICAgAHFmTUQAAAAAAAAAAAAAAAAwAAABnZW9nZWJyYS54bWzlWOtv2zYQ/9z+FQd92iO2ST2twm6RDsM2IC2KphuGfaMk2uYiS5pIP1L0j98dKcly2mDJWhQY5kSmSB7v9TvekV68OG5L2MtWq7paenzKPJBVXheqWi+9nVlN5t6L508Xa1mvZdYKWNXtVpilFxHlsA5709hnNCaaZunlpdBa5R40pTC0ZOnVq1WpKumBKpZekuaFHyZykkRxOAmjNJykYhVOmJwH0YoxKVLuARy1elbVr8VW6kbk8jrfyK24qnNhrNSNMc2z2exwOEx7/aZ1u56hCnp21MVsvc6m2HqARlZ66XUvz5Dv2epDYNf5jPHZ76+unJyJqrQRVY4qkwN26vnTJ4uDqor6AAdVmM3SC+O5Bxup1hv0SJj6HsyIqEG3NDI3ai81Lh11rfFm23iWTFQ0/8S9QTnY5UGh9qqQ7dJj09BPgoidvgMP6lbJynTEvBM669kt9koeHF96syJDliYIl9IqK+XSW4lSExLVqkXfDn1tbkuZCRRr2h32TxrxC/uHJOq9JHYItHMFzjF2QU+CTxQxp85IdsTRL6auS8uZwQfgEDF8gKdwAXGCIz7wCEIcmeNIAgGNRTyEAIiEBxCG2IY0zGOcoWn8RnHAOc6Az8D3wefgB9iNIoiQLKG1PtLGqeXH8CFq1AifgMaCAB87FoT4+PSGjCLHBvWIgti+RUSN/COfLLCDwRzCFAXRQJRwCFAH7CcMkGNA7Lm1I2RA/xxCYu8n4M8B+aHpxJn5jwGmG7iDTI9L9ClcYnwsYHdwCc9RQRAY2nZBDXcNqRvHboq5MRa4xndN6JrI0YRueehInbUsdDRh8Llm9kYGjzFyPjKSkxEICmlvmwBIb271pybsurHr2mhjnHWjc/pKqYM+ief25TNtCv6VTXwk1W3UR2zkXiJP5w+X+HkhOljpE2sjsqV3efXTjy/fXj7C5s909WB2NHJ0hAmL/u3zkcjgUVbf7+iHS4zPtuRXN5j78y8jM5w/WGbCPpmFXMu79usAsZj1hXPRaQR6Q7TdHjNyq0nHIIUkgNgfCllMdaarZokPSQRJPKppF1TV4uhU2Kiszc8KWzQ/r24xDSa2VKI8KkyuzPlhX+kuulr34aNah6UpPFUnVJBYcQCspjZr9WUKtfCHQuVHVKt8zGtYI32IKU/eU7PwTFdrNfh2I8tmQMG6UVXNzpy5Lt8W/aupkVqU9qzW0Rd1fvNycHbHSQptxmzxeHM6Rbnjztkh68miFJnEA+b6miIBYC9K2kNWwqquDPRR4HuWnT3PLeQuL1WhRPUbQt+fnV7vtplswb7WZKRlQsvh0we/IHUkeV23xfWtxkiB4x+yxcV+zKfp6DPHZHjbTQX+lI0+HHe/zgUFeZieLUpx5rabitjZIhbETrbcX0tj0H4N4ih17+91q4rx+y/6ZV0Wg2ebWlXmB9GYXWsP/KhdS0ZdVutSWk9akPE8nN9k9fHapfHY8Xp321DpcvKz9Q91WbeAO9CPIiTo2sy1loYUG6iYpWGWosOJmA7znI7T667NXGup6BbhQHaG8t5K1ktRGlz/LAptgNDhelcpc9V3jMpvToYSvYO/9+A5S/6FWC5mdyJvcSPbSpYuiirEcVfvtAtiB5XVY6flG2E2l1XxVq5xB74RlAQNsnakJ40LmastLnTjnecEoforqupGC7luZW+h25LOr93eAd20UhR6I6UZvOtifExmzenVX2B5L6VN71uFGWKC4G3F0R4hcF803XZa6LxVDYUrZJiqb+QpJAuliUUxMpxcotG2nLIOuteQazF9iJ3Z1K29LwmDQ/ZWdajbG6vyO3k0ILJ6jzPFCmNIloTcem1ZylJu8RIFxgZxtdvKlu6rHaLCskIDd52ZfRJAMKHO/sS8cycGTq7H6XuCHETZbARd6viw51PGecz70Ba3lHhGqctyf1UXd9Qo6XbYeTjqPIytyHRd7gxelBHY6nRRdpp2ucuewo505sSsQgnFg5U6jhBAn6r3GIRDRNkYvnQRMrb0tBPNBmMer5+0HamiW6d2Lz+ropDVoLuoMDAtkJi+pdtTA32DHrCJ6IT9rEPqHzHL/j+Ypf8hzI6YRDT9StR7HbciDi69W1jCNwK+g+O38D1kPUf3I9HHW9SNDzwegCzIPd1yHwrwA+HszxTk/rtZ1yZHTUBNuAUKv9/bzv2+j+51PdSNyJUhNsm8q/J/VY6BdvUFHVkqpLnr9dk4Y9rjTvf72PO/AVBLBwi8SnA4iQYAAPETAABQSwECFAAUAAgICAAcWZNRfBnMduoEAADxJQAAFwAAAAAAAAAAAAAAAAAAAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWxQSwECFAAUAAgICAAcWZNRB4r7K1IDAAD2EAAAFwAAAAAAAAAAAAAAAAAvBQAAZ2VvZ2VicmFfZGVmYXVsdHMzZC54bWxQSwECFAAUAAgICAAcWZNR1je9uRkAAAAXAAAAFgAAAAAAAAAAAAAAAADGCAAAZ2VvZ2VicmFfamF2YXNjcmlwdC5qc1BLAQIUABQACAgIABxZk1G8SnA4iQYAAPETAAAMAAAAAAAAAAAAAAAAACMJAABnZW9nZWJyYS54bWxQSwUGAAAAAAQABAAIAQAA5g8AAAAA&quot;</span>,</span><br><span class="javascript">&#125;;</span><br><span class="javascript"><span class="hljs-comment">// is3D=is 3D applet using 3D view, AV=Algebra View, SV=Spreadsheet View, CV=CAS View, EV2=Graphics View 2, CP=Construction Protocol, PC=Probability Calculator DA=Data Analysis, FI=Function Inspector, macro=Macros</span></span><br><span class="javascript"><span class="hljs-keyword">var</span> views = &#123;<span class="hljs-string">&#x27;is3D&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;AV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;SV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;CV&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;EV2&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;CP&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;PC&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;DA&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;FI&#x27;</span>: <span class="hljs-number">0</span>,<span class="hljs-string">&#x27;macro&#x27;</span>: <span class="hljs-number">0</span>&#125;;</span><br><span class="javascript"><span class="hljs-keyword">var</span> applet = <span class="hljs-keyword">new</span> GGBApplet(parameters, <span class="hljs-string">&#x27;5.0&#x27;</span>, views);</span><br><span class="javascript"><span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;applet.inject(<span class="hljs-string">&#x27;ggbApplet&#x27;</span>)&#125;;</span><br><span class="javascript">applet.setPreviewImage(<span class="hljs-string">&#x27;data:image/gif;base64,R0lGODlhAQABAAAAADs=&#x27;</span>,<span class="hljs-string">&#x27;https://www.geogebra.org/images/GeoGebra_loading.png&#x27;</span>,<span class="hljs-string">&#x27;https://www.geogebra.org/images/applet_play.png&#x27;</span>);</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="本地js解析ggbBase64信息"><a href="#本地js解析ggbBase64信息" class="headerlink" title="本地js解析ggbBase64信息"></a>本地js解析ggbBase64信息</h4><ul><li>继续按照官方教程行事 <a href="https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters">https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters</a></li><li>主要在<code>Offline and Self-Hosted Solution</code>这一部分</li><li>需要自己<a href="https://download.geogebra.org/package/geogebra-math-apps-bundle">下载相关的js文件</a>（<code>deployggb.js</code>和<code>5.0/web3d/</code>）</li><li>配置<code>deployggb.js</code>和<code>5.0/web3d/</code>的位置</li><li>我将<code>deployggb.js</code>放在了<code>/js/deployggb.js</code>下；<code>web3d</code>放在了<code>/js/5.0/web3d/</code>位置</li><li>代数区输入公式 $y=ax+b$创建图形</li><li>为了让图形居中显示，在调用的div模块上加入style设置<code>style=&#39;margin:0 auto&#39;</code>：</li><li>综上，在html贴上如下代码：</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/js/deployggb.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">var</span> parameters = &#123;</span><br><span class="javascript"><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">500</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">500</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;showResetIcon&quot;</span>:<span class="hljs-literal">true</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;borderColor&quot;</span>:<span class="hljs-string">&quot;white&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;en&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;ggbBase64&quot;</span>:<span class="hljs-string">&quot;UEsDBBQACAgIAA1ak1EAAAAAAAAAAAAAAAAXAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWztmk9z4jYUwM/dT+HRqT0EJIOBZOLsZHem08xks5km0+lV2MKoEZJrycHk01eWjG0WnAZDFpLdHCI/WX9/7+npSeb8YzZjziNJJBXcB6gDgUN4IELKIx+kanIyAh8vPpxHRERknGBnIpIZVj7w8pJlPS11Bi7M83Ac+yBgWEoaACdmWOVVfCAmE0Y5AY6TSXrGxQ2eERnjgNwFUzLD1yLAyrQ1VSo+63bn83ln2WtHJFFXNyy7mQy7UaQ6OgWOHjqXPigeznS7K7XnPVPPhRB1//5ybfs5oVwqzAM9ED2tkExwypTUj4SRGeHKUYuY+CAWlCvgMDwmzAe3ueT8OkkI+Q04RSVNC4KLD7+cy6mYO2L8Dwl0nkpSUtYzQjcvo19/FkwkTuKD4RA4kU3GPnA9T0Nj8RT7ANrCDC9I4jxiVubgVInA1De5E8wkWZbVPX0RIbFv+kV5TmcGpyMV0fqAHQQcGRMS6lGDYo7IqGdhNF1rMRAiCaWT+eAG3wBnUaRPNjVFDJ07+lR06tVz1YKR2tjPuwXYlyEOSUx4qAutcEatOA9GhnOejG3y2phfE3L/tSEPfkJugoy2p/yV19m6rdgi1zNwTfq9XMWbcBRX/E8S6THXGfd+Mt4r41UL7reiCw1b+EbJmiKWocz/67hGzGJGsj2CtzFRAfHaCCV0t118UYcODxRbwNbQcyAWn5rS4IETKXO2Vbv5wx801PuX6U/oGJIq3RIajmwL5F++ojSqdUZ1mecVMUl5oIxLKeB+TpPHujZ6fXgIfVRttl4BDcrYlXQzS0miXCq53C3lyrTbhXQ/ummLVLG85yuu9NGLGIOVa5N7ICS+10195fcJ5jI/f63aUrPmErx4TmveW9Daj6azpefijzgpNVHXWrvIqHHv7rjeoVW3hRuvg9g9iDkq893SNncyokG7pe/C/mZ6neERG9Gjnp6oMPxViFUo8CYCsyPzgxuiaZwoIinm/3c2YYuotqJvl3Kpj6HVx+5j3Pr06PWMTj20Zt8I2j/UP4UIDZB7aDU/D3jlHHJbZlSI0YEQH23I18wzEDy/+16eI6xUkuy/M+exhwMbjQi3Plc6TgZNsQU0lZ9g8VUiQ0ZeIPP2CdlsU18PPKGZc2lrXNqCl65Nejbp28QrAbU7JRrVxtpv1aLkbzaHfrujzVtyJe9S6d8hUufpjCQ113CzlEvj8axz0O2lZEW1L3AFTXbSbBWS0VCb0IxqJZ1o7c1wZrSIx1KwVJG7ICGEV5/mrBnPaaimeWin+57QLDcX26YzFQl9ElyVNJx8FVwy8xFv5Spjk/m4z0WuK8a6m3vGPGLVary0UqUBe1dvCn17jbdJMXWGsEA46LijHhp5PThEw1NvNHghUjSqkNoXLya6bh8I7sFCtlrn7qZ1jpOguiPtwc2OB3YgGva9nnvqeuj0tK8fvP0fBX8vM6pjzTFe6RkLWCv6ard1TASprO6grVQSGr2zcAWnGWUUJ4vdbH0rwopkVcBwb4TajwiOEHDzVDT2qBralZVqX+rtZCZUU+R4pivYTij/hIOHKBEpD9e3ob1MHR3atpqhjYVgBFeO6NNSrn0hXtv4mwAVe+0hV18wJcHDWGQre9XzPobKagVcG6H25XbDCnj5LNf3uZODm0Kbu7mtPig2BCh1BXRrP27qLn9JdfEfUEsHCHwZzHbqBAAA8SUAAFBLAwQUAAgICAANWpNRAAAAAAAAAAAAAAAAFwAAAGdlb2dlYnJhX2RlZmF1bHRzM2QueG1s7ZjNbts4EMfP7VMQvFciZUmJgiiF0T3sAm2Qope9MtLYZlciVZKOrbxa36HP1BGpOHI3CRojCdCiPmT4NUPy9x9RYk7fbtuGXIGxUquS8ohRAqrStVTLkq7d4s0xfXv2+nQJegmXRpCFNq1wJc2GkTs/rEV5woY20XUlrRphrawo6RrhBpeS6sWikQooIVsrT5Q+Fy3YTlTwqVpBK97rSjgfa+VcdxLHm80mupk10mYZY2Abb20dL5cuQksJLl3Zko6FE4y7572Zeb+EMR7/++F9mOeNVNYJVeFCcFs1LMS6cRaL0EALyhHXd4Ab0EpWM5yjEZfQlPQf5XCvUA1LJNXaXKH/6FzSGc8YPXv96tSu9Iboy884rqTOrGHn7yvxMAa73+lGG2JKmnBKEDNnaC/RFgnya7qVKCmLOAs/nhaM85wnwb8RPRhyJTAoCy1i7XTlQ/rWhWgs3IzFyT/oGkJPOo5XsvWsiXWAYuHktgOofSlsn3nlep8E03go4CfXN0DcSlb/KbCIP5s4DYW/ZV3DkEvBB+QS1BUS0cai9szP0jM//JqNKbflvt5z33vNQ7P3x6UauSXz4DEPA+dJMLNg0mCyHRL4osI67fC3pJ0wmG4YqBr6T+NR7P/JLrbSzv7aqTYfqxOl2ewgpZkXmnmZ2a3IzyUpZs/zino/XzKWAXf97evDuP2DVAnjwEqhJo/bu6HjR/L5r0D+ObnfDxLjK5jwu/D1PX54DB7Eryg8wIQXHqG3uzMqeyqMldamtmRb0nNxjgfBaK9HuwnWD12I4eU0zhbxB2CyA2Hqpl9BbbS65TlpukU6G5Ee8gQ9VgaezbwOGf8xk6N0fFFkRc7SPH0yTQ5N7UeRnZtqJVuoQeyjxdfdS6FNeHgNp0ce7WB+D7YXPZ7Est7n+nIp648KXHwRuCa/Tc5eGGnbfar8Banm4UAOVIv8l6SqwO32eT6Up6dq9udUfQzLL2tR+y+vcasfb+pTpvzAC8r9R2OeFsPvKOfZMU8T/lSAnuOScecVY2gM94g+mOtkF/Cxtw4yz4M5CuY4mOLeG4lsu0ZW0j0srV2bBV6R7/pEHrv2VU4PUxn97vxIjo5+Nu1vA7/IZzL/2S+7eHLDj2/+nXD2HVBLBwgHivsrUgMAAPYQAABQSwMEFAAICAgADVqTUQAAAAAAAAAAAAAAABYAAABnZW9nZWJyYV9qYXZhc2NyaXB0LmpzSyvNSy7JzM9TSE9P8s/zzMss0dBUqK4FAFBLBwjWN725GQAAABcAAABQSwMEFAAICAgADVqTUQAAAAAAAAAAAAAAAAwAAABnZW9nZWJyYS54bWzdGNtu2zb0uf2KAz3tktikrlZht0iHYRuQFkXTDcPeKIm2uciSJtKXFP34nUNKspwmWLIUBTYnMkXy8Nxv9PzVYVPCTrZa1dXC4xPmgazyulDVauFtzfJ85r16+Xy+kvVKZq2AZd1uhFl4EUEO53A2iX1Ga6JpFl5eCq1V7kFTCkNHFl69XJaqkh6oYuElaV74YSLPkygOz8MoDc9TsQzPmZwF0ZIxKVLuARy0elHVb8VG6kbk8ipfy424rHNhLNW1Mc2L6XS/3096/iZ1u5oiC3p60MV0tcomOHqAQlZ64XUvLxDvyel9YM/5jPHp728uHZ1zVWkjqhxZJgVs1cvnz+Z7VRX1HvaqMOuFF8YzD9ZSrdaokTD1PZgSUINqaWRu1E5qPDqaWuHNpvEsmKho/5l7g3KQy4NC7VQh24XHJqGfBBE7fgce1K2SlemAeUd02qOb75TcO7z0ZkmGLE3QXEqrrJQLbylKTZaoli3qdphrc1PKTCBZ025xfuSIn9k/BFEfJaFDQztV4B5jZ/Qk+EQRc+yMaEcc9WLqurSYGXwCDhHDB3gKZxAnuOIDjyDElRmuJBDQWsRDCIBAeABhiGNIyzzGHdrGbyQHnOMO+Ax8H3wOfoDTKIIIwRI66yNsnFp8DB+CRo7wCWgtCPCxa0GIj09viChyaJCPKIjtW0TQiD/ySQK7GMwgTJEQLUQJhwB5wHnCADEGhJ5bOUIG9M8hJPR+Av4MEB+KTpiZ/xjDdAu3LNPbJbrLLjE+1mC37BKeWgWNwFC2Mxq4G4jdOHZbzK2xwA2+G0I3RA4mdMdDB+qkZaGDCYOnitkLGTxGyNlISE5CoFGIezsEQHxzyz8NYTeN3dR6G+OsW53RV0oT1Ek8sy9PlCn4VzLxEVUXqI8I5J4iT2cPp/g0Fx2k9Am1EdnCu7j86cfX7y8eIfMTVT2IHY0UHWHCon/7fEYyeJTU9yv64RTjk5D86gJzf/ZlaIazB9NM2J1ZyI28G7+OIebTvnDOO45Arwm2izEjN5p4DFJIAoj9oZDFVGe6apb4kESQxKOadkZVLY6OhY3K2uyksEWz0+oW02JiSyXSo8Lkypwf9pXurKt1nz6rdViawmN1QgYJFQfAamqzVl+mkAt/KFR+RLXKx7yGNdKHmPLkPTULe7paq0G3a1k2gxWsGlXVbM2J6vJN0b+aGqFFaXu1Dr6o8+vXg7I7TFJoM0aL7c2xi3LtzkmT9Wxeikxig7m6Ik8A2ImSYshSWNaVgd4LfM+is/3cXG7zUhVKVL+h6fve6e12k8kW7GtNQlokdBzubvyC1IHkdd0WVzcaPQUOf8gWD/sxn6SjzwyT4U23FfgTNvpwjH6dC3LyMD05lOLOTbcVsZNDLIgdbbm7ksag/BrEQepe36tWFeP3X/TruiwGzTa1qswPojHb1jb8yF1LQl1Uq1JaTVojYz+cX2f14cql8djh+nDTUOly9LPVD3VZt4AR6EcRAnRj5kYLQ4wNUMzCMAvR2YmQDvuc2ulVN2ZutFB0i3BGdoLyXkrWU1Ea3PzEC62DUHO9rZS57CdG5ddHQQnemb/X4ClK/oVQzqe3PG9+LdtKls6LKrTjtt5q58TOVJaPrZbvhFlfVMV7ucIIfCcoCRpE7UCPHBcyVxs86NY7zQmy6q/Iqlst5KqVvYQuJJ1eu9gB3bRSFHotpRm063x8DOaiw4gWvQZpUmY45WY+7YWbY/EvpU3+G4X54xxNuxEH22Bg1DRdsM113qqGnBkyTOTX8uiwhdKEohiphRSmkVZuKRtlSPGYXMTWrOvW3qaEwSV759rX7bUV6IM8GBBZvcOdYokeJkuy62plUcpSbvCKBca6eLXdyJZus529hUWFMm47JZzzSdDFAZkb6uxPzEy3vORoHNy+JwxAlM1a0LWPD1khZZzHvHd+cUOpaaR5i/1NXXSs9NmqpPtjp+Wo0zKOItN1uTV4lUbTV8ertOO0y262TztQV4p5h1KOB0t1GFkB9ao+opsOVrZefuF8aCzpMVbNGqMCL6gUsFTzrWK7l59VUchq4F0MboQJXrqoG+Ab1IBNVaNQcsb6R7Nlt82Gl+v/r9XS/47VDphnNP2Q1Csd4xEXF94NLOAbAd/B4Vv4HrIeofsd6fM4desDjgcYFuSOLsIPte8Drdm3HaT924nZ5k9NdrI5gyyFivqI9j564536j+5VP9SNyJUhTMms6wb+qhwC7eoQarNUCHNb9dNx7rRtUfc72su/AVBLBwhclqmpmwYAABkUAABQSwECFAAUAAgICAANWpNRfBnMduoEAADxJQAAFwAAAAAAAAAAAAAAAAAAAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWxQSwECFAAUAAgICAANWpNRB4r7K1IDAAD2EAAAFwAAAAAAAAAAAAAAAAAvBQAAZ2VvZ2VicmFfZGVmYXVsdHMzZC54bWxQSwECFAAUAAgICAANWpNR1je9uRkAAAAXAAAAFgAAAAAAAAAAAAAAAADGCAAAZ2VvZ2VicmFfamF2YXNjcmlwdC5qc1BLAQIUABQACAgIAA1ak1FclqmpmwYAABkUAAAMAAAAAAAAAAAAAAAAACMJAABnZW9nZWJyYS54bWxQSwUGAAAAAAQABAAIAQAA+A8AAAAA&quot;</span>&#125;;</span><br><span class="javascript"><span class="hljs-keyword">var</span> applet = <span class="hljs-keyword">new</span> GGBApplet(parameters, <span class="hljs-string">&#x27;5.0&#x27;</span>);</span><br><span class="javascript">applet.setHTML5Codebase(<span class="hljs-string">&#x27;/js/5.0/web3d/&#x27;</span>);</span><br><span class="javascript"><span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;applet.inject(<span class="hljs-string">&#x27;ggbApplet&#x27;</span>)&#125;;</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ggbApplet&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;margin:0 auto&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><script src="/js/deployggb.js"></script><script>var parameters = {"id": "ggbApplet","width":500,"height":500,"showResetIcon":true,"borderColor":"white","language":"en","ggbBase64":"UEsDBBQACAgIAA1ak1EAAAAAAAAAAAAAAAAXAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWztmk9z4jYUwM/dT+HRqT0EJIOBZOLsZHem08xks5km0+lV2MKoEZJrycHk01eWjG0WnAZDFpLdHCI/WX9/7+npSeb8YzZjziNJJBXcB6gDgUN4IELKIx+kanIyAh8vPpxHRERknGBnIpIZVj7w8pJlPS11Bi7M83Ac+yBgWEoaACdmWOVVfCAmE0Y5AY6TSXrGxQ2eERnjgNwFUzLD1yLAyrQ1VSo+63bn83ln2WtHJFFXNyy7mQy7UaQ6OgWOHjqXPigeznS7K7XnPVPPhRB1//5ybfs5oVwqzAM9ED2tkExwypTUj4SRGeHKUYuY+CAWlCvgMDwmzAe3ueT8OkkI+Q04RSVNC4KLD7+cy6mYO2L8Dwl0nkpSUtYzQjcvo19/FkwkTuKD4RA4kU3GPnA9T0Nj8RT7ANrCDC9I4jxiVubgVInA1De5E8wkWZbVPX0RIbFv+kV5TmcGpyMV0fqAHQQcGRMS6lGDYo7IqGdhNF1rMRAiCaWT+eAG3wBnUaRPNjVFDJ07+lR06tVz1YKR2tjPuwXYlyEOSUx4qAutcEatOA9GhnOejG3y2phfE3L/tSEPfkJugoy2p/yV19m6rdgi1zNwTfq9XMWbcBRX/E8S6THXGfd+Mt4r41UL7reiCw1b+EbJmiKWocz/67hGzGJGsj2CtzFRAfHaCCV0t118UYcODxRbwNbQcyAWn5rS4IETKXO2Vbv5wx801PuX6U/oGJIq3RIajmwL5F++ojSqdUZ1mecVMUl5oIxLKeB+TpPHujZ6fXgIfVRttl4BDcrYlXQzS0miXCq53C3lyrTbhXQ/ummLVLG85yuu9NGLGIOVa5N7ICS+10195fcJ5jI/f63aUrPmErx4TmveW9Daj6azpefijzgpNVHXWrvIqHHv7rjeoVW3hRuvg9g9iDkq893SNncyokG7pe/C/mZ6neERG9Gjnp6oMPxViFUo8CYCsyPzgxuiaZwoIinm/3c2YYuotqJvl3Kpj6HVx+5j3Pr06PWMTj20Zt8I2j/UP4UIDZB7aDU/D3jlHHJbZlSI0YEQH23I18wzEDy/+16eI6xUkuy/M+exhwMbjQi3Plc6TgZNsQU0lZ9g8VUiQ0ZeIPP2CdlsU18PPKGZc2lrXNqCl65Nejbp28QrAbU7JRrVxtpv1aLkbzaHfrujzVtyJe9S6d8hUufpjCQ113CzlEvj8axz0O2lZEW1L3AFTXbSbBWS0VCb0IxqJZ1o7c1wZrSIx1KwVJG7ICGEV5/mrBnPaaimeWin+57QLDcX26YzFQl9ElyVNJx8FVwy8xFv5Spjk/m4z0WuK8a6m3vGPGLVary0UqUBe1dvCn17jbdJMXWGsEA46LijHhp5PThEw1NvNHghUjSqkNoXLya6bh8I7sFCtlrn7qZ1jpOguiPtwc2OB3YgGva9nnvqeuj0tK8fvP0fBX8vM6pjzTFe6RkLWCv6ard1TASprO6grVQSGr2zcAWnGWUUJ4vdbH0rwopkVcBwb4TajwiOEHDzVDT2qBralZVqX+rtZCZUU+R4pivYTij/hIOHKBEpD9e3ob1MHR3atpqhjYVgBFeO6NNSrn0hXtv4mwAVe+0hV18wJcHDWGQre9XzPobKagVcG6H25XbDCnj5LNf3uZODm0Kbu7mtPig2BCh1BXRrP27qLn9JdfEfUEsHCHwZzHbqBAAA8SUAAFBLAwQUAAgICAANWpNRAAAAAAAAAAAAAAAAFwAAAGdlb2dlYnJhX2RlZmF1bHRzM2QueG1s7ZjNbts4EMfP7VMQvFciZUmJgiiF0T3sAm2Qope9MtLYZlciVZKOrbxa36HP1BGpOHI3CRojCdCiPmT4NUPy9x9RYk7fbtuGXIGxUquS8ohRAqrStVTLkq7d4s0xfXv2+nQJegmXRpCFNq1wJc2GkTs/rEV5woY20XUlrRphrawo6RrhBpeS6sWikQooIVsrT5Q+Fy3YTlTwqVpBK97rSjgfa+VcdxLHm80mupk10mYZY2Abb20dL5cuQksJLl3Zko6FE4y7572Zeb+EMR7/++F9mOeNVNYJVeFCcFs1LMS6cRaL0EALyhHXd4Ab0EpWM5yjEZfQlPQf5XCvUA1LJNXaXKH/6FzSGc8YPXv96tSu9Iboy884rqTOrGHn7yvxMAa73+lGG2JKmnBKEDNnaC/RFgnya7qVKCmLOAs/nhaM85wnwb8RPRhyJTAoCy1i7XTlQ/rWhWgs3IzFyT/oGkJPOo5XsvWsiXWAYuHktgOofSlsn3nlep8E03go4CfXN0DcSlb/KbCIP5s4DYW/ZV3DkEvBB+QS1BUS0cai9szP0jM//JqNKbflvt5z33vNQ7P3x6UauSXz4DEPA+dJMLNg0mCyHRL4osI67fC3pJ0wmG4YqBr6T+NR7P/JLrbSzv7aqTYfqxOl2ewgpZkXmnmZ2a3IzyUpZs/zino/XzKWAXf97evDuP2DVAnjwEqhJo/bu6HjR/L5r0D+ObnfDxLjK5jwu/D1PX54DB7Eryg8wIQXHqG3uzMqeyqMldamtmRb0nNxjgfBaK9HuwnWD12I4eU0zhbxB2CyA2Hqpl9BbbS65TlpukU6G5Ee8gQ9VgaezbwOGf8xk6N0fFFkRc7SPH0yTQ5N7UeRnZtqJVuoQeyjxdfdS6FNeHgNp0ce7WB+D7YXPZ7Est7n+nIp648KXHwRuCa/Tc5eGGnbfar8Banm4UAOVIv8l6SqwO32eT6Up6dq9udUfQzLL2tR+y+vcasfb+pTpvzAC8r9R2OeFsPvKOfZMU8T/lSAnuOScecVY2gM94g+mOtkF/Cxtw4yz4M5CuY4mOLeG4lsu0ZW0j0srV2bBV6R7/pEHrv2VU4PUxn97vxIjo5+Nu1vA7/IZzL/2S+7eHLDj2/+nXD2HVBLBwgHivsrUgMAAPYQAABQSwMEFAAICAgADVqTUQAAAAAAAAAAAAAAABYAAABnZW9nZWJyYV9qYXZhc2NyaXB0LmpzSyvNSy7JzM9TSE9P8s/zzMss0dBUqK4FAFBLBwjWN725GQAAABcAAABQSwMEFAAICAgADVqTUQAAAAAAAAAAAAAAAAwAAABnZW9nZWJyYS54bWzdGNtu2zb0uf2KAz3tktikrlZht0iHYRuQFkXTDcPeKIm2uciSJtKXFP34nUNKspwmWLIUBTYnMkXy8Nxv9PzVYVPCTrZa1dXC4xPmgazyulDVauFtzfJ85r16+Xy+kvVKZq2AZd1uhFl4EUEO53A2iX1Ga6JpFl5eCq1V7kFTCkNHFl69XJaqkh6oYuElaV74YSLPkygOz8MoDc9TsQzPmZwF0ZIxKVLuARy0elHVb8VG6kbk8ipfy424rHNhLNW1Mc2L6XS/3096/iZ1u5oiC3p60MV0tcomOHqAQlZ64XUvLxDvyel9YM/5jPHp728uHZ1zVWkjqhxZJgVs1cvnz+Z7VRX1HvaqMOuFF8YzD9ZSrdaokTD1PZgSUINqaWRu1E5qPDqaWuHNpvEsmKho/5l7g3KQy4NC7VQh24XHJqGfBBE7fgce1K2SlemAeUd02qOb75TcO7z0ZkmGLE3QXEqrrJQLbylKTZaoli3qdphrc1PKTCBZ025xfuSIn9k/BFEfJaFDQztV4B5jZ/Qk+EQRc+yMaEcc9WLqurSYGXwCDhHDB3gKZxAnuOIDjyDElRmuJBDQWsRDCIBAeABhiGNIyzzGHdrGbyQHnOMO+Ax8H3wOfoDTKIIIwRI66yNsnFp8DB+CRo7wCWgtCPCxa0GIj09viChyaJCPKIjtW0TQiD/ySQK7GMwgTJEQLUQJhwB5wHnCADEGhJ5bOUIG9M8hJPR+Av4MEB+KTpiZ/xjDdAu3LNPbJbrLLjE+1mC37BKeWgWNwFC2Mxq4G4jdOHZbzK2xwA2+G0I3RA4mdMdDB+qkZaGDCYOnitkLGTxGyNlISE5CoFGIezsEQHxzyz8NYTeN3dR6G+OsW53RV0oT1Ek8sy9PlCn4VzLxEVUXqI8I5J4iT2cPp/g0Fx2k9Am1EdnCu7j86cfX7y8eIfMTVT2IHY0UHWHCon/7fEYyeJTU9yv64RTjk5D86gJzf/ZlaIazB9NM2J1ZyI28G7+OIebTvnDOO45Arwm2izEjN5p4DFJIAoj9oZDFVGe6apb4kESQxKOadkZVLY6OhY3K2uyksEWz0+oW02JiSyXSo8Lkypwf9pXurKt1nz6rdViawmN1QgYJFQfAamqzVl+mkAt/KFR+RLXKx7yGNdKHmPLkPTULe7paq0G3a1k2gxWsGlXVbM2J6vJN0b+aGqFFaXu1Dr6o8+vXg7I7TFJoM0aL7c2xi3LtzkmT9Wxeikxig7m6Ik8A2ImSYshSWNaVgd4LfM+is/3cXG7zUhVKVL+h6fve6e12k8kW7GtNQlokdBzubvyC1IHkdd0WVzcaPQUOf8gWD/sxn6SjzwyT4U23FfgTNvpwjH6dC3LyMD05lOLOTbcVsZNDLIgdbbm7ksag/BrEQepe36tWFeP3X/TruiwGzTa1qswPojHb1jb8yF1LQl1Uq1JaTVojYz+cX2f14cql8djh+nDTUOly9LPVD3VZt4AR6EcRAnRj5kYLQ4wNUMzCMAvR2YmQDvuc2ulVN2ZutFB0i3BGdoLyXkrWU1Ea3PzEC62DUHO9rZS57CdG5ddHQQnemb/X4ClK/oVQzqe3PG9+LdtKls6LKrTjtt5q58TOVJaPrZbvhFlfVMV7ucIIfCcoCRpE7UCPHBcyVxs86NY7zQmy6q/Iqlst5KqVvYQuJJ1eu9gB3bRSFHotpRm063x8DOaiw4gWvQZpUmY45WY+7YWbY/EvpU3+G4X54xxNuxEH22Bg1DRdsM113qqGnBkyTOTX8uiwhdKEohiphRSmkVZuKRtlSPGYXMTWrOvW3qaEwSV759rX7bUV6IM8GBBZvcOdYokeJkuy62plUcpSbvCKBca6eLXdyJZus529hUWFMm47JZzzSdDFAZkb6uxPzEy3vORoHNy+JwxAlM1a0LWPD1khZZzHvHd+cUOpaaR5i/1NXXSs9NmqpPtjp+Wo0zKOItN1uTV4lUbTV8ertOO0y262TztQV4p5h1KOB0t1GFkB9ao+opsOVrZefuF8aCzpMVbNGqMCL6gUsFTzrWK7l59VUchq4F0MboQJXrqoG+Ab1IBNVaNQcsb6R7Nlt82Gl+v/r9XS/47VDphnNP2Q1Csd4xEXF94NLOAbAd/B4Vv4HrIeofsd6fM4desDjgcYFuSOLsIPte8Drdm3HaT924nZ5k9NdrI5gyyFivqI9j564536j+5VP9SNyJUhTMms6wb+qhwC7eoQarNUCHNb9dNx7rRtUfc72su/AVBLBwhclqmpmwYAABkUAABQSwECFAAUAAgICAANWpNRfBnMduoEAADxJQAAFwAAAAAAAAAAAAAAAAAAAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWxQSwECFAAUAAgICAANWpNRB4r7K1IDAAD2EAAAFwAAAAAAAAAAAAAAAAAvBQAAZ2VvZ2VicmFfZGVmYXVsdHMzZC54bWxQSwECFAAUAAgICAANWpNR1je9uRkAAAAXAAAAFgAAAAAAAAAAAAAAAADGCAAAZ2VvZ2VicmFfamF2YXNjcmlwdC5qc1BLAQIUABQACAgIAA1ak1FclqmpmwYAABkUAAAMAAAAAAAAAAAAAAAAACMJAABnZW9nZWJyYS54bWxQSwUGAAAAAAQABAAIAQAA+A8AAAAA"};var applet = new GGBApplet(parameters, '5.0');applet.setHTML5Codebase('/js/5.0/web3d/');window.onload = function() {applet.inject('ggbApplet')};</script><div id="ggbApplet" style='margin:0 auto'></div><h4 id="本地js解析ggb文件信息"><a href="#本地js解析ggb文件信息" class="headerlink" title="本地js解析ggb文件信息"></a>本地js解析ggb文件信息</h4><ul><li>与官网解析ggb文件一样，首先获取<code>ggb文件</code>，将文件上传，获取链接</li><li>将上文的<code>ggbBase64</code>替换为<code>filename</code>，附上链接，向网页黏贴代码</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&#123;path to your deployggb.js&#125;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">var</span> parameters = &#123;</span><br><span class="javascript"><span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;ggbApplet&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;width&quot;</span>:<span class="hljs-number">500</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;height&quot;</span>:<span class="hljs-number">500</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;borderColor&quot;</span>:<span class="hljs-string">&quot;white&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;language&quot;</span>:<span class="hljs-string">&quot;en&quot;</span>,</span><br><span class="javascript"><span class="hljs-string">&quot;filename&quot;</span>:<span class="hljs-string">&quot;https://photos.zywvvd.com/images_matrixtime/20201219164932.ggb&quot;</span>&#125;;</span><br><span class="javascript"><span class="hljs-keyword">var</span> applet = <span class="hljs-keyword">new</span> GGBApplet(parameters, <span class="hljs-string">&#x27;5.0&#x27;</span>);</span><br><span class="javascript">applet.setHTML5Codebase(<span class="hljs-string">&#x27;5.0/web3d/&#x27;</span>);</span><br><span class="javascript"><span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;applet.inject(<span class="hljs-string">&#x27;ggbApplet&#x27;</span>)&#125;;</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;ggbApplet&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="js解析ggb信息过程中的参数设置"><a href="#js解析ggb信息过程中的参数设置" class="headerlink" title="js解析ggb信息过程中的参数设置"></a>js解析ggb信息过程中的参数设置</h4><ul><li>参考：<a href="https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters">https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters</a></li><li>可以根据个人需求设置各项参数</li></ul><table><thead><tr><th>Name</th><th>Value</th><th>Description</th><th>Since</th></tr></thead><tbody><tr><td>appName</td><td>eg <code>&quot;graphing&quot;</code></td><td>app name, default: “classic””graphing” … GeoGebra Graphing Calculator “geometry” … GeoGebra Geometry “3d” … GeoGebra 3D Graphing Calculator “classic” … GeoGebra Classic “suite” … GeoGebra Calculator Suite “evaluator” … Equation Editor</td><td>6.0</td></tr><tr><td>width</td><td>eg <code>800</code></td><td>Applet width (<strong>compulsory field</strong>)</td><td></td></tr><tr><td>height</td><td>eg <code>600</code></td><td>Applet height (<strong>compulsory field</strong>)</td><td></td></tr><tr><td>material_id</td><td>eg <code>&quot;RHYH3UQ8&quot;</code></td><td>GeoGebra Materials id to load See first applet here: <a href="https://dev.geogebra.org/examples/html/example-multiple.html">https://dev.geogebra.org/examples/html/example-multiple.html</a></td><td>5.0</td></tr><tr><td>filename</td><td>eg <code>&quot;myFile.ggb&quot;</code></td><td>URL of file to load See second applet here: <a href="https://dev.geogebra.org/examples/html/example-multiple.html">https://dev.geogebra.org/examples/html/example-multiple.html</a></td><td>4.0</td></tr><tr><td>ggbBase64</td><td>base64 encoded .ggb file</td><td>Encoded file to load. See the applet here: <a href="https://dev.geogebra.org/examples/html/example-single.html">https://dev.geogebra.org/examples/html/example-single.html</a></td><td>4.0</td></tr><tr><td>borderColor</td><td>e.g. <code>#FFFFFF</code> for white</td><td>Color of the border line drawn around the applet panel (as hex rgb string). Default: gray</td><td>3.0</td></tr><tr><td>enableRightClick</td><td><code>true</code> or <code>false</code></td><td>States whether right clicks should be handled by the applet. Setting this parameter to “false” disables context menus, properties dialogs and right-click-zooming. Default: true. NB also enables/disables some keyboard shortcuts eg Delete and Ctrl + R (recompute all objects). Default: true</td><td>3.0</td></tr><tr><td>enableLabelDrags</td><td><code>true</code> or <code>false</code></td><td>States whether labels can be dragged. Default: true</td><td>3.2</td></tr><tr><td>enableShiftDragZoom</td><td><code>true</code> or <code>false</code></td><td>States whether the Graphics View(s) should be moveable using Shift + mouse drag (or. Ctrl + mouse drag) or zoomable using Shift + mouse wheel (or Ctrl + mouse wheel). Setting this parameter to “false” disables moving and zooming of the drawing pad. Default: true</td><td>3.0</td></tr><tr><td>showZoomButtons</td><td><code>true</code> or <code>false</code></td><td>States whether the zoom in / zoom out / home buttons should be shown in the Graphics View or not. Default: false</td><td>6.0</td></tr><tr><td>errorDialogsActive</td><td><code>true</code> or <code>false</code></td><td>States whether error dialogs will be shown if an invalid input is entered (using the Input Bar or JavaScript) Default: true</td><td>3.2</td></tr><tr><td>showMenuBar</td><td><code>true</code> or <code>false</code></td><td>States whether the menubar of GeoGebra should be shown in the applet. Default: false</td><td>2.5</td></tr><tr><td>showToolBar</td><td><code>true</code> or <code>false</code></td><td>States whether the toolbar with the construction mode buttons should be shown in the applet. Default: false</td><td>2.5</td></tr><tr><td>showToolBarHelp</td><td><code>true</code> or <code>false</code></td><td>States whether the toolbar help text right to the toolbar buttons should be shown in the applet</td><td>3.0</td></tr><tr><td>customToolBar</td><td>e.g. <code>0 1 2 3 , 4 5 6 7</code></td><td>Sets the toolbar according to a custom toolbar string where the int values are <a href="https://wiki.geogebra.org/en/Reference:Toolbar">Toolbar Mode Values</a>, <code>,</code> adds a separator within a menu, `</td><td><code>starts a new menu and</code></td></tr><tr><td>showAlgebraInput</td><td><code>true</code> or <code>false</code></td><td>States whether the algebra input line (with input field, greek letters and command list) should be shown in the applet. Default: false</td><td>2.5</td></tr><tr><td>showResetIcon</td><td><code>true</code> or <code>false</code></td><td>States whether a small icon (GeoGebra ellipse) should be shown in the upper right corner of the applet. Clicking on this icon resets the applet (i.e. it reloads the file given in the filename parameter). Default: false</td><td>2.5</td></tr><tr><td>language</td><td><a href="http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes">iso language string</a></td><td>GeoGebra tries to set your local language automatically (if it is available among the supported languages, of course). The default language for unsupported languages is English. If you want to specify a certain language manually, please use this parameter.</td><td>2.5</td></tr><tr><td>country</td><td>iso country string, e.g. <code>AT</code> for Austria</td><td>This parameter only makes sense if you use it together with the language parameter.</td><td>2.5</td></tr><tr><td>id</td><td>eg <code>applet2</code></td><td>This parameter allows you to specify the argument passed to the JavaScript function ggbOnInit(), which is called once the applet is fully initialised. This is useful when you have multiple applets on a page - see <a href="http://dev.geogebra.org/examples/html/example-api-sync.html">this example</a> (will have no effect in earlier versions)</td><td>3.2</td></tr><tr><td>allowStyleBar</td><td><code>true</code> or <code>false</code></td><td>Default: false Determines whether the Style Bar can be shown (or will be shown if just Graphics View 1 is showing)</td><td>4.0</td></tr><tr><td>appletOnLoad</td><td>eg <code>function(api)&#123; api.evalCommand(&#39;Segment((1,2),(3,4))&#39;); &#125;</code></td><td>JavaScript method to run when the activity is initialized (and file loaded if applicable)</td><td>5.0</td></tr><tr><td>useBrowserForJS</td><td><code>true</code> or <code>false</code></td><td>When true, GeoGebraruns ggbOnInit from HTMLignores ggbOnInit from fileignores JS update scripts of objects in fileWhen false, GeoGebra:ignores ggbOnInit from HTML (use appletOnLoad parameter of GGBApplet instead)runs ggbOnInit from fileruns JS update scripts of objects in file<strong>Default: false</strong></td><td>4.0</td></tr><tr><td>showLogging</td><td><code>true</code> or <code>false</code></td><td>Default: false Determines whether logging is shown in the Browser’s console</td><td>4.2</td></tr><tr><td>capturingThreshold</td><td>integer</td><td>Default: 3 Determines the sensitivity of object selection. The default value of 3 is usually fine to select and drag objects both with the mouse and touch. Use larger values (e.g. 4 or 5) to make it easier to select and drag objects.</td><td>4.4</td></tr><tr><td>enableFileFeatures</td><td><code>true</code> or <code>false</code></td><td>Default: true Determines whether file saving, file loading, sign in and Options &gt; Save settings are enabled. This argument is ignored when menubar is not showing.</td><td>5.0</td></tr><tr><td>perspective</td><td>string</td><td>For values see <a href="https://wiki.geogebra.org/en/SetPerspective_Command">SetPerspective_Command</a>. Just for a blank start ie shouldn’t be used with <em>material_id</em>, <em>filename</em> or <em>ggbBase64</em> parameters</td><td>5.0</td></tr><tr><td>enable3d</td><td><code>true</code> or <code>false</code> or none</td><td>Whether 3D should be enabled (for exam mode). When neither true nor false are entered, user can decide in a dialog.</td><td>5.0</td></tr><tr><td>enableCAS</td><td><code>true</code> or <code>false</code> or none</td><td>Whether CAS should be enabled (for exam mode). When neither true nor false are entered, user can decide in a dialog.</td><td>5.0</td></tr><tr><td>algebraInputPosition</td><td><code>algebra</code>, <code>top</code> or <code>bottom</code></td><td>Default: empty Determines whether input bar should be shown in algebra, on top of the applet or under the applet. When left empty, the position depends on file.</td><td>5.0</td></tr><tr><td>preventFocus</td><td><code>true</code> or <code>false</code></td><td>Default: false. When set to true, this prevents the applet from getting focus automatically at the start.</td><td>5.0</td></tr><tr><td>scaleContainerClass</td><td>String</td><td>Name of CSS class that is used as container; applet will scale to fit into the container.</td><td>5.0</td></tr><tr><td>autoHeight</td><td>boolean</td><td>• <code>true</code> to restrict the width of the applet and compute height automatically, add <code>autoHeight:true</code> • <code>false</code>if you want the applet to be restricted by both width and height of the container</td><td>5.0</td></tr><tr><td>allowUpscale</td><td><code>true</code> or <code>false</code></td><td>Default: false Determines whether automatic scaling may scale the applet up</td><td>5.0</td></tr><tr><td>playButton</td><td><code>true</code> or <code>false</code></td><td>Default: false Determines whether a preview image and a play button should be rendered in place of the applet. Pushing the play button initializes the applet.</td><td>5.0</td></tr><tr><td>scale</td><td>number</td><td>Ratio by which the applet should be scaled (eg. 2 makes the applet 2 times bigger, including all texts and UI elements). Default: 1</td><td>5.0</td></tr><tr><td>showAnimationButton</td><td><code>true</code> or <code>false</code></td><td>Whether animation button should be visible</td><td>5.0</td></tr><tr><td>showFullscreenButton</td><td><code>true</code> or <code>false</code></td><td>Whether fullscreen button should be visible</td><td>6.0</td></tr><tr><td>showSuggestionButtons</td><td><code>true</code> or <code>false</code></td><td>Whether suggestion buttons (special points, solve) in Algebra View should be visible</td><td>6.0</td></tr><tr><td>showStartTooltip</td><td><code>true</code> or <code>false</code></td><td>Whether “Welcome” tooltip should be shown</td><td>5.0</td></tr><tr><td>rounding</td><td>string</td><td>String composed of number of decimal places and flags – valid flags are “s” for significant digits and “r” for rational numbers. Hence “10” means 10 decimal places, “10s” stands for 10 significant digits.</td><td>6.0</td></tr><tr><td>buttonShadows</td><td><code>true</code> or <code>false</code></td><td>Whether buttons should have shadow</td><td>6.0</td></tr><tr><td>buttonRounding</td><td>Number (0 - 0.9)</td><td>Relative radius of button’s rounded border. The border radius in pixels is <code>buttonRounding * height /2</code>, where <code>height</code> is the height of the button. Default 0.2.</td><td>6.0</td></tr><tr><td>buttonBorderColor</td><td>Hex color (<code>#RGB</code>, <code>#RGBA</code>, <code>#RRGGBB</code> or <code>#RRGGBBAA</code>)</td><td>Border color of buttons on the graphics view. Default is black, if the button background is white, otherwise one shade darker than the background color</td><td>6.0</td></tr><tr><td>editorBackgroundColor</td><td>Hex color</td><td>Background color of the evaluator app</td><td>6.0</td></tr><tr><td>editorForegroundColor</td><td>Hex color</td><td>Foreground (text) color of the equation editor (appname = “evaluator”)</td><td>6.0</td></tr><tr><td>textmode</td><td>false], default false</td><td>whether editor is in text mode or not (appname = “evaluator”)</td><td>6.0</td></tr><tr><td>keyboardType</td><td>“normal”|”notes”]</td><td>Which keyboard is shown for equation editor (appname = “evaluator”)</td><td>6.0</td></tr></tbody></table><h3 id="Hexo-稳妥嵌入-geogebra-最佳实践"><a href="#Hexo-稳妥嵌入-geogebra-最佳实践" class="headerlink" title="Hexo 稳妥嵌入 geogebra 最佳实践"></a>Hexo 稳妥嵌入 geogebra 最佳实践</h3><ul><li>个人偏好的最佳实践路径：</li></ul><pre class="mermaid">graph TD    A[搭建本地geogebra渲染环境] --> B    B[绘制geogebra图形] -->C{分享方式}    C --  ggb文件 -->D[获取上传ggb文件链接] --> F[使用filename方式嵌入markdown]     C --  ggbBase64代码  -->E[ctrl+shift+B获取代码] --> G[使用ggbBase64方式嵌入markdown]</pre><ul><li>优点：</li><li><input checked="" disabled="" type="checkbox"> 自己提供服务，不受官网束缚</li><li><input checked="" disabled="" type="checkbox"> 使用图形源文件提供展示，安全可靠</li><li><input checked="" disabled="" type="checkbox"> 可互动，有滑块，可以满足绝大多数展示需求</li><li><input checked="" disabled="" type="checkbox"> 流程相对简单清晰</li><li><input checked="" disabled="" type="checkbox"> 加载速度可以接受</li><li><input checked="" disabled="" type="checkbox"> 手机端可以显示同样效果</li><li><input checked="" disabled="" type="checkbox"> 环境配好后无缝融入hexo博客环境</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://www.geogebra.org/">https://www.geogebra.org/</a></li><li><a href="https://blog.csdn.net/fatty_zhu/article/details/77411254">https://blog.csdn.net/fatty_zhu/article/details/77411254</a></li><li><a href="https://www.bilibili.com/video/av80321187/">https://www.bilibili.com/video/av80321187/</a></li><li><a href="https://kz16.top/">https://kz16.top/</a></li><li><a href="https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters">https://wiki.geogebra.org/en/Reference:GeoGebra_App_Parameters</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>tools</category>
      
      <category>geogebra</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tools</tag>
      
      <tag>geogebra</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux 获取cpu信息</title>
    <link href="/2020/12/18/linux/get-cpu-info/get-cpu-info/"/>
    <url>/2020/12/18/linux/get-cpu-info/get-cpu-info/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Linux系统获取CPU信息方法。</p></blockquote><span id="more"></span><h3 id="命令-1"><a href="#命令-1" class="headerlink" title="命令 1"></a>命令 1</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /proc/cpuinfo  <br></code></pre></td></tr></table></figure><blockquote><p>得到输出信息：</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">processor</span>: <span class="hljs-number">0</span><br><span class="hljs-attribute">vendor_id</span>: GenuineIntel<br><span class="hljs-attribute">cpu</span> family: <span class="hljs-number">6</span><br><span class="hljs-attribute">model</span>: <span class="hljs-number">63</span><br><span class="hljs-attribute">model</span> name: Intel(R) Xeon(R) CPU E<span class="hljs-number">5</span>-<span class="hljs-number">2678</span> v<span class="hljs-number">3</span> @ <span class="hljs-number">2</span>.<span class="hljs-number">50</span>GHz<br><span class="hljs-attribute">stepping</span>: <span class="hljs-number">2</span><br><span class="hljs-attribute">microcode</span>: <span class="hljs-number">0</span>x<span class="hljs-number">43</span><br><span class="hljs-attribute">cpu</span> MHz: <span class="hljs-number">1200</span>.<span class="hljs-number">000</span><br><span class="hljs-attribute">cache</span> size: <span class="hljs-number">30720</span> KB<br><span class="hljs-attribute">physical</span> id: <span class="hljs-number">0</span><br><span class="hljs-attribute">siblings</span>: <span class="hljs-number">24</span><br><span class="hljs-attribute">core</span> id: <span class="hljs-number">0</span><br><span class="hljs-attribute">cpu</span> cores: <span class="hljs-number">12</span><br><span class="hljs-attribute">apicid</span>: <span class="hljs-number">0</span><br><span class="hljs-attribute">initial</span> apicid: <span class="hljs-number">0</span><br><span class="hljs-attribute">fpu</span>: yes<br><span class="hljs-attribute">fpu_exception</span>: yes<br><span class="hljs-attribute">cpuid</span> level: <span class="hljs-number">15</span><br><span class="hljs-attribute">wp</span>: yes<br><span class="hljs-attribute">flags</span>: fpu vme de pse tsc msr pae mce cx<span class="hljs-number">8</span> apic sep mtrr pge mca cmov pat pse<span class="hljs-number">36</span> clflush dts acpi mmx fxsr sse sse<span class="hljs-number">2</span> ss ht tm pbe syscall nx pdpe<span class="hljs-number">1</span>gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes<span class="hljs-number">64</span> monitor ds_cpl vmx smx est tm<span class="hljs-number">2</span> ssse<span class="hljs-number">3</span> sdbg fma cx<span class="hljs-number">16</span> xtpr pdcm pcid dca sse<span class="hljs-number">4</span>_<span class="hljs-number">1</span> sse<span class="hljs-number">4</span>_<span class="hljs-number">2</span> x<span class="hljs-number">2</span>apic movbe popcnt tsc_deadline_timer aes xsave avx f<span class="hljs-number">16</span>c rdrand lahf_lm abm epb invpcid_single ssbd ibrs ibpb stibp kaiser tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi<span class="hljs-number">1</span> avx<span class="hljs-number">2</span> smep bmi<span class="hljs-number">2</span> erms invpcid cqm xsaveopt cqm_llc cqm_occup_llc dtherm ida arat pln pts flush_l<span class="hljs-number">1</span>d<br><span class="hljs-attribute">bugs</span>: cpu_meltdown spectre_v<span class="hljs-number">1</span> spectre_v<span class="hljs-number">2</span> spec_store_bypass l<span class="hljs-number">1</span>tf<br><span class="hljs-attribute">bogomips</span>: <span class="hljs-number">4997</span>.<span class="hljs-number">11</span><br><span class="hljs-attribute">clflush</span> size: <span class="hljs-number">64</span><br><span class="hljs-attribute">cache_alignment</span>: <span class="hljs-number">64</span><br><span class="hljs-attribute">address</span> sizes: <span class="hljs-number">46</span> bits physical, <span class="hljs-number">48</span> bits virtual<br><span class="hljs-attribute">power</span> management:<br></code></pre></td></tr></table></figure><blockquote><p>主要内容含义：</p></blockquote><table><thead><tr><th>条目</th><th>含义</th></tr></thead><tbody><tr><td>processor</td><td>条目包括这一逻辑处理器的唯一标识符</td></tr><tr><td>physical id</td><td>条目包括每个物理封装的唯一标识符</td></tr><tr><td>core id</td><td>条目保存每个内核的唯一标识符</td></tr><tr><td>siblings</td><td>条目列出了位于相同物理封装中的逻辑处理器的数量</td></tr><tr><td>cpu cores</td><td>条目包含位于相同物理封装中的内核数量</td></tr><tr><td>英特尔处理器</td><td>vendor id 条目中的字符串是 GenuineIntel</td></tr></tbody></table><h3 id="命令-2"><a href="#命令-2" class="headerlink" title="命令 2"></a>命令 2</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">lscpu</span>  <br></code></pre></td></tr></table></figure><blockquote><p>得到输出信息：</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Architecture</span>:          x<span class="hljs-number">86</span>_<span class="hljs-number">64</span><br><span class="hljs-attribute">CPU</span> op-mode(s):        <span class="hljs-number">32</span>-bit, <span class="hljs-number">64</span>-bit<br><span class="hljs-attribute">Byte</span> Order:            Little Endian<br><span class="hljs-attribute">CPU</span>(s):                <span class="hljs-number">24</span><br><span class="hljs-attribute">On</span>-line CPU(s) list:   <span class="hljs-number">0</span>-<span class="hljs-number">23</span><br><span class="hljs-attribute">Thread</span>(s) per core:    <span class="hljs-number">2</span><br><span class="hljs-attribute">Core</span>(s) per socket:    <span class="hljs-number">12</span><br><span class="hljs-attribute">Socket</span>(s):             <span class="hljs-number">1</span><br><span class="hljs-attribute">NUMA</span> node(s):          <span class="hljs-number">1</span><br><span class="hljs-attribute">Vendor</span> ID:             GenuineIntel<br><span class="hljs-attribute">CPU</span> family:            <span class="hljs-number">6</span><br><span class="hljs-attribute">Model</span>:                 <span class="hljs-number">63</span><br><span class="hljs-attribute">Model</span> name:            Intel(R) Xeon(R) CPU E<span class="hljs-number">5</span>-<span class="hljs-number">2678</span> v<span class="hljs-number">3</span> @ <span class="hljs-number">2</span>.<span class="hljs-number">50</span>GHz<br><span class="hljs-attribute">Stepping</span>:              <span class="hljs-number">2</span><br><span class="hljs-attribute">CPU</span> MHz:               <span class="hljs-number">2500</span>.<span class="hljs-number">000</span><br><span class="hljs-attribute">CPU</span> max MHz:           <span class="hljs-number">3300</span>.<span class="hljs-number">0000</span><br><span class="hljs-attribute">CPU</span> min MHz:           <span class="hljs-number">1200</span>.<span class="hljs-number">0000</span><br><span class="hljs-attribute">BogoMIPS</span>:              <span class="hljs-number">4997</span>.<span class="hljs-number">11</span><br><span class="hljs-attribute">Virtualization</span>:        VT-x<br><span class="hljs-attribute">L1d</span> cache:             <span class="hljs-number">32</span>K<br><span class="hljs-attribute">L1i</span> cache:             <span class="hljs-number">32</span>K<br><span class="hljs-attribute">L2</span> cache:              <span class="hljs-number">256</span>K<br><span class="hljs-attribute">L3</span> cache:              <span class="hljs-number">30720</span>K<br><span class="hljs-attribute">NUMA</span> node<span class="hljs-number">0</span> CPU(s):     <span class="hljs-number">0</span>-<span class="hljs-number">23</span><br><span class="hljs-attribute">Flags</span>:                 fpu vme de pse tsc msr pae mce cx<span class="hljs-number">8</span> apic sep mtrr pge mca cmov pat pse<span class="hljs-number">36</span> clflush dts acpi mmx fxsr sse sse<span class="hljs-number">2</span> ss ht tm pbe syscall nx pdpe<span class="hljs-number">1</span>gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes<span class="hljs-number">64</span> monitor ds_cpl vmx smx est tm<span class="hljs-number">2</span> ssse<span class="hljs-number">3</span> sdbg fma cx<span class="hljs-number">16</span> xtpr pdcm pcid dca sse<span class="hljs-number">4</span>_<span class="hljs-number">1</span> sse<span class="hljs-number">4</span>_<span class="hljs-number">2</span> x<span class="hljs-number">2</span>apic movbe popcnt tsc_deadline_timer aes xsave avx f<span class="hljs-number">16</span>c rdrand lahf_lm abm epb invpcid_single ssbd ibrs ibpb stibp kaiser tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi<span class="hljs-number">1</span> avx<span class="hljs-number">2</span> smep bmi<span class="hljs-number">2</span> erms invpcid cqm xsaveopt cqm_llc cqm_occup_llc dtherm ida arat pln pts flush_l<span class="hljs-number">1</span>d<br></code></pre></td></tr></table></figure><blockquote><p>主要内容含义：</p></blockquote><table><thead><tr><th>条目</th><th>含义</th></tr></thead><tbody><tr><td>socket</td><td>物理CPU的插槽</td></tr><tr><td>Core per Socket</td><td>每一个插槽对应的物理CPU上有多少个核</td></tr><tr><td>Thread per Core</td><td>每个核上有多少个线程</td></tr></tbody></table><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/andyzhaojianhui/article/details/79864906">https://blog.csdn.net/andyzhaojianhui/article/details/79864906</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>DVC 使用手册</title>
    <link href="/2020/12/17/dvc/dvc/"/>
    <url>/2020/12/17/dvc/dvc/</url>
    
    <content type="html"><![CDATA[<blockquote><p>dvc是将大文件以类似git的形式进行管理的工具，结合git可以做到无痛管理项目文件，虽然眼下开发还不够成熟，不过已经为开发带来了很大方便。本文介绍dvc常用命令的使用方法。</p></blockquote><span id="more"></span><blockquote><p>本手册提供基本的DVC使用方法。<br>更详细的DVC使用方法请参考<a href="https://www.dvc.org/doc/">DVC官方文档</a>。</p></blockquote><h2 id="0-DVC安装"><a href="#0-DVC安装" class="headerlink" title="0. DVC安装"></a>0. DVC安装</h2><p>各个平台下都可以用 pip 安装</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">pip <span class="hljs-keyword">install </span>dvc<br>pip <span class="hljs-keyword">install </span>dvc[<span class="hljs-built_in">s3</span>]<br></code></pre></td></tr></table></figure><blockquote><p>在Win平台下可能会报错：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">ERROR: </span>Cannot uninstall &#x27;ruamel-yaml&#x27;. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.<br></code></pre></td></tr></table></figure><p>此时需要进入python 的lib/site-packages 中删除 ‘ruamel-yaml’ 相关的文件</p></blockquote><p><strong>注意：</strong> dvc 2.3.0 版本与之后的hash计算方法不同，不能混用</p><h2 id="1-DVC基本用法"><a href="#1-DVC基本用法" class="headerlink" title="1. DVC基本用法"></a>1. DVC基本用法</h2><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>使用<code>dvc init</code>命令初始化一个项目。注意，初始化DVC之前需要先初始化Git。<br>example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir example-get-started<br>cd example-get-started<br>git init<br>dvc init<br></code></pre></td></tr></table></figure><p><code>dvc init</code>命令会自动创建<code>.dvc</code>目录。</p><h3 id="Track文件或目录"><a href="#Track文件或目录" class="headerlink" title="Track文件或目录"></a>Track文件或目录</h3><p>使用<code>dvc add</code>命令track文件或目录。</p><p>example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc add data.xml<br></code></pre></td></tr></table></figure><p>DVC将文件或目录的信息存储在<code>.dvc</code>文件中，如<code>data.xml.dvc</code>。DVC还会自动修改.gitignore文件。需要在Git中add这两个文件并提交。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git add data.xml.dvc .gitignore<br>git commit -m &quot;Add xml data&quot;<br></code></pre></td></tr></table></figure><h3 id="设置remote-storage"><a href="#设置remote-storage" class="headerlink" title="设置remote storage"></a>设置remote storage</h3><p>使用<code>dvc remote add</code>命令可以设置DVC的remote。DI使用兼容亚马逊S3 API的对象存储做为DVC的remote storage。</p><p>设置方法如下：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">dvc</span> remote <span class="hljs-keyword">add</span> -d myremote <span class="hljs-built_in">s3</span>:<span class="hljs-comment">//dvc</span><br><span class="hljs-symbol">dvc</span> remote modify myremote endpointurl http:<span class="hljs-comment">//ceph01</span><br></code></pre></td></tr></table></figure><p>其中myremote是DVC remote的名字，<code>s3://dvc</code>是bucket的位置，<code>http://ceph01</code>是对象存储的endpoint。</p><p>同时还需要配置如下环境变量：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">export AWS_ACCESS_KEY_ID=&quot;&lt;my-access-key&gt;&quot;<br>export AWS_SECRET_ACCESS_KEY=&quot;&lt;my-secret-key&gt;&quot;<br></code></pre></td></tr></table></figure><p>AWS_ACCESS_KEY_ID和AWS_SECRET_ACCESS_KEY无效时，请联系管理员获取新的key。</p><h3 id="推送到remote"><a href="#推送到remote" class="headerlink" title="推送到remote"></a>推送到remote</h3><p>设置remote storage之后，可以使用<code>dvc push</code>命令推送数据到remote。</p><p>example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc push<br></code></pre></td></tr></table></figure><h3 id="拉取数据"><a href="#拉取数据" class="headerlink" title="拉取数据"></a>拉取数据</h3><p>DVC-tracked data被存储到remote之后，可以通过<code>dvc pull</code>拉取远端的数据到本地。通常，在<code>git clone</code>和<code>git pull</code>之后运行<code>dvc pull</code>。</p><p>example：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc pull<br></code></pre></td></tr></table></figure><h2 id="2-创建基于DVC的Git项目"><a href="#2-创建基于DVC的Git项目" class="headerlink" title="2. 创建基于DVC的Git项目"></a>2. 创建基于DVC的Git项目</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul><li><p>安装dvc</p><p><code>pip install dvc</code></p></li><li><p>ceph对象存储服务配置</p><p>设置环境变量</p><p><code>export AWS_ACCESS_KEY_ID=18M4BI7CGWKWSYELOXC3</code></p><p>配置hosts文件，在hosts文件中增加以下内容<br><code>192.168.10.91 ceph01</code></p></li></ul><h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>   假设项目名称为demo，数据位于demo/data目录。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd demo<br>git init<br>dvc init<br></code></pre></td></tr></table></figure><h3 id="设置DVC的remote"><a href="#设置DVC的remote" class="headerlink" title="设置DVC的remote"></a>设置DVC的remote</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc remote add -d myremote s3://dvc<br>dvc remote modify myremote endpointurl http://ceph01<br></code></pre></td></tr></table></figure><h3 id="track-data"><a href="#track-data" class="headerlink" title="track data"></a>track data</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc add data<br>dvc push<br></code></pre></td></tr></table></figure><h3 id="提交Git"><a href="#提交Git" class="headerlink" title="提交Git"></a>提交Git</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git add .<br>git commit -m &quot;track data&quot;<br></code></pre></td></tr></table></figure><h2 id="3-Data-Registry"><a href="#3-Data-Registry" class="headerlink" title="3. Data Registry"></a>3. Data Registry</h2><p>data registry用于数据和代码相分离的情况，即代码和数据不在同一目录。同时，data registry使得数据和模型可以在不同的项目间共享。DVC提供了<code>dvc import</code>和<code>dvc get</code>命令来拉取data registry中的数据。</p><h3 id="构建registry"><a href="#构建registry" class="headerlink" title="构建registry"></a>构建registry</h3><p>与一般DVC项目一样，data registry使用<code>git init</code>和<code>dvc init</code>进行初始化。<br>将数据集添加到data registry中很简单，只需要将相关数据放置在workspace中，然后用<code>dvc add</code>track它们。例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p music/songs<br>cp ~/Downloads/millionsongsubset_full music/songs<br>dvc add music/songs/<br></code></pre></td></tr></table></figure><p>然后使用常规的Git workflow管理产生的<code>.dvc</code>文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git add music/songs.dvc music/.gitignore<br>git commit -m &quot;Track 1.8 GB 10,000 song dataset in music/&quot;<br></code></pre></td></tr></table></figure><p>实际的数据存储在项目的cache中，可以通过<code>dvc push</code>推送到remote storage以便其人能够访问。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc remote add -d myremote s3://dvc<br>dvc push<br></code></pre></td></tr></table></figure><h3 id="使用registry"><a href="#使用registry" class="headerlink" title="使用registry"></a>使用registry</h3><h4 id="列出数据"><a href="#列出数据" class="headerlink" title="列出数据"></a>列出数据</h4><p>使用<code>dvc list</code>命令可以列出registry中的内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc list -R https://github.com/iterative/dataset-registry<br></code></pre></td></tr></table></figure><h4 id="直接下载"><a href="#直接下载" class="headerlink" title="直接下载"></a>直接下载</h4><p>从registry中直接下载数据可以使用<code>dvc get</code>命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc get https://github.com/example/registry music/songs<br></code></pre></td></tr></table></figure><h4 id="import-workflow"><a href="#import-workflow" class="headerlink" title="import workflow"></a>import workflow</h4><p><code>dvc import</code>命令可以下载registry中的数据，同时会创建对应的<code>.dvc</code>文件，该文件包含了元数据。注意，<code>dvc import</code>必须在初始化过的dvc workspace中才能运行。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc import https://github.com/example/registry music/songs<br></code></pre></td></tr></table></figure><h4 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h4><p>若项目引用的registry中的数据发送了更新，可以使用<code>dvc update</code>同步此数据：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dvc update dataset.dvc<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>dvc</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dvc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>二次型优化问题 - 5 - 最速下降法</title>
    <link href="/2020/12/16/machine_learning/conjugate-gradient-algorithm/steepest-descent-method/steepest-descent-method/"/>
    <url>/2020/12/16/machine_learning/conjugate-gradient-algorithm/steepest-descent-method/steepest-descent-method/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍优化二次型的常用迭代方法——最速下降法。</p></blockquote><span id="more"></span><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><blockquote><p>重述我们需要优化的问题：</p></blockquote><p>$$<br>f({\bf{x} }) = \frac{1}{2}{\bf{x^TAx} } - { {\bf{b} }^{\bf{T} } }{\bf{x} } + {\bf{c} } \tag{1} \label{1}<br>$$</p><ul><li>矩阵$\bf{A}$正定对称</li><li>目标为优化$\bf{x}$，使得$f(\bf{x})$取得最小值</li></ul><h3 id="最速下降法"><a href="#最速下降法" class="headerlink" title="最速下降法"></a>最速下降法</h3><blockquote><p>当有一天大神们厌倦了代数法解决优化问题时，提出了迭代计算，逐步接近最优解的优化方法，方法的思想也是朴素直观的。</p></blockquote><h4 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h4><ul><li>我们的目标是找到函数的最小值，而且我已经知道了这个函数就那么一个极小值点，相当于找到一个曲面的最低点，最速下降法的流程图：</li></ul><pre class="mermaid">graph LR    A[寻找函数最小值]-->B[计算当前梯度方向]    B --> C[计算前进距离]    C --> D{精度是否满足要求}    D -- 否 --> B    D -- 是 --> E[输出当前位置]</pre><h4 id="计算流程"><a href="#计算流程" class="headerlink" title="计算流程"></a>计算流程</h4><h5 id="初始位置：-bf-x-0"><a href="#初始位置：-bf-x-0" class="headerlink" title="初始位置： $\bf{x}_0$"></a>初始位置： $\bf{x}_0$</h5><h5 id="计算梯度-bf-g"><a href="#计算梯度-bf-g" class="headerlink" title="计算梯度$\bf{g}$"></a>计算梯度$\bf{g}$</h5><ul><li>沿用之前的<a href="https://www.zywvvd.com/2020/12/12/machine_learning/conjugate-gradient-algorithm/quadratic_cofficient/quadratic_cofficient/#%E4%B8%BA%E4%BD%95%E5%A6%82%E6%AD%A4">计算结论</a>：</li></ul><p>$$<br>\bf{g} = f’(\bf{x}) = A\bf{x}-\bf{b} \tag{2}<br>$$</p><ul><li>那么关于 $\bf{x}_0$为了寻找最小值，需要向梯度的反方向前进，但为了保证推导过程顺遂，前进距离系数不管符号，设第$i$步需要前进的距离为${\alpha}_i$,那么对于第$i$个$\bf{x}_i$，有：</li></ul><p>$$<br>{\bf{x}_{i + 1} } = {\bf{x}_i} + \alpha_i {\bf{g}_i} \tag{3} \label{3}<br>$$</p><h5 id="系数-alpha-i-求解"><a href="#系数-alpha-i-求解" class="headerlink" title="系数${\alpha}_i$求解"></a>系数${\alpha}_i$求解</h5><h6 id="方法1："><a href="#方法1：" class="headerlink" title="方法1："></a>方法1：</h6><blockquote><p>行动前后两个位置的梯度方向需要正交，不然当前行动的位置还可以取到更低的值：</p><p>即：</p></blockquote>$${\bf{g}}_i^T {{\bf{g}}_{i + 1}}=0 \tag{4}$$其中：$${ {\bf{g} }_i}{\bf{ = A} }{ {\bf{x} }_i}{\bf{ - b} } \tag{5}$$$${ {\bf{x} }_{i + 1} } = { {\bf{x} }_i} + {\alpha _i}{ {\bf{g} }_i} = {\bf{x}_i} + {\alpha _i}({\bf{A} }{ {\bf{x} }_i} - {\bf{b} }) \tag{6}$$$$\begin{array}{l}{ {\bf{g} }_{i + 1} } &= {\bf{A} }{ {\bf{x} }_{i + 1} } - {\bf{b} }\\ &= {\bf{A} }({ {\bf{x} }_i} + {\alpha _i}{ {\bf{g} }_i}) - {\bf{b} } \tag{7}\end{array}$$那么有：$${\bf{g} }_i^T{ {\bf{g} }_{i + 1} } = {\bf{g} }_i^T{\bf{A} }({ {\bf{x} }_i} + {\alpha _i}{ {\bf{g} }_i}) - {\bf{g} }_i^T{\bf{b} } = 0$$$${\bf{g} }_i^T{\bf{A} }{ {\bf{x} }_i} + {\alpha _i}{\bf{g} }_i^T{\bf{A} }{ {\bf{g} }_i} - {\bf{g} }_i^T{\bf{b} } = 0$$$${\alpha _i}{\bf{g} }_i^T{\bf{A} }{ {\bf{g} }_i} + {\bf{g} }_i^T{ {\bf{g} }_i} = 0$$$${\alpha _i} =  - \frac{ { {\bf{g} }_i^T{ {\bf{g} }_i} } }{ { {\bf{g} }_i^T{\bf{A} }{ {\bf{g} }_i} } } \tag{8}$$<h6 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h6><blockquote><p>确定梯度方向$\bf{g}$后求解$\alpha$，由于最速下降法确定的是每一步方向上的局部最优解，也就是沿着这个方向运动得到最小值的位置，那么可以对$\alpha$求导，使得导数为0：</p></blockquote><ul><li>由$\eqref{1}$和$\eqref{3}$，有：</li></ul><p>$$<br>f({\bf{x} }) = \frac{1}{2}{({\bf{x} } + \alpha {\bf{g} })^T}{\bf{A} }({\bf{x} } + \alpha {\bf{g} }) - { {\bf{b} }^{\bf{T} } }({\bf{x} } + \alpha {\bf{g} }) + {\bf{c} } \tag{9}<br>$$</p><ul><li>对于已经确定的当前位置$\bf{x}_i$，当前可以看成是关于$\bf{x}_i$，$\alpha_i$的函数：</li></ul><p>$$<br>f(\bf{x}_{i+1}) =f(\bf{x}_i,{\alpha _i}) = \frac{1}{2}{({ {\bf{x} }_i} + {\alpha _i}{ {\bf{g} }_i})^T}{\bf{A} }({ {\bf{x} }_i} + {\alpha _i}{ {\bf{g} }_i}) - { {\bf{b} }^{\bf{T} } }({ {\bf{x} }_i} + {\alpha _i}{ {\bf{g} }_i}) + {\bf{c} } \tag{10}<br>$$</p><ul><li>对$\alpha_i$求偏导：</li></ul>$$\begin{array}{l}\frac{ {\partial f({ {\bf{x} }_{i + 1} })} }{ {\partial {\alpha _i} } } &= \frac{ {\partial f({ {\bf{x} }_{i + 1} })} }{ {\partial { {\bf{x} }_{i + 1} } } }\frac{ {\partial { {\bf{x} }_{i + 1} } } }{ {\partial {\alpha _i} } }\\ &= {({\bf{A} }{ {\bf{x} }_{i + 1} } - {\bf{b} })^T}{ {\bf{g} }_i}\\ &= {({\bf{A} }({ {\bf{x} }_i} + {\alpha _i}{ {\bf{g} }_i}) - {\bf{b} })^T}{ {\bf{g} }_i}\\ &= {({\bf{A} }{ {\bf{x} }_i} - {\bf{b} } + {\alpha _i}{\bf{A} }{ {\bf{g} }_i})^T}{ {\bf{g} }_i}\\ &= ({\bf{g} }_i^T + {\alpha _i}{\bf{g} }_i^T{\bf{A} }){ {\bf{g} }_i}\\ &= {\bf{g} }_i^T{ {\bf{g} }_i} + {\alpha _i}{\bf{g} }_i^T{\bf{A} }{ {\bf{g} }_i} =0\end{array} \tag{11}$$<ul><li>得到：</li></ul><p>$$<br>{\alpha _i} =  - \frac{ { {\bf{g} }_i^T{ {\bf{g} }_i} } }{ { {\bf{g} }_i^T{\bf{A} }{ {\bf{g} }_i} } } \tag{12}<br>$$</p><h5 id="下一个位置"><a href="#下一个位置" class="headerlink" title="下一个位置"></a>下一个位置</h5><ul><li>按照公式$\eqref{3}$，获取下一个获取的位置$\bf{x}_{i+1}$</li><li>检测当前梯度大小，如果梯度小于一定阈值$\varepsilon$即认为已经达到了极小值：</li></ul><p>$$<br>\varepsilon  \ge \left| { { {\bf{g} }_{i+1} } } \right| \tag{13}<br>$$</p><ul><li>否则再向前走下一步</li></ul><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ul><li><p>最速下降法是一种简单拟合当前问题的贪心优化方法，通过一步步计算局部最优解来逼近全局最优解，其本质为：</p><ul><li>将当前的二次型拟合成高维球形</li><li>运动到拟合球形的中心</li><li>计算误差，测量精度</li><li>若精度不够则，根据误差拟合下一个高维球</li></ul></li><li><p>首先，要声明的是，该方法是收敛的，也就是在我们定义的问题下，是可以逐步收敛到最优解的，证明比较复杂，参考<a href="https://zhuanlan.zhihu.com/p/23799012">番外篇(2)——无聊的最速下降法推导</a></p></li><li><p>该方法也存在一定问题，由于建模过于简单，导致其计算出的最优值结果与真实最小值不断遗漏下偏差，带来的结果就是需要往复迭代才能接近最优值</p></li></ul><h3 id="共轭梯度法的由来"><a href="#共轭梯度法的由来" class="headerlink" title="共轭梯度法的由来"></a>共轭梯度法的由来</h3><ul><li>最速下降法拟合的方案过于简单，导致了该方法注定无法轻易得到全局最优解</li><li>如果可以有正确拟合真实二次型的迭代优化方法，那么如果找到了这个模型下的最优值，岂不就迭代得到了全局最优解</li><li>带着这个初衷，大神们提出了共轭梯度法</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python opencv 显示多窗口图像并获取点击处像素点坐标</title>
    <link href="/2020/12/16/image_processing/cv-image-event/cv-image-event/"/>
    <url>/2020/12/16/image_processing/cv-image-event/cv-image-event/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍使用python 的 opencv 库显示多个图片窗口，并获取点击点像素位置的方法。</p></blockquote><span id="more"></span><h3 id="opencv-显示图像"><a href="#opencv-显示图像" class="headerlink" title="opencv 显示图像"></a>opencv 显示图像</h3><blockquote><p>显示图像主要通过<code>namedWindow</code>方法定义窗口，和<code>imshow</code>方法刷新窗口内容实现的，需要停止时按<code>Esc</code>键退出并销毁窗口：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">image = np.zeros((<span class="hljs-number">512</span>,<span class="hljs-number">512</span>,<span class="hljs-number">3</span>), np.uint8)<br>cv2.namedWindow(<span class="hljs-string">&#x27;image&#x27;</span>)<br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>    cv2.imshow(<span class="hljs-string">&#x27;image&#x27;</span>, image)<br>    <span class="hljs-keyword">if</span> cv2.waitKey(<span class="hljs-number">20</span>) &amp; <span class="hljs-number">0xFF</span> == <span class="hljs-number">27</span>:<br>        <span class="hljs-keyword">break</span><br>cv2.destroyAllWindows()<br></code></pre></td></tr></table></figure><blockquote><p>显示多幅图像就使用不同的窗口名称建立窗口即可：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">image_1 = np.zeros((<span class="hljs-number">512</span>,<span class="hljs-number">512</span>,<span class="hljs-number">3</span>), np.uint8)<br>cv2.namedWindow(<span class="hljs-string">&#x27;image_1&#x27;</span>)<br>image_2 = np.zeros((<span class="hljs-number">512</span>,<span class="hljs-number">512</span>,<span class="hljs-number">3</span>), np.uint8)<br>cv2.namedWindow(<span class="hljs-string">&#x27;image_1&#x27;</span>)<br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>    cv2.imshow(<span class="hljs-string">&#x27;image_1&#x27;</span>, image_1)<br>    cv2.imshow(<span class="hljs-string">&#x27;image_2&#x27;</span>, image_2)<br>    <span class="hljs-keyword">if</span> cv2.waitKey(<span class="hljs-number">20</span>) &amp; <span class="hljs-number">0xFF</span> == <span class="hljs-number">27</span>:<br>        <span class="hljs-keyword">break</span><br>cv2.destroyAllWindows()<br></code></pre></td></tr></table></figure><h3 id="获取鼠标单击事件信息"><a href="#获取鼠标单击事件信息" class="headerlink" title="获取鼠标单击事件信息"></a>获取鼠标单击事件信息</h3><blockquote><p>本质上是cv库中的事件绑定、触发、捕获信息的流程，就用简单的示例抛砖引玉了。</p></blockquote><ul><li>定义事件函数：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_point</span>(<span class="hljs-params">event, x, y, flags, param</span>):</span><br>    <span class="hljs-keyword">if</span> event == cv2.EVENT_LBUTTONDOWN:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;clicking: &#x27;</span>, x, y)<br></code></pre></td></tr></table></figure><ul><li>绑定事件：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">cv2.setMouseCallback(<span class="hljs-string">&#x27;image_1&#x27;</span>, get_point, param)<br></code></pre></td></tr></table></figure><blockquote><p>可以向事件中传入参数，放在<code>param</code>位置。</p></blockquote><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_point</span>(<span class="hljs-params">event, x, y, flags, param</span>):</span><br>    <span class="hljs-comment"># 鼠标单击事件</span><br>    <span class="hljs-keyword">if</span> event == cv2.EVENT_LBUTTONDOWN:<br>        <span class="hljs-comment"># 输出坐标</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;clicking: &#x27;</span>, x, y)<br>        <span class="hljs-comment"># 在传入参数图像上画出该点</span><br>        cv2.circle(param, (x, y), <span class="hljs-number">1</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>), thickness=-<span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 定义两幅图像</span><br>    image_1 = np.zeros((<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">3</span>), dtype=<span class="hljs-string">&#x27;uint8&#x27;</span>)<br>    image_2 = np.zeros((<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">3</span>), dtype=<span class="hljs-string">&#x27;uint8&#x27;</span>)<br><br>    <span class="hljs-comment"># 定义两个窗口 并绑定事件 传入各自对应的参数</span><br>    cv2.namedWindow(<span class="hljs-string">&#x27;image_1&#x27;</span>)<br>    cv2.setMouseCallback(<span class="hljs-string">&#x27;image_1&#x27;</span>, get_point, image_1)<br><br>    cv2.namedWindow(<span class="hljs-string">&#x27;image_2&#x27;</span>)<br>    cv2.setMouseCallback(<span class="hljs-string">&#x27;image_2&#x27;</span>, get_point, image_2)<br><br>    <span class="hljs-comment"># 显示图像</span><br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>        cv2.imshow(<span class="hljs-string">&#x27;image_1&#x27;</span>, image_1)<br>        cv2.imshow(<span class="hljs-string">&#x27;image_2&#x27;</span>, image_2)<br>        <span class="hljs-keyword">if</span> cv2.waitKey(<span class="hljs-number">20</span>) &amp; <span class="hljs-number">0xFF</span> == <span class="hljs-number">27</span>:<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-comment"># 销毁窗口</span><br>    cv2.destroyAllWindows()<br><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/images_matrixtime/20201216144831.png"></p><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p><a href="https://github.com/zywvvd/Python_Practise">https://github.com/zywvvd/Python_Practise</a></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_41360787/article/details/103258773">https://blog.csdn.net/qq_41360787/article/details/103258773</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>opencv</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>opencv</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>二次型优化问题 - 4 - 二次型优化方法</title>
    <link href="/2020/12/15/machine_learning/conjugate-gradient-algorithm/ways-to-optimize/ways-to-optimize/"/>
    <url>/2020/12/15/machine_learning/conjugate-gradient-algorithm/ways-to-optimize/ways-to-optimize/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在确定了可优化二次型的类型后，本文讨论二次型的优化方法。</p></blockquote><span id="more"></span><h3 id="当前问题"><a href="#当前问题" class="headerlink" title="当前问题"></a>当前问题</h3><ul><li><p>解方程$\bf{Ax}=\bf{b}$</p></li><li><p>其中$\bf{A}$为半正定矩阵</p></li><li><p>$\bf{A}$的秩与其增广矩阵$\bf{Ab}$的秩相等</p></li></ul><h2 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h2><h3 id="代数法"><a href="#代数法" class="headerlink" title="代数法"></a>代数法</h3><h4 id="高斯消元法"><a href="#高斯消元法" class="headerlink" title="高斯消元法"></a>高斯消元法</h4><ul><li>在$\bf{A}$的行列式不为0时，可以逐项消除半边系数，得到三角阵，计算得到$x_n$再逐步带入计算出其他未知数，得到计算结果。</li></ul><p>$$<br>\begin{equation}<br>\begin{split}<br>{a_{11}}{x_1} + {a_{12}}{x_2} +  \cdots {a_{1n}}{x_n} = {b_1}\\<br>{a_{22}}{x_2} +  \cdots {a_{2n}}{x_n} = {b_2}\\<br> \vdots \\<br>{a_{nn}}{x_n} = {b_n}<br>\end{split}<br>\end{equation}<br>$$</p><ul><li>其他代数方法在高斯消元法基础上进行改进</li></ul><h4 id="高斯主元素消元法"><a href="#高斯主元素消元法" class="headerlink" title="高斯主元素消元法"></a>高斯主元素消元法</h4><ul><li>为解决无法面对主元素为0或主元素绝对值过小带来的精度不够的问题，提出了主元素消元</li><li>核心思想是选择系数绝对值最大的行作为基准进行消元，可以有效缓解上述问题</li></ul><h4 id="矩阵求逆"><a href="#矩阵求逆" class="headerlink" title="矩阵求逆"></a>矩阵求逆</h4><ul><li>对于矩阵$\bf{A}$可逆的情况，可以直接求出$\bf{A}$的逆矩阵，则：</li></ul><p>$$<br>{\bf{x}} = {\bf{A^{-1}}}{\bf{b}}<br>$$</p><h3 id="迭代法"><a href="#迭代法" class="headerlink" title="迭代法"></a>迭代法</h3><blockquote><p>代数法的时间复杂度都在 $O(n^3)$的数量级上，在实践中难以接受；</p><p>迭代法的思想是可以每次贪心地计算局部最优解，逐步向全局最优解逼近</p></blockquote><h4 id="最速下降法-梯度法"><a href="#最速下降法-梯度法" class="headerlink" title="最速下降法/梯度法"></a>最速下降法/梯度法</h4><ul><li>沿着当前梯度的反方向前进至方向梯度为0，重新计算当前位置的梯度，重新出发</li><li>不断重复该过程，直到精度满足要求</li></ul><h4 id="共轭梯度法"><a href="#共轭梯度法" class="headerlink" title="共轭梯度法"></a>共轭梯度法</h4><ul><li>沿着共轭梯度方向前进该共轭基的分量大小的距离</li><li>在所有共轭基上重复上述操作，即可达到全局最优解</li></ul><blockquote><p>随后我们重点介绍迭代法相关内容</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>二次型优化问题 - 3 - 导数与极值点</title>
    <link href="/2020/12/13/machine_learning/conjugate-gradient-algorithm/gradient-related/gradient-related/"/>
    <url>/2020/12/13/machine_learning/conjugate-gradient-algorithm/gradient-related/gradient-related/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍在已经<a href="https://www.zywvvd.com/2020/11/16/machine_learning/conjugate-gradient-algorithm/conjugate-gradient/conjugate-gradient/">定义好的问题</a>下，二次型导数与极值点相关内容。</p></blockquote><span id="more"></span><h3 id="导数为0的点是否存在"><a href="#导数为0的点是否存在" class="headerlink" title="导数为0的点是否存在"></a>导数为0的点是否存在</h3><ul><li>对于一般的二次型：</li></ul><p>$$<br>f({\bf{x} }) = \frac{1}{2}{\bf{x^TAx} } - { {\bf{b} }^{\bf{T} } }{\bf{x} } + {\bf{c} } \tag{1} \label{1}<br>$$</p><ul><li>导数为：</li></ul><p>$$<br>f’({\bf{x}}) = {\bf{Ax}} - {\bf{b}} \tag{2} \label{2}<br>$$</p><ul><li>导数为0的点是否存在与方程$\bf{Ax}=\bf{b}$是否有解等价</li><li>设${r_A} = r(A)$为$\bf{A}$的秩</li><li>$\bf{Ab}$为增广矩阵，${r_{Ab}} = r(\bf{Ab})$为增广矩阵的秩，有：</li></ul><table><thead><tr><th>条件</th><th>结论</th></tr></thead><tbody><tr><td>$r_{A}&lt;r_{Ab}$</td><td>方程组无解，二次型不存在导数为0的点</td></tr><tr><td>$r_{A}=r_{Ab}=n$</td><td>方程组有唯一解，二次型有唯一导数为0的点</td></tr><tr><td>$r_{A}=r_{Ab}&lt;n$</td><td>方程组有无数组解，二次型有无数个导数为0的点</td></tr><tr><td>$r_{A}&gt;r_{Ab}$</td><td>不可能，增广矩阵的秩不会变小</td></tr></tbody></table><h3 id="极值点是否存在"><a href="#极值点是否存在" class="headerlink" title="极值点是否存在"></a>极值点是否存在</h3><ul><li><p>当导数为零的点不存在时，即$\eqref{2}$方程组无解时，极值点不存在</p></li><li><p>当导数为0的点存在时：</p><ul><li>若$\bf{A}$为正定矩阵，则式$\eqref{1}$有极小值，就是最小值</li><li>若$\bf{A}$为负定矩阵，则式$\eqref{1}$有极大值，就是最大值</li><li>若$\bf{A}$为半正定矩阵，且存在特征值为0，由于前提是方程组有解，则增广矩阵的秩和矩阵$\bf{A}$的秩相等，那么$\bf{b}$中对应的值为0，方程组有无限多组解，但需要满足某种条件，在这组条件下，方程组都是极小值，也就是说若$\bf{A}$为半正定矩阵则$\eqref{1}$有极小值，同时就是最小值</li><li>同理若$\bf{A}$为半负定矩阵，则$\eqref{1}$有极大值，也即最大值</li><li>若$\bf{A}$的特征值有正有负，则$\eqref{1}$有极小/大值，但不是最小/大值，此时$\eqref{1}$没有最小/大值</li></ul></li><li><p>为使得讨论有意义，我们之后讨论的$\eqref{1}$的优化均在$\bf{A}$为半正定矩阵的条件下，来寻找其极小值，也就是最小值</p></li></ul><script src="/js/deployggb.js"></script><script>var parameters = {"id": "ggbApplet","width":888,"height":694,"showMenuBar":false,"showAlgebraInput":false,"showToolBar":false,"customToolBar":"0 73 62 | 1 501 67 , 5 19 , 72 75 76 | 2 15 45 , 18 65 , 7 37 | 4 3 8 9 , 13 44 , 58 , 47 | 16 51 64 , 70 | 10 34 53 11 , 24  20 22 , 21 23 | 55 56 57 , 12 | 36 46 , 38 49  50 , 71  14  68 | 30 29 54 32 31 33 | 25 17 26 60 52 61 | 40 41 42 , 27 28 35 , 6","showToolBarHelp":true,"showResetIcon":true,"enableLabelDrags":false,"enableShiftDragZoom":true,"enableRightClick":false,"errorDialogsActive":false,"useBrowserForJS":false,"allowStyleBar":false,"preventFocus":false,"showZoomButtons":true,"capturingThreshold":3,// add code here to run when the applet starts"appletOnLoad":function(api){ /* api.evalCommand('Segment((1,2),(3,4))');*/ },"showFullscreenButton":true,"scale":1,"disableAutoScale":false,"allowUpscale":false,"clickToLoad":false,"appName":"classic","showSuggestionButtons":true,"buttonRounding":0.7,"buttonShadows":false,"language":"zh",// use this instead of ggbBase64 to load a material from geogebra.org// "material_id":"RHYH3UQ8",// use this instead of ggbBase64 to load a .ggb file// "filename":"myfile.ggb","ggbBase64":"UEsDBBQACAgIAKBzKVIAAAAAAAAAAAAAAAAXAAAAZ2VvZ2VicmFfZGVmYXVsdHMyZC54bWztmltz4yYUgJ+7v4LhqX2IDbJkO5koO9md6TQzSTbTZDp9xRKSaWRQBUrk/PoikCV5bWfjS9b2bvMQdBA3fedwOIDPPxaTBDzRTDLBfYg7CALKAxEyHvswV9HJEH68+HAeUxHTUUZAJLIJUT70ypJ1PS11+g4q80ia+jBIiJQsgCBNiCqr+FBEUcI4hQAUkp1xcUsmVKYkoPfBmE7ItQiIMm2NlUrPut3n5+fOrNeOyOKublh2Cxl241h1dAqBHjqXPqweznS7c7Wfe6aegxDu/n1zbfs5YVwqwgM9EP1ZIY1IniipH2lCJ5QroKYp9WEqGFcQJGREEx/elRL4Ncoo/Q2CqpKmheDFh1/O5Vg8AzH6hwY6T2U5resZoVuW0a8/i0RkIPPhYABBbJORDx3P09CSdEx8iGzhhExpBp5IUueQXInA1De5EUkknZXVPd2IkNo3blWes4nBCaSiWh+ogyGQKaWhHjWsvhEb9UyNplstBkJkoQSFD2/JLQTTKn2xqSli6Nyzl6pTr52rpgltjf28W4F9G+KQppSHutAcZ7wR5/7QcC6TkU2OG7P73pj7R4J5D5Dx+pS/8DZbZyO22PEMXJN+L2dxFK7iiv9JYz3mNuPe/4x3ynjegt2N6CLDFh3tUmeKWIqy/K9jGzFJE1rsEL2NiyqM10aosTubxRht7GhP0NHG0EsgFp8as+CRUylLtk275cMfLNQrmOlP6DiSKd0SHgxtC/RfPqc0pnXGdJnXFRHlPFDGqVRwP+fZU1sbPRftQx9Nmxt7lxXK2Jb0apaSxqVUc7mfyY1pbxbW/eymLXKVlD1fcaW3X9QYrFz4uEdK0wfd1Bf+kBEuyz3YvC2t1lxGpq9pzTsGrf1sOpt5Lv5EsloTba1tFhutXL07jrdv1a3hxtsgtg9jDsp817TNrYyov9nUd5C7nF5ncMBG9KQ/TzQY/qrEJhQ4isDswPzgkmiaZIpKRvi3difJNG7N6LuZXOtjYPWx/RjX3j96PaNTDy/YN0b2D7unCOM+dvat5tcBz+1D7uqMBjHeE+KDDflW8wwEL8+/Z/sIK9Uk3R/Meexgw8Ziyq3PlQAUyBSbIlP5BVU3EwU28hSbty/YZpv6euAZK8ClrXFpC146NunZxLWJVwPabJdoVJtqv9WKkr9aHNzNtjbH5Ep+SKV/h0id5xOatVzD7UyujcezzkG3l9M51b7BFayyk9VWIRMWahOaMK2kE629CSmMFslIiiRX9D7IKOXN9Zw142cWqnEZ2um+I1aU5mLbBGORsRfBVU0DlLPgMjEXeXNHGcvMx3ktcp0z1u3cM+Fx0szGSys1GrCn9abQ18d4yxTTZogqhP2OM+zhoddDAzw49Yb9NyLFwwapffFmoov2gdEOLGStee4sm+ckC5oz0h5a7nhQB+GB6/WcU8fDp6eufvB2vxX8vc5otjWHeKRnLGCh6Lud1iUiyGVzBm2lmtDwKMKVdU7qSF6whJFsup21r8VY0aIJGR6M0PopwUEijrTbAVKvT1HtevQ8vimXYNc+610BnK2k37jm0NqKm++5slLrkt8SiJhGz8lEV7BjYPwTCR7jTOQ8XFy9dsIL7zuYWg1tJERCSeO/Ps3k1tXyQrywClC1RO/TooIxDR5Hophb4l53TUw20+baCK0r3yXT5u1fubg8nrybKazjndY/1FvrJnJFZNNWQbf1y6ju7GdYF/8BUEsHCI//M80IBQAALiYAAFBLAwQUAAgICACgcylSAAAAAAAAAAAAAAAAFwAAAGdlb2dlYnJhX2RlZmF1bHRzM2QueG1s7ZjdbtMwFMev4Sks39PYaZIt0zJUwQVIgIZ2w62XnLaGxA62uzZ7Nd6BZ+LEzroUVsSqbRKIXvT46xzbv79zGvf05aapyRUYK7UqKJ8wSkCVupJqUdCVm784pi/Pnp8uQC/g0ggy16YRrqBpP3Lrh7VJFrO+TbRtQctaWCtLStpauN6loHo+r6UCSsjGyhOlP4gGbCtKuCiX0Ih3uhTOx1o6155E0Xq9ntzMOtFmEWFgG21sFS0WboKWEly6sgUdCicYd8d7PfV+MWM8+vT+XZjnhVTWCVXiQnBbFczFqnYWi1BDA8oR17WAG9BKllOcoxaXUBf0rXK4Vyj7JZJyZa7Qf3Au6JSnjJ49f3Zql3pN9OVnHFdQZ1aw9feVqB+D3a90rQ0xBY05JYiZM7SXaPMY+dXtUhSUTTgLH57kjPOMx8G/Fh0YciUwKAstYuV06UP61rmoLdyMxcnf6wpCTzKMV7LxrIl1gGLh5LYFqHwpbJ955Tp/CMbxUMAL19VA3FKWXxRYxJ+OnPrCG1lV0J+l4ANyAeoKiWhjUXvmZ+mYH37NhiO34b7ecd97zUOz98elGrkhs+AxCwNncTDTYJJg0i0S+KrCOm3/XdBWGDxuGKjs+0+jQexfZBcbaaevt6rNhupIaTY9SGnmhWZeZnYr8mNJiqfncUXdz5cMZcBdf//2e9z+QSqFcWClUKPH7VXf8TP57G8g/5jc94PE+ApG/M59fYcfpsGD+OW5Bxjz3CP0dpuj0ofCWGptKks2IQ2E5OC/19uQc9H/KA2z7M2Od0FlB0LVdbeEymh1y3XUdIt2OqA95Em6rxw8nXo9Uv7ziZ4kA5I0z1iSJQ+mzaFH/F5kZ6ZcygYqELtoUdinQhvz8HOcHHm0vfk32J53mJFltcv16Y6sTxm4+Dxwjf+ZM3tupG12qfInpJqFxByo5tlfSVWB2+7zQ18eZ9X0f1a9D8uvK1H5N7Bhqx9v6mOm/MCLyv7UmCV5/znKeHrMk5g/FKDHuGzcedXoG8N9ogvmOt4GvO/tg8yyYI6COQ4m33szkU1by1K630trV2aOV+W7XpWHrl2Vk8NURr87X5YnR3967G8DP9FFhf/pu100uutHN38snP0AUEsHCArjiZZLAwAAABEAAFBLAwQUAAgICACgcylSAAAAAAAAAAAAAAAAFgAAAGdlb2dlYnJhX2phdmFzY3JpcHQuanNLK81LLsnMz1NIT0/yz/PMyyzR0FSorgUAUEsHCNY3vbkZAAAAFwAAAFBLAwQUAAgICACgcylSAAAAAAAAAAAAAAAADAAAAGdlb2dlYnJhLnhtbO1b7Y/cxBn/DH/FyJVQUrK7nvE77AXtXdKClKQRl1aID1Re27fnxmsvtvdu95QPtKKCkFAqoUJAES8ilFA1CLU0DSjwgT8F3d6ln/gX+jwzttfe3cvt3h0QaE+3N563Z2Z+zzO/55lZX/OJQTcgG16c+FG4JNG6LBEvdCLXDztLUj9dq5nSEycfbna8qOO1Y5usRXHXTpckDVsW/SBX15mMZXavtyQ5gZ0kviORXmCn2GVJitbWAj/0JOK7S9KyohsrmrpSU1ZWaE21WqzWOtVSakz5xTI9faqltuRTEiGDxH8sjM7ZXS/p2Y636qx7XftM5NgpH3U9TXuPNRqbm5v1fH71KO40YApJY5C4jU6nXYdUIrDIMFmSsofHQG6l96bC+zFZpo1nzp4R49T8MEnt0IEpIwB9/+TDDzU3/dCNNsmm76brABdTDImse35nHSAxmC6RBrbqAS49z0n9DS+BvqUsX33a7Um8mR1i/UPiiQTFwiTi+hu+68VLklxnFtNVRbWYwmTKLFUiUex7YZq1pdmYjVxac8P3NoVYfOIjQqc0ioK2jRLJpUuEyUwmJzChImGiVBZZWREJE4kqEk20UUVPVTRVRRtVtFEVsAo/8duBtySt2UGCCg/XYlBhkU/SYeDxqWQF44XTE7CcxN+CxooMxiTghnJZPoEfHT4qVjSq6zNL66O4iEuE4ux5ohCcN+Xzx0TNsrrIGjyhclZqilILs/ohF6McaDGqbBmLDJzG/b1AVOmMcQ34aNr0uLQ0qJC5wGLHS9XZ/EtlhwK4GJOh6NRuL0mtM788vfx0a3oGTJs9A3pIHc/UMIzFf/lnakhloVVPafcAI+qV/X80C9b2Mml9FsrMPJpRVXPuRRvyTNITKc3So1GFNb8qNMqq0yKUaEBYGqEWMKiObMQI1YgKJSaUGETBMo2qRCHYhCqEk63KiUuHGqyGv7CnCUVShoURIHRYJEMe1zSiQTMD+yIl6haXJ8MHW8OM4KNgmaLAh5cpKnyQ2TUQpAkxMA9N0fmTxv8iVWowioawEl4FZaoFw2GBZlCiwEwgb8gE5Co4COWrAR+Cv5QI92EQZhIulcuX2WGoaLxDmLEPFTUbubNsZjohyTq2zgZNvW6CWjIUorNCVzpCmSnMYMTQiKGX1HYCFadrY92h5syK7jSzqkAdCw1uDYAUYi80ydRcmScydV6aUifgro6hhwmiKEoIGAzRUUWZDmAWrNAC01ARTCegKY0RHW1oD4VAEBclfgHtuhf0CtA5hn7Y66cV3Jyumz+mEbS2Ax6cZe3dyLm4XCCdSfLsJC2LhXhmHDWJ+KYSVD3UDOy2BxFlZxUtgZANO0CPwEdYi8KUZEYABM/LnChMzsdRuhIF/W6YEOJEgVxMOApo6ZkVM4GMUqpQyxVaqUIvPRt5o8q4EdSQfuLB+FGcFHJs130Km4wNG1D5VRgMl2PPvtiL/DBNSvKaDR6INr2+E/iub4e/AfvNg75z/W7biwl/jFBZfAIIA8kjVu6d84BVN1g+xyh2V4cJmDsZPOvF0JnVIdY0dNjelqrLCt+SQ1GlmUqdGha1TMMygRE0mLRj41ZVlbpqapasWVTWmaFh1XB2HbgkPrS3seqlKagxIfbAG8PQiZEtS5mnkuUoGBdxZFbsXtqP+VEFYoEYV9UKO4HHTYJ7OojknYvtaLAq4gRdyLow7HmFsbQ7XCUEqIRpMOFOlrZFytvg1IpWMm8j8xayqEehRT21GG/B07ZIeSs8/whrFUul+TLlfBQ/ISJf3Rzc1PFY0A/99EyeSX3nYrZSKjoIA0gyW6zKpEcls9mYML65jJHNMEatbIymfB9jtGhhfaoFh83SDx1bn1W3yj+mPrY+Td7D3MSu/V+wNnlfa8vim6M0tkOKnLa1Xhy17bYf+OlwxQ6cfmCnUcy9ip+ksd/uo6MiKYccFuYnK/0uNgKvMdamjaFEykeCoEDKvBgUgBMh3cgVfQNcQA1dHqg6o9NmgufuBKaOGgrQHcFwMCnHc/sx9Hv27OnWud9eOL16QSJdzwafec4+B6tzs4e8wIn6YZo9YztWNMyfiiLetCjtB8GTw16WC7wNxFKuWxoegHx47oeutwaqd8G3OJVlI8KnB+hCPbdSeMpfW6sUPB1tnvdixwvTSjGseLLYEd4UNph0sgkV8VA4Yo7V//M/bL4xy1hPQiQ1ew81szAtZ3HcCEIazZk5COxe4rmiVBaDVHo1L3px6AXYGmKdRDklmo4pAmIdoN9+1E9ETSlSgg7n7XS9FbpPex2Y6flim04KcT3H70JHUZ7xnY1c/GsgGFHqep3Yy3lJTFGwYRYokqQHEZabrHteWnCi8D3jZtkS80U1UxuOJPws1/VhJ9eAcrv2gN9jgL/qFSThxH4PvQxpw7HkYmm7AUuhCLcc0lUoTjm1hw+syRB0GYqhQfRELVnRLVUtnCJU6rKhUAisTMVSDVUH2trK6midalTTmMosxTRkwyo8pq7VFUuHOE5VoVo3odOAuzRYCAjfyp5ruvl9eM8pX/lj8FAlkezIROKtuVcJ1+aOHcCUej20PNhNFfIeZ8SxKBspjn6XObHcZ067XbRJfo6BGWZt/RRXAC6mn65HMb+xhilDivYceF2gokxg2O96MX4VkOFh86tv2F39bI+p9cy6cJYkauN8JjAcIwPVe0RGxA566zb6QppHhqolU6rTPB6yhxiPFts6O0GenWS5JMCb93yDy/kOxxHaCbi71Ft1gFnC8fcQYq5ZUMvvIgcYz8LuBKF437PmD0ocAID5W0CDBadx/bQER5UXO47g0nUwm9BL8NCA11p5eIMPT/qu64XF9O0QqJErCU7LnrD0oj0Y1pBvwdKBMlPXvoprTypOq7OfsuIM5SeiOGdScTX209ScYXLNMUX/8WhuAFFIgl+i5sCvSQQKl6QtskSO2eTnZPDcMXb8OHmUHGtDbljkjjlYeRzLjufjPd+3Xa76xpRVFFXFOHMYAPE28MvDKTtglHJLUA1uCpgUtqCr/PRt6FQzqcronKaQlXK9TcZ7M7Wi3V8pnt/xwg1YVwTxIxnIODVDNwwNNjbYqKkxA6+0ZDFl2YCgSbGYqkEbkLwlc7kDKmKraj3GXXS2vC0q+jGeDEWyxfg369WfbIuA4cT+gLRgvBp6QtLCIZFaSUv0bikiUVEIwN7SRF4XiSESUyQWTisLBbznQwFaIuINiAji/e0v9QYpy2zwkef7Ufr49hdXd/7+/uidK7vvfvyfa//69u7bolyaNjLsLFUl3d/K8ttfNDN5br5ZzKRmcwgShqJwwlAUeT5clAou4i9uRYc0CMNNKYq+fo/w36JBu6jKkJuxP6egUx5o6OBIIbAz6f7YdTLcOseAr4DWjg1IjdhIXfypDYRWIw4yGwCpzkJnrR/yyFMai5xCp3qxeV/+EuBQ+ZDwHAVZkahnO3ASx4jDnM8M6WwztKcMsGyDk0a6gCXS+S3R/AEMkWWbeA5DXM+QG4IVFk6dv5Y0DYN4W6noeHhz+y6MjV8UJIhDFrWCtxnLOaQlzudCnKjbtUOXhPzr2afwGjUBgKTxV4O2zCnAplwBNit8dNRP8/qWEJsJm1IGv0IowG4dShu6ydWBSVskB1PIGHulbprU0nWIA5gmU1njusAwG1+M0mXVgmKFKl4NXzfZGp++cVX4ZUF2Ei6XTl1CHQ5xNoX48iKILz9giOt1CLlkRbFM01At0/qOEZ/Nw+oe4cDgWOv4gYhWfbCJVkRLqqLOB4+2JzzLB4NHe5DhYVTO4FHmg0evwDP68KXR3T+MXrg7f2ytP9ABoqJlcMzhlnE1RgWOlSh0+Tsn5/rd+RExfhSImPsR+toEk4PIjFMe6cAWElnYQ4Lgi1pB9OPaScLv3p/wJ6+NupPXRtOce7j7oQMh8M3lGwcGIFwMgHASgGk3f3QAzN4U5h4U2oVYPjwQh5oP9BZhNNsjhj4fQFaVRL98ffvOje07fyvYdPTnqzu3Pth58/a3d6+K6wvIjj55G7I71y/vXH9h9OlrSLo/G9iPOznnkFC8u3Lv9itQDX+377wqJPJ2Qs7u2y9i9xsfjV67Nrr6xu6fXhLNeRN8/OTznWuvb9/FytFXb45e/rQYbTyXFz6699lNaLx7858wqfmJzlpci+PV8TfMsl64bwSrLKBs4g5hn/pOXM50yhnRwUFBq/ifG0fJoiq3EE2dM0hDt7yfidz77N2yiUC2YiKg4z1MZA8L2VP9XNLh1Q9rmvvydh/1L4P6g8XUP6lIekBF0gUVSScVKVAsFInagr1+/fKEOnf+8T5WvfP7haIrusCtx/1B5s4J7+p53PtDoc0ytOe9Y6reAX/93taSTQbPsUfbZAh/HTIgwwXA/J7uge8Ljp+csS94z0xeofCXhRPw/GuVr8jPll4kl6X8AmT/U5IqjgHMmhNnZfZd+84bn+/evLLQXTv9nm6MD7ff1XmBUSe3+5ixb10bXb8piz0+RqzqjbfvfLHz5nu7H/+bM/LOrRvQ/N6VD0d/vL395Vu7lz8ffYV8gK1ufQBiRi+/Bc+jV18R8YFgDt61NMBlkLjzl0/Be5R9+ei1V7c/v7L9xV93X7y9gLYWOOwvwi/fXH73O6OXJLXj9DxelvAbx7ohwzFA1gxNN5hmUaFg/L6M6oZuWYahyAwCZmV8A1PWe6P8Sgl/tT37J86T/wVQSwcI1k8N1cYNAACWOgAAUEsBAhQAFAAICAgAoHMpUo//M80IBQAALiYAABcAAAAAAAAAAAAAAAAAAAAAAGdlb2dlYnJhX2RlZmF1bHRzMmQueG1sUEsBAhQAFAAICAgAoHMpUgrjiZZLAwAAABEAABcAAAAAAAAAAAAAAAAATQUAAGdlb2dlYnJhX2RlZmF1bHRzM2QueG1sUEsBAhQAFAAICAgAoHMpUtY3vbkZAAAAFwAAABYAAAAAAAAAAAAAAAAA3QgAAGdlb2dlYnJhX2phdmFzY3JpcHQuanNQSwECFAAUAAgICACgcylS1k8N1cYNAACWOgAADAAAAAAAAAAAAAAAAAA6CQAAZ2VvZ2VicmEueG1sUEsFBgAAAAAEAAQACAEAADoXAAAAAA==",    };// is3D=is 3D applet using 3D view, AV=Algebra View, SV=Spreadsheet View, CV=CAS View, EV2=Graphics View 2, CP=Construction Protocol, PC=Probability Calculator DA=Data Analysis, FI=Function Inspector, macro=Macrosvar views = {'is3D': 1,'AV': 0,'SV': 0,'CV': 0,'EV2': 0,'CP': 0,'PC': 0,'DA': 0,'FI': 0,'macro': 0};var applet = new GGBApplet(parameters, '5.0', views);window.onload = function() {applet.inject('ggbApplet')};applet.setPreviewImage('data:image/gif;base64,R0lGODlhAQABAAAAADs=','https://www.geogebra.org/images/GeoGebra_loading.png','https://www.geogebra.org/images/applet_play.png');</script><div id="ggbApplet"></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>二次型优化问题 - 2 - 二次型参数确定</title>
    <link href="/2020/12/12/machine_learning/conjugate-gradient-algorithm/quadratic_cofficient/quadratic_cofficient/"/>
    <url>/2020/12/12/machine_learning/conjugate-gradient-algorithm/quadratic_cofficient/quadratic_cofficient/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文属于二次型优化问题系列文章，主要介绍二次型参数的定义由来。</p></blockquote><span id="more"></span><h3 id="提出问题"><a href="#提出问题" class="headerlink" title="提出问题"></a>提出问题</h3><ul><li>需要优化的函数二次型的形式：</li></ul><p>$$<br>f({\bf{x} }) = \frac{1}{2}{\bf{x^TAx} } - { {\bf{b} }^{\bf{T} } }{\bf{x} } + {\bf{c} } \tag{1} \label{eq1}<br>$$</p><ul><li>而原始n元多项式为：</li></ul><p>$$<br>f({x_1},{x_2},{x_3},…,{x_n}) = {a_{1,1}}x_1^2 + {a_{1,2}}{x_1}{x_2} + {a_{1,3}}{x_1}{x_3} +  \cdots  + {a_{1,n}}{x_1}{x_n} + {a_{2,1}}x_2{x_1} + {a_{2,2}}{x_2^2} + {a_{2,3}}{x_2}{x_3} +  \cdots  + {a_{2,n}}{x_2}{x_n} +  \cdots  + {a_{n,n}}x_n^2+{b_1}x_1+{b_2}x_2+\cdots+{b_n}x_n+c<br>$$</p><ul><li>其中，表示$\bf{A}$：</li></ul><p>$$<br>A = \left[ {\begin{array}{*{20}{c}}<br>{a_{1,1}^ \bullet }&amp; \cdots &amp;{a_{n,n}^ \bullet }<br>\end{array}} \right] \tag{3} \label{eq3}<br>$$</p><ul><li>将$\bf{A}$与多项式系数对应：</li></ul><p>$$<br>a_{i,i}^ \bullet  = {a_{i,i}},1 \le i \le n\ \tag{4}<br>$$</p><p>$$<br>a_{i,j}^ \bullet  + a_{j,i}^ \bullet  = {a_{i,j}},1 \le i &lt; j \le n\ \tag{5} \label{eq5}<br>$$</p><p>$$<br>{a_{i,j}} = 0,1 \le j &lt; i \le n \tag{6}<br>$$</p><ul><li>那么对应$\bf{A}$中非对角线的元素，仅需要保证公式$\eqref{eq5}$成立即可，那么对于不相等的$i,j$，可以有无数种$a_{i,j}^ \bullet  + a_{j,i}^ \bullet$的组合满足条件，$\bf{A}$该如何确定？</li></ul><h3 id="二次型矩阵"><a href="#二次型矩阵" class="headerlink" title="二次型矩阵"></a>二次型矩阵</h3><ul><li>在定义实数空间内的二次型时，二次型矩阵被要求为对称的，也就是要求：</li></ul><p>$$<br>a_{i,j}^ \bullet  = a_{j,i}^ \bullet  = \frac{1}{2}{a_{i,j}},1 \le i &lt; j \le n \tag{7}<br>$$</p><ul><li>也就确定了唯一的$\bf{A}$，来表示一个确定的多元二次函数。</li></ul><h3 id="为何如此"><a href="#为何如此" class="headerlink" title="为何如此"></a>为何如此</h3><ul><li>定义的用处就是来确定问题，这种定义可以唯一确定二次函数，没有任何歧义和变化，用于统一数学术语</li><li>我觉得很关键的问题是如此定义$\bf{A}$会给求导带来很大方便</li><li>我们略去一次项与常数项，得到纯粹的二次型：</li></ul><p>$$<br>f({\bf{x} }) = \frac{1}{2}{\bf{xAx} } \tag{8} \label{eqq8}<br>$$</p><ul><li>即：</li></ul><p>$$<br>f({\bf{x} }) = \frac{1}{2}\sum\limits_{i,j = 1}^n {a_{i,j}^ \bullet } {x_i}{x_j} \tag{9}<br>$$</p><ul><li>仍用$\eqref{eq3}$表示$\bf{A}$，对$\eqref{eqq8}$中的向量$\bf{x}$求导：</li></ul><p>$$<br>f’({x_i}) = \frac{1}{2}[\sum\limits_{j = 1,j \ne i}^n {(a_{i,j}^ \bullet  + a_{j,i}^ \bullet )} {x_j} + 2a_{i,i}^ \bullet {x_i}] \tag{10}<br>$$</p><ul><li>如果$\bf{A}$是对称阵，那么$a_{i,j}^ \bullet  = a_{j,i}^ \bullet $，有：</li></ul><p>$$<br>f’({x_i}) = \frac{1}{2}\sum\limits_{j = 1}^n {a_{i,j}^ \bullet } {x_j} \tag{11}<br>$$</p><p>$$<br>f’(\bf{x}) = \bf{Ax} \tag{12}<br>$$</p><ul><li>也就是说定义$\bf{A}$为对称阵可以唯一确定二次型矩阵，也可以方便地对二次型进行求导。</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 添加开机启动应用</title>
    <link href="/2020/12/12/windows/win-add-startup/win-add-startup/"/>
    <url>/2020/12/12/windows/win-add-startup/win-add-startup/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Windows添加开启启动项的方法。</p></blockquote><span id="more"></span><h3 id="打开配置"><a href="#打开配置" class="headerlink" title="打开配置"></a>打开配置</h3><ul><li>按下 <code>win + R</code> 调出运行命令，在运行中输入 <code>shell:startup</code></li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20201212112610.png"></p><ul><li>按下<code>确定</code>后进入<code>启动文件夹</code></li></ul><h3 id="添加应用"><a href="#添加应用" class="headerlink" title="添加应用"></a>添加应用</h3><ul><li>将需要开机启动的应用快捷方式放入到<code>启动文件夹</code>中：</li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20201212113054.png"></p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><ul><li>可以重启电脑查看是否应用已经重启</li></ul><h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><ul><li>打开任务管理器，进入<code>启动</code>选项卡，查看我们刚刚加入的应用是否在项目中：</li></ul><p><img src="https://photos.zywvvd.com/icey-mate-book/20201212113357.png"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Windows</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>科学上网初级教程</title>
    <link href="/2020/12/04/internet/scientific-online/"/>
    <url>/2020/12/04/internet/scientific-online/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录初次科学上网的服务器搭建过程。</p></blockquote><span id="more"></span><h3 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h3><pre class="mermaid">graph LR    subgraph 本地     链接并配置远程服务器-->下载客户端-->按照当前客户端类型配置本地客户端-->填入配置信息-->开启科学上网服务    end    subgraph 服务器    购买服务器-->登录服务器-->安装V2Ray-->获取配置信息-->开启v2ray服务    end</pre><h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><h4 id="购买服务器"><a href="#购买服务器" class="headerlink" title="购买服务器"></a>购买服务器</h4><blockquote><p>参考：<a href="https://tlanyan.me/vps-merchant-collection/">https://tlanyan.me/vps-merchant-collection/</a></p><p>列出推荐的几个：</p></blockquote><table><thead><tr><th>链接</th><th>说明</th></tr></thead><tbody><tr><td><a href="https://bwh88.net/aff.php?aff=55490&gid=1"><strong>BandwagonHost</strong></a></td><td>俗称<strong>搬瓦工</strong>，可能是最广为人知的境外**<del>廉价</del>VPS<strong>服务商。VPS线路针对中国网络特别优化，网速很给力，</strong>支持支付宝**。</td></tr><tr><td><a href="https://www.akkocloud.com/aff.php?aff=122&gid=7"><strong>AkkoCloud</strong></a></td><td>国人稳定vps商家，服务类型众多，包括国内NAT/VDS/独服、美西、德国CN2 GIA VPS，MC面板等。速度很给力，价格也实惠</td></tr><tr><td><a href="https://www.vultr.com/?ref=8375822-6G"><strong>Vultr</strong></a></td><td><a href="https://bwh88.net/aff.php?aff=55490&gid=1">搬瓦工</a> 和 <a href="https://manage.hostdare.com/aff.php?aff=2122">HostDare</a> 是典型的包年包月类型，无法做到按需付费，并且更换ip需要付费。Vultr是灵活计费vps的代表，全球十多个数据中心，<strong>VPS按小时计费，可随时销毁停止计费、免费更换ip和机房，支持支付宝</strong>。官网：<a href="https://www.vultr.com/?ref=8375822-6G">https://www.vultr.com</a></td></tr><tr><td><a href="https://www.linode.com/?r=4459a4f56be13978ca0d156d0d0eaf6d9bc82853"><strong>Linode</strong></a></td><td>老牌美国云计算商家，VPS按小时计费，随时可以删除主机退回账户。自有面板，以高品质、稳定深受中国站长推崇。最低月费用5美元，<strong>必须绑定信用</strong>才能完成账号注册。官网：<a href="https://www.linode.com/?r=4459a4f56be13978ca0d156d0d0eaf6d9bc82853">https://www.linode.com</a>。</td></tr></tbody></table><blockquote><p>我使用的时 Vultr 在芝加哥的 ubuntu 18.04 服务器，价格合理，灵活消费，速度也可以接受。</p></blockquote><h4 id="链接服务器"><a href="#链接服务器" class="headerlink" title="链接服务器"></a>链接服务器</h4><blockquote><p>随便打开一个终端使用ssh链接，在服务器管理界面中获取ip与密码：</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201204204502.png"></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">ssh root<span class="hljs-variable">@your_ip</span><br>-&gt;<br>enter password<br></code></pre></td></tr></table></figure><h4 id="安装V2Ray并获取配置信息"><a href="#安装V2Ray并获取配置信息" class="headerlink" title="安装V2Ray并获取配置信息"></a>安装V2Ray并获取配置信息</h4><blockquote><p>参考：<a href="https://tlanyan.me/v2ray-tutorial/">https://tlanyan.me/v2ray-tutorial/</a></p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">bash &lt;(curl -sL https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/hijkpw/</span>scripts<span class="hljs-regexp">/master/g</span>oV2.sh)<br></code></pre></td></tr></table></figure><blockquote><p>安装完成后，配置文件为<code>/etc/v2ray/config.json</code>，cat命令可查看内容：<code>cat /etc/v2ray/config.json</code>。</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;inbounds&quot;</span>: [&#123;<br>    <span class="hljs-attr">&quot;port&quot;</span>: <span class="hljs-number">23581</span>,<br>    <span class="hljs-attr">&quot;protocol&quot;</span>: <span class="hljs-string">&quot;vmess&quot;</span>,<br>    <span class="hljs-attr">&quot;settings&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;clients&quot;</span>: [<br>        &#123;<br>          <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-string">&quot;ceb793e6-49cf-25d8-e4de-ae542e62748e&quot;</span>,<br>          <span class="hljs-attr">&quot;level&quot;</span>: <span class="hljs-number">1</span>,<br>          <span class="hljs-attr">&quot;alterId&quot;</span>: <span class="hljs-number">64</span><br>        &#125;<br>      ]<br>    &#125;<br>  &#125;],<br>  <span class="hljs-attr">&quot;outbounds&quot;</span>: [&#123;<br>    <span class="hljs-attr">&quot;protocol&quot;</span>: <span class="hljs-string">&quot;freedom&quot;</span>,<br>    <span class="hljs-attr">&quot;settings&quot;</span>: &#123;&#125;<br>  &#125;,&#123;<br>    <span class="hljs-attr">&quot;protocol&quot;</span>: <span class="hljs-string">&quot;blackhole&quot;</span>,<br>    <span class="hljs-attr">&quot;settings&quot;</span>: &#123;&#125;,<br>    <span class="hljs-attr">&quot;tag&quot;</span>: <span class="hljs-string">&quot;blocked&quot;</span><br>  &#125;],<br>  <span class="hljs-attr">&quot;routing&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;rules&quot;</span>: [<br>      &#123;<br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;field&quot;</span>,<br>        <span class="hljs-attr">&quot;ip&quot;</span>: [<span class="hljs-string">&quot;geoip:private&quot;</span>],<br>        <span class="hljs-attr">&quot;outboundTag&quot;</span>: <span class="hljs-string">&quot;blocked&quot;</span><br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>记录：port（<code>端口</code>）和clients中的id（<code>用户id</code>）</p></blockquote><h4 id="开启v2ray服务"><a href="#开启v2ray服务" class="headerlink" title="开启v2ray服务"></a>开启v2ray服务</h4><blockquote><p>配置文件无需任何改动即可正常使用。接下来防火墙放行监听的端口，设置开机启动并运行<code>V2Ray</code>：</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># firewalld放行端口（适用于CentOS7/8）</span><br><span class="hljs-attribute">firewall</span>-cmd --permanent --add-port=<span class="hljs-number">23581</span>/tcp # <span class="hljs-number">23581</span>改成你配置文件中的端口号<br><span class="hljs-attribute">firewall</span>-cmd --reload<br><span class="hljs-comment"># ufw放行端口（适用于ubuntu）</span><br><span class="hljs-attribute">ufw</span> <span class="hljs-literal">allow</span> <span class="hljs-number">23581</span>/tcp # <span class="hljs-number">23581</span>改成你的端口号<br><span class="hljs-comment"># iptables 放行端口（适用于CentOS 6/7）</span><br><span class="hljs-attribute">iptables</span> -I INPUT -p tcp --dport <span class="hljs-number">23581</span> -j ACCEPT<br><span class="hljs-comment"># 设置开机启动</span><br><span class="hljs-attribute">systemctl</span> enable v<span class="hljs-number">2</span>ray<br><span class="hljs-comment"># 运行v2ray</span><br><span class="hljs-attribute">systemctl</span> start v<span class="hljs-number">2</span>ray<br></code></pre></td></tr></table></figure><p><code>ss -ntlp | grep v2ray</code> 命令可以查看v2ray是否正在运行。如果输出为空，大概率是被selinux限制了，解决办法如下：</p><ol><li><p>禁用selinux：<code>setenforce 0</code>;</p></li><li><p>重启v2ray：<code>systemctl restart v2ray</code></p></li></ol><blockquote><p>服务端配置完成。</p></blockquote><h3 id="本地"><a href="#本地" class="headerlink" title="本地"></a>本地</h3><h4 id="下载客户端"><a href="#下载客户端" class="headerlink" title="下载客户端"></a>下载客户端</h4><ul><li>客户端下载的选择有很多，可以选择合适自己的版本 <a href="https://tlanyan.me/v2ray-clients-download/">https://tlanyan.me/v2ray-clients-download/</a></li><li>我使用了 <a href="https://tlanyan.me/download.php?filename=/v2/windows/v2rayN-v3.28.zip">v2rayN-v3.28.zip</a></li></ul><h4 id="按照当前客户端类型配置本地客户端"><a href="#按照当前客户端类型配置本地客户端" class="headerlink" title="按照当前客户端类型配置本地客户端"></a>按照当前客户端类型配置本地客户端</h4><ul><li>根据自己的客户端类型配置，这里给出V2rayN的配置方法</li></ul><blockquote><p>参考：<a href="https://v2xtls.org/v2rayn%e9%85%8d%e7%bd%ae%e6%95%99%e7%a8%8b/">https://v2xtls.org/v2rayn%e9%85%8d%e7%bd%ae%e6%95%99%e7%a8%8b/</a></p></blockquote><ul><li><p>安装客户端：找到下载的安装程序，找一个合适的目录<strong>解压</strong>（<strong>不要</strong>放在C盘的”Program Files”目录下，会有权限问题），<strong>不要双击压缩文件中的v2rayN.exe直接打开！</strong></p></li><li><p>进入V2rayN-Core目录，双击“V2RayN.exe”，程序启动后<strong>托盘</strong>上会出现一个V图标（托盘就是桌面右下角，显示时间输入法那块）。如果程序没有反应，或提示“V2rayN已停止工作”，请先更新系统并安装 <a href="https://dotnet.microsoft.com/download/dotnet-framework/net472">.NET Framework 4.7.2</a> 和 <a href="https://www.microsoft.com/en-us/download/details.aspx?id=53840">Microsoft Visual C++ 2015 Redistributable (x86)</a> 再重新打开；</p></li><li><p>点击系统托盘的<code>V2RayN</code>图标，弹出程序主界面，选择服务器<code>添加Vmess服务器</code>选项</p></li></ul><h4 id="填入配置信息"><a href="#填入配置信息" class="headerlink" title="填入配置信息"></a>填入配置信息</h4><p><img src="https://photos.zywvvd.com/images_matrixtime/20201204205457.png"></p><ul><li><p>填入ip 端口 和id（都是刚刚记录过的）</p></li><li><p>有需求的话可以加入<a href="https://tlanyan.me/v2ray-traffic-mask/">伪装域名</a></p></li><li><p>服务器信息配置好后，主界面下方会出现日志信息</p></li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">配置成功<br>[Vmess] (<span class="hljs-number">149</span>***<span class="hljs-number">12</span>:xxxxx)<br>启动服务(<span class="hljs-number">2020</span><span class="hljs-regexp">/12/</span><span class="hljs-number">4</span> <span class="hljs-number">19</span>:<span class="hljs-number">46</span>:<span class="hljs-number">18</span>)...<br>V2Ray <span class="hljs-number">4.31</span>.<span class="hljs-number">0</span> (V2Fly, a community-driven edition of V2Ray.) Custom (go1.<span class="hljs-number">15.2</span> windows/<span class="hljs-number">386</span>)<br>A unified platform <span class="hljs-keyword">for</span> anti-censorship.<br><span class="hljs-number">2020</span><span class="hljs-regexp">/12/</span><span class="hljs-number">04</span> <span class="hljs-number">19</span>:<span class="hljs-number">46</span>:<span class="hljs-number">18</span> [Info] v2ray.com<span class="hljs-regexp">/core/</span>common<span class="hljs-regexp">/platform/</span>ctlcmd: &lt;v2ctl message&gt; <br>v2ctl&gt; <span class="hljs-keyword">Read</span> config:  E:\Program_Files\v2rayN-Core\config.json<br><span class="hljs-number">2020</span><span class="hljs-regexp">/12/</span><span class="hljs-number">04</span> <span class="hljs-number">19</span>:<span class="hljs-number">46</span>:<span class="hljs-number">18</span> [Warning] v2ray.com/core: V2Ray <span class="hljs-number">4.31</span>.<span class="hljs-number">0</span> started<br></code></pre></td></tr></table></figure><h4 id="测试服务器延迟"><a href="#测试服务器延迟" class="headerlink" title="测试服务器延迟"></a>测试服务器延迟</h4><blockquote><p>服务器延迟不是 -1 或 <code>timeout</code> 即说明连接成功</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201204205924.png"></p><h4 id="开启科学上网"><a href="#开启科学上网" class="headerlink" title="开启科学上网"></a>开启科学上网</h4><p><img src="https://photos.zywvvd.com/images_matrixtime/20201204210018.png"></p><ul><li>开启http代理或PAC，随后就是见证奇迹的时刻了</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201204210141.png"></p><ul><li>have fun ~</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>internet</category>
      
    </categories>
    
    
    <tags>
      
      <tag>internet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python ImportError libGL.so.1 cannot open shared object file No such file or directory 解决方案</title>
    <link href="/2020/12/04/python/import-error/import-error-0/"/>
    <url>/2020/12/04/python/import-error/import-error-0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>刚装的 linux 环境中使用 python 导入包时可能会报 <code> libGL.so.1: cannot open shared object file</code> 的错误，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>我是在导入 opencv 包时遇到的错误：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> cv2<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;/root/anaconda3/envs/vvd_env/lib/python3.7/site-packages/cv2/__init__.py&quot;</span>, line <span class="hljs-number">5</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">from</span> .cv2 <span class="hljs-keyword">import</span> *<br>ImportError: libGL.so<span class="hljs-number">.1</span>: cannot <span class="hljs-built_in">open</span> shared <span class="hljs-built_in">object</span> file: No such file <span class="hljs-keyword">or</span> directory<br></code></pre></td></tr></table></figure><h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><ul><li>缺少 <code>libGL.so.1</code> 库</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>把这个库装上：</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> apt update<br><span class="hljs-attribute">sudo</span> apt install libgl<span class="hljs-number">1</span>-mesa-glx<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://stackoverflow.com/questions/63544251/import-cv2-in-sagemaker-studio-jupyter-notebook-throws-importerror-libgl-so-1">https://stackoverflow.com/questions/63544251/import-cv2-in-sagemaker-studio-jupyter-notebook-throws-importerror-libgl-so-1</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nvidia docker 安装与使用</title>
    <link href="/2020/12/03/docker/nvidia-docker-install/"/>
    <url>/2020/12/03/docker/nvidia-docker-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Nvidia docker 是nvidia显卡在docker基础上进行封装得到的docker工具，需要电脑中安装Nvidia显卡驱动与docker，配置好Nvidia docker后docker可以使用GPU。本文记录Nvidia docker的安装与使用方法。</p></blockquote><span id="more"></span><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li>Linux 16.04 64位操作系统</li><li>显卡驱动 450.80.02</li><li>CUDA 版本 11.0</li><li>docker 安装版本 19.03.4</li></ul><h4 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h4><ul><li>加入包仓库</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -s -L https:<span class="hljs-regexp">//</span>nvidia.github.io<span class="hljs-regexp">/nvidia-docker/g</span>pgkey | \<br>  sudo apt-key add -<br>distribution=$(. <span class="hljs-regexp">/etc/</span>os-release;echo <span class="hljs-variable">$ID</span><span class="hljs-variable">$VERSION_ID</span>)<br>curl -s -L https:<span class="hljs-regexp">//</span>nvidia.github.io<span class="hljs-regexp">/nvidia-docker/</span><span class="hljs-variable">$distribution</span>/nvidia-docker.list | \<br>  sudo tee <span class="hljs-regexp">/etc/</span>apt<span class="hljs-regexp">/sources.list.d/</span>nvidia-docker.list<br>sudo apt-get update<br></code></pre></td></tr></table></figure><ul><li>安装nvidia-docker2 载入docker 配置</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo apt-<span class="hljs-builtin-name">get</span> install -y nvidia-docker2<br>sudo pkill -SIGHUP dockerd<br></code></pre></td></tr></table></figure><ul><li>下载官方测试镜像</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-builtin-name">run</span> <span class="hljs-attribute">--runtime</span>=nvidia --rm nvidia/cuda:11.0-base nvidia-smi<br></code></pre></td></tr></table></figure><blockquote><p>此时会显示出显卡信息，说明nvidia docker成功创建并在内部正确执行了 <code>nvidia-smi</code> 命令。</p></blockquote><ul><li>查看nvidia-docker安装情况</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt show nvidia-docker2</span><br><span class="hljs-meta">-&gt;</span><span class="bash"></span><br><span class="bash">Package: nvidia-docker2</span><br>Version: 2.5.0-1<br>Priority: optional<br>Section: utils<br>Maintainer: NVIDIA CORPORATION &lt;cudatools@nvidia.com&gt;<br>Installed-Size: 27.6 kB<br>Depends: nvidia-container-runtime (&gt;= 3.4.0), docker-ce (&gt;= 18.06.0~ce~3-0~ubuntu) | docker-ee (&gt;= 18.06.0~ce~3-0~ubuntu) | docker.io (&gt;= 18.06.0)<br>Breaks: nvidia-docker (&lt;&lt; 2.0.0)<br>Replaces: nvidia-docker (&lt;&lt; 2.0.0)<br>Homepage: https://github.com/NVIDIA/nvidia-docker/wiki<br>Download-Size: 5,840 B<br>APT-Manual-Installed: yes<br>APT-Sources: https://nvidia.github.io/nvidia-docker/ubuntu16.04/amd64  Packages<br>Description: nvidia-docker CLI wrapper<br> Replaces nvidia-docker with a new implementation based on<br> nvidia-container-runtime<br><br>N: There are 50 additional records. Please use the &#x27;-a&#x27; switch to see them.<br></code></pre></td></tr></table></figure><blockquote><p>出现类似信息说明安装成功</p></blockquote><h3 id="使用nvidia-docker镜像"><a href="#使用nvidia-docker镜像" class="headerlink" title="使用nvidia docker镜像"></a>使用nvidia docker镜像</h3><ul><li>之前不是同一个驱动版本下创建的镜像在新驱动下的nvidia docker中可能找不到nvidia-smi命令</li><li>为了在新的docker下使用gpu，我迂回地使用测试镜像作为初始镜像</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">nvidia-docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-comment">--name first_container nvidia/cuda:11.0-base /bin/bash</span><br></code></pre></td></tr></table></figure><blockquote><p>这样便将测试镜像创建出了可以随时访问修改的容器，在该容器基础上保存镜像即可。</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> commit -m <span class="hljs-string">&quot;nvidia docker image init&quot;</span> first_container my_image:<span class="hljs-number">1</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://www.cnblogs.com/llfctt/p/10642100.html">https://www.cnblogs.com/llfctt/p/10642100.html</a></p></li><li><p><a href="https://www.cnblogs.com/wuchangsoft/p/9767074.html">https://www.cnblogs.com/wuchangsoft/p/9767074.html</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在Linux服务器上更换Nvidia驱动</title>
    <link href="/2020/12/03/linux/driver/nvidia-driver-install-linux/"/>
    <url>/2020/12/03/linux/driver/nvidia-driver-install-linux/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录在Linux服务器更换Nvidia驱动的流程。</p></blockquote><span id="more"></span><h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><blockquote><p>Linux 服务器上的 1080Ti 显卡驱动为387， CUDA 9，比较老旧，需要更换成可以运行pytorch 1.6的环境。</p></blockquote><h3 id="确定当前显卡型号-操作系统版本-目标环境"><a href="#确定当前显卡型号-操作系统版本-目标环境" class="headerlink" title="确定当前显卡型号\操作系统版本\目标环境"></a>确定当前显卡型号\操作系统版本\目标环境</h3><ul><li>查看显卡信息，确定自己的显卡型号：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvidia-smi</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> lspci  | grep -i vga</span><br></code></pre></td></tr></table></figure><blockquote><p>输出的设备信息并不是我们熟悉的型号，比如我的输出为：</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-number">02</span>:<span class="hljs-number">00.0</span> VGA compatible controller: NVIDIA Corporation Device <span class="hljs-number">1b06</span> (rev a1)<br><span class="hljs-number">04</span>:<span class="hljs-number">00.0</span> VGA compatible controller: NVIDIA Corporation Device <span class="hljs-number">1b06</span> (rev a1)<br><span class="hljs-number">09</span>:<span class="hljs-number">00.0</span> VGA compatible controller: Matrox Electronics Systems Ltd. G200eR2 (rev <span class="hljs-number">01</span>)<br><span class="hljs-number">83</span>:<span class="hljs-number">00.0</span> VGA compatible controller: NVIDIA Corporation Device <span class="hljs-number">1b06</span> (rev a1)<br><span class="hljs-number">84</span>:<span class="hljs-number">00.0</span> VGA compatible controller: NVIDIA Corporation Device <span class="hljs-number">1b06</span> (rev a1)<br></code></pre></td></tr></table></figure><blockquote><p>其中 <code>Device 1b06</code> 即为 1080Ti</p><p>可以进一步查看左边编号下的显卡信息</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> lspci -v -s 02:00.0</span><br><span class="hljs-meta">-&gt;</span><span class="bash"></span><br><span class="bash">02:00.0 VGA compatible controller: NVIDIA Corporation Device 1b06 (rev a1) (prog-if 00 [VGA controller])</span><br>Subsystem: Gigabyte Technology Co., Ltd Device 376b<br>Flags: bus master, fast devsel, latency 0, IRQ 83<br>Memory at 91000000 (32-bit, non-prefetchable) [size=16M]<br>Memory at 3bfe0000000 (64-bit, prefetchable) [size=256M]<br>Memory at 3bff0000000 (64-bit, prefetchable) [size=32M]<br>I/O ports at 2000 [size=128]<br>[virtual] Expansion ROM at 92080000 [disabled] [size=512K]<br>Capabilities: &lt;access denied&gt;<br>Kernel driver in use: nvidia<br>Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia<br></code></pre></td></tr></table></figure><ul><li>查看系统信息</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> lsb_release -a</span><br><span class="hljs-meta">-&gt;</span><span class="bash"></span><br><span class="bash">No LSB modules are available.</span><br>Distributor ID:Ubuntu<br>Description:Ubuntu 16.04.5 LTS<br>Release:16.04<br>Codename:xenial<br></code></pre></td></tr></table></figure><ul><li>查看系统位数</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> file /bin/ls</span><br><span class="hljs-meta">-&gt;</span><span class="bash"></span><br><span class="bash">/bin/ls: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="hljs-keyword">for</span> GNU/Linux 2.6.32, BuildID[sha1]=d0bc0fb9b3f60f72bbad3c5a1d24c9e2a1fde775, stripped</span><br></code></pre></td></tr></table></figure><ul><li>确定需求的Cuda版本</li></ul><blockquote><p>比如 tensorflow-gpu 的各个版本对Cuda 和 cuDNN 都有自己的要求：</p><p><a href="https://tensorflow.google.cn/install/source#linux">https://tensorflow.google.cn/install/source#linux</a></p></blockquote><table><thead><tr><th align="left">Version</th><th align="left">Python version</th><th align="left">Compiler</th><th align="left">Build tools</th><th align="left">cuDNN</th><th align="left">CUDA</th></tr></thead><tbody><tr><td align="left">tensorflow-2.3.0</td><td align="left">3.5-3.8</td><td align="left">GCC 7.3.1</td><td align="left">Bazel 3.1.0</td><td align="left">7.6</td><td align="left">10.1</td></tr><tr><td align="left">tensorflow-2.2.0</td><td align="left">3.5-3.8</td><td align="left">GCC 7.3.1</td><td align="left">Bazel 2.0.0</td><td align="left">7.6</td><td align="left">10.1</td></tr><tr><td align="left">tensorflow-2.1.0</td><td align="left">2.7, 3.5-3.7</td><td align="left">GCC 7.3.1</td><td align="left">Bazel 0.27.1</td><td align="left">7.6</td><td align="left">10.1</td></tr><tr><td align="left">tensorflow-2.0.0</td><td align="left">2.7, 3.3-3.7</td><td align="left">GCC 7.3.1</td><td align="left">Bazel 0.26.1</td><td align="left">7.4</td><td align="left">10.0</td></tr><tr><td align="left">tensorflow_gpu-1.15.0</td><td align="left">2.7, 3.3-3.7</td><td align="left">GCC 7.3.1</td><td align="left">Bazel 0.26.1</td><td align="left">7.4</td><td align="left">10.0</td></tr><tr><td align="left">tensorflow_gpu-1.14.0</td><td align="left">2.7, 3.3-3.7</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.24.1</td><td align="left">7.4</td><td align="left">10.0</td></tr><tr><td align="left">tensorflow_gpu-1.13.1</td><td align="left">2.7, 3.3-3.7</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.19.2</td><td align="left">7.4</td><td align="left">10.0</td></tr><tr><td align="left">tensorflow_gpu-1.12.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.15.0</td><td align="left">7</td><td align="left">9</td></tr><tr><td align="left">tensorflow_gpu-1.11.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.15.0</td><td align="left">7</td><td align="left">9</td></tr><tr><td align="left">tensorflow_gpu-1.10.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.15.0</td><td align="left">7</td><td align="left">9</td></tr><tr><td align="left">tensorflow_gpu-1.9.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.11.0</td><td align="left">7</td><td align="left">9</td></tr><tr><td align="left">tensorflow_gpu-1.8.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.10.0</td><td align="left">7</td><td align="left">9</td></tr><tr><td align="left">tensorflow_gpu-1.7.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.9.0</td><td align="left">7</td><td align="left">9</td></tr><tr><td align="left">tensorflow_gpu-1.6.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.9.0</td><td align="left">7</td><td align="left">9</td></tr><tr><td align="left">tensorflow_gpu-1.5.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.8.0</td><td align="left">7</td><td align="left">9</td></tr><tr><td align="left">tensorflow_gpu-1.4.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.5.4</td><td align="left">6</td><td align="left">8</td></tr><tr><td align="left">tensorflow_gpu-1.3.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.4.5</td><td align="left">6</td><td align="left">8</td></tr><tr><td align="left">tensorflow_gpu-1.2.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.4.5</td><td align="left">5.1</td><td align="left">8</td></tr><tr><td align="left">tensorflow_gpu-1.1.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.4.2</td><td align="left">5.1</td><td align="left">8</td></tr><tr><td align="left">tensorflow_gpu-1.0.0</td><td align="left">2.7, 3.3-3.6</td><td align="left">GCC 4.8</td><td align="left">Bazel 0.4.2</td><td align="left">5.1</td><td align="left">8</td></tr></tbody></table><blockquote><p>pytorch 同样有各个版本对Cuda的要求:</p><p><a href="https://pytorch.org/get-started/previous-versions/">https://pytorch.org/get-started/previous-versions/</a></p></blockquote><ul><li>我们需要安装pytorch1.6的环境,因此需要10.2 以上的Cuda版本.</li><li>确定安装的驱动版本:</li></ul><blockquote><p><a href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html#cuda-major-component-versions">https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html#cuda-major-component-versions</a></p></blockquote><table><thead><tr><th>CUDA Toolkit</th><th>Linux x86_64 Driver Version</th><th>Windows x86_64 Driver Version</th></tr></thead><tbody><tr><td>CUDA 11.1.1 Update 1</td><td>&gt;=455.32</td><td>&gt;=456.81</td></tr><tr><td>CUDA 11.1 GA</td><td>&gt;=455.23</td><td>&gt;=456.38</td></tr><tr><td>CUDA 11.0.3 Update 1</td><td>&gt;= 450.51.06</td><td>&gt;= 451.82</td></tr><tr><td>CUDA 11.0.2 GA</td><td>&gt;= 450.51.05</td><td>&gt;= 451.48</td></tr><tr><td>CUDA 11.0.1 RC</td><td>&gt;= 450.36.06</td><td>&gt;= 451.22</td></tr><tr><td>CUDA 10.2.89</td><td>&gt;= 440.33</td><td>&gt;= 441.22</td></tr><tr><td>CUDA 10.1 (10.1.105 general release, and updates)</td><td>&gt;= 418.39</td><td>&gt;= 418.96</td></tr><tr><td>CUDA 10.0.130</td><td>&gt;= 410.48</td><td>&gt;= 411.31</td></tr><tr><td>CUDA 9.2 (9.2.148 Update 1)</td><td>&gt;= 396.37</td><td>&gt;= 398.26</td></tr><tr><td>CUDA 9.2 (9.2.88)</td><td>&gt;= 396.26</td><td>&gt;= 397.44</td></tr><tr><td>CUDA 9.1 (9.1.85)</td><td>&gt;= 390.46</td><td>&gt;= 391.29</td></tr><tr><td>CUDA 9.0 (9.0.76)</td><td>&gt;= 384.81</td><td>&gt;= 385.54</td></tr><tr><td>CUDA 8.0 (8.0.61 GA2)</td><td>&gt;= 375.26</td><td>&gt;= 376.51</td></tr><tr><td>CUDA 8.0 (8.0.44)</td><td>&gt;= 367.48</td><td>&gt;= 369.30</td></tr><tr><td>CUDA 7.5 (7.5.16)</td><td>&gt;= 352.31</td><td>&gt;= 353.66</td></tr><tr><td>CUDA 7.0 (7.0.28)</td><td>&gt;= 346.46</td><td>&gt;= 347.62</td></tr></tbody></table><blockquote><p>此时我们已经确定了当前环境为 64位 Ubuntu 16.04，显卡 1080Ti</p><p>目标 Cuda 10.2 以上,因此需要驱动版本 &gt;= 440.33</p></blockquote><h3 id="下载驱动"><a href="#下载驱动" class="headerlink" title="下载驱动"></a>下载驱动</h3><ul><li>官网下载 <a href="https://www.nvidia.cn/geforce/drivers/">https://www.nvidia.cn/geforce/drivers/</a></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201203201343.png"></p><ul><li>在搜索列表中选择合适自己目标的驱动版本(也不建议选择最新的,应用开发有可能跟不上,够用就好)</li><li>我下载了 <code>NVIDIA-Linux-x86_64-450.80.02.run</code></li></ul><h3 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h3><blockquote><p>需要强调的是我现在的安装环境是Linux服务器,没有图形界面,使用图形界面的同志不要按照此方案安装.</p></blockquote><ul><li>卸载已有的驱动</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo /usr/bin/nvidia-uninstall<br>sudo apt-<span class="hljs-builtin-name">get</span> --purge <span class="hljs-builtin-name">remove</span> nvidia-*<br></code></pre></td></tr></table></figure><ul><li>安装新驱动</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> chmod a+x NVIDIA-Linux-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>-<span class="hljs-number">450</span>.<span class="hljs-number">80</span>.<span class="hljs-number">02</span>.run<br><span class="hljs-attribute">sudo</span> ./NVIDIA-Linux-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>-<span class="hljs-number">450</span>.<span class="hljs-number">80</span>.<span class="hljs-number">02</span>.run -no-x-check -no-nouveau-check -no-opengl-files<br></code></pre></td></tr></table></figure><blockquote><p>–no-opengl-files 只安装驱动文件,不安装OpenGL文件</p><p>–no-x-check 安装驱动时不检查X服务</p><p>–no-nouveau-check 安装驱动时不检查nouveau</p></blockquote><h3 id="查看驱动更新结果"><a href="#查看驱动更新结果" class="headerlink" title="查看驱动更新结果"></a>查看驱动更新结果</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> nvidia-smi</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/images_matrixtime/20201203202133.png"></p><ul><li>更新成功。</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/qq_30163461/article/details/80314630?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2.control">https://blog.csdn.net/qq_30163461/article/details/80314630?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2.control&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2.control</a></li><li><a href="https://www.cnblogs.com/haiyang21/p/12699593.html">https://www.cnblogs.com/haiyang21/p/12699593.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorch dataloader 错误 “DataLoader worker (pid xxx) is killed by signal” 解决方法</title>
    <link href="/2020/12/03/deep_learning/pytorch/dataloader_segmentation_fault/dataloader_segmentation_fault/"/>
    <url>/2020/12/03/deep_learning/pytorch/dataloader_segmentation_fault/dataloader_segmentation_fault/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在使用 pytorch dataloader 时，出现了当把num_workers 设置不为0即报错的问题，本文记录两种此类错误的解决方案。</p></blockquote><span id="more"></span><h3 id="Dataloader-num-workers"><a href="#Dataloader-num-workers" class="headerlink" title="Dataloader - num_workers"></a>Dataloader - num_workers</h3><ul><li><p>Pytorch 中加载数据的模块<code>Dataloader</code>有个参数<code>num_workers</code>，该参数表示使用<code>dataloader</code>时加载数据的进程数量，可以理解为为网络搬运数据的工人数量；</p></li><li><p>所以如果<code>dataloader</code>比较复杂，工人多的时候自然可以节省大量数据加载时间，他们可以在网络训练时同时进行数据加载工作，等网络训练结束直接从内存中取走加载完成的数据，因此当<code>num_worker</code>大于1时可以对数据加载进行加速，当数量多到网络不需要加载数据的时间时就是工人们为加速训练做工作的极限收益了；</p></li><li><p>使用大于1的工人会占用更多的内存和cpu，同时也会占用更多的共享内存(share memory)；</p></li><li><p>使用大于1的工人会调用多线程。</p></li></ul><h3 id="问题说明"><a href="#问题说明" class="headerlink" title="问题说明"></a>问题说明</h3><blockquote><p>根据<code>num_worker</code>的工作思路，可能会在工作中出现两种错误（我遇到的两种）：</p></blockquote><ul><li>共享内存不足：</li></ul><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">RuntimeError:</span> DataLoader worker (pid XXX) <span class="hljs-built_in">is</span> killed <span class="hljs-keyword">by</span> signal: Bus <span class="hljs-keyword">error</span><br></code></pre></td></tr></table></figure><ul><li>多线程出现段错误导致死锁，进而导致程序卡住，线程阻塞：</li></ul><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">ERROR: </span>Unexpected segmentation fault encountered in worker.<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">RuntimeError:</span> <span class="hljs-string">DataLoader</span> <span class="hljs-string">worker</span> <span class="hljs-string">(pid</span> <span class="hljs-number">4499</span><span class="hljs-string">)</span> <span class="hljs-attr">is killed by signal:</span> <span class="hljs-string">Segmentation</span> <span class="hljs-string">fault.</span> <br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">RuntimeError: DataLoader worker (pid(s) <span class="hljs-strong">***</span>*) exited unexpectedly<br></code></pre></td></tr></table></figure><blockquote><p>下面给出两种问题的解决方案。</p></blockquote><h3 id="问题1-RuntimeError-DataLoader-worker-pid-XXX-is-killed-by-signal-Bus-error"><a href="#问题1-RuntimeError-DataLoader-worker-pid-XXX-is-killed-by-signal-Bus-error" class="headerlink" title="问题1 RuntimeError: DataLoader worker (pid XXX) is killed by signal: Bus error"></a>问题1 RuntimeError: DataLoader worker (pid XXX) is killed by signal: Bus error</h3><h4 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h4><ul><li>一般这种问题发生在docker中，由于docker默认的共享内存为64M，导致工人数量多时空间不够用，发生错误。</li></ul><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><h5 id="1-自废武功"><a href="#1-自废武功" class="headerlink" title="1 自废武功"></a>1 自废武功</h5><ul><li>将<code>num_workers</code>设置为0</li></ul><h5 id="2-解决问题"><a href="#2-解决问题" class="headerlink" title="2 解决问题"></a>2 解决问题</h5><ul><li>在<a href="https://www.zywvvd.com/2020/05/06/docker/docker_usage/">创建docker</a>时配置较大的共享内存，加入参数<code>--shm-size=&quot;15g&quot;</code>，设置15g（根据实际情况酌量设置）的共享内存：</li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">nvidia-docker run -it <span class="hljs-params">--name</span> [container_name] <span class="hljs-params">--shm-size=</span><span class="hljs-string">&quot;15g&quot;</span> <span class="hljs-string">...</span><br></code></pre></td></tr></table></figure><ul><li>通过 <code>df -h</code>查看</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># df -h</span><br>Filesystem                                          Size  Used Avail Use% Mounted on<br>overlay                                             <span class="hljs-number">3.6</span>T  <span class="hljs-number">3.1</span>T  <span class="hljs-number">317</span>G  <span class="hljs-number">91</span>% /<br>tmpfs                                                <span class="hljs-number">64</span>M     <span class="hljs-number">0</span>   <span class="hljs-number">64</span>M   <span class="hljs-number">0</span>% /dev<br>tmpfs                                                <span class="hljs-number">63</span>G     <span class="hljs-number">0</span>   <span class="hljs-number">63</span>G   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>fs/cgroup<br><span class="hljs-regexp">/dev/</span>sdb1                                           <span class="hljs-number">3.6</span>T  <span class="hljs-number">3.1</span>T  <span class="hljs-number">317</span>G  <span class="hljs-number">91</span>% <span class="hljs-regexp">/workspace/</span>tmp<br>shm                                                  <span class="hljs-number">15</span>G  <span class="hljs-number">8.1</span>G  <span class="hljs-number">7.0</span>G  <span class="hljs-number">54</span>% <span class="hljs-regexp">/dev/</span>shm<br>tmpfs                                                <span class="hljs-number">63</span>G   <span class="hljs-number">12</span>K   <span class="hljs-number">63</span>G   <span class="hljs-number">1</span>% <span class="hljs-regexp">/proc/</span>driver/nvidia<br><span class="hljs-regexp">/dev/</span>sda1                                           <span class="hljs-number">219</span>G  <span class="hljs-number">170</span>G   <span class="hljs-number">39</span>G  <span class="hljs-number">82</span>% <span class="hljs-regexp">/usr/</span>bin/nvidia-smi<br>udev                                                 <span class="hljs-number">63</span>G     <span class="hljs-number">0</span>   <span class="hljs-number">63</span>G   <span class="hljs-number">0</span>% <span class="hljs-regexp">/dev/</span>nvidia3<br>tmpfs                                                <span class="hljs-number">63</span>G     <span class="hljs-number">0</span>   <span class="hljs-number">63</span>G   <span class="hljs-number">0</span>% <span class="hljs-regexp">/proc/</span>acpi<br>tmpfs                                                <span class="hljs-number">63</span>G     <span class="hljs-number">0</span>   <span class="hljs-number">63</span>G   <span class="hljs-number">0</span>% <span class="hljs-regexp">/proc/</span>scsi<br>tmpfs                                                <span class="hljs-number">63</span>G     <span class="hljs-number">0</span>   <span class="hljs-number">63</span>G   <span class="hljs-number">0</span>% <span class="hljs-regexp">/sys/</span>firmware<br></code></pre></td></tr></table></figure><ul><li>其中shm即为共享内存空间</li></ul><h3 id="问题2-RuntimeError-DataLoader-worker-pid-s-exited-unexpectedly"><a href="#问题2-RuntimeError-DataLoader-worker-pid-s-exited-unexpectedly" class="headerlink" title="问题2 RuntimeError: DataLoader worker (pid(s) ****) exited unexpectedly"></a>问题2 RuntimeError: DataLoader worker (pid(s) ****) exited unexpectedly</h3><h4 id="问题原因-1"><a href="#问题原因-1" class="headerlink" title="问题原因"></a>问题原因</h4><ul><li>由于<code>dataloader</code>使用了多线程操作，如果程序中存在其他有些问题的多线程操作时就有可能导致线程套线程，容易出现死锁的情况</li><li>具体的情况可能会根据具体环境不同，我的是由于opencv中的多线程与<code>dataloader</code>的杂糅出现了问题；</li><li>此时cv版本 3.4.2，相同的代码在 4.2.0.34 的cv中没有出现问题。</li></ul><h4 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h4><h5 id="1-自废武功-1"><a href="#1-自废武功-1" class="headerlink" title="1 自废武功"></a>1 自废武功</h5><ul><li>将<code>num_workers</code>设置为0</li></ul><h5 id="2-解决问题-1"><a href="#2-解决问题-1" class="headerlink" title="2 解决问题"></a>2 解决问题</h5><ul><li>在dataloader 的 <code>__getitem__</code> 方法中禁用opencv的多线程：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span>(<span class="hljs-params">self, idx</span>):</span><br><span class="hljs-keyword">import</span> cv2<br>cv2.setNumThreads(<span class="hljs-number">0</span>)<br>...<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://blog.csdn.net/willen_/article/details/103489485?utm_medium=distribute.pc_relevant.none-task-blog-title-6&amp;spm=1001.2101.3001.4242">https://blog.csdn.net/willen_/article/details/103489485?utm_medium=distribute.pc_relevant.none-task-blog-title-6&amp;spm=1001.2101.3001.4242</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/133707658">https://zhuanlan.zhihu.com/p/133707658</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>pytorch</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>python</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 umount 命令卸载 CIFS 时卡死的问题</title>
    <link href="/2020/12/02/linux/mount/busy_umount_cifs/busy_umount_cifs/"/>
    <url>/2020/12/02/linux/mount/busy_umount_cifs/busy_umount_cifs/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在Linux系统使用 mount 命令挂载Windows CIFS 磁盘后，如果Windows系统重启，则可能会导致Linux挂载该磁盘出错，无法访问，也无法直接用umount命令卸载，重启虽然可以解决问题，但是代价太大。</p><p>本文记录问题无痛解决方法。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><ul><li>在Linux卸载Windows CIFS共享磁盘时卡死 ：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo umount cifs_dir<br></code></pre></td></tr></table></figure><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><ul><li>由于Windows 重启，导致磁盘失去连接</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">sudo umount -f -<span class="hljs-selector-tag">a</span> -t cifs -l cifs_dir<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决mount 命令挂载CIFS时出现 “Operation now in progress” 的问题</title>
    <link href="/2020/12/02/linux/mount/operation_now_in_progress/operation_now_in_progress/"/>
    <url>/2020/12/02/linux/mount/operation_now_in_progress/operation_now_in_progress/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在Linux系统使用 mount 命令挂载Windows CIFS 磁盘时报错  “Operation now in progress”，本文记录问题解决方法。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><ul><li>在Linux挂载Windows CIFS共享磁盘时报错 ：</li></ul><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">mount</span>: <span class="hljs-built_in">mount</span> ... failed: Operation now <span class="hljs-keyword">in</span> progress<br></code></pre></td></tr></table></figure><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><ul><li>由于Windows 防火墙没有关闭</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>关闭Windows防火墙：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201116143452.png"></p><ul><li>问题解决，可以正常mount windows 磁盘</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -14- 利用 Markdown 语法画 mermaid 流程图</title>
    <link href="/2020/11/24/hexo/14_mermaid/mermaid/"/>
    <url>/2020/11/24/hexo/14_mermaid/mermaid/</url>
    
    <content type="html"><![CDATA[<blockquote><p>hexo默认不支持流程图，<a href="https://www.zywvvd.com/2020/11/23/hexo/13_flowchart/flowchart/">flowchart</a>是一种简便好用的解决方案，但由于其语法过于简单，导致其在应付稍复杂一些的流程图时捉襟见肘，本文记录在hexo中添加Mermaid流程图的方法。</p></blockquote><span id="more"></span><h3 id="添加支持"><a href="#添加支持" class="headerlink" title="添加支持"></a>添加支持</h3><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs processing">npm install --<span class="hljs-built_in">save</span> hexo-<span class="hljs-built_in">filter</span>-mermaid-diagrams<br></code></pre></td></tr></table></figure><h4 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h4><ul><li>在主题配置文件中找到<code>mermaid</code>选项，将<code>enable</code>设置为<code>true</code>。</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20201123235944.png"></p><h3 id="加入mermaid代码块"><a href="#加入mermaid代码块" class="headerlink" title="加入mermaid代码块"></a>加入mermaid代码块</h3><blockquote><p>官网有最全的说明文档 <a href="https://mermaidjs.github.io/">https://mermaidjs.github.io/</a> ，此处记录常用使用方法。</p></blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ada">graph TD<br>    B((开始)) <span class="hljs-comment">--&gt;C&#123;判断&#125;</span><br>    C <span class="hljs-comment">--  a=1 --&gt;D[执行语句1]</span><br>    C <span class="hljs-comment">--  a=2  --&gt;E[执行语句2]</span><br>    C <span class="hljs-comment">--  a=3 --&gt;F[执行语句3]</span><br>    C <span class="hljs-comment">-- a=4  --&gt;G[执行语句4]</span><br>    D<span class="hljs-comment">--&gt; AA((结束))</span><br>    E<span class="hljs-comment">--&gt; AA</span><br>    F<span class="hljs-comment">--&gt; AA</span><br>   G<span class="hljs-comment">--&gt; AA  </span><br></code></pre></td></tr></table></figure><pre class="mermaid">graph TD    B((开始)) -->C{判断}    C --  a=1 -->D[执行语句1]    C --  a=2  -->E[执行语句2]    C --  a=3 -->F[执行语句3]    C -- a=4  -->G[执行语句4]    D--> AA((结束))    E--> AA    F--> AA   G--> AA</pre><h3 id="流程图语法"><a href="#流程图语法" class="headerlink" title="流程图语法"></a>流程图语法</h3><h4 id="方向"><a href="#方向" class="headerlink" title="方向"></a>方向</h4><table><thead><tr><th>方向</th><th>含义</th></tr></thead><tbody><tr><td>TB</td><td>从上到下</td></tr><tr><td>BT</td><td>从下到上</td></tr><tr><td>RL</td><td>从右到左</td></tr><tr><td>LR</td><td>从左到右</td></tr><tr><td>TD</td><td>与TB相同</td></tr></tbody></table><h4 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h4><p>语法结构如下：<code>A[名称] --&gt; B(名称)</code><br>其中，A、B均代表形状名称，<code> --&gt;</code>表示箭头指向，形状样式用后面的括号来表示，括号里面的内容是形状中要显示的文本内容。其中有以下几种形状：</p><table><thead><tr><th>括号形式</th><th>形状样式</th></tr></thead><tbody><tr><td>[ ]</td><td>矩形框</td></tr><tr><td>( )</td><td>圆角矩形框</td></tr><tr><td>{ }</td><td>菱形</td></tr><tr><td>(( ))</td><td>圆形</td></tr></tbody></table><h4 id="连接线"><a href="#连接线" class="headerlink" title="连接线"></a>连接线</h4><table><thead><tr><th>符号</th><th>箭头</th></tr></thead><tbody><tr><td>–&gt;</td><td>箭头</td></tr><tr><td>—</td><td>没有箭头</td></tr><tr><td>– 文字 — /  — |文字|</td><td>带文字的连接线</td></tr><tr><td>–&gt;|文字| / – 文字 –&gt;</td><td>带箭头和文字的连接</td></tr><tr><td>-.-&gt;</td><td>虚线</td></tr><tr><td>-. 文字 .-&gt;</td><td>带文字的虚线连接</td></tr><tr><td>==&gt;</td><td>粗连接线</td></tr><tr><td>== 文本 ==&gt;</td><td>带文本的粗连接</td></tr></tbody></table><h4 id="子图"><a href="#子图" class="headerlink" title="子图"></a>子图</h4><p>语法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">subgraph title<br>    graph definition<br>end<br></code></pre></td></tr></table></figure><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">graph</span> TB<br>    <span class="hljs-built_in">c1</span>--&gt;<span class="hljs-built_in">a2</span><br>    subgraph one<br>    <span class="hljs-built_in">a1</span>--&gt;<span class="hljs-built_in">a2</span><br>    <span class="hljs-meta">end</span><br>    subgraph two<br>    b1--&gt;b2<br>    <span class="hljs-meta">end</span><br>    subgraph three<br>    <span class="hljs-built_in">c1</span>--&gt;<span class="hljs-built_in">c2</span><br>    <span class="hljs-meta">end</span><br></code></pre></td></tr></table></figure><pre class="mermaid">graph TB    c1-->a2    subgraph one    a1-->a2    end    subgraph two    b1-->b2    end    subgraph three    c1-->c2    end</pre><h4 id="样式链接"><a href="#样式链接" class="headerlink" title="样式链接"></a>样式链接</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">graph</span> LR<br>    <span class="hljs-attribute">id1</span>(Start)--&gt;id<span class="hljs-number">2</span>(Stop)<br>    <span class="hljs-attribute">style</span> id<span class="hljs-number">1</span> fill:#f<span class="hljs-number">9</span>f,stroke:#<span class="hljs-number">333</span>,stroke-width:<span class="hljs-number">4</span>px<br>    <span class="hljs-attribute">style</span> id<span class="hljs-number">2</span> fill:#ccf,stroke:#f<span class="hljs-number">66</span>,stroke-width:<span class="hljs-number">2</span>px,stroke-dasharray: <span class="hljs-number">5</span>, <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><pre class="mermaid">graph LR    id1(Start)-->id2(Stop)    style id1 fill:#f9f,stroke:#333,stroke-width:4px    style id2 fill:#ccf,stroke:#f66,stroke-width:2px,stroke-dasharray: 5, 5</pre><h4 id="综合应用"><a href="#综合应用" class="headerlink" title="综合应用"></a>综合应用</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">graph</span> TB<br>    <span class="hljs-attribute">id1</span>(圆角矩形)--普通线--&gt;id<span class="hljs-number">2</span>[矩形]<br>    <span class="hljs-attribute">subgraph</span> 子图表<br>        <span class="hljs-attribute">id2</span>==粗线==&gt;id<span class="hljs-number">3</span>&#123;菱形&#125;<br>        <span class="hljs-attribute">id3</span>-.虚线.-&gt;id<span class="hljs-number">4</span>&gt;右向旗帜]<br>        <span class="hljs-attribute">id3</span>--无箭头---id<span class="hljs-number">5</span>((圆形))<br>    <span class="hljs-attribute">end</span><br>    <span class="hljs-attribute">style</span> id<span class="hljs-number">1</span> fill:#f<span class="hljs-number">9</span>f,stroke:#<span class="hljs-number">333</span>,stroke-width:<span class="hljs-number">4</span>px<br></code></pre></td></tr></table></figure><pre class="mermaid">graph TB    id1(圆角矩形)--普通线-->id2[矩形]    subgraph 子图表        id2==粗线==>id3{菱形}        id3-.虚线.->id4>右向旗帜]        id3--无箭头---id5((圆形))    end    style id1 fill:#f9f,stroke:#333,stroke-width:4px</pre><h3 id="序列图语法"><a href="#序列图语法" class="headerlink" title="序列图语法"></a>序列图语法</h3><p>使用以下语法开始序列图</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs prolog">sequenceDiagram<br>    [参与者<span class="hljs-number">1</span>][消息线][参与者<span class="hljs-number">2</span>]:消息体<br>    ...<br></code></pre></td></tr></table></figure><h4 id="参与者"><a href="#参与者" class="headerlink" title="参与者"></a>参与者</h4><p>定义参与者</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript">sequenceDiagram<br>    participant 参与者 <span class="hljs-number">1</span><br>    participant 参与者 <span class="hljs-number">2</span><br>    ...<br>    participant 简称 <span class="hljs-keyword">as</span> 参与者 <span class="hljs-number">3</span> <span class="hljs-comment">#该语法可以在接下来的描述中使用简称来代替参与者 312345</span><br></code></pre></td></tr></table></figure><h4 id="消息线"><a href="#消息线" class="headerlink" title="消息线"></a>消息线</h4><p>|类型|描述|<br>|<code>-&gt;</code>|无箭头的实线|<br>|<code>--&gt;</code>|无箭头的虚线|<br>|<code>-&gt;&gt;</code>|有箭头的实线|<br>|<code>--&gt;&gt;</code>|有箭头的虚线|<br>|<code>-x</code>|末端为叉的实线（表示异步）|<br>|<code>--x</code>|末端为叉的虚线（表示异步）|</p><h4 id="处理中"><a href="#处理中" class="headerlink" title="处理中"></a>处理中</h4><p>在消息线末尾增加 <code>+</code> ，则消息接收者进入当前消息的“处理中”状态；<br>在消息线末尾增加 <code>-</code> ，则消息接收者离开当前消息的“处理中”状态。</p><p>或者使用以下语法直接说明某个参与者进入“处理中”状态</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">activate</span> 参与者<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h4 id="标注"><a href="#标注" class="headerlink" title="标注"></a>标注</h4><p>语法如下</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Note</span> 位置表述 参与者: 标注文字<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>其中位置表述可以为</p><table><thead><tr><th>表述</th><th>含义</th></tr></thead><tbody><tr><td>right of</td><td>右侧</td></tr><tr><td>left of</td><td>左侧</td></tr><tr><td>over</td><td>在当中，可以横跨多个参与者</td></tr></tbody></table><h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><p>语法如下</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">loop</span> 循环的条件<br>    循环体描述语句<br>end123<br></code></pre></td></tr></table></figure><h4 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h4><figure class="highlight mercury"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mercury">alt 条件 <span class="hljs-number">1</span> 描述<br>    分支 <span class="hljs-number">1</span> 描述语句<br><span class="hljs-built_in">else</span> 条件 <span class="hljs-number">2</span> 描述 # <span class="hljs-built_in">else</span> 分支可选<br>    分支 <span class="hljs-number">2</span> 描述语句<br><span class="hljs-built_in">else</span> ...<br>    ...<br>end1234567<br></code></pre></td></tr></table></figure><p>如果遇到可选的情况，即没有 else 分支的情况，使用如下语法：</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">opt 条件描述<br>    分支描述语句<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><h4 id="综合应用-1"><a href="#综合应用-1" class="headerlink" title="综合应用"></a>综合应用</h4><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs coq">sequenceDiagram<br>    participant z <span class="hljs-built_in">as</span> 张三<br>    participant l <span class="hljs-built_in">as</span> 李四<br>    loop 日复一日<br>        z-&gt;&gt;l: 吃了吗您呐？<br>        l--&gt;&gt;z: 吃了，您呢？<br>        activate z<br>        Note <span class="hljs-built_in">left</span> of z: 想了一下<br>        alt 还没吃<br>            z-xl: 还没呢，正准备回去吃<br>        <span class="hljs-keyword">else</span> 已经吃了<br>            z-xl: 我也吃过了，哈哈<br>        <span class="hljs-keyword">end</span><br>        opt 大过年的<br>            l--&gt;z: 祝您新年好啊<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><pre class="mermaid">sequenceDiagram    participant z as 张三    participant l as 李四    loop 日复一日        z->>l: 吃了吗您呐？        l-->>z: 吃了，您呢？        activate z        Note left of z: 想了一下        alt 还没吃            z-xl: 还没呢，正准备回去吃        else 已经吃了            z-xl: 我也吃过了，哈哈        end        opt 大过年的            l-->z: 祝您新年好啊        end    end</pre><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://mermaidjs.github.io/">https://mermaidjs.github.io</a></p></li><li><p><a href="https://www.jianshu.com/p/af48cc77b57a">https://www.jianshu.com/p/af48cc77b57a</a></p></li><li><p><a href="https://baijiahao.baidu.com/s?id=1641809867954032650&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1641809867954032650&amp;wfr=spider&amp;for=pc</a></p></li><li><p><a href="https://blog.csdn.net/fenghuizhidao/article/details/79440583">https://blog.csdn.net/fenghuizhidao/article/details/79440583</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -13- 利用 Markdown 语法画 flowchart 流程图</title>
    <link href="/2020/11/23/hexo/13_flowchart/flowchart/"/>
    <url>/2020/11/23/hexo/13_flowchart/flowchart/</url>
    
    <content type="html"><![CDATA[<blockquote><p>hexo默认不支持流程图，flowchart 简便易食，可以瞬间使 hexo 流程图无中生有。本文记录在hexo中添加Markdown flowchart流程图的方法。</p></blockquote><span id="more"></span><h3 id="添加支持"><a href="#添加支持" class="headerlink" title="添加支持"></a>添加支持</h3><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs processing">npm install --<span class="hljs-built_in">save</span> hexo-<span class="hljs-built_in">filter</span>-flowchart<br></code></pre></td></tr></table></figure><h3 id="添加Flow代码"><a href="#添加Flow代码" class="headerlink" title="添加Flow代码"></a>添加Flow代码</h3><ul><li>需要在代码块(ctrl + shift + k)中，选择语言为<code>flow</code>。</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20201123232520.png"></p><ul><li>添加flow代码：</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs livescript">st=&gt;start: 开始节点<br><span class="hljs-keyword">in</span>=&gt;inputoutput: 输入<br>e=&gt;end: 结束节点<br>op=&gt;operation: 操作节点<br>cond=&gt;condition: 条件节点<br>sub=&gt;subroutine: 子例程<br>out=&gt;inputoutput: 输出<br>st<span class="hljs-function"><span class="hljs-params">(right)</span>-&gt;</span><span class="hljs-keyword">in</span>-&gt;op-&gt;cond<br>cond<span class="hljs-function"><span class="hljs-params">(<span class="hljs-literal">yes</span>,right)</span>-&gt;</span>out-&gt;e<br>cond<span class="hljs-function"><span class="hljs-params">(<span class="hljs-literal">no</span>)</span>-&gt;</span>sub<br></code></pre></td></tr></table></figure><div id="flowchart-0" class="flow-chart"></div><h3 id="Flow-语法结构"><a href="#Flow-语法结构" class="headerlink" title="Flow 语法结构"></a>Flow 语法结构</h3><ul><li>语法概述</li></ul><blockquote><p>flow 语法其实是直截了当的，分为节点定义和节点连接两部分</p></blockquote><h4 id="节点定义"><a href="#节点定义" class="headerlink" title="节点定义"></a>节点定义</h4><ul><li>语法结构如下：<code>X=&gt;Y: Z</code><br>其中，X是变量名， Y是指操作模块名，冒号后面的Z是具体显示的文字内容。需要注意的是，冒号后要加空格才能识别，而<code>X</code>，<code>Y</code>与<code>=&gt;</code>之间不允许有空格。<br>其中，变量名X和文字内容Z可以比较随意设置，但是Y是有固定的内容，主要有以下几种：</li></ul><table><thead><tr><th>操作模块名</th><th>表示含义说明</th></tr></thead><tbody><tr><td>start</td><td>开始</td></tr><tr><td>end</td><td>结束</td></tr><tr><td>operation</td><td>普通操作块</td></tr><tr><td>subroutine</td><td>子任务块</td></tr><tr><td>condition</td><td>判断块</td></tr><tr><td>inputoutput</td><td>输入输出块</td></tr></tbody></table><h4 id="节点连接"><a href="#节点连接" class="headerlink" title="节点连接"></a>节点连接</h4><ul><li>定义语法节点后，需要理顺节点之间的关系，才能建立正确的流程图；</li><li>在flow中使用<code>-&gt;</code>符号连接两个前后的变量；</li><li>如： <code>a-&gt;b-&gt;c</code>，表示节点<code>a</code>转到<code>b</code>又到<code>c</code>节点；</li><li>上述转接也可以写成：</li></ul><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">a</span>-&gt;</span>b<br><span class="hljs-function"><span class="hljs-title">b</span>-&gt;</span>c<br></code></pre></td></tr></table></figure><ul><li>condition是判断，可以取yes和no两种结果，对于不同结果可以有不同走向。如：<br><code>cond(yes)-&gt;out </code>表示condition成立时转向out执行；<br><code>cond(no)-&gt;op</code>表示condition不成立时转向op执行；</li></ul><h4 id="连接方向"><a href="#连接方向" class="headerlink" title="连接方向"></a>连接方向</h4><ul><li>连接线有上下左右四个方向，如果需要指定连接线连接到某一特定方向，在连接线开始的元素后面添加方向即可，方向包括：</li></ul><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clojure">(<span class="hljs-name">top</span>)<br>(<span class="hljs-name">bottom</span>)<br>(<span class="hljs-name">left</span>)<br>(<span class="hljs-name">right</span>)<br></code></pre></td></tr></table></figure><ul><li>如果要设置条件框连接线方向，在括号中添加即可。条件框只有两个方向可供选择：</li></ul><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gams"># <span class="hljs-keyword">yes</span>向下，<span class="hljs-keyword">no</span>向右（默认）<br># <span class="hljs-keyword">yes</span>向右，<span class="hljs-keyword">no</span>向下。<br>cond(<span class="hljs-keyword">yes</span>,right)<br>cond(<span class="hljs-keyword">no</span>,bottom)<br></code></pre></td></tr></table></figure><blockquote><p>只需要指定其中一条分支的方向即可。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="https://blog.csdn.net/wzh0709zml/article/details/103310405">https://blog.csdn.net/wzh0709zml/article/details/103310405</a></p></li><li><p><a href="http://www.zhaojun.im/hexo-flowchart/">http://www.zhaojun.im/hexo-flowchart/</a></p></li><li><p><a href="https://www.jianshu.com/p/f28c94cf1204">https://www.jianshu.com/p/f28c94cf1204</a><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: 开始节点in=>inputoutput: 输入e=>end: 结束节点op=>operation: 操作节点cond=>condition: 条件节点sub=>subroutine: 子例程out=>inputoutput: 输出st(right)->in->op->condcond(yes,right)->out->econd(no)->sub</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - Matplotlib 关于 agg 相关错误的解决方法</title>
    <link href="/2020/11/19/python/matplotlib_agg/matplotlib_agg/"/>
    <url>/2020/11/19/python/matplotlib_agg/matplotlib_agg/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Python使用matplotlib时有时会报出和 agg相关的错误，本文记录两种常见错误的解决方案。</p></blockquote><span id="more"></span><h3 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h3><h4 id="UserWarning-Matplotlib-is-currently-using-agg-which-is-a-non-GUI-backend"><a href="#UserWarning-Matplotlib-is-currently-using-agg-which-is-a-non-GUI-backend" class="headerlink" title="UserWarning: Matplotlib is currently using agg, which is a non-GUI backend"></a>UserWarning: Matplotlib is currently using agg, which is a non-GUI backend</h4><ul><li>agg是一个没有图形显示界面的终端，常用的有图形界面显示的终端有TkAgg等，将终端更换一下就好了。</li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">import matplotlib <br>matplotlib.<span class="hljs-keyword">use</span>(<span class="hljs-symbol">&#x27;TkAgg</span>&#x27;)<br></code></pre></td></tr></table></figure><h3 id="问题2"><a href="#问题2" class="headerlink" title="问题2"></a>问题2</h3><h4 id="TclError-no-display-name-and-no-DISPLAY-environment-variable-Backend-TkAgg-is-interactive-backend-Turning-interactive-mode-on"><a href="#TclError-no-display-name-and-no-DISPLAY-environment-variable-Backend-TkAgg-is-interactive-backend-Turning-interactive-mode-on" class="headerlink" title="TclError: no display name and no $DISPLAY environment variable Backend TkAgg is interactive backend. Turning interactive mode on."></a>TclError: no display name and no $DISPLAY environment variable Backend TkAgg is interactive backend. Turning interactive mode on.</h4><ul><li>这是由于在没有图形终端的场景下使用了TkAgg，换成没有图形的就好了。</li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">import matplotlib<br>matplotlib.<span class="hljs-keyword">use</span>(<span class="hljs-symbol">&#x27;Agg</span>&#x27;)<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>故障排除</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pytorch pth 模型转 onnx模型，并验证结果正确性</title>
    <link href="/2020/11/19/deep_learning/pytorch/covert_pt_to_onnx/covert_pt_to_onnx/"/>
    <url>/2020/11/19/deep_learning/pytorch/covert_pt_to_onnx/covert_pt_to_onnx/</url>
    
    <content type="html"><![CDATA[<blockquote><p>pytorch 模型部署很重要的一步是转存pth模型为ONNX，本文记录方法。</p></blockquote><span id="more"></span><h3 id="转存-onnx"><a href="#转存-onnx" class="headerlink" title="转存 onnx"></a>转存 onnx</h3><ul><li>建立自己的pytorch模型，并加载权重</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">model = create_model(num_classes=<span class="hljs-number">2</span>)<br>model.load_state_dict(load(model_path, map_location=<span class="hljs-string">&#x27;cpu&#x27;</span>)[<span class="hljs-string">&quot;model&quot;</span>])<br></code></pre></td></tr></table></figure><ul><li>转存onnx文件</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">dummy_input = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">256</span>, <span class="hljs-number">256</span>, device=<span class="hljs-string">&#x27;cpu&#x27;</span>)<br>torch.onnx._export(model, dummy_input, <span class="hljs-string">&quot;faster_rcnn.onnx&quot;</span>, verbose=<span class="hljs-literal">True</span>, opset_version=<span class="hljs-number">11</span>)<br></code></pre></td></tr></table></figure><blockquote><p>将模型保存在了当前目录的 <code>faster_rcnn.onnx</code>文件内</p></blockquote><h4 id="验证-onnx-有效性"><a href="#验证-onnx-有效性" class="headerlink" title="验证 onnx 有效性"></a>验证 onnx 有效性</h4><ul><li>安装 <code>onnxruntime</code> 库</li></ul><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> onnxruntime<br></code></pre></td></tr></table></figure><ul><li>加载onnx模型并测试</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> onnxruntime<br><span class="hljs-keyword">from</span> onnxruntime.datasets <span class="hljs-keyword">import</span> get_example<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">to_numpy</span>(<span class="hljs-params">tensor</span>):</span><br>    <span class="hljs-keyword">return</span> tensor.detach().cpu().numpy() <span class="hljs-keyword">if</span> tensor.requires_grad <span class="hljs-keyword">else</span> tensor.cpu().numpy()<br><br><span class="hljs-comment"># 测试数据</span><br>dummy_input = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">256</span>, <span class="hljs-number">256</span>, device=<span class="hljs-string">&#x27;cpu&#x27;</span>)<br><br>example_model = get_example(&lt;absolute_root_to_your_onnx_model_file&gt;)<br><span class="hljs-comment"># netron.start(example_model) 使用 netron python 包可视化网络</span><br>sess = onnxruntime.InferenceSession(example_model)<br><br><span class="hljs-comment"># onnx 网络输出</span><br>onnx_out = sess.run(<span class="hljs-literal">None</span>, &#123;&lt;input_layer_name_of_your_network&gt;: to_numpy(dummy_input)&#125;)<br><span class="hljs-built_in">print</span>(onnx_out)<br><br>model.<span class="hljs-built_in">eval</span>()<br><span class="hljs-keyword">with</span> torch.no_grad():<br>    <span class="hljs-comment"># pytorch model 网络输出</span><br>    torch_out = model(dummy_input)<br><span class="hljs-built_in">print</span>(torch_out)<br></code></pre></td></tr></table></figure><ul><li>输出：</li></ul><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs prolog">onnx_out<br>[array([[  <span class="hljs-number">0.</span>       ,  <span class="hljs-number">93.246</span>    , <span class="hljs-number">228.95842</span>  , <span class="hljs-number">256.</span>       ],<br>       [  <span class="hljs-number">0.</span>       ,   <span class="hljs-number">2.6370468</span>, <span class="hljs-number">209.39705</span>  , <span class="hljs-number">148.17822</span>  ]],<br>      dtype=float32), array([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>], dtype=int64), array([<span class="hljs-number">0.1501071</span> , <span class="hljs-number">0.07568519</span>], dtype=float32)]<br><br>torch_out<br>[&#123;<span class="hljs-string">&#x27;boxes&#x27;</span>: tensor([[  <span class="hljs-number">0.0000</span>,  <span class="hljs-number">93.2459</span>, <span class="hljs-number">228.9584</span>, <span class="hljs-number">256.0000</span>],<br>        [  <span class="hljs-number">0.0000</span>,   <span class="hljs-number">2.6370</span>, <span class="hljs-number">209.3971</span>, <span class="hljs-number">148.1782</span>]]), <span class="hljs-string">&#x27;labels&#x27;</span>: tensor([<span class="hljs-number">1</span>, <span class="hljs-number">1</span>]), <span class="hljs-string">&#x27;scores&#x27;</span>: tensor([<span class="hljs-number">0.1501</span>, <span class="hljs-number">0.0757</span>])&#125;]<br><br></code></pre></td></tr></table></figure><h4 id="获取自己网络输入层名称"><a href="#获取自己网络输入层名称" class="headerlink" title="获取自己网络输入层名称"></a>获取自己网络输入层名称</h4><ul><li>有时对网络不熟悉的情况下不清楚模型输入层的名称，可以使用Netron可视化自己的网络，获取输入层名称，喂入onnx的sess中。</li></ul><h2 id="注意-！！！"><a href="#注意-！！！" class="headerlink" title="注意 ！！！"></a><font color=red size=6 face='微软雅黑'>注意 ！！！</font></h2><ul><li><p>pytorch 模型在转 ONNX 模型的过程中，使用的导出器是一个基于轨迹的导出器,这意味着它执行时需要运行一次模型,然后导出实际参与运算的运算符. 这也意味着, 如果你的模型是动态的,例如,改变一些依赖于输入数据的操作,这时的导出结果是不准确的.同样,一 个轨迹可能只对一个具体的输入尺寸有效 (这是为什么我们在轨迹中需要有明确的输入的原因之一.) 我们建议检查 模型的轨迹,确保被追踪的运算符是合理的.   ———  <a href="https://pytorch.apachecn.org/docs/0.3/onnx.html">pytorch 文档</a></p></li><li><p>也就是说，如果网络模块中存在 if.. else.. 类似的分支，在生成ONNX模型时会依据所使用的初始数据来选择其中某一个分支，这样所生成的ONNX模型仅会保留这一个分支的结构，在原始pytorch模型中的其他逻辑能力在该模型中不复存在。</p></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://pytorch.apachecn.org/docs/0.3/onnx.html">https://pytorch.apachecn.org/docs/0.3/onnx.html</a></li><li><a href="https://www.jianshu.com/p/5a0a09fbdeba">https://www.jianshu.com/p/5a0a09fbdeba</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>深度学习</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Netron 可视化网络结构</title>
    <link href="/2020/11/19/deep_learning/pytorch/netron_visualize_model/netron_visualize_model/"/>
    <url>/2020/11/19/deep_learning/pytorch/netron_visualize_model/netron_visualize_model/</url>
    
    <content type="html"><![CDATA[<blockquote><p>pytorch模型可视化网络结构不是特别方便，需要借助Netron工具，本文记录可视化方法。</p></blockquote><span id="more"></span><p><a href="https://github.com/lutzroeder/netron">Github 官网链接</a></p><h3 id="支持的网络格式"><a href="#支持的网络格式" class="headerlink" title="支持的网络格式"></a>支持的网络格式</h3><blockquote><p>Netron supports <strong>ONNX</strong> (<code>.onnx</code>, <code>.pb</code>, <code>.pbtxt</code>), <strong>Keras</strong> (<code>.h5</code>, <code>.keras</code>), <strong>Core ML</strong> (<code>.mlmodel</code>), <strong>Caffe</strong> (<code>.caffemodel</code>, <code>.prototxt</code>), <strong>Caffe2</strong> (<code>predict_net.pb</code>), <strong>Darknet</strong> (<code>.cfg</code>), <strong>MXNet</strong> (<code>.model</code>, <code>-symbol.json</code>), <strong>Barracuda</strong> (<code>.nn</code>), <strong>ncnn</strong> (<code>.param</code>), <strong>Tengine</strong> (<code>.tmfile</code>), <strong>TNN</strong> (<code>.tnnproto</code>), <strong>UFF</strong> (<code>.uff</code>) and <strong>TensorFlow Lite</strong> (<code>.tflite</code>).</p><p>Netron has experimental support for <strong>TorchScript</strong> (<code>.pt</code>, <code>.pth</code>), <strong>PyTorch</strong> (<code>.pt</code>, <code>.pth</code>), <strong>Torch</strong> (<code>.t7</code>), <strong>Arm NN</strong> (<code>.armnn</code>), <strong>BigDL</strong> (<code>.bigdl</code>, <code>.model</code>), <strong>Chainer</strong> (<code>.npz</code>, <code>.h5</code>), <strong>CNTK</strong> (<code>.model</code>, <code>.cntk</code>), <strong>Deeplearning4j</strong> (<code>.zip</code>), <strong>MediaPipe</strong> (<code>.pbtxt</code>), <strong>ML.NET</strong> (<code>.zip</code>), <strong>MNN</strong> (<code>.mnn</code>), <strong>PaddlePaddle</strong> (<code>.zip</code>, <code>__model__</code>), <strong>OpenVINO</strong> (<code>.xml</code>), <strong>scikit-learn</strong> (<code>.pkl</code>), <strong>TensorFlow.js</strong> (<code>model.json</code>, <code>.pb</code>) and <strong>TensorFlow</strong> (<code>.pb</code>, <code>.meta</code>, <code>.pbtxt</code>, <code>.ckpt</code>, <code>.index</code>).</p></blockquote><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="安装app"><a href="#安装app" class="headerlink" title="安装app"></a>安装app</h4><ul><li>进入<a href="https://github.com/lutzroeder/netron">Releases</a>下载自己操作系统需要的安装包文件，运行安装即可：</li></ul><blockquote><p><strong>macOS</strong>:  <code>.dmg</code></p><p><strong>Linux</strong>: <code>.AppImage</code></p><p><strong>Windows</strong>: <code>.exe</code></p></blockquote><h4 id="可视化网络"><a href="#可视化网络" class="headerlink" title="可视化网络"></a>可视化网络</h4><ul><li>运行程序</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201113152042.png"></p><ul><li>打开模型文件，可以看到模型的网络结构：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201113152349.png"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>pytorch</category>
      
      <category>可视化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>深度学习</tag>
      
      <tag>pytorch</tag>
      
      <tag>可视化</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>二次型优化问题 - 1 - 问题描述</title>
    <link href="/2020/11/16/machine_learning/conjugate-gradient-algorithm/conjugate-gradient/conjugate-gradient/"/>
    <url>/2020/11/16/machine_learning/conjugate-gradient-algorithm/conjugate-gradient/conjugate-gradient/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在各种场景可能都会遇到需要求解多元二次函数极值的问题，本系列文章介绍相关的计算方法，核心内容为共轭梯度法。</p><p>本文介绍问题定义。</p></blockquote><span id="more"></span><h3 id="问题定义"><a href="#问题定义" class="headerlink" title="问题定义"></a>问题定义</h3><ul><li>多元二次多项式，维度为$n$，那么可以用以下公式描述该函数：</li></ul><p>$$<br>f({x_1},{x_2},{x_3},…,{x_n}) = {a_{1,1}}x_1^2 + {a_{1,2}}{x_1}{x_2} + {a_{1,3}}{x_1}{x_3} +  \cdots  + {a_{1,n}}{x_1}{x_n} + {a_{2,1}}x_2{x_1} + {a_{2,2}}{x_2^2} + {a_{2,3}}{x_2}{x_3} +  \cdots  + {a_{2,n}}{x_2}{x_n} +  \cdots  + {a_{n,n}}x_n^2+{b_1}x_1+{b_2}x_2+\cdots+{b_n}x_n+c<br>$$</p><blockquote><p>其中$a_{i,j}$为二次项系数，共有$n^2$项，$1 \le i,j \le n$，且所有的$a$不全为0，即$\exists a_{i,j} \ne 0$;</p><p>$b_k$为一次项系数，共$n$项，$1 \le k \le n$;</p><p>$c$为常数项。</p></blockquote><ul><li>记 $f({\bf{x}}) = {[{x_1},{x_2}, \cdots ,{x_n}]^T}$ ，则上述函数可以写作二次型的形式：</li></ul><p>$$<br>f({x_1},{x_2},{x_3},…,{ x_n}) = f({\bf{x}}) = {\bf{x^T} }\bf{A}{\bf{x} } + { {\bf{b} }^T}{\bf{x} } + c<br>$$</p><blockquote><p>转化过程中$\bf{A},\bf{b}$满足：</p><p>${\bf{A} }$ 为$n$阶对称方阵，${ { \bf { A } } _ { i , j } } = { a _ { i , j } }$</p><p>因为$\exists a_{i,j} \ne 0$，$\bf{A}$不为零矩阵</p><p>$\bf{b}_i=b_i$</p></blockquote><ul><li>为了后续计算简便，我们将二次型稍作改动：</li></ul><p>$$<br>f({\bf{x} }) = \frac{1}{2}{\bf{x^TAx} } - { {\bf{b} }^{\bf{T} } }{\bf{x} } + {\bf{c} }<br>$$</p><ul><li>我们的目标就是寻找该函数的极值点的坐标，我们把该目标称为$\bf{x^*}$。</li></ul><h3 id="简要分析"><a href="#简要分析" class="headerlink" title="简要分析"></a>简要分析</h3><ul><li>当前问题其实就是多元二次方程极值求解的问题</li><li>此类函数在函数定义域内处处连续可导</li><li>极值点必然处于导数为0的位置</li></ul><h3 id="需要解决的问题"><a href="#需要解决的问题" class="headerlink" title="需要解决的问题"></a>需要解决的问题</h3><ul><li>同一个多元二次方程表示成二次型的参数$\bf{A},\bf{b},\bf{c}$是否唯一，如果不唯一该如何设置，为什么如此设置</li><li>该问题是否存在导数为0的点</li><li>导数为0的点如何求解</li><li>导数为0的点是否就是极值点</li><li>对于给定的二次型如何判断是否可优化</li><li>对于可优化的二次型都有什么方法寻找极值点</li><li>寻找极值点的方法们都有哪些优缺点，为什么需要提出共轭梯度法</li><li>代数解法，梯度下降法介绍与分析</li><li>共轭梯度法介绍与分析</li><li>共轭梯度法的相关证明</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>优化方法</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>优化方法</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 将matplotlib图像转换为numpy.array 或 PIL.Image</title>
    <link href="/2020/11/06/python/convert_matplotlib_figure_to_array/convert_matplotlib_figure_to_array/"/>
    <url>/2020/11/06/python/convert_matplotlib_figure_to_array/convert_matplotlib_figure_to_array/</url>
    
    <content type="html"><![CDATA[<blockquote><p>matplotlib是python图像处理中让人又爱又恨的库。最近遇到了需要获取plt图像数据的需求，本文记录了将matplotlib图像转换为numpy.array 或 PIL.Image的方法。</p></blockquote><span id="more"></span><blockquote><p>众所周知，这个库处理图像会出现内存泄漏的问题，原想着将plt的图转出来用opencv存就好了，然而并没有，牢骚完毕。</p></blockquote><h3 id="转换思路"><a href="#转换思路" class="headerlink" title="转换思路"></a>转换思路</h3><blockquote><p>总体分为两步完成目标：</p></blockquote><ul><li>将plt或fig对象转为argb string的对象</li><li>将argb string对象图像转为array 或 Image</li></ul><h3 id="步骤一"><a href="#步骤一" class="headerlink" title="步骤一"></a>步骤一</h3><blockquote><p>区分对象为plt和fig的情况，具体使用哪种根据对象类型确定</p></blockquote><h4 id="转换plt对象为argb-string编码对象"><a href="#转换plt对象为argb-string编码对象" class="headerlink" title="转换plt对象为argb string编码对象"></a>转换plt对象为argb string编码对象</h4><blockquote><p>代码在plt对象中构建了图像内容，生成了plt图像，但还没有savefig 和 show：</p><p>例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">plt.figure()<br>plt.imshow(img)<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 引入 FigureCanvasAgg</span><br><span class="hljs-keyword">from</span> matplotlib.backends.backend_agg <span class="hljs-keyword">import</span> FigureCanvasAgg<br><span class="hljs-comment"># 引入 Image</span><br><span class="hljs-keyword">import</span> PIL.Image <span class="hljs-keyword">as</span> Image<br><span class="hljs-comment"># 将plt转化为numpy数据</span><br>canvas = FigureCanvasAgg(plt.gcf())<br><span class="hljs-comment"># 绘制图像</span><br>canvas.draw()<br><span class="hljs-comment"># 获取图像尺寸</span><br>w, h = canvas.get_width_height()<br><span class="hljs-comment"># 解码string 得到argb图像</span><br>buf = np.fromstring(canvas.tostring_argb(), dtype=np.uint8)<br></code></pre></td></tr></table></figure><h4 id="转换fig对象为argb-string编码对象"><a href="#转换fig对象为argb-string编码对象" class="headerlink" title="转换fig对象为argb string编码对象"></a>转换fig对象为argb string编码对象</h4><blockquote><p>以 matplotlab 的 fig 对象为目标，获取 argb string编码图像</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 引入 Image</span><br><span class="hljs-keyword">import</span> PIL.Image <span class="hljs-keyword">as</span> Image<br><span class="hljs-comment"># 绘制图像</span><br>fig.canvas.draw()<br><span class="hljs-comment"># 获取图像尺寸</span><br>w, h = fig.canvas.get_width_height()<br><span class="hljs-comment"># 获取 argb 图像</span><br>buf = np.fromstring(fig.canvas.tostring_argb(), dtype=np.uint8)<br></code></pre></td></tr></table></figure><h3 id="步骤二"><a href="#步骤二" class="headerlink" title="步骤二"></a>步骤二</h3><h4 id="转换argb-string编码对象为PIL-Image或numpy-array图像"><a href="#转换argb-string编码对象为PIL-Image或numpy-array图像" class="headerlink" title="转换argb string编码对象为PIL.Image或numpy.array图像"></a>转换argb string编码对象为PIL.Image或numpy.array图像</h4><blockquote><p>此时的argb string不是我们常见的uint8 w h rgb的图像，还需要进一步转化</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 重构成w h 4(argb)图像</span><br>buf.shape = (w, h, <span class="hljs-number">4</span>)<br><span class="hljs-comment"># 转换为 RGBA</span><br>buf = np.roll(buf, <span class="hljs-number">3</span>, axis=<span class="hljs-number">2</span>)<br><span class="hljs-comment"># 得到 Image RGBA图像对象 (需要Image对象的同学到此为止就可以了)</span><br>image = Image.frombytes(<span class="hljs-string">&quot;RGBA&quot;</span>, (w, h), buf.tostring())<br><span class="hljs-comment"># 转换为numpy array rgba四通道数组</span><br>image = np.asarray(image)<br><span class="hljs-comment"># 转换为rgb图像</span><br>rgb_image = image[:, :, :<span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/aa846555831/article/details/52372884">https://blog.csdn.net/aa846555831/article/details/52372884</a></li><li><a href="https://blog.csdn.net/jpc20144055069/article/details/106628889">https://blog.csdn.net/jpc20144055069/article/details/106628889</a></li><li><a href="https://blog.csdn.net/aa846555831/article/details/52372884">https://blog.csdn.net/aa846555831/article/details/52372884</a></li><li><a href="https://blog.csdn.net/jpc20144055069/article/details/106628889">https://blog.csdn.net/jpc20144055069/article/details/106628889</a></li><li><a href="https://blog.csdn.net/guyuealian/article/details/104179723">https://blog.csdn.net/guyuealian/article/details/104179723</a></li><li><a href="https://blog.csdn.net/qq_33883462/article/details/81050795">https://blog.csdn.net/qq_33883462/article/details/81050795</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 pynvml 报错 NVML Shared Library Not Found / WinError 126</title>
    <link href="/2020/11/06/deep_learning/pynvml_model_not_found/pynvml_model_not_found/"/>
    <url>/2020/11/06/deep_learning/pynvml_model_not_found/pynvml_model_not_found/</url>
    
    <content type="html"><![CDATA[<blockquote><p>pynvml包直接在Windows系统上安装可能会报出模块找不到的错误，本文记录解决方法。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>在Windows中调用 <code>pynvml.nvmlInit()</code>时出错：</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201106155637.png"></p><blockquote><p>错误信息：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"> File <span class="hljs-string">&quot;E:\Program_Files\Annoconda\lib\site-packages\pynvml\nvml.py&quot;</span>, line <span class="hljs-number">731</span>, <span class="hljs-keyword">in</span> _load_nvml_library<br>    nvml_lib = CDLL(os.path.join(os.getenv(<span class="hljs-string">&quot;ProgramFiles&quot;</span>, <span class="hljs-string">&quot;C:/Program Files&quot;</span>), <span class="hljs-string">&quot;NVIDIA Corporation/NVSMI/nvml.dll&quot;</span>))<br>  File <span class="hljs-string">&quot;E:\Program_Files\Annoconda\lib\ctypes\__init__.py&quot;</span>, line <span class="hljs-number">356</span>, <span class="hljs-keyword">in</span> __init__<br>    self._handle = _dlopen(self._name, mode)<br>OSError: [WinError <span class="hljs-number">126</span>] 找不到指定的模块。<br></code></pre></td></tr></table></figure><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><ul><li>在源代码文件 numl.py 中 731 行附近：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> (sys.platform[:<span class="hljs-number">3</span>] == <span class="hljs-string">&quot;win&quot;</span>):<br>    <span class="hljs-comment"># cdecl calling convention</span><br>    <span class="hljs-comment"># load nvml.dll from %ProgramFiles%/NVIDIA Corporation/NVSMI/nvml.dll</span><br>    nvml_lib = CDLL(os.path.join(os.getenv(<span class="hljs-string">&quot;ProgramFiles&quot;</span>, <span class="hljs-string">&quot;C:/Program Files&quot;</span>), <span class="hljs-string">&quot;NVIDIA Corporation/NVSMI/nvml.dll&quot;</span>))<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-comment"># assume linux</span><br>    nvml_lib = CDLL(<span class="hljs-string">&quot;libnvidia-ml.so.1&quot;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>可以看到模块在尝试寻找 <code>C:/Program Files/NVIDIA Corporation/NVSMI/nvml.dll</code> 文件，如果你的<code>nvml.dll</code>文件不在这就会报错。</p></blockquote><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><blockquote><p>知道问题的原因，排除故障有两种方案，但都需要知道当前的<code>nvml.dll</code>文件在哪。</p></blockquote><h5 id="确定-nvidia-smi-exe-位置"><a href="#确定-nvidia-smi-exe-位置" class="headerlink" title="确定 nvidia-smi.exe 位置"></a>确定 nvidia-smi.exe 位置</h5><ul><li>打开cmd，输入命令：</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">where</span> nvidia-smi<br></code></pre></td></tr></table></figure><blockquote><p>会返回当前系统的 nvidia-smi.exe的位置 （前提是当前cuda安装正常，可以使用nvidia-smi）</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201106161405.png"></p><ul><li>去相应位置查看，发现<code>nvml.dll</code>文件和他在一起，所以只要将代码中路径指向它就行了。</li></ul><h4 id="方案1：-修改源码："><a href="#方案1：-修改源码：" class="headerlink" title="方案1： 修改源码："></a>方案1： 修改源码：</h4><ul><li>修改<code>numl.py</code> 中第 731 行代码：</li></ul><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">nvml_lib = <span class="hljs-constructor">CDLL(<span class="hljs-params">os</span>.<span class="hljs-params">path</span>.<span class="hljs-params">join</span>(<span class="hljs-params">os</span>.<span class="hljs-params">getenv</span>(<span class="hljs-string">&quot;ProgramFiles&quot;</span>, <span class="hljs-string">&quot;C:/Program Files&quot;</span>)</span>, <span class="hljs-string">&quot;NVIDIA Corporation/NVSMI/nvml.dll&quot;</span>))<br></code></pre></td></tr></table></figure><p>改为你自己的路径：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">nvml_lib = CDLL(<span class="hljs-string">r&quot;C:\Windows\System32\nvml.dll&quot;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>注意反斜杠路径需要在前面加 <code>r</code></p></blockquote><h4 id="方案2：-为源码创建运行环境"><a href="#方案2：-为源码创建运行环境" class="headerlink" title="方案2： 为源码创建运行环境"></a>方案2： 为源码创建运行环境</h4><ul><li><p>源码不会出错，错的是我们自己的环境，改过来就是了。</p></li><li><p>创建文件夹<code>C:\Program Files\NVIDIA Corporation\NVSMI</code></p></li><li><p>将<code>nvml.dll</code>文件放在文件夹里</p></li></ul><h4 id="运行示例"><a href="#运行示例" class="headerlink" title="运行示例"></a>运行示例</h4><p><img src="https://photos.zywvvd.com/images_matrixtime/20201106162159.png"></p><h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><ul><li><a href="https://blog.csdn.net/com_fang_bean/article/details/107988018">https://blog.csdn.net/com_fang_bean/article/details/107988018</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>GPU</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>深度学习</tag>
      
      <tag>GPU</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python 使用 pynvml 工具获取GPU工作状态</title>
    <link href="/2020/11/06/deep_learning/pynvml_gpu_info_get/pynvml_gpu_info_get/"/>
    <url>/2020/11/06/deep_learning/pynvml_gpu_info_get/pynvml_gpu_info_get/</url>
    
    <content type="html"><![CDATA[<blockquote><p>深度学习过程中经常需要和GPU打交道，需要在训练之前确定GPU工作状态。本文介绍python中的pynvml包的使用方法，用来获取上述信息。</p></blockquote><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><blockquote><p>直接通过pip安装：</p></blockquote><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> nvidia-ml-py<br></code></pre></td></tr></table></figure><blockquote><p>或者根据所使用的python版本安装对应包：</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pip</span> install nvidia-ml-py<span class="hljs-number">2</span>  # python<span class="hljs-number">2</span><br><span class="hljs-attribute">pip</span> install nvidia-ml-py<span class="hljs-number">3</span>  # python<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 导入包</span><br><span class="hljs-keyword">import</span> pynvml <br><span class="hljs-comment"># 每MB包含的字节数</span><br>NUM_EXPAND = <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span><br><span class="hljs-comment"># 初始化</span><br>pynvml.nvmlInit()<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#GPU驱动信息</span><br>pynvml.nvmlSystemGetDriverVersion()<br>-&gt; <span class="hljs-string">b&#x27;441.22&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取Nvidia GPU块数</span><br>pynvml.nvmlDeviceGetCount()<br>-&gt; <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取GPU 0 的handle</span><br>handle = pynvml.nvmlDeviceGetHandleByIndex(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 设备名称</span><br>pynvml.nvmlDeviceGetName(handle)<br>-&gt; <span class="hljs-string">b&#x27;GeForce GTX 1660&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#通过handle获取GPU 0 的信息</span><br>info = pynvml.nvmlDeviceGetMemoryInfo(handle)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#GPU 0 的总显存</span><br>info.total <br>-&gt; <span class="hljs-number">6442450944</span><br>info.total / NUM_EXPAND<br>-&gt; <span class="hljs-number">6144.0</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#GPU 0 使用的显存</span><br>info.used<br>-&gt; <span class="hljs-number">383299584</span><br>info.used / NUM_EXPAND<br>-&gt; <span class="hljs-number">365.54296875</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#关闭 pynvml</span><br>pynvml.nvmlShutdown() <br></code></pre></td></tr></table></figure><h3 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h3><ul><li>报错 ： pynvml.NVMLError_LibraryNotFound: NVML Shared Library Not Found</li></ul><blockquote><p>坑已填：<a href="https://www.zywvvd.com/2020/11/06/deep_learning/pynvml_model_not_found/pynvml_model_not_found/">解决 pynvml 报错 NVML Shared Library Not Found / WinError 126</a></p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="http://www.ngui.cc/51cto/show-33630.html">http://www.ngui.cc/51cto/show-33630.html</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>GPU</category>
      
    </categories>
    
    
    <tags>
      
      <tag>深度学习</tag>
      
      <tag>GPU</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 VS code 不报错不输出的问题</title>
    <link href="/2020/11/02/software/ide/vs_code_no_print_content/vs_code_no_print_content/"/>
    <url>/2020/11/02/software/ide/vs_code_no_print_content/vs_code_no_print_content/</url>
    
    <content type="html"><![CDATA[<blockquote><p>VS code 是微软的轻量级但功能强大的IDE，刚刚配置好anaconda python环境时可能出现不打印print内容的问题，本文记录该问题解决方法。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><ul><li>刚刚安装好VS code 与 Anaconda时，hello world程序不在终端显示打印内容：</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20201102234922.png"></p><blockquote><p>不显示打印内容。</p></blockquote><h3 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h3><ul><li>故障原因在于命令中默认使用的是 anaconda 的<code>pythonw.exe</code>命令，将其换为<code>python.exe即可。</code></li></ul><h3 id="修改方法"><a href="#修改方法" class="headerlink" title="修改方法"></a>修改方法</h3><ul><li>文件-首选项-设置-打开设置：</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20201102235621.png"></p><ul><li>修改”python.pythonPath”：</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs swift">&#123;<br>    <span class="hljs-string">&quot;python.pythonPath&quot;</span>: <span class="hljs-string">&quot;E:<span class="hljs-subst">\\</span>ProgramData<span class="hljs-subst">\\</span>Anaconda3<span class="hljs-subst">\\</span>pythonw.exe&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>改为</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs swift">&#123;<br>    <span class="hljs-string">&quot;python.pythonPath&quot;</span>: <span class="hljs-string">&quot;E:<span class="hljs-subst">\\</span>ProgramData<span class="hljs-subst">\\</span>Anaconda3<span class="hljs-subst">\\</span>python.exe&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><ul><li>程序运行时调用<code>python.exe</code>，而且输出正常。</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20201102235748.png"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>VS code</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>IDE</tag>
      
      <tag>VS code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python 补全利器 Kite 安装</title>
    <link href="/2020/11/02/software/ide/vs_code_kite_install/kite_install/"/>
    <url>/2020/11/02/software/ide/vs_code_kite_install/kite_install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Kite 是针对 Python 的代码补全工具 ，由于其快速智能（AI学习）被圈内广泛使用，本文介绍Kite在Windows 与 Linux环境下与VS code结合使用的方法。</p></blockquote><span id="more"></span><p>官网：<a href="https://www.kite.com/">https://www.kite.com/</a></p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul><li><a href="https://www.kite.com/download/">https://www.kite.com/download/</a></li></ul><blockquote><p>直接安装下载的 KiteSetup.exe 即可。</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201029095905.png"></p><h4 id="在-VS-code-中使用-kite"><a href="#在-VS-code-中使用-kite" class="headerlink" title="在 VS code 中使用 kite"></a>在 VS code 中使用 kite</h4><blockquote><p>安装插件 Kite AI Code AutoComplete</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201029100241.png"></p><blockquote><p>随后可以跟着自动弹出的教程学习使用方法。</p></blockquote><blockquote><p>事实上写代码时仅需关注右下角是否开启了Kite即可：</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201029100608.png"></p><blockquote><p>此时写Python代码会有kite 的自动补全：</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201029101019.png"></p><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><ul><li><a href="https://www.kite.com/download/?loc=top_nav#">https://www.kite.com/download/?loc=top_nav#</a></li></ul><p>运行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c <span class="hljs-string">&quot;<span class="hljs-subst">$(wget -q -O - https://linux.kite.com/dls/linux/current)</span>&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>网上有教程说不能使用root用户安装，我在docker中的情况时只能使用root用户安装。</p><p>随后VS code 远程调试代码时即可使用kite自动补全。</p></blockquote><h3 id="吐槽"><a href="#吐槽" class="headerlink" title="吐槽"></a>吐槽</h3><ul><li>得说明的是现在的Kite已经收费了</li><li>不交费的话每日有使用上限，反正我大概打开IDE一两分钟就会用完</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>VS code</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDE</tag>
      
      <tag>VS code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VS code 远程调试配置</title>
    <link href="/2020/11/02/software/ide/vs_code_remote_debugging/vs_code_remote_debugging/"/>
    <url>/2020/11/02/software/ide/vs_code_remote_debugging/vs_code_remote_debugging/</url>
    
    <content type="html"><![CDATA[<blockquote><p>VS code 是微软的轻量级但功能强大的IDE，可扩展的插件众多，基本可以满足所有开发需求。本文介绍使用VS code进行远程调试代码的方法。</p></blockquote><span id="more"></span><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li>Win 10 x64 操作系统</li><li>安装 VS code</li><li>远程 Linux 服务器</li><li><a href="https://www.zywvvd.com/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/">成功配置ssh登录服务器（或docker容器）</a></li></ul><h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><ul><li><p>安装 Remote Development 插件</p><blockquote><p>会自动安装 Remote-WSL / Containers / SSH 等插件。</p></blockquote></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201028143530.png"></p><h3 id="配置主机信息"><a href="#配置主机信息" class="headerlink" title="配置主机信息"></a>配置主机信息</h3><blockquote><p>ctrl + shift + p</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201028174129.png"></p><p><img src="https://photos.zywvvd.com/images_matrixtime/20201028175152.png"></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Host alias<br>    HostName <span class="hljs-number">192.168</span>.<span class="hljs-number">10.12</span><br>    Port <span class="hljs-number">3721</span><br>    <span class="hljs-keyword">User</span> <span class="hljs-title">root</span><br>    IdentityFile ~\.ssh\id_rsa<br>    IdentitiesOnly yes<br></code></pre></td></tr></table></figure><h3 id="vs-code-连接远程主机"><a href="#vs-code-连接远程主机" class="headerlink" title="vs code 连接远程主机"></a>vs code 连接远程主机</h3><p><img src="https://photos.zywvvd.com/images_matrixtime/20201028175324.png"></p><blockquote><p>之后选择目标主机的操作系统。</p></blockquote><ul><li>成功连接到远程主机：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201102202219.png"></p><ul><li>打开文件夹运行程序时，选择使用的Python环境：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201102202420.png"></p><ul><li>插入断点调试程序，与本机无异：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201102202548.png"></p><h3 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h3><h4 id="如果报错：Bad-owner-or-permissions-on-C-Users-Admin-ssh-config"><a href="#如果报错：Bad-owner-or-permissions-on-C-Users-Admin-ssh-config" class="headerlink" title="如果报错：Bad owner or permissions on C:\Users\Admin/.ssh/config"></a>如果报错：Bad owner or permissions on C:\Users\Admin/.ssh/config</h4><blockquote><p>解决方案参考： <a href="https://zixizixi.cn/windows_vscode_ssh_error_bad-owner-or-permissions">https://zixizixi.cn/windows_vscode_ssh_error_bad-owner-or-permissions</a></p></blockquote><p>原因：在 Windows 系统下的 VSCode 安装 Remote - SSH 扩展后，使用扩展配置 SSH 并进行远程连接，可能会发生 Bad owner or permissions on C:\Users\Administrator/.ssh/config 错误，造成无法进行 SSH 远程连接的问题。</p><p>原因是由于使用 Remote - SSH 扩展所依赖的 Remote - SSH: Editing Configuration Files 扩展编辑了 C:\Users\Administrator.ssh\config 文件后，此文件的权限发生了改变。</p><p>这之后不但在 VSCode 中由于配置文件权限问题而无法进行 SSH 远程连接，就连使用系统的 PowerShell 进行 SSH 连接时也会报此错误，而把此配置文件删除后，使用  PowerShell 即可正常进行远程连接。但 VSCode 的 SSH 连接又依赖此配置文件，所以就产生了冲突，要么只有 PowerShell 能用，要么就都不能用。</p><h4 id="解决方案-一"><a href="#解决方案-一" class="headerlink" title="解决方案 一"></a>解决方案 一</h4><ul><li><p>下载 openssh-portable项目：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/PowerShell/</span>openssh-portable.git<br></code></pre></td></tr></table></figure><p>加速链接：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">git</span>@git.zhlh6.cn:PowerShell/openssh-portable.git<br></code></pre></td></tr></table></figure></li><li><p>进入项目中的 <code>contrib\win32\openssh</code> 目录中，在该目录使用<strong>管理员权限</strong>打开powershell窗口,执行:</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">.\<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FixUserFilePermissions</span>.</span></span>ps1 -Confirm:$<span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><p>执行此命令时若提示 无法加载文件 FixUserFil ePermissions.ps1，因为在此系统上禁止运行脚本 错误，则先执行以下命令，然后输入 Y 回车确认后再重新执行（执行完毕后可以再执行以下命令输入 N 恢复默认配置）：</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">Set</span>-ExecutionPolicy <span class="hljs-comment">RemoteSigned</span><br></code></pre></td></tr></table></figure></li><li><p>随后在powershell与vs code远程过程中都不会再出现上述错误.</p></li></ul><h4 id="解决方案-二"><a href="#解决方案-二" class="headerlink" title="解决方案 二"></a>解决方案 二</h4><blockquote><p>将config绝对路径填在SSH设置里：</p></blockquote><ul><li><img src="https://photos.zywvvd.com/images_matrixtime/20201028180850.png"></li></ul><h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><ul><li><p><a href="https://www.jb51.net/article/184071.htm">https://www.jb51.net/article/184071.htm</a></p></li><li><p><a href="https://segmentfault.com/a/1190000019550872">https://segmentfault.com/a/1190000019550872</a></p></li><li><p><a href="https://blog.csdn.net/u011436427/article/details/102981641">https://blog.csdn.net/u011436427/article/details/102981641</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>VS code</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDE</tag>
      
      <tag>VS code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows 远程登录 Linux 服务器 docker 容器</title>
    <link href="/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/"/>
    <url>/2020/11/02/windows/win_ssh_linux_docker/win_ssh_linux_docker/</url>
    
    <content type="html"><![CDATA[<blockquote><p> ssh是较可靠，专为远程登录会话和其他网络服务提供安全性的协议，广泛用于远程登录的场景，也是远程调试代码的神兵利器。在开发中经常会在服务器启动自己的 docker 容器进行开发，又需要调试代码，vim的调试环境配置起来门槛又太高。于是就有了使用Windows直接ssh打通docker进行调试的需求。本文记录Windows远程登录Linux服务器docker容器的方法。</p></blockquote><span id="more"></span><h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><ul><li>登录主机操作系统 Win 10</li><li>被登录主机操作系统 docker container in Linux</li><li>主机与被登录主机（此处指服务器，不是docker）网络联通，IP在同一网段</li><li>服务器与docker的IP在同一网段</li></ul><h2 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h2><h3 id="建立docker与Linux服务器的端口映射"><a href="#建立docker与Linux服务器的端口映射" class="headerlink" title="建立docker与Linux服务器的端口映射"></a>建立docker与Linux服务器的端口映射</h3><blockquote><p>ssh协议链接时默认使用22端口，Windows与docker的端口往往不能直接进行映射（很可能不在一个网段），因此需要将docker的22端口映射到Linux服务器的某个端口，此时需要在建立docker容器时进行<a href="https://www.zywvvd.com/2020/05/14/coding/environment/wingide-remote-docker/wingide-remote-docker/#docker%E9%85%8D%E7%BD%AE">配置</a>：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker run -it --name vvd -p 3721:22 -v /root/tmp:/root/tmp my_docker bash</span><br></code></pre></td></tr></table></figure><ul><li>其中 <code>-p</code> 的部分表示将本机（服务器）的3721端口映射到容器的22端口。</li></ul><h3 id="容器内部安装ssh服务"><a href="#容器内部安装ssh服务" class="headerlink" title="容器内部安装ssh服务"></a>容器内部安装ssh服务</h3><blockquote><p>需要在被登录的容器内部建立并启动ssh服务。</p></blockquote><ul><li>首先需要安装：</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> update<br>apt-<span class="hljs-builtin-name">get</span> install openssh-server<br>apt-<span class="hljs-builtin-name">get</span> install openssh-client<br></code></pre></td></tr></table></figure><ul><li>安装完成后需要容器每次启动时自动运行相关服务，可以在 <code>~/.bashrc</code>中加入：</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/etc/i</span>nit.d/ssh start<br></code></pre></td></tr></table></figure><blockquote><p>这样就保证了docker容器自动启动该服务。</p></blockquote><ul><li>查看ssh运行状态</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/etc/i</span>nit.d/ssh status<br></code></pre></td></tr></table></figure><blockquote><p>如果是 <code> * sshd is running</code> 说明ssh正常运行</p></blockquote><h3 id="修改容器内root用户登录设置"><a href="#修改容器内root用户登录设置" class="headerlink" title="修改容器内root用户登录设置"></a>修改容器内root用户登录设置</h3><blockquote><p>有的容器默认不支持root用户远程使用ssh协议进行密码登录的，此时需要更改设置。</p></blockquote><ul><li>打开 <code>/etc/ssh/sshd_config</code>文件：</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释</span><br><span class="hljs-attribute">RSAAuthentication</span> <span class="hljs-literal">yes</span> <span class="hljs-comment">#启用 RSA 认证</span><br>PubkeyAuthentication <span class="hljs-literal">yes</span> <span class="hljs-comment">#启用公钥私钥配对认证方式</span><br>PermitRootLogin <span class="hljs-literal">yes</span> <span class="hljs-comment">#允许root用户使用ssh登录</span><br></code></pre></td></tr></table></figure><ul><li>将 <code>PermitRootLogin</code> 设置为 yes</li></ul><h3 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h3><blockquote><p>远程登录时需要使用系统的用户密码，我们就直接使用root用户登录好了，需要设置新建容器的密码：</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">passwd root</span><br></code></pre></td></tr></table></figure><h3 id="设置SSH"><a href="#设置SSH" class="headerlink" title="设置SSH"></a>设置SSH</h3><ul><li><p><a href="https://www.zywvvd.com/2020/02/23/git/link_github/Git-connect-remote-pos/#%E5%88%9B%E5%BB%BASSH%E5%AF%86%E9%92%A5">本地生成ssh key</a></p></li><li><p>将.pub 内容复制粘贴加入到远程 ~/.ssh/authorized_keys</p></li></ul><h3 id="SSH连接服务器"><a href="#SSH连接服务器" class="headerlink" title="SSH连接服务器"></a>SSH连接服务器</h3><blockquote><p>需要用户名（被登录端用户）与被登录的主机ip和端口号</p><p>例如： 用户名- root   ip：192.168.10.12  端口映射为 3721</p></blockquote><ul><li>linux</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ssh</span> root@<span class="hljs-number">192.168.10.12:3721</span><br></code></pre></td></tr></table></figure><ul><li>Windows</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ssh</span> -p <span class="hljs-number">3721</span> root@<span class="hljs-number">192.168.10.12</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/images_matrixtime/20201102200256.png"></p><ul><li>如果不清楚Linux系统端口映射配置情况：</li></ul><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">iptables -<span class="hljs-built_in">t</span> nat -L -<span class="hljs-built_in">n</span><br></code></pre></td></tr></table></figure><h3 id="X-shell配置"><a href="#X-shell配置" class="headerlink" title="X-shell配置"></a>X-shell配置</h3><blockquote><p>命令行ssh登录成功后就可以在X-shell中建立配置信息方便地连接了。</p></blockquote><ul><li>新建会话，填写名称、IP、端口号（我们刚刚配置过的）：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201102200522.png"></p><ul><li>用户身份认证，填入用户名密码（刚刚配置过的）：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201102200640.png"></p><ul><li>随后就可以使用该会话直接登录docker容器了，为远程调试打下了坚实的基础：</li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201102200804.png"></p><h3 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h3><ul><li><p>ssh: Could not resolve hostname 192.168.10.12:3721: Name or service not known</p><blockquote><p>这是在Windows中使用了Linux格式的SSH登录命令导致的解析错误</p><p>将命令语法更换为Windows的格式即可</p></blockquote></li><li><p>root 用户无论如何密码不被接受</p><blockquote><p>需要在被登录主机 /etc/ssh/sshd_config 中设置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment"># PermitRootLogin prohibit-password # 默认打开 禁止root用户使用密码登陆，需要将其注释</span><br><span class="hljs-attribute">RSAAuthentication</span> <span class="hljs-literal">yes</span> <span class="hljs-comment">#启用 RSA 认证</span><br>PubkeyAuthentication <span class="hljs-literal">yes</span> <span class="hljs-comment">#启用公钥私钥配对认证方式</span><br>PermitRootLogin <span class="hljs-literal">yes</span> <span class="hljs-comment">#允许root用户使用ssh登录</span><br></code></pre></td></tr></table></figure><ul><li>重点：<strong>PermitRootLogin yes</strong></li></ul></blockquote></li><li><p>Connection to 192.168.10.12 closed. </p></li><li><p>或</p></li><li><p>Connection closed by foreign host.</p><blockquote><p>意思是 断开主机链接了，出现这种问题，跟你的IPTABLES，防火墙什么的都没关系。</p><p>造成这个原 因是因为原来连接到SSHD服务器进程的22端口，当你的客户端突然断开时，服务器端的TCP连接就处于一个半打开状态。当下一次同一客户机再次建立 TCP连接时，服务器检测到这个半打开的TCP连接，并向客户机回传一个置位RST的TCP报文，客户机就会显示connection closed by foreign host。<br>这是TCP协议本身的一个保护措施，并不是什么错误，你只要再重新连接服务器就能连上。</p><p>———   <a href="http://www.pooy.net/connection-closed-foreign-host.html">http://www.pooy.net/connection-closed-foreign-host.html</a></p><p>总结一下解决方案： <strong>关机重启</strong></p></blockquote></li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://blog.csdn.net/hanchaobiao/article/details/84069299">https://blog.csdn.net/hanchaobiao/article/details/84069299</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
      <category>Windows 10</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Windows 10</tag>
      
      <tag>软件</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git - 解决Github仓库下载缓慢的问题</title>
    <link href="/2020/10/29/git/github_download/github_download/"/>
    <url>/2020/10/29/git/github_download/github_download/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Github仓库在国内下载慢，而且经常失败。该问题有几种解决方案：1、科学上网 2、使用镜像。 科学上网暂且不谈，镜像加速可以使用码云的github代码转存功能，但是该方法比较麻烦，还得转存一次。本文介绍使用Chrome浏览器插件进行加速的镜像方案。</p></blockquote><span id="more"></span><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li><p>使用 google 浏览器 chrome</p></li><li><p>进入chrome应用商店</p><p><a href="https://chrome.google.com/webstore">https://chrome.google.com/webstore</a></p></li><li><p>搜索 <code>gitHub 加速</code>：</p><p><img src="https://photos.zywvvd.com/images_matrixtime/20201028171530.png"></p></li><li><p>安装 github 加速插件</p></li><li><p>此时重新打开之前下不来的GitHub页面：</p></li></ul><p><img src="https://photos.zywvvd.com/images_matrixtime/20201028171703.png"></p><ul><li>可以使用镜像地址下载仓库，速度与之前不可同日而语。</li></ul><blockquote><p>终于痛快了 。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git - reset, checkout, revert 总结</title>
    <link href="/2020/10/17/git/git_get_back/git-get-back/"/>
    <url>/2020/10/17/git/git_get_back/git-get-back/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在git版本管理中，经常有将其他提交与当前代码环境内容交互的需求，其中<code>git reset</code>、<code>git checkout</code>和<code>git revert</code>是与此类需求有关的一些命令，它们可以用来调整代码仓库中的某些更改；而且<code>git reset</code>和<code>git checkout</code>两个命令不仅可以作用于提交，还可以作用于特定文件，本文介绍上述三个命令的区别与工作原理。</p></blockquote><span id="more"></span><h2 id="git-基础内容"><a href="#git-基础内容" class="headerlink" title="git 基础内容"></a>git 基础内容</h2><blockquote><p>git 相关基础概念与常用命令使用方法在 <a href="https://www.zywvvd.com/2020/05/06/git/git_usage/git-usage/">Git - 使用教程</a> 中有介绍，本文在此基础上进行展开。</p></blockquote><h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>这三个命令可以作用于<strong>提交</strong>和<strong>文件</strong>：</p><table><thead><tr><th align="center">命令</th><th align="center">可用于提交</th><th align="center">可用于文件</th></tr></thead><tbody><tr><td align="center">git reset</td><td align="center">√</td><td align="center">√</td></tr><tr><td align="center">git checkout</td><td align="center">√</td><td align="center">√</td></tr><tr><td align="center">git revert</td><td align="center">√</td><td align="center">×</td></tr></tbody></table><blockquote><p>下面从这两个作用域的角度分别介绍相关命令的功能。</p></blockquote><h3 id="作用于提交"><a href="#作用于提交" class="headerlink" title="作用于提交"></a>作用于提交</h3><blockquote><p>三个命令常用的用法均为回退，但是三个命令的实现细节事实上有很大的区别。</p></blockquote><h4 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h4><ul><li><p>工作原理：</p><p>当 reset 的作用对象为提交时，reset将一个分支的末端指向另一个提交。</p><ul><li><p>通过传入这些标记来修改你的缓存区或工作目录：</p><p>–soft – 缓存区和工作目录都不会被改变</p><p>–mixed (默认选项) 缓存区和你指定的提交同步，但工作目录不受影响</p><p>–hard – 缓存区和工作目录都同步到你指定的提交</p></li></ul></li><li><p>实例应用：</p> <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> reset HEAD~<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>  把当前分支reset到HEAD~2。</p> <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--mixed HEAD</span><br></code></pre></td></tr></table></figure><p>  将当前的改动从缓存区中移除，但是这些改动还留在工作目录中。</p> <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard HEAD</span><br></code></pre></td></tr></table></figure><p>  完全舍弃还没有提交的改动</p></li></ul><h4 id="checkout"><a href="#checkout" class="headerlink" title="checkout"></a>checkout</h4><ul><li><p>工作原理：</p><p>checkout命令以提交为参数时，将当前工作区、暂存区、仓库均切换到目标提交时的状态。</p></li><li><p>实例应用：</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git checkout <span class="hljs-tag">&lt;<span class="hljs-name">branch</span>&gt;</span><br></code></pre></td></tr></table></figure><p>  切换到指定分支</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git checkout <span class="hljs-tag">&lt;<span class="hljs-name">commit</span>&gt;</span><br></code></pre></td></tr></table></figure><p>  切换到指定提交</p></li></ul><h4 id="revert"><a href="#revert" class="headerlink" title="revert"></a>revert</h4><ul><li><p>工作原理：</p><p>通过创建一次新的 <code>commit</code> 来撤销一次 <code>commit</code> 所做出的修改。这种撤销的方式是安全的，因为它并不修改 <code>commitm history</code>。</p></li><li><p>实例应用：</p> <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> revert HEAD~<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>  将会查出倒数第二次（即当前commit的往前一次）提交的修改，并创建一个新的提交，用于撤销当前提交的上一次 <code>commit</code>。</p></li></ul><h3 id="作用于文件"><a href="#作用于文件" class="headerlink" title="作用于文件"></a>作用于文件</h3><h4 id="git-reset-1"><a href="#git-reset-1" class="headerlink" title="git reset"></a>git reset</h4><ul><li><p>工作原理：</p><p>当检测到文件路径时，<code>git reset</code> 将缓存区同步到指定的提交。</p></li><li><p>实例应用：</p> <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> reset HEAD~<span class="hljs-number">2</span> foo.py<br></code></pre></td></tr></table></figure><p>  将文件 foo.py 在缓冲区的状态更改为HEAD之前2个的提交。</p></li></ul><blockquote><p>注: –soft、–mixed和–hard对文件层面的<code>git reset</code>毫无作用，缓存区中的文件一定会变化，而工作目录中的文件一定不变。</p></blockquote><h4 id="checkout-1"><a href="#checkout-1" class="headerlink" title="checkout"></a>checkout</h4><ul><li><p>工作原理：</p><p>提取某个已经缓存的文件状态（缓存区、提交）用于覆盖当前工作区的文件。</p><p><strong>与reset作用于文件相比，不同的是checkout更改的文件位置为工作区，reset为暂存区</strong>。</p></li><li><p>实例应用：</p> <figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> checkout HEAD~<span class="hljs-number">2</span> foo.py<br></code></pre></td></tr></table></figure><p>  将工作目录中的foo.py同步到了倒数第二个提交中的foo.py。</p> <figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">git checkout <span class="hljs-comment">-- foo.py</span><br></code></pre></td></tr></table></figure><p>  当不指定特定提交时，checkout 优先从暂存区中提取文件副本覆盖工作区文件；当文件没有在暂存区提交过（没有add过）时，从仓库中（当前提交）提取文件副本覆盖工作区文件。</p><p>  也就是说，该命令会提取最近的一次保存的副本覆盖当前工作区的文件。</p></li></ul><h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><ul><li><a href="https://www.cnblogs.com/houpeiyong/p/5890748.html">https://www.cnblogs.com/houpeiyong/p/5890748.html</a></li><li><a href="https://www.jianshu.com/p/285302d1eb73">https://www.jianshu.com/p/285302d1eb73</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Typora 常用快捷键</title>
    <link href="/2020/10/16/software/typora-usage/typora-usage/"/>
    <url>/2020/10/16/software/typora-usage/typora-usage/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Typora常用快捷键。</p></blockquote><span id="more"></span><h3 id="快捷键-（for-Windows）"><a href="#快捷键-（for-Windows）" class="headerlink" title="快捷键 （for Windows）"></a>快捷键 （for Windows）</h3><h4 id="文本编辑快捷键"><a href="#文本编辑快捷键" class="headerlink" title="文本编辑快捷键"></a>文本编辑快捷键</h4><ul><li>无序列表：输入-之后输入空格 / ctrl + shift + ] (对选中行可用)</li><li>有序列表：输入数字 + “.”之后输入空格 / ctrl + shift + [ (对选中行可用)</li><li>引用内容：&gt; + 空格 / ctrl + shift + q (对选中内容可用)</li><li>任务列表：-[空格]空格 文字</li><li>标题：ctrl + 数字</li><li>表格：ctrl + t</li><li>目录：[TOC]</li><li>任务列表：- [ ] 文字（注意 “-” 后与 “[]“ 中间都有空格）</li><li>选中一整行：ctrl + l (字母L)</li><li>选中单词：ctrl + d</li><li>选中相同格式的文字：ctrl + e</li><li>跳转到文章开头：ctrl + home</li><li>跳转到文章结尾：ctrl + end</li><li>搜索：ctrl + f</li><li>替换：ctrl + h</li><li>引用：输入&gt;之后输入空格</li><li>代码块： ctrl + shift + k</li><li>行内代码：ctrl + shift + ` (对选中行可用)</li><li>加粗：ctrl + b</li><li>倾斜：ctrl + i</li><li>下划线：ctrl + u</li><li>删除线：alt + shift + 5</li><li>插入链接：ctrl + k</li><li>插入公式：ctrl + shift + m</li><li>插入图片：ctrl + shift + i</li><li>保存：ctrl + s</li><li>另存为：ctrl + shift + s</li></ul><h4 id="编辑模式快捷键"><a href="#编辑模式快捷键" class="headerlink" title="编辑模式快捷键"></a>编辑模式快捷键</h4><ul><li>源码模式编辑切换：ctrl + /</li><li>打字机模式切换：F9</li><li>专注模式切换：F8</li><li>全屏模式切换：F11</li><li>Typora内部窗口焦点切换：ctrl  + tab</li><li>侧边栏显示/隐藏切换：ctrl + shift + L</li></ul><h3 id="快捷键自定义配置"><a href="#快捷键自定义配置" class="headerlink" title="快捷键自定义配置"></a>快捷键自定义配置</h3><blockquote><p>偏好设置 -&gt; 打开高级设置-&gt;conf.user.json文件</p><p>keyBinding 即为快捷键配置：</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-string">&quot;keyBinding&quot;</span>: &#123;<br>  <span class="hljs-regexp">//</span> <span class="hljs-keyword">for</span> example: <br>  <span class="hljs-string">&quot;Always on Top&quot;</span>: <span class="hljs-string">&quot;Ctrl + Shift + P&quot;</span><br>&#125;,<br></code></pre></td></tr></table></figure><h3 id="表情"><a href="#表情" class="headerlink" title="表情"></a>表情</h3><ul><li>:表情: </li></ul><blockquote><p>例如：输入: + smile + :，注意两边都有:</p><p>:smile:</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Software</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Software</tag>
      
      <tag>Typora</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python 使用 ipdb 调试程序</title>
    <link href="/2020/10/16/python/ipdb-usage/ipdb-usage/"/>
    <url>/2020/10/16/python/ipdb-usage/ipdb-usage/</url>
    
    <content type="html"><![CDATA[<blockquote><p>python 中有在文本环境中为编程者提供的调试工具包ipdb，本文介绍基本使用方法。</p></blockquote><span id="more"></span><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install ipdb<br></code></pre></td></tr></table></figure><h3 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h3><ul><li>引用包：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> ipdb<br></code></pre></td></tr></table></figure><ul><li>插入断点：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ipdb.set_trace()<br></code></pre></td></tr></table></figure><ul><li>程序运行到断点处会自动停下，为调试提供信息：</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">info_to_dict.<span class="hljs-keyword">py</span>(<span class="hljs-number">88</span>)<span class="hljs-symbol">&lt;module&gt;</span>()<br>     <span class="hljs-number">87</span> <br>---&gt; <span class="hljs-number">88</span>     step_length = <span class="hljs-keyword">int</span>(np.<span class="hljs-built_in">ceil</span>(<span class="hljs-built_in">len</span>(record_items_list) / task_num))<br>     <span class="hljs-number">89</span>     current_record_items_list = record_items_list[<span class="hljs-built_in">index</span> * step_length: (<span class="hljs-built_in">index</span> + <span class="hljs-number">1</span>) * step_length]<br><br></code></pre></td></tr></table></figure><blockquote><p>此为某次我的程序调试的信息，</p><p>—&gt; 表示当前程序运行到此处 （第88行）</p></blockquote><h3 id="调试程序"><a href="#调试程序" class="headerlink" title="调试程序"></a>调试程序</h3><blockquote><p>程序运行到断点后，ipdb提供了和ide一样的调试功能，包括变量查看、终端执行命令、步过、步入、继续运行等等。</p></blockquote><table><thead><tr><th align="center">按键 (可以全名， 也可以缩写)</th><th align="center">功能</th></tr></thead><tbody><tr><td align="center">ENTER</td><td align="center">重复上次命令</td></tr><tr><td align="center">c (cont) (continue)</td><td align="center">继续</td></tr><tr><td align="center">l (list)</td><td align="center">可以列出当前将要运行的代码块</td></tr><tr><td align="center">s (step)</td><td align="center">步入</td></tr><tr><td align="center">n (next)</td><td align="center">步过</td></tr><tr><td align="center">r (return)</td><td align="center">运行到程序结束</td></tr><tr><td align="center">!&lt;python 命令&gt;</td><td align="center">执行命令</td></tr><tr><td align="center">h (help)</td><td align="center">帮助</td></tr><tr><td align="center">h + 指令</td><td align="center">显示指令帮助内容</td></tr><tr><td align="center">a (args)</td><td align="center">打印当前函数的参数</td></tr><tr><td align="center">j + 行数</td><td align="center">跳转到指定的行数</td></tr><tr><td align="center">p (print)</td><td align="center">打印变量</td></tr><tr><td align="center">q (quit)</td><td align="center">退出调试</td></tr></tbody></table><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>调试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Parallel 简易安装使用指南</title>
    <link href="/2020/09/04/linux/parallel/usage_of_parallel/"/>
    <url>/2020/09/04/linux/parallel/usage_of_parallel/</url>
    
    <content type="html"><![CDATA[<blockquote><p>GNU Parallel 是一个shell工具，可以在一台或多台计算机上并行执行计算任务。本文介绍Parallel的安装和使用其运行文件中多条指令的方法。</p></blockquote><span id="more"></span><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>ftp.gnu.org<span class="hljs-regexp">/gnu/</span>parallel/parallel-<span class="hljs-number">20190122</span>.tar.bz2<br>tar jxvf parallel-<span class="hljs-number">20190122</span>.tar.bz2<br>cd parallel-<span class="hljs-number">20190122</span><br>./configure<br>make -j <span class="hljs-number">4</span><br>make install<br></code></pre></td></tr></table></figure><h2 id="执行指令"><a href="#执行指令" class="headerlink" title="执行指令"></a>执行指令</h2><h3 id="指令文件用例"><a href="#指令文件用例" class="headerlink" title="指令文件用例"></a>指令文件用例</h3><blockquote><p>test.txt</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> ABC<br><span class="hljs-built_in">echo</span> ABC<br><span class="hljs-built_in">echo</span> ABC<br><span class="hljs-built_in">echo</span> ABC<br><span class="hljs-built_in">echo</span> ABC<br></code></pre></td></tr></table></figure><h3 id="并行执行"><a href="#并行执行" class="headerlink" title="并行执行"></a>并行执行</h3><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">parallel -u &lt; <span class="hljs-keyword">test</span>.txt<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>修改 VS code 中 flake8 单行最长字符数量限制</title>
    <link href="/2020/08/11/software/ide/flake8-max-size/flake8-max-size/"/>
    <url>/2020/08/11/software/ide/flake8-max-size/flake8-max-size/</url>
    
    <content type="html"><![CDATA[<blockquote><p>VS code 带有强大的插件功能，其中有一个叫做flake8的插件可以规范代码，帮助养成良好的编码习惯，但是该规范规定单行最长字符个数76完全不够用，网上的方案统统不灵，为了不被逼疯，记录如下解决方案。</p></blockquote><span id="more"></span><h3 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h3><blockquote><p>网上流行的方案是在VS code配置页中加入flake8的配置信息：</p></blockquote><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-string">&quot;python.linting.flake8Args&quot;</span>: [<span class="hljs-string">&quot;--max-line-length=248&quot;</span>]<span class="hljs-string">`</span><br></code></pre></td></tr></table></figure><blockquote><p>在我的环境里是不灵的。</p></blockquote><h3 id="修改源码"><a href="#修改源码" class="headerlink" title="修改源码"></a>修改源码</h3><p><strong>找到<code>flake8</code>python包的位置，打开 <code>Annoconda\Lib\site-packages\flake8</code>文件夹中的文件：<code>defaults.py</code>，修改：</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">MAX_LINE_LENGTH</span> = <span class="hljs-number">248</span><br></code></pre></td></tr></table></figure><blockquote><p>重启VS code 即可</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>VS code</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDE</tag>
      
      <tag>VS code</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mount 命令(三) —— Linux 挂载 Windows 共享目录</title>
    <link href="/2020/08/09/linux/mount/mount-win-disk/mount-win-disk/"/>
    <url>/2020/08/09/linux/mount/mount-win-disk/mount-win-disk/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在工程中遇到了Linux系统需要挂载Windows目录的需求，本文记录实现方法。</p></blockquote><span id="more"></span><h2 id="Windows-系统设置"><a href="#Windows-系统设置" class="headerlink" title="Windows 系统设置"></a>Windows 系统设置</h2><h3 id="打开SMB服务"><a href="#打开SMB服务" class="headerlink" title="打开SMB服务"></a>打开SMB服务</h3><blockquote><p>打开 <strong>控制面板</strong> -&gt; <strong>程序和功能 -</strong>&gt; <strong>启动SMB 1.0/CIFS文件共享支持</strong> -&gt; <strong>重启计算机</strong></p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20200730104725.png"></p><h3 id="设置共享文件夹"><a href="#设置共享文件夹" class="headerlink" title="设置共享文件夹"></a>设置共享文件夹</h3><blockquote><p><strong>需要共享的文件夹</strong> -&gt; <strong>右键 属性</strong> -&gt; <strong>共享</strong> -&gt; <strong>共享设置</strong> -&gt;<strong>添加Everyone用户</strong> -&gt; <strong>设置需要为该用户开放的权限</strong></p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20200810000517.png"></p><blockquote><p>配置完共享设置后可以在<code>网络</code>中看到自己共享的目录:</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20200810001648.png"></p><blockquote><p>此时在你的windows系统中，该目录网络路径为 <code>\\计算机名\路径名</code>，其他网络中的用户也可以使用该地址访问你共享的内容:</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20200810001842.png"></p><h3 id="设置共享是否需要密码"><a href="#设置共享是否需要密码" class="headerlink" title="设置共享是否需要密码"></a>设置共享是否需要密码</h3><blockquote><p>打开 <strong>控制面板</strong> -&gt; <strong>网络和共享中心 -</strong>&gt; <strong>高级共享设置</strong> -&gt; <strong>所有网络</strong> -&gt; <strong>配置密码保护的共享</strong> 即可</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20200810001014.png"></p><h4 id="报错修复"><a href="#报错修复" class="headerlink" title="报错修复"></a>报错修复</h4><blockquote><p>可能会在挂载时出现错误 <code>mount error(13): Permission denied Refer to the mount.cifs(8) manual page (e.g. man mount.cifs)</code></p></blockquote><ul><li>此时可以尝试取消密码需求（改为无密码保护的共享），看看是否可以挂载成功</li><li>改变本地策略： <ul><li>cmd输入gpedit.msc 进入本地计算机策略</li><li>计算机配置=》Windows设置=》安全设置=》本地策略=》安全选项=》网络访问：本地账户的共享和安全模型</li><li>改为<code>经典</code>即可</li></ul></li></ul><h3 id="防火墙设置"><a href="#防火墙设置" class="headerlink" title="防火墙设置"></a>防火墙设置</h3><blockquote><p>在可以为可用性牺牲安全性的场景中可以关闭防火墙</p></blockquote><ul><li>如果防火墙没有关闭可能报错：</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">mount</span> <span class="hljs-literal">error</span>(<span class="hljs-number">115</span>): Operation now in progress<br></code></pre></td></tr></table></figure><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><ol><li><p>关闭windows防火墙</p></li><li><p>不关闭防火墙。设置防火墙入站规则中，关于文件和打印机共享中关于samba的ip允许设置</p><p>控制面板/系统和安全/Windows防火墙/高级设置/入站规则/文件和打印机共享(SMB-In)公用/属性/作用域/远程IP</p><p>从本地子网改为任何IP</p></li></ol><h2 id="Linux-设置"><a href="#Linux-设置" class="headerlink" title="Linux 设置"></a>Linux 设置</h2><h3 id="安装相关包"><a href="#安装相关包" class="headerlink" title="安装相关包"></a>安装相关包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install nfs-common<br>sudo apt-get install smbfs<br>sudo apt-get install cifs-utils<br></code></pre></td></tr></table></figure><h3 id="执行-mount-命令"><a href="#执行-mount-命令" class="headerlink" title="执行 mount 命令"></a>执行 mount 命令</h3><blockquote><p>mount 前需要手动建立文件夹，命令不会自动创建</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo mount -t cifs -o username=Everyone //10.0.2.19/temp win_disk/</span><br></code></pre></td></tr></table></figure><blockquote><p>注：在Windows的<code>\\计算机名\路径名</code>地址在Linux挂载中不好用，需要将计算机名换为Windows计算机的IP地址。</p></blockquote><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><a href="https://ask.hellobi.com/blog/safa/36652">https://ask.hellobi.com/blog/safa/36652</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 解决 conda activate 报错的问题</title>
    <link href="/2020/07/27/python/conda-activate-error/conda_activate_error/"/>
    <url>/2020/07/27/python/conda-activate-error/conda_activate_error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>有时<code>conda</code>环境路径配置出问题会使<code>conda activate</code>命令失效，只能使用<code>source</code>执行环境激活相关操作，本文记录解决方案。</p></blockquote><span id="more"></span><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><blockquote><p>此时可以使用<code>conda init</code>命令进行复位修复：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda init<br>source ~/anaconda3/etc/profile.d/conda.sh  # 此处使用自己的 anaconda 安装目录<br></code></pre></td></tr></table></figure><blockquote><p>此时会在 ~/.bashrc 文件中加入</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span><br><span class="hljs-comment"># !! Contents within this block are managed by &#x27;conda init&#x27; !!</span><br>__conda_setup=<span class="hljs-string">&quot;<span class="hljs-subst">$(&#x27;/workspace/nfs/anaconda3/bin/conda&#x27; &#x27;shell.bash&#x27; &#x27;hook&#x27; 2&gt; /dev/null)</span>&quot;</span><br><span class="hljs-keyword">if</span> [ $? -eq 0 ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;<span class="hljs-variable">$__conda_setup</span>&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">if</span> [ -f <span class="hljs-string">&quot;/workspace/nfs/anaconda3/etc/profile.d/conda.sh&quot;</span> ]; <span class="hljs-keyword">then</span><br>        . <span class="hljs-string">&quot;/workspace/nfs/anaconda3/etc/profile.d/conda.sh&quot;</span><br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;/workspace/nfs/anaconda3/bin:<span class="hljs-variable">$PATH</span>&quot;</span><br>    <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><blockquote><p>然后<code>conda activate</code>等相关命令就能用了。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>故障排除</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mount 命令(二) —— mount 命令介绍</title>
    <link href="/2020/07/25/linux/mount/mount-disk/mount-disk/"/>
    <url>/2020/07/25/linux/mount/mount-disk/mount-disk/</url>
    
    <content type="html"><![CDATA[<blockquote><p>磁盘挂载可以有效解决数据同步与磁盘空间浪费的问题，而且支持不同操作系统之间挂载操作，核心命令为<code>mount</code>，本文介绍该命令。    </p></blockquote><span id="more"></span><h3 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h3><blockquote><p>挂载常用的命令为<code>mount</code>，其命令格式为：</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">mount</span> [<span class="hljs-type">args</span>] device <span class="hljs-built_in">dir</span><br></code></pre></td></tr></table></figure><blockquote><p>args表示配置参数，其中最常用的为 <code>-t</code>和<code>-o</code>参数：</p></blockquote><p><strong>-t</strong> </p><p>指定文件系统的类型，通常不必指定，mount 会自动选择正确的类型，常用类型有:</p><p><code>iso9660</code>: 光盘或光盘镜像<br><code>msdos</code>: DOS fat16文件系统<br><code>vfat</code>: Windows 9x fat32文件系统<br><code>ntfs</code>: Windows NT ntfs文件系统<br><code>smbfs</code>: Mount Windows文件网络共享<br><code>nfs</code>: UNIX(LINUX) 文件网络共享<br><code>ext2</code>: linux目前常用的文件系统<br><code>auto</code>: 自动检测文件系统<br><code>cifs</code>: 通用Internet文件系统，广泛用于Windows系统文件交互</p><p><strong>-o</strong> </p><p>主要用来描述设备或档案的挂接方式，常用的参数有:</p><p><code>defaults:</code> 使用所有选项的默认值（<code>auto</code>、<code>nouser</code>、<code>rw</code>、<code>suid</code>）<br><code>auto/noauto</code>: 允许/不允许以 –a选项进行安装<br><code>dev/nodev</code>: 对/不对文件系统上的特殊设备进行解释<br><code>exec/noexec:</code> 允许/不允许执行二进制代码<br><code>suid/nosuid</code>: 确认/不确认suid和sgid位<br><code>user /nouser:</code> 允许/不允许一般用户挂载<br><code>codepage=XXX</code>: 代码页<br><code>remount</code>: 重新安装已经安装了的文件系统<br><code>loop</code>: 用来把一个文件当成硬盘分区挂接上系统<br><code>ro</code>: 采用只读方式挂接设备<br><code>rw</code>: 采用读写方式挂接设备<br><code>iocharset</code>: 指定访问文件系统所用字符集</p><blockquote><p>此外<code>mount</code>命令还有其他可选参数：</p></blockquote><p><strong>-a</strong> </p><p>安装在/etc/fstab文件中类出的所有文件系统。</p><p><strong>-f</strong> </p><p>伪装mount，作出检查设备和目录的样子，但并不真正挂载文件系统。</p><p><strong>-n</strong> </p><p>不把安装记录在/etc/mtab 文件中。</p><p><strong>-r</strong> </p><p>讲文件系统安装为只读。</p><p><strong>-v</strong> </p><p>详细显示安装信息。</p><p><strong>-w</strong> </p><p>将文件系统安装为可写，为命令默认情况。</p><blockquote><ul><li>需要注意的是，挂载点必须是一个已经存在的目录，这个目录可以不为空，但挂载后这个目录下以前的内容将不可用，umount以后会恢复正常。使用多个-o参数的时候，-o 只用一次，参数之间用半角逗号隔开。</li><li>经常需要root权限才能执行该命令</li></ul></blockquote><blockquote><p>其余的参数为需要挂载的设备和挂载点</p></blockquote><p><strong>device</strong> </p><p>要挂接(mount)的设备。</p><p><strong>dir</strong></p><p>设备在系统上的挂接点(mount point)。</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><blockquote><p>假设我们需要将一个镜像文件(*.iso)挂载到某个目录，需要执行以下操作：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash">mkdir mnt</span> <br><span class="hljs-meta">$</span><span class="bash">mount -o loop -t iso9660 my.iso ~/mnt</span><br></code></pre></td></tr></table></figure><h3 id="查看挂载情况"><a href="#查看挂载情况" class="headerlink" title="查看挂载情况"></a>查看挂载情况</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash">df -h</span><br></code></pre></td></tr></table></figure><h3 id="查看某主机提供的nfs服务"><a href="#查看某主机提供的nfs服务" class="headerlink" title="查看某主机提供的nfs服务"></a>查看某主机提供的nfs服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash">showmount  -e 192.168.1.1(ip)</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash">nc  -v -w 2  192.168.1.2 -z 2049</span><br></code></pre></td></tr></table></figure><h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><blockquote><p>卸载使用<code>umount</code>命令</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash">umount dir</span><br><span class="hljs-meta">$</span><span class="bash">umount device</span><br><span class="hljs-meta">$</span><span class="bash">umount device dir</span><br></code></pre></td></tr></table></figure><blockquote><p>以上三个命令都可以。</p></blockquote><h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><ul><li><p>在挂载点<code>mnt</code>路径下卸载会失败，提示<code>Dev is busy</code></p><ul><li><p>解决方案：</p><p>退出挂载点进行卸载操作</p></li></ul></li><li><p>其他程序访问挂载文件也会提示卸载失败</p><ul><li><p>解决方案：</p><ol><li><p><code>lsof mnt</code>  查看是哪个进程占用了 <code>mnt</code></p></li><li><p><code>kill -9 $pid</code>  </p></li><li><p>重试卸载</p></li></ol></li></ul></li><li><p>有没有‘咔嚓’卸载掉的方法</p><ul><li><p>解决方案：</p><p><code>umount -l mnt</code></p><p>其中 <code>-l</code> 的作用是卸载前检查占用该挂载文件的程序并迅速kill掉，以达到快速卸载的目的</p></li></ul></li><li><p>Win 中如何挂载</p><ul><li><p>解决方案：</p><p>可以在<code>资源管理器-主页-轻松访问-映射为驱动器</code>中挂载</p><p>地址格式： <code>\\192.168.1.2\disk\balabala</code></p><p>也可以在cmd中使用<code>mount</code>命令</p><p><code>mount \\192.168.1.2\disk\balabala V:\</code></p></li></ul></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vim 学习笔记（二）—— 基本导航命令</title>
    <link href="/2020/07/22/words/vim/vim-nootbook-2/"/>
    <url>/2020/07/22/words/vim/vim-nootbook-2/</url>
    
    <content type="html"><![CDATA[<blockquote><p>课程链接：<a href="https://www.bilibili.com/video/BV1Cb411u7L9?p=7">https://www.bilibili.com/video/BV1Cb411u7L9?p=7</a></p><p>本节课介绍基本的文本导航命令。</p></blockquote><span id="more"></span><h3 id="导航命令"><a href="#导航命令" class="headerlink" title="导航命令"></a>导航命令</h3><blockquote><p>命令模式下：</p></blockquote><h4 id="移动光标"><a href="#移动光标" class="headerlink" title="移动光标"></a>移动光标</h4><ul><li><code>j</code>: 下移一行</li><li><code>k</code>: 上移一行</li><li><code>l</code>: 右移一列</li><li><code>h</code>: 左移一列</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20200722223706.png"></p><ul><li><code>Ctrl+f</code>: 下翻页</li><li><code>Ctrl+f</code>: 上翻页</li></ul><h4 id="单词切换"><a href="#单词切换" class="headerlink" title="单词切换"></a>单词切换</h4><ul><li><code>w</code>:  下一个单词，分辨标点</li><li><code>W</code>:  下一个单词，只识别空格</li><li><code>b</code>: 上一个单词，分辨标点</li><li><code>B</code>: 上一个单词，只识别空格</li></ul><h4 id="光标复位"><a href="#光标复位" class="headerlink" title="光标复位"></a>光标复位</h4><ul><li><code>z - Enter</code>: 将光标所在位置复位至中上部</li></ul><h4 id="行间切换"><a href="#行间切换" class="headerlink" title="行间切换"></a>行间切换</h4><ul><li><code>0</code>: 光标移至行首</li><li><code>^</code>: 光标移至行内第一个单词</li><li><code>$</code>: 光标移至行尾</li><li><code>num - gg</code>: 移动至<code>num</code>行第一个单词</li><li><code>num - G</code>: 移动至<code>num</code>行第一个单词</li><li> <code>:num - Enter</code>: 移动至<code>num</code>行第一个单词</li><li> <code>:$ - Enter</code>: 移动至<code>num</code>行第一个单词</li><li><code>gg</code>: 返回文件首部第一个单词</li><li><code>G</code>: 到文件最末行第一个单词</li></ul><h4 id="工作状态"><a href="#工作状态" class="headerlink" title="工作状态"></a>工作状态</h4><ul><li><code>Ctrl+g</code>: 显示文件名 工作状态 当前行数</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20200722232829.png"></p><ul><li><code>g - Ctrl+g</code>: 显示当前行列详细信息</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20200722233132.png"></p><ul><li><code>:set ruler</code>: 开启标尺信息</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20200722233404.png"></p><blockquote><p>开启标尺后，<code>Ctrl+g</code>不再显示重复信息</p></blockquote><ul><li><code>:set noruler</code>: 关闭标尺信息</li><li><code>:set ruler!</code>: 对当前ruler设置取反（如果关闭则打开，如果打开则关闭）</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>文字编码</category>
      
      <category>vim</category>
      
    </categories>
    
    
    <tags>
      
      <tag>文字编码</tag>
      
      <tag>vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vim 学习笔记（一）—— vim模式与创建、编辑文件</title>
    <link href="/2020/07/21/words/vim/vim-nootbook-1/"/>
    <url>/2020/07/21/words/vim/vim-nootbook-1/</url>
    
    <content type="html"><![CDATA[<blockquote><ul><li><p>vim 是源于linux的一款文本编辑器，在vi基础上开发，具有强大的文本编辑能力，且具有跨平台、几乎所有工具支持的普适性的特点。据说大神级的vim使用者可以在键盘上按照思想的速度操作文本，因此慕名而来，跟风学习一波。</p></li><li><p>教师是B站搬运来的生肉教程<a href="https://www.bilibili.com/video/BV1Cb411u7L9/">【公开课】完美的Vim课程【生肉】</a>，事实上vim教程很多，该生肉教程旨在讲解思想和精髓，没有拘泥于具体命令的介绍，有利于建立完整的思维体系。至于细节命令就是知识性内容的学习与熟能生巧的问题了。</p></li><li><p>该系列笔记为我随学随记的内容，作为个人的学习记录，也作为资料供大家参考。</p></li></ul></blockquote><span id="more"></span><h3 id="vim-模式"><a href="#vim-模式" class="headerlink" title="vim 模式"></a>vim 模式</h3><blockquote><p>vim 共分为三种模式，分别是<strong>命令模式（Command mode）</strong>，<strong>输入模式（Insert mode）</strong>和<strong>底线命令模式（Last line mode）</strong>。</p></blockquote><h4 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h4><p>用户刚刚启动 vi/vim，便进入了命令模式。</p><p>此状态下敲击键盘动作会被Vim识别为命令，而非输入字符。比如我们此时按下i，并不会输入一个字符，i被当作了一个命令。</p><p>以下是常用的几个命令：</p><ul><li><strong>i</strong> 切换到输入模式，以输入字符。</li><li><strong>x</strong> 删除当前光标所在处的字符。</li><li><strong>:</strong> 切换到底线命令模式，以在最底一行输入命令。</li></ul><h4 id="输入模式"><a href="#输入模式" class="headerlink" title="输入模式"></a>输入模式</h4><p>在命令模式下按下i就进入了输入模式。</p><p>该模式下字符都会变成内容输入在文本编辑器中，与我们平时使用编辑器功能基本相同。</p><p><strong>ESC</strong>，退出输入模式，切换到命令模式</p><h4 id="底线命令模式"><a href="#底线命令模式" class="headerlink" title="底线命令模式"></a>底线命令模式</h4><p>在命令模式下按下:（英文冒号）就进入了底线命令模式。</p><p>底线命令模式可以输入单个或多个字符的命令。</p><p><img src="https://photos.zywvvd.com/image_canglan/20200721001354.png"></p><blockquote><p>参考：<a href="https://www.runoob.com/linux/linux-vim.html">https://www.runoob.com/linux/linux-vim.html</a></p></blockquote><h3 id="使用vim创建与编辑文件"><a href="#使用vim创建与编辑文件" class="headerlink" title="使用vim创建与编辑文件"></a>使用vim创建与编辑文件</h3><blockquote><p>课程链接：<a href="https://www.bilibili.com/video/BV1Cb411u7L9?p=6">https://www.bilibili.com/video/BV1Cb411u7L9?p=6</a></p></blockquote><ul><li>创建文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim test.txt<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/image_canglan/20200721002209.png"></p><blockquote><p>此时默认是命令模式，编辑文件需要进入编辑模式。</p></blockquote><ul><li>编辑模式</li></ul><p>按下 <code>i</code>键进入编辑模式， 输入文本内容。</p><p><img src="https://photos.zywvvd.com/image_canglan/20200721002108.png"></p><blockquote><p>输入结束后按下<code>esc</code>键返回命令模式，保存文件需要在单行模式下进行。</p></blockquote><ul><li>保存文件</li></ul><p>在命令模式中按下<code>:</code>键进入单行模式，输入wq按下回车，表示<code>写入-退出</code>当前文件。</p><p><img src="https://photos.zywvvd.com/image_canglan/20200721002558.png"></p><p>可以看到我们成功使用vim建立了文件并保存。</p><p><img src="https://photos.zywvvd.com/image_canglan/20200721002732.png"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>文字编码</category>
      
      <category>vim</category>
      
    </categories>
    
    
    <tags>
      
      <tag>文字编码</tag>
      
      <tag>vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 Github 无法登录的问题</title>
    <link href="/2020/07/08/git/github_cannot_log_in/github_cannot_log_in/"/>
    <url>/2020/07/08/git/github_cannot_log_in/github_cannot_log_in/</url>
    
    <content type="html"><![CDATA[<blockquote><p> Github有时会出现突然连接失败的问题，有部分情况是地址解析错误导致的，本文介绍此类问题的解决方案。</p></blockquote><span id="more"></span><h3 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h3><blockquote><p>Github本来好好的，说不定啥时候就会报错，报错信息如下：</p></blockquote><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs console">Connection to XXXXX port 22: Software caused connection abort<br>fatal: Could not read from remote repository.<br><br>Please make sure you have the correct access rights<br>and the repository exists.<br></code></pre></td></tr></table></figure><blockquote><p>此问题也会导致 Hexo 在 hexo d 过程中报错：</p></blockquote><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">ssh_dispatch_run_fata<span class="hljs-variable">l:</span> Connection <span class="hljs-keyword">to</span> <span class="hljs-number">13.250</span>.<span class="hljs-number">177.223</span> port <span class="hljs-number">22</span>: Broken pipe<br>fata<span class="hljs-variable">l:</span> sha1 <span class="hljs-keyword">file</span> <span class="hljs-string">&#x27;&lt;stdout&gt;&#x27;</span> <span class="hljs-keyword">write</span> error: Broken pipeiB/s<br>fata<span class="hljs-variable">l:</span> the remote end hung <span class="hljs-keyword">up</span> unexpectedly<br>fata<span class="hljs-variable">l:</span> the remote end hung <span class="hljs-keyword">up</span> unexpectedly<br></code></pre></td></tr></table></figure><h3 id="错误原因"><a href="#错误原因" class="headerlink" title="错误原因"></a>错误原因</h3><ul><li>网络不通</li><li>本地DNS无法正确解析地址</li></ul><h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h3><p>不管你能不能访问，github就在那里，是因为我们网络在dns上找不到当前github 的地址导致的无法登录。</p><h4 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h4><p>解决思路是手动找到github网站IP，填入到host中，这样我们在访问时会直接从host中读取IP并访问。</p><h4 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h4><p>使用代理工具</p><h3 id="解决方案一"><a href="#解决方案一" class="headerlink" title="解决方案一"></a>解决方案一</h3><h4 id="查找github-IP地址"><a href="#查找github-IP地址" class="headerlink" title="查找github IP地址"></a>查找github IP地址</h4><blockquote><p><strong>IP查询网站：</strong> <a href="https://www.ipaddress.com/">https://www.ipaddress.com/</a></p></blockquote><ul><li>查询 <strong>github.com</strong></li></ul><p><img src="https://photos.zywvvd.com/image/20200708003724.png"></p><ul><li>保存结果</li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20200708003825.png"></p><ul><li>查询 <strong>github.global.ssl.fastly.net</strong></li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20200708003914.png"></p><ul><li>保存结果 </li></ul><p><img src="https://photos.zywvvd.com/image_canglan/20200708003950.png"></p><h4 id="写入host文件"><a href="#写入host文件" class="headerlink" title="写入host文件"></a>写入host文件</h4><ul><li>Windows </li></ul><blockquote><p>打开 <code>C:\Windows\System32\drivers\etc</code> 路径下的 <code>hosts</code>文件，加入上述结果：</p></blockquote><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"># github<br><span class="hljs-number">140.82.112.4</span> github.com<br><span class="hljs-number">199.232.69.194</span> github.global.ssl.fastly.net<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"># github<br><span class="hljs-number">192.30.253.112</span> github.com <br><span class="hljs-number">151.101.185.194</span> github.global.ssl.fastly.net<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"># github<br><span class="hljs-number">192.30.255.112</span>  github.com git <br><span class="hljs-number">185.31.16.184</span> github.global.ssl.fastly.net<br></code></pre></td></tr></table></figure><ul><li>Linux</li></ul><blockquote><p>打开<code>\etc\hosts</code></p></blockquote><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"># github <br><span class="hljs-number">140.82.112.4</span> github.com<br><span class="hljs-number">199.232.69.194</span> github.global.ssl.fastly.net<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"># github<br><span class="hljs-number">192.30.253.112</span> github.com <br><span class="hljs-number">151.101.185.194</span> github.global.ssl.fastly.net<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"># github<br><span class="hljs-number">192.30.255.112</span>  github.com git <br><span class="hljs-number">185.31.16.184</span> github.global.ssl.fastly.net<br></code></pre></td></tr></table></figure><h4 id="刷新DNS"><a href="#刷新DNS" class="headerlink" title="刷新DNS"></a>刷新DNS</h4><ul><li>Windows </li></ul><blockquote><p>打开命令提示符， 输入指令：</p></blockquote><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">ipconfig</span> /flushdns<br></code></pre></td></tr></table></figure><ul><li>Linux</li></ul><blockquote><p>在终端中输入：</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">sudo rcnscd restart</span><br></code></pre></td></tr></table></figure><blockquote><p>重启浏览器即可访问 github</p></blockquote><p><img src="https://photos.zywvvd.com/image_canglan/20200708005147.png"></p><h3 id="解决方案二"><a href="#解决方案二" class="headerlink" title="解决方案二"></a>解决方案二</h3><ul><li>安装网络工具 <code>开发者边车</code> 加速github</li><li>gitee： <a href="https://gitee.com/docmirror/dev-sidecar">https://gitee.com/docmirror/dev-sidecar</a></li><li>下载最新发行版</li><li>安装软件</li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210803201755.png"></p><ul><li>开着车，GitHub 连接不上问题彻底解决</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - conda 常用命令介绍</title>
    <link href="/2020/06/20/python/conda-env-operation/conda-env-operation/"/>
    <url>/2020/06/20/python/conda-env-operation/conda-env-operation/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍使用conda管理anaconda Python环境的相关命令。</p></blockquote><span id="more"></span><h2 id="conda-环境相关命令"><a href="#conda-环境相关命令" class="headerlink" title="conda 环境相关命令"></a>conda 环境相关命令</h2><h3 id="创建环境"><a href="#创建环境" class="headerlink" title="创建环境"></a>创建环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda create -n env_name python=3.7 --clone another_env<br></code></pre></td></tr></table></figure><blockquote><p>-n：name 表示新环境名称</p><p>python：使用python版本</p><p>–clone：从现有环境复制而来</p></blockquote><h3 id="删除环境"><a href="#删除环境" class="headerlink" title="删除环境"></a>删除环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda remove -n env_name --all<br></code></pre></td></tr></table></figure><h3 id="查看环境"><a href="#查看环境" class="headerlink" title="查看环境"></a>查看环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda env list <br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda info -e<br></code></pre></td></tr></table></figure><h3 id="激活环境"><a href="#激活环境" class="headerlink" title="激活环境"></a>激活环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda activate env_name<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source activate env_name<br></code></pre></td></tr></table></figure><h3 id="退出环境"><a href="#退出环境" class="headerlink" title="退出环境"></a>退出环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda deactivate<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source deactivate<br></code></pre></td></tr></table></figure><blockquote><p>会回到<code>base</code>环境</p></blockquote><h2 id="conda-包相关命令"><a href="#conda-包相关命令" class="headerlink" title="conda 包相关命令"></a>conda 包相关命令</h2><h3 id="查看当前环境下conda管理的python包列表"><a href="#查看当前环境下conda管理的python包列表" class="headerlink" title="查看当前环境下conda管理的python包列表"></a>查看当前环境下conda管理的python包列表</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda list<br></code></pre></td></tr></table></figure><h3 id="安装python包"><a href="#安装python包" class="headerlink" title="安装python包"></a>安装python包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda install package_name #安装包<br>conda install package_name_1 package_name_2 package_name_3 ... #一次安装多个包<br>conda install package_name=1.1.0 #安装指定版本的包<br></code></pre></td></tr></table></figure><h3 id="更新包"><a href="#更新包" class="headerlink" title="更新包"></a>更新包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda update package_name # 更新包<br>conda upgrade --all #更新所有包<br></code></pre></td></tr></table></figure><h3 id="卸载包"><a href="#卸载包" class="headerlink" title="卸载包"></a>卸载包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda remove package_name<br></code></pre></td></tr></table></figure><h3 id="搜索不清楚名称的包"><a href="#搜索不清楚名称的包" class="headerlink" title="搜索不清楚名称的包"></a>搜索不清楚名称的包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda search search_term<br></code></pre></td></tr></table></figure><h2 id="conda-重现环境"><a href="#conda-重现环境" class="headerlink" title="conda 重现环境"></a>conda 重现环境</h2><blockquote><p>使用conda管理python一个重要的考量就是可迁移性，conda 提供了几种方法用于重现某个conda 环境。</p></blockquote><h3 id="Clone"><a href="#Clone" class="headerlink" title="Clone"></a>Clone</h3><blockquote><p>上文介绍过这个命令，用于本地重现某个环境</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda create --name new_env --clone old_env<br></code></pre></td></tr></table></figure><h3 id="Spec-List"><a href="#Spec-List" class="headerlink" title="Spec List"></a>Spec List</h3><blockquote><p>相同操作系统的计算机之间复制环境，可以生成 <code>spec list</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 生成 spec list 文件</span><br>conda list --explicit &gt; spec-list.txt <br><span class="hljs-meta">#</span><span class="bash">重现环境：</span><br>conda create --name python-course --file spec-list.txt<br></code></pre></td></tr></table></figure><h3 id="Environment-yml"><a href="#Environment-yml" class="headerlink" title="Environment.yml"></a>Environment.yml</h3><blockquote><p>使用 -export 选项生成一个 <code>environment.yml</code> 文件，以在不同的平台和操作系统之间复现项目环境。 </p><p>spec list 文件和 <code>environment.yml</code> 文件之间的区别在于： <code>environment.yml</code> 文件不针对特定操作系统，并且使用YAML格式。<code>environment.yml</code> 仅列出了软件包名称，由 conda 基于软件包的名称构建环境。 另一个区别是 -export 还包括使用pip安装的软件包，而 <code>spec list</code> 则没有。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">导出 environment.yml 文件：</span><br>conda env export &gt; environment.yml<br><span class="hljs-meta">#</span><span class="bash">重现环境：</span><br>conda env create -f environment.yml<br></code></pre></td></tr></table></figure><blockquote><p>注意：如果当前路径已经有了 environment.yml 文件，conda 会重写这个文件</p></blockquote><h3 id="Conda-Pack"><a href="#Conda-Pack" class="headerlink" title="Conda Pack"></a>Conda Pack</h3><blockquote><p>上述两种重现的方法都基于记录当前环境包信息，到新机器重建的思路。而Conda Pack用的是将当前环境的文件直接打包，带到新机器拆包使用的思路。</p><p><strong>conda-pack 指定平台和操作系统，目标计算机必须具有与源计算机相同的平台和操作系统。</strong></p></blockquote><h4 id="安装-conda-pack"><a href="#安装-conda-pack" class="headerlink" title="安装 conda pack"></a>安装 conda pack</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> from conda</span><br>conda install -c conda-forge conda-pack<br><span class="hljs-meta">#</span><span class="bash"> from pip</span><br>pip install conda-pack<br></code></pre></td></tr></table></figure><h4 id="打包环境"><a href="#打包环境" class="headerlink" title="打包环境"></a>打包环境</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">conda pack -n my_env<br>conda pack -n my_env -o out_name.tar.gz<br></code></pre></td></tr></table></figure><h4 id="重现环境"><a href="#重现环境" class="headerlink" title="重现环境"></a>重现环境</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p path_to_my_new_env # 建议放在anaconda的envs文件夹中<br>tar -xzf my_env.tar.gz -C path_to_my_new_env # 解压包中文件<br>source path_to_my_new_env/bin/activate # 激活该环境<br>(my_env) $ python # 进入一下该环境下的 python 随后退出<br>(my_env) $ conda-unpack # 十分重要，请不要忽略<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
      <category>运行环境</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>运行环境</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 类中的对象与属性</title>
    <link href="/2020/06/20/python/python-class-var/python-class-var/"/>
    <url>/2020/06/20/python/python-class-var/python-class-var/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文整理类中对象与属性（变量）相关知识。</p></blockquote><span id="more"></span><h2 id="类对象与实例对象"><a href="#类对象与实例对象" class="headerlink" title="类对象与实例对象"></a>类对象与实例对象</h2><blockquote><p>建立测试类：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span>:</span><br>    var_of_class = <span class="hljs-string">&#x27;Class Var&#x27;</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.var_of_instance = <span class="hljs-string">&#x27;Instance Var&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="类对象"><a href="#类对象" class="headerlink" title="类对象"></a>类对象</h3><blockquote><p>建立类进行编译后则形成了类对象，类对象仅支持两个操作：</p></blockquote><ul><li>实例化：使用<code>instance_name = class_name()</code>的方式实例化，实例化操作创建该类的实例。</li><li>属性引用：使用<code>class_name.attr_name</code>的方式引用类属性。</li></ul><h3 id="实例对象"><a href="#实例对象" class="headerlink" title="实例对象"></a>实例对象</h3><blockquote><p>类对象实例化得到实例对象，实例对象仅支持一个操作：</p></blockquote><ul><li>属性引用；与类对象属性引用的方式相同，使用<code>instance_name.attr_name</code>的方式</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 类对象</span><br><span class="hljs-built_in">print</span>(Test)<br><br><span class="hljs-comment"># 实例对象</span><br>class_instance = Test()<br><br>&gt;&gt;&gt;<br>&lt;<span class="hljs-class"><span class="hljs-keyword">class</span> &#x27;<span class="hljs-title">__main__</span>.<span class="hljs-title">Test</span>&#x27;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">__main__</span>.<span class="hljs-title">Test</span> <span class="hljs-title">object</span> <span class="hljs-title">at</span> 0<span class="hljs-title">x00000127715B4128</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="类变量与实例变量"><a href="#类变量与实例变量" class="headerlink" title="类变量与实例变量"></a>类变量与实例变量</h2><blockquote><p>建立测试类：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span>:</span><br>    var_of_class = <span class="hljs-string">&#x27;Class Var&#x27;</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.var_of_instance = <span class="hljs-string">&#x27;Instance Var&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="类变量"><a href="#类变量" class="headerlink" title="类变量"></a>类变量</h3><blockquote><p>可由类对象引用</p><p>由所有实例共享</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 类对象引用类变量</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;类对象引用类变量 ：<span class="hljs-subst">&#123;Test.var_of_class&#125;</span>&#x27;</span>)<br>class_instance_1 = Test()<br>class_instance_2 = Test()<br><span class="hljs-comment"># 实例对象引用类变量</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例对象1引用类变量 ：<span class="hljs-subst">&#123;class_instance_1.var_of_class&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例对象2引用类变量 ：<span class="hljs-subst">&#123;class_instance_2.var_of_class&#125;</span>&#x27;</span>)<br><span class="hljs-comment"># 修改类变量实例对象共享修改</span><br>Test.var_of_class = <span class="hljs-string">&#x27;Changed Class Var&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例对象1引用类变量 ：<span class="hljs-subst">&#123;class_instance_1.var_of_class&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例对象2引用类变量 ：<span class="hljs-subst">&#123;class_instance_2.var_of_class&#125;</span>&#x27;</span>)<br><br>&gt;&gt;&gt;<br>类对象引用类变量 ：Class Var<br>实例对象<span class="hljs-number">1</span>引用类变量 ：Class Var<br>实例对象<span class="hljs-number">2</span>引用类变量 ：Class Var<br>实例对象<span class="hljs-number">1</span>引用类变量 ：Changed Class Var<br>实例对象<span class="hljs-number">2</span>引用类变量 ：Changed Class Var<br></code></pre></td></tr></table></figure><h3 id="实例变量"><a href="#实例变量" class="headerlink" title="实例变量"></a>实例变量</h3><blockquote><p>由实例对象引用</p><p>仅在当前实例保存</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 实例变量</span><br>class_instance_1 = Test()<br>class_instance_2 = Test()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例对象1实例变量 ：<span class="hljs-subst">&#123;class_instance_1.var_of_instance&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例对象2实例变量 ：<span class="hljs-subst">&#123;class_instance_2.var_of_instance&#125;</span>&#x27;</span>)<br>class_instance_1.var_of_instance = <span class="hljs-string">&#x27;changed instance var&#x27;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;修改实例对象1后实例对象1实例变量 ：<span class="hljs-subst">&#123;class_instance_1.var_of_instance&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;修改实例对象1后实例对象2实例变量 ：<span class="hljs-subst">&#123;class_instance_2.var_of_instance&#125;</span>&#x27;</span>)<br><br>&gt;&gt;&gt;<br>实例对象<span class="hljs-number">1</span>实例变量 ：Instance Var<br>实例对象<span class="hljs-number">2</span>实例变量 ：Instance Var<br>修改实例对象<span class="hljs-number">1</span>后实例对象<span class="hljs-number">1</span>实例变量 ：changed instance var<br>修改实例对象<span class="hljs-number">1</span>后实例对象<span class="hljs-number">2</span>实例变量 ：Instance Var<br></code></pre></td></tr></table></figure><blockquote><p>类对象不能引用实例变量：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 类对象不能引用实例变量</span><br><span class="hljs-built_in">print</span>(Test.var_of_instance)<br><span class="hljs-meta">&gt;&gt;&gt; </span>报错！<br><span class="hljs-built_in">type</span> <span class="hljs-built_in">object</span> <span class="hljs-string">&#x27;Test&#x27;</span> has no attribute <span class="hljs-string">&#x27;var_of_instance&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="属性绑定"><a href="#属性绑定" class="headerlink" title="属性绑定"></a>属性绑定</h2><blockquote><p>建立测试类：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span>():</span><br>    var_of_class = <span class="hljs-string">&#x27;Class Var&#x27;</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.var_of_instance = <span class="hljs-string">&#x27;Instance Var&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p>在定义、使用类、实例对象属性过程中，其实涉及两个过程：</p></blockquote><ul><li>类属性绑定</li><li>实例属性绑定</li></ul><blockquote><p>使用<code>绑定</code>一词事实上更加确切，可以理解为属性并不是属于类或实例的，Python中一切皆对象，每个属性也都是一个个现货鲜活的对象，之所以这些对象被称之为、用作于属性，是因为我们将这部分对象绑在了类对象可使用的属性名称上；</p><p>换一种说法，<strong>对象就是对象，而世上本没有属性，当对象被绑定在类/实例上，对象也就成了类/实例的属性</strong>。</p><p>因此绑定属性，首先需要有一个对象才行。</p></blockquote><h3 id="类属性绑定"><a href="#类属性绑定" class="headerlink" title="类属性绑定"></a>类属性绑定</h3><blockquote><p>Python作为动态语言，类对象和实例对象都可以在运行时绑定任意属性，因此类属性绑定有两种时机：</p></blockquote><ul><li>编译类时（写在类中的类属性）</li><li>运行时</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 定义时绑定类属性</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;定义时绑定类属性：<span class="hljs-subst">&#123;Test.var_of_class&#125;</span>&#x27;</span>)<br><span class="hljs-comment"># 运行时绑定类属性</span><br>Test.var_of_class_defined_during_running = <span class="hljs-string">&#x27;a long var of class&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;运行时绑定类属性：<span class="hljs-subst">&#123;Test.var_of_class_defined_during_running&#125;</span>&#x27;</span>)<br><br>&gt;&gt;&gt;<br>定义时绑定类属性：Changed Class Var<br>运行时绑定类属性：a long var of <span class="hljs-class"><span class="hljs-keyword">class</span></span><br></code></pre></td></tr></table></figure><h3 id="实例属性绑定"><a href="#实例属性绑定" class="headerlink" title="实例属性绑定"></a>实例属性绑定</h3><blockquote><p>实例属性绑定也发生在两个时机：</p></blockquote><ul><li>实例生成时</li><li>运行时</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">class_instance = Test()<br><span class="hljs-comment"># 实例生成时绑定的实例属性</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例生成时绑定的实例属性：<span class="hljs-subst">&#123;class_instance.var_of_instance&#125;</span>&#x27;</span>)<br><span class="hljs-comment"># 实例运行时绑定的实例属性</span><br>class_instance.var_of_instance = <span class="hljs-string">&#x27;defined during running&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例运行时绑定的实例属性<span class="hljs-subst">&#123;class_instance.var_of_instance&#125;</span>&#x27;</span>)<br><br>&gt;&gt;&gt;<br>实例生成时绑定的实例属性：Instance Var<br>实例运行时绑定的实例属性: defined during running<br></code></pre></td></tr></table></figure><h2 id="属性引用"><a href="#属性引用" class="headerlink" title="属性引用"></a>属性引用</h2><blockquote><p>上文中对属性的使用事实上都是在引用类对象或实例对象中的属性。</p><p>需要特别说明的是实例对象的属性引用冲突的问题，当类中存在同名的实例属性与类属性时：</p></blockquote><ul><li>由于类对象无法访问实例属性，因此对类对象的属性引用没有影响</li><li>实例属性有权访问二者，实现上会优先引用实例级的属性，即同名的类属性会被覆盖</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">class_instance = Test()<br>class_instance.var_of_class = <span class="hljs-string">&#x27;instance var with a same name of a class var&#x27;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;类对象引用冲突属性：<span class="hljs-subst">&#123;Test.var_of_class&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;实例对象引用冲突属性：<span class="hljs-subst">&#123;class_instance.var_of_class&#125;</span>&#x27;</span>)<br><br>&gt;&gt;&gt;<br>类对象引用冲突属性：Changed Class Var<br>实例对象引用冲突属性：instance var <span class="hljs-keyword">with</span> a same name of a <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">var</span></span><br></code></pre></td></tr></table></figure><h2 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h2><blockquote><p>文中测试环境与所有源码可在<a href="https://github.com/zywvvd/Python_Practise">Github</a>下载。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux 软链接的增、删、改、查</title>
    <link href="/2020/06/19/linux/soft-link/soft-link/"/>
    <url>/2020/06/19/linux/soft-link/soft-link/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Linux的软链接类似Windows的快捷方式，又不尽相同，本文对相关知识进行梳理总结 。</p></blockquote><span id="more"></span><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p>软链接是将磁盘中的真实地址增加一个虚拟映射，使得用户访问该映射与访问真实磁盘地址完全相同，是Linux系统中灵巧编程的神兵利器。</p></blockquote><h2 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h2><h3 id="示例用例"><a href="#示例用例" class="headerlink" title="示例用例"></a>示例用例</h3><blockquote><p>测试在文件夹~/test 中进行</p><p>文件夹中包含tar_dir文件夹</p><p>test 文件夹中包含test_file.txt 文件</p><p>test_file.txt 文件内容为 Test_File_Data</p><p>tar_dir文件夹包含second_test_file.txt文件</p><p>second_test_file.txt文件内容为Second_Test_File_Data</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"> :~# mkdir test<br> :~# cd test/<br> :~/test# ls<br> :~/test# mkdir tar_dir<br> :~/test# echo Test_File_Data&gt;&gt;test_file.txt<br> :~/test# cat test_file.txt <br>Test_File_Data<br>:~/test#echo Second_Test_File_Data&gt;&gt;tar_dir/second_test_file.txt<br>:~/test# cat tar_dir/second_test_file.txt <br>Second_Test_File_Data<br> :~/test# ls<br>tar_dir  test_file.txt<br> :~/test# <br>:~/test# ls tar_dir/<br>second_test_file.txt<br><br></code></pre></td></tr></table></figure><h3 id="创建软链接"><a href="#创建软链接" class="headerlink" title="创建软链接"></a>创建软链接</h3><blockquote><p>命令 <code>ln</code>，软链接参数 <code>-s</code>:</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s [目标地址] [软链接地址]<br></code></pre></td></tr></table></figure><blockquote><p>目标地址：需要链接到的目标路径；</p><p>软链接地址：需要建立软链接的文件路径</p></blockquote><ul><li>建立指向文件<code>test_file.txt</code>的软链接</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s test_file.txt file_link<br></code></pre></td></tr></table></figure><blockquote><p>此时可以通过<code>file_link</code>访问文件<code>test_file.txt</code>：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">:~/test# cat file_link <br>Test_File_Data<br></code></pre></td></tr></table></figure><ul><li>建立指向目录的软链接</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s tar_dir/ dir_link <br></code></pre></td></tr></table></figure><blockquote><p>此时可以通过<code>dir_link</code>访问目录<code>tar_dir</code>：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">:~/test# ls dir_link<br>second_test_file.txt<br>:~/test# cat dir_link/second_test_file.txt <br>Second_Test_File_Data<br></code></pre></td></tr></table></figure><h3 id="删除软链接"><a href="#删除软链接" class="headerlink" title="删除软链接"></a>删除软链接</h3><blockquote><p>软链接本质是文件，可以直接用<code>rm</code>命令删除：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">:~/test# rm file_link <br>:~/test# rm dir_link<br>:~/test# ls<br>tar_dir  test_file.txt<br></code></pre></td></tr></table></figure><h3 id="查看软链接"><a href="#查看软链接" class="headerlink" title="查看软链接"></a>查看软链接</h3><blockquote><p>可以通过<code>ls -al</code>命令看到软链接指向：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">:~/test# ls -al<br>total 16<br>drwxr-xr-x 3 root root 4096 Jun 19 13:04 .<br>drwx------ 1 root root 4096 Jun 19 13:06 ..<br>lrwxrwxrwx 1 root root    8 Jun 19 13:04 dir_link -&gt; tar_dir/<br>lrwxrwxrwx 1 root root   13 Jun 19 13:04 file_link -&gt; test_file.txt<br>drwxr-xr-x 2 root root 4096 Jun 19 12:55 tar_dir<br>-rw-r--r-- 1 root root   15 Jun 19 12:52 test_file.txt<br></code></pre></td></tr></table></figure><h3 id="修改软链接"><a href="#修改软链接" class="headerlink" title="修改软链接"></a>修改软链接</h3><blockquote><p>修改软链接的参数是 <code>-snf</code>：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -snf [新目标地址] [软链接地址]<br></code></pre></td></tr></table></figure><blockquote><p>尝试修改软链接：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">:~/test# ln -snf tar_dir/second_test_file.txt file_link <br>:~/test# cat file_link <br>Second_Test_File_Data<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决运行文件消失、C盘空间不断缩小而且找不到文件位置的问题</title>
    <link href="/2020/06/19/software/debug/missing-running-files/missing-running-files/"/>
    <url>/2020/06/19/software/debug/missing-running-files/missing-running-files/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在Windows 10 系统下回退CUDA版本的过程中，运行CUDA的安装文件时文件会自动消失，随后没有任何反应，同时C盘空间会减少一个安装文件大小，安装一次消失一次、C盘空间缩水一次，然而C盘中总文件大小并没有改变。本文记录该问题解决方法。</p></blockquote><span id="more"></span><h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><blockquote><p>系统处于某种特殊异常状态运行某个程序，同时系统运行了<code>360安全卫士</code>，此时安全卫士会删除该运行的程序并将该程序放入C盘的隔离区，导致程序运行失败、磁盘空间变小。</p><p>隔离区是一个叫做<code>$360Section</code>的系统级隐藏文件夹，常规查看文件大小并不统计该文件夹中的文件。</p></blockquote><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="针对程序不能正常运行"><a href="#针对程序不能正常运行" class="headerlink" title="针对程序不能正常运行"></a>针对程序不能正常运行</h3><ul><li>退出360安全卫士</li><li>运行程序</li></ul><h3 id="针对C盘空间变小"><a href="#针对C盘空间变小" class="headerlink" title="针对C盘空间变小"></a>针对C盘空间变小</h3><ul><li><p>进入C盘根目录</p></li><li><p><img src="https://photos.zywvvd.com/matrixtime/20200619195812.png"></p></li><li><p>删除<code>$360Section</code>即可</p></li><li><p><img src="https://photos.zywvvd.com/matrixtime/20200619200324.png"></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>软件</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>错误 Could not load dynamic library&#39;libnvinfer.so.6&#39; 解决方法</title>
    <link href="/2020/06/19/software/debug/libnvinfer-so-6-error/libnvinfer-so-6-error/"/>
    <url>/2020/06/19/software/debug/libnvinfer-so-6-error/libnvinfer-so-6-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在测试TensorFlow可用性时(tf.test.is_gpu_available())出现错误<code>Could not load dynamic library&#39;libnvinfer.so.6&#39;</code>，本文记录解决方法。</p></blockquote><span id="more"></span><h2 id="错误原因"><a href="#错误原因" class="headerlink" title="错误原因"></a>错误原因</h2><blockquote><p>没有安装 TensorRT</p></blockquote><ul><li>关于NVIDIA TensorRT:</li></ul><blockquote><p>NVIDIA TensorRT是一种高性能神经网络推理(Inference)引擎，用于在生产环境中部署深度学习应用程序，应用有图像分类、分割和目标检测等，可提供最大的推理吞吐量和效率。TensorRT是第一款可编程推理加速器，能加速现有和未来的网络架构。TensorRT需要CUDA的支持。TensorRT包含一个为优化生产环境中部署的深度学习模型而创建的库，可获取经过训练的神经网络(通常使用32位或16位数据)，并针对降低精度的INT8运算来优化这些网络。借助CUDA的可编程性，TensorRT将能够加速助推深度神经网络日益多样化、复杂的增长趋势。通过TensorRT的大幅度加速，服务提供商能够以经济实惠的成本部署这些计算密集型人工智能工作负载。</p></blockquote><ul><li>错误形式</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>Could <span class="hljs-keyword">not</span> load dynamic library<span class="hljs-string">&#x27;libnvinfer.so.6&#x27;</span>; dlerror: libnvinfer.so<span class="hljs-number">.6</span>: cannot <span class="hljs-built_in">open</span> shared <span class="hljs-built_in">object</span> file: No such file <span class="hljs-keyword">or</span> directory; LD_LIBRARY_PATH: /usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/cuda/lib64/<br><br></code></pre></td></tr></table></figure><blockquote><p>实际上这只是个警告信息，而不是错误。<code>libnvinfer.so.6</code>和<code>libnvinfer_plugin.so.6</code>只在使用<code>NVIDIA TensorRT</code>的时候才是必须的。没有这两个库也可以运行tensorflow。</p><p>——引自 - <a href="https://blog.csdn.net/toopoo/article/details/104506143">https://blog.csdn.net/toopoo/article/details/104506143</a></p></blockquote><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><blockquote><p>安装 TensorRT</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Install TensorRT.</span><br>sudo apt-get install -y --no-install-recommends libnvinfer6=6.0.1-1+cuda10.1 \<br>    libnvinfer-dev=6.0.1-1+cuda10.1 \<br>    libnvinfer-plugin6=6.0.1-1+cuda10.1<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>Tensorflow</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>深度学习</tag>
      
      <tag>Tensorflow</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux &amp; Windows TensorFlow 1.14 升级 2.2</title>
    <link href="/2020/06/18/software/install/Linux-tensorflow-2-2-install/Linux-tensorflow-2-2-install/"/>
    <url>/2020/06/18/software/install/Linux-tensorflow-2-2-install/Linux-tensorflow-2-2-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>准备尝试升级TensorFlow 1.14 到2.2，需要同时升级本地和服务器的环境，本文记录主要过程。</p></blockquote><span id="more"></span><h2 id="环境需求"><a href="#环境需求" class="headerlink" title="环境需求"></a>环境需求</h2><blockquote><p>当前TensorFlow最高版本 2.2.+ ，需要CUDA 10.1，cudnn 7.6</p><p>官网下载 ：<a href="https://developer.nvidia.com/">https://developer.nvidia.com/</a></p><p>显卡驱动需要满足CUDA版本要求</p><p>CUDA与显卡驱动：<a href="https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html">https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html</a></p><p>TensorFlow-GPU与CUDA cudnn Python版本关系：<a href="https://tensorflow.google.cn/install/source_windows?hl=en#gpu">https://tensorflow.google.cn/install/source_windows?hl=en#gpu</a></p></blockquote><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><ul><li>下载  cuda_10.1.243_418.87.00_linux.run 并安装（之前装过并运行过TensorFlow，相关库不过时的话可以不特意去装 cudnn）</li></ul><blockquote><p>过程中不需要安装驱动</p><p>将 /usr/local/cuda 软链接 指向 cuda-10.1</p><p>在 ~/.bashrc 中添加环境变量：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">export PATH=&quot;$PATH:/usr/local/cuda/bin&quot;<br>export LD_LIBRARY_PATH=&quot;$LD_LIBRARY_PATH:/usr/local/cuda/lib64/&quot;<br>export LIBRARY_PATH=&quot;$LIBRARY_PATH:/usr/local/cuda/lib64&quot;  <br></code></pre></td></tr></table></figure><ul><li>下载 TensorFlow ：tensorflow_gpu-2.2.0-cp37-cp37m-manylinux2010_x86_64.whl</li></ul><blockquote><p>或使用pip安装</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install tensorflow-gpu<br></code></pre></td></tr></table></figure><blockquote><p>会自动安装最新版 2.2.0 版本tf</p></blockquote><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><ul><li>下载 cuda_10.1.243_426.00_win10.exe 并安装（之前装过并运行过TensorFlow，相关库不过时的话可以不特意去装 cudnn）</li></ul><blockquote><p>我之前安装了CUDA10.0，不需要卸载原始版本，直接使用默认配置安装新版CUDA即可</p></blockquote><ul><li>下载 TensorFlow ：tensorflow_gpu-2.2.0-cp37-cp37m-win_amd64.whl</li></ul><blockquote><p>或使用pip安装</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install tensorflow-gpu<br></code></pre></td></tr></table></figure><blockquote><p>会自动安装最新版 2.2.0 版本tf</p></blockquote><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul><li>python 环境下测试</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-meta">&gt;&gt;&gt; </span>tf.__version__<br><span class="hljs-string">&#x27;2.2.0&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>tf.test.is_gpu_available()<br>WARNING:tensorflow:From &lt;stdin&gt;:<span class="hljs-number">1</span>: is_gpu_available (<span class="hljs-keyword">from</span> tensorflow.python.framework.test_util) <span class="hljs-keyword">is</span> deprecated <span class="hljs-keyword">and</span> will be removed <span class="hljs-keyword">in</span> a future version.<br>Instructions <span class="hljs-keyword">for</span> updating:<br>Use `tf.config.list_physical_devices(<span class="hljs-string">&#x27;GPU&#x27;</span>)` instead.<br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.406300</span>: I tensorflow/core/platform/cpu_feature_guard.cc:<span class="hljs-number">143</span>] Your CPU supports instructions that this TensorFlow binary was <span class="hljs-keyword">not</span> compiled to use: AVX2 FMA<br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.416107</span>: I tensorflow/core/platform/profile_utils/cpu_utils.cc:<span class="hljs-number">102</span>] CPU Frequency: <span class="hljs-number">2498530000</span> Hz<br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.417069</span>: I tensorflow/compiler/xla/service/service.cc:<span class="hljs-number">168</span>] XLA service <span class="hljs-number">0x55e39cc09290</span> initialized <span class="hljs-keyword">for</span> platform Host (this does <span class="hljs-keyword">not</span> guarantee that XLA will be used). Devices:<br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.417085</span>: I tensorflow/compiler/xla/service/service.cc:<span class="hljs-number">176</span>]   StreamExecutor device (<span class="hljs-number">0</span>): Host, Default Version<br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.420284</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcuda.so<span class="hljs-number">.1</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.593401</span>: I tensorflow/compiler/xla/service/service.cc:<span class="hljs-number">168</span>] XLA service <span class="hljs-number">0x55e39ccc83a0</span> initialized <span class="hljs-keyword">for</span> platform CUDA (this does <span class="hljs-keyword">not</span> guarantee that XLA will be used). Devices:<br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.593427</span>: I tensorflow/compiler/xla/service/service.cc:<span class="hljs-number">176</span>]   StreamExecutor device (<span class="hljs-number">0</span>): GeForce RTX <span class="hljs-number">2080</span> Ti, Compute Capability <span class="hljs-number">7.5</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.594463</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="hljs-number">1561</span>] Found device <span class="hljs-number">0</span> <span class="hljs-keyword">with</span> properties: <br>pciBusID: <span class="hljs-number">0000</span>:0a:<span class="hljs-number">00.0</span> name: GeForce RTX <span class="hljs-number">2080</span> Ti computeCapability: <span class="hljs-number">7.5</span><br>coreClock: <span class="hljs-number">1.545</span>GHz coreCount: <span class="hljs-number">68</span> deviceMemorySize: <span class="hljs-number">10.76</span>GiB deviceMemoryBandwidth: <span class="hljs-number">573.69</span>GiB/s<br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.594765</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcudart.so<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.596879</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcublas.so<span class="hljs-number">.10</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.598737</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcufft.so<span class="hljs-number">.10</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.599064</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcurand.so<span class="hljs-number">.10</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.601174</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcusolver.so<span class="hljs-number">.10</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.602319</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcusparse.so<span class="hljs-number">.10</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.606633</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcudnn.so<span class="hljs-number">.7</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.608814</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="hljs-number">1703</span>] Adding visible gpu devices: <span class="hljs-number">0</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.608929</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="hljs-number">44</span>] Successfully opened dynamic library libcudart.so<span class="hljs-number">.10</span><span class="hljs-number">.1</span><br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.610584</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="hljs-number">1102</span>] Device interconnect StreamExecutor <span class="hljs-keyword">with</span> strength <span class="hljs-number">1</span> edge matrix:<br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.610608</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="hljs-number">1108</span>]      <span class="hljs-number">0</span> <br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.610618</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="hljs-number">1121</span>] <span class="hljs-number">0</span>:   N <br><span class="hljs-number">2020</span>-06-<span class="hljs-number">18</span> 04:<span class="hljs-number">15</span>:<span class="hljs-number">11.612706</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="hljs-number">1247</span>] Created TensorFlow device (/device:GPU:<span class="hljs-number">0</span> <span class="hljs-keyword">with</span> <span class="hljs-number">1958</span> MB memory) -&gt; physical GPU (device: <span class="hljs-number">0</span>, name: GeForce RTX <span class="hljs-number">2080</span> Ti, pci bus <span class="hljs-built_in">id</span>: <span class="hljs-number">0000</span>:0a:<span class="hljs-number">00.0</span>, compute capability: <span class="hljs-number">7.5</span>)<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><blockquote><p>当最后一行输出True表示GPU可用，如果是False请查看错误信息。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
      <category>软件安装</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软件</tag>
      
      <tag>软件安装</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keras 在fit-generator中获取验证数据的y_true和y_preds</title>
    <link href="/2020/06/10/deep_learning/keras/get-gts-and-preds-from-evaluator/get-gts-and-preds-from-evaluator/"/>
    <url>/2020/06/10/deep_learning/keras/get-gts-and-preds-from-evaluator/get-gts-and-preds-from-evaluator/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在Keras网络训练过程中，<code>fit-generator</code>为我们提供了很多便利。调用<code>fit-generator</code>时，每个epoch训练结束后会使用验证数据检测模型性能，Keras使用<code>model.evaluate_generator</code>提供该功能。然而我遇到了需要提取验证集y_pred的需求，在网上没有找到现有的功能实现方法，于是自己对源码进行了微调，实现了可配置提取验证集模型预测结果的功能，记录如下。</p></blockquote><span id="more"></span><h2 id="原理简介"><a href="#原理简介" class="headerlink" title="原理简介"></a>原理简介</h2><blockquote><p>通过查看源代码，发现Keras调用了<code>model.evaluate_generator</code>验证数据，该函数最终调用的是TensorFlow（我用的后端是tf）的<code>TF_SessionRunCallable</code>函数，封装得很死，功能是以数据为输入，输出模型预测的结果并与真实标签比较并计算评价函数得到结果。</p><p>过程中不保存、不返回预测结果，这部分没有办法修改，但可以<strong>在评价数据的同时对数据进行预测，得到结果并记录下来，传入到<code>epoch_logs</code>中，随后在回调函数的<code>on_epoch_end</code>中尽情使用</strong>。</p></blockquote><h2 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h2><ul><li>Keras版本 2.2.4 其他版本不保证一定使用相同的方法，但大体思路不变</li></ul><h3 id="model-fit-generator"><a href="#model-fit-generator" class="headerlink" title="model.fit_generator"></a>model.fit_generator</h3><p><img src="https://photos.zywvvd.com/matrixtime/20200610154931.png"></p><blockquote><p>找到<code>fit_generator</code>函数定义位置，加入控制参数<code>get_predict</code>：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit_generator</span>(<span class="hljs-params">self, generator,</span></span><br><span class="hljs-params"><span class="hljs-function">                      steps_per_epoch=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      epochs=<span class="hljs-number">1</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      verbose=<span class="hljs-number">1</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      callbacks=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      validation_data=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      validation_steps=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      class_weight=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      max_queue_size=<span class="hljs-number">10</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      workers=<span class="hljs-number">1</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      use_multiprocessing=<span class="hljs-literal">False</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      shuffle=<span class="hljs-literal">True</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      initial_epoch=<span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                      get_predict = <span class="hljs-literal">False</span></span>):</span>    <span class="hljs-comment"># 加入 get_predict</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">return</span> training_generator.fit_generator(<br>            self, generator,<br>            steps_per_epoch=steps_per_epoch,<br>            epochs=epochs,<br>            verbose=verbose,<br>            callbacks=callbacks,<br>            validation_data=validation_data,<br>            validation_steps=validation_steps,<br>            class_weight=class_weight,<br>            max_queue_size=max_queue_size,<br>            workers=workers,<br>            use_multiprocessing=use_multiprocessing,<br>            shuffle=shuffle,<br>            initial_epoch=initial_epoch,<br>            get_predict = get_predict) <span class="hljs-comment"># 加入 get_predict</span><br></code></pre></td></tr></table></figure><h3 id="training-generator-fit-generator"><a href="#training-generator-fit-generator" class="headerlink" title="training_generator.fit_generator"></a>training_generator.fit_generator</h3><p><img src="https://photos.zywvvd.com/matrixtime/20200610155253.png"></p><blockquote><p>找到<code>training_generator.fit_generator</code>定义位置，加入<code>get_predict</code>:</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit_generator</span>(<span class="hljs-params">model,</span></span><br><span class="hljs-params"><span class="hljs-function">                  generator,</span></span><br><span class="hljs-params"><span class="hljs-function">                  steps_per_epoch=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  epochs=<span class="hljs-number">1</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  verbose=<span class="hljs-number">1</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  callbacks=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  validation_data=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  validation_steps=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  class_weight=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  max_queue_size=<span class="hljs-number">10</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  workers=<span class="hljs-number">1</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  use_multiprocessing=<span class="hljs-literal">False</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  shuffle=<span class="hljs-literal">True</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  initial_epoch=<span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                  get_predict = <span class="hljs-literal">False</span></span>):</span> <span class="hljs-comment"># 加入 get_predict</span><br></code></pre></td></tr></table></figure><blockquote><p>修改 # Epoch finished. 注释后的模块，可以看到Keras中<code>fit_generator</code>就是用<code>model.evaluate_generator</code>对验证集评估的：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Epoch finished.</span><br><span class="hljs-keyword">if</span> steps_done &gt;= steps_per_epoch <span class="hljs-keyword">and</span> do_validation:<br>    <span class="hljs-keyword">if</span> val_gen:<br>        <br>        <span class="hljs-keyword">if</span> get_predict:<br>            <span class="hljs-comment">## 如果启动获取预测结果功能，那么将get_predict设置为True</span><br>            <span class="hljs-comment">## 返回值会包括 gts_and_preds </span><br>            val_outs, gts_and_preds = model.evaluate_generator(<br>                val_enqueuer_gen,<br>                validation_steps,<br>                workers=<span class="hljs-number">0</span>,<br>                get_predict=get_predict)<br>        <span class="hljs-keyword">else</span>:<br>            val_outs = model.evaluate_generator(<br>                val_enqueuer_gen,<br>                validation_steps,<br>                workers=<span class="hljs-number">0</span>)                            <br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># No need for try/except because</span><br>        <span class="hljs-comment"># data has already been validated.</span><br>        val_outs = model.evaluate(<br>            val_x, val_y,<br>            batch_size=batch_size,<br>            sample_weight=val_sample_weights,<br>            verbose=<span class="hljs-number">0</span>)<br>    val_outs = to_list(val_outs)<br>    <span class="hljs-comment"># Same labels assumed.</span><br>    <span class="hljs-keyword">for</span> l, o <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(out_labels, val_outs):<br>        epoch_logs[<span class="hljs-string">&#x27;val_&#x27;</span> + l] = o<br>    <br>    <span class="hljs-comment">## 将返回值 gts_and_preds 保存到 log 中</span><br>    <span class="hljs-keyword">if</span> get_predict:<br>        epoch_logs[<span class="hljs-string">&#x27;val_gts_and_preds&#x27;</span>] = gts_and_preds<br>        <br><span class="hljs-keyword">if</span> callback_model.stop_training:<br>    <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure><h3 id="model-evaluate-generator"><a href="#model-evaluate-generator" class="headerlink" title="model.evaluate_generator"></a>model.evaluate_generator</h3><p><img src="https://photos.zywvvd.com/matrixtime/20200610155915.png"></p><blockquote><p>进入<code>model.evaluate_generator</code>函数，加入<code>get_predict</code>变量：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">evaluate_generator</span>(<span class="hljs-params">self, generator,</span></span><br><span class="hljs-params"><span class="hljs-function">                       steps=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       max_queue_size=<span class="hljs-number">10</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       workers=<span class="hljs-number">1</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       use_multiprocessing=<span class="hljs-literal">False</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       verbose=<span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       get_predict=<span class="hljs-literal">False</span></span>):</span> <span class="hljs-comment"># 加入get_predict变量</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">return</span> training_generator.evaluate_generator(<br>            self, generator,<br>            steps=steps,<br>            max_queue_size=max_queue_size,<br>            workers=workers,<br>            use_multiprocessing=use_multiprocessing,<br>            verbose=verbose,<br>            get_predict=get_predict) <span class="hljs-comment"># 加入get_predict变量</span><br></code></pre></td></tr></table></figure><h3 id="training-generator-evaluate-generator"><a href="#training-generator-evaluate-generator" class="headerlink" title="training_generator.evaluate_generator"></a>training_generator.evaluate_generator</h3><p><img src="https://photos.zywvvd.com/matrixtime/20200610163145.png"></p><blockquote><p>进入<code>training_generator.evaluate_generator</code>，添加<code>get_predict</code>变量，新建三个变量：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">evaluate_generator</span>(<span class="hljs-params">model, generator,</span></span><br><span class="hljs-params"><span class="hljs-function">                       steps=<span class="hljs-literal">None</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       max_queue_size=<span class="hljs-number">10</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       workers=<span class="hljs-number">1</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       use_multiprocessing=<span class="hljs-literal">False</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       verbose=<span class="hljs-number">0</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       get_predict=<span class="hljs-literal">False</span></span>):</span>  <span class="hljs-comment"># 加入get_predict变量</span><br>    <span class="hljs-string">&quot;&quot;&quot;See docstring for `Model.evaluate_generator`.&quot;&quot;&quot;</span><br>    model._make_test_function()<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(model, <span class="hljs-string">&#x27;metrics&#x27;</span>):<br>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> model.stateful_metric_functions:<br>            m.reset_states()<br>        stateful_metric_indices = [<br>            i <span class="hljs-keyword">for</span> i, name <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(model.metrics_names)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">str</span>(name) <span class="hljs-keyword">in</span> model.stateful_metric_names]<br>    <span class="hljs-keyword">else</span>:<br>        stateful_metric_indices = []<br><br>    steps_done = <span class="hljs-number">0</span><br>    wait_time = <span class="hljs-number">0.01</span><br>    outs_per_batch = []<br>    batch_sizes = []<br>      <br>    <span class="hljs-keyword">if</span> get_predict:<br>        preds_dict=&#123;&#125; <span class="hljs-comment"># 新建保存结果的dict</span><br>        gt_per_batch = [] <span class="hljs-comment"># 新建 y_true 的 list</span><br>        pr_per_batch = [] <span class="hljs-comment"># 新建 y_pred 的 list</span><br></code></pre></td></tr></table></figure><blockquote><p>在核心循环<code>while steps_done &lt; steps:</code>中加入预测变量的内容：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> steps_done &lt; steps:<br>            generator_output = <span class="hljs-built_in">next</span>(output_generator)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">hasattr</span>(generator_output, <span class="hljs-string">&#x27;__len__&#x27;</span>):<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Output of generator should be a tuple &#x27;</span><br>                                 <span class="hljs-string">&#x27;(x, y, sample_weight) &#x27;</span><br>                                 <span class="hljs-string">&#x27;or (x, y). Found: &#x27;</span> +<br>                                 <span class="hljs-built_in">str</span>(generator_output))<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(generator_output) == <span class="hljs-number">2</span>:<br>                x, y = generator_output<br>                sample_weight = <span class="hljs-literal">None</span><br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(generator_output) == <span class="hljs-number">3</span>:<br>                x, y, sample_weight = generator_output<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Output of generator should be a tuple &#x27;</span><br>                                 <span class="hljs-string">&#x27;(x, y, sample_weight) &#x27;</span><br>                                 <span class="hljs-string">&#x27;or (x, y). Found: &#x27;</span> +<br>                                 <span class="hljs-built_in">str</span>(generator_output))<br>            outs = model.test_on_batch(x, y, sample_weight=sample_weight)<br>            outs = to_list(outs)<br>            outs_per_batch.append(outs)<br>            <br>            <span class="hljs-comment">## 加入预测功能，保存preds和y_true</span><br>            <span class="hljs-keyword">if</span> get_predict:<br>                preds = model.predict_on_batch(x)<br>                gt_per_batch.append(y.tolist())<br>                pr_per_batch.append(preds.tolist())<br><br>            <span class="hljs-keyword">if</span> x <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(x) == <span class="hljs-number">0</span>:<br>                <span class="hljs-comment"># Handle data tensors support when no input given</span><br>                <span class="hljs-comment"># step-size = 1 for data tensors</span><br>                batch_size = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(x, <span class="hljs-built_in">list</span>):<br>                batch_size = x[<span class="hljs-number">0</span>].shape[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(x, <span class="hljs-built_in">dict</span>):<br>                batch_size = <span class="hljs-built_in">list</span>(x.values())[<span class="hljs-number">0</span>].shape[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">else</span>:<br>                batch_size = x.shape[<span class="hljs-number">0</span>]<br>            <span class="hljs-keyword">if</span> batch_size == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;Received an empty batch. &#x27;</span><br>                                 <span class="hljs-string">&#x27;Batches should contain &#x27;</span><br>                                 <span class="hljs-string">&#x27;at least one item.&#x27;</span>)<br>            steps_done += <span class="hljs-number">1</span><br>            batch_sizes.append(batch_size)<br>            <span class="hljs-keyword">if</span> verbose == <span class="hljs-number">1</span>:<br>                progbar.update(steps_done)<br>        <span class="hljs-comment">## 将结果保存到dict中</span><br>        <span class="hljs-keyword">if</span> get_predict:<br>            preds_dict[<span class="hljs-string">&#x27;y_true&#x27;</span>] = gt_per_batch<br>            preds_dict[<span class="hljs-string">&#x27;y_pred&#x27;</span>] = pr_per_batch<br></code></pre></td></tr></table></figure><blockquote><p>修改返回值：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> get_predict:<br>    <span class="hljs-keyword">return</span> unpack_singleton(averages), preds_dict<br><br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-keyword">return</span> unpack_singleton(averages)<br></code></pre></td></tr></table></figure><blockquote><p>至此核心的功能已经实现，但还有一个小问题。</p></blockquote><h3 id="keras-callbacks-TensorBoard-write-logs"><a href="#keras-callbacks-TensorBoard-write-logs" class="headerlink" title="keras.callbacks.TensorBoard._write_logs"></a>keras.callbacks.TensorBoard._write_logs</h3><p><img src="https://photos.zywvvd.com/matrixtime/20200610163226.png"></p><blockquote><p>Keras的Tensorboard会记录logs中的内容，但是他只认识 int, float 等数值格式，我们保存在log中的复杂字典他没办法写入tesnorboard，需要对<code>_write_logs</code>做微小的调整：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_write_logs</span>(<span class="hljs-params">self, logs, index</span>):</span><br>        <span class="hljs-keyword">for</span> name, value <span class="hljs-keyword">in</span> logs.items():<br>            <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;batch&#x27;</span>, <span class="hljs-string">&#x27;size&#x27;</span>]:<br>                <span class="hljs-keyword">continue</span><br>            summary = tf.Summary()<br>            summary_value = summary.value.add()<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(value, np.ndarray):<br>                summary_value.simple_value = value.item()<br>            <span class="hljs-comment">## 跳过我们生成的字典</span><br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">dict</span>):<br>                <span class="hljs-keyword">pass</span><br>            <span class="hljs-keyword">else</span>:<br>                summary_value.simple_value = value<br>            summary_value.tag = name<br>            self.writer.add_summary(summary, index)<br>        self.writer.flush()<br></code></pre></td></tr></table></figure><blockquote><p>大功告成！</p></blockquote><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><blockquote><p>随便写个带<code>on_epoch_end</code>的回调函数，将<code>get_predict</code>设置为True，测试logs中是否有我们想要的数据：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">model.fit_generator(<br>       generator = train_data_generator,<br>       steps_per_epoch = <span class="hljs-number">10</span>,<br>       epochs = config.Epochs,<br>       verbose = <span class="hljs-number">1</span>,<br>       use_multiprocessing=<span class="hljs-literal">False</span>,<br>       validation_data=val_data_generator,<br>       validation_steps=<span class="hljs-number">10</span>,<br>       callbacks = callbacks,<br>       get_predict= <span class="hljs-literal">True</span><br>   )      <br></code></pre></td></tr></table></figure><blockquote><p>回调函数设断点，输出logs：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python">logs[<span class="hljs-string">&#x27;val_gts_and_preds&#x27;</span>]<br>&#123;<span class="hljs-string">&#x27;y_pred&#x27;</span>: [[[<span class="hljs-number">2.5419962184969336e-05</span>, <span class="hljs-number">0.9999746084213257</span>],<br>             [<span class="hljs-number">0.6694663763046265</span>, <span class="hljs-number">0.33053362369537354</span>],<br>             [<span class="hljs-number">0.3561754524707794</span>, <span class="hljs-number">0.643824577331543</span>]],<br>            [[<span class="hljs-number">5.548826155499231e-12</span>, <span class="hljs-number">1.0</span>],<br>             [<span class="hljs-number">2.701560219975363e-08</span>, <span class="hljs-number">1.0</span>],<br>             [<span class="hljs-number">4.0011427699937485e-06</span>, <span class="hljs-number">0.9999959468841553</span>]],<br>            [[<span class="hljs-number">7.97858723533551e-11</span>, <span class="hljs-number">1.0</span>],<br>             [<span class="hljs-number">2.3924835659272503e-06</span>, <span class="hljs-number">0.999997615814209</span>],<br>             [<span class="hljs-number">3.359668880875688e-07</span>, <span class="hljs-number">0.9999996423721313</span>]],<br>            [[<span class="hljs-number">0.06622887402772903</span>, <span class="hljs-number">0.9337711930274963</span>],<br>             [<span class="hljs-number">4.1211248458239425e-07</span>, <span class="hljs-number">0.9999996423721313</span>],<br>             [<span class="hljs-number">8.561290087527595e-06</span>, <span class="hljs-number">0.9999914169311523</span>]],<br>            [[<span class="hljs-number">9.313887403550325e-07</span>, <span class="hljs-number">0.9999990463256836</span>],<br>             [<span class="hljs-number">2.614793537247806e-08</span>, <span class="hljs-number">1.0</span>],<br>             [<span class="hljs-number">8.66139725985704e-06</span>, <span class="hljs-number">0.9999912977218628</span>]],<br>            [[<span class="hljs-number">7.047830763440288e-09</span>, <span class="hljs-number">1.0</span>],<br>             [<span class="hljs-number">0.010548637248575687</span>, <span class="hljs-number">0.9894513487815857</span>],<br>             [<span class="hljs-number">1.8744471252940542e-10</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">8.760089875714527e-11</span>, <span class="hljs-number">1.0</span>],<br>             [<span class="hljs-number">0.0015734446933493018</span>, <span class="hljs-number">0.9984265565872192</span>],<br>             [<span class="hljs-number">1.5642463040421717e-06</span>, <span class="hljs-number">0.9999984502792358</span>]],<br>            [[<span class="hljs-number">0.004750440828502178</span>, <span class="hljs-number">0.9952495098114014</span>],<br>             [<span class="hljs-number">6.984401466070267e-07</span>, <span class="hljs-number">0.9999992847442627</span>],<br>             [<span class="hljs-number">0.00013592069444712251</span>, <span class="hljs-number">0.9998641014099121</span>]],<br>            [[<span class="hljs-number">7.22906318140204e-11</span>, <span class="hljs-number">1.0</span>],<br>             [<span class="hljs-number">2.402198795437016e-08</span>, <span class="hljs-number">1.0</span>],<br>             [<span class="hljs-number">9.673745138272238e-10</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">3.1848256298872e-07</span>, <span class="hljs-number">0.9999996423721313</span>],<br>             [<span class="hljs-number">0.0035940599627792835</span>, <span class="hljs-number">0.9964058995246887</span>],<br>             [<span class="hljs-number">1.9458911912351162e-11</span>, <span class="hljs-number">1.0</span>]]],<br> <span class="hljs-string">&#x27;y_true&#x27;</span>: [[[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]],<br>            [[<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]]]&#125;<br></code></pre></td></tr></table></figure><blockquote><p>之后这些结果任君处置了；</p></blockquote><h2 id="附"><a href="#附" class="headerlink" title="附"></a>附</h2><blockquote><p>将<code>get_predict</code>设为 False 时则屏蔽了我们做出的所有修改，与原始Keras代码完全相同；</p><p>目前没有发现其他的问题，有任何不对头可以随时交流。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>Keras</category>
      
    </categories>
    
    
    <tags>
      
      <tag>深度学习</tag>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mount 命令(一) —— Liunx下设置共享文件夹，用于mount挂载文件</title>
    <link href="/2020/06/03/linux/mount/mount-settings/mount-settings/"/>
    <url>/2020/06/03/linux/mount/mount-settings/mount-settings/</url>
    
    <content type="html"><![CDATA[<blockquote><p>磁盘挂载是同步共享、同步文件的好方法，默认文件夹不具有共享能力，本文记录将Linux中文件夹设置成可mount的方法。</p></blockquote><span id="more"></span><h3 id="预备条件"><a href="#预备条件" class="headerlink" title="预备条件"></a>预备条件</h3><h4 id="使用Win-10-专业版"><a href="#使用Win-10-专业版" class="headerlink" title="使用Win 10 专业版"></a>使用Win 10 专业版</h4><ul><li>Win 10 事实上都是内置了NFS服务的，使用专业版或企业版直接带有NFS</li><li>家庭版没有开启这部分功能，需要<a href="https://www.zywvvd.com/2020/06/02/windows/windows-family-nfs/windows-family-nfs/#%E5%8D%87%E7%BA%A7-Windows-10">升级为专业版或企业版</a></li></ul><h4 id="开启NFS服务"><a href="#开启NFS服务" class="headerlink" title="开启NFS服务"></a>开启NFS服务</h4><ul><li>Win默认NFS服务是关闭的</li><li>需要手动开启</li><li><a href="https://www.zywvvd.com/2020/06/02/windows/windows-family-nfs/windows-family-nfs/#%E5%BC%80%E5%90%AFNFS%E6%9C%8D%E5%8A%A1">开启NFS服务</a></li></ul><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><blockquote><p>我们想把192.168.10.80 Linux服务器中的 <code>/disk/zhangyiwei</code>文件夹共享，以便在Windows 10系统中加载。</p></blockquote><ul><li>当前80服务器中没有可见的 <code>/disk/zhangyiwei</code>文件夹可用于挂载</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200603165054.png"></p><h3 id="设置共享文件夹"><a href="#设置共享文件夹" class="headerlink" title="设置共享文件夹"></a>设置共享文件夹</h3><blockquote><p>共享文件夹在<code>/etc/exports</code>文件中配置，在文件末尾添加：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs exports">/root/zhangyiwei/ 192.168.10.219(rw,no_root_squash,no_all_squash,sync)<br></code></pre></td></tr></table></figure><ul><li><p>/root/zhangyiwei/   为共享的路径</p></li><li><p>192.168.10.219 为主机名，一般用以下设置</p><ul><li><p>可以使用ip或网络号：例如 192.168.12.20 或者192.168.12.0/24 或者192.168.100.0/255.255.255.0都可以</p></li><li><p>可以使用主机名，但是这主机名必须在/etc/hosts内配置</p></li></ul></li><li><p>rw/ro</p><ul><li>rw表示（read-write）可读写，ro表示（read-only）只读</li></ul></li><li><p>sync/async</p><ul><li><p>sync表示数据同步写入到内存与硬盘中，async表示数据会暂存与内存中，而非直接写入硬盘</p></li><li><p>no_root_squash/root_squash反正就是客户端访问权限的问题，需要开放no_root_squash</p></li></ul></li><li><p>all_squash不论登录NFS的用户身份为何，他的身份都会被压缩成为匿名用户，通常也就是nobody(nfsnobody)</p></li></ul><h3 id="重新加载-etc-exports文件"><a href="#重新加载-etc-exports文件" class="headerlink" title="重新加载/etc/exports文件"></a>重新加载/etc/exports文件</h3><blockquote><p>修改完<code>/etc/exports</code>文件后并不能即时生效，需要命令（需要root权限）：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo exportfs -a<br></code></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>使用命令 <code>showmount -e IP</code>可以查看主机中可mount的文件夹</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> showmount -e 192.168.10.80</span><br>Export list for 192.168.10.80:<br>/disk/zhangyiwei *<br>/disk/lujunyi    *<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/matrixtime/20200603171804.png"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 Windows 10 家庭版没有NFS服务无法挂载磁盘的问题</title>
    <link href="/2020/06/02/windows/windows-family-nfs/windows-family-nfs/"/>
    <url>/2020/06/02/windows/windows-family-nfs/windows-family-nfs/</url>
    
    <content type="html"><![CDATA[<blockquote><p> NFS服务可以方便地将网络磁盘挂载到本地，进行文件同步，但Windows 10 家庭版不支持该功能。本文记录不需要重装系统不用换Linux不装虚拟机的根本性无痛解决方案。</p></blockquote><span id="more"></span><h2 id="升级-Windows-10"><a href="#升级-Windows-10" class="headerlink" title="升级 Windows 10"></a>升级 Windows 10</h2><blockquote><p>将家庭版Win10 升级到企业版，系统便会自带NFS服务。</p></blockquote><h3 id="序列号"><a href="#序列号" class="headerlink" title="序列号"></a>序列号</h3><blockquote><p>2020.06.02 亲测有效，感谢：<a href="https://www.jianshu.com/p/3f9e2368e546">https://www.jianshu.com/p/3f9e2368e546</a> 分享</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">J7QT3</span>-<span class="hljs-number">3</span>GCPG-<span class="hljs-number">9</span>GVWT-CH<span class="hljs-number">2</span>XR-GMRJM<br><span class="hljs-attribute">VK7JG</span>-NPHTM-C<span class="hljs-number">97</span>JM-<span class="hljs-number">9</span>MPGT-<span class="hljs-number">3</span>V<span class="hljs-number">66</span>T<br></code></pre></td></tr></table></figure><h3 id="替换产品序列号"><a href="#替换产品序列号" class="headerlink" title="替换产品序列号"></a>替换产品序列号</h3><ul><li>右键 我的电脑 -&gt; 属性 -&gt; 更改产品密钥</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200602172554.png"></p><ul><li>输入企业版密钥，关闭当前工作的程序并保存工作进度，一路下一步即可</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200602172926.png"></p><h2 id="开启NFS服务"><a href="#开启NFS服务" class="headerlink" title="开启NFS服务"></a>开启NFS服务</h2><ul><li>控制面板 -&gt; 程序和功能 -&gt; 勾选NFS服务 -&gt; 确定</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200602173153.png"></p><ul><li>在CMD中测试，输入 mount -h 查看输出</li></ul><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">C:\<span class="hljs-title">Users</span>\<span class="hljs-title">Admin</span>&gt;<span class="hljs-title">mount</span> -<span class="hljs-title">h</span></span><br><span class="hljs-function">用法:  <span class="hljs-title">mount</span> [-<span class="hljs-title">o</span> <span class="hljs-title">options</span>] [-<span class="hljs-title">u:username</span>] [-<span class="hljs-title">p</span>:&lt;<span class="hljs-title">password</span> | *&gt;] &lt;\\<span class="hljs-title">computername</span>\<span class="hljs-title">sharename</span>&gt; &lt;<span class="hljs-title">devicename</span> | *&gt;</span><br><span class="hljs-function"></span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">rsize</span>=<span class="hljs-title">size</span>               设置读取缓冲区的大小(以 <span class="hljs-title">KB</span> 为单位)。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">wsize</span>=<span class="hljs-title">size</span>               设置写入缓冲区的大小(以 <span class="hljs-title">KB</span> 为单位)。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">timeout</span>=<span class="hljs-title">time</span>             设置 <span class="hljs-title">RPC</span> 调用的超时值(以秒为单位)。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">retry</span>=<span class="hljs-title">number</span>             设置软装载的重试次数。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">mtype</span>=<span class="hljs-title">soft</span>|<span class="hljs-title">hard</span>          设置装载类型。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">lang</span>=<span class="hljs-title">euc</span>-<span class="hljs-title">jp</span>|<span class="hljs-title">euc</span>-<span class="hljs-title">tw</span>|<span class="hljs-title">euc</span>-<span class="hljs-title">kr</span>|<span class="hljs-title">shift</span>-<span class="hljs-title">jis</span>|<span class="hljs-title">big5</span>|<span class="hljs-title">ksc5601</span>|<span class="hljs-title">gb2312</span>-80|<span class="hljs-title">ansi</span></span><br><span class="hljs-function">                            指定用于文件和目录名称的编码。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">fileaccess</span>=<span class="hljs-title">mode</span>          指定文件的权限模式。</span><br><span class="hljs-function">                            这些模式用于在 <span class="hljs-title">NFS</span> 服务器上创建的</span><br><span class="hljs-function">                            新文件。使用 <span class="hljs-title">UNIX</span> 样式模式位指定。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">anon</span>                     作为匿名用户装载。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">nolock</span>                   禁用锁定。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">casesensitive</span>=<span class="hljs-title">yes</span>|<span class="hljs-title">no</span>     指定在服务器上执行区分大小写的文件查找。</span><br><span class="hljs-function">-<span class="hljs-title">o</span> <span class="hljs-title">sec</span>=<span class="hljs-title">sys</span>|<span class="hljs-title">krb5</span>|<span class="hljs-title">krb5i</span>|<span class="hljs-title">krb5p</span></span><br></code></pre></td></tr></table></figure><blockquote><p>有此类输出表明NFS服务启动成功。</p></blockquote><h2 id="磁盘挂载"><a href="#磁盘挂载" class="headerlink" title="磁盘挂载"></a>磁盘挂载</h2><ul><li>映射磁盘驱动器</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200602173956.png"></p><ul><li>映射网络上的一个地址即可</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200602174125.png"></p><ul><li>映射成功</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200602174202.png"></p><h3 id="莫名其妙挂载失败的问题"><a href="#莫名其妙挂载失败的问题" class="headerlink" title="莫名其妙挂载失败的问题"></a>莫名其妙挂载失败的问题</h3><blockquote><p>在cmd中输入命令</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">showmount -e &lt;ip 需要挂载远程的地址&gt;<br></code></pre></td></tr></table></figure><blockquote><p>可以显示对方可挂载的目录</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">showmount -e 192.168.10.15<br>导出列表在 192.168.10.15:<br>/disk/zhangyiwei                   *<br></code></pre></td></tr></table></figure><blockquote><p>然而挂载时却出现奇怪的错误，诸如：</p></blockquote><ul><li>提示目标地址不存在，提醒检查拼写</li><li>出现未知错误</li></ul><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><ul><li>无脑关闭NFS服务</li><li>重启电脑</li><li>打开NFS服务</li></ul><blockquote><p>就好了。。。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
      <category>Windows 10</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>Windows 10</tag>
      
      <tag>软件</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Windows pip upgrade 报错 No module named &#39;pip&#39;</title>
    <link href="/2020/05/30/coding/environment/pip-upgrade-error/pip-upgrade-error/"/>
    <url>/2020/05/30/coding/environment/pip-upgrade-error/pip-upgrade-error/</url>
    
    <content type="html"><![CDATA[<blockquote><p>windws 10 下升级 pip ，升级时下载安装包，卸载原有pip成功，在安装新pip包时因种种原因安装失败会导致pip被卸载，本文记录修复方法 。</p></blockquote><span id="more"></span><h3 id="常见原因"><a href="#常见原因" class="headerlink" title="常见原因"></a>常见原因</h3><ul><li>Windows 中anaconda文件夹没有为users用户开放全部控制权限</li><li>在更新pip时命令为（<strong>这是错误的命令</strong>）：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install -U pip<br></code></pre></td></tr></table></figure><blockquote><p>此时pip从服务器下载了最新的pip安装包，卸载了原来的pip，但是没有权限安装新的pip</p><p>导致使用此命令更新pip后无pip可用</p></blockquote><h3 id="正确命令shell"><a href="#正确命令shell" class="headerlink" title="正确命令shell"></a>正确命令shell</h3><ul><li>在选项中加入 –user</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install --upgrade pip --user<br></code></pre></td></tr></table></figure><h3 id="修复命令"><a href="#修复命令" class="headerlink" title="修复命令"></a>修复命令</h3><ul><li>如果不慎中招，可以使用如下命令恢复</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">python -m ensurepip<br>python -m pip install --upgrade pip<br></code></pre></td></tr></table></figure><h3 id="实际效果"><a href="#实际效果" class="headerlink" title="实际效果"></a>实际效果</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> pip list</span><br>Traceback (most recent call last):<br>  File &quot;e:\program_files\annoconda\lib\runpy.py&quot;, line 193, in _run_module_as_main<br>    &quot;__main__&quot;, mod_spec)<br>  File &quot;e:\program_files\annoconda\lib\runpy.py&quot;, line 85, in _run_code<br>    exec(code, run_globals)<br>  File &quot;E:\Program_Files\Annoconda\Scripts\pip.exe\__main__.py&quot;, line 4, in &lt;module&gt;<br>ModuleNotFoundError: No module named &#x27;pip&#x27;<br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> python -m ensurepip</span><br>Looking in links: C:\Users\Admin\AppData\Local\Temp\tmp1ggp6o2t<br>Requirement already satisfied: setuptools in e:\program_files\annoconda\lib\site-packages (45.1.0)<br>Collecting pip<br>jupyterlab 2.1.0 has requirement jupyterlab_server&gt;=1.1.0, but you&#x27;ll have jupyterlab-server 1.0.0 which is incompatible.<br>jupyterlab-server 1.0.0 has requirement jsonschema&gt;=3.0.1, but you&#x27;ll have jsonschema 2.6.0 which is incompatible.<br>imgviz 1.1.0 has requirement Pillow&gt;=5.3.0, but you&#x27;ll have pillow 5.2.0 which is incompatible.<br>Installing collected packages: pip<br>Successfully installed pip-10.0.1<br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> python -m pip install --upgrade pip</span><br>Looking in indexes: https://mirrors.aliyun.com/pypi/simple/<br>Collecting pip<br>  Using cached https://mirrors.aliyun.com/pypi/packages/43/84/23ed6a1796480a6f1a2d38f2802901d078266bda38388954d01d3f2e821d/pip-20.1.1-py2.py3-none-any.whl<br>jupyterlab 2.1.0 has requirement jupyterlab_server&gt;=1.1.0, but you&#x27;ll have jupyterlab-server 1.0.0 which is incompatible.<br>jupyterlab-server 1.0.0 has requirement jsonschema&gt;=3.0.1, but you&#x27;ll have jsonschema 2.6.0 which is incompatible.<br>imgviz 1.1.0 has requirement Pillow&gt;=5.3.0, but you&#x27;ll have pillow 5.2.0 which is incompatible.<br>Installing collected packages: pip<br>  Found existing installation: pip 10.0.1<br>    Uninstalling pip-10.0.1:<br>      Successfully uninstalled pip-10.0.1<br>Successfully installed pip-20.1.1<br>You are using pip version 20.1.1, however version 20.2b1 is available.<br>You should consider upgrading via the &#x27;python -m pip install --upgrade pip&#x27; command.<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>程序人生</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>程序人生</tag>
      
      <tag>故障排除</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keras 在网络中自定义切割数据层</title>
    <link href="/2020/05/25/deep_learning/keras/keras-sclice-data/keras-sclice-data/"/>
    <url>/2020/05/25/deep_learning/keras/keras-sclice-data/keras-sclice-data/</url>
    
    <content type="html"><![CDATA[<blockquote><p>keras支持Lambda可以实现数据自定义处理操作，本文记录切割、截取网络层数据Lambda层实现方法。</p></blockquote><span id="more"></span><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><blockquote><p>需要在网络层中选取某层，截取其中部分特征，用于模型的特征处理。</p></blockquote><h2 id="切割函数"><a href="#切割函数" class="headerlink" title="切割函数"></a>切割函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cut_map</span>(<span class="hljs-params">x,index</span>):</span><br>    <span class="hljs-keyword">return</span> x[:, index:-index, index:-index, :]<br></code></pre></td></tr></table></figure><h2 id="加入网络层"><a href="#加入网络层" class="headerlink" title="加入网络层"></a>加入网络层</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">x = Lambda(cut_map, arguments=&#123;<span class="hljs-string">&#x27;index&#x27;</span>:<span class="hljs-number">32</span>&#125;, name = <span class="hljs-string">&#x27;classify_Lambda&#x27;</span>)(x)<br></code></pre></td></tr></table></figure><h2 id="网络效果"><a href="#网络效果" class="headerlink" title="网络效果"></a>网络效果</h2><p><img src="https://photos.zywvvd.com/matrixtime/20200525210335.png"></p><h2 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h2><ul><li>建议该层主要用于训练好的模型的特征处理，直接放入准备训练的模型会造成该层无法传播梯度。</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>Keras</category>
      
    </categories>
    
    
    <tags>
      
      <tag>深度学习</tag>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keras 分割网络自定义评估函数 - mean iou</title>
    <link href="/2020/05/25/deep_learning/keras/my-mean-iou/my-mean-iou/"/>
    <url>/2020/05/25/deep_learning/keras/my-mean-iou/my-mean-iou/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Keras训练网络过程中需要实时观察性能，mean iou不是keras自带的评估函数，tf的又觉得不好用，自己写了一个，经过测试没有问题，本文记录自定义keras mean iou评估的实现方法。</p></blockquote><span id="more"></span><h2 id="计算-IoU"><a href="#计算-IoU" class="headerlink" title="计算 IoU"></a>计算 IoU</h2><blockquote><p>用numpy计算的，作为IoU的ground truth用作测试使用：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">iou_numpy</span>(<span class="hljs-params">y_true,y_pred</span>):</span><br>    <br>    intersection = np.<span class="hljs-built_in">sum</span>(np.multiply(y_true.astype(<span class="hljs-string">&#x27;bool&#x27;</span>),y_pred == <span class="hljs-number">1</span>))<br>    union = np.<span class="hljs-built_in">sum</span>((y_true.astype(<span class="hljs-string">&#x27;bool&#x27;</span>)+y_pred.astype(<span class="hljs-string">&#x27;bool&#x27;</span>))&gt;<span class="hljs-number">0</span>)    <br>    <br>    <span class="hljs-keyword">return</span> intersection/union<br></code></pre></td></tr></table></figure><blockquote><p>keras metric IoU</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">iou_keras</span>(<span class="hljs-params">y_true, y_pred</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Return the Intersection over Union (IoU).</span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        y_true: the expected y values as a one-hot</span><br><span class="hljs-string">        y_pred: the predicted y values as a one-hot or softmax output</span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        the IoU for the given label</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    label = <span class="hljs-number">1</span><br>    <span class="hljs-comment"># extract the label values using the argmax operator then</span><br>    <span class="hljs-comment"># calculate equality of the predictions and truths to the label</span><br>    y_true = K.cast(K.equal(y_true, label), K.floatx())<br>    y_pred = K.cast(K.equal(y_pred, label), K.floatx())<br>    <span class="hljs-comment"># calculate the |intersection| (AND) of the labels</span><br>    intersection = K.<span class="hljs-built_in">sum</span>(y_true * y_pred)<br>    <span class="hljs-comment"># calculate the |union| (OR) of the labels</span><br>    union = K.<span class="hljs-built_in">sum</span>(y_true) + K.<span class="hljs-built_in">sum</span>(y_pred) - intersection<br>    <span class="hljs-comment"># avoid divide by zero - if the union is zero, return 1</span><br>    <span class="hljs-comment"># otherwise, return the intersection over union</span><br>    <span class="hljs-keyword">return</span> K.switch(K.equal(union, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, intersection / union)<br></code></pre></td></tr></table></figure><h2 id="计算-mean-IoU"><a href="#计算-mean-IoU" class="headerlink" title="计算 mean IoU"></a>计算 mean IoU</h2><blockquote><p>mean IoU 简便起见，选取 (0,1,0.05) 作为不同的IoU阈值，计算平均IoU</p><p>numpy 真实值计算</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mean_iou_numpy</span>(<span class="hljs-params">y_true,y_pred</span>):</span><br>    <br>    iou_list = []<br>    <span class="hljs-keyword">for</span> thre <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(np.arange(<span class="hljs-number">0.0000001</span>,<span class="hljs-number">0.99</span>,<span class="hljs-number">0.05</span>)):<br>        y_pred_temp = y_pred &gt;= thre<br>        iou = iou_numpy(y_true, y_pred_temp)<br>        iou_list.append(iou)<br><br>    <span class="hljs-keyword">return</span> np.mean(iou_list)<br></code></pre></td></tr></table></figure><blockquote><p>Keras  mean IoU </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mean_iou_keras</span>(<span class="hljs-params">y_true, y_pred</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Return the mean Intersection over Union (IoU).</span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        y_true: the expected y values as a one-hot</span><br><span class="hljs-string">        y_pred: the predicted y values as a one-hot or softmax output</span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        the mean IoU</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    label = <span class="hljs-number">1</span><br>    <span class="hljs-comment"># extract the label values using the argmax operator then</span><br>    <span class="hljs-comment"># calculate equality of the predictions and truths to the label</span><br>    y_true = K.cast(K.equal(y_true, label), K.floatx())<br>    <br>    mean_iou = K.variable(<span class="hljs-number">0</span>)<br>    <br>    thre_list = <span class="hljs-built_in">list</span>(np.arange(<span class="hljs-number">0.0000001</span>,<span class="hljs-number">0.99</span>,<span class="hljs-number">0.05</span>))<br>    <br>    <span class="hljs-keyword">for</span> thre <span class="hljs-keyword">in</span> thre_list:<br>        <br>        y_pred_temp = K.cast(y_pred &gt;= thre, K.floatx())<br>        y_pred_temp = K.cast(K.equal(y_pred_temp, label), K.floatx())<br>        <span class="hljs-comment"># calculate the |intersection| (AND) of the labels</span><br>        intersection = K.<span class="hljs-built_in">sum</span>(y_true * y_pred_temp)<br>        <span class="hljs-comment"># calculate the |union| (OR) of the labels</span><br>        union = K.<span class="hljs-built_in">sum</span>(y_true) + K.<span class="hljs-built_in">sum</span>(y_pred_temp) - intersection<br>        iou = K.switch(K.equal(union, <span class="hljs-number">0</span>), <span class="hljs-number">1.0</span>, intersection / union)<br>        mean_iou = mean_iou + iou<br>    <br>    <span class="hljs-keyword">return</span> mean_iou / <span class="hljs-built_in">len</span>(thre_list)<br></code></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 随机生成预测值</span><br>y_true_np = np.ones([<span class="hljs-number">10</span>,<span class="hljs-number">10</span>])<br>y_pred_np = np.random.rand(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>)<br><br><span class="hljs-comment">## 真实IoU值</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27; iou : <span class="hljs-subst">&#123;iou_numpy(y_true_np, y_pred_np)&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27; mean_iou_numpy : <span class="hljs-subst">&#123;mean_iou_numpy(y_true_np, y_pred_np)&#125;</span>&#x27;</span>)<br><br>y_true = tf.Variable(y_true_np)<br>y_pred = tf.Variable(y_pred_np)<br><br><span class="hljs-comment">## 计算节点</span><br>iou_res = iou_keras (y_true, y_pred)<br>m_iou_res = mean_iou_keras (y_true, y_pred)<br><br><span class="hljs-comment">## 变量初始化</span><br>init_op = tf.global_variables_initializer()<br><br><span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>    sess.run(init_op)<br>    <br>    <span class="hljs-comment">## 由于存在误差，结果在0.0000001范围内即可认为相同</span><br>    <br>    result = sess.run(iou_res)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;result : <span class="hljs-subst">&#123;result&#125;</span> \nsame with ground truth: <span class="hljs-subst">&#123;<span class="hljs-built_in">abs</span>(iou_numpy(y_true_np, y_pred_np) - result)&lt; <span class="hljs-number">0.0000001</span>&#125;</span>&#x27;</span>)<br>    <br>    result = sess.run(m_iou_res)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;result : <span class="hljs-subst">&#123;result&#125;</span> \nsame with ground truth: <span class="hljs-subst">&#123;<span class="hljs-built_in">abs</span>(mean_iou_numpy(y_true_np, y_pred_np) - result) &lt; <span class="hljs-number">0.0000001</span>&#125;</span>&#x27;</span>)   <br></code></pre></td></tr></table></figure><blockquote><p>输出：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">iou : <span class="hljs-number">0.0</span><br>mean_iou_numpy : <span class="hljs-number">0.5295</span><br>result : <span class="hljs-number">0.0</span> <br>same <span class="hljs-keyword">with</span> ground truth: <span class="hljs-literal">True</span><br>result : <span class="hljs-number">0.5295000076293945</span> <br>same <span class="hljs-keyword">with</span> ground truth: <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><h3 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h3><p><a href="https://github.com/zywvvd/Python_Practise">https://github.com/zywvvd/Python_Practise</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>Keras</category>
      
    </categories>
    
    
    <tags>
      
      <tag>深度学习</tag>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Keras 模型多输出 loss weight metrics 设置</title>
    <link href="/2020/05/25/deep_learning/keras/keras-multi-metrics/keras-multi-metrics/"/>
    <url>/2020/05/25/deep_learning/keras/keras-multi-metrics/keras-multi-metrics/</url>
    
    <content type="html"><![CDATA[<blockquote><p>keras支持模型多输入多输出，本文记录多输出时loss、loss weight和metrics的设置方式。</p></blockquote><span id="more"></span><h2 id="模型输出"><a href="#模型输出" class="headerlink" title="模型输出"></a>模型输出</h2><blockquote><p>假设模型具有多个输出</p></blockquote><ul><li>classify： 二维数组，分类softmax输出，需要配置交叉熵损失</li><li>segmentation：与输入同尺寸map，sigmoid输出，需要配置二分类损失</li><li>others：自定义其他输出，需要自定义损失</li></ul><h2 id="具体配置"><a href="#具体配置" class="headerlink" title="具体配置"></a>具体配置</h2><h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><ul><li>变量均为模型中网络层</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">inputs = [input_1 , input_2]<br>outputs = [classify, segmentation, others]<br>model = keras.models.Model(inputs, outputs)<br></code></pre></td></tr></table></figure><h3 id="loss"><a href="#loss" class="headerlink" title="loss"></a>loss</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">my_loss = &#123;<br>    <span class="hljs-string">&#x27;classify&#x27;</span>: <span class="hljs-string">&#x27;categorical_crossentropy&#x27;</span>,\<br>    <span class="hljs-string">&#x27;segmentation&#x27;</span>:<span class="hljs-string">&#x27;binary_crossentropy&#x27;</span>,\<br>    <span class="hljs-string">&#x27;others&#x27;</span>:my_loss_fun&#125;<br></code></pre></td></tr></table></figure><h3 id="loss-weight"><a href="#loss-weight" class="headerlink" title="loss weight"></a>loss weight</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">my_loss_weights = &#123;<br>    <span class="hljs-string">&#x27;classify&#x27;</span>:<span class="hljs-number">1</span>,\<br>    <span class="hljs-string">&#x27;segmentation&#x27;</span>:<span class="hljs-number">1</span>,\<br>    <span class="hljs-string">&#x27;others&#x27;</span>:<span class="hljs-number">10</span>&#125;<br></code></pre></td></tr></table></figure><h3 id="metrics"><a href="#metrics" class="headerlink" title="metrics"></a>metrics</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">my_metrics =&#123;<br>    <span class="hljs-string">&#x27;classify&#x27;</span>:<span class="hljs-string">&#x27;acc&#x27;</span>,\<br>    <span class="hljs-string">&#x27;segmentation&#x27;</span>:[mean_iou,<span class="hljs-string">&#x27;acc&#x27;</span>],\<br>    <span class="hljs-string">&#x27;others&#x27;</span>:[<span class="hljs-string">&#x27;mse&#x27;</span>,<span class="hljs-string">&#x27;acc&#x27;</span>]<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">model.<span class="hljs-built_in">compile</span>(optimizer=Adam(lr=config.LEARNING_RATE), loss=my_loss, loss_weights= my_loss_weights, metrics= my_metrics)<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>Keras</category>
      
    </categories>
    
    
    <tags>
      
      <tag>深度学习</tag>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>算法学习笔记 —— 链表</title>
    <link href="/2020/05/21/algorithm/list/about_list/"/>
    <url>/2020/05/21/algorithm/list/about_list/</url>
    
    <content type="html"><![CDATA[<blockquote><p>学而时习，本文记录链表操作相关算法练习笔记。</p></blockquote><span id="more"></span><h3 id="反转链表"><a href="#反转链表" class="headerlink" title="反转链表"></a>反转链表</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><p>输入一个链表，反转链表后，输出新链表的表头。</p><h4 id="解题代码"><a href="#解题代码" class="headerlink" title="解题代码"></a>解题代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding:utf-8 -*-</span><br><span class="hljs-comment"># class ListNode:</span><br><span class="hljs-comment">#     def __init__(self, x):</span><br><span class="hljs-comment">#         self.val = x</span><br><span class="hljs-comment">#         self.next = None</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span>:</span><br>    <span class="hljs-comment"># 返回ListNode</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">ReverseList</span>(<span class="hljs-params">self, pHead</span>):</span><br>        <span class="hljs-comment"># write code here</span><br>        last_node = <span class="hljs-literal">None</span><br>        current_node = pHead<br>        <br>        <span class="hljs-keyword">while</span> current_node <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            next_node = current_node.<span class="hljs-built_in">next</span><br>            current_node.<span class="hljs-built_in">next</span> = last_node<br>            last_node = current_node<br>            current_node = next_node<br><br>        <span class="hljs-keyword">return</span> last_node<br></code></pre></td></tr></table></figure><h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4><table><thead><tr><th>时间</th><th>空间</th></tr></thead><tbody><tr><td>O(n)</td><td>O(1)</td></tr></tbody></table><h4 id="解题备注"><a href="#解题备注" class="headerlink" title="解题备注"></a>解题备注</h4><ul><li>维护当前节点，顺带考虑前后节点，会比较稳健</li><li>设置虚拟前置节点，现场生成后置节点，更加鲁棒，甚至同时囊括了输入为None的情况</li><li>需要注意返回前置节点作为新链表头</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
      <category>链表</category>
      
    </categories>
    
    
    <tags>
      
      <tag>算法</tag>
      
      <tag>链表</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>算法学习笔记 —— XX</title>
    <link href="/2020/05/21/algorithm/example/about_exam/"/>
    <url>/2020/05/21/algorithm/example/about_exam/</url>
    
    <content type="html"><![CDATA[<blockquote><p>学而时习，本文记录XX操作相关算法练习笔记。</p></blockquote><span id="more"></span><h3 id="XXXXX"><a href="#XXXXX" class="headerlink" title="XXXXX"></a>XXXXX</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><h4 id="测试样例"><a href="#测试样例" class="headerlink" title="测试样例"></a>测试样例</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h4 id="解题代码"><a href="#解题代码" class="headerlink" title="解题代码"></a>解题代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4><table><thead><tr><th>时间</th><th>空间</th></tr></thead><tbody><tr><td>O()</td><td>O()</td></tr></tbody></table><h4 id="解题备注"><a href="#解题备注" class="headerlink" title="解题备注"></a>解题备注</h4><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
      <category>XX</category>
      
    </categories>
    
    
    <tags>
      
      <tag>算法</tag>
      
      <tag>XX</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>算法学习笔记 —— 排序</title>
    <link href="/2020/05/21/algorithm/sort/about_sort/"/>
    <url>/2020/05/21/algorithm/sort/about_sort/</url>
    
    <content type="html"><![CDATA[<blockquote><p>学而时习，本文记录排序操作相关算法练习笔记。</p></blockquote><span id="more"></span><h3 id="寻找第K大"><a href="#寻找第K大" class="headerlink" title="寻找第K大"></a>寻找第K大</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><h4 id="测试样例"><a href="#测试样例" class="headerlink" title="测试样例"></a>测试样例</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h4 id="解题代码"><a href="#解题代码" class="headerlink" title="解题代码"></a>解题代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4><table><thead><tr><th>时间</th><th>空间</th></tr></thead><tbody><tr><td>O()</td><td>O()</td></tr></tbody></table><h4 id="解题备注"><a href="#解题备注" class="headerlink" title="解题备注"></a>解题备注</h4><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
      <category>排序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>算法</tag>
      
      <tag>排序</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>算法学习笔记 —— 排序</title>
    <link href="/2020/05/21/algorithm/tree/about_tree/"/>
    <url>/2020/05/21/algorithm/tree/about_tree/</url>
    
    <content type="html"><![CDATA[<blockquote><p>学而时习，本文记录排序操作相关算法练习笔记。</p></blockquote><span id="more"></span><h3 id="寻找第K大"><a href="#寻找第K大" class="headerlink" title="寻找第K大"></a>寻找第K大</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><h4 id="测试样例"><a href="#测试样例" class="headerlink" title="测试样例"></a>测试样例</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><h4 id="解题代码"><a href="#解题代码" class="headerlink" title="解题代码"></a>解题代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4><table><thead><tr><th>时间</th><th>空间</th></tr></thead><tbody><tr><td>O()</td><td>O()</td></tr></tbody></table><h4 id="解题备注"><a href="#解题备注" class="headerlink" title="解题备注"></a>解题备注</h4><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>算法</category>
      
      <category>排序</category>
      
    </categories>
    
    
    <tags>
      
      <tag>算法</tag>
      
      <tag>排序</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 Windows OSError - pydot failed to call GraphViz.Please install GraphViz 报错</title>
    <link href="/2020/05/20/deep_learning/keras/call-GraphViz-failed/call-GraphViz-failed/"/>
    <url>/2020/05/20/deep_learning/keras/call-GraphViz-failed/call-GraphViz-failed/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Windows操作系统下，运行pydot相关程序时（我的是keras.utils.plot_model)报错，提示没有安装GraphViz，事实上并不都是因为GraphViz没有安装，本文记录错误解决方法。</p></blockquote><span id="more"></span><h2 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h2><blockquote><p>操作系统：Win10</p><p>keras版本：2.2.4</p><p>在Win10系统下（Windows系列都可能出这个问题）keras建立简单的模型，执行 plot_model，报错：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> keras <br><span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Input<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Conv2D<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> GlobalAveragePooling2D<br><span class="hljs-keyword">from</span> keras.layers <span class="hljs-keyword">import</span> Dense<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">from</span> keras.utils <span class="hljs-keyword">import</span> plot_model<br><br><span class="hljs-keyword">import</span> os<br>os.environ[<span class="hljs-string">&quot;PATH&quot;</span>] += os.pathsep + <span class="hljs-string">r&#x27;E:\Program Files (x86)\Graphviz2.38\bin&#x27;</span><br><br><br>A = Input(shape=(<span class="hljs-number">16</span>,<span class="hljs-number">16</span>,<span class="hljs-number">3</span>))<br>x = Conv2D(filters=<span class="hljs-number">10</span>, kernel_size=(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>, activation=<span class="hljs-string">&#x27;relu&#x27;</span>)(A)<br>x = Conv2D(filters=<span class="hljs-number">10</span>, kernel_size=(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>), padding=<span class="hljs-string">&#x27;same&#x27;</span>, activation=<span class="hljs-string">&#x27;relu&#x27;</span>)(x)<br>x = GlobalAveragePooling2D()(x)<br>x = Dense(units = <span class="hljs-number">5</span>, activation=<span class="hljs-string">&#x27;softmax&#x27;</span>)(x)<br><br>model = Model(A,x)<br><br>model.summary()<br><br>test_input = np.random.rand(<span class="hljs-number">1</span>,<span class="hljs-number">16</span>,<span class="hljs-number">16</span>,<span class="hljs-number">3</span>)<br><br>results = model.predict(test_input)<br><br>plot_model(model)<br></code></pre></td></tr></table></figure><blockquote><p>错误信息：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">builtins.OSError: `pydot` failed to call GraphViz.Please install GraphViz (https://www.graphviz.org/) <span class="hljs-keyword">and</span> ensure that its executables are <span class="hljs-keyword">in</span> the $PATH.<br></code></pre></td></tr></table></figure><h2 id="问题原因与解决方案"><a href="#问题原因与解决方案" class="headerlink" title="问题原因与解决方案"></a>问题原因与解决方案</h2><h3 id="情况-1"><a href="#情况-1" class="headerlink" title="情况 1"></a>情况 1</h3><ul><li>原因 ：真的没有安装GraphViz</li><li>解决方案：<ul><li>安装相应模块 </li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs \">pip install pydot-ng <br>pip install graphviz <br>pip install pydot <br></code></pre></td></tr></table></figure><blockquote><p>如果问题没有排除，可能是GraphViz程序没有加入到系统路径，考虑情况2</p></blockquote><h3 id="情况-2"><a href="#情况-2" class="headerlink" title="情况 2"></a>情况 2</h3><ul><li>原因：GraphViz程序没有加入到系统路径</li><li>解决方案：<ul><li>下载graphviz-2.38.msi ，我是在这里下载的 <a href="https://www.5down.net/soft/graphviz.html">https://www.5down.net/soft/graphviz.html</a></li><li>我安装在了E盘：<code>E:\Program Files (x86)\Graphviz2.38\bin</code></li><li>将路径加入到系统变量</li><li><img src="https://photos.zywvvd.com/matrixtime/20200520110131.png"></li></ul></li></ul><blockquote><p>目前为止是网上大多数存在的解决方案，相信大部分的同学到此为止已经解决了问题。</p><p>如果错误继续，那么我和你一样，进入情况3。</p></blockquote><h3 id="情况-3"><a href="#情况-3" class="headerlink" title="情况 3"></a>情况 3</h3><ul><li><p>原因：依赖模块已经安装、程序已经加入系统变量，仍然出现上述提示，是因为<code>pydot</code>在建立<code>Dot</code>类时查找的<code>dot</code>程序的名字是 ’dot‘ 而不是我们 Windows 里的可执行程序文件名 ‘dot.exe’</p></li><li><p>解决方案：改过来就好了，具体方法如下</p><ul><li><p>在报错的位置找到<code>pydot</code></p></li><li><p><img src="https://photos.zywvvd.com/matrixtime/20200520110546.png"></p></li><li><p>找到Dot类</p></li><li><p><img src="https://photos.zywvvd.com/matrixtime/20200520110627.png"></p></li><li><p>类的开头代码是这样的：</p></li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dot</span>(<span class="hljs-params">Graph</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;A container for handling a dot language file.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    This class implements methods to write and process</span><br><span class="hljs-string">    a dot language file. It is a derived class of</span><br><span class="hljs-string">    the base class &#x27;Graph&#x27;.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><ul><li><p>找到其中的 <code>self.prog = &#39;dot&#39;</code></p></li><li><p>讲这句话替换为：</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> platform<br>system = platform.system()<br>            <br><span class="hljs-keyword">if</span> system == <span class="hljs-string">&#x27;Windows&#x27;</span>:<br>    self.prog = <span class="hljs-string">&#x27;dot.exe&#x27;</span><br><span class="hljs-keyword">else</span>:<br>    self.prog = <span class="hljs-string">&#x27;dot&#x27;</span><br></code></pre></td></tr></table></figure><ul><li><p>保存再次运行程序即可</p></li><li><p><img src="https://photos.zywvvd.com/matrixtime/20200520110906.png"></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>Keras</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>深度学习</tag>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WingIDE 7.2.0 调试远程服务器中 Docker</title>
    <link href="/2020/05/14/coding/environment/wingide-remote-docker/wingide-remote-docker/"/>
    <url>/2020/05/14/coding/environment/wingide-remote-docker/wingide-remote-docker/</url>
    
    <content type="html"><![CDATA[<blockquote><p>上回我们说到<a href="https://www.zywvvd.com/2020/05/14/coding/environment/wing-ssh-remote/wing-ssh-remote/">WingIDE 7.2.0 远程调试</a>，但是我们又经常在远程服务器中启用docker运行程序，于是我们又出现了WingIDE远程调试服务器中Docker的需求，本文记录解决方案。</p></blockquote><span id="more"></span><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><blockquote><p>事实上ssh打通了本地与远程服务器，就可以打通服务器里的docker了。我们在ssh连接服务器时常用的是22端口，我们仅需将docker的22端口映射到服务器的随便哪个端口（例如3722），然后putty保存通过3722端口ssh连接的记录，wingIDE用其连接就是了。</p></blockquote><h2 id="docker配置"><a href="#docker配置" class="headerlink" title="docker配置"></a>docker配置</h2><blockquote><p>需要将docker的端口A映射到服务器的端口B，在建立docker的容器时加入参数 <code>-p</code>即可：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> docker run -it --name vvd -p 3722:22 -v /root/tmp:/root/tmp my_docker bash</span><br></code></pre></td></tr></table></figure><blockquote><p>此时docker 容器的22端口被映射到了服务器的3722端口.</p></blockquote><ul><li>随后需要在docker内部重新配置一遍ssh密钥，方法与在服务器内配置相同（参考<a href="https://www.zywvvd.com/2020/05/14/coding/environment/wing-ssh-remote/wing-ssh-remote/">WingIDE 7.2.0 远程调试</a>）</li></ul><h2 id="putty配置修改"><a href="#putty配置修改" class="headerlink" title="putty配置修改"></a>putty配置修改</h2><blockquote><p>将端口号由22修改为3722即可：</p></blockquote><p><img src="https://photos.zywvvd.com/matrixtime/20200514200415.png"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote><p>本质上与直接连接服务器没有区别，只是使用了端口映射，解决了这个问题。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>程序人生</category>
      
      <category>IDE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>程序人生</tag>
      
      <tag>IDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WingIDE 7.2.0 远程调试</title>
    <link href="/2020/05/14/coding/environment/wing-ssh-remote/wing-ssh-remote/"/>
    <url>/2020/05/14/coding/environment/wing-ssh-remote/wing-ssh-remote/</url>
    
    <content type="html"><![CDATA[<blockquote><p>大型程序常常会运行在性能强劲的服务器上，但是此时程序的调试又成了难办的事情，于是产生了远程调试的需求，本文介绍WingIDE远程调试配置方法。</p></blockquote><span id="more"></span><h2 id="环境描述"><a href="#环境描述" class="headerlink" title="环境描述"></a>环境描述</h2><ul><li><p>WingIDE 版本需求 6.++/ 7.++ ,我的是 7.2.0</p></li><li><p>本地操作系统 Win10</p></li><li><p>远程服务器操作系统 Ubuntu 16.04</p></li><li><p>安装 putty</p></li><li><p>解决方案：使用ssh协议通信，实现远程调试</p></li></ul><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="安装SSH服务"><a href="#安装SSH服务" class="headerlink" title="安装SSH服务"></a>安装SSH服务</h3><blockquote><p>查看服务是否安装：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo ps -e |grep ssh<br></code></pre></td></tr></table></figure><blockquote><p>返回带有 sshd 的条目即为已经安装</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ps -e |grep ssh</span><br>   37 ?        00:00:00 sshd<br>16013 ?        00:00:00 sshd<br>16588 ?        00:00:00 sshd<br></code></pre></td></tr></table></figure><blockquote><p>否则安装SSH服务</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install openssh-server<br></code></pre></td></tr></table></figure><h3 id="生成SSH密钥对"><a href="#生成SSH密钥对" class="headerlink" title="生成SSH密钥对"></a>生成SSH密钥对</h3><blockquote><p>在本地Win10（运行wingIDE的环境）使用ssh-keygen生成SSH密钥</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ssh-keygen -t rsa</span><br></code></pre></td></tr></table></figure><blockquote><p>此时在 C -&gt; Users -&gt; Admin（用户名） -&gt; .ssh 文件夹下会生成 <code>id_rsa</code>和<code>id_rsa.pub</code>两个密钥文件，其中 <code>id_rsa</code>为私钥，无论如何不能交给别人。</p></blockquote><h3 id="远程主机配置SSH密钥"><a href="#远程主机配置SSH密钥" class="headerlink" title="远程主机配置SSH密钥"></a>远程主机配置SSH密钥</h3><blockquote><p>将刚刚生成的公钥文件<code>id_rsa.pub</code>复制到远程主机 <code>~/.ssh</code>文件夹中，并添加到<code>~/.ssh/authorized_keys</code>里。</p><p>假设你的<code>id_rsa.pub</code>文件在<code>.ssh</code>文件夹中而且名称为<code>rsa_temp.pub</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat ~/.ssh/rsa_temp.pub &gt;&gt; ~/.ssh/authorized_keys<br>rm  ~/.ssh/rsa_temp.pub<br></code></pre></td></tr></table></figure><blockquote><p>此时你的本机Win10系统ssh连接远程主机已经不再需要输入密码进行身份验证。</p><p>可以使用ssh命令测试是否配置成功，过程中询问是否继续连接，输入 <code>yes</code>即可：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -p 3722 root@192.168.10.80 #-p为端口 一般来说ssh常用端口默认是22<br><span class="hljs-meta"></span><br><span class="hljs-meta">-----&gt;</span><span class="bash"></span><br><span class="bash">The authenticity of host <span class="hljs-string">&#x27;[192.168.10.80]:3722 ([192.168.10.80]:3722)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span></span><br>ECDSA key fingerprint is SHA256:qCIsaqEa6wNy0daSgBxxxxxxxxxxxxxxxxxxxxxx.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added &#x27;[192.168.10.80]:3722&#x27; (ECDSA) to the list of known hosts.<br>Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-142-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br>Last login: Thu May 14 08:20:47 2020 from 192.168.10.213<br> * Starting OpenBSD Secure Shell server sshd                             [ OK ]<br>root@fc6fa7bb6824:~#<br><br></code></pre></td></tr></table></figure><blockquote><p>此时我们已经可以用SSH连接两个操作系统，即已经完成了理论层面的配置，接下来进入具体操作阶段。</p></blockquote><h2 id="远程调试配置"><a href="#远程调试配置" class="headerlink" title="远程调试配置"></a>远程调试配置</h2><blockquote><p>此处解释一下，WingIDE在连接远程服务器时需要配置连接信息，而这个信息可以在putty中保存，也就是说，只要putty中保存的参数可以连接成功，那么这套配置就可以用于wingIDE的远程调试。</p></blockquote><h3 id="私钥文件id-rsa转换成putty的ppk格式"><a href="#私钥文件id-rsa转换成putty的ppk格式" class="headerlink" title="私钥文件id_rsa转换成putty的ppk格式"></a>私钥文件id_rsa转换成putty的ppk格式</h3><blockquote><p>putty需要ppk格式的私钥文件，生成方法如下：</p></blockquote><ul><li>运行puttygen （在putty同位置文件夹内）</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514191003.png"></p><ul><li>选择<code>Conversions</code>菜单项中的<code>Import key</code>选项：</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514191136.png"></p><ul><li>选择生成的id_rsa文件</li><li>在puttygen的界面上点击<code>Save private key</code>按钮就可以把私钥转换为ppk的格式了（不要点<code>Generate</code>）</li></ul><h3 id="在putty配置远程连接信息"><a href="#在putty配置远程连接信息" class="headerlink" title="在putty配置远程连接信息"></a>在putty配置远程连接信息</h3><blockquote><p>打开putty</p></blockquote><ul><li>配置 Session ：</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514190333.png"></p><blockquote><p>主要配置IP和端口号，在Saved Sessions里配置可以区分的名字，之后供WingIDE调用</p></blockquote><ul><li>配置 Connection-Data选项卡，在自动登录用户名处填入需要自动登录的用户名（我的是root）</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514192550.png"></p><ul><li>配置 Connection-SSH-Auth选项卡，浏览选择刚刚生成的私钥ppk文件：</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514192014.png"></p><ul><li>回到Session，点击<code>Save</code>保存当前配置到<code>test_3722</code>中：</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514192711.png"></p><ul><li>此后每次打开putty双击我们的<code>test_3722</code>即可连接到远程服务器：</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514193220.png"></p><h3 id="配置WingIDE"><a href="#配置WingIDE" class="headerlink" title="配置WingIDE"></a>配置WingIDE</h3><blockquote><p>距离成功仅一步之遥。</p><p>打开WingIDE， Project -&gt; New Project</p></blockquote><p><img src="https://photos.zywvvd.com/matrixtime/20200514193933.png"></p><blockquote><p>其中 Identifier 为该工程的名称， Host Name为我们刚刚保存的Putty名称，点击<code>OK</code>。</p></blockquote><ul><li>此时可以选择保存工程，也可以一会再说</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514194133.png"></p><ul><li>在远程的默认python路径往往不是我们需要的，我的常用python在conda的一个自建的环境中，可以指定其为wingIDE的默认远程python环境：</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514194516.png"></p><ul><li>随后一路OK，出现此对话框说明配置成功：</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514194611.png"></p><ul><li>重启python shell 可以在本地看到远程的python shell：</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514194723.png"></p><ul><li>可以简单通过操作系统验证是否配置成远程python</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514194830.png"></p><ul><li>在project中可以加入远程的工程</li></ul><p><img src="https://photos.zywvvd.com/matrixtime/20200514194908.png"></p><p><img src="https://photos.zywvvd.com/matrixtime/20200514195000.png"></p><blockquote><p>可以本地修改远程代码，并运行调试：</p></blockquote><p><img src="https://photos.zywvvd.com/matrixtime/20200514195140.png"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>程序人生</category>
      
      <category>IDE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>程序人生</tag>
      
      <tag>IDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 json.dump 报错：TypeError - Object of type xxx is not JSON serializable</title>
    <link href="/2020/05/12/coding/json-bug-fix/json-bug-fix/"/>
    <url>/2020/05/12/coding/json-bug-fix/json-bug-fix/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在python中导入json包可以方便地操作json文件，但是偶尔会遇到 TypeError: Object of type xxx is not JSON serializable 错误，通常报错的位置是很正常的int或float，本文记录该问题解决方法。</p></blockquote><span id="more"></span><h2 id="自定义序列化方法"><a href="#自定义序列化方法" class="headerlink" title="自定义序列化方法"></a>自定义序列化方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyEncoder</span>(<span class="hljs-params">json.JSONEncoder</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">default</span>(<span class="hljs-params">self, obj</span>):</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(obj, np.integer):<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(obj)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(obj, np.floating):<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">float</span>(obj)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(obj, np.ndarray):<br>            <span class="hljs-keyword">return</span> obj.tolist()<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(obj, time):<br>            <span class="hljs-keyword">return</span> obj.__str__()<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>(MyEncoder, self).default(obj)<br></code></pre></td></tr></table></figure><h2 id="调用json包写入数据时加入"><a href="#调用json包写入数据时加入" class="headerlink" title="调用json包写入数据时加入"></a>调用json包写入数据时加入</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">json.dump(final_json, fp, indent=<span class="hljs-number">3</span>, cls= MyEncoder)<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>程序人生</category>
      
      <category>Python</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>程序人生</tag>
      
      <tag>Python</tag>
      
      <tag>故障排除</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Wingide 快捷键</title>
    <link href="/2020/05/11/coding/wing-Shortcut/wing-Shortcut/"/>
    <url>/2020/05/11/coding/wing-Shortcut/wing-Shortcut/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 感觉wingide是比较小众的python ide，但是我就是用着顺手吖，本文记录wing的快捷键。</p></blockquote><span id="more"></span><h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><table><thead><tr><th align="center">功能</th><th align="center">快捷键</th></tr></thead><tbody><tr><td align="center">Ctrl+N</td><td align="center">新建文件</td></tr><tr><td align="center">Ctrl+O</td><td align="center">打开文件夹</td></tr><tr><td align="center">Ctrl+W</td><td align="center">关闭当前文件</td></tr><tr><td align="center">Ctrl+S</td><td align="center">保存文件</td></tr><tr><td align="center">Ctrl+shif+S</td><td align="center">另存为</td></tr><tr><td align="center">Ctrl+P</td><td align="center">打印</td></tr><tr><td align="center">Ctrl+Q</td><td align="center">退出</td></tr><tr><td align="center">Ctrl+Z</td><td align="center">撤回上一步</td></tr><tr><td align="center">Ctrl+A</td><td align="center">全选</td></tr><tr><td align="center">Ctrl+L</td><td align="center">跳到指定一行</td></tr><tr><td align="center">Ctrl+U</td><td align="center">在本行查找</td></tr><tr><td align="center">Ctrl+B</td><td align="center">查找相同变量名</td></tr><tr><td align="center">Ctrl+‘+’</td><td align="center">放大</td></tr><tr><td align="center">Ctrl+‘（’</td><td align="center">切换文件屏幕</td></tr><tr><td align="center">Ctrl+ALT+V</td><td align="center">运行当前文件</td></tr><tr><td align="center">Ctrl+ALT+M</td><td align="center">切换window应用界面</td></tr><tr><td align="center">F1</td><td align="center">上下框的开合</td></tr><tr><td align="center">F2</td><td align="center">左右框的开合</td></tr><tr><td align="center">Shif+F2</td><td align="center">编辑窗口最大化</td></tr><tr><td align="center">F5</td><td align="center">运行</td></tr><tr><td align="center">F9</td><td align="center">添加断点</td></tr><tr><td align="center">Ctrl+Shift+P或F1</td><td align="center">查看所有模块</td></tr><tr><td align="center">Alt+Shift+P</td><td align="center">新建项目</td></tr><tr><td align="center">Ctrl+Shift+N</td><td align="center">打开一个新Egret Wing窗口</td></tr><tr><td align="center">Ctrl+Shift+O</td><td align="center">能够打开快速大纲面板，显示当前文件中定义的所有类，方法和变量。</td></tr><tr><td align="center">Shift+F12</td><td align="center">查找所有引用</td></tr><tr><td align="center">Alt+Left</td><td align="center">切换到上一个编辑位置</td></tr><tr><td align="center">Ctrl+Shift+K</td><td align="center">删除当前行</td></tr><tr><td align="center">Ctrl+delete</td><td align="center">删除右侧单词</td></tr><tr><td align="center">Ctrl+D</td><td align="center">类似于eclipse中Ctrl+K</td></tr><tr><td align="center">Ctrl+home</td><td align="center">光标移到文件顶部</td></tr><tr><td align="center">Ctrl+U</td><td align="center">返回上一光标</td></tr><tr><td align="center">Ctrl+i</td><td align="center">选择当前行</td></tr><tr><td align="center">Alt+Shift+F</td><td align="center">格式化代码</td></tr><tr><td align="center">Tab</td><td align="center">自动补全</td></tr><tr><td align="center">Alt+Backspace</td><td align="center">删除光标所在单词的光标前的部分</td></tr><tr><td align="center">Alt+括号</td><td align="center">打印出整个括号</td></tr><tr><td align="center">Alt+↑或者Alt+↓</td><td align="center">关闭或者打开光标所在的一个折叠</td></tr><tr><td align="center">Alt+←或者Alt+→</td><td align="center">切换光标上一个下一个位置</td></tr><tr><td align="center">Alt+Home</td><td align="center">关闭所有折叠</td></tr><tr><td align="center">Alt+End</td><td align="center">关闭所有折叠</td></tr><tr><td align="center">Alt+F3</td><td align="center">打开搜索模式</td></tr><tr><td align="center">Alt+F5</td><td align="center">运行当前的文件</td></tr><tr><td align="center">Alt+1</td><td align="center">打开所有折叠</td></tr><tr><td align="center">Alt+2</td><td align="center">折叠所有classes</td></tr><tr><td align="center">Alt+3</td><td align="center">折叠所有函数和类</td></tr><tr><td align="center">Shift+Enter</td><td align="center">向上新建一行</td></tr><tr><td align="center">ctrl+”/“</td><td align="center">批量注释</td></tr><tr><td align="center">ctrl+shift+”/“</td><td align="center">批量取消注释</td></tr><tr><td align="center">ctrl+”&lt;”</td><td align="center">向前缩进</td></tr><tr><td align="center">ctrl+”&gt;”</td><td align="center">向后缩进</td></tr></tbody></table><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>程序人生</category>
      
      <category>IDE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>程序人生</tag>
      
      <tag>IDE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决 cuDNN launch failure 错误</title>
    <link href="/2020/05/09/deep_learning/keras/cudnn-launch-failure-fix/cudnn-launch-failure-fix/"/>
    <url>/2020/05/09/deep_learning/keras/cudnn-launch-failure-fix/cudnn-launch-failure-fix/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在神经网络模型推断过程中，报错<code>Internal: cuDNN launch failure : input shape ([1,3,2048,2048]) node bn_data/FusedBatchNorm </code>，本文记录解决方案。</p></blockquote><span id="more"></span><h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><blockquote><p>网上有怀疑该问题由BN层引起，去掉BN层可以解决问题<a href="https://blog.csdn.net/qq_36588760/article/details/105114185">TensorFlow实战 InternalError: cuDNN launch failure : input shape（未解决求交流）</a>。</p><p>更换cudnn版本也无济于事。</p><p>事实上更可能是TensorFlow显存配置的问题（事实上也是缺少证据的，只是按照这个思路可以排除故障，因此该因素应该是最大似然的原因）</p></blockquote><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><blockquote><p>在代码中加入按需分配显存的配置：</p></blockquote><h3 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">con = tf<span class="hljs-selector-class">.ConfigProto</span>()<br>con<span class="hljs-selector-class">.gpu_options</span><span class="hljs-selector-class">.allow_growth</span> = True<br>keras<span class="hljs-selector-class">.backend</span><span class="hljs-selector-class">.tensorflow_backend</span><span class="hljs-selector-class">.set_session</span>(tf<span class="hljs-selector-class">.Session</span>(config=con)) <br></code></pre></td></tr></table></figure><h3 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">os<span class="hljs-selector-class">.environ</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;TF_FORCE_GPU_ALLOW_GROWTH&#x27;</span>]</span> = <span class="hljs-string">&#x27;true&#x27;</span><br></code></pre></td></tr></table></figure><p>原理相同，只是不一样的写法。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>深度学习</category>
      
      <category>Keras</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>深度学习</tag>
      
      <tag>Keras</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker - 常用命令使用教程</title>
    <link href="/2020/05/06/docker/docker_usage/"/>
    <url>/2020/05/06/docker/docker_usage/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文简要介绍Docker，记录Docker常用命令使用方法。</p></blockquote><span id="more"></span><h3 id="Docker-简介"><a href="#Docker-简介" class="headerlink" title="Docker 简介"></a>Docker 简介</h3><blockquote><p><strong>Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。</strong>Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker，就不用担心环境问题。</p></blockquote><h3 id="Docker-使用流程"><a href="#Docker-使用流程" class="headerlink" title="Docker 使用流程"></a>Docker 使用流程</h3><ul><li><a href="https://docs.docker.com/desktop/">安装docker</a></li><li>创建Image</li><li>从Image创建Container</li><li>在Container中工作</li><li>将在Container中做的修改提交给Image</li><li>销毁Container</li></ul><h3 id="命令介绍"><a href="#命令介绍" class="headerlink" title="命令介绍"></a>命令介绍</h3><ul><li>拉取 image</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> image pull<span class="hljs-meta"> [docker-url]</span><br></code></pre></td></tr></table></figure><ul><li>获取docker images 列表</li></ul><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel">docker images<br>或<br>docker <span class="hljs-keyword">image</span> <span class="hljs-keyword">ls</span><br></code></pre></td></tr></table></figure><ul><li>建立container （nvidia docker)</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">NV_GPU=<span class="hljs-selector-attr">[gpu_num]</span> nvidia-docker run -it --name <span class="hljs-selector-attr">[container_name]</span> --shm-size=<span class="hljs-selector-attr">[shm_size]</span> --rm -v <span class="hljs-selector-attr">[current_dir]</span>:<span class="hljs-selector-attr">[container_dir]</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-selector-attr">[current_port]</span>:<span class="hljs-selector-attr">[container_port]</span> <span class="hljs-selector-attr">[image_name]</span>:<span class="hljs-selector-attr">[image_tag]</span>  <span class="hljs-selector-attr">[command]</span> <br></code></pre></td></tr></table></figure><blockquote><p>NV_GPU: container中可见的GPU，如果不设置可见所有GPU</p><p>-it: 将容器的 Shell 映射到当前的 Shell，然后你在本机窗口输入的命令，就会传入容器</p><p>–name: 容器名称，如果不设置会随机分配一个名字</p><p>–shm-size: 容器共享内存大小设置。如果不设置默认大小64M，对于需要使用共享内存的情况往往是不够用的，如果设置为10g，这样配置： <code>--ssh-size=&quot;10g&quot;</code> </p><p>–rm: 容器关闭后自动删除，如果不设置容器不会自动删除</p><p>-v: 驱动器映射，将本机的目录映射到容器的指定文件夹中；需要说明的是，在主机文件夹中的挂载目录在容器中是可见的；需要再说明的是容器启动时主机挂载的目录容器是见不到的；最后说明，容器关闭再打开就可以看到主机挂载的所有文件夹了。</p><p>-p: 暴漏容器的端口到本机的端口上，例如用于ssh连接容器时需要将容器的22端口暴露到主机的端口上(比如3721)，则可以设置 <code>-p 3721:22</code></p><p>image_name, image_tag: 这是docker镜像的名称与标记，如果使用本机镜像可以在docker images列表中查询到</p><p>command: 启动容器后内部执行的第一个命令，一般为 <code>/bin/bash</code></p></blockquote><ul><li>查询container列表</li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">docker container <span class="hljs-keyword">ls</span> <span class="hljs-params">--all</span><br></code></pre></td></tr></table></figure><blockquote><p>–all: 加上该参数会显示没有在运行的容器，不加的话仅显示运行中的容器</p></blockquote><ul><li>停止指定的容器运行</li></ul><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">docker <span class="hljs-keyword">container</span> kill <span class="hljs-comment">[containerID]</span><br>docker stop <span class="hljs-comment">[containerID]</span><br></code></pre></td></tr></table></figure><blockquote><p><code>docker container kill</code>命令终止容器运行，相当于向容器里面的主进程发出 SIGKILL 信号。<code>docker container stop</code>命令相当于向容器里面的主进程发出 SIGTERM 信号，然后过一段时间再发出 SIGKILL 信号。</p></blockquote><ul><li>启动停止的容器</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> start<span class="hljs-meta"> [containerID]</span><br></code></pre></td></tr></table></figure><ul><li>重启运行的容器</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> restart<span class="hljs-meta"> [containerID]</span><br></code></pre></td></tr></table></figure><ul><li>删除指定的容器文件（仅在停止运行时可用）</li></ul><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">docker <span class="hljs-keyword">container</span> rm <span class="hljs-comment">[containerID]</span><br></code></pre></td></tr></table></figure><ul><li>查看容器输出</li></ul><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs inform7">docker <span class="hljs-keyword">container</span> logs <span class="hljs-comment">[containerID]</span><br></code></pre></td></tr></table></figure><ul><li>启动容器的一个终端</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker exec -it [containerID] <span class="hljs-regexp">/bin/</span>bash<br></code></pre></td></tr></table></figure><blockquote><p>此种方法启动的终端，即使退出也不会关闭容器</p><p>相反 - 如果直接通过端口映射连接 docker 建立的ssh链接，窗口退出后该终端的工作也会一同停止</p></blockquote><ul><li>进入容器的主终端</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> attach<span class="hljs-meta"> [containerID]</span><br></code></pre></td></tr></table></figure><blockquote><p>连接到容器的主终端，该终端退出后容器关闭。</p><p>如果不希望退出后关闭，可以加入选项 <code>--sig-proxy=false</code></p></blockquote><ul><li>退出终端</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">ctrl <span class="hljs-selector-tag">p</span> + ctrl <span class="hljs-selector-tag">q</span><br></code></pre></td></tr></table></figure><blockquote><p>可以在退出终端的同时保持终端继续工作</p></blockquote><ul><li>退出容器</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><blockquote><p>在容器中运行此命令</p></blockquote><ul><li>拷贝容器里的文件到本机</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">docker container cp [containerID]:[<span class="hljs-regexp">/path/</span>to/<span class="hljs-keyword">file</span>]<br></code></pre></td></tr></table></figure><ul><li>提交容器修改到镜像</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker commit -<span class="hljs-selector-tag">a</span> <span class="hljs-selector-attr">[name]</span> -m <span class="hljs-selector-attr">[comments]</span> -<span class="hljs-selector-tag">p</span>  <span class="hljs-selector-attr">[containerID[:TAG]</span>]<br></code></pre></td></tr></table></figure><blockquote><p>-a: 提交的镜像作者</p><p>-m: 提交时的说明文字</p><p>-p: 在commit时，将容器暂停</p></blockquote><ul><li>删除镜像</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> rmi<span class="hljs-meta"> [image]</span><br></code></pre></td></tr></table></figure><blockquote><p>或</p></blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">docker image rm [image]<br></code></pre></td></tr></table></figure><blockquote><p>支持的子命令如下：</p></blockquote><ul><li><code>-f, -force</code>: 强制删除镜像，即便有容器引用该镜像；</li><li><code>-no-prune</code>: 不要删除未带标签的父镜像；</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ul><li><p><a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html">http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html</a></p></li><li><p><a href="https://www.runoob.com/docker/docker-tutorial.html">https://www.runoob.com/docker/docker-tutorial.html</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git - 常用命令使用教程</title>
    <link href="/2020/05/06/git/git_usage/git-usage/"/>
    <url>/2020/05/06/git/git_usage/git-usage/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍git常用命令的使用方法。</p></blockquote><span id="more"></span><h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><blockquote><p>译为<code>分布式版本控制系统</code>，是一个开源的分布式版本控制系统，可以有效、高速地处理从很小到非常大的项目版本管理。</p></blockquote><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul><li>Linux</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt install git-all</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo dnf install git-all</span><br></code></pre></td></tr></table></figure><ul><li>Windows</li></ul><p>在  <a href="https://git-scm.com/download/win">https://git-scm.com/download/win</a> 下载 gitbash 并安装即可</p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><ul><li>Linux</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git --version</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">-&gt;</span><span class="bash"> git version 2.7.4 <span class="hljs-comment"># 出现版本表示安装成功</span></span><br></code></pre></td></tr></table></figure><ul><li>Windows</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git --version</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">-&gt;</span><span class="bash"> git version 2.25.0.windows.1 <span class="hljs-comment"># 出现版本表示安装成功</span></span><br></code></pre></td></tr></table></figure><h1 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h1><blockquote><p>译为<code>版本库</code>或<code>仓库</code>，是git的核心概念，用于存放代码与各个版本的补丁信息和用户配置信息等。</p></blockquote><h2 id="Git-配置"><a href="#Git-配置" class="headerlink" title="Git 配置"></a>Git 配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> git config --global user.name <span class="hljs-string">&quot;your name&quot;</span></span><br><span class="hljs-meta">$</span><span class="bash"> git config --global user.email <span class="hljs-string">&quot;your_email@youremail.com&quot;</span></span><br></code></pre></td></tr></table></figure><h2 id="Git-信息流"><a href="#Git-信息流" class="headerlink" title="Git 信息流"></a>Git 信息流</h2><blockquote><p>初次接触git的人需要对git信息流有一个初步的理解，掌握脉络之后就明白各个命令实在干什么了，主要流程如下图：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200506231304.png"></p><h3 id="主要概念"><a href="#主要概念" class="headerlink" title="主要概念"></a>主要概念</h3><ul><li>workspace（工作区）：当前工作目录，它持有实际文件；</li><li>inedex（暂存区）：保存临时改动，workspace的文件改动后通过add命令添加到index；</li><li>repository（仓库）：git管理的本地仓库，index中确定需要的更改提交到仓库中，存放提交的修改与历史变动；</li><li>HEAD：指向最后一次提交的结果，可以理解为每一次commit提交代码都会在git中产生一个节点，每个节点代表一个代码仓库的历史状态，我们可以在各个节点之间反复横跳，但是一个时刻只能在一个节点上，而标记我们在那个节点的就是HEAD，很像C语言中的指针；</li><li>Remote（远程端）：git的真正妙用在于有统一的服务器管理协同工作的多个开发人员的代码，因此我们经常需要把本地仓库的代码推送（push）到远端，或把远端的代码拉取（fetch/pull）或复制（clone）到本地。</li></ul><h2 id="主要命令"><a href="#主要命令" class="headerlink" title="主要命令"></a>主要命令</h2><h3 id="仓库管理"><a href="#仓库管理" class="headerlink" title="仓库管理"></a>仓库管理</h3><h4 id="git-init"><a href="#git-init" class="headerlink" title="git init"></a>git init</h4><blockquote><p>Git 使用 <strong>git init</strong> 命令来初始化一个 Git 仓库，Git 的很多命令都需要在 Git 的仓库中运行，所以 <strong>git init</strong> 是使用 Git 的第一个命令。</p><p>在执行完成 <strong>git init</strong> 命令后，Git 仓库会生成一个 .git 目录，该目录包含了资源的所有元数据，其他的项目目录保持不变。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">git <span class="hljs-keyword">init</span><br></code></pre></td></tr></table></figure><blockquote><p>在现有文件夹下使用该命令，会在当前文件夹创建 <code>.git</code>目录，该目录记录git相关管理信息。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">git <span class="hljs-keyword">init</span> test_dir<br></code></pre></td></tr></table></figure><blockquote><p>会在当前文件夹下创建<code>test_dir</code>文件夹，并在其中创建<code>.git</code>文件夹。</p></blockquote><h4 id="git-clone"><a href="#git-clone" class="headerlink" title="git clone"></a>git clone</h4><blockquote><p><strong>git clone</strong> 从现有 Git 仓库中拷贝项目。</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">[-b</span> branch] <span class="hljs-tag">&lt;repo&gt;</span> [directory]<br></code></pre></td></tr></table></figure><blockquote><p><code>repo</code>:  要克隆的远程仓库地址</p><p><code>branch</code>: 将要克隆的远程仓库分支名称，如果不设置该项参数则会克隆默认分支</p><p><code>directory</code>: 本地仓库文件夹名称，如果不设置该项参数则以仓库名称命名文件夹</p></blockquote><ul><li>协议配置</li></ul><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">git</span>@github.com:zywvvd/test.git            --SSH协议<br>git <span class="hljs-keyword">clone</span> <span class="hljs-title">git</span>://github.com/zywvvd/test.git          --GIT协议<br>git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/zywvvd/test.git        --HTTPS协议<br></code></pre></td></tr></table></figure><blockquote><p>git clone 时，可以所用不同的协议，包括 ssh, git, https 等，其中最常用的是 ssh，因为速度较快，还可以配置公钥免输入密码。</p></blockquote><h4 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a>git config</h4><blockquote><p>查看和配置git相关信息。</p></blockquote><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">git <span class="hljs-built_in">config</span> <span class="hljs-comment">--list</span><br></code></pre></td></tr></table></figure><blockquote><p>查看git配置信息</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git conifg -e</span><br></code></pre></td></tr></table></figure><blockquote><p>编辑配置文件（针对当前仓库）</p></blockquote><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">git <span class="hljs-built_in">config</span> -e <span class="hljs-comment">--global</span><br></code></pre></td></tr></table></figure><blockquote><p>编辑配置文件（针对系统上所有仓库）</p></blockquote><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">git <span class="hljs-keyword">config</span> --<span class="hljs-keyword">global</span> user<span class="hljs-variable">.name</span> <span class="hljs-string">&quot;vvd&quot;</span><br>git <span class="hljs-keyword">config</span> --<span class="hljs-keyword">global</span> user<span class="hljs-variable">.email</span> vvd@canglan<span class="hljs-variable">.com</span><br></code></pre></td></tr></table></figure><blockquote><p>配置提交代码时的用户信息</p></blockquote><h3 id="本地信息流管理"><a href="#本地信息流管理" class="headerlink" title="本地信息流管理"></a>本地信息流管理</h3><blockquote><p>本地信息流主要涉及<strong>工作区(workspace)<strong>、</strong>暂存区(index)<strong>和</strong>版本库(repository)</strong></p></blockquote><p><img src="https://photos.zywvvd.com/image/20200527000031.png"></p><h4 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a>git add</h4><blockquote><p><strong>git add</strong> 命令可将该文件添加到暂存区。</p></blockquote><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">git add [file1] [file2] ...<br></code></pre></td></tr></table></figure><blockquote><p>添加一个或多个文件到暂存区。</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">git <span class="hljs-builtin-name">add</span> [dir]<br></code></pre></td></tr></table></figure><blockquote><p>添加指定目录到暂存区，包括子目录。</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">git <span class="hljs-builtin-name">add</span> .<br></code></pre></td></tr></table></figure><blockquote><p>他会监控工作区的状态树，使用它会把工作时的<strong>所有变化提交</strong>到暂存区，包括文件内容修改(modified)以及新文件(new)，<strong>但不包括被删除的文件</strong>。</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">git <span class="hljs-builtin-name">add</span> -u<br></code></pre></td></tr></table></figure><blockquote><p>git add –update的缩写，他仅监控<strong>已经被add的文件</strong>（即tracked file），他会将被修改的文件提交到暂存区。add -u 不会提交新文件（untracked file）。</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">git <span class="hljs-builtin-name">add</span> -A<br></code></pre></td></tr></table></figure><blockquote><p>git add –all的缩写，是上面两个功能的合集。</p></blockquote><p><strong>注</strong>：个人建议慎用 <code>git add -A</code>，需要明确地知道每步add操作提交了什么，切实管理自己的仓库。</p><h4 id="git-rm"><a href="#git-rm" class="headerlink" title="git rm"></a>git rm</h4><blockquote><p>git rm 命令用于从暂存区和工作区中删除文件（会删除本地文件）。</p></blockquote><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">git <span class="hljs-keyword">rm</span> &lt;<span class="hljs-keyword">file</span>&gt;<br></code></pre></td></tr></table></figure><blockquote><p>将文件<code>file</code>从暂存区和工作区中删除。</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">git <span class="hljs-built_in">rm</span> <span class="hljs-operator">-f</span> &lt;file&gt;<br></code></pre></td></tr></table></figure><blockquote><p>强制删除选项 <code>-f</code>。</p><p>用于删除之前修改过并且已经放到暂存区域的情况。</p></blockquote><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">git <span class="hljs-keyword">rm</span> --cached &lt;<span class="hljs-keyword">file</span>&gt;<br></code></pre></td></tr></table></figure><blockquote><p><code>--cached</code> 选项，可以把文件从暂存区域移除，但仍然保留在当前工作目录中，即从跟踪清单中删除。</p></blockquote><h4 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a>git commit</h4><blockquote><p>将暂存区中的内容添加到本地仓库中。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git commit -m <span class="hljs-tag">&lt;<span class="hljs-name">message</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>将暂存区的内容提交到本地仓库；</p><p>此过程中必须附加<code>message</code>信息，提交后会在git中生成唯一的名称记录这一提交，可以在<code>git log</code>命令中查看。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">git commit <span class="hljs-selector-attr">[file1]</span> <span class="hljs-selector-attr">[file2]</span> ... -m &lt;message&gt;<br></code></pre></td></tr></table></figure><blockquote><p>可以对部分文件进行提交。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">git commit -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure><blockquote><p><code>-a</code> 参数设置修改文件后不需要执行 git add 命令，直接来提交。</p></blockquote><p><strong>注</strong>：首次提交必须设置用户信息的名称和邮箱。</p><h4 id="git-checkout"><a href="#git-checkout" class="headerlink" title="git checkout"></a>git checkout</h4><blockquote><p>此命令用来放弃掉所有还没有提交（就是 git add 或 git commit）的修改：内容修改与整个文件删除。但是此命令不会删除掉刚新建的文件。因为刚新建的文件还没已有加入到 git 的管理系统中。</p></blockquote><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">git checkout <span class="hljs-comment">-- &lt;file&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>将缓存区的文件覆盖到工作区中，在文件名与分支名没有歧义时可以省略<code>--</code>。</p><p>如果暂存区有该文件的提交，则从暂存区中抓取文件覆盖当前工作区的文件，否则从最近一次commit中抓取该文件并覆盖当前文件。</p><p>总之就是把该文件最近一次 add 或 commit 的副本抓来覆盖了工作区的文件。</p></blockquote><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">git</span> checkout .  <br></code></pre></td></tr></table></figure><blockquote><p>这个操作很危险，会清除工作区中未添加到暂存区的改动，放弃所有的工作区文件修改。</p></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">git checkout HEAD &lt;<span class="hljs-built_in">file</span>&gt;<br></code></pre></td></tr></table></figure><blockquote><p>用 HEAD 指向的 master 分支中的文件替换暂存区和以及工作区中的文件。</p></blockquote><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang">git checkout HEAD .<br></code></pre></td></tr></table></figure><blockquote><p>用 HEAD 指向的 master 分支中的所有文件替换暂存区和以及工作区中的文件。</p></blockquote><p>注：<code>checkout HEAD</code>是极具危险性的命令，它不但会清除工作区中未提交的改动，也会清除暂存区中未提交的改动。</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">git checkout --<span class="hljs-keyword">orphan </span>&lt;<span class="hljs-keyword">branch </span>name&gt;<br></code></pre></td></tr></table></figure><blockquote><p>将当前所在Head的工作区状态直接带到开辟的全新分支当中，用于清空之前所有提交记录。</p><p>切换到新分支时没有任何提交记录，所有现有工作区的文件都是全新的，在添加到暂存区并提交之后才有了第一次提交。</p></blockquote><h4 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h4><blockquote><p>git reset 命令用于回退版本，可以指定退回某一次提交的版本。</p></blockquote><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">git</span> <span class="hljs-comment">reset</span> <span class="hljs-title">[</span>--<span class="hljs-comment">soft</span> <span class="hljs-comment">|</span> --<span class="hljs-comment">mixed</span> <span class="hljs-comment">|</span> --<span class="hljs-comment">hard</span><span class="hljs-title">]</span> <span class="hljs-title">[</span><span class="hljs-comment">HEAD</span><span class="hljs-title">]</span> <span class="hljs-title">[</span><span class="hljs-comment">file</span><span class="hljs-title">]</span><br></code></pre></td></tr></table></figure><blockquote><ul><li><p><code>--mixed</code> 为默认，可以不用带该参数，用于重置暂存区的文件与上一次的提交(commit)保持一致，工作区文件内容保持不变。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">git <span class="hljs-keyword">reset</span> HEAD  <span class="hljs-comment"># 取消之前 git add 添加过的缓存。</span><br></code></pre></td></tr></table></figure><p>暂存区的目录树会被重写，被 master 分支指向的目录树所替换，但是工作区不受影响。</p><p>实例：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>git reset HEAD^            <span class="hljs-comment"># 回退所有内容到上一个版本  </span><br><span class="hljs-variable">$ </span>git reset HEAD^ hello.php  <span class="hljs-comment"># 回退 hello.php 文件的版本到上一个版本  </span><br><span class="hljs-variable">$ </span>git  reset  052e           <span class="hljs-comment"># 回退到指定版本</span><br></code></pre></td></tr></table></figure></li><li><p><code>--soft</code> 参数用于回退到某个版本：</p><p>实例：</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">git</span> <span class="hljs-string">reset</span> <span class="hljs-built_in">--soft</span> <span class="hljs-string">HEAD</span>~<span class="hljs-string">3</span>  <span class="hljs-comment">#  回退上上上一个版本</span><br></code></pre></td></tr></table></figure></li><li><p><code>--hard</code> 参数撤销工作区中所有未提交的修改内容，将暂存区与工作区都回到上一次版本，并删除之前的所有信息提交：</p>  <figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">git <span class="hljs-keyword">reset</span> <span class="hljs-comment">--hard HEAD</span><br></code></pre></td></tr></table></figure><p>  实例：</p>  <figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>git reset –hard HEAD~<span class="hljs-number">3</span>  <span class="hljs-comment"># 回退上上上一个版本  </span><br><span class="hljs-variable">$ </span>git reset –hard bae128  <span class="hljs-comment"># 回退到某个版本回退点之前的所有信息。 </span><br><span class="hljs-variable">$ </span>git reset --hard origin/master    <span class="hljs-comment"># 将本地的状态回退到和远程的一样 </span><br></code></pre></td></tr></table></figure><p>  <strong>注：</strong>谨慎使用 –hard 参数，它会删除回退点之前的所有信息。</p></li><li><p>HEAD 说明</p><ul><li>HEAD 表示当前版本</li><li>HEAD^ 上一个版本</li><li>HEAD^^ 上上一个版本</li><li>HEAD^^^ 上上上一个版本</li><li>以此类推…</li></ul><p>可以使用 ～数字表示</p><ul><li>HEAD~0 表示当前版本</li><li>HEAD~1 上一个版本</li><li>HEAD^2 上上一个版本</li><li>HEAD^3 上上上一个版本</li><li>以此类推…</li></ul></li></ul></blockquote><h4 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h4><blockquote><p>比较文件在暂存区和工作区的差异，即显示已写入暂存区和已经被修改但尚未写入暂存区文件对区别。</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> diff<span class="hljs-meta"> [file]</span><br></code></pre></td></tr></table></figure><blockquote><p>显示暂存区和工作区的差异。</p></blockquote><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">git <span class="hljs-keyword">diff </span>--<span class="hljs-keyword">cached </span>[file]<br>或<br>git <span class="hljs-keyword">diff </span>--staged [file]<br></code></pre></td></tr></table></figure><blockquote><p>显示暂存区和上一次提交(commit)的差异。</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">diff</span> [<span class="hljs-built_in">first</span>-branch]...[<span class="hljs-built_in">second</span>-branch]<br></code></pre></td></tr></table></figure><blockquote><p>显示两次提交之间的差异。</p></blockquote><h4 id="git-mv"><a href="#git-mv" class="headerlink" title="git mv"></a>git mv</h4><blockquote><p>用于移动或重命名一个文件、目录或软连接。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">git mv <span class="hljs-selector-attr">[file]</span> <span class="hljs-selector-attr">[newfile]</span> <span class="hljs-selector-attr">[-f]</span><br></code></pre></td></tr></table></figure><blockquote><p>在git中移动文件</p><p><code>-f</code>: 强制文件移动(如果已经存在该文件则会覆盖)</p></blockquote><h4 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a>git status</h4><blockquote><p>查看仓库当前的状态，显示有变更的文件，用于查看在你上次提交之后是否有对文件进行再次修改。</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git status</span><br></code></pre></td></tr></table></figure><blockquote><p>详细显示工作区和暂存区的修改、提交状态。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs vim">On branch master<br>On branch master<br>Changes <span class="hljs-keyword">to</span> <span class="hljs-keyword">be</span> committed:<br>  (use <span class="hljs-string">&quot;git restore --staged &lt;file&gt;...&quot;</span> <span class="hljs-keyword">to</span> unstage)<br>        <span class="hljs-keyword">new</span> <span class="hljs-keyword">file</span>:   B<br>        <span class="hljs-keyword">new</span> <span class="hljs-keyword">file</span>:   C<br>        <span class="hljs-keyword">new</span> <span class="hljs-keyword">file</span>:   D<br><br>Changes not staged <span class="hljs-keyword">for</span> commi<span class="hljs-variable">t:</span><br>  (use <span class="hljs-string">&quot;git add/rm &lt;file&gt;...&quot;</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">update</span> what will <span class="hljs-keyword">be</span> committed)<br>  (use <span class="hljs-string">&quot;git restore &lt;file&gt;...&quot;</span> <span class="hljs-keyword">to</span> discard <span class="hljs-keyword">changes</span> in working directory)<br>        deleted:    C<br>        modified:   D<br>        modified:   E<br><br>Changes <span class="hljs-keyword">to</span> <span class="hljs-keyword">be</span> committed:<br>  (use <span class="hljs-string">&quot;git restore --staged &lt;file&gt;...&quot;</span> <span class="hljs-keyword">to</span> unstage)<br>        renamed:    D -&gt; F<br><br>Untracked <span class="hljs-keyword">file</span><span class="hljs-variable">s:</span><br>  (use <span class="hljs-string">&quot;git add &lt;file&gt;...&quot;</span> <span class="hljs-keyword">to</span> include in what will <span class="hljs-keyword">be</span> committed)<br>        A<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git status -s</span><br></code></pre></td></tr></table></figure><blockquote><p>简略输出状态结果。</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">A</span>  <span class="hljs-variable">B</span><br><span class="hljs-variable">AD</span> <span class="hljs-built_in">C</span><br><span class="hljs-variable">AM</span> <span class="hljs-built_in">D</span><br> <span class="hljs-variable">M</span> <span class="hljs-built_in">E</span><br> <span class="hljs-built_in">D</span> <span class="hljs-variable">a</span><span class="hljs-operator">.</span><span class="hljs-variable">txt</span><br><span class="hljs-variable">R</span>  <span class="hljs-built_in">D</span> <span class="hljs-operator">-&gt;</span> <span class="hljs-variable">F</span><br><span class="hljs-operator">??</span> <span class="hljs-variable">A</span><br></code></pre></td></tr></table></figure><ul><li>符号说明<ul><li><code>A(Added)</code>:  新添加到暂存区的文件</li><li><code>M(Modified)</code>:  已经提交过并被修改的文件</li><li><code>D(Deleted)</code>:  已经提交过并被直接删除的文件</li><li><code>R(Renamed)</code>: 重命名的文件</li><li><code>AD</code>: 已经提交到暂存区后被删除</li><li><code>AM</code>: 已经提交到暂存区后被修改</li><li><code>??(Untracked)</code>: 未追踪的文件</li></ul></li></ul></blockquote><h4 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a>git stash</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git stash</span><br></code></pre></td></tr></table></figure><blockquote><p>将所有未提交的修改（工作区和暂存区）保存至堆栈中，用于后续恢复当前工作目录。</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git stash save</span><br></code></pre></td></tr></table></figure><blockquote><p>作用等同于git stash，区别是可以加一些注释:</p><p>例如：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> stash的效果：<br><br><span class="hljs-attribute">stash</span>@&#123;<span class="hljs-number">0</span>&#125;: WIP <span class="hljs-literal">on</span> master: b<span class="hljs-number">2</span>f<span class="hljs-number">489</span>c second<br><span class="hljs-attribute">1</span><br><span class="hljs-attribute">git</span> stash save “test<span class="hljs-number">1</span>”的效果：<br><br><span class="hljs-attribute">stash</span>@&#123;<span class="hljs-number">0</span>&#125;: <span class="hljs-literal">On</span> master: test<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git stash list</span><br></code></pre></td></tr></table></figure><blockquote><p>查看当前stash中的内容</p></blockquote><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">git stash <span class="hljs-keyword">pop</span><br></code></pre></td></tr></table></figure><blockquote><p>将当前stash中的内容弹出，并应用到当前分支对应的工作目录上。<br>注：该命令将堆栈中最近保存的内容删除（栈是先进后出）</p></blockquote><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">git stash <span class="hljs-built_in">apply</span><br></code></pre></td></tr></table></figure><blockquote><p>将堆栈中的内容应用到当前目录，不同于git stash pop，该命令不会将内容从堆栈中删除，也就说该命令能够将堆栈的内容多次应用到工作目录中，适应于多个分支的情况。</p><p>可以使用git stash apply + stash名字（如stash@{1}）指定恢复哪个stash到当前的工作目录。</p></blockquote><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">git stash <span class="hljs-built_in">drop</span> + 名字<br></code></pre></td></tr></table></figure><blockquote><p>从堆栈中移除某个指定的stash</p></blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">git stash clear<br></code></pre></td></tr></table></figure><blockquote><p>清除堆栈中的所有 内容</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">git stash <span class="hljs-keyword">show</span><br></code></pre></td></tr></table></figure><blockquote><p>查看堆栈中最新保存的stash和当前目录的差异。</p><p>例如：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">$ git stash show<br> src<span class="hljs-regexp">/main/</span>java<span class="hljs-regexp">/com/</span>wy/StringTest.java | <span class="hljs-number">2</span> +-<br> <span class="hljs-number">1</span> <span class="hljs-keyword">file</span> changed, <span class="hljs-number">1</span> insertion(+), <span class="hljs-number">1</span> deletion(-)<br></code></pre></td></tr></table></figure><p><code>git stash show stash@&#123;1&#125;</code>查看指定的stash和当前目录差异。</p><p>通过 <code>git stash show -p</code> 查看详细的不同:</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs gradle">$ git stash show -p<br>diff --git a<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/wy/</span>CacheTest.java b<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/wy/</span>CacheTest.java<br>index <span class="hljs-number">6</span>e90837..de0e47b <span class="hljs-number">100644</span><br>--- a<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/wy/</span>CacheTest.java<br>+++ b<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/wy/</span>CacheTest.java<br>@@ -<span class="hljs-number">7</span>,<span class="hljs-number">6</span> +<span class="hljs-number">7</span>,<span class="hljs-number">6</span> @@ <span class="hljs-keyword">package</span> com.wy;<br>  */<br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> CacheTest &#123;<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(String[] args) &#123;<br>-        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;git stash test&quot;</span>);<br>+        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;git stash test1&quot;</span>);<br>     &#125;<br> &#125;<br>diff --git a<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/wy/</span>StringTest.java b<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/wy/</span>StringTest.java<br>index a7e146c..<span class="hljs-number">711</span>d63f <span class="hljs-number">100644</span><br>--- a<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/wy/</span>StringTest.java<br>+++ b<span class="hljs-regexp">/src/m</span>ain<span class="hljs-regexp">/java/</span>com<span class="hljs-regexp">/wy/</span>StringTest.java<br>@@ -<span class="hljs-number">12</span>,<span class="hljs-number">7</span> +<span class="hljs-number">12</span>,<span class="hljs-number">7</span> @@ <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> StringTest &#123;<br><br>     @Test<br>     <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> test1() &#123;<br>-        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;=================&quot;</span>);<br>+        System.out.<span class="hljs-keyword">println</span>(<span class="hljs-string">&quot;git stash test1&quot;</span>);<br>         System.out.<span class="hljs-keyword">println</span>(Strings.isNullOrEmpty(<span class="hljs-string">&quot;&quot;</span>));<span class="hljs-comment">//true</span><br>         System.out.<span class="hljs-keyword">println</span>(Strings.isNullOrEmpty(<span class="hljs-string">&quot; &quot;</span>));<span class="hljs-comment">//false</span><br>         System.out.<span class="hljs-keyword">println</span>(Strings.nullToEmpty(<span class="hljs-keyword">null</span>));<span class="hljs-comment">//&quot;&quot;</span><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git stash branch</span><br></code></pre></td></tr></table></figure><blockquote><p>从最新的stash创建分支。</p></blockquote><h4 id="git-revert"><a href="#git-revert" class="headerlink" title="git revert"></a>git revert</h4><blockquote><p>通过创建一次新的 <code>commit</code> 来撤销一次 <code>commit</code> 所做出的修改。这种撤销的方式是安全的，因为它并不修改 <code>commitm history</code>。</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> revert HEAD~<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><blockquote><p>将会查出倒数第二次（即当前commit的往前一次）提交的修改，并创建一个新的提交，用于撤销当前提交的上一次 <code>commit</code>。</p></blockquote><h3 id="历史记录管理"><a href="#历史记录管理" class="headerlink" title="历史记录管理"></a>历史记录管理</h3><h4 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a>git log</h4><blockquote><p>查看历史提交记录。</p></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">git <span class="hljs-built_in">log</span> [<span class="hljs-comment">--oneline]</span><br></code></pre></td></tr></table></figure><blockquote><p>显示提交记录</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs 1c">$ git <span class="hljs-built_in">log</span><br>commit <span class="hljs-number">5</span>ac3ea4f50f0f558d8ba36ef7b713054c4cfee69 (HEAD -&gt; master)<br>Author: vvd-from-xiaobing&#x27;s-notebook &lt;zywvvd@mail.ustc.edu.cn&gt;<br>Date:   Sat Aug 29 16:11:56 <span class="hljs-number">2020</span> +<span class="hljs-number">0800</span><br><br>    save<br><br>commit 50f<span class="hljs-number">554063</span>e4ca<span class="hljs-number">3502</span>dfc<span class="hljs-number">31881752</span>2aee<span class="hljs-number">8886</span>3d62<br>Author: vvd-from-xiaobing&#x27;s-notebook &lt;zywvvd@mail.ustc.edu.cn&gt;<br>Date:   Sat Aug <span class="hljs-number">29</span> <span class="hljs-number">15</span>:<span class="hljs-number">56</span>:<span class="hljs-number">13</span> <span class="hljs-number">2020</span> +<span class="hljs-number">0800</span><br><br>    add-e<br><br>commit <span class="hljs-number">3</span>de3b277020322cd8f6991987fe38158d3fcdfea<br>Author: vvd-from-xiaobing&#x27;s-notebook &lt;zywvvd@mail.ustc.edu.cn&gt;<br>Date:   Sat Aug 29 15:36:23 <span class="hljs-number">2020</span> +<span class="hljs-number">0800</span><br><br>    save<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">git <span class="hljs-built_in">log</span> [<span class="hljs-comment">--oneline]</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--oneline</code>: 简略显示提交记录日志</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs smali">$ git log --oneline<br>5ac3ea4 (HEAD -&gt; master) save<br>50f5540<span class="hljs-built_in"> add-e</span><br><span class="hljs-built_in"></span>3de3b27 save<br>9313997 save<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">git <span class="hljs-built_in">log</span> [<span class="hljs-comment">--graph] [--reverse]</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--graph</code>:  查看历史中什么时候出现了分支、合并；</p><p><code>--reverse</code>: 正常上方显示最新的提交信息，该参数可以反向输出信息；</p></blockquote><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">git</span> <span class="hljs-comment">log</span> <span class="hljs-title">[</span>--<span class="hljs-comment">author</span><span class="hljs-title">]</span> <span class="hljs-title">[</span>--<span class="hljs-comment">since</span><span class="hljs-title">]</span> <span class="hljs-title">[</span>--<span class="hljs-comment">before</span><span class="hljs-title">]</span> <span class="hljs-title">[</span>--<span class="hljs-comment">until</span><span class="hljs-title">]</span> <span class="hljs-title">[</span>--<span class="hljs-comment">after</span><span class="hljs-title">]</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--author</code>: 只想查找指定用户的提交日志；</p><p><code>--since</code> <code>--until</code> <code>--until</code> <code>--after</code>: 按照时间过滤信息</p><p>实例：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> log --oneline --before=&#123;<span class="hljs-number">3</span>.weeks.ago&#125; --after=&#123;<span class="hljs-number">2010</span>-<span class="hljs-number">04</span>-<span class="hljs-number">18</span>&#125; --no-merges<br></code></pre></td></tr></table></figure></blockquote><h4 id="git-blame"><a href="#git-blame" class="headerlink" title="git blame"></a>git blame</h4><blockquote><p>查看指定文件的修改记录。</p></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">git blame &lt;<span class="hljs-built_in">file</span>&gt;<br></code></pre></td></tr></table></figure><blockquote><p>查看 <code>file</code>文件的修改记录。</p></blockquote><h3 id="远程信息流管理"><a href="#远程信息流管理" class="headerlink" title="远程信息流管理"></a>远程信息流管理</h3><h4 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a>git remote</h4><blockquote><p>用于在远程仓库的操作。</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git remote -v</span><br></code></pre></td></tr></table></figure><blockquote><p>显示所有远程仓库。</p><p>实例：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>git clone git<span class="hljs-variable">@github</span>.<span class="hljs-symbol">com:</span>zywvvd/Python_Practise.git<br><span class="hljs-variable">$ </span>cd Python_Practise<br><span class="hljs-variable">$ </span>git remote -v<br>origin  git<span class="hljs-variable">@github</span>.<span class="hljs-symbol">com:</span>zywvvd/Python_Practise.git (fetch)<br>origin  git<span class="hljs-variable">@github</span>.<span class="hljs-symbol">com:</span>zywvvd/Python_Practise.git (push)<br></code></pre></td></tr></table></figure><p><strong>origin</strong> 为远程地址的别名。</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> remote show<span class="hljs-meta"> [remote]</span><br></code></pre></td></tr></table></figure><blockquote><p>显示某个远程仓库的信息。</p><p>实例：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss">$ git remote show git<span class="hljs-keyword">@github</span>.<span class="hljs-attribute">com</span>:zywvvd/Python_Practise.git<br>* remote git<span class="hljs-keyword">@github</span>.<span class="hljs-attribute">com</span>:zywvvd/Python_Practise.git<br>  Fetch <span class="hljs-attribute">URL</span>: git<span class="hljs-keyword">@github</span>.<span class="hljs-attribute">com</span>:zywvvd/Python_Practise.git<br>  Push  <span class="hljs-attribute">URL</span>: git<span class="hljs-keyword">@github</span>.<span class="hljs-attribute">com</span>:zywvvd/Python_Practise.git<br>  HEAD <span class="hljs-attribute">branch</span>: master<br>  Local ref configured for <span class="hljs-string">&#x27;git push&#x27;</span>:<br>    master pushes to master (up to date)<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">git remote add <span class="hljs-selector-attr">[shortname]</span> <span class="hljs-selector-attr">[url]</span><br></code></pre></td></tr></table></figure><blockquote><p>添加远程版本库。</p><p>实例：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-comment"># 提交到 Github</span><br><span class="hljs-variable">$ </span>git remote add origin git<span class="hljs-variable">@github</span>.<span class="hljs-symbol">com:</span>zywvvd/Python_Practise.git<br><span class="hljs-variable">$ </span>git push -u origin master<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">git remote rm <span class="hljs-built_in">name</span><br></code></pre></td></tr></table></figure><blockquote><p>删除远程仓库。</p></blockquote><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ceylon">git remote rename old<span class="hljs-number">_n</span>ame <span class="hljs-keyword">new</span><span class="hljs-number">_n</span>ame<br></code></pre></td></tr></table></figure><blockquote><p>修改仓库名。</p></blockquote><h4 id="git-fetch"><a href="#git-fetch" class="headerlink" title="git fetch"></a>git fetch</h4><blockquote><p>用于从远程获取代码库。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git fetch <span class="hljs-tag">&lt;<span class="hljs-name">remote</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>获取远程<code>remote</code>仓库的信息，取回到本地。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git fetch <span class="hljs-tag">&lt;<span class="hljs-name">remote</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">branch</span>&gt;</span> <br></code></pre></td></tr></table></figure><blockquote><p>取回特定分支的更新，可以指定分支名。</p><p>实例：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git fetch origin <span class="hljs-literal">master</span><br></code></pre></td></tr></table></figure></blockquote><h4 id="git-pull"><a href="#git-pull" class="headerlink" title="git pull"></a>git pull</h4><blockquote><p>从一个仓库或者本地的分支拉取并且整合代码。</p></blockquote><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">git pull <span class="hljs-meta">[&lt;options&gt;]</span> <span class="hljs-meta">[&lt;repository&gt; [&lt;refspec&gt;]</span>]<br></code></pre></td></tr></table></figure><blockquote><p><code>git pull</code>相当于 <code>git fetch</code> 跟着一个 <code>git merge FETCH_HEAD</code>。<code>&lt;repository&gt;</code>是仓库的名字，<code>&lt;refspec&gt;</code> 是分支的名字。如果都不写，会有一个默认值。</p><p>实例：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git pull origin <span class="hljs-literal">master</span><br></code></pre></td></tr></table></figure><p>拉取远程服务器<code>origin</code>的<code>master</code>分支。</p></blockquote><p>注：git pull = git fetch + git merge。</p><h4 id="git-push"><a href="#git-push" class="headerlink" title="git push"></a>git push</h4><blockquote><p>用于将本地分支的更新，推送到远程主机。</p></blockquote><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bnf">git push <span class="hljs-attribute">&lt;远程主机名&gt;</span> <span class="hljs-attribute">&lt;本地分支名&gt;</span>:<span class="hljs-attribute">&lt;远程分支名&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>分支推送顺序的写法是&lt;来源地&gt;:&lt;目的地&gt;，所以git pull是&lt;远程分支&gt;:&lt;本地分支&gt;，而git push是&lt;本地分支&gt;:&lt;远程分支&gt;。</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git push origin <span class="hljs-literal">master</span>:<span class="hljs-literal">master</span><br></code></pre></td></tr></table></figure><blockquote><p>将本地的master分支推送到origin主机的master分支，如果后者不存在，则会被新建。</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> master<br></code></pre></td></tr></table></figure><blockquote><p>如果省略远程分支名，则表示将本地分支推送与之存在”追踪关系”的远程分支(通常两者同名)，如果该远程分支不存在，则会被新建。</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span><br></code></pre></td></tr></table></figure><blockquote><p>如果当前分支与远程分支之间存在追踪关系，则本地分支和远程分支都可以省略。</p></blockquote><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">git <span class="hljs-keyword">push</span><br></code></pre></td></tr></table></figure><blockquote><p>如果当前分支只有一个追踪分支，那么主机名都可以省略。</p></blockquote><p>注：不带任何参数的git push，默认只推送当前分支，这叫做simple方式。此外，还有一种matching方式，会推送所有有对应的远程分支的本地分支。Git 2.0版本之前，默认采用matching方法，现在改为默认采用simple方式。如果要修改这个设置，可以采用git config命令。</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">git config --<span class="hljs-meta">global</span> <span class="hljs-keyword">push</span><span class="hljs-number">.</span><span class="hljs-meta">default</span> matching<br>或<br>git config --<span class="hljs-meta">global</span> <span class="hljs-keyword">push</span><span class="hljs-number">.</span><span class="hljs-meta">default</span> simple<br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> -u <span class="hljs-built_in">origin</span> master<br></code></pre></td></tr></table></figure><blockquote><p>如果当前分支与多个主机存在追踪关系，则可以使用-u选项指定一个默认主机，这样后面就可以不加任何参数使用git push。</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> --all <span class="hljs-built_in">origin</span><br></code></pre></td></tr></table></figure><blockquote><p>将所有本地分支都推送到origin主机。</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> :master<br>或<br>git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> --<span class="hljs-built_in">delete</span> master<br></code></pre></td></tr></table></figure><blockquote><p>如果省略本地分支名，则表示删除指定的远程分支，因为这等同于推送一个空的本地分支到远程分支。</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> --force <span class="hljs-built_in">origin</span><br></code></pre></td></tr></table></figure><blockquote><p>如果远程主机的版本比本地版本更新，推送时Git会报错，要求先在本地做git pull合并差异，然后再推送到远程主机。这时，如果你一定要推送，可以使用–force选项。</p><p>上面命令使用–force选项，结果导致在远程主机产生一个”非直进式”的合并(non-fast-forward merge)。除非你很确定要这样做，否则应该尽量避免使用–force选项。</p></blockquote><h3 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h3><h4 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a>git branch</h4><blockquote><p>用于分支管理。</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git branch</span><br></code></pre></td></tr></table></figure><blockquote><p>列出本地分支。</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">git branch -v</span> <br></code></pre></td></tr></table></figure><blockquote><p>查看每一个分支的最后一次提交。</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">--merged` 与 `--no-merged` 这两个有用的选项可以过滤这个列表中已经合并或尚未合并到当前分支的分支。 如果要查看哪些分支已经合并到当前分支，可以运行 `git branch --merged<br></code></pre></td></tr></table></figure></blockquote><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">git <span class="hljs-keyword">branch </span>--remote<br>或<br>git <span class="hljs-keyword">branch </span>-r<br></code></pre></td></tr></table></figure><blockquote><p>列出远程分支。</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">git branch <span class="hljs-comment">--all</span><br>或<br>git branch -<span class="hljs-keyword">a</span><br></code></pre></td></tr></table></figure><blockquote><p>列出本地和远程所有分支。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git branch <span class="hljs-tag">&lt;<span class="hljs-name">branchname</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>创建分支。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git branch -d <span class="hljs-tag">&lt;<span class="hljs-name">branchname</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>删除本地分支。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git branch -d -r <span class="hljs-tag">&lt;<span class="hljs-name">branchname</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>删除远程分支，删除后还需推送到服务器 <code> git push origin:&lt;branchname&gt;</code>。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git branch -m <span class="hljs-tag">&lt;<span class="hljs-name">oldbranch</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">newbranch</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>重命名本地分支。</p></blockquote><h4 id="git-checkout-1"><a href="#git-checkout-1" class="headerlink" title="git checkout"></a>git checkout</h4><blockquote><p>checkout 命令除了放弃掉所有还没有提交的修改外，还有切换分支的功能。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git checkout <span class="hljs-tag">&lt;<span class="hljs-name">branchname</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>切换到指定分支。</p></blockquote><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">git</span> checkout -<span class="hljs-keyword">b</span> &lt;branchname&gt;<br></code></pre></td></tr></table></figure><blockquote><p>创建分支并切换过去。</p></blockquote><h4 id="git-merge"><a href="#git-merge" class="headerlink" title="git merge"></a>git merge</h4><blockquote><p>用于从指定的<strong>commit(s)<strong>合并到</strong>当前分支</strong>的操作，有以下两种用途：</p><ol><li>用于git-pull中，来整合另一代码仓库中的变化（即：git pull = git fetch + git merge）</li><li>用于从一个分支到另一个分支的合并</li></ol></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">git merge -m <span class="hljs-tag">&lt;<span class="hljs-name">msg</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">commit</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>将<code>commit</code>合并到当前分支。</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">git <span class="hljs-built_in">merge</span> <span class="hljs-comment">--abort</span><br></code></pre></td></tr></table></figure><blockquote><p>该命令仅仅在合并后导致冲突时才使用。<code>git merge --abort</code>将会抛弃合并过程并且尝试重建合并前的状态。但是，当合并开始时如果存在未commit的文件，<code>git merge --abort</code>在某些情况下将无法重现合并前的状态（特别是这些未commit的文件在合并的过程中将会被修改时）。</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">git <span class="hljs-built_in">merge</span> <span class="hljs-comment">--commit</span><br>和<br>git <span class="hljs-built_in">merge</span> <span class="hljs-comment">--no-commit</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--commit</code>参数使得合并后产生一个合并结果的commit节点。该参数可以覆盖<code>--no-commit</code>。<br> <code>--no-commit</code>参数使得合并后，为了防止合并失败并不自动提交，能够给使用者一个机会在提交前审视和修改合并结果。</p></blockquote><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata">git <span class="hljs-keyword">merge</span> --<span class="hljs-keyword">edit</span> / -<span class="hljs-keyword">e</span><br>和<br>git <span class="hljs-keyword">merge</span> --<span class="hljs-keyword">no</span>-<span class="hljs-keyword">edit</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--edit</code>和<code>-e</code>用于在成功合并、提交前调用编辑器来进一步编辑自动生成的合并信息。因此使用者能够进一步解释和判断合并的结果。<br> <code>--no-edit</code>参数能够用于接受自动合并的信息（通常情况下并不鼓励这样做）。</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">git <span class="hljs-built_in">merge</span> <span class="hljs-comment">--ff</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--ff</code>是指fast-forward命令。当使用fast-forward模式进行合并时，将不会创造一个新的commit节点。默认情况下，<code>git-merge</code>采用fast-forward模式。</p></blockquote><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fortran">git <span class="hljs-built_in">merge</span> --ff-<span class="hljs-keyword">only</span><br></code></pre></td></tr></table></figure><blockquote><p>除非当前HEAD节点已经up-to-date（更新指向到最新节点）或者能够使用fast-forward模式进行合并，否则的话将拒绝合并，并返回一个失败状态。</p></blockquote><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata">git <span class="hljs-keyword">merge</span> --<span class="hljs-keyword">log</span>[=&lt;<span class="hljs-keyword">n</span>&gt;]<br>和<br>git <span class="hljs-keyword">merge</span> --<span class="hljs-keyword">no</span>-<span class="hljs-keyword">log</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--log[=&lt;n&gt;]</code>将在合并提交时，除了含有分支名以外，还将含有最多n个被合并commit节点的日志信息。<br><code>--no-log</code>并不会列出该信息。</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">git <span class="hljs-built_in">merge</span> <span class="hljs-comment">--stat</span><br>和<br>git <span class="hljs-built_in">merge</span> -n / <span class="hljs-comment">--no-stat</span><br></code></pre></td></tr></table></figure><blockquote><p><code>--stat</code>参数将会在合并结果的末端显示文件差异的状态。文件差异的状态也可以在git配置文件中的merge.stat配置。<br>相反，<code>-n</code>, <code>--no-stat</code>参数将不会显示该信息。</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">git <span class="hljs-built_in">merge</span> <span class="hljs-comment">--squash  </span><br>和<br>git <span class="hljs-built_in">merge</span> <span class="hljs-comment">--no-squash </span><br></code></pre></td></tr></table></figure><blockquote><p><code>--squash</code> 当一个合并发生时，从当前分支和对方分支的共同祖先节点之后的对方分支节点，一直到对方分支的顶部节点将会压缩在一起，使用者可以经过审视后进行提交，产生一个新的节点。</p></blockquote><p>注: 该参数和<code>--no-ff</code>冲突</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">git <span class="hljs-built_in">merge</span> -q / <span class="hljs-comment">--quiet</span><br>和<br>git <span class="hljs-built_in">merge</span> -v / <span class="hljs-comment">--verbose</span><br></code></pre></td></tr></table></figure><blockquote><p><code>-q / --quiet</code> : 静默操作，不显示合并进度信息；</p><p><code>-v / --verbose</code>: 显示详细的合并结果信息。</p></blockquote><h4 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a>git rebase</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">git rebase -<span class="hljs-selector-tag">i</span> <br></code></pre></td></tr></table></figure><blockquote><p>将本地的多次提交合并为一个，以简化提交历史。<strong>本地有多个提交时,如果不进行这一步,在git rebase master时会多次解决冲突(最坏情况下,每一个提交都会相应解决一个冲突)</strong></p><p>示例：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git checkout <span class="hljs-keyword">master</span><br><span class="hljs-title">git</span> pull<br>git checkout local<br>git rebase -i HEAD~<span class="hljs-number">2</span>  //合并提交 --- <span class="hljs-number">2</span>表示合并两个<br>git rebase <span class="hljs-literal">master</span>----&gt;解决冲突---&gt;git rebase --continue<br>git checkout <span class="hljs-keyword">master</span><br><span class="hljs-title">git</span> merge local<br>git push<br></code></pre></td></tr></table></figure></blockquote><h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><h4 id="git-tag"><a href="#git-tag" class="headerlink" title="git tag"></a>git tag</h4><blockquote><p>给仓库历史中的某一个提交打上标签</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span> <span class="hljs-title">&lt;name</span>&gt;<br></code></pre></td></tr></table></figure><blockquote><p>给当前commit打上轻量标签</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">git <span class="hljs-built_in">log</span> --oneline<br><span class="hljs-number">49</span>a021d (HEAD -&gt; master) <span class="hljs-keyword">c</span><br>cf68aa3 d<br><span class="hljs-number">5318</span>a62 (<span class="hljs-keyword">ta</span><span class="hljs-variable">g:</span> <span class="hljs-keyword">tag</span>-test, dev) <span class="hljs-keyword">b</span> added:<br><span class="hljs-number">75</span>c5c3e <span class="hljs-built_in">add</span>-<span class="hljs-keyword">a</span><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span> <span class="hljs-title">-l</span> <span class="hljs-tag">&lt;re&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>列出仓库中的tag列表</p><p>可以使用正则表达式选择感兴趣的标签</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span> <span class="hljs-title">-l</span> <span class="hljs-string">&quot;test*&quot;</span><br>test-<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span> <span class="hljs-title">-a</span> <span class="hljs-tag">&lt;name&gt;</span> -m <span class="hljs-tag">&lt;comments&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>创建附注标签，通过使用 <code>git show</code> 命令可以看到标签信息和与之对应的提交信息：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ git <span class="hljs-keyword">show</span> test<span class="hljs-number">-2</span><br><span class="hljs-keyword">commit</span> <span class="hljs-number">49</span>a021da8afad6b33f41a21fce057040c8ae8f80 (HEAD -&gt; master, tag: test<span class="hljs-number">-2</span>)<br>Author: zywvvd &lt;zywvvd@mail.ustc.edu.cn&gt;<br><span class="hljs-type">Date</span>:   Sat Oct <span class="hljs-number">17</span> <span class="hljs-number">14</span>:<span class="hljs-number">22</span>:<span class="hljs-number">13</span> <span class="hljs-number">2020</span> +<span class="hljs-number">0800</span><br><br> c<br><br>diff <span class="hljs-comment">--git a/c b/c</span><br><span class="hljs-built_in">new</span> file mode <span class="hljs-number">100644</span><br><span class="hljs-keyword">index</span> <span class="hljs-number">0000000.</span>.e69de29<br></code></pre></td></tr></table></figure><p>也可以为某个commit打标签：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> tag -a v<span class="hljs-number">1</span>.<span class="hljs-number">2</span> <span class="hljs-number">9</span>fceb<span class="hljs-number">02</span><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> &lt;tagname&gt;<br></code></pre></td></tr></table></figure><blockquote><p>推送标签，普通的<code>git push</code>并不会把本地的标签推送到远程，需要手动推送标签。</p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">push</span> <span class="hljs-built_in">origin</span> --tags<br></code></pre></td></tr></table></figure><blockquote><p>如果想要一次性推送很多标签，也可以使用带有 <code>--tags</code> 选项的 <code>git push</code> 命令。 这将会把所有不在远程仓库服务器上的标签全部传送到那里。</p></blockquote><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git <span class="hljs-keyword">tag</span> <span class="hljs-title">-d</span> <span class="hljs-tag">&lt;tagname&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>删除掉你本地仓库上的标签。</p></blockquote><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">git push origin <span class="hljs-symbol">:refs/tags/&lt;tagname&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>删除远程标签</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">git</span> checkout <span class="hljs-number">2</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><blockquote><p>检出标签所在的commit，会处于“分离头指针（detached HEAD）”的状态。</p></blockquote><h4 id="git-选项"><a href="#git-选项" class="headerlink" title="git 选项"></a>git 选项</h4><ul><li>-d –delete：删除</li><li> -f –force：强制 </li><li>-m –move：移动或重命名 </li><li>-r –remote：远程 </li><li>-a –all：所有</li></ul><h3 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h3><ul><li><a href="https://www.runoob.com/git/git-basic-operations.html">https://www.runoob.com/git/git-basic-operations.html</a></li><li><a href="https://www.jianshu.com/p/37f3a7e4a193">https://www.jianshu.com/p/37f3a7e4a193</a></li><li><a href="https://blog.csdn.net/chaiyu2002/article/details/82120256">https://blog.csdn.net/chaiyu2002/article/details/82120256</a></li><li><a href="https://www.cnblogs.com/djiankuo/p/6492533.html">https://www.cnblogs.com/djiankuo/p/6492533.html</a></li><li><a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86">https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%AE%A1%E7%90%86</a></li><li><a href="https://www.jianshu.com/p/58a166f24c81">https://www.jianshu.com/p/58a166f24c81</a></li><li><a href="https://blog.csdn.net/stone_yw/article/details/80795669">https://blog.csdn.net/stone_yw/article/details/80795669</a></li><li><a href="https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%89%93%E6%A0%87%E7%AD%BE">https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%89%93%E6%A0%87%E7%AD%BE</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>机器学习-基础知识- 目标检测相关概念解释</title>
    <link href="/2020/05/05/machine_learning/basic_knowledge/key_words/key-words-in-machine-lerning/"/>
    <url>/2020/05/05/machine_learning/basic_knowledge/key_words/key-words-in-machine-lerning/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍机器学习目标检测相关各种基础概念的介绍。</p></blockquote><span id="more"></span><h2 id="目标检测"><a href="#目标检测" class="headerlink" title="目标检测"></a>目标检测</h2><blockquote><p>目标检测，也叫目标提取，是一种基于目标几何和统计特征的图像分割，它将目标的分割和识别合二为一，其准确性和实时性是整个系统的一项重要能力。</p><p>目标检测是计算机视觉和数字图像处理的一个热门方向，广泛应用于机器人导航、智能视频监控、工业检测、航空航天等诸多领域，通过计算机视觉减少对人力资本的消耗，具有重要的现实意义。因此，目标检测也就成为了近年来理论和应用的研究热点，它是图像处理和计算机视觉学科的重要分支，也是智能监控系统的核心部分，同时目标检测也是泛身份识别领域的一个基础性的算法，对后续的人脸识别、步态识别、人群计数、实例分割等任务起着至关重要的作用。由于深度学习的广泛运用，目标检测算法得到了较为快速的发展。</p></blockquote><h2 id="Ground-Truth"><a href="#Ground-Truth" class="headerlink" title="Ground Truth"></a>Ground Truth</h2><blockquote><p>Ground Truth(GT) 代表通过人工等方式为数据赋予的真实标签，用于训练模型与验证、测试模型性能。</p></blockquote><h2 id="Bounding-Box-bbox"><a href="#Bounding-Box-bbox" class="headerlink" title="Bounding Box (bbox)"></a>Bounding Box (bbox)</h2><blockquote><p>目标检测需要定位图像中的目标位置和类别，反映在数据上的形式就是使用矩形框框出目标区域，并标记类别标签，这就是目标检测的Bounding Box ，标注与算法输出都使用该形式，以便机器学习并对比实验结果。</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200505191519.png"></p><h2 id="ROI-region-of-interest"><a href="#ROI-region-of-interest" class="headerlink" title="ROI (region of interest)"></a>ROI (region of interest)</h2><blockquote><p>感兴趣区域，与bbox概念类似，定义图像中我们感兴趣的部分，交给机器进行学习。</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200505192257.png"></p><h2 id="IoU-Intersection-over-Union"><a href="#IoU-Intersection-over-Union" class="headerlink" title="IoU (Intersection over Union)"></a>IoU (Intersection over Union)</h2><blockquote><p>交集并集比（交并比），在已有的数据库中，我们会用某种方法 标注数据，赋予数据中目标区域与类别，也就是标注ROI，检测算法学习数据后得到检测模型，模型作用于某个图像输出检测结果bbox。</p><p>IoU就是用于评价检测模型输出结果的，计算方法就是输出bbox与标记bbox交集面积与并集面积的比值。比值越高表明结果越准，反之亦然。</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200505192424.png"></p><h2 id="confidence"><a href="#confidence" class="headerlink" title="confidence"></a>confidence</h2><blockquote><p>confidence（置信度）表明检测模型对于自己检测出目标的置信程度，值越大表明模型更加笃定自己检测结果的准确性。</p></blockquote><h2 id="检测判定"><a href="#检测判定" class="headerlink" title="检测判定"></a>检测判定</h2><blockquote><p>在分类任务中，分类模型输出的结果作为其分类的类别，将该输出与真实类别标签比较即可确定此次预测是否正确，相应地得可以将此次预测划定到TP、FP、TN、FN中。</p><p>而目标检测任务中的输出结果不同于分类，该结果 包含了图像中某位置属于某类别的信息，而且很可能包含多个目标，而事实上，输出结果与标注标签完全一致是不现实的，那么如何判定检测结果是否正确呢。</p><p>在目标检测中判定结果正确需要预先设定IoU阈值，然后逐个类别判定检测框：</p><ul><li>遍历每个类别</li><li>将该类别的预测框按confidence降序排列</li><li>对于每个预测bbox，找出与其有最大IoU的gt_bbox</li><li>如果该gt_bbox之前没有被分配且IoU大于给定的阈值（比如0.5），那将该gt_bbox分配该给预测bbox，设置该预测bbox为TP；否则设置该预测bbox为FP</li><li>没有被正确预测到的gt_bbox设置为FN</li><li>在检测结果中没有显式的TN</li></ul></blockquote><h2 id="性能评估"><a href="#性能评估" class="headerlink" title="性能评估"></a>性能评估</h2><p>判定出结果后就可以用分类的评价体系计算性能指标了：</p><p><a href="https://www.zywvvd.com/2020/02/27/machine_learning/basic_knowledge/performance_evaluation/Performance-evaluation/">机器学习-基础知识 - Precision, Recall, Sensitivity, Specificity, Accuracy, FNR, FPR, TPR, TNR, F1 Score, Balanced F Score</a></p><p>也可以绘制ROC、PR曲线：</p><p><a href="https://www.zywvvd.com/2020/02/27/machine_learning/basic_knowledge/PR_and_ROC/PR-and-ROC/">机器学习-基础知识 - PR、ROC曲线与AUC</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -24- 添加相册系列 -4- 将本地相册信息部署到hexo</title>
    <link href="/2020/04/28/hexo-theme/next/24_build_online_albums/build-online-albums/"/>
    <url>/2020/04/28/hexo-theme/next/24_build_online_albums/build-online-albums/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 在之前基础工作完成后，来到了距离我们相册最接近的一步，本文介绍上线相册的一种思路，供大家参考。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li><a href="https://www.zywvvd.com/2020/03/29/next/21_add_photos/add-photos/">Next -21- 添加相册系列 - 1- 框架设置</a></li><li><a href="https://www.zywvvd.com/2020/03/31/next/22_qiniuyun_qshell/qiniuyun-qshell/">Next -22- 添加相册系列 -2- 使用七牛云qshell同步图像目录</a></li><li><a href="https://www.zywvvd.com/2020/04/22/next/23_get_image_info/get-image-info/">Next -23- 添加相册系列 -3- 获取图像信息、保存为json文件并上传图像</a></li></ul><h2 id="上线思路"><a href="#上线思路" class="headerlink" title="上线思路"></a>上线思路</h2><blockquote><p>现在我们已经有了基础的photos框架，图像文件夹已经整理完毕，提取了信息放在了json文件，并且将图像上传到了七牛云图床，在hexo source文件夹内创建了相册对应index.md 和json文件。仅需要将这些串联起来，部署到hexo即可。</p></blockquote><ul><li>在next主题中存在为二级文件夹配置内容的文件，修改该文件，在具有二级文件夹结构的index.html中加入特定类</li><li>建立js文件向类中添加内容</li><li>内容为读取json文件得到的相册信息，这样便建立起了逐个页面的相册</li><li>同理在photos中加入特定类</li><li>建立js文件读取相册json文件并建立链接目录，即完成了整个相册的基础框架</li><li>之后的优化、美化便水到渠成了</li></ul><h2 id="建立相册"><a href="#建立相册" class="headerlink" title="建立相册"></a>建立相册</h2><h3 id="向二级目录的index-html加入类"><a href="#向二级目录的index-html加入类" class="headerlink" title="向二级目录的index.html加入类"></a>向二级目录的index.html加入类</h3><blockquote><p>在 Hexo/themes/next/layout/_partials/page文件夹中 修改page-header.swig文件，加入类别为<code>album_image_grid</code>的div，并引用js文件，此时对应的二级文件夹内的index.html中便多了一个空div</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs swig">&lt;header class=&quot;post-header&quot;&gt;<br><br>&lt;&#123;%- if theme.seo %&#125;h2&#123;% else %&#125;h1&#123;%- endif %&#125; class=&quot;post-title&quot; itemprop=&quot;name headline&quot;&gt;<br>  &#123;&#123;- page.title &#125;&#125;<br>  &#123;&#123;- post_edit(page.source) &#125;&#125;<br>&lt;/&#123;%- if theme.seo %&#125;h2&#123;% else %&#125;h1&#123;%- endif %&#125;&gt;<br><br>&lt;div class=&quot;post-meta&quot;&gt;<br>  &#123;%- if page.description %&#125;<br>    &lt;div class=&quot;post-description&quot;&gt;&#123;&#123; page.description &#125;&#125;&lt;/div&gt;<br>  &#123;%- endif %&#125;<br><br>&#123;%- if page.type == &#x27;photography&#x27; %&#125;<br>  <br>  &lt;div class=&quot;album_image_grid&quot;&gt;<br><br>  &lt;/div&gt;<br>  &lt;script src=&quot;//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js&quot;&gt;&lt;/script&gt;<br>  &lt;script type=&quot;text/javascript&quot; src=&quot;/photos/album.js&quot;&gt;&lt;/script&gt;<br><br>&#123;%- endif %&#125;<br>  &#123;% include &#x27;_partials/page/breadcrumb.swig&#x27; %&#125;<br>&lt;/div&gt;<br><br>&lt;/header&gt;<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/image/20200428235933.png"></p><h3 id="建立album-js文件"><a href="#建立album-js文件" class="headerlink" title="建立album.js文件"></a>建立album.js文件</h3><blockquote><p>在Hexo/themes/next/source/photos文件夹内建立相册js文件 <code>album.js</code>，写入如下内容：</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;album js Hello World&#x27;</span>)<br><br>photo =&#123;<br>    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">offset</span>: <span class="hljs-number">20</span>,<br>    <span class="hljs-attr">init</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> that = <span class="hljs-built_in">this</span>;<br>        $.getJSON(<span class="hljs-string">&quot;readme.json&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;<br>            that.render(that.page, data);<br>            <span class="hljs-comment">//that.scroll(data);</span><br>        &#125;);<br>    &#125;,<br>    <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">page, data</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> year = data[<span class="hljs-string">&quot;time&quot;</span>][<span class="hljs-string">&quot;year&quot;</span>]<br>    <span class="hljs-keyword">var</span> month = data[<span class="hljs-string">&quot;time&quot;</span>][<span class="hljs-string">&quot;month&quot;</span>]<br>    <span class="hljs-keyword">var</span> day = data[<span class="hljs-string">&quot;time&quot;</span>][<span class="hljs-string">&quot;day&quot;</span>]<br>    <span class="hljs-keyword">var</span> type = data[<span class="hljs-string">&quot;type&quot;</span>]<br>    <span class="hljs-keyword">var</span> model = data[<span class="hljs-string">&quot;model&quot;</span>]<br>    <span class="hljs-keyword">var</span> city = data[<span class="hljs-string">&quot;position&quot;</span>][<span class="hljs-string">&#x27;city&#x27;</span>]<br>    <span class="hljs-keyword">var</span> street = data[<span class="hljs-string">&quot;position&quot;</span>][<span class="hljs-string">&#x27;street&#x27;</span>]<br>    <span class="hljs-keyword">var</span> title = data[<span class="hljs-string">&quot;title&quot;</span>]<br>    <span class="hljs-keyword">var</span> balabala = data[<span class="hljs-string">&quot;balabala&quot;</span>]<br><br>    <span class="hljs-keyword">var</span> image_info_list = data[<span class="hljs-string">&quot;image_info&quot;</span>]<br>    <span class="hljs-built_in">console</span>.log(image_info_list[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;Image_Model&quot;</span>])<br><br>    <span class="hljs-built_in">console</span>.log(year)<br>        <span class="hljs-comment">//var begin = (page - 1) * this.offset;</span><br>        <span class="hljs-comment">//var end = page * this.offset;</span><br>        <span class="hljs-comment">//if (begin &gt;= data.length) return;</span><br>        <span class="hljs-keyword">var</span> html, imgNameWithPattern, imgName, imageSize, imageX, imageY, li = <span class="hljs-string">&quot;&quot;</span>;<br><br>$(<span class="hljs-string">&quot;.album_image_grid&quot;</span>).append(<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<br>$(<span class="hljs-string">&quot;.album_image_grid&quot;</span>).append(<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; image_info_list.length ; i++) &#123;<br>        sub_image = image_info_list[i]<br>        nbsp = <span class="hljs-string">&quot;&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp&quot;</span><br>        href_str = <span class="hljs-string">&quot;&quot;</span><br><br>        image_model = sub_image[<span class="hljs-string">&quot;Image_Model&quot;</span>] <span class="hljs-comment">//相机型号</span><br>        <span class="hljs-keyword">if</span> (image_model!=<span class="hljs-string">&quot;&quot;</span>)<br>        &#123;<br>        href_str = href_str+<span class="hljs-string">&#x27;相机：&#x27;</span>+image_model+nbsp<br>        &#125;<br><br>        EXIF_fnumber = sub_image[<span class="hljs-string">&quot;EXIF_FNumber&quot;</span>] <span class="hljs-comment">//光圈</span><br>        <span class="hljs-keyword">if</span> (EXIF_fnumber!=<span class="hljs-string">&quot;&quot;</span>)<br>        &#123;<br>        href_str = href_str+<span class="hljs-string">&#x27; 光圈：&#x27;</span> +EXIF_fnumber +nbsp<br>        &#125;<br><br>        EXIF_FocalLength = sub_image[<span class="hljs-string">&quot;EXIF_FocalLength&quot;</span>] <span class="hljs-comment">//焦距</span><br>        <span class="hljs-keyword">if</span> (EXIF_FocalLength!=<span class="hljs-string">&quot;&quot;</span>)<br>        &#123;<br>        href_str = href_str+<span class="hljs-string">&#x27; 焦距：&#x27;</span> +EXIF_FocalLength +nbsp<br>        &#125;<br><br>        EXIF_exposureMode = sub_image[<span class="hljs-string">&quot;EXIF_ExposureMode&quot;</span>] <span class="hljs-comment">//曝光模式</span><br>        <span class="hljs-keyword">if</span> (EXIF_exposureMode!=<span class="hljs-string">&quot;&quot;</span>)<br>        &#123;<br>        href_str = href_str+<span class="hljs-string">&#x27; 曝光模式：&#x27;</span> +EXIF_exposureMode +nbsp<br>        &#125;<br><br>        EXIF_exposureTime = sub_image[<span class="hljs-string">&quot;EXIF_ExposureTime&quot;</span>] <span class="hljs-comment">//曝光时间</span><br>        <span class="hljs-keyword">if</span> (EXIF_exposureTime!=<span class="hljs-string">&quot;&quot;</span>)<br>        &#123;<br>        href_str = href_str+<span class="hljs-string">&#x27; 曝光时间：&#x27;</span> +EXIF_exposureTime +nbsp<br>        &#125;<br><br>        EXIF_ISOSpeedRatings = sub_image[<span class="hljs-string">&quot;EXIF_ISOSpeedRatings&quot;</span>] <span class="hljs-comment">//ISO</span><br>        <span class="hljs-keyword">if</span> (EXIF_ISOSpeedRatings!=<span class="hljs-string">&quot;&quot;</span>)<br>        &#123;<br>        href_str = href_str+<span class="hljs-string">&#x27; ISO：&#x27;</span> +EXIF_ISOSpeedRatings +nbsp<br>        &#125;<br><br>        image_url = sub_image[<span class="hljs-string">&quot;url&quot;</span>]<br><br>            li += <span class="hljs-string">&#x27;&lt;div class=&quot;card&quot; style=&quot;width:100%&quot;&gt;&#x27;</span> +<br>                    <span class="hljs-string">&#x27;&lt;div class=&quot;ImageInCard&quot;&gt;&#x27;</span> +<br>                      <span class="hljs-string">&#x27;&lt;a data-fancybox=&quot;gallery&quot; href=&quot;&#x27;</span> + image_url + <span class="hljs-string">&#x27;?raw=true&quot; data-caption=&quot;&#x27;</span> + href_str +<span class="hljs-string">&#x27;&quot;&gt;&#x27;</span> +<br>                        <span class="hljs-string">&#x27;&lt;img src=&quot;&#x27;</span> + image_url + <span class="hljs-string">&#x27;?raw=true&quot;/&gt;&#x27;</span> +<br>                      <span class="hljs-string">&#x27;&lt;/a&gt;&#x27;</span> + <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span> +<br>                    <span class="hljs-string">&#x27;&lt;/div&gt;&#x27;</span> +<br>                    <span class="hljs-comment">// &#x27;&lt;div class=&quot;TextInCard&quot;&gt;&#x27; + imgName + &#x27;&lt;/div&gt;&#x27; +</span><br>                  <span class="hljs-string">&#x27;&lt;/div&gt;&#x27;</span><br>        &#125;<br>        $(<span class="hljs-string">&quot;.album_image_grid&quot;</span>).append(li);<br>        <span class="hljs-comment">//$(&quot;.album_image_grid&quot;).lazyload();</span><br>        <span class="hljs-comment">//this.minigrid();</span><br>    &#125;,<br>    <br>&#125;<br>photo.init();<br></code></pre></td></tr></table></figure><blockquote><p>此时访问某个二级目录的地址可以看到图像已经上线</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200429000313.png"></p><h2 id="建立相册目录"><a href="#建立相册目录" class="headerlink" title="建立相册目录"></a>建立相册目录</h2><h3 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h3><blockquote><p>在Hexo/themes/next/layout文件夹内，修改page.swig，在schedule的elif后面加入内容：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs swig">&#123;% elif page.type === &#x27;schedule&#x27; %&#125;<br>          &lt;div class=&quot;event-list&quot;&gt;<br>          &lt;/div&gt;<br>          &#123;% include &#x27;_scripts/pages/schedule.swig&#x27; %&#125;<br>        <br>        &#123;% elif page.type === &#x27;photos&#x27; %&#125;<br><br>           &lt;div class=&quot;album_link_list&quot;&gt;<br><br>           &lt;/div&gt;<br>   <br>   &lt;script src=&quot;//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js&quot;&gt;&lt;/script&gt;<br>   &lt;script type=&quot;text/javascript&quot; src=&quot;https://unpkg.com/minigrid@3.1.1/dist/minigrid.min.js&quot;&gt;&lt;/script&gt;<br>   &lt;link rel=&quot;stylesheet&quot; href=&quot;/photos/photos.css&quot;&gt;<br>   &lt;script type=&quot;text/javascript&quot; src=&quot;/photos/photo.js&quot;&gt;&lt;/script&gt;<br><br>        &#123;% else %&#125;<br>          &#123;&#123; page.content &#125;&#125;<br>        &#123;%- endif %&#125;<br></code></pre></td></tr></table></figure><blockquote><p>在同文件夹内建立文件 photos.swig 写入内容</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs swig">&#123;% extends &#x27;_layout.swig&#x27; %&#125;<br>&#123;% import &#x27;_macro/post-collapse.swig&#x27; as post_template with context %&#125;<br>&#123;% import &#x27;_macro/sidebar.swig&#x27; as sidebar_template with context %&#125;<br><br>&#123;% block title %&#125;&#123;&#123; __(&#x27;title.photos&#x27;) &#125;&#125;: &#123;&#123; page.photos &#125;&#125; | &#123;&#123; title &#125;&#125;&#123;% endblock %&#125;<br><br>&#123;% block content %&#125;<br><br>  &#123;#################&#125;<br>  &#123;### photos BLOCK ###&#125;<br>  &#123;#################&#125;<br>  &lt;div class=&quot;post-block&quot;&gt;<br>    &lt;div class=&quot;posts-collapse&quot;&gt;<br>      &lt;div class=&quot;collection-title&quot;&gt;<br>        &lt;&#123;%- if theme.seo %&#125;h2&#123;% else %&#125;h1&#123;%- endif %&#125; class=&quot;collection-header&quot;&gt;<br>          &#123;&#123;- page.photos &#125;&#125;<br>          &lt;small&gt;&#123;&#123; __(&#x27;title.photos&#x27;) &#125;&#125;&lt;/small&gt;<br>        &lt;/&#123;%- if theme.seo %&#125;h2&#123;% else %&#125;h1&#123;%- endif %&#125;&gt;<br>      &lt;/div&gt;<br><br>      &#123;&#123; post_template.render(page.posts) &#125;&#125;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>  &#123;#####################&#125;<br>  &#123;### END photos BLOCK ###&#125;<br>  &#123;#####################&#125;<br><br>  &#123;% include &#x27;_partials/pagination.swig&#x27; %&#125;<br><br>&#123;% endblock %&#125;<br>&#123;&#123; page.date &#125;&#125;<br><br>&#123;% block sidebar %&#125;<br>  &#123;&#123; sidebar_template.render(false) &#125;&#125;<br>&#123;% endblock %&#125;<br></code></pre></td></tr></table></figure><h3 id="建立photos-js文件"><a href="#建立photos-js文件" class="headerlink" title="建立photos.js文件"></a>建立photos.js文件</h3><blockquote><p>在Hexo/themes/next/source/photos文件夹内建立相册js文件 <code>photos.js</code>，写入如下内容：</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs JavaScript"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Photos js Hello World&#x27;</span>)<br><br>photo =&#123;<br>    <span class="hljs-attr">init</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> that = <span class="hljs-built_in">this</span>;<br>        $.getJSON(<span class="hljs-string">&quot;album.json&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>&#123;<br>            that.render(that.page, data);<br>            <span class="hljs-comment">//that.scroll(data);</span><br>        &#125;);<br>    &#125;,<br>    <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">page, data</span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> album_list = data[<span class="hljs-string">&#x27;album&#x27;</span>];<br>        <span class="hljs-keyword">var</span> html, imgNameWithPattern, imgName, imageSize, imageX, imageY, li = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">var</span> link_profix = <span class="hljs-string">&quot;/photos/&quot;</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; album_list.length; i++) &#123;<br><br>            album_info = album_list[i]<br><br>            dir_name = album_info[<span class="hljs-string">&quot;directory&quot;</span>]<br><br>            title = album_info[<span class="hljs-string">&quot;title&quot;</span>]<br>            <span class="hljs-comment">/*console.log(album_info)</span><br><span class="hljs-comment">            imgNameWithPattern = data[i].split(&#x27; &#x27;)[1];</span><br><span class="hljs-comment">            imgName = imgNameWithPattern.split(&#x27;.&#x27;)[0]</span><br><span class="hljs-comment">            imageSize = data[i].split(&#x27; &#x27;)[0];</span><br><span class="hljs-comment">            imageX = imageSize.split(&#x27;.&#x27;)[0];</span><br><span class="hljs-comment">            imageY = imageSize.split(&#x27;.&#x27;)[1];*/</span><br>            li += <span class="hljs-string">&#x27;&lt;div&gt;&#x27;</span> +<br>                      <span class="hljs-string">&#x27;&lt;a href=&quot;&#x27;</span> +link_profix + dir_name + <span class="hljs-string">&#x27;/&quot;&gt;&#x27;</span> +<br>                          title + <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span> + <br>                      <span class="hljs-string">&#x27;&lt;/a&gt;&#x27;</span> +<br>                    <span class="hljs-comment">// &#x27;&lt;div class=&quot;TextInCard&quot;&gt;&#x27; + imgName + &#x27;&lt;/div&gt;&#x27; +</span><br>                  <span class="hljs-string">&#x27;&lt;/div&gt;&#x27;</span><br>        &#125;<br>        $(<span class="hljs-string">&quot;.album_link_list&quot;</span>).append(li);<br>        <span class="hljs-comment">//$(&quot;.ImageGrid&quot;).lazyload();</span><br>        <span class="hljs-built_in">this</span>.minigrid();<br>    &#125;,<br>    <span class="hljs-attr">minigrid</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">var</span> grid = <span class="hljs-keyword">new</span> Minigrid(&#123;<br>            <span class="hljs-attr">container</span>: <span class="hljs-string">&#x27;.ImageGrid&#x27;</span>,<br>            <span class="hljs-attr">item</span>: <span class="hljs-string">&#x27;.card&#x27;</span>,<br>            <span class="hljs-attr">gutter</span>: <span class="hljs-number">12</span><br>        &#125;);<br>        grid.mount();<br>        $(<span class="hljs-built_in">window</span>).resize(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>           grid.mount();<br>        &#125;);<br>    &#125;<br>&#125;<br>photo.init();<br><br></code></pre></td></tr></table></figure><blockquote><p>此时便有了相册目录：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200429001245.png"></p><blockquote><p>至此我们已经完成了相册的基础框架，美化等工作仅需在此基础上顺水推舟即可。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -23- 添加相册系列 -3- 获取图像信息、保存为json文件并上传图像</title>
    <link href="/2020/04/22/hexo-theme/next/23_get_image_info/get-image-info/"/>
    <url>/2020/04/22/hexo-theme/next/23_get_image_info/get-image-info/</url>
    
    <content type="html"><![CDATA[<blockquote><p>相册需要在本地建立文件夹，为了维护相册，需要自动生成对应图像的json文件，并自动压缩上传，本文分享我的python程序，提供一种解决方案供大家使用参考。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li><p>qshell 上传至七牛云图床 <a href="https://www.zywvvd.com/2020/03/31/next/22_qiniuyun_qshell/qiniuyun-qshell/">Next -22- 添加相册系列 -2- 使用七牛云qshell同步图像目录</a></p></li><li><p>python 运行环境</p></li><li><p>准备好的图像文件夹</p></li></ul><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ul><li>自动读取文件夹中的所有图像</li><li>压缩到固定尺寸</li><li>转存到指定的临时文件夹</li><li>自动上传至七牛云</li><li>自动提取图像信息并保存到json</li><li>整合所有相册信息到json</li></ul><h2 id="工程代码"><a href="#工程代码" class="headerlink" title="工程代码"></a>工程代码</h2><blockquote><p>配置文件</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> platform<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parameters</span>:</span><br>    <br>    Image_Root_Path = <span class="hljs-string">r&#x27;/media/vvd/新加卷/pic&#x27;</span>                                   <span class="hljs-comment"># root of source raw images</span><br>    Hexo_Root_Path =<span class="hljs-string">r&#x27;/home/vvd/VVD_Work/Hexo/VVD_Hexo&#x27;</span>                         <span class="hljs-comment"># root of Hexo dir  </span><br>    Hexo_Sub_Dir_to_Photos = <span class="hljs-string">r&#x27;source/photos&#x27;</span>                                   <span class="hljs-comment"># my source dir for album</span><br>    Uploading_Temp_Image_Path = <span class="hljs-string">r&#x27;/home/vvd/VVD_Work/Hexo/Album_Temp&#x27;</span>           <span class="hljs-comment"># root of temp image dir</span><br>    Album_Ddescription_File_Name = <span class="hljs-string">&#x27;readme.json&#x27;</span>                                <span class="hljs-comment"># name of json file in each image dir</span><br>    Log_File_Name = <span class="hljs-string">&#x27;Album_Log.log&#x27;</span>                                             <span class="hljs-comment"># name of log file</span><br>    Album_Total_Json = <span class="hljs-string">&#x27;album.json&#x27;</span>                                             <span class="hljs-comment"># json info of album</span><br>    Album_Md_File_Name = <span class="hljs-string">&#x27;index.md&#x27;</span>                                             <span class="hljs-comment"># name of markdown file of hexo </span><br>    Qshell_Config_File_Name = <span class="hljs-string">&#x27;upload.conf&#x27;</span>                                     <span class="hljs-comment"># qiniu qshell config file name </span><br>    <br>    Logging_Object = <span class="hljs-literal">None</span>                                                       <span class="hljs-comment"># object of logging class</span><br>    Image_Info_Get_Object = <span class="hljs-literal">None</span>                                                <span class="hljs-comment"># instance of PhotoExifInfo</span><br>    <br>    Image_Extension_List =[<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>,<span class="hljs-string">&#x27;jpeg&#x27;</span>,<span class="hljs-string">&#x27;bmp&#x27;</span>]                            <span class="hljs-comment"># list of common image extensions </span><br>    Image_Resize_Width = <span class="hljs-number">2000</span>                                                   <span class="hljs-comment"># image width after resize</span><br>    Whether_Overwrite_Old_Temp_File = <span class="hljs-literal">False</span>                                     <span class="hljs-comment"># whether overwrite old file while the program run again</span><br>    Image_Url_Prefix =<span class="hljs-string">r&#x27;https://photos.zywvvd.com/vvd_hexo/&#x27;</span>                    <span class="hljs-comment"># prefix of image url</span><br>    Force_Upload = <span class="hljs-literal">False</span>                                                        <span class="hljs-comment"># upload images no matter what happens</span><br><br>    Current_System = platform.system()                                          <span class="hljs-comment"># current operating system</span><br>    <span class="hljs-keyword">if</span> Current_System == <span class="hljs-string">&#x27;Linux&#x27;</span>:<br>        Split_Char =<span class="hljs-string">&#x27;/&#x27;</span>                                                         <span class="hljs-comment"># split char of current operating system</span><br>    <span class="hljs-keyword">elif</span> Current_System == <span class="hljs-string">&#x27;Windows&#x27;</span>:<br>        Split_Char =<span class="hljs-string">&#x27;\\&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p>图像信息提取</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># getinfo.py</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhotoExifInfo</span>():</span><br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <br>        <span class="hljs-keyword">if</span> os.path.exists(<span class="hljs-string">&#x27;vvdkey.py&#x27;</span>):<br>            <span class="hljs-keyword">from</span> vvdkey <span class="hljs-keyword">import</span> baidu_key <span class="hljs-comment"># 使用你自己的百度key</span><br>            self.baidu_map_ak = baidu_key<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment">## set your baidu map key here</span><br>            self.baidu_map_ak = <span class="hljs-string">&quot;&quot;</span><br>            <br>        self.interested_keys = &#123;<br>            <span class="hljs-comment"># camera Model</span><br>            <span class="hljs-string">&#x27;Image Model&#x27;</span>:<span class="hljs-string">&#x27;Image_Model&#x27;</span>,<span class="hljs-comment">#&#x27;相机型号&#x27;,</span><br>            <span class="hljs-comment"># Aperture 1/value</span><br>            <span class="hljs-string">&#x27;EXIF FNumber&#x27;</span>:<span class="hljs-string">&#x27;EXIF_FNumber&#x27;</span>,<span class="hljs-comment">#&#x27;光圈&#x27;,</span><br>            <span class="hljs-comment"># Focal Length</span><br>            <span class="hljs-string">&#x27;EXIF FocalLength&#x27;</span>:<span class="hljs-string">&#x27;EXIF_FocalLength&#x27;</span>,<span class="hljs-comment">#&#x27;焦距&#x27;,</span><br>            <span class="hljs-comment"># Exposure Mode</span><br>            <span class="hljs-string">&#x27;EXIF ExposureMode&#x27;</span>:<span class="hljs-string">&#x27;EXIF_ExposureMode&#x27;</span>,<span class="hljs-comment">#&#x27;曝光模式&#x27;,</span><br>            <span class="hljs-comment"># ExposureTime in seconds</span><br>            <span class="hljs-string">&#x27;EXIF ExposureTime&#x27;</span>:<span class="hljs-string">&#x27;EXIF_ExposureTime&#x27;</span>,<span class="hljs-comment">#&#x27;曝光时间&#x27;,</span><br>            <span class="hljs-comment"># ISO</span><br>            <span class="hljs-string">&#x27;EXIF ISOSpeedRatings&#x27;</span>:<span class="hljs-string">&#x27;EXIF_ISOSpeedRatings&#x27;</span>,<span class="hljs-comment">#&#x27;ISO&#x27;,</span><br>            <span class="hljs-comment"># date of photo</span><br>            <span class="hljs-string">&#x27;Image DateTime&#x27;</span>:<span class="hljs-string">&#x27;Image_DateTime&#x27;</span><span class="hljs-comment">#&#x27;拍摄时间&#x27;,</span><br>        &#125;<br>        <br>        <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_image_info</span>(<span class="hljs-params">self,image_path</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        获取照片信息</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        image_info_dict=&#123;&#125;<br>        <br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(image_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> fp:<br>            tags = exifread.process_file(fp)<br>        <br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> tags:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;j&#125;</span> :<span class="hljs-subst">&#123;tags[j]&#125;</span>&quot;</span>)<br>        <br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> <span class="hljs-built_in">tuple</span>(self.interested_keys):<br>            <br>            <span class="hljs-keyword">try</span>:<br>                info = tags[item].printable<br>                <span class="hljs-keyword">if</span> item == <span class="hljs-string">&#x27;EXIF FNumber&#x27;</span>:<br>                    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;/&#x27;</span> <span class="hljs-keyword">in</span> info:<br>                        A,B = info.split(<span class="hljs-string">&#x27;/&#x27;</span>)<br>                        info = <span class="hljs-string">&#x27;f&#x27;</span>+<span class="hljs-built_in">format</span>(<span class="hljs-built_in">int</span>(A)/<span class="hljs-built_in">int</span>(B),<span class="hljs-string">&#x27;.1f&#x27;</span>)<br>                    <span class="hljs-keyword">else</span>:<br>                        info = <span class="hljs-string">&#x27;f&#x27;</span>+info<br>                <span class="hljs-keyword">if</span> item == <span class="hljs-string">&#x27;EXIF FocalLength&#x27;</span>:<br>                    info = info+<span class="hljs-string">&#x27;mm&#x27;</span><br>                <span class="hljs-keyword">if</span> item == <span class="hljs-string">&#x27;EXIF ExposureTime&#x27;</span>:<br>                    info = info+<span class="hljs-string">&#x27;s&#x27;</span><br>                image_info_dict[self.interested_keys[item]] = info<br>                <br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;image_path&#125;</span> has no attribute of <span class="hljs-subst">&#123;item&#125;</span>&#x27;</span>)                <br>                <span class="hljs-keyword">continue</span><br>            <br>        <span class="hljs-keyword">try</span>:<br>            localcation = self._get_city_info(tags)<br>            <span class="hljs-keyword">if</span> localcation != <span class="hljs-string">&quot;&quot;</span>:<br>                image_info_dict[<span class="hljs-string">&#x27;positon&#x27;</span>] = localcation<br>                <br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;image_path&#125;</span> has no GPS info&#x27;</span>)    <br>            <br>        <span class="hljs-keyword">return</span> image_info_dict<br>       <br>       <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_lng_lat</span>(<span class="hljs-params">self, tags</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        经纬度转换</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            <br>            <span class="hljs-comment"># 纬度</span><br>            LatRef = tags[<span class="hljs-string">&quot;GPS GPSLatitudeRef&quot;</span>].printable<br>            Lat = tags[<span class="hljs-string">&quot;GPS GPSLatitude&quot;</span>].printable[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>].replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>).split(<span class="hljs-string">&quot;,&quot;</span>)<br>            Lat = <span class="hljs-built_in">float</span>(Lat[<span class="hljs-number">0</span>]) + <span class="hljs-built_in">float</span>(Lat[<span class="hljs-number">1</span>]) / <span class="hljs-number">60</span> + <span class="hljs-built_in">float</span>(Lat[<span class="hljs-number">2</span>]) / <span class="hljs-number">3600</span><br>            <span class="hljs-keyword">if</span> LatRef != <span class="hljs-string">&quot;N&quot;</span>:<br>                Lat = Lat * (-<span class="hljs-number">1</span>)<br>                <br>            <span class="hljs-comment"># 经度</span><br>            LonRef = tags[<span class="hljs-string">&quot;GPS GPSLongitudeRef&quot;</span>].printable<br>            Lon = tags[<span class="hljs-string">&quot;GPS GPSLongitude&quot;</span>].printable[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>].replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>).split(<span class="hljs-string">&quot;,&quot;</span>)<br>            Lon = <span class="hljs-built_in">float</span>(Lon[<span class="hljs-number">0</span>]) + <span class="hljs-built_in">float</span>(Lon[<span class="hljs-number">1</span>]) / <span class="hljs-number">60</span> + <span class="hljs-built_in">float</span>(Lon[<span class="hljs-number">2</span>]) / <span class="hljs-number">3600</span><br>            <span class="hljs-keyword">if</span> LonRef != <span class="hljs-string">&quot;E&quot;</span>:<br>                Lon = Lon * (-<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> Lat,Lon<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Unable to get&#x27;</span>)<br><br><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get_city_info</span>(<span class="hljs-params">self, tags</span>):</span><br>        <br>        result = self._get_lng_lat(tags)<br>        <span class="hljs-keyword">if</span> result:<br>            Lat, Lon = result<br>            url = <span class="hljs-string">&quot;https://api.map.baidu.com/reverse_geocoding/v3/?ak=&quot;</span>+self.baidu_map_ak+<span class="hljs-string">&quot;&amp;output=json&amp;coordtype=wgs84ll&amp;location=&quot;</span> + <span class="hljs-built_in">str</span>(Lat) + <span class="hljs-string">&#x27;,&#x27;</span> + <span class="hljs-built_in">str</span>(Lon)<br>            <span class="hljs-comment">#url = &quot;https://api.map.baidu.com/reverse_geocoding/v3/?ak=&quot;+self.baidu_map_ak+&quot;&amp;output=json&amp;coordtype=wgs84ll&amp;location=31.225696563611,121.49884033194&quot;</span><br>            response = requests.get(url).json()<br>            status = response[<span class="hljs-string">&#x27;status&#x27;</span>]<br>            <span class="hljs-keyword">if</span> status == <span class="hljs-number">0</span>:<br>                address = response[<span class="hljs-string">&#x27;result&#x27;</span>][<span class="hljs-string">&#x27;formatted_address&#x27;</span>]<br>                <span class="hljs-keyword">if</span> address != <span class="hljs-string">&quot;&quot;</span>:<br>                    <span class="hljs-keyword">return</span>(address)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;baidu_map error&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br></code></pre></td></tr></table></figure><blockquote><p>主要功能函数</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> config<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> os <br><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> shutil<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> getinfo <span class="hljs-keyword">import</span> PhotoExifInfo<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log_init</span>():</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    initialize logging </span><br><span class="hljs-string">    save the logging object in `config.Parameters.Logging_Object`</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    after this operation,</span><br><span class="hljs-string">    we could save logs with sample orders such as `logging.debug(&#x27;test debug&#x27;)` `logging.info(&#x27;test info&#x27;)` </span><br><span class="hljs-string">    logging level : debug &lt; info &lt; warning &lt;error &lt; critica</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    log_file_path = os.path.join(config.Parameters.Uploading_Temp_Image_Path, config.Parameters.Log_File_Name)<br>    <span class="hljs-keyword">if</span> os.path.exists(log_file_path):<br>        <span class="hljs-comment"># open log file as  mode of append</span><br>        open_type = <span class="hljs-string">&#x27;a&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># open log file as  mode of write</span><br>        open_type = <span class="hljs-string">&#x27;w&#x27;</span><br>        <br>    logging.basicConfig(<br>    <br>        <span class="hljs-comment"># 日志级别,logging.DEBUG,logging.ERROR</span><br>        level = logging.INFO,  <br><br>    <span class="hljs-comment"># 日志格式: 时间、代码所在文件名、代码行号、日志级别名字、日志信息</span><br>        <span class="hljs-comment">#format = &#x27;%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s&#x27;,</span><br>        <span class="hljs-built_in">format</span> = <span class="hljs-string">&#x27;%(asctime)s : %(message)s&#x27;</span>,<br>        <br>        <span class="hljs-comment"># 打印日志的时间</span><br>        datefmt = <span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,<br>    <br>        <span class="hljs-comment"># 日志文件存放的目录（目录必须存在）及日志文件名</span><br>        filename = log_file_path, <br>    <br>        <span class="hljs-comment"># 打开日志文件的方式</span><br>        filemode = open_type<br>    )    <br>    <br>    config.Parameters.Logging_Object = logging<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log</span>(<span class="hljs-params">message</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    print message to console and than save it to log </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(message)<br>    <span class="hljs-keyword">if</span> config.Parameters.Logging_Object:<br>        config.Parameters.Logging_Object.info(message)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&#x27;there is sth wrong with the object of logging in config &#x27;</span>)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dir_check</span>(<span class="hljs-params">dir_path</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    check if `dir_path` is a real directory path</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isdir(dir_path):<br>        <span class="hljs-keyword">try</span>:<br>            os.makedirs(dir_path) <br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;failed to make dir <span class="hljs-subst">&#123;dir_path&#125;</span>, error <span class="hljs-subst">&#123;err&#125;</span>&#x27;</span>)<br>        <span class="hljs-keyword">finally</span>:<br>            log(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;dir_path&#125;</span> does not exist and we have built it for you &#x27;</span>)<br>            <br>            <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">environment_check</span>():</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    check album environment, try to fix the matters if sth goes wrong</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br>    <span class="hljs-comment">## check important dirs</span><br>    <span class="hljs-keyword">assert</span> os.path.isdir(config.Parameters.Image_Root_Path) ,<span class="hljs-string">f&quot;image root dir <span class="hljs-subst">&#123;config.Parameters.Image_Root_Path&#125;</span> does not exist&quot;</span><br>    <span class="hljs-keyword">assert</span> os.path.isdir(config.Parameters.Hexo_Root_Path) ,<span class="hljs-string">f&quot;hexo root dir <span class="hljs-subst">&#123;config.Parameters.Hexo_Root_Path&#125;</span> does not exist&quot;</span><br>    <br>    dir_check(config.Parameters.Uploading_Temp_Image_Path)<br>    <br>    <span class="hljs-comment">## check image width, I think it shold not &lt; 200</span><br>    config.Parameters.Image_Resize_Width = <span class="hljs-built_in">max</span>(<span class="hljs-built_in">int</span>(config.Parameters.Image_Resize_Width), <span class="hljs-number">200</span>)<br>    <br>    <span class="hljs-comment">## initialize logging</span><br>    log_init()<br>    <br>    <span class="hljs-comment">## image_info_get object</span><br>    config.Parameters.Image_Info_Get_Object = PhotoExifInfo()<br>    <br>      <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">init_json_create</span>(<span class="hljs-params">json_path</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    init a json file to `json_path`</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> os.path.basename(json_path).split(<span class="hljs-string">&#x27;.&#x27;</span>)[-<span class="hljs-number">1</span>]==<span class="hljs-string">&#x27;json&#x27;</span>,<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;json_path&#125;</span> should be a path of json file &#x27;</span><br>    <span class="hljs-keyword">assert</span> os.path.isdir(os.path.split(json_path)[<span class="hljs-number">0</span>]), <span class="hljs-string">&#x27;the folder does not exist&#x27;</span><br>    <br>    now = time.localtime()<br>    info_dict=&#123;&#125;<br>    <br>    <span class="hljs-comment">## time</span><br>    my_time=&#123;<br>        <span class="hljs-string">&#x27;year&#x27;</span>:now.tm_year,\<br>        <span class="hljs-string">&#x27;month&#x27;</span>:now.tm_mon,\<br>        <span class="hljs-string">&#x27;day&#x27;</span>:now.tm_mday<br>          &#125;<br>    info_dict[<span class="hljs-string">&#x27;time&#x27;</span>] = my_time<br>    <br>    <span class="hljs-comment">## type</span><br>    info_dict[<span class="hljs-string">&#x27;type&#x27;</span>] = <span class="hljs-string">&#x27;album type&#x27;</span><br>    <br>    <span class="hljs-comment">## model</span><br>    info_dict[<span class="hljs-string">&#x27;model&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span><br>    <br>    <span class="hljs-comment">## position</span><br>    position = &#123;<br>        <span class="hljs-string">&#x27;city&#x27;</span>:<span class="hljs-string">&#x27;beijing&#x27;</span>,\<br>        <span class="hljs-string">&#x27;street&#x27;</span>:<span class="hljs-string">&#x27;Tiananmen&#x27;</span><br>    &#125;<br>    info_dict[<span class="hljs-string">&#x27;position&#x27;</span>] = position<br>    <br>    <span class="hljs-comment">## title</span><br>    info_dict[<span class="hljs-string">&#x27;title&#x27;</span>] = <span class="hljs-string">&#x27;Album title&#x27;</span><br>    <br>    <span class="hljs-comment">## balabala</span><br>    info_dict[<span class="hljs-string">&#x27;balabala&#x27;</span>] = <span class="hljs-string">&#x27;description of album&#x27;</span><br>    <br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(json_path, mode=<span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> fp:<br>        json.dump(info_dict, fp, indent=<span class="hljs-number">3</span>)<br>        log(<span class="hljs-string">f&#x27;make initial json file <span class="hljs-subst">&#123;json_path&#125;</span>&#x27;</span>)<br>            <br>            <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">image_compression_and_save</span>(<span class="hljs-params">src_dir, tar_dir</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    compress and move images from src to tar </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    sub_image_dirs = os.listdir(src_dir)<br>    <br>    <span class="hljs-keyword">for</span> sub_image_dir <span class="hljs-keyword">in</span> sub_image_dirs:<br>        src_sub_image_path = os.path.join(src_dir, sub_image_dir)<br>        tar_sub_image_path = os.path.join(tar_dir, sub_image_dir)<br>        <br>        <span class="hljs-comment">## check tar dir</span><br>        dir_check(tar_sub_image_path)<br>        <br>        file_list = os.listdir(src_sub_image_path)<br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> file_list:<br>            extension = item.split(<span class="hljs-string">&#x27;.&#x27;</span>)[-<span class="hljs-number">1</span>]<br>            <br>            <span class="hljs-keyword">if</span> extension.lower() <span class="hljs-keyword">in</span> config.Parameters.Image_Extension_List:<br>                <span class="hljs-comment">## is image file</span><br>                image_path = os.path.join(src_sub_image_path, item)<br>                <br>                tar_image_path = os.path.join(tar_sub_image_path, item)<br>                <br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(tar_image_path) <span class="hljs-keyword">or</span> config.Parameters.Whether_Overwrite_Old_Temp_File:<br>                    <span class="hljs-comment">## new file or overwrite</span><br>                    <br>                    image = cv2.imread(image_path)<br>                    image_shape = image.shape<br>                    <br>                    <span class="hljs-keyword">if</span> image_shape[<span class="hljs-number">1</span>] &gt;= config.Parameters.Image_Resize_Width:<br>                        <span class="hljs-comment">## need compression</span><br>                        new_width = <span class="hljs-built_in">int</span>(config.Parameters.Image_Resize_Width)<br>                        new_height = <span class="hljs-built_in">int</span>(config.Parameters.Image_Resize_Width/image_shape[<span class="hljs-number">1</span>]*image_shape[<span class="hljs-number">0</span>])<br>                        <br>                        new_image = cv2.resize(image,(new_width, new_height) )<br>                        cv2.imwrite(tar_image_path, new_image)<br>                        log(<span class="hljs-string">f&#x27;image <span class="hljs-subst">&#123;os.path.join(sub_image_dir,item)&#125;</span> has been resized to <span class="hljs-subst">&#123;(new_width, new_height)&#125;</span> and moved to temp dir&#x27;</span>)<br>                        <br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-comment">## small image, copy directly</span><br>                        shutil.copy(image_path, tar_image_path)<br>                        log(<span class="hljs-string">f&#x27;image <span class="hljs-subst">&#123;os.path.join(sub_image_dir,item)&#125;</span> has been moved to temp dir&#x27;</span>)<br>                           <br>        <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deal_with_sub_json</span>(<span class="hljs-params">src_dir, tar_dir</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    deal with sub json files in each sub dir</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    sub_image_dirs = os.listdir(src_dir)<br>    <br>    <span class="hljs-keyword">for</span> sub_image_dir <span class="hljs-keyword">in</span> sub_image_dirs:<br>        <br>        src_sub_image_path = os.path.join(src_dir, sub_image_dir)<br>        tar_sub_image_path = os.path.join(tar_dir, sub_image_dir)<br>        <br>        <span class="hljs-comment">## check tar dir</span><br>        dir_check(tar_sub_image_path)    <br>        <br>        src_info_json_file_path = os.path.join(src_sub_image_path, config.Parameters.Album_Ddescription_File_Name)<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(src_info_json_file_path):<br>            init_json_create(src_info_json_file_path)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;src_info_json_file_path&#125;</span> found&#x27;</span>)<br>            <br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(src_info_json_file_path) <span class="hljs-keyword">as</span> fp:<br>            album_info = json.load(fp)<br>        <br>        file_list = os.listdir(src_sub_image_path)<br>        <br>        image_info_list = []<br>        <br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> file_list:<br>            extension = item.split(<span class="hljs-string">&#x27;.&#x27;</span>)[-<span class="hljs-number">1</span>]<br>            <br>            <span class="hljs-keyword">if</span> extension.lower() <span class="hljs-keyword">in</span> config.Parameters.Image_Extension_List:<br>                <span class="hljs-comment">## is image file</span><br>                image_path = os.path.join(src_sub_image_path, item)<br>                <br>                <span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> config.Parameters.Image_Info_Get_Object <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;Image_Info_Get_Object should be a instance &quot;</span><br>                image_info_dict = config.Parameters.Image_Info_Get_Object.get_image_info(image_path)                <br>                <br>                image_info_dict[<span class="hljs-string">&#x27;url&#x27;</span>] = config.Parameters.Image_Url_Prefix+sub_image_dir+<span class="hljs-string">&#x27;/&#x27;</span>+item<br>                <br>                image_info_list.append(image_info_dict)<br>                <br>        album_info[<span class="hljs-string">&#x27;image_info&#x27;</span>] = image_info_list<br>        album_info[<span class="hljs-string">&#x27;directory&#x27;</span>] = sub_image_dir<br>        <br>        tar_info_json_file_path = os.path.join(tar_sub_image_path, config.Parameters.Album_Ddescription_File_Name)      <br>        <br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(tar_info_json_file_path,<span class="hljs-string">&#x27;w&#x27;</span>,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> fp:<br>            json.dump(album_info, fp, indent=<span class="hljs-number">3</span>, ensure_ascii=<span class="hljs-literal">False</span>)<br>            log(<span class="hljs-string">f&#x27;json file of image dir <span class="hljs-subst">&#123;sub_image_dir&#125;</span> created&#x27;</span>)<br>            <br>            <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">json_integrate</span>(<span class="hljs-params">temp_root</span>):</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    integrate json files to a single file</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    sub_image_dirs = os.listdir(temp_root)<br>    <br>    album_dict = &#123;&#125;<br>    <br>    album_json_list = []<br>    <br>    <span class="hljs-keyword">for</span> sub_image_dir <span class="hljs-keyword">in</span> sub_image_dirs:  <br>        <span class="hljs-keyword">if</span> os.path.isdir(os.path.join(temp_root,sub_image_dir)):<br>            json_file_path = os.path.join(temp_root,sub_image_dir, config.Parameters.Album_Ddescription_File_Name)   <br>            <span class="hljs-keyword">assert</span> os.path.exists(json_file_path),<span class="hljs-string">f&#x27;file <span class="hljs-subst">&#123;json_file_path&#125;</span> not flund&#x27;</span><br>            <br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(json_file_path) <span class="hljs-keyword">as</span> fp:<br>                json_dict = json.load(fp)<br>            <br>            album_json_list.append(json_dict)<br>            <br>    album_dict[<span class="hljs-string">&#x27;album&#x27;</span>] = album_json_list<br>    <br>    integrate_json_path = os.path.join(temp_root, config.Parameters.Album_Total_Json)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(integrate_json_path, mode=<span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> fp:<br>        json.dump(album_dict, fp, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">3</span>)<br>        log(<span class="hljs-string">f&#x27;total json <span class="hljs-subst">&#123;integrate_json_path&#125;</span> saved&#x27;</span>)<br>        <br>    <span class="hljs-keyword">return</span> album_dict<br>        <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_dir_json_md_of_album</span>(<span class="hljs-params">temp_root, hexo_photos_path, album_dict</span>):</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    save md files to hexo source/photos dir</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-keyword">assert</span> os.path.isdir(hexo_photos_path) ,<span class="hljs-string">&#x27;hexo photos path &#123;hexo_photos_path&#125; does not exist&#x27;</span><br>    <br>    src_album_json_path = os.path.join(temp_root, config.Parameters.Album_Total_Json)<br>    <span class="hljs-keyword">assert</span> os.path.exists(src_album_json_path), <span class="hljs-string">f&#x27;album json file <span class="hljs-subst">&#123;src_album_json_path&#125;</span> not found&#x27;</span><br>    tar_album_json_path = os.path.join(hexo_photos_path, config.Parameters.Album_Total_Json)<br>    <br>    shutil.copy(src_album_json_path, tar_album_json_path)<br>    log(<span class="hljs-string">f&quot;json file <span class="hljs-subst">&#123;config.Parameters.Album_Total_Json&#125;</span> moved to hexo dir&quot;</span>)<br>    <span class="hljs-keyword">for</span> sub_image_dict <span class="hljs-keyword">in</span> album_dict[<span class="hljs-string">&#x27;album&#x27;</span>]:<br>        src_json_path = os.path.join(temp_root, sub_image_dict[<span class="hljs-string">&#x27;directory&#x27;</span>], config.Parameters.Album_Ddescription_File_Name)<br>        <span class="hljs-keyword">assert</span> os.path.exists(src_json_path), <span class="hljs-string">f&#x27;sub json file <span class="hljs-subst">&#123;src_json_path&#125;</span> not found&#x27;</span><br>        <br>        tar_json_path = os.path.join(hexo_photos_path, sub_image_dict[<span class="hljs-string">&#x27;directory&#x27;</span>], config.Parameters.Album_Ddescription_File_Name)<br>        image_dir = os.path.join(hexo_photos_path, sub_image_dict[<span class="hljs-string">&#x27;directory&#x27;</span>])<br>        dir_check(image_dir)<br>        <br>        shutil.copyfile(src_json_path, tar_json_path)<br>        log(<span class="hljs-string">f&quot;json file <span class="hljs-subst">&#123;sub_image_dict[<span class="hljs-string">&#x27;directory&#x27;</span>] +<span class="hljs-string">&#x27;_&#x27;</span>+ config.Parameters.Album_Ddescription_File_Name&#125;</span> moved to hexo dir&quot;</span>)<br>        <br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(image_dir,config.Parameters.Album_Md_File_Name),<span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> fp:<br>            fp.writelines(<span class="hljs-string">&#x27;---&#x27;</span>+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            fp.writelines(<span class="hljs-string">&#x27;title: &#x27;</span>+sub_image_dict[<span class="hljs-string">&#x27;title&#x27;</span>]+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            fp.writelines(<span class="hljs-string">&#x27;date: &#x27;</span>+<span class="hljs-built_in">str</span>(sub_image_dict[<span class="hljs-string">&#x27;time&#x27;</span>][<span class="hljs-string">&#x27;year&#x27;</span>])+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(sub_image_dict[<span class="hljs-string">&#x27;time&#x27;</span>][<span class="hljs-string">&#x27;month&#x27;</span>])+<span class="hljs-string">&#x27;-&#x27;</span>+<span class="hljs-built_in">str</span>(sub_image_dict[<span class="hljs-string">&#x27;time&#x27;</span>][<span class="hljs-string">&#x27;day&#x27;</span>])+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            fp.writelines(<span class="hljs-string">&#x27;type: photography&#x27;</span>+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            fp.writelines(<span class="hljs-string">&#x27;album: &#x27;</span>+sub_image_dict[<span class="hljs-string">&#x27;directory&#x27;</span>]+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            fp.writelines(<span class="hljs-string">&#x27;---&#x27;</span>+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>            log(<span class="hljs-string">f&#x27;create md file of <span class="hljs-subst">&#123;os.path.join(image_dir,config.Parameters.Album_Md_File_Name)&#125;</span>&#x27;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>主函数</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> config<br><br><span class="hljs-keyword">from</span> funs <span class="hljs-keyword">import</span> environment_check<br><span class="hljs-keyword">from</span> funs <span class="hljs-keyword">import</span> deal_with_sub_json<br><span class="hljs-keyword">from</span> funs <span class="hljs-keyword">import</span> json_integrate<br><span class="hljs-keyword">from</span> funs <span class="hljs-keyword">import</span> image_compression_and_save<br><span class="hljs-keyword">from</span> funs <span class="hljs-keyword">import</span> make_dir_json_md_of_album<br><br><br><br><span class="hljs-keyword">if</span> __name__ ==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <br>    src_image_root = config.Parameters.Image_Root_Path<br>    temp_image_root = config.Parameters.Uploading_Temp_Image_Path<br>    hexo_photos_path = os.path.join(config.Parameters.Hexo_Root_Path,config.Parameters.Hexo_Sub_Dir_to_Photos)<br>    <br>    <span class="hljs-comment">## check config environment</span><br>    environment_check()<br>    <br>    <span class="hljs-comment">## compress and save images</span><br>    image_compression_and_save(src_image_root, temp_image_root)<br>    <br>    <span class="hljs-comment">## get info of images and save json of each dir</span><br>    deal_with_sub_json(src_image_root, temp_image_root)<br>    <br>    <span class="hljs-comment">## integrate jsons</span><br>    album_dict = json_integrate(temp_image_root)<br>    <br>    <span class="hljs-comment">## make folders and markdowns in dir of photos</span><br>    make_dir_json_md_of_album(temp_image_root, hexo_photos_path, album_dict)<br>    <br>    <span class="hljs-comment">## upload images with qshell</span><br>    <span class="hljs-keyword">if</span> config.Parameters.Force_Upload:<br>        os.system(<span class="hljs-string">&quot;rm -rf ~/.qshell/qupload&quot;</span>)<br>        <br>    cmd = <span class="hljs-string">&quot;qshell qupload &quot;</span>+os.path.join(config.Parameters.Uploading_Temp_Image_Path,config.Parameters.Qshell_Config_File_Name)<br>    os.system(cmd)<br></code></pre></td></tr></table></figure><blockquote><p>主要函数做了注释，希望可以给大家启发，如果想使用我这套代码可以到 <a href="https://github.com/zywvvd/hexo_album_process">hexo_album_process</a> 下载</p></blockquote><h2 id="运行图示"><a href="#运行图示" class="headerlink" title="运行图示"></a>运行图示</h2><ul><li>初始相册文件夹pic</li></ul><p><img src="https://photos.zywvvd.com/image/20200428001615.png"></p><ul><li>相册内部</li></ul><p><img src="https://photos.zywvvd.com/image/20200428001650.png"></p><ul><li>每个文件夹需要有readme.json记录文件夹信息，程序会自动提取，示例如下：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br><span class="hljs-attr">&quot;time&quot;</span>:<br>&#123;<br><span class="hljs-attr">&quot;year&quot;</span>:<span class="hljs-number">2015</span>,<br><span class="hljs-attr">&quot;month&quot;</span>:<span class="hljs-number">11</span>,<br><span class="hljs-attr">&quot;day&quot;</span>:<span class="hljs-number">28</span><br>&#125;,<br><span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;风光&quot;</span>,<br><span class="hljs-attr">&quot;model&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<br><span class="hljs-attr">&quot;position&quot;</span>:<br>&#123;<br><span class="hljs-attr">&quot;city&quot;</span>:<span class="hljs-string">&quot;合肥&quot;</span>,<br><span class="hljs-attr">&quot;street&quot;</span>:<span class="hljs-string">&quot;ustc&quot;</span><br>&#125;,<br><span class="hljs-attr">&quot;title&quot;</span>:<span class="hljs-string">&quot;USTC&quot;</span>,<br><span class="hljs-attr">&quot;balabala&quot;</span>:<br><span class="hljs-string">&quot;关于母校。&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>配置config.py </li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">Image_Root_Path = <span class="hljs-string">r&#x27;/media/vvd/新加卷/pic&#x27;</span>                                   <span class="hljs-comment"># root of source raw images</span><br>Hexo_Root_Path =<span class="hljs-string">r&#x27;/home/vvd/VVD_Work/Hexo/VVD_Hexo&#x27;</span>                          <span class="hljs-comment"># root of Hexo dir  </span><br>Hexo_Sub_Dir_to_Photos = <span class="hljs-string">r&#x27;source/photos&#x27;</span>                                     <span class="hljs-comment"># my source dir for album</span><br>Uploading_Temp_Image_Path = <span class="hljs-string">r&#x27;/home/vvd/VVD_Work/Hexo/Album_Temp&#x27;</span>           <span class="hljs-comment"># root of temp image dir</span><br>Image_Url_Prefix =<span class="hljs-string">r&#x27;https://photos.zywvvd.com/vvd_hexo/&#x27;</span>                      <span class="hljs-comment"># prefix of image url</span><br></code></pre></td></tr></table></figure><ul><li>运行main.py</li></ul><p><img src="https://photos.zywvvd.com/image/20200428002036.png"></p><ul><li>临时文件夹产生压缩后的图像文件夹与json文件</li></ul><p><img src="https://photos.zywvvd.com/image/20200428002127.png"></p><ul><li>程序会在hexo-&gt;source-&gt; photos文件夹内写入相册文件夹层级结构与对应json文件</li></ul><p><img src="20200428235033.png"></p><ul><li>文件夹内的json加入了图像的信息</li></ul><p><img src="https://photos.zywvvd.com/image/20200428002202.png"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>   <span class="hljs-attr">&quot;time&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;year&quot;</span>: <span class="hljs-number">2015</span>,<br>      <span class="hljs-attr">&quot;month&quot;</span>: <span class="hljs-number">11</span>,<br>      <span class="hljs-attr">&quot;day&quot;</span>: <span class="hljs-number">28</span><br>   &#125;,<br>   <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;风光&quot;</span>,<br>   <span class="hljs-attr">&quot;model&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>   <span class="hljs-attr">&quot;position&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;city&quot;</span>: <span class="hljs-string">&quot;合肥&quot;</span>,<br>      <span class="hljs-attr">&quot;street&quot;</span>: <span class="hljs-string">&quot;ustc&quot;</span><br>   &#125;,<br>   <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;USTC&quot;</span>,<br>   <span class="hljs-attr">&quot;balabala&quot;</span>: <span class="hljs-string">&quot;关于母校。&quot;</span>,<br>   <span class="hljs-attr">&quot;image_info&quot;</span>: [<br>      &#123;<br>         <span class="hljs-attr">&quot;Image_Model&quot;</span>: <span class="hljs-string">&quot;NIKON D610&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_FNumber&quot;</span>: <span class="hljs-string">&quot;f11&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_FocalLength&quot;</span>: <span class="hljs-string">&quot;35mm&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_ExposureMode&quot;</span>: <span class="hljs-string">&quot;Auto Exposure&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_ExposureTime&quot;</span>: <span class="hljs-string">&quot;6s&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_ISOSpeedRatings&quot;</span>: <span class="hljs-string">&quot;100&quot;</span>,<br>         <span class="hljs-attr">&quot;Image_DateTime&quot;</span>: <span class="hljs-string">&quot;2015:11:28 00:07:05&quot;</span>,<br>         <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://photos.zywvvd.com/vvd_hexo/2015_11_28_hefei_ustc_fengjing/1.jpg&quot;</span><br>      &#125;,<br>      &#123;<br>         <span class="hljs-attr">&quot;Image_Model&quot;</span>: <span class="hljs-string">&quot;NIKON D610&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_FNumber&quot;</span>: <span class="hljs-string">&quot;f4&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_FocalLength&quot;</span>: <span class="hljs-string">&quot;34mm&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_ExposureMode&quot;</span>: <span class="hljs-string">&quot;Manual Exposure&quot;</span>,<br>         <span class="hljs-attr">&quot;EXIF_ExposureTime&quot;</span>: <span class="hljs-string">&quot;25s&quot;</span>,<br>         <span class="hljs-attr">&quot;Image_DateTime&quot;</span>: <span class="hljs-string">&quot;2015:11:28 22:13:29&quot;</span>,<br>         <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://photos.zywvvd.com/vvd_hexo/2015_11_28_hefei_ustc_fengjing/2.jpg&quot;</span><br>      &#125;<br>   ],<br>   <span class="hljs-attr">&quot;directory&quot;</span>: <span class="hljs-string">&quot;2015_11_28_hefei_ustc_fengjing&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>图像会自动上传到七牛云</li></ul><p><img src="https://photos.zywvvd.com/image/20200428002346.png"></p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><blockquote><p>文中没有太先进的技术，主要提供了为静态页面自动维护相册问题的解决思路，并分享了json生成与图像上传的工程，有更好的实现方法欢迎交流。</p></blockquote><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>本文启发自 <a href="https://asdfv1929.github.io/2018/05/26/next-add-photos/">https://asdfv1929.github.io/2018/05/26/next-add-photos/</a> 感谢前辈分享</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kite Python代码补全工具安装</title>
    <link href="/2020/04/11/python/kite_install/kite_install/"/>
    <url>/2020/04/11/python/kite_install/kite_install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Kite是一款将AI机器学习应用到代码补全的工具，本文介绍其在Windows与Linux系统的安装方法。</p></blockquote><span id="more"></span><p>官网：<a href="https://www.kite.com/">https://www.kite.com/</a></p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul><li><a href="https://www.kite.com/download/">https://www.kite.com/download/</a></li></ul><blockquote><p>直接安装下载的 KiteSetup.exe 即可。</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201029095905.png"></p><h4 id="在-VS-code-中使用-kite"><a href="#在-VS-code-中使用-kite" class="headerlink" title="在 VS code 中使用 kite"></a>在 VS code 中使用 kite</h4><blockquote><p>安装插件 Kite AI Code AutoComplete</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201029100241.png"></p><blockquote><p>随后可以跟着自动弹出的教程学习使用方法。</p></blockquote><blockquote><p>事实上写代码时仅需关注右下角是否开启了Kite即可：</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201029100608.png"></p><blockquote><p>此时写Python代码会有kite 的自动补全：</p></blockquote><p><img src="https://photos.zywvvd.com/images_matrixtime/20201029101019.png"></p><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><ul><li><a href="https://www.kite.com/download/?loc=top_nav#">https://www.kite.com/download/?loc=top_nav#</a></li></ul><p>运行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c <span class="hljs-string">&quot;<span class="hljs-subst">$(wget -q -O - https://linux.kite.com/dls/linux/current)</span>&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>网上有教程说不能使用root用户安装，我在docker中的情况时只能使用root用户安装。</p><p>随后VS code 远程调试代码时即可使用kite自动补全。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 使用logging模块管理日志文件</title>
    <link href="/2020/04/11/python/logging/python-logging/"/>
    <url>/2020/04/11/python/logging/python-logging/</url>
    
    <content type="html"><![CDATA[<blockquote><p>logging是很友好的python日志管理包，轻便好用，本文介绍logging使用方法。</p></blockquote><span id="more"></span><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><blockquote><p>在程序中引入包：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br></code></pre></td></tr></table></figure><blockquote><p>配置日志设置</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">logging.basicConfig(<br><br>    <span class="hljs-comment"># 日志级别,logging.DEBUG,logging.ERROR</span><br>    level = logging.INFO,  <br><br>    <span class="hljs-comment"># 日志格式: 时间、代码所在文件名、代码行号、日志级别名字、日志信息</span><br>    <span class="hljs-built_in">format</span> = <span class="hljs-string">&#x27;%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s&#x27;</span>,<br><br>    <span class="hljs-comment"># 打印日志的时间</span><br>    datefmt = <span class="hljs-string">&#x27;%a, %Y-%m-%d %H:%M:%S&#x27;</span>,<br><br>    <span class="hljs-comment"># 日志文件存放的目录（目录必须存在）及日志文件名</span><br>    filename = log_file_path, <br><br>    <span class="hljs-comment"># 打开日志文件的方式</span><br>    filemode = open_type<br>) <br></code></pre></td></tr></table></figure><blockquote><p>配置说明</p></blockquote><ul><li><p><code>level</code></p><p>表示日志记录级别</p><p>所谓级别包括：调试级(debug) ，信息级(info)，警告级(warning)，错误级(error)，严重级(critical)</p><p>其中的优先级关系为：debug &lt; info &lt; warning &lt;error &lt; critical</p><p>日志本身设置有级别（如本例为INFO)，只会记录不小于自身级别的的信息（如本例设置就不会记录DEBUG级别信息）</p></li><li><p><code>format</code></p><p> 格式配置，核心信息为我们需要记录的<code>%(message)s</code>，此外还可以记录时间、文件名、行号、日志级别等信息</p></li><li><p><code>datefmt</code></p><p>时间格式设置<code> &#39;%a, %Y-%m-%d %H:%M:%S&#39;</code>分别表示 -星期 -年 -月 -日 -时 -分 -秒</p></li><li><p><code>filename</code></p><p>日志文件路径</p></li><li><p><code>filemode</code></p><p>日志文件打开模式，一般为<code>w</code>（写入）或<code>a</code>（追加）</p></li></ul><blockquote><p>日志记录示例</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">logging.debug(<span class="hljs-string">&#x27;debug&#x27;</span>)  <span class="hljs-comment"># this message won&#x27;t be wrote to the log file, for the priority of DEBUG is lower than INFO</span><br>    logging.info(<span class="hljs-string">&#x27;info&#x27;</span>)<br>    logging.warning(<span class="hljs-string">&#x27;warning&#x27;</span>)<br>    logging.error(<span class="hljs-string">&#x27;error&#x27;</span>)<br>    logging.critical(<span class="hljs-string">&#x27;critical&#x27;</span>)<br></code></pre></td></tr></table></figure><blockquote><p>日志文件信息</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs log">Sat, 2020-04-11 15:08:38 logging_test.py[line:51] INFO info<br>Sat, 2020-04-11 15:08:38 logging_test.py[line:52] WARNING warning<br>Sat, 2020-04-11 15:08:38 logging_test.py[line:53] ERROR error<br>Sat, 2020-04-11 15:08:38 logging_test.py[line:54] CRITICAL critical<br></code></pre></td></tr></table></figure><h2 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h2><blockquote><p>文中测试环境与所有源码可在<a href="https://github.com/zywvvd/Python_Practise">Github</a>下载。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在谷歌浏览器调试JavaScript</title>
    <link href="/2020/04/03/coding/java_script/js-debug/"/>
    <url>/2020/04/03/coding/java_script/js-debug/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍在谷歌浏览器调试JavaScript的方法。</p></blockquote><span id="more"></span><h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><blockquote><p>新建test.html文件，写入：</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Insert title here<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript"></span><br><span class="javascript">        alert(<span class="hljs-string">&quot;Hello World!&quot;</span>);</span><br><span class="javascript"><span class="hljs-built_in">document</span>.write(<span class="hljs-string">&quot;Hello World&quot;</span>)</span><br><span class="javascript">        <span class="hljs-keyword">var</span> vAlert=&#123;&#125;;</span><br><span class="javascript">        vAlert.show=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>)</span>&#123;</span><br><span class="javascript">            alert(msg);</span><br><span class="javascript">        &#125;</span><br><span class="javascript"><span class="hljs-keyword">var</span> test_var = <span class="hljs-string">&#x27;test world&#x27;</span></span><br><span class="javascript">        vAlert.show(<span class="hljs-string">&quot;测试&quot;</span>);</span><br><span class="javascript"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Hello World&#x27;</span>)</span><br><span class="javascript"><span class="hljs-built_in">console</span>.log(test_var)</span><br><span class="javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="调试运行"><a href="#调试运行" class="headerlink" title="调试运行"></a>调试运行</h2><ul><li><p>打开谷歌浏览器</p></li><li><p>运行test.html</p></li><li><p>F12 ，呼出开发者模式</p></li><li><p>进入Sources选项卡</p></li></ul><p><img src="https://photos.zywvvd.com/image/20200403001407.png" alt="谷歌浏览器开发者模式"></p><ul><li>在js 代码加入断点，F5刷新，单步运行</li></ul><p><img src="https://photos.zywvvd.com/image/20200403001539.png" alt="断点调试"></p><ul><li>期间网页会显示代码执行效果，并且在控制台有相应输出，自己也可以在控制台调试当前环境代码</li></ul><p><img src="https://photos.zywvvd.com/image/20200403001726.png" alt="控制台调试"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>编程知识</category>
      
      <category>JavaScript</category>
      
    </categories>
    
    
    <tags>
      
      <tag>编程知识</tag>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 获取图像Exif详细信息</title>
    <link href="/2020/04/01/python/get_image_exif/get-image-exif/"/>
    <url>/2020/04/01/python/get_image_exif/get-image-exif/</url>
    
    <content type="html"><![CDATA[<blockquote><p>相机拍摄照片会在文件中记录拍摄的重要参数，包括机身信息、光圈、焦距、感光度、时间、拍摄地点等等。本文介绍获取此类信息的方法。</p></blockquote><span id="more"></span><h2 id="安装python包"><a href="#安装python包" class="headerlink" title="安装python包"></a>安装python包</h2><blockquote><p>安装exifread：</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install exifread<br></code></pre></td></tr></table></figure><h2 id="上代码"><a href="#上代码" class="headerlink" title="上代码"></a>上代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> exifread<br><span class="hljs-keyword">import</span> requests<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhotoExifInfo</span>():</span><br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,photo_path</span>):</span><br>        self.photo_path = photo_path<br>        self.baidu_map_ak = <span class="hljs-string">&quot;your baidu map api key&quot;</span><br>        self.image_info_dict=&#123;&#125;<br>        self.tags =&#123;&#125;<br>        self.interested_keys = [<br>            <span class="hljs-string">&#x27;EXIF ExposureMode&#x27;</span>,\<br>            <span class="hljs-string">&#x27;EXIF ExposureTime&#x27;</span>,\<br>            <span class="hljs-string">&#x27;EXIF Flash&#x27;</span>,\<br>            <span class="hljs-string">&#x27;EXIF ISOSpeedRatings&#x27;</span>,\<br>            <span class="hljs-string">&#x27;Image Model&#x27;</span>,\<br>            <span class="hljs-string">&#x27;EXIF ExifImageWidth&#x27;</span>,\<br>            <span class="hljs-string">&#x27;EXIF ExifImageLength&#x27;</span>,\<br>            <span class="hljs-string">&#x27;Image DateTime&#x27;</span>,\<br>            <span class="hljs-string">&#x27;EXIF DateTimeOriginal&#x27;</span>,\<br>            <span class="hljs-string">&#x27;Image Make&#x27;</span>,\<br><br>            <span class="hljs-comment"># lens</span><br>            <span class="hljs-comment"># jiaoju</span><br>        ]<br>        <br>        <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_tags</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        获取照片信息</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        image_content = <span class="hljs-built_in">open</span>(self.photo_path, <span class="hljs-string">&#x27;rb&#x27;</span>)<br>        tags = exifread.process_file(image_content)<br>        self.tags = tags<br>        <br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> self.interested_keys:<br>            <span class="hljs-keyword">try</span>:<br>                info = tags[item]<br>                self.image_info_dict[item] = info<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;self.photo_path&#125;</span> has no attribute of <span class="hljs-subst">&#123;item&#125;</span>&#x27;</span>)                <br>                <span class="hljs-keyword">continue</span><br>            <br>        <span class="hljs-comment"># 遍历获取照片所有信息</span><br>        <span class="hljs-comment">#for j, k in tags.items():</span><br>            <span class="hljs-comment">#print(f&quot;&#123;j&#125; : &#123;k&#125;&quot;)</span><br>            <span class="hljs-comment">#print(&#x27;拍摄时间：&#x27;, tags[&#x27;EXIF DateTimeOriginal&#x27;])</span><br>            <span class="hljs-comment">#print(&#x27;照相机制造商：&#x27;, tags[&#x27;Image Make&#x27;])</span><br>            <span class="hljs-comment">#print(&#x27;照相机型号：&#x27;, tags[&#x27;Image Model&#x27;])</span><br>            <span class="hljs-comment">#print(&#x27;照片尺寸：&#x27;, tags[&#x27;EXIF ExifImageWidth&#x27;], tags[&#x27;EXIF ExifImageLength&#x27;])</span><br>            <br>     <br>        image_content.close()<br>       <br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_lng_lat</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;经纬度转换&quot;&quot;&quot;</span><br>        tags = self.tags<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-comment"># 纬度</span><br>            LatRef = tags[<span class="hljs-string">&quot;GPS GPSLatitudeRef&quot;</span>].printable<br>            Lat = tags[<span class="hljs-string">&quot;GPS GPSLatitude&quot;</span>].printable[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>].replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>).split(<span class="hljs-string">&quot;,&quot;</span>)<br>            Lat = <span class="hljs-built_in">float</span>(Lat[<span class="hljs-number">0</span>]) + <span class="hljs-built_in">float</span>(Lat[<span class="hljs-number">1</span>]) / <span class="hljs-number">60</span> + <span class="hljs-built_in">float</span>(Lat[<span class="hljs-number">2</span>]) / <span class="hljs-number">3600</span><br>            <span class="hljs-keyword">if</span> LatRef != <span class="hljs-string">&quot;N&quot;</span>:<br>                Lat = Lat * (-<span class="hljs-number">1</span>)<br>            <span class="hljs-comment"># 经度</span><br>            LonRef = tags[<span class="hljs-string">&quot;GPS GPSLongitudeRef&quot;</span>].printable<br>            Lon = tags[<span class="hljs-string">&quot;GPS GPSLongitude&quot;</span>].printable[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>].replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;&quot;</span>).replace(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;,&quot;</span>).split(<span class="hljs-string">&quot;,&quot;</span>)<br>            Lon = <span class="hljs-built_in">float</span>(Lon[<span class="hljs-number">0</span>]) + <span class="hljs-built_in">float</span>(Lon[<span class="hljs-number">1</span>]) / <span class="hljs-number">60</span> + <span class="hljs-built_in">float</span>(Lon[<span class="hljs-number">2</span>]) / <span class="hljs-number">3600</span><br>            <span class="hljs-keyword">if</span> LonRef != <span class="hljs-string">&quot;E&quot;</span>:<br>                Lon = Lon * (-<span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span> Lat,Lon<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Unable to get&#x27;</span>)<br><br><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_city_info</span>(<span class="hljs-params">self</span>):</span><br>        result = self.get_lng_lat()<br>        <span class="hljs-keyword">if</span> result:<br>            Lat, Lon = result<br>            url = <span class="hljs-string">&quot;https://api.map.baidu.com/reverse_geocoding/v3/?ak=&quot;</span>+self.baidu_map_ak+<span class="hljs-string">&quot;&amp;output=json&amp;coordtype=wgs84ll&amp;location=&quot;</span> + <span class="hljs-built_in">str</span>(Lat) + <span class="hljs-string">&#x27;,&#x27;</span> + <span class="hljs-built_in">str</span>(Lon)<br>            <span class="hljs-comment">#url = &quot;https://api.map.baidu.com/reverse_geocoding/v3/?ak=&quot;+self.baidu_map_ak+&quot;&amp;output=json&amp;coordtype=wgs84ll&amp;location=31.225696563611,121.49884033194&quot;</span><br>            response = requests.get(url).json()<br>            status = response[<span class="hljs-string">&#x27;status&#x27;</span>]<br>            <span class="hljs-keyword">if</span> status == <span class="hljs-number">0</span>:<br>                address = response[<span class="hljs-string">&#x27;result&#x27;</span>][<span class="hljs-string">&#x27;formatted_address&#x27;</span>]<br>                <span class="hljs-keyword">if</span> address != <span class="hljs-string">&quot;&quot;</span>:<br>                    self.image_info_dict[<span class="hljs-string">&#x27;Position&#x27;</span>] = address<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;baidu_map error&#x27;</span>)<br>    <br>    <br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_image_info</span>(<span class="hljs-params">self</span>):</span><br>        self.get_tags()<br>        self.get_city_info()<br>        <span class="hljs-keyword">return</span> self.image_info_dict<br>    <br>    <br>    <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    result = PhotoExifInfo(<span class="hljs-string">&quot;test.jpeg&quot;</span>).get_image_info()<br>    <br>    <span class="hljs-keyword">for</span> j, k <span class="hljs-keyword">in</span> result.items():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;j&#125;</span> : <span class="hljs-subst">&#123;k&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure><blockquote><p>示例输出</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">EXIF ExposureMode : Auto Exposure<br>EXIF ExposureTime : 10/24723<br>EXIF Flash : Flash did not fire, auto mode<br>EXIF ISOSpeedRatings : 50<br>Image Model : vivo Z1<br>EXIF ExifImageWidth : 4144<br>EXIF ExifImageLength : 1968<br>Image DateTime : 2019:11:03 11:34:24<br>EXIF DateTimeOriginal : 2019:11:03 11:34:24<br>Image Make : vivo<br>Position : 上海市黄浦区中山南路187<br></code></pre></td></tr></table></figure><blockquote><p>代码中的<code>self.baidu_map_ak</code>需要去百度地图申请，具体方法移步: <a href="https://www.zywvvd.com/2020/04/01/coding/utils/baidumap-ak/">申请百度地图API Key进行百度地图开发，获取经纬度对应地点</a></p></blockquote><h2 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h2><blockquote><p>文中测试环境与所有源码可在<a href="https://github.com/zywvvd/Python_Practise">Github</a>下载。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>申请百度地图API Key进行百度地图开发，获取经纬度对应地点</title>
    <link href="/2020/04/01/coding/utils/baidumap-ak/"/>
    <url>/2020/04/01/coding/utils/baidumap-ak/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 在程序中获取到了经纬度信息，使用百度地图的开发工具可以将其转换为地点名称。本文介绍申请百度AK（API Key），并用于提取地理信息位置名称的方法。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>申请百度账号</li></ul><h2 id="申请百度AK"><a href="#申请百度AK" class="headerlink" title="申请百度AK"></a>申请百度AK</h2><ul><li>到 <a href="%5Bhttps://lbsyun.baidu.com/index.php?title=%E9%A6%96%E9%A1%B5%5D(https://lbsyun.baidu.com/index.php?title=%E9%A6%96%E9%A1%B5)">百度地图平台</a> ，进入控制台</li></ul><p><img src="https://photos.zywvvd.com/image/20200401221918.png" alt="百度地图平台"></p><ul><li>注册开发者</li></ul><p><img src="https://photos.zywvvd.com/image/20200401222749.png" alt="注册"></p><ul><li><p>申请密钥</p><p><img src="https://photos.zywvvd.com/image/20200401223600.png" alt="申请密钥"><img src="https://photos.zywvvd.com/image/20200401223600.png"></p></li><li><p>创建应用</p><p><img src="https://photos.zywvvd.com/image/20200401224843.png"></p></li><li><p>获得API Key</p></li></ul><p><img src="https://photos.zywvvd.com/image/20200401225152.png" alt="AK"></p><h2 id="全球逆地理编码"><a href="#全球逆地理编码" class="headerlink" title="全球逆地理编码"></a>全球逆地理编码</h2><blockquote><p>百度地图提供将经纬度转为地理位置的服务—— 全球逆地理编码:</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200401231121.png" alt="逆地理编码"></p><ul><li>使用语法：</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://api.map.baidu.com/reverse_geocoding/v<span class="hljs-number">3</span>/?ak=您的ak&amp;output=json&amp;coordtype=wgs<span class="hljs-number">84</span>ll&amp;location=<span class="hljs-number">31</span>.<span class="hljs-number">225696563611</span>,<span class="hljs-number">121</span>.<span class="hljs-number">49884033194</span>  //GET请求<br></code></pre></td></tr></table></figure><ul><li>使用示例，在Python中：</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>baidu_map_ak = <span class="hljs-comment">#你的百度ak</span><br>url = <span class="hljs-string">&quot;https://api.map.baidu.com/reverse_geocoding/v3/?ak=&quot;</span>+baidu_map_ak+<span class="hljs-string">&quot;&amp;output=json&amp;coordtype=wgs84ll&amp;location=31.225696563611,121.49884033194&quot;</span><br>response = requests.get(url).json()<br>status = response[<span class="hljs-string">&#x27;status&#x27;</span>]<br>            <span class="hljs-keyword">if</span> status == <span class="hljs-number">0</span>:<br>                address = response[<span class="hljs-string">&#x27;result&#x27;</span>][<span class="hljs-string">&#x27;formatted_address&#x27;</span>]<br>            <span class="hljs-built_in">print</span>( <span class="hljs-string">f&quot;拍摄地点：<span class="hljs-subst">&#123;address&#125;</span>&quot;</span> )<br><br><span class="hljs-comment"># -&gt; 拍摄地点：上海市黄浦区中山南路187</span><br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>程序人生</category>
      
      <category>实用工具</category>
      
    </categories>
    
    
    <tags>
      
      <tag>程序人生</tag>
      
      <tag>实用工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -22- 添加相册系列 -2- 使用七牛云qshell同步图像目录</title>
    <link href="/2020/03/31/hexo-theme/next/22_qiniuyun_qshell/qiniuyun-qshell/"/>
    <url>/2020/03/31/hexo-theme/next/22_qiniuyun_qshell/qiniuyun-qshell/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍使用 qshell 同步本地文件目录到存储空间并体现出层级结构的方法。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>需要图床管理图片文件夹的需求</li><li>申请七牛云账号</li><li>开启七牛云图床，<a href="https://www.zywvvd.com/2020/03/25/hexo/9_add_image_bed/add-image-bed/">Hexo -9- 添加七牛云图床</a></li></ul><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><blockquote><p>要上传的资源目录：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> tree</span><br>.<br>├── 1<br>│   ├── a.jpg<br>│   ├── b.jpg<br>│   └── c.jpg<br>├── 2<br>│   ├── d.jpg<br>│   ├── e.jpg<br>│   └── f.jpg<br>├── g.jpg<br>├── h.jpg<br>├── i.jpg<br>└── j.jpg<br><br></code></pre></td></tr></table></figure><h2 id="工具下载"><a href="#工具下载" class="headerlink" title="工具下载"></a>工具下载</h2><blockquote><p>命令行工具 qshell <a href="https://developer.qiniu.com/kodo/tools/1302/qshell">传送门</a></p><ul><li>各种操作系统需要下载的版本文档说得很清楚，我的ubuntu18.04 x64下载了qshell-linux-x64-v2.4.1.zip</li><li>解压得到 qshell-linux-x64-v2.4.1</li><li>重命名为 qshell，并赋予可执行权限</li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mv qshell-linux-x64 qshell<br>chmod +x qshell<br></code></pre></td></tr></table></figure><h2 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h2><blockquote><p>将qshell文件所在位置加入到 ~/.bashrc</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">export PATH=&quot;/path of qshell:$PATH&quot;<br></code></pre></td></tr></table></figure><blockquote><p>加载.bashrc使路径立即生效</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source ~/.bashrc <br></code></pre></td></tr></table></figure><blockquote><p>测试，输入qshell -v 出现版本信息表明配置成功</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">qshell -v<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">qshell version v2.4.1</span><br></code></pre></td></tr></table></figure><h2 id="配置账户"><a href="#配置账户" class="headerlink" title="配置账户"></a>配置账户</h2><blockquote><p>需要鉴权的命令都需要依赖七牛账号下的 AccessKey 和 SecretKey ，位于个人中心 -&gt; 秘钥管理</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200331231941.png" alt="秘钥管理"></p><blockquote><p>配置账户:</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">qshell account [&lt;AccessKey&gt; &lt;SecretKey&gt; &lt;Name&gt;]<br></code></pre></td></tr></table></figure><blockquote><p>之后再次输入 qshell account 命令验证设置是否成功</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">qshell account<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">Name: zywvvd</span><br><span class="hljs-meta">#</span><span class="bash">AccessKey: Bd0UYk1e9pFWK×××××××××××××××</span><br><span class="hljs-meta">#</span><span class="bash">SecretKey: ZFsdguzYE3QUl×××××××××××××××</span><br></code></pre></td></tr></table></figure><blockquote><p>此处操作后在当前用户主目录中生成 qshell 目录：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ls ~/.qshell/</span><br><span class="hljs-meta">#</span><span class="bash"> account.json</span><br></code></pre></td></tr></table></figure><h2 id="编写同步目录文件"><a href="#编写同步目录文件" class="headerlink" title="编写同步目录文件"></a>编写同步目录文件</h2><blockquote><p>在上文提到的~/.qshell 目录中创建配置文件，文件内容如下：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> cat upload.conf</span> <br>&#123;<br>    &quot;src_dir&quot; : &quot;/home/vvd/VVD_Work/test&quot;,<br>    &quot;bucket&quot; : &quot;vvd-space&quot;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><ul><li><p>src_dir 为刚刚我存放照片的路径</p></li><li><p>bucket 为你的七牛云空间名称</p></li></ul></blockquote><h2 id="同步文件"><a href="#同步文件" class="headerlink" title="同步文件"></a>同步文件</h2><blockquote><p>在~/.qshell文件夹下执行命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">qshell qupload upload.conf<br></code></pre></td></tr></table></figure><blockquote><p>返回上传日志：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">Writing upload log to file /home/vvd/.qshell/qupload/040adc5d316ff8cfc274b2e099628234/040adc5d316ff8cfc274b2e099628234.log<br><br>Uploading /home/vvd/VVD_Work/test/1/a.jpg =&gt; 1/a.jpg [1/10, 10.0%] ...<br>Uploading /home/vvd/VVD_Work/test/1/b.jpg =&gt; 1/b.jpg [2/10, 20.0%] ...<br>Uploading /home/vvd/VVD_Work/test/1/c.jpg =&gt; 1/c.jpg [3/10, 30.0%] ...<br>Uploading /home/vvd/VVD_Work/test/2/d.jpg =&gt; 2/d.jpg [4/10, 40.0%] ...<br>Uploading /home/vvd/VVD_Work/test/2/e.jpg =&gt; 2/e.jpg [5/10, 50.0%] ...<br>Uploading /home/vvd/VVD_Work/test/2/f.jpg =&gt; 2/f.jpg [6/10, 60.0%] ...<br>Uploading /home/vvd/VVD_Work/test/g.jpg =&gt; g.jpg [7/10, 70.0%] ...<br>Uploading /home/vvd/VVD_Work/test/h.jpg =&gt; h.jpg [8/10, 80.0%] ...<br>Uploading /home/vvd/VVD_Work/test/i.jpg =&gt; i.jpg [9/10, 90.0%] ...<br>Uploading /home/vvd/VVD_Work/test/j.jpg =&gt; j.jpg [10/10, 100.0%] ...<br><br>See upload log at path /home/vvd/.qshell/qupload/040adc5d<br></code></pre></td></tr></table></figure><h2 id="查看同步日志"><a href="#查看同步日志" class="headerlink" title="查看同步日志"></a>查看同步日志</h2><blockquote><p>日志存放在 ~/.qshell 文件夹下qupload文件夹内：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200331234827.png" alt="查看日志"></p><h2 id="进入七牛云控制台查看上传的文件"><a href="#进入七牛云控制台查看上传的文件" class="headerlink" title="进入七牛云控制台查看上传的文件"></a>进入七牛云控制台查看上传的文件</h2><blockquote><p>在控制台-&gt; 空间管理 -&gt; 文件管理 可以看到同步的文件</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200331234935.png" alt="空间图片"></p><h2 id="图片文件目录更新"><a href="#图片文件目录更新" class="headerlink" title="图片文件目录更新"></a>图片文件目录更新</h2><blockquote><p>当我们更新了原始图片目录时（新建文件夹new，图片new.jpg）：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">tree<br>.<br>├── 1<br>│   ├── a.jpg<br>│   ├── b.jpg<br>│   └── c.jpg<br>├── 2<br>│   ├── d.jpg<br>│   ├── e.jpg<br>│   └── f.jpg<br>├── g.jpg<br>├── h.jpg<br>├── i.jpg<br>├── j.jpg<br>└── new<br>    └── new.jpg<br></code></pre></td></tr></table></figure><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><blockquote><p>回到~/.qshell 上传文件：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"> qshell qupload upload.conf <br>Writing upload log to file /home/vvd/.qshell/qupload/c50b44d8de5ae468d8080f1f37fb946c/c50b44d8de5ae468d8080f1f37fb946c.log<br><br>Uploading /home/vvd/VVD_Work/test/1/a.jpg =&gt; 1/a.jpg [1/8, 12.5%] ...<br>Uploading /home/vvd/VVD_Work/test/1/b.jpg =&gt; 1/b.jpg [2/8, 25.0%] ...<br>Uploading /home/vvd/VVD_Work/test/1/c.jpg =&gt; 1/c.jpg [3/8, 37.5%] ...<br>Uploading /home/vvd/VVD_Work/test/2/d.jpg =&gt; 2/d.jpg [4/8, 50.0%] ...<br>Uploading /home/vvd/VVD_Work/test/2/e.jpg =&gt; 2/e.jpg [5/8, 62.5%] ...<br>Uploading /home/vvd/VVD_Work/test/2/f.jpg =&gt; 2/f.jpg [6/8, 75.0%] ...<br>Uploading /home/vvd/VVD_Work/test/g.jpg =&gt; g.jpg [7/8, 87.5%] ...<br>Uploading /home/vvd/VVD_Work/test/h.jpg =&gt; h.jpg [8/8, 100.0%] ...<br><br>See upload log at path /home/vvd/.qshell/qupload/c50b44d8de5ae468d8080f1f37fb946c/c50b44d8de5ae468d8080f1f37fb946c.log<br></code></pre></td></tr></table></figure><blockquote><p>发现并没有更新，不知道是不是有别的函数来完成这个功能。</p><p>于是写了简单脚本upload.sh可以实现实时同步：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">!/bin/bash</span><br><br>rm  -rf  ~/.qshell/qupload<br>qshell  qupload  ~/.qshell/upload.conf<br></code></pre></td></tr></table></figure><blockquote><p>使用时只需sh upload.sh即可，正好不用每次都找那个 upload.conf 了</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200401002653.png" alt="真 - 同步文件夹"></p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><blockquote><p>咳咳，人家七牛云有这个设定的，不用自己费劲删人家日志。</p><p>在upload.conf中加入配置：</p><ul><li><p><strong>rescan_local</strong>：支持本地增量上传</p></li><li><p><strong>overwrite</strong> ：支持本地文件覆盖上传</p></li></ul></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs conf">&#123;<br>    &quot;src_dir&quot; : &quot;/home/vvd/VVD_Work/test&quot;,<br>    &quot;bucket&quot; : &quot;vvd-space&quot;,<br>    &quot;rescan_local&quot; : true,<br>    &quot;overwrite&quot; : true<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>再上传就好：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"> qshell qupload upload.conf <br>Writing upload log to file /home/vvd/.qshell/qupload/c50b44d8de5ae468d8080f1f37fb946c/c50b44d8de5ae468d8080f1f37fb946c.log<br><br>Uploading /home/vvd/VVD_Work/test/1/a.jpg =&gt; 1/a.jpg [1/12, 8.3%] ...<br>Uploading /home/vvd/VVD_Work/test/1/b.jpg =&gt; 1/b.jpg [2/12, 16.7%] ...<br>Uploading /home/vvd/VVD_Work/test/1/c.jpg =&gt; 1/c.jpg [3/12, 25.0%] ...<br>Uploading /home/vvd/VVD_Work/test/2/d.jpg =&gt; 2/d.jpg [4/12, 33.3%] ...<br>Uploading /home/vvd/VVD_Work/test/2/e.jpg =&gt; 2/e.jpg [5/12, 41.7%] ...<br>Uploading /home/vvd/VVD_Work/test/2/f.jpg =&gt; 2/f.jpg [6/12, 50.0%] ...<br>Uploading /home/vvd/VVD_Work/test/3/g.jpg =&gt; 3/g.jpg [7/12, 58.3%] ...<br>Uploading /home/vvd/VVD_Work/test/g.jpg =&gt; g.jpg [8/12, 66.7%] ...<br>Uploading /home/vvd/VVD_Work/test/h.jpg =&gt; h.jpg [9/12, 75.0%] ...<br>Uploading /home/vvd/VVD_Work/test/i.jpg =&gt; i.jpg [10/12, 83.3%] ...<br>Uploading /home/vvd/VVD_Work/test/j.jpg =&gt; j.jpg [11/12, 91.7%] ...<br>Uploading /home/vvd/VVD_Work/test/new/new.jpg =&gt; new/new.jpg [12/12, 100.0%] ...<br><br>See upload log at path /home/vvd/.qshell/qupload/c50b44d8de5ae468d8080f1f37fb946c/c50b44d8de5ae468d8080f1f37fb946c.log<br><br></code></pre></td></tr></table></figure><h2 id="qshell-qupload-配置"><a href="#qshell-qupload-配置" class="headerlink" title="qshell qupload 配置"></a>qshell qupload 配置</h2><blockquote><p><code>qupload</code> 功能需要配置文件的支持，配置文件支持的全部参数如下：</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>   <span class="hljs-attr">&quot;src_dir&quot;</span>            :   <span class="hljs-string">&quot;&lt;LocalPath&gt;&quot;</span>,<br>   <span class="hljs-attr">&quot;bucket&quot;</span>             :   <span class="hljs-string">&quot;&lt;Bucket&gt;&quot;</span>,<br>   <span class="hljs-attr">&quot;file_list&quot;</span>          :   <span class="hljs-string">&quot;&lt;FileList&gt;&quot;</span>,<br>   <span class="hljs-attr">&quot;key_prefix&quot;</span>         :   <span class="hljs-string">&quot;&lt;Key Prefix&gt;&quot;</span>,<br>   <span class="hljs-attr">&quot;up_host&quot;</span>            :   <span class="hljs-string">&quot;&lt;Upload Host&gt;&quot;</span>,<br>   <span class="hljs-attr">&quot;ignore_dir&quot;</span>         :   <span class="hljs-literal">false</span>,<br>   <span class="hljs-attr">&quot;overwrite&quot;</span>          :   <span class="hljs-literal">false</span>,<br>   <span class="hljs-attr">&quot;check_exists&quot;</span>       :   <span class="hljs-literal">false</span>,<br>   <span class="hljs-attr">&quot;check_hash&quot;</span>         :   <span class="hljs-literal">false</span>,<br>   <span class="hljs-attr">&quot;check_size&quot;</span>         :   <span class="hljs-literal">false</span>,<br>   <span class="hljs-attr">&quot;rescan_local&quot;</span>       :   <span class="hljs-literal">true</span>,<br>   <span class="hljs-attr">&quot;skip_file_prefixes&quot;</span> :   <span class="hljs-string">&quot;test,demo,&quot;</span>,<br>   <span class="hljs-attr">&quot;skip_path_prefixes&quot;</span> :   <span class="hljs-string">&quot;hello/,temp/&quot;</span>,<br>   <span class="hljs-attr">&quot;skip_fixed_strings&quot;</span> :   <span class="hljs-string">&quot;.svn,.git&quot;</span>,<br>   <span class="hljs-attr">&quot;skip_suffixes&quot;</span>      :   <span class="hljs-string">&quot;.DS_Store,.exe&quot;</span>,<br>   <span class="hljs-attr">&quot;log_file&quot;</span>           :   <span class="hljs-string">&quot;upload.log&quot;</span>,<br>   <span class="hljs-attr">&quot;log_level&quot;</span>          :   <span class="hljs-string">&quot;info&quot;</span>,<br>   <span class="hljs-attr">&quot;log_rotate&quot;</span>         :   <span class="hljs-number">1</span>,<br>   <span class="hljs-attr">&quot;log_stdout&quot;</span>         :   <span class="hljs-literal">false</span>,<br>   <span class="hljs-attr">&quot;file_type&quot;</span>          :   <span class="hljs-number">0</span><br>&#125;<br></code></pre></td></tr></table></figure><table><thead><tr><th>参数名</th><th>描述</th><th>可选参数</th></tr></thead><tbody><tr><td>src_dir</td><td>本地同步路径，为全路径格式，工具将同步该目录下面所有的文件；不支持本地路径下的目录软连接。在Windows系统下面使用的时候，注意<code>src_dir</code>的设置遵循<code>D:\\jemy\\backup</code>这种方式。也就是路径里面的<code>\</code>要有两个（<code>\\</code>）</td><td>N</td></tr><tr><td>bucket</td><td>同步数据的目标空间名称，可以为公开空间或私有空间</td><td>N</td></tr><tr><td>file_list</td><td>待同步文件列表，该文件列表内容必须是相对于<code>src_dir</code>的文件相对路径列表，可以不指定，工具将自动获取<code>src_dir</code>下面的文件列表。请使用 <code>dircache</code> 命令生成这个文件列表，生成之后可以手动删除不需要的行</td><td>Y</td></tr><tr><td>up_host</td><td>上传域名，可选设置，一般情况下不需要指定</td><td>Y</td></tr><tr><td>ignore_dir</td><td>保存文件在七牛空间时，使用的文件名是否忽略本地路径，默认为false</td><td>Y</td></tr><tr><td>key_prefix</td><td>在保存文件在七牛空间时，使用的文件名的前缀，默认为空字符串</td><td>Y</td></tr><tr><td>overwrite</td><td>是否覆盖空间中已有的同名文件，默认不覆盖。</td><td>Y</td></tr><tr><td>check_exists</td><td>每个文件上传之前是否检查空间中是否存在同名文件，默认为false，不检查</td><td>Y</td></tr><tr><td>check_hash</td><td>在<code>check_exists</code>设置为<code>true</code>的情况下生效，是否检查本地文件hash和空间文件hash一致，默认不检查，节约同步时间</td><td>Y</td></tr><tr><td>check_size</td><td>在<code>check_exists</code>设置为<code>true</code>的情况下，如果<code>check_hash</code>为<code>false</code>，那么你可以设置<code>check_size</code>为<code>true</code>做简单的大小检查，以查看本地文件和空间文件大小是否一致，默认不检查</td><td>Y</td></tr><tr><td>skip_file_prefixes</td><td>跳过所有文件名（不带相对路径）以该前缀列表里面字符串为前缀的文件</td><td>Y</td></tr><tr><td>skip_path_prefixes</td><td>跳过所有文件路径（相对路径）以该前缀列表里面字符串为前缀的文件</td><td>Y</td></tr><tr><td>skip_fixed_strings</td><td>跳过所有文件路径（相对路径）中包含该字符串列表中字符串的文件</td><td>Y</td></tr><tr><td>skip_suffixes</td><td>跳过所有以该后缀列表里面字符串为后缀的文件或者目录</td><td>Y</td></tr><tr><td>rescan_local</td><td>默认情况下，本地新增的文件不会被同步，需要手动设置为true才会去检测新增文件。</td><td>Y</td></tr><tr><td>log_level</td><td>上传日志输出级别，可选值为<code>debug</code>,<code>info</code>,<code>warn</code>,<code>error</code>,默认<code>info</code></td><td>Y</td></tr><tr><td>log_file</td><td>上传日志的输出文件，如果不指定会输出到qshell工作目录下默认的文件中，文件名可以在终端输出看到</td><td>Y</td></tr><tr><td>log_rotate</td><td>上传日志文件的切换周期，单位为天，默认为1天即切换到新的上传日志文件</td><td>Y</td></tr><tr><td>log_stdout</td><td>上传日志是否同时输出一份到标准终端，默认为false，主要在调试上传功能时可以指定为true</td><td>Y</td></tr><tr><td>file_type</td><td>文件存储类型，默认为<code>0</code>(标准存储） <code>1</code>为低频存储</td><td>Y</td></tr><tr><td>delete_on_success</td><td>上传成功的文件，同时删除本地文件，以达到节约磁盘的目的，比如日志归档的场景，默认为<code>false</code>，如果需要开启功能，设置为<code>true</code>即可。</td><td>Y</td></tr></tbody></table><h3 id="配置文件示例"><a href="#配置文件示例" class="headerlink" title="配置文件示例"></a>配置文件示例</h3><blockquote><p>我的配置文件使用了常用的实用配置，供大家参考：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs conf">&#123;<br>    &quot;src_dir&quot; : &quot;/Hexo/Album_Temp&quot;,       ### 上传文件夹路径（必选）<br>    &quot;bucket&quot; : &quot;vvd-space&quot;,### 七牛云空间名称（必选）<br>    &quot;rescan_local&quot; : true,   ### 支持增量上传（重要）<br>&quot;key_prefix&quot;: &quot;vvd_hexo/&quot;,### 上传图像的前缀<br>&quot;check_exists&quot;: true,   ### 上传前是否检查文件是否存在<br>&quot;check_size&quot;:true, ### 如果存在同名文件检查大小是否相同（比哈希快一些）<br>&quot;skip_suffixes&quot;: &quot;.json,.log,.conf&quot;,### 后缀列表，在上传文件夹路径中文件有这些后缀的就忽略不上传<br>    &quot;overwrite&quot; : true  ### 可否覆盖原文件<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>上传后的一张图片链接：</p></blockquote><p><a href="https://photos.zywvvd.com/vvd_hexo/2015_11_28_hefei_ustc_fengjing/1.jpg">https://photos.zywvvd.com/vvd_hexo/2015_11_28_hefei_ustc_fengjing/1.jpg</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>swig 语法介绍</title>
    <link href="/2020/03/31/coding/front_end/swig/swig-grammar/"/>
    <url>/2020/03/31/coding/front_end/swig/swig-grammar/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Next 主题使用swig引擎，swig 是node端的一个优秀简洁的模板引擎，本文介绍swig基本语法。</p></blockquote><span id="more"></span><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li>支持大多数主流浏览器。</li><li>表达式兼容性好。</li><li>面向对象的模板继承。</li><li>将过滤器和转换应用到模板中的输出。</li><li>可根据路劲渲染页面。</li><li>支持页面复用。</li><li>支持动态页面。</li><li>可扩展、可定制。</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> npm install swig --save</span><br></code></pre></td></tr></table></figure><h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><blockquote><p>swig有多种实现方式来编译和渲染模板</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> swig = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;swig&#x27;</span>);<br><br><span class="hljs-comment">// Compile a file and store it, rendering it later</span><br><span class="hljs-keyword">var</span> tpl = swig.compileFile(<span class="hljs-string">&#x27;/path/to/template.html&#x27;</span>);<br><span class="hljs-built_in">console</span>.log(tpl(&#123; <span class="hljs-attr">article</span>: &#123; <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;Swig is fun!&#x27;</span> &#125;&#125;));<br><br><span class="hljs-comment">// 直接渲染字符串模板</span><br><span class="hljs-built_in">console</span>.log(swig.render(<span class="hljs-string">&#x27;&#123;% if foo %&#125;Hooray!&#123;% endif %&#125;&#x27;</span>, &#123; <span class="hljs-attr">locals</span>: &#123; <span class="hljs-attr">foo</span>: <span class="hljs-literal">true</span> &#125;&#125;));<br></code></pre></td></tr></table></figure><h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><blockquote><p>模板中的变量使用双大括号来声明。例如</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&#123;&#123;a&#125;&#125;<br></code></pre></td></tr></table></figure><h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><blockquote><p>变量的属性可以使用<code>.</code>或者<code>[ ]</code>来访问，如下两个是等价的:</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp">&#123;&#123; foo.bar &#125;&#125;<br><br><span class="hljs-comment">// is equivalent to</span><br>&#123;&#123; foo[<span class="hljs-string">&#x27;bar&#x27;</span>] &#125;&#125;<br></code></pre></td></tr></table></figure><blockquote><p>他遵循和javascript一样的原则，如果关键词中有<code>-</code>，则必须使用<code>[]</code>来访问属性，不能使用<code>.</code></p></blockquote><p><strong>Bad!</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&#123;&#123; foo.chicken-tacos &#125;&#125;<br></code></pre></td></tr></table></figure><p><strong>Good!</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;&#123; foo[<span class="hljs-string">&#x27;chicken-tacos&#x27;</span>] &#125;&#125;<br></code></pre></td></tr></table></figure><h3 id="未定义和空值"><a href="#未定义和空值" class="headerlink" title="未定义和空值"></a>未定义和空值</h3><blockquote><p>如果一个变量未定义或者是空值，在渲染的时候，将会在相应的位置输出一个空的字符串，而不会报异常。</p></blockquote><h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><blockquote><p>变量可以用特殊的链式结构进行修改过滤。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp">&#123;&#123; name|title &#125;&#125; was born <span class="hljs-keyword">on</span> &#123;&#123; birthday|date(<span class="hljs-string">&#x27;F jS, Y&#x27;</span>) &#125;&#125;<br><br><span class="hljs-comment">// =&gt; Jane was born on July 6th, 1985</span><br></code></pre></td></tr></table></figure><h3 id="方法（函数）"><a href="#方法（函数）" class="headerlink" title="方法（函数）"></a>方法（函数）</h3><blockquote><p>变量也可以是 JavaScript functions. 值得注意的是，不管你的 autoescape设定是什么样的，方法都不会被 auto-escaped.</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">var</span> locals = &#123; <span class="hljs-attr">mystuff</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mystuff</span>(<span class="hljs-params"></span>) </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;p&gt;Things!&lt;/p&gt;&#x27;</span>; &#125;&#125;;<br>swig.render(<span class="hljs-string">&#x27;&#123;&#123; mystuff() &#125;&#125;&#x27;</span>, &#123; <span class="hljs-attr">locals</span>: locals &#125;);<br><span class="hljs-comment">// =&gt; &lt;p&gt;Things!&lt;/p&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p> 如果要对函数强制转义输出，只需通过管道将其传递到转义筛选器。</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jsx">&#123;&#123; mystuff()|<span class="hljs-built_in">escape</span> &#125;&#125;<br><span class="hljs-comment">// =&gt; &lt;p&gt;Things&lt;/p&gt;</span><br></code></pre></td></tr></table></figure><h2 id="逻辑标签"><a href="#逻辑标签" class="headerlink" title="逻辑标签"></a>逻辑标签</h2><blockquote><p>Swig包含一些基本的可选的代码块，叫做标签，使用标签可以更好的控制模板的渲染输出。标签示例如下：</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">&#123;% <span class="hljs-keyword">if</span> foo %&#125;bar&#123;% <span class="hljs-keyword">endif</span> %&#125;<br><br><span class="hljs-comment">// Create a list of people, only if there are items in the people array</span><br>&#123;% <span class="hljs-keyword">for</span> person in people %&#125;<br>  &#123;% <span class="hljs-keyword">if</span> loop.first %&#125;&lt;ol&gt;&#123;% <span class="hljs-keyword">endif</span> %&#125;<br>  &lt;li&gt;&#123;&#123; person.name &#125;&#125;&lt;/li&gt;<br>  &#123;% <span class="hljs-keyword">if</span> loop.last %&#125;&lt;/ol&gt;&#123;% <span class="hljs-keyword">endif</span> %&#125;<br>&#123;% <span class="hljs-keyword">endfor</span> %&#125;<br></code></pre></td></tr></table></figure><blockquote><p>其中<code>&#123; %  endif  % &#125;</code>和<code>&#123; %  endfor  % &#125;</code>是结束标签，用于表明代码块的的结束。</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">&#123;% block tacos %&#125;<br>  <span class="hljs-comment">//...</span><br>&#123;% endblock tacos %&#125;<br>&#123;% block burritos %&#125;<br>  &#123;% <span class="hljs-keyword">if</span> foo %&#125;<br>    <span class="hljs-comment">// ...</span><br>  &#123;% <span class="hljs-keyword">endif</span> %&#125; <span class="hljs-comment">//the above will render if foo == true</span><br>&#123;% endblock burritos %&#125;<br></code></pre></td></tr></table></figure><blockquote><p>更多关于tag的信息，请查看<a href="https://link.jianshu.com/?t=http://node-swig.github.io/swig-templates/docs/tags/">官方文档</a>，这里挑几个重点的经常见到的说说。</p></blockquote><h3 id="block标签"><a href="#block标签" class="headerlink" title="block标签"></a>block标签</h3><blockquote><p>用于声明一个代码块，继承的子模板中间可以改写或者拓展父模板中同名的代码块。也可查看#继承</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs undefined">&#123;% block body %&#125;...&#123;% endblock %&#125;<br></code></pre></td></tr></table></figure><h3 id="if-else-endif和if-elseif-endif标签"><a href="#if-else-endif和if-elseif-endif标签" class="headerlink" title="if-else-endif和if-elseif-endif标签"></a><code>if-else-endif</code>和<code>if-elseif-endif</code>标签</h3><blockquote><p>这个与java中的if功能类似，做条件判断时使用。满足条件的内容将会被输出。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp">&#123;% <span class="hljs-keyword">if</span> x|lower === <span class="hljs-string">&#x27;tacos&#x27;</span> %&#125;<br>  You can use filters <span class="hljs-keyword">on</span> any operand <span class="hljs-keyword">in</span> the statement.<br>&#123;% endif %&#125;<br></code></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">&#123;% <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> y %&#125;<br>  If x <span class="hljs-keyword">is</span> a value that <span class="hljs-keyword">is</span> present <span class="hljs-keyword">in</span> y, <span class="hljs-keyword">this</span> will <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>.<br>&#123;% endif %&#125;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php">&#123;% <span class="hljs-keyword">if</span> <span class="hljs-literal">false</span> %&#125;<br>  Tacos<br>&#123;% <span class="hljs-keyword">elseif</span> <span class="hljs-literal">true</span> %&#125;<br>  Burritos<br>&#123;% <span class="hljs-keyword">else</span> %&#125;<br>  Churros<br>&#123;% <span class="hljs-keyword">endif</span> %&#125;<br><span class="hljs-comment">// =&gt; Burritos</span><br></code></pre></td></tr></table></figure><h3 id="extends-标签"><a href="#extends-标签" class="headerlink" title="extends 标签"></a>extends 标签</h3><blockquote><p>使当前的模板继承一个父模板，这个标签必须位于模板的最前面。其他查看#继承</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">&#123;% <span class="hljs-keyword">extends</span> <span class="hljs-string">&quot;./layout.html&quot;</span> %&#125;<br></code></pre></td></tr></table></figure><h3 id="for标签"><a href="#for标签" class="headerlink" title="for标签"></a>for标签</h3><p>用于遍历对象和数组时使用。</p><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><table><thead><tr><th>Name</th><th>Type</th><th>可选</th><th>Default</th><th>描述</th></tr></thead><tbody><tr><td>key</td><td><code>literal</code></td><td>✔</td><td><code>undefined</code></td><td>A shortcut to the index of the array or current key accessor.</td></tr><tr><td>variable</td><td><code>literal</code></td><td></td><td><code>undefined</code></td><td>The current value will be assigned to this variable name temporarily. The variable will be reset upon ending the for tag.</td></tr><tr><td>in</td><td><code>literal</code></td><td></td><td><code>undefined</code></td><td>Literally, “in”. This token is required.</td></tr><tr><td>object</td><td><code>object</code></td><td></td><td><code>undefined</code></td><td>An enumerable object that will be iterated over.</td></tr></tbody></table><h4 id="Returns"><a href="#Returns" class="headerlink" title="Returns"></a>Returns</h4><p><code>loop.index</code>: The current iteration of the loop (1-indexed)</p><p><code>loop.index0</code>: The current iteration of the loop (0-indexed)</p><p><code>loop.revindex</code>: The number of iterations from the end of the loop (1-indexed)</p><p><code>loop.revindex0</code>: The number of iterations from the end of the loop (0-indexed)</p><p><code>loop.key</code>: If the iterator is an object, this will be the key of the current item, otherwise it will be the same as the loop.index.</p><p><code>loop.first</code>: True if the current object is the first in the object or array.</p><p><code>loop.last</code>: True if the current object is the last in the object or array.</p><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml">// obj = &#123; one: &#x27;hi&#x27;, two: &#x27;bye&#x27; &#125;;<br>&#123;% for x in obj %&#125;<br>  &#123;% if loop.first %&#125;<span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>&#123;% endif %&#125;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>&#123;&#123; loop.index &#125;&#125; - &#123;&#123; loop.key &#125;&#125;: &#123;&#123; x &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>  &#123;% if loop.last %&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>&#123;% endif %&#125;<br>&#123;% endfor %&#125;<br>// =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>//    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>1 - one: hi<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>//    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>2 - two: bye<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>//    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-comment">// arr = [1, 2, 3]</span><br><span class="hljs-comment">// Reverse the array, shortcut the key/index to `key`</span><br>&#123;% <span class="hljs-keyword">for</span> key, <span class="hljs-keyword">val</span> <span class="hljs-keyword">in</span> arr|reverse %&#125;<br>&#123;&#123; key &#125;&#125; -- &#123;&#123; <span class="hljs-keyword">val</span> &#125;&#125;<br>&#123;% endfor %&#125;<br><span class="hljs-comment">// =&gt; 0 -- 3</span><br><span class="hljs-comment">//    1 -- 2</span><br><span class="hljs-comment">//    2 -- 1</span><br></code></pre></td></tr></table></figure><h3 id="import"><a href="#import" class="headerlink" title="import"></a>import</h3><blockquote><p>Source: <a href="https://link.jianshu.com/?t=https://github.com/paularmstrong/swig/blob/v2.0.0/lib/tags/import.js">lib/tags/import.js</a></p></blockquote><blockquote><p>允许你引入定义在别的文件当中的宏到你当前的模板文件当中。</p></blockquote><blockquote><p>The import tag is specifically designed for importing macros into your template with a specific context scope. This is very useful for keeping your macros from overriding template context that is being injected by your server-side page generation.</p></blockquote><h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><table><thead><tr><th>Name</th><th>Type</th><th>Optional</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>file</td><td><code>string orvar</code></td><td></td><td><code>undefined</code></td><td>Relative path from the current template file to the file to import macros from.</td></tr><tr><td>as</td><td><code>literal</code></td><td></td><td><code>undefined</code></td><td>Literally, “as”.</td></tr><tr><td>varname</td><td><code>literal</code></td><td></td><td><code>undefined</code></td><td>Local-accessible object name to assign the macros to.</td></tr></tbody></table><h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dart">&#123;% <span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;./formmacros.html&#x27;</span> <span class="hljs-keyword">as</span> form %&#125;<br>&#123;&#123; form.input(<span class="hljs-string">&quot;text&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>) &#125;&#125;<br><span class="hljs-comment">// =&gt; &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;</span><br>&#123;% <span class="hljs-keyword">import</span> <span class="hljs-string">&quot;../shared/tags.html&quot;</span> <span class="hljs-keyword">as</span> tags %&#125;<br>&#123;&#123; tags.stylesheet(<span class="hljs-string">&#x27;global&#x27;</span>) &#125;&#125;<br><span class="hljs-comment">// =&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;/global.css&quot;&gt;</span><br></code></pre></td></tr></table></figure><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><blockquote><p>Comments注释在渲染时将会被忽略，他们在渲染之前就会移除，所以没人能看到你的注释，除非他们查看你的源代码。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs csharp">&#123; <span class="hljs-meta">#</span><br>This <span class="hljs-keyword">is</span> a comment.<br>It will be fully stripped <span class="hljs-keyword">and</span> ignored during parsing.<br><span class="hljs-meta"># &#125;</span><br></code></pre></td></tr></table></figure><h2 id="空格控制符"><a href="#空格控制符" class="headerlink" title="空格控制符"></a>空格控制符</h2><blockquote><p>模板中的任何空格都会被输出在最终生成的页面上。然而，你可以使用空格控制符来消除空格。</p></blockquote><blockquote><p>在tag的前面或者后面添加<code>-</code>来移除前面或者后面的空格。</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// seq = [1, 2, 3, 4, 5]</span><br>&#123;% <span class="hljs-keyword">for</span> item in seq -%&#125;&#123;&#123; item &#125;&#125;<br>&#123;%- <span class="hljs-keyword">endfor</span> %&#125;<br><span class="hljs-comment">// =&gt; 12345</span><br></code></pre></td></tr></table></figure><p><code>注意</code> 没有任何空格输出</p><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><blockquote><p>swig使用<code>extends</code>关键字来对模板进行继承</p></blockquote><ul><li>layout.html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!doctype <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&#123;% block title %&#125;My Site&#123;% endblock %&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  &#123;% block head %&#125;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;main.css&quot;</span>&gt;</span><br>  &#123;% endblock %&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  &#123;% block content %&#125;&#123;% endblock %&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>index.html</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart">&#123;% <span class="hljs-keyword">extends</span> <span class="hljs-string">&#x27;layout.html&#x27;</span> %&#125;<br>&#123;% block title %&#125;My Page&#123;% endblock %&#125;<br>&#123;% block head %&#125;<br>  &#123;% parent %&#125;<br>  &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;custom.css&quot;</span>&gt;<br>&#123;% endblock %&#125;<br>&#123;% block content %&#125;<br>&lt;p&gt;This <span class="hljs-keyword">is</span> just an awesome page.&lt;/p&gt;<br>&#123;% endblock %&#125;d<br></code></pre></td></tr></table></figure><blockquote><p>模板<code>index.html</code>继承自<code>layout.html</code>，并且改写或者实现了其中的内容。</p></blockquote><h3 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h3><p><a href="https://www.jianshu.com/p/c5d333e6353c">https://www.jianshu.com/p/c5d333e6353c</a><br><a href="http://node-swig.github.io/swig-templates/docs/api/#CacheOptionshttp://node-swig.github.io/swig-templates/docs/api/#CacheOptions">http://node-swig.github.io/swig-templates/docs/api/#CacheOptionshttp://node-swig.github.io/swig-templates/docs/api/#CacheOptions</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>编程知识</category>
      
      <category>前端</category>
      
      <category>swig</category>
      
    </categories>
    
    
    <tags>
      
      <tag>编程知识</tag>
      
      <tag>前端</tag>
      
      <tag>swig</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pip 常用命令与国内源配置</title>
    <link href="/2020/03/30/coding/environment/pip-chinese-source/pip-chinese-source/"/>
    <url>/2020/03/30/coding/environment/pip-chinese-source/pip-chinese-source/</url>
    
    <content type="html"><![CDATA[<blockquote><p>pip默认源存在速度慢的问题，本文介绍pip命令添加国内源的方法。</p></blockquote><span id="more"></span><h3 id="pip常用命令"><a href="#pip常用命令" class="headerlink" title="pip常用命令"></a>pip常用命令</h3><h4 id="安装包"><a href="#安装包" class="headerlink" title="安装包"></a>安装包</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">pip install <span class="hljs-keyword">Package</span><br><span class="hljs-title">pip install -r requirements.txt</span><br></code></pre></td></tr></table></figure><h4 id="更新包"><a href="#更新包" class="headerlink" title="更新包"></a>更新包</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">pip install -U <span class="hljs-keyword">Package</span><br></code></pre></td></tr></table></figure><h4 id="卸载包"><a href="#卸载包" class="headerlink" title="卸载包"></a>卸载包</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">pip uninstall <span class="hljs-keyword">Package</span><br></code></pre></td></tr></table></figure><h4 id="列出已安装软件"><a href="#列出已安装软件" class="headerlink" title="列出已安装软件"></a>列出已安装软件</h4><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pip list<br>pip <span class="hljs-keyword">freeze</span><br>pip <span class="hljs-keyword">freeze</span> -r requirements.txt<br></code></pre></td></tr></table></figure><h4 id="某个包详细信息"><a href="#某个包详细信息" class="headerlink" title="某个包详细信息"></a>某个包详细信息</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">pip show -f <span class="hljs-keyword">Package</span><br></code></pre></td></tr></table></figure><h3 id="国内源配置"><a href="#国内源配置" class="headerlink" title="国内源配置"></a>国内源配置</h3><h4 id="常用的国内镜像"><a href="#常用的国内镜像" class="headerlink" title="常用的国内镜像"></a>常用的国内镜像</h4><ul><li>阿里云 <a href="https://mirrors.aliyun.com/pypi/simple/">https://mirrors.aliyun.com/pypi/simple/</a></li><li>豆瓣<a href="https://pypi.douban.com/simple/">https://pypi.douban.com/simple/</a></li><li>清华大学 <a href="https://pypi.tuna.tsinghua.edu.cn/simple/">https://pypi.tuna.tsinghua.edu.cn/simple/</a></li><li>中国科学技术大学 <a href="https://pypi.mirrors.ustc.edu.cn/simple/">https://pypi.mirrors.ustc.edu.cn/simple/</a></li><li>华中科技大学<a href="https://pypi.hustunique.com/">https://pypi.hustunique.com/</a></li></ul><p><strong>新版ubuntu要求使用https源，要注意。</strong></p><blockquote><p>就我的经验来说阿里云是目前用下来最稳定可靠的。</p></blockquote><h4 id="临时使用"><a href="#临时使用" class="headerlink" title="临时使用"></a>临时使用</h4><blockquote><p>在使用pip的时候，加上参数 <code>-i</code> 和镜像地址</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install -i https://mirrors.aliyun.com/pypi/simple/ tensorboard<br></code></pre></td></tr></table></figure><blockquote><p>从清华源安装 tensorboard</p></blockquote><h4 id="命令配置"><a href="#命令配置" class="headerlink" title="命令配置"></a>命令配置</h4><blockquote><p>在终端输入命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install pip -U    # 升级pip到最新版本<br>pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/<br></code></pre></td></tr></table></figure><blockquote><p>此方法配置后安装包时可能会提示下载源不可信，需要手动加上<code>--trusted-host mirrors.aliyun.com</code></p></blockquote><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">The repository located at mirrors.aliyun.com <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> a <span class="hljs-keyword">trusted</span> <span class="hljs-keyword">or</span> secure host <span class="hljs-keyword">and</span> <span class="hljs-keyword">is</span> being ignored. <span class="hljs-keyword">If</span> this repository <span class="hljs-keyword">is</span> available via HTTPS we recommend you use HTTPS <span class="hljs-keyword">instead</span>, otherwise you may silence this <span class="hljs-built_in">warning</span> <span class="hljs-keyword">and</span> allow it anyway <span class="hljs-keyword">with</span> <span class="hljs-string">&#x27;--trusted-host mirrors.aliyun.com&#x27;</span>.<br></code></pre></td></tr></table></figure><blockquote><p>这样就不那么香了，一劳永逸的解决方案是修改pip配置文件</p></blockquote><h4 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h4><h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h5><blockquote><p>配置文件位置：</p></blockquote><ul><li> <code>~/.pip/pip.conf </code></li><li><code>~/.config/pip/pip.conf</code></li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-keyword">global</span>]<br><span class="hljs-keyword">index</span>-url = https://mirrors.aliyun.com/pypi/simple/<br><span class="hljs-keyword">trusted</span>-host = mirrors.aliyun.com<br></code></pre></td></tr></table></figure><h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><blockquote><p>配置文件位置：</p></blockquote><ul><li><code>%HOMEPATH%\pip\pip.ini</code>，即 <code>C:\Users\pip\pip.ini</code></li><li><code>%APPDATA%\pip\pip.ini</code>，即<code>C:\Users\AppData\Roaming\pip\pip.ini</code></li></ul><blockquote><p>可以通过在cmd中输入 <code>echo %APPDATA%</code> 或  <code>echo %HOMEPATH%</code> 查看自己的相关路径</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml">[<span class="hljs-string">global</span>]<br><span class="hljs-string">index-url</span> <span class="hljs-string">=</span> <span class="hljs-string">https://mirrors.aliyun.com/pypi/simple/</span><br>[<span class="hljs-string">install</span>]<br><span class="hljs-string">trusted-host</span> <span class="hljs-string">=</span> <span class="hljs-string">mirrors.aliyun.com</span><br></code></pre></td></tr></table></figure><h4 id="调整源地址"><a href="#调整源地址" class="headerlink" title="调整源地址"></a>调整源地址</h4><ul><li><code>http</code>不可信，将源地址修改为 <code>https</code> 也可以避免信任危机</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">[global]<br>index-url = https:<span class="hljs-regexp">//mi</span>rrors.aliyun.com<span class="hljs-regexp">/pypi/</span>simple/<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>程序人生</category>
      
      <category>环境配置</category>
      
    </categories>
    
    
    <tags>
      
      <tag>程序人生</tag>
      
      <tag>环境配置</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -21- 添加相册系列 - 1- 框架设置</title>
    <link href="/2020/03/29/hexo-theme/next/21_add_photos/add-photos/"/>
    <url>/2020/03/29/hexo-theme/next/21_add_photos/add-photos/</url>
    
    <content type="html"><![CDATA[<blockquote><p> Next 主题原生没有相册功能，我又是摄影爱好者，不得不下点功夫在这了。本系列介绍添加相册的方法，本文是开篇，记录Next主题下开启相册按钮和开启相应页面，后面的一边研究一边发。</p></blockquote><span id="more"></span><h2 id="Next设置"><a href="#Next设置" class="headerlink" title="Next设置"></a>Next设置</h2><ul><li>新建hexo page</li></ul><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> photos<br></code></pre></td></tr></table></figure><blockquote><p>将会在<code>source/</code>下创建<code>photos/index.md</code></p></blockquote><ul><li>在index.md中添加<code>type: photos</code></li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">title: photos<br>date: 2020-03-22 23:03:55<br>type: photos<br></code></pre></td></tr></table></figure><ul><li>修改<code>主题配置文件</code>，在<code>menu</code>字段中加入<code>photos: /photos/ || image</code></li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Usage: `Key: /link/ || icon`</span><br><span class="hljs-comment"># Key is the name of menu item. If the translation for this item is available, the translated text will be loaded, otherwise the Key name will be used. Key is case-senstive.</span><br><span class="hljs-comment"># Value before `||` delimiter is the target link, value after `||` delimiter is the name of Font Awesome icon.</span><br><span class="hljs-comment"># When running the site in a subdirectory (e.g. yoursite.com/blog), remove the leading slash from link value (/archives -&gt; archives).</span><br><span class="hljs-comment"># External url should start with http:// or https://</span><br><span class="hljs-attr">menu:</span><br>  <span class="hljs-attr">home:</span> <span class="hljs-string">/</span> <span class="hljs-string">||</span> <span class="hljs-string">home</span><br>  <span class="hljs-attr">about:</span> <span class="hljs-string">/about/</span> <span class="hljs-string">||</span> <span class="hljs-string">user</span><br>  <span class="hljs-attr">tags:</span> <span class="hljs-string">/tags/</span> <span class="hljs-string">||</span> <span class="hljs-string">tags</span><br>  <span class="hljs-attr">categories:</span> <span class="hljs-string">/categories/</span> <span class="hljs-string">||</span> <span class="hljs-string">th</span><br>  <span class="hljs-attr">archives:</span> <span class="hljs-string">/archives/</span> <span class="hljs-string">||</span> <span class="hljs-string">archive</span><br>  <span class="hljs-attr">photos:</span> <span class="hljs-string">/photos/</span> <span class="hljs-string">||</span> <span class="hljs-string">image</span><br>  <span class="hljs-comment">#schedule: /schedule/ || calendar</span><br>  <span class="hljs-attr">sitemap:</span> <span class="hljs-string">/sitemap.xml</span> <span class="hljs-string">||</span> <span class="hljs-string">sitemap</span><br>  <span class="hljs-comment">#commonweal: /404/ || heartbeat</span><br></code></pre></td></tr></table></figure><ul><li>修改 themes/next/languages/zh-Hans.yml，添加photos字段</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">menu:</span><br>  <span class="hljs-attr">home:</span> <span class="hljs-string">首页</span><br>  <span class="hljs-attr">archives:</span> <span class="hljs-string">归档</span><br>  <span class="hljs-attr">categories:</span> <span class="hljs-string">分类</span><br>  <span class="hljs-attr">tags:</span> <span class="hljs-string">标签</span><br>  <span class="hljs-attr">about:</span> <span class="hljs-string">关于</span><br>  <span class="hljs-attr">search:</span> <span class="hljs-string">搜索</span><br>  <span class="hljs-attr">commonweal:</span> <span class="hljs-string">公益404</span><br>  <span class="hljs-attr">something:</span> <span class="hljs-string">有料</span><br>  <span class="hljs-attr">sitemap:</span> <span class="hljs-string">站点地图</span><br>  <span class="hljs-attr">photos:</span> <span class="hljs-string">相册</span><br></code></pre></td></tr></table></figure><ul><li>此时效果</li></ul><p><img src="https://photos.zywvvd.com/image/20200329233209.png" alt="相册"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -12- 强制使用https协议</title>
    <link href="/2020/03/28/hexo/12_force_https/force-https/"/>
    <url>/2020/03/28/hexo/12_force_https/force-https/</url>
    
    <content type="html"><![CDATA[<blockquote><p>https 是一种通过计算机网络进行安全通信的传输协议，经由HTTP进行通信，利用SSL/TLS建立全信道，加密数据包，相比与http更加安全。本文介绍Hexo博客强制用户https协议访问的方法。</p></blockquote><span id="more"></span><h2 id="修改-Pages-设置"><a href="#修改-Pages-设置" class="headerlink" title="修改 Pages 设置"></a>修改 Pages 设置</h2><blockquote><p>在hexo 挂载的pages中设置（例如我的是github pages），勾选 Enforce HTTPS</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200329221359.png" alt="pages"></p><blockquote><p>此时用户访问您链接时必须使用https协议</p></blockquote><h2 id="CDN加速设置"><a href="#CDN加速设置" class="headerlink" title="CDN加速设置"></a>CDN加速设置</h2><blockquote><p>设置了CDN加速的同志也要在相应的控制台进行设置，不然可能会因为pages强制https，但CDN没有这样的要求，使用http协议访问你的加速域名，当转到源时发现协议不对，又跳转使用源的原始链接，导致CDN加速失效。</p><p>进入控制台（我的是七牛云，具体加速设置参考：<a href="https://www.zywvvd.com/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/">Hexo -7- Github源七牛云CDN加速教程（详细）</a>）-&gt; CDN -&gt; 域名管理 -&gt; 配置相应的域名</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200329222035.png" alt="配置域名"></p><blockquote><p>修改Https配置</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200329222136.png" alt="Https配置"></p><blockquote><p>开启强制https</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200329222240.png" alt="强制https开关"></p><blockquote><p>配置完毕，用户只能用https访问你的站点了。</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200329222408.png" alt="安全链接"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -11- 修改网站Logo</title>
    <link href="/2020/03/28/hexo/11_change_logo/change-logo/"/>
    <url>/2020/03/28/hexo/11_change_logo/change-logo/</url>
    
    <content type="html"><![CDATA[<blockquote><p> Next 主题默认的网站logo是字母N，本文介绍如何更换成自己的logo。</p></blockquote><span id="more"></span><h2 id="编辑logo图像文件"><a href="#编辑logo图像文件" class="headerlink" title="编辑logo图像文件"></a>编辑logo图像文件</h2><blockquote><p>Next主题logo一共四个：</p><ul><li>16×16 png</li><li>32×32 png</li><li>180×180 png</li><li>512 ×512 svn</li></ul></blockquote><blockquote><p>设计好自己的logo后在前三种尺寸下保存成png</p></blockquote><blockquote><p>在 <a href="https://c.runoob.com/more/svgeditor/">https://c.runoob.com/more/svgeditor/</a> 可以设计自己的svg图像</p></blockquote><h2 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h2><blockquote><p>将图像放入 themes -&gt; next -&gt; source -&gt; images 文件夹下，修改主题配置文件</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># ---------------------------------------------------------------</span><br><span class="hljs-comment"># Site Information Settings</span><br><span class="hljs-comment"># See: https://theme-next.org/docs/getting-started/</span><br><span class="hljs-comment"># ---------------------------------------------------------------</span><br><br><span class="hljs-attr">favicon:</span><br>  <span class="hljs-attr">small:</span> <span class="hljs-string">/images/logo-16.png</span><br>  <span class="hljs-attr">medium:</span> <span class="hljs-string">/images/logo-32.png</span><br>  <span class="hljs-attr">apple_touch_icon:</span> <span class="hljs-string">/images/logo-180.png</span><br>  <span class="hljs-attr">safari_pinned_tab:</span> <span class="hljs-string">/images/logo-512.svg</span><br>  <span class="hljs-comment">#android_manifest: /images/manifest.json</span><br>  <span class="hljs-comment">#ms_browserconfig: /images/browserconfig.xml</span><br><br></code></pre></td></tr></table></figure><h2 id="效果示例"><a href="#效果示例" class="headerlink" title="效果示例"></a>效果示例</h2><p><img src="https://photos.zywvvd.com/image/20200329220315.png" alt="logo效果"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -20- 使用自定义样式 （custom style)</title>
    <link href="/2020/03/28/hexo-theme/next/20_custom_style/custom-style/"/>
    <url>/2020/03/28/hexo-theme/next/20_custom_style/custom-style/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Next主题允许用户使用自定义样式个性化设置自己网站的主题，本文介绍使用自定义样式的方法。</p></blockquote><span id="more"></span><h2 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h2><blockquote><p>去掉<code>主题配置文件</code> 中<code>custom_file_path</code>字段<code>style</code>值的注释</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Define custom file paths.</span><br><span class="hljs-comment"># Create your custom files in site directory `source/_data` and uncomment needed files below.</span><br><span class="hljs-attr">custom_file_path:</span><br>  <span class="hljs-comment">#head: source/_data/head.swig</span><br>  <span class="hljs-comment">#header: source/_data/header.swig</span><br>  <span class="hljs-comment">#sidebar: source/_data/sidebar.swig</span><br>  <span class="hljs-comment">#postMeta: source/_data/post-meta.swig</span><br>  <span class="hljs-comment">#postBodyEnd: source/_data/post-body-end.swig</span><br>  <span class="hljs-comment">#footer: source/_data/footer.swig</span><br>  <span class="hljs-comment">#bodyEnd: source/_data/body-end.swig</span><br>  <span class="hljs-comment">#variable: source/_data/variables.styl</span><br>  <span class="hljs-comment">#mixin: source/_data/mixins.styl</span><br>  <span class="hljs-attr">style:</span> <span class="hljs-string">source/_data/styles.styl</span><br></code></pre></td></tr></table></figure><blockquote><p>此时我们已经允许博客运用<code>source/_data/styles.styl</code>中的样式，此处要说明的是，此处的source代表的是Hexo根目录的source文件夹，不是next主题中的source</p></blockquote><h2 id="创建样式文件"><a href="#创建样式文件" class="headerlink" title="创建样式文件"></a>创建样式文件</h2><blockquote><p>在Hexo -&gt; source文件夹下建立 <code>_data</code>文件夹，新建文件<code>styles.styl</code>文件，在文件中设置的css会被应用到站点中：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200328153349.png" alt="styles.styl"></p><blockquote><p>事实上在Next 7.7 主题中已经放置了用户自定义设置的styl文件，具体位置：</p><p>themes/next/source/css/custom.styl</p><p>将该文件内容复制到刚刚新建的<code>styles.styl</code>文件中，此时站点已经发生了一些变化</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200328153732.png" alt="styles.styl效果"></p><blockquote><p>文件中的注释很友好，用户可以方便地修改成自己喜欢的样式。</p></blockquote><h2 id="我的修改方案"><a href="#我的修改方案" class="headerlink" title="我的修改方案"></a>我的修改方案</h2><blockquote><p>我简单按照自己的想法配置了<code>styles.styl</code>文件：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br></pre></td><td class="code"><pre><code class="hljs css">// Custom styles.<br><br>// 网站最顶部条线的颜色<br><span class="hljs-selector-class">.headband</span> &#123;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">0px</span>;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#F2F4EF</span>;<br>&#125;<br><br>// 设置背景图片<br><span class="hljs-selector-tag">body</span>&#123;<br>    <span class="hljs-attribute">background</span>:<span class="hljs-built_in">url</span>(<span class="hljs-string">/images/bg.png</span>);<br>    <span class="hljs-attribute">background-repeat</span>:no-repeat;<br>    <span class="hljs-attribute">background-attachment</span>:fixed;<br>    <span class="hljs-attribute">background-position</span>:center;<br>&#125;<br><br>// 设置侧边栏左上角网站标题和副标题区颜色<br><span class="hljs-selector-class">.site-meta</span> &#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-number">#222222</span>;<br>&#125;<br><br>// 设置侧边栏网站标题样式<br><span class="hljs-selector-class">.site-title</span> &#123;<br><span class="hljs-attribute">color</span>:<span class="hljs-number">#fff</span>;<br>&#125;<br><br>// 设置侧边栏网站标题鼠标悬浮样式<br><span class="hljs-selector-class">.site-title</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br><span class="hljs-attribute">letter-spacing</span>: <span class="hljs-number">0.4rem</span>;<br>&#125;<br><br>// 侧边栏网站副标题样式<br><span class="hljs-selector-class">.site-subtitle</span> &#123;<br><span class="hljs-attribute">color</span>:<span class="hljs-number">#fff</span>;<br>&#125;<br><br><span class="hljs-selector-class">.site-author-image</span>&#123;<br><span class="hljs-attribute">border</span>: <span class="hljs-number">0px</span>;<br>&#125;<br><br>// 文章标题鼠标悬浮下划线样式<br><span class="hljs-selector-class">.posts-expand</span> <span class="hljs-selector-class">.post-title-link</span><span class="hljs-selector-pseudo">::before</span> &#123;<br><span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-attribute">position</span>: absolute;<br>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>    <span class="hljs-attribute">height</span>: <span class="hljs-number">2px</span>;<br>    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#DfA710</span>;<br>    <span class="hljs-attribute">visibility</span>: hidden;<br>    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleX</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-attribute">transition-duration</span>: <span class="hljs-number">0.2s</span>;<br>    <span class="hljs-attribute">transition-timing-function</span>: ease-in-out;<br>    <span class="hljs-attribute">transition-delay</span>: <span class="hljs-number">0s</span>;<br>&#125;<br><br>// 文章标题颜色<br><span class="hljs-selector-class">.posts-expand</span> <span class="hljs-selector-class">.post-title-link</span> &#123;<br><span class="hljs-attribute">color</span>:<span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 阅读全文按钮样式<br><span class="hljs-selector-class">.btn</span> &#123;<br><span class="hljs-attribute">border</span>:<span class="hljs-number">2px</span> solid <span class="hljs-number">#DfA710</span>;<br><span class="hljs-attribute">color</span>:<span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 阅读全文按钮鼠标悬浮样式<br><span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 设置文章和侧边栏中链接样式<br><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>,<br><span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.exturl</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">border-bottom-color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 修改文章页侧边栏文章目录下面的第一个标题的鼠标悬浮样式<br>// 真的有毒，文章目录第一个标题的样式还是单独设置的...一开始还没发现<br><span class="hljs-selector-class">.post-toc</span> <span class="hljs-selector-class">.nav</span> <span class="hljs-selector-class">.active-current</span> &gt; <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 文章页面左边文章标题颜色<br><span class="hljs-selector-class">.post-toc</span> <span class="hljs-selector-tag">ol</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">border-bottom-color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 文章页面左边文章标题active时颜色<br><span class="hljs-selector-class">.post-toc</span> <span class="hljs-selector-class">.nav</span> <span class="hljs-selector-class">.active</span> &gt; <span class="hljs-selector-tag">a</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">border-bottom-color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 文章页侧边栏文章目录和站点概况鼠标悬浮样式<br><span class="hljs-selector-class">.sidebar-nav</span> <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 文章页侧边栏文章目录和站点概况active时鼠标悬浮样式<br><span class="hljs-selector-class">.sidebar-nav</span> <span class="hljs-selector-class">.sidebar-nav-active</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 文章页侧边栏文章目录和站点概况active时样式<br><span class="hljs-selector-class">.sidebar-nav</span> <span class="hljs-selector-class">.sidebar-nav-active</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">border-bottom-color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 社交栏鼠标悬浮样式<br><span class="hljs-selector-id">#sidebar</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.links-of-author</span><span class="hljs-selector-class">.motion-element</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>);<br>&#125;<br><br>// 友链鼠标悬浮样式<br><span class="hljs-selector-class">.sidebar</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>,<br><span class="hljs-selector-class">.sidebar</span> <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.exturl</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">border-bottom-color</span>: <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// RSS文字颜色<br>//<span class="hljs-selector-id">#sidebar</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.feed-link</span><span class="hljs-selector-class">.motion-element</span> &gt; <span class="hljs-selector-tag">a</span> &#123;<br>//  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>//&#125;<br><br>// RSS图标颜色<br>//<span class="hljs-selector-id">#sidebar</span> <span class="hljs-selector-tag">div</span><span class="hljs-selector-class">.feed-link</span><span class="hljs-selector-class">.motion-element</span> &gt; <span class="hljs-selector-tag">a</span> <span class="hljs-selector-tag">i</span>&#123;<br>//  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>//&#125;<br><br>// 侧边栏日志、分类、标签 上面的数字的颜色<br><span class="hljs-selector-class">.site-state-item-count</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 设置底部文章分页数字鼠标悬浮上划线颜色<br><span class="hljs-selector-class">.pagination</span> <span class="hljs-selector-class">.prev</span><span class="hljs-selector-pseudo">:hover</span>,<br><span class="hljs-selector-class">.pagination</span> <span class="hljs-selector-class">.next</span><span class="hljs-selector-pseudo">:hover</span>,<br><span class="hljs-selector-class">.pagination</span> <span class="hljs-selector-class">.page-number</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">border-top-color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 设置文章页上一篇文章和下一篇文章鼠标悬浮样式<br><span class="hljs-selector-class">.post-nav-item</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">border-bottom</span>: none;<br>&#125;<br><br>// 修改鼠标选中字符的颜色<br><span class="hljs-comment">/* webkit, opera, IE9 */</span><br><span class="hljs-selector-pseudo">::selection</span> &#123;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-number">#DfA710</span>;<br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#f7f7f7</span>;<br>&#125;<br><span class="hljs-comment">/* firefox */</span><br>::-moz-selection &#123;<br>    background: <span class="hljs-number">#DfA710</span>;<br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#f7f7f7</span>;<br>&#125;<br><br>// 侧边栏返回顶部按钮鼠标悬浮样式<br><span class="hljs-selector-class">.back-to-top</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#eee</span>;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 当页面处于 首页、标签、分类、归档、关于页面其中之一时，处于哪个页面哪个选项就变蓝<br><span class="hljs-selector-id">#menu</span> &gt; <span class="hljs-selector-tag">li</span><span class="hljs-selector-class">.menu-item-active</span> &gt; <span class="hljs-selector-tag">a</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 侧边栏导航小圆点颜色<br><span class="hljs-selector-class">.menu-item-active</span> <span class="hljs-selector-tag">a</span>:after,<br>.menu .menu-item a:hover:after,<br>.menu .menu-item span.exturl:hover:after &#123;<br>  background-color: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 侧边栏上半部分设置为透明<br><span class="hljs-selector-class">.menu-item-active</span> <span class="hljs-selector-tag">a</span>,<br><span class="hljs-selector-class">.menu</span> <span class="hljs-selector-class">.menu-item</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>,<br><span class="hljs-selector-class">.menu</span> <span class="hljs-selector-class">.menu-item</span> <span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.exturl</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">242</span>, <span class="hljs-number">242</span>, <span class="hljs-number">242</span>, <span class="hljs-number">0.30</span>);<br>  <span class="hljs-attribute">border-bottom-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);;<br>&#125;<br><br>// 侧边栏下半部分设置为透明<br><span class="hljs-selector-class">.sidebar</span>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.0</span>);<br>&#125;<br><span class="hljs-selector-class">.sidebar-inner</span>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);<br>&#125;<br><br>// 设置底部文章分页部分为透明<br><span class="hljs-selector-class">.pagination</span>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.0</span>);<br>&#125;<br><span class="hljs-selector-class">.pagination</span> <span class="hljs-selector-class">.page-number</span><span class="hljs-selector-class">.current</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 导航栏底部百分比透明<br><span class="hljs-selector-class">.back-to-top</span>,<br><span class="hljs-selector-class">.back-to-top</span><span class="hljs-selector-pseudo">:hover</span><br>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>);<br>&#125;<br><br>// 设置文章背景透明度<br><span class="hljs-selector-class">.post-block</span>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);<br>&#125;<br><br>// 这里需要完全透明，不然就会在上面的<span class="hljs-number">0.2</span>基础上再进行透明度计算<br><span class="hljs-selector-class">.btn</span>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-selector-class">.header-inner</span>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);<br>&#125;<br><span class="hljs-selector-class">.main-inner</span> &#123;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);<br>&#125;<br><br><span class="hljs-selector-class">.site-brand-container</span><br>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-number">#222222</span>;<br>&#125;<br><br>// 代码区背景<br><span class="hljs-selector-class">.table-container</span>&#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">240</span>, <span class="hljs-number">240</span>, <span class="hljs-number">222</span>, <span class="hljs-number">0.2</span>);<br>&#125;<br><span class="hljs-selector-class">.table-container</span> <span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">237</span>,<span class="hljs-number">237</span>, <span class="hljs-number">225</span>, <span class="hljs-number">0.03</span>);<br>&#125;<br>// 代码背景<br><span class="hljs-selector-tag">table</span> &gt; <span class="hljs-selector-tag">tbody</span> &gt; <span class="hljs-selector-tag">tr</span><span class="hljs-selector-pseudo">:nth-of-type</span>(odd) &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.0</span>);<br>&#125;<br><span class="hljs-selector-tag">table</span> &gt; <span class="hljs-selector-tag">tbody</span> &gt; <span class="hljs-selector-tag">tr</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">233</span>,<span class="hljs-number">230</span>, <span class="hljs-number">230</span>, <span class="hljs-number">0.0</span>);<br>&#125;<br>pre,<br><span class="hljs-selector-class">.highlight</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">200</span>, <span class="hljs-number">31</span>, <span class="hljs-number">33</span>, <span class="hljs-number">0</span>);<br>&#125;<br>//代码行标背景<br><span class="hljs-selector-class">.highlight</span> <span class="hljs-selector-class">.gutter</span> pre &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgbargba</span>(<span class="hljs-number">227</span>, <span class="hljs-number">235</span>, <span class="hljs-number">227</span>, <span class="hljs-number">0.3</span>);<br>&#125;<br><br><span class="hljs-selector-class">.highlight</span> <span class="hljs-selector-class">.code</span> pre &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">29</span>, <span class="hljs-number">31</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>);<br>&#125;<br><br>// 评论<br><span class="hljs-selector-class">.comments</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.2</span>);<br>&#125;<br><br>// 文章页内作者信息<br><span class="hljs-selector-class">.post-copyright</span> &#123;<br>  <span class="hljs-attribute">border-left</span>: <span class="hljs-number">3px</span> solid <span class="hljs-number">#DfA710</span>;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>);<br>&#125;<br><br><span class="hljs-comment">/* 行内代码块的自定义样式 */</span><br><span class="hljs-selector-tag">code</span> &#123;<br>    <span class="hljs-attribute">color</span>: <span class="hljs-number">#FFFFFF</span>;<br>    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">239</span>, <span class="hljs-number">183</span>, <span class="hljs-number">48</span>, <span class="hljs-number">0.4</span>);<br>    <span class="hljs-attribute">margin</span>: <span class="hljs-number">2px</span>;<br>    <span class="hljs-attribute">border</span>: <span class="hljs-number">0px</span> solid <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 底部动态的叶子图标<br><span class="hljs-selector-class">.with-love</span>&#123;<br><span class="hljs-attribute">color</span>: red;<br>&#125;<br><br>// 去掉文章白色背景<br><span class="hljs-selector-class">.main-inner</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0.0</span>);<br>&#125;<br><br>// 标签页链接下划线颜色<br><span class="hljs-selector-tag">a</span>,<br><span class="hljs-selector-tag">span</span><span class="hljs-selector-class">.exturl</span> &#123;<br>  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#DfA710</span>;<br>&#125;<br><br>// 标签页链接鼠标悬浮颜色<br><span class="hljs-selector-class">.tag-cloud</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> &#123;<br>  <span class="hljs-attribute">color</span>: <span class="hljs-number">#DfA710</span> <span class="hljs-meta">!important</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>其中背景图像 bg.jpg 存放在主题source中的images文件夹内</p><p>初步效果：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200328182253.png" alt="示例效果"></p><h2 id="自定义修改样式"><a href="#自定义修改样式" class="headerlink" title="自定义修改样式"></a>自定义修改样式</h2><blockquote><p>当我们想修改页面的某个地方时，具体该添加哪个样式表呢？</p><p>解决这个问题可以用浏览器的调试工具（一般浏览器<code>F12</code>可以调出），查看感兴趣内容的名称，建立同名css可以覆盖原有样式，例如我要修改侧边栏导航部分的背景颜色</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200328174513.png" alt="查看元素名称"></p><blockquote><p>确定了元素名为 <code>header-inner</code>，在styles.styl中配置相应的css：</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.header-inner</span>&#123;<br><span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>然后，可以明显地看到效果</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200328174723.png" alt="修改效果"></p><blockquote><p>妈耶，赶紧改回来。</p><p>反正就是这么改的啦。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -19- 开启fancybox查看图片大图</title>
    <link href="/2020/03/28/hexo-theme/next/19_next_fancybox/next-fancybox/"/>
    <url>/2020/03/28/hexo-theme/next/19_next_fancybox/next-fancybox/</url>
    
    <content type="html"><![CDATA[<blockquote><p>fancybox插件可以帮助我们查看博客大图，本文介绍Next 7.7.1 主题开启fancybox的方法。</p></blockquote><span id="more"></span><h2 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h2><blockquote><p>开启 fancybox开关即可：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># FancyBox is a tool that offers a nice and elegant way to add zooming functionality for images.</span><br><span class="hljs-comment"># For more information: https://fancyapps.com/fancybox</span><br><span class="hljs-attr">fancybox:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h2 id="示例效果"><a href="#示例效果" class="headerlink" title="示例效果"></a>示例效果</h2><p><img src="https://photos.zywvvd.com/image/20200328005031.png" alt="fancybox示例"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解决Ubuntu循环登陆问题 + Nvidia驱动、Cuda、Cudnn安装</title>
    <link href="/2020/03/27/software/install/nvidia-install/nvidia-install/"/>
    <url>/2020/03/27/software/install/nvidia-install/nvidia-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ubuntu系统显卡驱动偶尔会出现奇怪的问题，造成图形用户界面循环登陆，本文记录相关问题的解决方案。</p></blockquote><span id="more"></span><h3 id="卸载旧驱动"><a href="#卸载旧驱动" class="headerlink" title="卸载旧驱动"></a>卸载旧驱动</h3><ul><li>在登陆界面 ctrl+alt+F2 进入非图形界面控制台，登陆后输入命令：</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get remove nvidia-*<br>sudo apt-get autoremove<br>sudo apt-get purge nvidia*<br></code></pre></td></tr></table></figure><h3 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h3><blockquote><p>加入PPA，然后更新库</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo add-apt-repository ppa:graphics-drivers<br>sudo apt-get update<br></code></pre></td></tr></table></figure><blockquote><p>查看适合本机的nvidia驱动</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ubuntu-drivers devices<br></code></pre></td></tr></table></figure><blockquote><p>选择合适自己的版本</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install nvidia-driver-440 nvidia-settings nvidia-prime<br></code></pre></td></tr></table></figure><blockquote><p>使用nvidia-smi 查看是否已经读取到安装的驱动，如果提示没有找到命令重启后再试</p></blockquote><h3 id="安装Cuda"><a href="#安装Cuda" class="headerlink" title="安装Cuda"></a>安装Cuda</h3><blockquote><p>到Cuda <a href="https://developer.nvidia.com/cuda-downloads">下载地址</a>下载适合自己的Cuda文件，建议下载runfile格式，比如我下载的<code>cuda_10.2.89_440.33.01_linux.run</code>，在文件所在文件夹安装：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo sh cuda_10.2.89_440.33.01_linux.run<br></code></pre></td></tr></table></figure><blockquote><ul><li>accept</li><li>n （不安装驱动）</li><li>y</li><li>y</li><li>y</li></ul></blockquote><blockquote><p>设置环境变量，在~/.bashrc 文件末尾加入：</p></blockquote><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">export LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span><span class="hljs-symbol">:/usr/local/cuda/lib64</span><br>export PATH=<span class="hljs-variable">$PATH</span><span class="hljs-symbol">:/usr/local/cuda/bin</span><br>export CUDA_HOME=<span class="hljs-variable">$CUDA_HOME</span><span class="hljs-symbol">:/usr/local/cuda</span><br></code></pre></td></tr></table></figure><blockquote><p>终端运行：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">source ~/.bashrc<br></code></pre></td></tr></table></figure><blockquote><p>运行：nvcc –version，如果显示类似如下信息说明安装成功</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nvcc</span>: NVIDIA (R) Cuda compiler driver<br><span class="hljs-attribute">Copyright</span> (c) <span class="hljs-number">2005</span>-<span class="hljs-number">2019</span> NVIDIA Corporation<br><span class="hljs-attribute">Built</span> <span class="hljs-literal">on</span> Wed_Oct_<span class="hljs-number">23</span>_<span class="hljs-number">19</span>:<span class="hljs-number">24</span>:<span class="hljs-number">38</span>_PDT_<span class="hljs-number">2019</span><br><span class="hljs-attribute">Cuda</span> compilation tools, release <span class="hljs-number">10</span>.<span class="hljs-number">2</span>, V<span class="hljs-number">10</span>.<span class="hljs-number">2</span>.<span class="hljs-number">89</span><br><br></code></pre></td></tr></table></figure><h3 id="安装Cudnn"><a href="#安装Cudnn" class="headerlink" title="安装Cudnn"></a>安装Cudnn</h3><blockquote><p>到Cudnn<a href="https://developer.nvidia.com/rdp/form/cudnn-download-survey">下载页面</a>下载与驱动、Cuda、需要运行软件要求相应的版本（需要注册Nvidia账号）。</p><p>Ubuntu可以下载<code>.solitairetheme8</code>格式文件，只要将扩展名改为<code>tgz</code>即可解压</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -xvf cudnn-10.2-linux-x64-v7.6.5.32.tgz<br></code></pre></td></tr></table></figure><blockquote><p>得到名为cuda的文件夹，在当前目录（不要进入cuda）运行：</p></blockquote><h4 id="Cudnn-version-lt-8-0"><a href="#Cudnn-version-lt-8-0" class="headerlink" title="Cudnn version &lt; 8.0"></a>Cudnn version &lt; 8.0</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo cp cuda/include/cudnn.h /usr/local/cuda/include/<br>sudo cp cuda/lib64/libcudnn* /usr/local/cuda/lib64/<br>sudo chmod a+r /usr/local/cuda/include/cudnn.h<br>sudo chmod a+r /usr/local/cuda/lib64/libcudnn*<br></code></pre></td></tr></table></figure><blockquote><p>输入<code>cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2</code>可查看版本</p></blockquote><h4 id="Cudnn-version-≥-8-0"><a href="#Cudnn-version-≥-8-0" class="headerlink" title="Cudnn version ≥ 8.0"></a>Cudnn version ≥ 8.0</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo cp cuda/include/* /usr/local/cuda/include/<br>sudo cp cuda/lib64/* /usr/local/cuda/lib64/<br>sudo chmod +x /usr/local/cuda/include/cudnn.h<br>sudo chmod +x /usr/local/cuda/lib64/libcudnn*<br></code></pre></td></tr></table></figure><blockquote><p>输入<code>cat /usr/local/cuda/include/cudnn_version.h | grep CUDNN_MAJOR -A 2</code>可以查看版本</p></blockquote><h3 id="安装测试"><a href="#安装测试" class="headerlink" title="安装测试"></a>安装测试</h3><blockquote><p>查看显卡信息：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nvidia-smi <br></code></pre></td></tr></table></figure><blockquote><p>查看Cuda版本：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nvcc -V<br></code></pre></td></tr></table></figure><blockquote><p>查看Cudnn版本</p></blockquote><p>cudnn version &lt; 8.0</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat /usr/local/cuda/include/cudnn.h | grep CUDNN_MAJOR -A 2<br></code></pre></td></tr></table></figure><p>cudnn version ≥ 8.0</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">cat <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda/i</span>nclude/cudnn_version.h | <span class="hljs-keyword">grep</span> CUDNN_MAJOR -A <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>软件</category>
      
      <category>软件安装</category>
      
      <category>故障排除</category>
      
    </categories>
    
    
    <tags>
      
      <tag>故障排除</tag>
      
      <tag>软件</tag>
      
      <tag>软件安装</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -10- 使用PicGo配合七牛云图床实现Markdown图像无痛管理</title>
    <link href="/2020/03/26/hexo/10_using_picgo/using-picgo/"/>
    <url>/2020/03/26/hexo/10_using_picgo/using-picgo/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 在七牛云图床搭建好的情况下，我们可以有地方存放Markdown中的图像，而且速度很快，不占用Pages的空间，但是生成图像手动上传，名称管理实在是让人头疼。为了让图床管理不再反人类，PicGo应运而生，本文介绍PicGo结合七牛云管理Hexo图片的方法。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>Hexo博客搭建并挂载在服务器</li><li>申请七牛云并搭建好图床，方法参考<a href="https://www.zywvvd.com/2020/03/25/hexo/9_add_image_bed/add-image-bed/">Hexo -9- 添加七牛云图床</a></li></ul><h2 id="工具下载"><a href="#工具下载" class="headerlink" title="工具下载"></a>工具下载</h2><ul><li><p>下载地址： <a href="https://github.com/Molunerfinn/PicGo/releases">https://github.com/Molunerfinn/PicGo/releases</a></p></li><li><p>当前最高版本 2.2.2</p></li><li><p>Windows 下载 <a href="https://github.com/Molunerfinn/PicGo/releases/download/v2.2.2/PicGo-Setup-2.2.2.exe">PicGo-Setup-2.2.2.exe</a></p></li><li><p>Max 下载 <a href="https://github.com/Molunerfinn/PicGo/releases/download/v2.2.2/PicGo-2.2.2-mac.zip">PicGo-2.2.2-mac.zip</a></p></li><li><p>Linux 下载 <a href="https://github.com/Molunerfinn/PicGo/releases/download/v2.2.2/PicGo-2.2.2.AppImage">PicGo-2.2.2.AppImage</a></p></li></ul><h2 id="AppImage"><a href="#AppImage" class="headerlink" title="AppImage"></a>AppImage</h2><blockquote><p>AppImage是个啥？</p><p>资料来源：<a href="https://blog.csdn.net/aboutmn/article/details/87254930">https://blog.csdn.net/aboutmn/article/details/87254930</a></p></blockquote><ul><li><p>AppImage 使用通用的软件格式，通过将整个软件打包成AppImage,一个包包含了所有的功能. 并且几乎可以在所有的linux发行版本中使用。</p></li><li><p>通常我们安装linux软件将会在不同的目录生成多个文件，并且需要root权限来对系统进行修改。</p></li><li><p>AppImage 不需要这么做。事实上，AppImage 并不需要安装。AppImage 是一个压缩的镜像文件，它包含所有运行所需要的依赖和库文件。</p></li><li><p>你可以直接执行AppImage 文件不需要安装。当你把AppImage 文件删除，整个软件也被删除了。你可以把它当成windows系统中的那些免安装的exe文件。</p></li><li><p>优点：</p><ul><li>可以运行在各种平台</li><li>不需要安装，直接执行</li><li>不需要root权限，不需要修改系统文件</li><li>便携性：可以在位置执行</li><li>App 只读</li><li>卸载便利，只需要删除AppImage文件即可</li></ul></li><li><p>使用AppImage 文件</p><ul><li>下载AppImage 文件</li><li>赋予可执行权限</li><li>双击或者在命令行中执行</li></ul></li></ul><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><blockquote><p>在程序中上传剪贴板图片需要用到xclip</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt install xclip <br></code></pre></td></tr></table></figure><h2 id="图床设置"><a href="#图床设置" class="headerlink" title="图床设置"></a>图床设置</h2><ul><li>运行程序，仔细找找，会发现桌面多了个蓝方块，不要慌乱，这就是PicGo</li></ul><p><img src="https://photos.zywvvd.com/image/20200326230922.png" alt="PicGo 迷你形态"></p><ul><li>在方块上右键 -&gt; 打开详细窗口 -&gt; 图床设置 -&gt; 七牛图床</li></ul><p><img src="https://photos.zywvvd.com/image/20200326231131.png" alt="七牛图床设置"></p><ul><li>其中AccessKey在七牛云控制台 -&gt; 头像 -&gt; 个人中心</li></ul><p><img src="https://photos.zywvvd.com/image/20200326231309.png" alt="个人中心"></p><ul><li>密钥管理中SecretKey保管好，这是私钥不宜外传</li></ul><p><img src="https://photos.zywvvd.com/image/20200326231405.png" alt="秘钥管理"></p><ul><li><p>存储空间名称为七牛云空间名称</p></li><li><p>访问网址为七牛云外链域名，我们已经在配置七牛云时设置成了空间加速域名</p></li><li><p>存储区域填写相应代号</p></li></ul><p><img src="https://photos.zywvvd.com/image/20200326231725.png" alt="存储区域代号"></p><ul><li>剩下两项根据个人情况填，但不建议填后缀，毕竟文件后缀都是根据图片改变的</li><li>确定 -&gt; 设置为默认图床，此时图床配置已经成功</li></ul><h2 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h2><blockquote><p>因为我们大多的应用场景是在Markdown中加入图片链接，我们更需要PicGo直接将图片链接编辑为Markdown支持的图片格式，但自带的Markdown格式不包含协议，不带https://，因此我们自己设置。</p></blockquote><ul><li>PicGo设置 -&gt; 自定义链接设置</li></ul><p><img src="https://photos.zywvvd.com/image/20200326232155.png" alt="自定义链接"></p><ul><li>设置格式为<code>![](https://$url)</code></li></ul><p><img src="https://photos.zywvvd.com/image/20200326232244.png" alt="自定义格式"></p><ul><li>同时建议设置成时间戳重命名，保证图片不会重复</li></ul><p><img src="https://photos.zywvvd.com/image/20200326232705.png"></p><ul><li>回到上传区 -&gt; 将链接格式改为 Custom，此后每次上传图片后会复制相应格式的链接到剪贴板</li></ul><p><img src="https://photos.zywvvd.com/image/20200326232447.png" alt="链接格式"></p><ul><li>PicGo设置 -&gt; 修改快捷键，将上传设置成自己的快捷键</li></ul><p><img src="https://photos.zywvvd.com/image/20200326232942.png" alt="快捷键"></p><h2 id="无痛添加图片流程"><a href="#无痛添加图片流程" class="headerlink" title="无痛添加图片流程"></a>无痛添加图片流程</h2><ul><li><p>从此以后我们添加图片的流程为：</p><ul><li>Ctrl+Alt+A 截图 -&gt; 画框 -&gt; 编号 -&gt; 马赛克 -&gt; 写字 -&gt; Enter将图片添加到剪贴板 （还没有这种体验的同学参考<a href="https://www.zywvvd.com/2020/02/24/software/recommend/ubuntu/flameshot/Ubuntu-flameshot/">Ubuntu 软件<strong>推荐</strong> - 截图利器 flameshot-具有快捷键自由截图、截图涂鸦、截图添加文字等功能</a>）</li><li>Ctrl+Shift+Q 上传图片</li><li>Ctrl+V 粘贴链接</li></ul></li></ul><p><strong>舒服 。。。</strong></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -9- 添加七牛云图床</title>
    <link href="/2020/03/25/hexo/9_add_image_bed/add-image-bed/"/>
    <url>/2020/03/25/hexo/9_add_image_bed/add-image-bed/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Hexo 博客挂载在网页服务器上会出现图像加载缓慢、存储空间有限的问题，在各大网络加速运营商提供的图床服务可以有效解决此类问题，由于七牛云服务器物美价廉，还有免费10g空间，本文介绍使用七牛云作为Hexo图床的方法。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>已经准备好了Hexo博客并挂载在某个服务器</li><li>申请<a href="https://www.qiniu.com/">七牛云</a>账号</li><li>申请域名并备案</li></ul><h2 id="创建七牛云空间"><a href="#创建七牛云空间" class="headerlink" title="创建七牛云空间"></a>创建七牛云空间</h2><blockquote><p>创建空间</p></blockquote><p><img src="https://photos.zywvvd.com/20200326000626.png" alt="创建空间"></p><blockquote><p>填写配置信息</p></blockquote><p><img src="https://photos.zywvvd.com/20200326001145.png" alt="配置信息"></p><blockquote><p>创建二级域名，例如我的 ：photos.zywvvd.com ，并申请相应的ssl证书，具体可参考<a href="https://www.zywvvd.com/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/#%E7%94%B3%E8%AF%B7SSL%E5%85%8D%E8%B4%B9%E8%AF%81%E4%B9%A6%EF%BC%88%E8%B2%8C%E4%BC%BC%E5%8F%AF%E9%80%89%EF%BC%89">SSL免费证书申请</a>。</p><p>配置加速域名：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200326001555.png"></p><blockquote><p>信息设置</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200326002037.png" alt="配置其余信息"></p><blockquote><p>图床默认域名设置，将文件管理-&gt; 默认域名设置为我们加速的二级域名：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200326002404.png" alt="默认域名配置"></p><blockquote><p>域名运营商处将空间CNAME添加到加速二级域名的CNAME值中：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200326002718.png" alt="复制CNAME值"></p><p><img src="https://photos.zywvvd.com/image/20200326002829.png" alt="域名设置"></p><blockquote><p>此时七牛云空间CNAME验证成功，图床搭建完毕</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200326002914.png" alt="配置成功"></p><blockquote><p>选择文件管理中的上传图片即可将图像放置到图床管理：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200326003021.png" alt="上传图片"></p><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><blockquote><p>此时查看图片详情获取图像链接，在浏览器输入可以看到相应图像内容：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200326003133.png" alt="图像示例"></p><h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><blockquote><p>图床是博客图片长期管理的重要基石，但手动上传管理图像实在反人类，参考<a href="https://www.zywvvd.com/2020/03/26/hexo/10_using_picgo/using-picgo/">Hexo -10- 使用PicGo配合七牛云图床实现Markdown图像无痛管理</a>有效解决图床图片管理的问题。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -18- 添加代码复制按钮</title>
    <link href="/2020/03/23/hexo-theme/next/18_next_add_codecopy/next_add_codecopy/"/>
    <url>/2020/03/23/hexo-theme/next/18_next_add_codecopy/next_add_codecopy/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍Next 7.7.1 主题添加代码复制按钮的方法。</p></blockquote><span id="more"></span><h2 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h2><blockquote><p>配置copy_button字段：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Add copy button on codeblock</span><br><span class="hljs-attr">copy_button:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># Show text copy result.</span><br>  <span class="hljs-attr">show_result:</span> <span class="hljs-string">default</span><br>  <span class="hljs-comment"># Available values: default | flat | mac</span><br>  <span class="hljs-attr">style:</span><br></code></pre></td></tr></table></figure><blockquote><p>设置 enable 为 true，show_result为default。</p></blockquote><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><img src="/2020/03/23/hexo-theme/next/18_next_add_codecopy/next_add_codecopy/xiaoguo.png" class="" title="配置效果"><blockquote><p>复制成功后按钮会有状态变化提示。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -17- 添加文章版权声明</title>
    <link href="/2020/03/23/hexo-theme/next/17_next_add_copyright/add-copyright/"/>
    <url>/2020/03/23/hexo-theme/next/17_next_add_copyright/add-copyright/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍Next 7.7.1 主题添加版权声明的方法。</p></blockquote><span id="more"></span><h2 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h2><blockquote><p>开启版权需要 license 不为false 并且 post 不为 false，我们在此把 post 设置为 true 就好：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Creative Commons 4.0 International License.</span><br><span class="hljs-comment"># See: https://creativecommons.org/share-your-work/licensing-types-examples</span><br><span class="hljs-comment"># Available values of license: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</span><br><span class="hljs-comment"># You can set a language value if you prefer a translated version of CC license, e.g. deed.zh</span><br><span class="hljs-comment"># CC licenses are available in 39 languages, you can find the specific and correct abbreviation you need on https://creativecommons.org</span><br><span class="hljs-attr">creative_commons:</span><br>  <span class="hljs-attr">license:</span> <span class="hljs-string">by-nc-sa</span><br>  <span class="hljs-attr">sidebar:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">post:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">language:</span>  <br></code></pre></td></tr></table></figure><blockquote><p>尝试通过修改设定更改语言失败了。</p></blockquote><h2 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h2><img src="/2020/03/23/hexo-theme/next/17_next_add_copyright/add-copyright/xiaoguo.png" class="" title="效果示例"><h2 id="进阶升级"><a href="#进阶升级" class="headerlink" title="进阶升级"></a>进阶升级</h2><blockquote><p>如果不想使用英文版只好手动更改源码，将<code>themes/next/layout/_partials/post/post-copyright.swig</code>文件内容替换为：</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;%- set ccIcon = &#x27;<span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-fw fa-creative-commons&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>&#x27; %&#125;<br>&#123;%- set ccText = theme.creative_commons.license | upper %&#125;<br><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-copyright&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-copyright-author&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>本文标题&amp;nbsp:&amp;nbsp&amp;nbsp<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>&#123;&#123; page.title &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>文章作者&amp;nbsp:&amp;nbsp&amp;nbsp<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>&#123;&#123; theme.author &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>发布时间&amp;nbsp:&amp;nbsp&amp;nbsp<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>&#123;&#123; page.date.format(&quot;YYYY年MM月DD日 - HH:mm:ss&quot;) &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>最后更新&amp;nbsp:&amp;nbsp&amp;nbsp<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>&#123;&#123; page.updated.format(&quot;YYYY年MM月DD日 - HH:mm:ss&quot;) &#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>原始链接&amp;nbsp:&amp;nbsp&amp;nbsp<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;&#123; url_for(page.path) &#125;&#125;&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;&#123;&#123; page.title &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; page.permalink &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>许可协议&amp;nbsp:&amp;nbsp&amp;nbsp<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-creative-commons&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;license&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://creativecommons.org/licenses/by-nc-nd/4.0/&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)&quot;</span>&gt;</span>署名-非商业性使用-禁止演绎 4.0 国际<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> 转载请保留原文链接及作者<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>  <br><br>   <span class="hljs-comment">&lt;!-- &lt;strong&gt;&#123;&#123; __(&#x27;post.copyright.author&#x27;) + __(&#x27;symbol.colon&#x27;) &#125;&#125; &lt;/strong&gt;</span><br><span class="hljs-comment">    &#123;&#123;- page.author or author &#125;&#125;</span><br><span class="hljs-comment">  &lt;/li&gt;</span><br><span class="hljs-comment">  &lt;li class=&quot;post-copyright-link&quot;&gt;</span><br><span class="hljs-comment">    &lt;strong&gt;&#123;&#123; __(&#x27;post.copyright.link&#x27;) + __(&#x27;symbol.colon&#x27;) &#125;&#125;&lt;/strong&gt;</span><br><span class="hljs-comment">    &#123;&#123; next_url(page.permalink, page.permalink, &#123;title: page.title&#125;) &#125;&#125;</span><br><span class="hljs-comment">  &lt;/li&gt;</span><br><span class="hljs-comment">  &lt;li class=&quot;post-copyright-license&quot;&gt;</span><br><span class="hljs-comment">    &lt;strong&gt;&#123;&#123; __(&#x27;post.copyright.license_title&#x27;) + __(&#x27;symbol.colon&#x27;) &#125;&#125; &lt;/strong&gt;</span><br><span class="hljs-comment">    &#123;&#123;- __(&#x27;post.copyright.license_content&#x27;, next_url(ccURL, ccIcon + ccText)) &#125;&#125;</span><br><span class="hljs-comment">  &lt;/li&gt;--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="新版效果"><a href="#新版效果" class="headerlink" title="新版效果"></a>新版效果</h3><img src="/2020/03/23/hexo-theme/next/17_next_add_copyright/add-copyright/xiaoguo2.png" class="" title="进阶版效果示例"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -16- 添加搜索功能</title>
    <link href="/2020/03/21/hexo-theme/next/16_next_add_search/next-add-search/"/>
    <url>/2020/03/21/hexo-theme/next/16_next_add_search/next-add-search/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 本文介绍开启 Next 主题站内搜索功能的方法。</p></blockquote><span id="more"></span><h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><blockquote><p>安装插件<code>hexo-generator-searchdb</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-generator-searchdb --save<br></code></pre></td></tr></table></figure><blockquote><p>确定插件安装过程中，没有错误，不然生成站点可能会有搜索框显示问题。</p></blockquote><h3 id="修改站点配置文件"><a href="#修改站点配置文件" class="headerlink" title="修改站点配置文件"></a>修改站点配置文件</h3><blockquote><p>添加内容：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Search </span><br><span class="hljs-attr">search:</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">./public/search.xml</span><br>  <span class="hljs-attr">field:</span> <span class="hljs-string">post</span><br>  <span class="hljs-attr">format:</span> <span class="hljs-string">html</span><br>  <span class="hljs-attr">limit:</span> <span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure><h3 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><blockquote><p>修改主题配置文件，开启站内搜索开关：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Local Search</span><br><span class="hljs-comment"># Dependencies: https://github.com/theme-next/hexo-generator-searchdb</span><br><span class="hljs-attr">local_search:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># If auto, trigger search by changing input.</span><br>  <span class="hljs-comment"># If manual, trigger search by pressing enter key or search button.</span><br>  <span class="hljs-attr">trigger:</span> <span class="hljs-string">auto</span><br>  <span class="hljs-comment"># Show top n results per article, show all results by setting to -1</span><br>  <span class="hljs-attr">top_n_per_article:</span> <span class="hljs-number">7</span><br>  <span class="hljs-comment"># Unescape html strings to the readable one.</span><br>  <span class="hljs-attr">unescape:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-comment"># Preload the search data when the page loads.</span><br>  <span class="hljs-attr">preload:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h3 id="生成站点"><a href="#生成站点" class="headerlink" title="生成站点"></a>生成站点</h3><blockquote><p>生成 hexo 站点，建议先清理public文件夹，避免显示异常的问题：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d<br></code></pre></td></tr></table></figure><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><blockquote><p>成功后可以搜索站内内容：</p></blockquote><img src="/2020/03/21/hexo-theme/next/16_next_add_search/next-add-search/search.png" class="" title="本地搜索"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -15- 增加赞赏功能</title>
    <link href="/2020/03/21/hexo-theme/next/15_add_reward/next-add-reward/"/>
    <url>/2020/03/21/hexo-theme/next/15_add_reward/next-add-reward/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 赞赏啊，是一个博客里的摆设功能。<br> 本文介绍如何在Hexo Next主题中加入赞赏。</p></blockquote><span id="more"></span><h3 id="获取支付码"><a href="#获取支付码" class="headerlink" title="获取支付码"></a>获取支付码</h3><blockquote><p>在微信、支付宝中拿到赞赏码、付款码图片，放入themes/next/source/images文件夹中。</p><p>比如我的是 wechatpay.png和alipay.jpg</p></blockquote><h3 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><blockquote><p>修改主题配置文件：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Reward (Donate)</span><br><span class="hljs-comment"># Front-matter variable (unsupport animation).</span><br><span class="hljs-attr">reward_settings:</span><br>  <span class="hljs-comment"># If true, reward will be displayed in every article by default.</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">animation:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># 开启后鼠标放到图片上文字不停抖动，不建议开启</span><br>  <span class="hljs-attr">comment:</span> <span class="hljs-string">您的支持是我前进的最大动力！</span><br><br><span class="hljs-attr">reward:</span><br>  <span class="hljs-attr">wechatpay:</span> <span class="hljs-string">/images/wechatpay.png</span><br>  <span class="hljs-attr">alipay:</span> <span class="hljs-string">/images/alipay.jpg</span><br>  <span class="hljs-comment">#paypal: /images/paypal.png</span><br>  <span class="hljs-comment">#bitcoin: /images/bitcoin.png</span><br></code></pre></td></tr></table></figure><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><blockquote><p>生成hexo 后，在每篇文章下方都出现了donate按钮，点击会展开：</p></blockquote><img src="/2020/03/21/hexo-theme/next/15_add_reward/next-add-reward/donate.png" class="" title="设置效果"><h3 id="翻译"><a href="#翻译" class="headerlink" title="翻译"></a>翻译</h3><blockquote><p>如果你不喜欢Donate、 Wechat Pay 和 Alipay这样的字眼，可以在 themes/next/languages/zh-Hans.yml 中添加字段进行翻译：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">reward:</span><br>  <span class="hljs-attr">donate:</span> <span class="hljs-string">赏</span><br>  <span class="hljs-attr">wechatpay:</span> <span class="hljs-string">微</span> <span class="hljs-string">信</span><br>  <span class="hljs-attr">alipay:</span> <span class="hljs-string">支付宝</span><br></code></pre></td></tr></table></figure><blockquote><p>翻译后就是现在的效果：</p></blockquote><center>↓↓↓</center><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -8- 生成 sitemap 提交给Google、百度站长</title>
    <link href="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/"/>
    <url>/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 为了成功引起搜索引擎的注意，我们主动生成供其抓取的文件，本文介绍hexo博客创建sitemap的方法。</p></blockquote><span id="more"></span><h2 id="生成Sitemap"><a href="#生成Sitemap" class="headerlink" title="生成Sitemap"></a>生成Sitemap</h2><h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><blockquote><p>安装普通 sitemap 和百度 sitemap 两种：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-generator-sitemap --save<br>npm install hexo-generator-baidu-sitemap --save<br></code></pre></td></tr></table></figure><h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><blockquote><p>修改站点配置文件，加入：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">plugins:</span> <br>  <span class="hljs-string">hexo-generator-baidu-sitemap</span><br>  <span class="hljs-string">hexo-generator-sitemap</span><br><br><span class="hljs-attr">baidusitemap:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">baidusitemap.xml</span><br><span class="hljs-attr">sitemap:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">sitemap.xml</span><br></code></pre></td></tr></table></figure><blockquote><p>确认站点配置中url和root的正确性，站点地图会根据url生成完整的链接</p></blockquote><h4 id="可选操作"><a href="#可选操作" class="headerlink" title="可选操作"></a>可选操作</h4><blockquote><p>修改Next 主题配置文件，打开菜单字段中的站点地图：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">menu:</span><br>  <span class="hljs-attr">sitemap:</span> <span class="hljs-string">/sitemap.xml</span> <span class="hljs-string">||</span> <span class="hljs-string">sitemap</span><br></code></pre></td></tr></table></figure><blockquote><p>修改themes/next/languages/zh-Hans.yml，添加字段：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">menu:</span><br>  <span class="hljs-attr">sitemap:</span> <span class="hljs-string">站点地图</span><br></code></pre></td></tr></table></figure><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/side.png" class="" title="侧边栏站点地图按钮"><h3 id="生成xml文件"><a href="#生成xml文件" class="headerlink" title="生成xml文件"></a>生成xml文件</h3><blockquote><p>生成Hexo站点，会在public文件夹中创建baidusitemap.xml 和 sitemap.xml文件</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/sitemap.png" class="" title="sitemap文件"><blockquote><p> 在浏览器中输入 <a href="https://www.zywvvd.com/sitemap.xml">https://www.zywvvd.com/sitemap.xml</a> 和 <a href="https://www.zywvvd.com/baidusitemap.xml">https://www.zywvvd.com/baidusitemap.xml</a> 已经可以看到自己的站点地图了。</p></blockquote><h2 id="提交Google站长"><a href="#提交Google站长" class="headerlink" title="提交Google站长"></a>提交Google站长</h2><blockquote><p>有了sitemap比没有要更容易被收录，但是相比于主动提交给搜索引擎效率就差很多了，因此我们将生成的map先提交给google</p></blockquote><h3 id="查看站点是否被google收录"><a href="#查看站点是否被google收录" class="headerlink" title="查看站点是否被google收录"></a>查看站点是否被google收录</h3><blockquote><p>google搜索site:域名即可：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/googlesite.png" class="" title="查询谷歌收录情况"><h3 id="添加网址"><a href="#添加网址" class="headerlink" title="添加网址"></a>添加网址</h3><blockquote><p> 进入<a href="https://www.google.com/webmasters">Google Search Console</a>，用谷歌账号登录，此时需要选择添加搜索的网址类型，我们申请的域名一般都是域级别的，比如我的 zywvvd.com ，可以建立不同前缀的二级域名，因此我们选择<code>网域</code>：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/googleyanzheng.png" class="" title="添加网域"><blockquote><p> 为防止恶意使用该功能，需要验证网域所有权，默认方式通过DNS验证，我们就用这种方法：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/googleyz.png" class="" title="DNS验证"><blockquote><p>将google提供的TXT添加到域名的@解析当中：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/baiduyz.png" class="" title="添加TXT字段"><blockquote><p>等一会点击验证即可通过：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/chenggong.png" class="" title="完成验证"><h3 id="添加站点地图"><a href="#添加站点地图" class="headerlink" title="添加站点地图"></a>添加站点地图</h3><blockquote><p>选择带前缀的地址 ：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/www.png" class="" title="选择地址"><blockquote><p>选择站点地图，并添加刚刚生成的sitemap.xml即可</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/zd.png" class="" title="站点地图"><blockquote><p>可以看到站点地图解析成功：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/googlechenggong.png" class="" title="添加成功"><h2 id="提交百度站长"><a href="#提交百度站长" class="headerlink" title="提交百度站长"></a>提交百度站长</h2><blockquote><p>国内还是百度最好用了，我们也把地图给百度站长。</p><p>参考：<a href="https://zhuanlan.zhihu.com/p/100922816">https://zhuanlan.zhihu.com/p/100922816</a></p></blockquote><h3 id="查看网站是否被收录"><a href="#查看网站是否被收录" class="headerlink" title="查看网站是否被收录"></a>查看网站是否被收录</h3><blockquote><p>百度搜索 site: 域名可以查看</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/sousuo.png" class="" title="是否收录"><h3 id="添加网址-1"><a href="#添加网址-1" class="headerlink" title="添加网址"></a>添加网址</h3><blockquote><p>百度提交<a href="https://ziyuan.baidu.com/site/index">网址入口</a>，用百度账号登录后，还是添加网站的过程</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/tianjiabd.png" class="" title="百度添加网站"><blockquote><p>补充个人信息后，来到第一步输入网站，建议为www前缀：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/bdwangzhan.png" class="" title="录入网站"><blockquote><p>第二步根据个人情况填写信息，每个月只能改一次，确定就好；</p><p>第三步选择我们已经熟悉的CNAME验证，根据给定的前缀建立解析，类型CNAME，值填 ziyuan.baidu.com</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/bdcname.png" class="" title="百度CNAME验证"><blockquote><p>点击验证即可：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/bdchenggong.png" class="" title="百度验证成功"><h3 id="提交百度搜索的不同方式"><a href="#提交百度搜索的不同方式" class="headerlink" title="提交百度搜索的不同方式"></a>提交百度搜索的不同方式</h3><blockquote><p>百度提供了自动提交和手动提交两种方式，其中自动提交又分为主动推送、自动推送和 sitemap 三种方式，以下是官方给出的解释：</p></blockquote><ul><li>主动推送：最为快速的提交方式，推荐您将站点当天新产出链接立即通过此方式推送给百度，以保证新链接可以及时被百度收录</li><li>自动推送：是轻量级链接提交组件，将自动推送的 JS 代码放置在站点每一个页面源代码中，当页面被访问时，页面链接会自动推送给百度，有利于新页面更快被百度发现</li><li>sitemap：您可以定期将网站链接放到sitemap中，然后将sitemap提交给百度。百度会周期性的抓取检查您提交的sitemap，对其中的链接进行处理，但收录速度慢于主动推送</li><li>手动提交：如果您不想通过程序提交，那么可以采用此种方式，手动将链接提交给百度</li></ul><blockquote><p>四种提交方式对比：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/zh.jpg" class="" title="提交方式对比"><h3 id="主动推送"><a href="#主动推送" class="headerlink" title="主动推送"></a>主动推送</h3><h4 id="安装插件-1"><a href="#安装插件-1" class="headerlink" title="安装插件"></a>安装插件</h4><blockquote><p>安装插件：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-baidu-url-submit --save<br></code></pre></td></tr></table></figure><h4 id="配置站点配置文件"><a href="#配置站点配置文件" class="headerlink" title="配置站点配置文件"></a>配置站点配置文件</h4><blockquote><p>向站点配置文件加入：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><br><span class="hljs-attr">baidu_url_submit:</span><br>  <span class="hljs-attr">count:</span> <span class="hljs-number">1</span>              <span class="hljs-comment"># 提交最新的多少个链接</span><br>  <span class="hljs-attr">host:</span> <span class="hljs-string">www.zywvvd.com</span>    <span class="hljs-comment"># 在百度站长平台中添加的域名</span><br>  <span class="hljs-attr">token:</span> <span class="hljs-string">YQlkVp*******</span>      <span class="hljs-comment"># 秘钥</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">baidu_urls.txt</span>   <span class="hljs-comment"># 文本文档的地址， 新链接会保存在此文本文档里</span><br></code></pre></td></tr></table></figure><blockquote><p>其中的 token 可以在【链接提交】-【自动提交】-【主动推送】下面看到，接口调用地址最后面 token=xxxxx 即为你的 token</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/token.png" class="" title="token"><blockquote><p>加入新的deployer：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Deployment</span><br><span class="hljs-comment">## Docs: https://hexo.io/docs/deployment.html</span><br><span class="hljs-attr">deploy:</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">git@github.com:zywvvd/zywvvd.github.io.git</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">baidu_url_submitter</span>  <br></code></pre></td></tr></table></figure><h4 id="推送网址"><a href="#推送网址" class="headerlink" title="推送网址"></a>推送网址</h4><blockquote><p>此后每次hexo d都会将最新的1条网址推送给百度，而且成功时会有标识：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#123;&quot;remain&quot;:2997,&quot;success&quot;:1&#125;<br></code></pre></td></tr></table></figure><blockquote><p>表示成功推送一条，今天还能推2997条。</p></blockquote><h3 id="自动推送"><a href="#自动推送" class="headerlink" title="自动推送"></a>自动推送</h3><blockquote><p>在网站中加入如下代码：</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;% <span class="hljs-keyword">if</span> theme.baidu_push %&#125;<br>&lt;script&gt;<br>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">var</span> bp = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;script&#x27;</span>);<br>    <span class="hljs-keyword">var</span> curProtocol = <span class="hljs-built_in">window</span>.location.protocol.split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> (curProtocol === <span class="hljs-string">&#x27;https&#x27;</span>) &#123;<br>        bp.src = <span class="hljs-string">&#x27;https://zz.bdstatic.com/linksubmit/push.js&#x27;</span>;        <br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        bp.src = <span class="hljs-string">&#x27;http://push.zhanzhang.baidu.com/push.js&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">var</span> s = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">&quot;script&quot;</span>)[<span class="hljs-number">0</span>];<br>    s.parentNode.insertBefore(bp, s);<br>&#125;)();<br>&lt;/script&gt;<br>&#123;% endif %&#125;<br></code></pre></td></tr></table></figure><blockquote><p>这段代码在Next主题中已经集成，在 7.7.1中，代码位于 themes/next/layout/_third-party/baidu-push.swig文件中，仅需修改主题配置文件即可：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO.</span><br><span class="hljs-attr">baidu_push:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="提交Sitemap"><a href="#提交Sitemap" class="headerlink" title="提交Sitemap"></a>提交Sitemap</h3><blockquote><p>选择搜索服务的链接提交：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/ljtj.png" class="" title="链接提交"><blockquote><p>在自动提交- sitemap 中添加我们的sitemap链接即可：</p></blockquote><img src="/2020/03/21/hexo/8_hexo_generate_sitemap/generate-sitemap/bdst.png" class="" title="sitemap提交"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -14- 为Hexo Next7.7.1 添加RSS （带按钮）</title>
    <link href="/2020/03/20/hexo-theme/next/14_add_rss/next-add-rss/"/>
    <url>/2020/03/20/hexo-theme/next/14_add_rss/next-add-rss/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Next 7.7 将RSS按钮的代码删掉了，按照以往添加RSS的方法设置后可以生成xml文件，但没有按钮。本文介绍在Next 7.7 添加带按钮的RSS方法。</p></blockquote><span id="more"></span><h2 id="添加RSS"><a href="#添加RSS" class="headerlink" title="添加RSS"></a>添加RSS</h2><h3 id="安装插件-hexo-generator-feed"><a href="#安装插件-hexo-generator-feed" class="headerlink" title="安装插件 hexo-generator-feed"></a>安装插件 hexo-generator-feed</h3><blockquote><p>在hexo 目录运行命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-generator-feed --save<br></code></pre></td></tr></table></figure><h3 id="配置站点配置文件"><a href="#配置站点配置文件" class="headerlink" title="配置站点配置文件"></a>配置<code>站点配置文件</code></h3><blockquote><p>在站点配置文件添加：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yml"><br><span class="hljs-attr">plugins:</span> <span class="hljs-string">hexo-generate-feed</span><br><br><span class="hljs-comment"># rss配置</span><br><span class="hljs-attr">feed:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">atom</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">atom.xml</span><br>  <span class="hljs-attr">limit:</span> <span class="hljs-number">20</span><br>  <span class="hljs-attr">hub:</span><br>  <span class="hljs-attr">content:</span><br>  <span class="hljs-attr">content_limit:</span> <span class="hljs-number">140</span><br>  <span class="hljs-attr">content_limit_delim:</span> <span class="hljs-string">&#x27; &#x27;</span><br>  <span class="hljs-attr">order_by:</span> <span class="hljs-string">-date</span><br><br></code></pre></td></tr></table></figure><h3 id="配置Next主题配置文件"><a href="#配置Next主题配置文件" class="headerlink" title="配置Next主题配置文件"></a>配置Next<code>主题配置文件</code></h3><blockquote><p>主题配置文件默认没有rss字段，需要自己手动添加</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Set rss to false to disable feed link.</span><br><span class="hljs-comment"># Leave rss as blank to use site&#x27;s feed link, and install hexo-generator-feed: `npm install hexo-generator-feed --save`.</span><br><span class="hljs-comment"># Set rss to specific value if you have burned your feed already.</span><br><span class="hljs-attr">rss:</span> <span class="hljs-string">/atom.xml</span><br></code></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>此时运行hexo g已经可以看到</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">INFO  Generated: atom.xml<br></code></pre></td></tr></table></figure><blockquote><p>事实上已经配置成功</p><p>但是侧边栏没有RSS按钮</p></blockquote><h2 id="在侧边栏添加RSS按钮"><a href="#在侧边栏添加RSS按钮" class="headerlink" title="在侧边栏添加RSS按钮"></a>在侧边栏添加RSS按钮</h2><blockquote><p>在Hexo/themes/next/layout/_partials/sidebar文件夹，打开site-overview.swig文件</p><p>在<code>- if theme.site_state </code>前加入代码：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml">&#123;<span class="hljs-string">%</span> <span class="hljs-string">if</span> <span class="hljs-string">theme.rss</span> <span class="hljs-string">%</span>&#125;<br>   <span class="hljs-string">&lt;div</span> <span class="hljs-string">class=&quot;feed-link</span> <span class="hljs-string">motion-element&quot;&gt;</span><br>     <span class="hljs-string">&lt;a</span> <span class="hljs-string">href=&quot;&#123;&#123;</span> <span class="hljs-string">url_for(theme.rss)</span> <span class="hljs-string">&#125;&#125;&quot;</span> <span class="hljs-string">rel=&quot;alternate&quot;&gt;</span><br>       <span class="hljs-string">&lt;i</span> <span class="hljs-string">class=&quot;fa</span> <span class="hljs-string">fa-rss&quot;&gt;&lt;/i&gt;</span><br>       <span class="hljs-string">RSS</span><br>     <span class="hljs-string">&lt;/a&gt;</span><br>   <span class="hljs-string">&lt;/div&gt;</span><br> &#123;<span class="hljs-string">%</span> <span class="hljs-string">endif</span> <span class="hljs-string">%</span>&#125;<br><br></code></pre></td></tr></table></figure><blockquote><p>执行hexo g &amp;&amp; hexo s 即可查看效果</p></blockquote><img src="/2020/03/20/hexo-theme/next/14_add_rss/next-add-rss/xg.png" class="" title="效果示例"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -7- Github源七牛云CDN加速教程（详细）</title>
    <link href="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/"/>
    <url>/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Hexo使用Github Pages时存在加载缓慢的问题，国内很多CDN平台可以为网站提供加速服务，由于偶然的原因选择了<a href="https://portal.qiniu.com/">七牛云</a>，可以免费生成SSL证书，http协议免费10g流量。但是网上相关教程并不友好，花了好多时间终于成功，在此将过程记录下来供后人参考。</p></blockquote><span id="more"></span><h2 id="需求描述"><a href="#需求描述" class="headerlink" title="需求描述"></a>需求描述</h2><blockquote><p>我的当前情况和需求：</p></blockquote><ul><li>已经申请了域名 zywvvd.com</li><li>服务器为国外的Github</li><li>正在使用Github分发的二级域名 zywvvd.github.io</li><li>已经将Hexo挂载到 <a href="http://www.zywvvd.com/">www.zywvvd.com</a></li><li><strong>需要</strong> : 七牛云CDN加速站点，使得用户访问 <a href="http://www.zywvvd.com/">www.zywvvd.com</a> 时速度快，而且顺利转到我的Hexo主页</li></ul><h2 id="CDN-Content-Delivery-Network-加速原理"><a href="#CDN-Content-Delivery-Network-加速原理" class="headerlink" title="CDN(Content Delivery Network)加速原理"></a>CDN(Content Delivery Network)加速原理</h2><blockquote><p>访问Github Pages缓慢的原因</p></blockquote><ul><li>服务器在国外，数据交互困难</li><li>客观因素无法改变，但是我们还是要求国内访问要快</li></ul><blockquote><p>CDN 原理</p></blockquote><ul><li>国内建立多个用于缓存静态页面的服务器</li><li>建立缓存区指向国外的站点，将其缓存到到国内的服务器</li><li>生成指向国内缓存的CANME（IP地址的别名）</li><li>将要加速的域名解析到上述CANME上，实现该域名访问时的加速</li></ul><h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><ul><li><p>测速网站1 ：<a href="http://www.webkaka.com/Ping.aspx">http://www.webkaka.com/Ping.aspx</a></p></li><li><p>测速网站2：<a href="https://www.17ce.com/">https://www.17ce.com/</a></p></li><li><p>教程1：<a href="%5Bhttps://geek-space.cn/post/hexo-qiniu.html#%E4%B8%8B%E9%9D%A2%E5%B0%B1%E6%98%AF%E6%95%99%E7%A8%8B%E4%BA%86%EF%BC%88%E8%BF%99%E9%87%8C%E5%81%87%E8%AE%BE%E6%82%A8%E5%B7%B2%E7%BB%8F%E6%8E%8C%E6%8F%A1%E4%BA%86%E5%BB%BA%E7%AB%99%E7%9A%84%E6%8A%80%E6%9C%AF%EF%BC%89%5D(https://geek-space.cn/post/hexo-qiniu.html#%E4%B8%8B%E9%9D%A2%E5%B0%B1%E6%98%AF%E6%95%99%E7%A8%8B%E4%BA%86%EF%BC%88%E8%BF%99%E9%87%8C%E5%81%87%E8%AE%BE%E6%82%A8%E5%B7%B2%E7%BB%8F%E6%8E%8C%E6%8F%A1%E4%BA%86%E5%BB%BA%E7%AB%99%E7%9A%84%E6%8A%80%E6%9C%AF%EF%BC%89)">Hexo 开启 CDN 加速访问</a></p></li><li><p>教程2：<a href="https://www.zhyong.cn/posts/ddf2/">Hexo+Next 使用 CDN 加速网站以及静态文件</a></p></li><li><p>教程3：<a href="https://blog.csdn.net/zydarChen/article/details/89584937">使用CDN加速你的博客</a></p></li></ul><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>Hexo建站成功并挂载在互联网</li><li>已经申请并备案自己的域名并成功绑定Hexo站点</li><li>申请<a href="https://portal.qiniu.com/">七牛云</a>账号</li></ul><h2 id="加速教程"><a href="#加速教程" class="headerlink" title="加速教程"></a>加速教程</h2><blockquote><p>正片开始</p></blockquote><h3 id="重新解析站点到其他二级域名"><a href="#重新解析站点到其他二级域名" class="headerlink" title="重新解析站点到其他二级域名"></a>重新解析站点到其他二级域名</h3><blockquote><p>这里的其他是相对与前缀<code>www</code>来说的。</p><p>是这样的，因为我想来访者通过域名 <a href="http://www.zywvvd.com/">www.zywvvd.com</a> 访问我的站点，也就是说这是我需要加速的域名，不能再把这个域名直接解析到我们的Hexo站点了，但是还是需要有一个二级域名指向他，因此需要将Hexo站点绑定到其他二级域名，我用的是 <a href="https://zzz.zywvvd.com/">https://zzz.zywvvd.com/</a></p></blockquote><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/cname.png" class="" title="源站CNAME设置"><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/jiexi.png" class="" title="添加新的二级域名解析"><blockquote><p>此时可以通过 <a href="https://zzz.zywvvd.com/">https://zzz.zywvvd.com/</a> 访问我的站点，但仍是原来的龟速</p></blockquote><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/before.png" class="" title="加速前"><h3 id="申请SSL免费证书（貌似可选）"><a href="#申请SSL免费证书（貌似可选）" class="headerlink" title="申请SSL免费证书（貌似可选）"></a>申请SSL免费证书（貌似可选）</h3><blockquote><p>SSL证书用于域名支持https协议，七牛云在http协议下每月提供10g免费流量，但是我不开启https就无法访问站点，所以申请了证书，需要每月流量费用0.28元/GB，对我来说一个月几块钱足够了。</p><p>建议提前申请证书，开通域名加速后再申请会提示不支持www开头的域名，但是直接申请可以发放。</p></blockquote><ul><li>进入七牛云控制台，选择SSL证书服务：</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/ssl.png" class="" title="SSL证书服务"><ul><li>购买证书（别慌，免费的）</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/goumai.png" class="" title="购买证书"><ul><li>选择TrustAsia DV 域名型</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/hedui.png" class="" title="选择域名类型"><ul><li>点击核对信息并支付，确认支付即可</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/queren.png" class="" title="核对支付"><ul><li>点击补全信息，填入站点域名、备注、企业和个人信息（信息仅用于此次注册）</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/buquan.png" class="" title="补全信息"><ul><li>提交后需要DNS验证，在一级域名出建立指定的二级域名，记录类型设置为TXT，主机记录填入指定值，一会就会验证成功</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/dnsyz.png" class="" title="DNS验证"><ul><li>等待一会就签发成功啦</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/qianfa.png" class="" title="签发SSL证书"><h3 id="在Hexo添加测试文件"><a href="#在Hexo添加测试文件" class="headerlink" title="在Hexo添加测试文件"></a>在Hexo添加测试文件</h3><ul><li>所谓的测试文件就是随便一个小文件，放在Hexo/source文件夹下</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/test.png" class="" title="测试文件"><ul><li>hexo g ，hexo d 后可以访问 zywvvd.github.io/test.html 查看</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/fangwentest.png" class="" title="访问测试文件"><h3 id="添加CDN加速域名"><a href="#添加CDN加速域名" class="headerlink" title="添加CDN加速域名"></a>添加CDN加速域名</h3><ul><li>七牛云控制台，CDN，选择域名管理，添加域名</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/tianjia.png" class="" title="添加域名"><ul><li>选择 普通域名 填写你要加速的域名（需要备案） 选择通信协议 https（我用http失败了）</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/yumingshezhi.png" class="" title="填入信息"><ul><li><font color=red size=6 face='微软雅黑'>重点！！！</font></li></ul><blockquote><p>覆盖范围：按照个人需求设置</p><p>使用场景：动态加速</p><p>源站配置：源站填github分发的二级域名</p><p>回源Host：填之前我们移动的二级域名，比如我的是 zzz.zywvvd.com/ </p><p>源站测试：填入刚刚的test.html，点击测试</p></blockquote><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/yuanzhan.png" class="" title="源站配置"><ul><li>其他根据个人需求配置，没特殊要求默认即可，等待一会即提示成功建立加速域名</li></ul><h3 id="添加七牛云CNAME解析"><a href="#添加七牛云CNAME解析" class="headerlink" title="添加七牛云CNAME解析"></a>添加七牛云CNAME解析</h3><ul><li>此时配置刚刚建立的域名，会提示你需要配置CNAME</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/tishi.png" class="" title="提示"><ul><li>返回域名管理，复制CNAME</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/cn.png" class="" title="复制CNAME"><ul><li>在域名商处添加加速前缀的二级域名，解析到上述CNAME</li></ul><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/jie.png" class="" title="配置CNAME"><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>此时我们已经完成了：</p></blockquote><ul><li>加速域名 → 七牛云CNAME → 备用二级域名 → Gtihub二级域名 → 站点服务器</li></ul><blockquote><p>可以用dig 命令测试 ，见到七牛云的CNAME解析就可以了:</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dig www.zywvvd.com<br></code></pre></td></tr></table></figure><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/dig.png" class="" title="dig测试"><blockquote><p>最实在的当然还是测速了</p></blockquote><img src="/2020/03/19/hexo/7_hexo_speed_up/hexo-speed-up/after.png" class="" title="网速测试"><blockquote><p>舒服。。。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -13- 修复由于添加live2D造成的不蒜子统计失效</title>
    <link href="/2020/03/09/hexo-theme/next/13_busuanzi_fix_for_live2d/next-busuanzi-fix-live2d/"/>
    <url>/2020/03/09/hexo-theme/next/13_busuanzi_fix_for_live2d/next-busuanzi-fix-live2d/</url>
    
    <content type="html"><![CDATA[<blockquote><p> 使用nextV7.7.1 主题时，在hexo中添加live2D看板娘后next原生自带的不蒜子统计会失效，本文介绍该问题的修复方法。</p></blockquote><span id="more"></span><h2 id="问题复现"><a href="#问题复现" class="headerlink" title="问题复现"></a>问题复现</h2><blockquote><p>开启next 主题中不蒜子统计：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Show Views / Visitors of the website / page with busuanzi.</span><br><span class="hljs-comment"># Get more information on http://ibruce.info/2015/04/04/busuanzi</span><br><span class="hljs-attr">busuanzi_count:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_visitors:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_visitors_icon:</span> <span class="hljs-string">user</span><br>  <span class="hljs-attr">total_views:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_views_icon:</span> <span class="hljs-string">eye</span><br>  <span class="hljs-attr">post_views:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">post_views_icon:</span> <span class="hljs-string">eye</span><br></code></pre></td></tr></table></figure><blockquote><p>安装live2d插件：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save hexo-helper-live2d<br></code></pre></td></tr></table></figure><blockquote><p>问题出现：</p></blockquote><img src="/2020/03/09/hexo-theme/next/13_busuanzi_fix_for_live2d/next-busuanzi-fix-live2d/bug.png" class="" title="问题复现"><h2 id="修复bug"><a href="#修复bug" class="headerlink" title="修复bug"></a>修复bug</h2><h3 id="方法1-卸载livd2d"><a href="#方法1-卸载livd2d" class="headerlink" title="方法1. 卸载livd2d"></a>方法1. 卸载livd2d</h3><blockquote><p>卸载live2d可以解决问题:</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm uninstall --save hexo-helper-live2d<br></code></pre></td></tr></table></figure><img src="/2020/03/09/hexo-theme/next/13_busuanzi_fix_for_live2d/next-busuanzi-fix-live2d/fix1.png" class="" title="方法1"><h3 id="方法2-手动重新添加不蒜子"><a href="#方法2-手动重新添加不蒜子" class="headerlink" title="方法2. 手动重新添加不蒜子"></a>方法2. 手动重新添加不蒜子</h3><blockquote><p>看板娘怎么可以卸载？？？？？ 绝对不能接受！！！</p></blockquote><ul><li>关闭next原生不蒜子</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Show Views / Visitors of the website / page with busuanzi.</span><br><span class="hljs-comment"># Get more information on http://ibruce.info/2015/04/04/busuanzi</span><br><span class="hljs-attr">busuanzi_count:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">total_visitors:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_visitors_icon:</span> <span class="hljs-string">user</span><br>  <span class="hljs-attr">total_views:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_views_icon:</span> <span class="hljs-string">eye</span><br>  <span class="hljs-attr">post_views:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">post_views_icon:</span> <span class="hljs-string">eye</span><br></code></pre></td></tr></table></figure><h4 id="修复主页总数统计"><a href="#修复主页总数统计" class="headerlink" title="修复主页总数统计"></a>修复主页总数统计</h4><ul><li>在<code>Hexo根目录</code>/themes/next/layout/_partials/文件夹中修改 footer.swig，在最后一行前加入代码：</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta-item-icon&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-group&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>总访客&amp;nbsp<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;busuanzi_value_site_uv&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>&amp;nbsp人<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta-divider&quot;</span>&gt;</span>|<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;post-meta-item-icon&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-eye&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>访问总量&amp;nbsp<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>&amp;nbsp次<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <br>&#123;&#123;- next_inject(&#x27;footer&#x27;) &#125;&#125;<br></code></pre></td></tr></table></figure><blockquote><p>效果：</p></blockquote><img src="/2020/03/09/hexo-theme/next/13_busuanzi_fix_for_live2d/next-busuanzi-fix-live2d/fix2.png" class="" title="修复主页总数统计"><h4 id="修复文章统计"><a href="#修复文章统计" class="headerlink" title="修复文章统计"></a>修复文章统计</h4><blockquote><p>可以通过开启 <code>主题配置文件</code> - valine 评论中的 <code>visitor</code> 开关来替代不蒜子的统计功能。</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">valine:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-attr">visitor:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Article reading statistic</span><br></code></pre></td></tr></table></figure><blockquote><p>开启valine方法参考<a href="http://localhost:4000/zywvvd.github.io/2020/02/28/next/6_add_valine_comments/add-valine-comments/">Next -6- 添加Valine评论系统</a></p></blockquote><img src="/2020/03/09/hexo-theme/next/13_busuanzi_fix_for_live2d/next-busuanzi-fix-live2d/fix3.png" class="" title="修复文章统计"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -6- FontAwesome 4.7.0 中完整的675个图标样式CSS参考</title>
    <link href="/2020/03/09/hexo/6_hexo_icons/hexo-icons/"/>
    <url>/2020/03/09/hexo/6_hexo_icons/hexo-icons/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Hexo 支持FontAwesome图标，就是在代码中出现名字以<code>fa fa</code>开头的类名，本文介绍具具体图标来源和使用方法。</p></blockquote><span id="more"></span><h2 id="图标列表"><a href="#图标列表" class="headerlink" title="图标列表"></a>图标列表</h2><blockquote><p><a href="https://9iphp.com/fa-icons">官方链接</a></p></blockquote><h3 id="New-Icons-in-4-7"><a href="#New-Icons-in-4-7" class="headerlink" title="New Icons in 4.7"></a>New Icons in 4.7</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/1.png" class="" title="New-Icons-in-4.7"><h3 id="Web-Application-Icons"><a href="#Web-Application-Icons" class="headerlink" title="Web Application Icons"></a>Web Application Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/2.png" class="" title="Web-Application-Icons"><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/3.png" class="" title="Web-Application-Icons"><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/4.png" class="" title="Web-Application-Icons"><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/5.png" class="" title="Web-Application-Icons"><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/6.png" class="" title="Web-Application-Icons"><h3 id="Accessibility-Icons"><a href="#Accessibility-Icons" class="headerlink" title="Accessibility Icons"></a>Accessibility Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/7.png" class="" title="Accessibility-Icons"><h3 id="Hand-Icons"><a href="#Hand-Icons" class="headerlink" title="Hand Icons"></a>Hand Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/8.png" class="" title="Hand-Icons"><h3 id="Transportation-Icons"><a href="#Transportation-Icons" class="headerlink" title="Transportation Icons"></a>Transportation Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/9.png" class="" title="Transportation-Icons"><h3 id="Gender-Icons"><a href="#Gender-Icons" class="headerlink" title="Gender Icons"></a>Gender Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/10.png" class="" title="Gender-Icons"><h3 id="File-Type-Icons"><a href="#File-Type-Icons" class="headerlink" title="File Type Icons"></a>File Type Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/11.png" class="" title="File-Type-Icons"><h3 id="Spinner-Icons"><a href="#Spinner-Icons" class="headerlink" title="Spinner Icons"></a>Spinner Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/12.png" class="" title="Spinner-Icons"><h3 id="Form-Control-Icons"><a href="#Form-Control-Icons" class="headerlink" title="Form Control Icons"></a>Form Control Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/13.png" class="" title="Form-Control-Icons"><h3 id="Payment-Icons"><a href="#Payment-Icons" class="headerlink" title="Payment Icons"></a>Payment Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/14.png" class="" title="Payment-Icons"><h3 id="Chart-Icons"><a href="#Chart-Icons" class="headerlink" title="Chart Icons"></a>Chart Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/15.png" class="" title="Chart-Icons"><h3 id="Currency-Icons"><a href="#Currency-Icons" class="headerlink" title="Currency Icons"></a>Currency Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/16.png" class="" title="Currency-Icons"><h3 id="Text-Editor-Icons"><a href="#Text-Editor-Icons" class="headerlink" title="Text Editor Icons"></a>Text Editor Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/17.png" class="" title="Text-Editor-Icons"><h3 id="Directional-Icons"><a href="#Directional-Icons" class="headerlink" title="Directional Icons"></a>Directional Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/18.png" class="" title="Directional-Icons"><h3 id="Video-Player-Icons"><a href="#Video-Player-Icons" class="headerlink" title="Video Player Icons"></a>Video Player Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/19.png" class="" title="Video-Player-Icons"><h3 id="Brand-Icons"><a href="#Brand-Icons" class="headerlink" title="Brand Icons"></a>Brand Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/20.png" class="" title="Brand-Icons"><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/21.png" class="" title="Brand-Icons"><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/22.png" class="" title="Brand-Icons"><h3 id="Medical-Icons"><a href="#Medical-Icons" class="headerlink" title="Medical Icons"></a>Medical Icons</h3><img src="/2020/03/09/hexo/6_hexo_icons/hexo-icons/23.png" class="" title="Medical-Icons"><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><blockquote><p>首先引入CSS文件：<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"></p><p>在Hexo中不需要手动引入，可以直接使用。</p><p>用</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-XXXX&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>输出图标<br>比如在hexo文章中添加代码</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-home&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></td></tr></table></figure><p><span class="fa fa-home"></span></p><blockquote><p> 可输出 <code>家</code> 图标</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -5- 添加 live2d 看板动画</title>
    <link href="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/"/>
    <url>/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/</url>
    
    <content type="html"><![CDATA[<blockquote><p>live2d是一种应用于电子游戏的绘图渲染技术，技术由日本Cybernoids公司开发。通过一系列的连续图像和人物建模来生成一种类似三维模型的二维图像。 在Hexo中生成可以与用户互动的卡通人物，简直就是博客的灵魂所在。本文介绍live2d 看板动画添加方法。</p></blockquote><span id="more"></span><h2 id="安装-hexo-helper-live2d"><a href="#安装-hexo-helper-live2d" class="headerlink" title="安装 hexo-helper-live2d"></a>安装 hexo-helper-live2d</h2><blockquote><p>官网链接 <a href="https://github.com/EYHN/hexo-helper-live2d/blob/HEAD/README.zh-CN.md">hexo-helper-live2d Github 官方链接</a></p><p>安装时需要在 Hexo 工程目录下输入命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save hexo-helper-live2d<br></code></pre></td></tr></table></figure><h2 id="挑选喜欢的模型"><a href="#挑选喜欢的模型" class="headerlink" title="挑选喜欢的模型"></a>挑选喜欢的模型</h2><blockquote><p>基础的live2d模型有很多，挑选你喜欢的记录下他的名字：</p></blockquote><h3 id="chitose"><a href="#chitose" class="headerlink" title="chitose"></a>chitose</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/chitose.png" class="" title="chitose"><h3 id="epsilon2-1"><a href="#epsilon2-1" class="headerlink" title="epsilon2_1"></a>epsilon2_1</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/epsilon2_1.png" class="" title="epsilon2_1"><h3 id="gf"><a href="#gf" class="headerlink" title="gf"></a>gf</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/gf.png" class="" title="gf"><h3 id="haru-01"><a href="#haru-01" class="headerlink" title="haru/01"></a>haru/01</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/haru01.png" class="" title="haru-01"><h3 id="haru-02"><a href="#haru-02" class="headerlink" title="haru/02"></a>haru/02</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/haru02.png" class="" title="haru-02"><h3 id="haruto"><a href="#haruto" class="headerlink" title="haruto"></a>haruto</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/haruto.png" class="" title="haruto"><h3 id="hibiki"><a href="#hibiki" class="headerlink" title="hibiki"></a>hibiki</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/hibiki.png" class="" title="hibiki"><h3 id="hijiki"><a href="#hijiki" class="headerlink" title="hijiki"></a>hijiki</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/hijiki.png" class="" title="hijiki"><h3 id="izumi"><a href="#izumi" class="headerlink" title="izumi"></a>izumi</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/izumi.png" class="" title="izumi"><h3 id="koharu"><a href="#koharu" class="headerlink" title="koharu"></a>koharu</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/koharu.png" class="" title="koharu"><h3 id="miku"><a href="#miku" class="headerlink" title="miku"></a>miku</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/miku.png" class="" title="miku"><h3 id="nico"><a href="#nico" class="headerlink" title="nico"></a>nico</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/nico.png" class="" title="nico"><h3 id="nietzsche"><a href="#nietzsche" class="headerlink" title="nietzsche"></a>nietzsche</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/nietzsche.png" class="" title="nietzsche"><h3 id="ni-j"><a href="#ni-j" class="headerlink" title="ni-j"></a>ni-j</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/ni-j.png" class="" title="ni-j"><h3 id="nipsilon"><a href="#nipsilon" class="headerlink" title="nipsilon"></a>nipsilon</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/nipsilon.png" class="" title="nipsilon"><h3 id="nito"><a href="#nito" class="headerlink" title="nito"></a>nito</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/nito.png" class="" title="nito"><h3 id="shizuku"><a href="#shizuku" class="headerlink" title="shizuku"></a>shizuku</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/shizuku.png" class="" title="shizuku"><h3 id="tororo"><a href="#tororo" class="headerlink" title="tororo"></a>tororo</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/tororo.png" class="" title="tororo"><h3 id="tsumiki"><a href="#tsumiki" class="headerlink" title="tsumiki"></a>tsumiki</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/tsumiki.png" class="" title="tsumiki"><h3 id="unitychan"><a href="#unitychan" class="headerlink" title="unitychan"></a>unitychan</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/unitychan.png" class="" title="unitychan"><h3 id="wanko"><a href="#wanko" class="headerlink" title="wanko"></a>wanko</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/wanko.png" class="" title="wanko"><h3 id="z16"><a href="#z16" class="headerlink" title="z16"></a>z16</h3><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/z16.png" class="" title="z16"><h2 id="模型下载"><a href="#模型下载" class="headerlink" title="模型下载"></a>模型下载</h2><h3 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h3><blockquote><p>在hexo目录中输入命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save live2d-widget-model-`模型名字`<br></code></pre></td></tr></table></figure><blockquote><p> 此时在<code>hexo根目录</code>/node_modules/ 文件夹中增加 ‘ live2d-widget-model-<code>模型名字</code> ‘ 文件夹</p></blockquote><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/new_dir.png" class="" title="新增文件夹"><h3 id="github下载"><a href="#github下载" class="headerlink" title="github下载"></a>github下载</h3><blockquote><p>上述列表模型<a href="https://github.com/xiazeyu/live2d-widget-models"> github地址 </a> </p><p>新模型 <a href="https://github.com/summerscar/live2dDemo">gtihub地址</a></p><p>可以下载模型放在<code>hexo根目录</code>/node_modules/ 文件夹中，以达到命令行安装的效果</p></blockquote><h2 id="模型应用配置"><a href="#模型应用配置" class="headerlink" title="模型应用配置"></a>模型应用配置</h2><blockquote><p>在<code>站点配置文件</code>中加入配置信息：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">live2d:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">scriptFrom:</span> <span class="hljs-string">local</span><br>  <span class="hljs-attr">pluginRootPath:</span> <span class="hljs-string">live2dw/</span><br>  <span class="hljs-attr">pluginJsPath:</span> <span class="hljs-string">lib/</span><br>  <span class="hljs-attr">pluginModelPath:</span> <span class="hljs-string">assets/</span><br>  <span class="hljs-attr">tagMode:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">log:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">model:</span><br>    <span class="hljs-attr">use:</span> <span class="hljs-string">live2d-widget-model-&lt;模型名字&gt;</span><br>  <span class="hljs-attr">display:</span><br>    <span class="hljs-attr">position:</span> <span class="hljs-string">right</span>  <span class="hljs-comment"># left</span><br>    <span class="hljs-attr">width:</span> <span class="hljs-number">220</span><br>    <span class="hljs-attr">height:</span> <span class="hljs-number">440</span><br>  <span class="hljs-attr">mobile:</span><br>    <span class="hljs-attr">show:</span> <span class="hljs-literal">true</span>   <span class="hljs-comment">#是否在手机进行显示</span><br>  <span class="hljs-attr">react:</span><br>    <span class="hljs-attr">opacity:</span> <span class="hljs-number">0.7</span><br><br></code></pre></td></tr></table></figure><h2 id="haru"><a href="#haru" class="headerlink" title="haru"></a>haru</h2><blockquote><p>haru 和其他模型有些不同，haru包中包含 01 / 02 两个模型，在使用时模型名字为：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">model:</span><br>  <span class="hljs-attr">use:</span> <span class="hljs-string">live2d-widget-model-haru/01</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">model:</span><br>  <span class="hljs-attr">use:</span> <span class="hljs-string">live2d-widget-model-haru/02</span><br></code></pre></td></tr></table></figure><blockquote><p>此时模型仍然无法正确加载，因为<code>hexo根目录</code>/node_modules/live2d-widget-model-haru/01/或02/ 中的json文件是空的，所以需要把<code>hexo根目录</code>/node_modules/live2d-widget-model-haru/中的json文件复制到01/或02/文件夹中。</p></blockquote><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><blockquote><p>输入命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean &amp;&amp; hexo g &amp;&amp; hexo s<br></code></pre></td></tr></table></figure><blockquote><p>在<code>http://127.0.0.1:4000/</code>查看测试结果 (示例为z16)</p></blockquote><img src="/2020/03/09/hexo/5_hexo_add_live2d/add-live2d/test.png" class="" title="示例效果"><h2 id="加强版（可以说话、互动）"><a href="#加强版（可以说话、互动）" class="headerlink" title="加强版（可以说话、互动）"></a>加强版（可以说话、互动）</h2><blockquote><p><a href="https://github.com/stevenjoezhang/live2d-widget">优化版live2d-widget</a></p></blockquote><blockquote><p>具体方法参考</p><p><a href="https://blog.csdn.net/weixin_34235371/article/details/91468588">https://blog.csdn.net/weixin_34235371/article/details/91468588</a></p><p> <a href="https://blog.csdn.net/cungudafa/article/details/104282643#_47">https://blog.csdn.net/cungudafa/article/details/104282643#_47</a></p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -12- 渲染markdown数学公式</title>
    <link href="/2020/03/09/hexo-theme/next/12_add_formular/next-add-formular/"/>
    <url>/2020/03/09/hexo-theme/next/12_add_formular/next-add-formular/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Hexo next主题默认的markdown渲染引擎不会渲染数学公式，V7.7主题提供了渲染公式的方法，下面介绍如何使用该功能。</p></blockquote><span id="more"></span><h2 id="示例公式内容"><a href="#示例公式内容" class="headerlink" title="示例公式内容"></a>示例公式内容</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">$$<br><span class="hljs-code">Precision=\frac&#123;TP&#125;&#123;TP+FP&#125;</span><br><span class="hljs-code">$$</span><br></code></pre></td></tr></table></figure><h2 id="默认渲染效果"><a href="#默认渲染效果" class="headerlink" title="默认渲染效果"></a>默认渲染效果</h2><img src="/2020/03/09/hexo-theme/next/12_add_formular/next-add-formular/moren.png" class="" title="默认渲染"><h2 id="开启公式渲染的方法"><a href="#开启公式渲染的方法" class="headerlink" title="开启公式渲染的方法"></a>开启公式渲染的方法</h2><h3 id="在-Next-主题中开启-MathJax-开关"><a href="#在-Next-主题中开启-MathJax-开关" class="headerlink" title="在 Next 主题中开启 MathJax 开关"></a>在 Next 主题中开启 MathJax 开关</h3><blockquote><p>编辑next<code>主题配置文件</code>，将MathJax 开关改为<code>True</code></p></blockquote><img src="/2020/03/09/hexo-theme/next/12_add_formular/next-add-formular/math.png" class="" title="编辑主题配置文件"><h3 id="修改文章Front-matter"><a href="#修改文章Front-matter" class="headerlink" title="修改文章Front-matter"></a>修改文章Front-matter</h3><blockquote><p>在想要添加公式文章的<code>Front-matter</code>中添加<code>mathjax: true</code>即可</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">title: test<span class="hljs-emphasis">_title</span><br><span class="hljs-emphasis">date: 2020-02-27 16:41:16</span><br><span class="hljs-emphasis">tags: [test_</span>tag]<br>categories: [test<span class="hljs-emphasis">_cate]</span><br><span class="hljs-emphasis">mathjax: true</span><br></code></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><blockquote><p>再次写入示例公式代码，即可正常渲染。</p></blockquote><p>$$<br>Precision=\frac{TP}{TP+FP}<br>$$</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -11- 为文章添加阅读进度</title>
    <link href="/2020/03/09/hexo-theme/next/11_article_percentage/article-percentage/"/>
    <url>/2020/03/09/hexo-theme/next/11_article_percentage/article-percentage/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Next可以在文章中添加当前阅读进度的百分比或颜色进度条，本文介绍功能开启方法。</p></blockquote><span id="more"></span><h2 id="阅读进度百分比"><a href="#阅读进度百分比" class="headerlink" title="阅读进度百分比"></a>阅读进度百分比</h2><blockquote><p>修改<code>主题配置文件</code>，修改<code>back2top</code>：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">back2top:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启 back to top 按钮</span><br>  <span class="hljs-comment"># Back to top in sidebar.</span><br>  <span class="hljs-attr">sidebar:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># true 表示在侧边栏显示，false则在侧下角</span><br>  <span class="hljs-comment"># Scroll percent label in b2t button.</span><br>  <span class="hljs-attr">scrollpercent:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启进度百分比</span><br></code></pre></td></tr></table></figure><blockquote><p>效果：</p></blockquote><img src="/2020/03/09/hexo-theme/next/11_article_percentage/article-percentage/percentage.png" class="" title="进度百分比"><h2 id="颜色进度条"><a href="#颜色进度条" class="headerlink" title="颜色进度条"></a>颜色进度条</h2><blockquote><p>修改<code>主题配置文件</code>，修改<code>reading_progress</code>：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Reading progress bar</span><br><span class="hljs-attr">reading_progress:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 开启进度条</span><br>  <span class="hljs-comment"># Available values: top | bottom</span><br>  <span class="hljs-attr">position:</span> <span class="hljs-string">bottom</span> <span class="hljs-comment"># 设置位置 可以为  top | bottom</span><br>  <span class="hljs-attr">color:</span> <span class="hljs-string">&quot;#37c6c0&quot;</span> <span class="hljs-comment"># 进度条颜色 16进制RGB</span><br>  <span class="hljs-attr">height:</span> <span class="hljs-string">3px</span> <span class="hljs-comment"># 高度</span><br><br></code></pre></td></tr></table></figure><blockquote><p>效果：</p></blockquote><img src="/2020/03/09/hexo-theme/next/11_article_percentage/article-percentage/processbar.png" class="" title="颜色进度条"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -10- 页面右上角添加Fork me on github按钮</title>
    <link href="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/"/>
    <url>/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍Hexo博客Next主题在页面右上角（或者左上角）添加“Fork me on github”按钮。</p></blockquote><span id="more"></span><h2 id="选择按钮样式"><a href="#选择按钮样式" class="headerlink" title="选择按钮样式"></a>选择按钮样式</h2><blockquote><p>在 <a href="http://tholman.com/github-corners/">GitHub Corners</a> 或 <a href="https://github.blog/2008-12-19-github-ribbons/">GitHub Ribbons</a> 选择自己喜欢的按钮样式并复制代码，将href换成自己的链接。</p></blockquote><h3 id="Corners"><a href="#Corners" class="headerlink" title="Corners"></a>Corners</h3><blockquote><p>假设选择了这一款</p></blockquote><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/corner.png" class="" title="Corners"><blockquote><p>代码：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swig">&lt;a href=&quot;https://your-url&quot; class=&quot;github-corner&quot; aria-label=&quot;View source on GitHub&quot;&gt;&lt;svg width=&quot;80&quot; height=&quot;80&quot; viewBox=&quot;0 0 250 250&quot; style=&quot;fill:#FD6C6C; color:#fff; position: absolute; top: 0; border: 0; right: 0;&quot; aria-hidden=&quot;true&quot;&gt;&lt;path d=&quot;M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2&quot; fill=&quot;currentColor&quot; style=&quot;transform-origin: 130px 106px;&quot; class=&quot;octo-arm&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z&quot; fill=&quot;currentColor&quot; class=&quot;octo-body&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;style&gt;.github-corner:hover .octo-arm&#123;animation:octocat-wave 560ms ease-in-out&#125;@keyframes octocat-wave&#123;0%,100%&#123;transform:rotate(0)&#125;20%,60%&#123;transform:rotate(-25deg)&#125;40%,80%&#123;transform:rotate(10deg)&#125;&#125;@media (max-width:500px)&#123;.github-corner:hover .octo-arm&#123;animation:none&#125;.github-corner .octo-arm&#123;animation:octocat-wave 560ms ease-in-out&#125;&#125;&lt;/style&gt;<br></code></pre></td></tr></table></figure><blockquote><p>替换链接，主要修改：<code>href=&quot;https://your-url&quot;</code></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swig">&lt;a href=&quot;https://github.com/zywvvd&quot; class=&quot;github-corner&quot; aria-label=&quot;View source on GitHub&quot;&gt;&lt;svg width=&quot;80&quot; height=&quot;80&quot; viewBox=&quot;0 0 250 250&quot; style=&quot;fill:#FD6C6C; color:#fff; position: absolute; top: 0; border: 0; right: 0;&quot; aria-hidden=&quot;true&quot;&gt;&lt;path d=&quot;M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2&quot; fill=&quot;currentColor&quot; style=&quot;transform-origin: 130px 106px;&quot; class=&quot;octo-arm&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z&quot; fill=&quot;currentColor&quot; class=&quot;octo-body&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;style&gt;.github-corner:hover .octo-arm&#123;animation:octocat-wave 560ms ease-in-out&#125;@keyframes octocat-wave&#123;0%,100%&#123;transform:rotate(0)&#125;20%,60%&#123;transform:rotate(-25deg)&#125;40%,80%&#123;transform:rotate(10deg)&#125;&#125;@media (max-width:500px)&#123;.github-corner:hover .octo-arm&#123;animation:none&#125;.github-corner .octo-arm&#123;animation:octocat-wave 560ms ease-in-out&#125;&#125;&lt;/style&gt;<br></code></pre></td></tr></table></figure><h3 id="Ribbons"><a href="#Ribbons" class="headerlink" title="Ribbons"></a>Ribbons</h3><blockquote><p>假设选择了这一款</p></blockquote><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/ribbin.png" class="" title="Ribbons"><blockquote><p>代码：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swig">&lt;a href=&quot;https://github.com/you&quot;&gt;&lt;img width=&quot;149&quot; height=&quot;149&quot; src=&quot;https://github.blog/wp-content/uploads/2008/12/forkme_right_green_007200.png?resize=149%2C149&quot; class=&quot;attachment-full size-full&quot; alt=&quot;Fork me on GitHub&quot; data-recalc-dims=&quot;1&quot;&gt;&lt;/a&gt;<br></code></pre></td></tr></table></figure><blockquote><p>替换链接，修改<code>href=&quot;https://github.com/you&quot;</code>为自己的链接；</p><p>现有代码直接使用会出问题，需要在img标签中加入 <code>style=&quot;position:absolute; right:-2px; top:2px;</code>“</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs swig">&lt;a href=&quot;https://github.com/zywvvd&quot; &gt;<br>    &lt;img width=&quot;149&quot; height=&quot;149&quot;  style=&quot;position:absolute; right:-2px; top:2px;&quot; src=&quot;https://github.blog/wp-content/uploads/2008/12/forkme_right_green_007200.png?resize=149%2C149&quot; class=&quot;attachment-full size-full&quot; alt=&quot;Fork me on GitHub&quot; data-recalc-dims=&quot;1&quot;&gt;<br>    &lt;/a&gt;<br></code></pre></td></tr></table></figure><h2 id="代码加入工程"><a href="#代码加入工程" class="headerlink" title="代码加入工程"></a>代码加入工程</h2><blockquote><p>将改好的代码粘贴到<code>themes/next/layout/_layout.swig</code>文件中<code>&lt;div class=&quot;headband&quot;&gt;&lt;/div&gt;</code>下面一行：</p></blockquote><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/layout.png" class="" title="_layout.swig文件"><blockquote><p>Coners</p></blockquote><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/daima1.png" class="" title="Coners代码"><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/shili1.png" class="" title="Coners效果"><blockquote><p>Ribbons</p></blockquote><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/daima2.png" class="" title="Ribbons代码"><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/shili2.png" class="" title="Ribbons效果"><h2 id="同时应用Coners和Ribbons"><a href="#同时应用Coners和Ribbons" class="headerlink" title="同时应用Coners和Ribbons"></a>同时应用Coners和Ribbons</h2><blockquote><p>向_layout.png中加入两段代码，修改图片颜色：</p></blockquote><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/daima3.png" class="" title="两段代码"><blockquote><p>效果：</p></blockquote><img src="/2020/02/29/hexo-theme/next/10_fork_me_on_github/fork-me-on-github/shili3.png" class="" title="同时应用效果"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -9- 添加头像</title>
    <link href="/2020/02/28/hexo-theme/next/9_add_avatar/add-avatar/"/>
    <url>/2020/02/28/hexo-theme/next/9_add_avatar/add-avatar/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍Next主题添加头像的方法。</p></blockquote><span id="more"></span><h2 id="头像文件"><a href="#头像文件" class="headerlink" title="头像文件"></a>头像文件</h2><blockquote><p>把准备好的头像图片放在<code>/next/source/images/</code>文件夹内。</p></blockquote><img src="/2020/02/28/hexo-theme/next/9_add_avatar/add-avatar/avatar.png" class="" title="头像图片"><h2 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h2><blockquote><p>修改<code>avatar.url</code>：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Sidebar Avatar</span><br><span class="hljs-attr">avatar:</span><br>  <span class="hljs-comment"># Replace the default image and set the url here.</span><br>  <span class="hljs-attr">url:</span> <span class="hljs-string">/images/avatar.jpg</span><br>  <span class="hljs-comment"># If true, the avatar will be dispalyed in circle.</span><br>  <span class="hljs-attr">rounded:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-comment"># If true, the avatar will be rotated with the cursor.</span><br>  <span class="hljs-attr">rotated:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><img src="/2020/02/28/hexo-theme/next/9_add_avatar/add-avatar/xiaoguo.png" class="" title="主页效果"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -8- 修改文章模板</title>
    <link href="/2020/02/28/hexo-theme/next/8_change_model_of_post/change-model-of-post/"/>
    <url>/2020/02/28/hexo-theme/next/8_change_model_of_post/change-model-of-post/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Next文章内容会是丰富多彩的，但是要素主要为：标题、日期、标签、类别、摘要、more标签和正文，每次创建文章都需要创建这些内容过于繁琐而且容易出错，将相关内容加入到模板可以规范格式、省去重复劳动并且避免错误。</p></blockquote><span id="more"></span><h2 id="修改方法"><a href="#修改方法" class="headerlink" title="修改方法"></a>修改方法</h2><blockquote><p>hexo在新建文章时会默认套用<code>/hexo_root/scaffolds/post.md</code>模板，默认为：</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">---<br>title: &#123;&#123; title &#125;&#125;<br>date: &#123;&#123; date &#125;&#125;<br><span class="hljs-section">tags:</span><br><span class="hljs-section">---</span><br></code></pre></td></tr></table></figure><blockquote><p>将其修改为你需要的模式：</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown">---<br>title: &#123;&#123; title &#125;&#125;<br>date: &#123;&#123; date &#125;&#125;<br>tags:<br><span class="hljs-section">categories:</span><br><span class="hljs-section">---</span><br><br><span class="hljs-section">## 概述</span><br><br><span class="hljs-quote">&gt; 本文。</span><br><br>&lt;!--more--&gt;<br><br><span class="hljs-section">## 正文</span><br><br></code></pre></td></tr></table></figure><h2 id="新建文章"><a href="#新建文章" class="headerlink" title="新建文章"></a>新建文章</h2><blockquote><p>新建文章就是模板的形式了：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new test_post<br></code></pre></td></tr></table></figure><img src="/2020/02/28/hexo-theme/next/8_change_model_of_post/change-model-of-post/model.png" class="" title="模板文章"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -7- 为文章在主页添加“阅读更多”</title>
    <link href="/2020/02/28/hexo-theme/next/7_read_more/read-more/"/>
    <url>/2020/02/28/hexo-theme/next/7_read_more/read-more/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Hexo的主页会显示博客文章，但是每篇文章都显示全文会影响文章展示的效果。</p><p>本篇介绍为文章在主页设置摘要的方法。</p></blockquote><span id="more"></span><h2 id="Next标签（推荐）"><a href="#Next标签（推荐）" class="headerlink" title="Next标签（推荐）"></a>Next标签（推荐）</h2><blockquote><p>Markdown中的注释</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">&lt;!--more--&gt;<br></code></pre></td></tr></table></figure><blockquote><p>本身对文档没有影响，但在Next中会被识别为摘要截断的标志。标志之后的内容不会在首页显示。</p><p>而且会生成一个<code>阅读全文</code>的按钮。</p><p>这种方法被Next官方推荐，因为它在满足需求的同时也可以让Hexo中的插件识别。</p></blockquote><img src="/2020/02/28/hexo-theme/next/7_read_more/read-more/comment.png" class="" title="文中添加more注释"><blockquote><p>实际效果</p></blockquote><img src="/2020/02/28/hexo-theme/next/7_read_more/read-more/xiaoguo1.png" class="" title="阅读全文"><h2 id="自动形成摘要"><a href="#自动形成摘要" class="headerlink" title="自动形成摘要"></a>自动形成摘要</h2><blockquote><p>在<code>主题配置文件</code>中添加：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">auto_excerpt:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">length:</span> <span class="hljs-number">150</span><br></code></pre></td></tr></table></figure><p>默认截取的长度为 150 字符，可以根据需要自行设定。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -6- 添加Valine评论系统</title>
    <link href="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/"/>
    <url>/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Next V7.7.1 自带很多评论系统，其中Valine诞生于2017年8月7日，是一款基于Leancloud的快速、简洁且高效的无后端评论系统。Valine具有添加方便，轻量，运行、加载速度快，不需要用户登录等优点。</p><p>本文介绍Next中添加Valine评论系统的方法。</p></blockquote><span id="more"></span><h2 id="依赖leancloud"><a href="#依赖leancloud" class="headerlink" title="依赖leancloud"></a>依赖leancloud</h2><ul><li>申请leancloud账号，<a href="https://www.leancloud.cn/">官网链接</a>。</li><li>登录leancloud，进入控制台点击创建应用。</li></ul><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/chuangjianyingyong.png" class="" title="创建应用"><ul><li>填写应用名称，选择开发版</li></ul><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/chuangjian.png" class="" title="创建应用"><ul><li>创建成功后点击应用右上角的<code>齿轮</code>进入应用设置</li></ul><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/chilun.png" class="" title="创建设置"><ul><li>设置选项卡中选择<code>应用 Keys</code>，右边AppID和AppKey就是我们需要的标识和密钥。</li></ul><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/keys.png" class="" title="应用 Keys"><h2 id="本地设置"><a href="#本地设置" class="headerlink" title="本地设置"></a>本地设置</h2><blockquote><p>在Next<code>主题配置文件</code>中修改valine字段内的值，将enable设置为true，将刚刚得到的AppID和AppKey填入相应字段中。</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Valine</span><br><span class="hljs-comment"># For more information: https://valine.js.org, https://github.com/xCss/Valine</span><br><span class="hljs-attr">valine:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">appid:</span> <span class="hljs-string">XXXXXXXXXXX&lt;</span> <span class="hljs-string">your</span> <span class="hljs-string">AppID&gt;XXXXXXXXXXXX</span> <span class="hljs-comment"># Your leancloud application appid</span><br>  <span class="hljs-attr">appkey:</span> <span class="hljs-string">XXXXXX&lt;your</span> <span class="hljs-string">AppKey&gt;XXXXXXX</span> <span class="hljs-comment"># Your leancloud application appkey</span><br>  <span class="hljs-attr">notify:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Mail notifier</span><br>  <span class="hljs-attr">verify:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Verification code</span><br>  <span class="hljs-attr">placeholder:</span> <span class="hljs-string">遗憾莫过于难忘你的背影，却找不到你来过的痕迹</span> <span class="hljs-string">...</span> <span class="hljs-comment"># Comment box placeholder</span><br>  <span class="hljs-attr">avatar:</span> <span class="hljs-string">mm</span> <span class="hljs-comment"># Gravatar style</span><br>  <span class="hljs-attr">guest_info:</span> <span class="hljs-string">nick,mail,link</span> <span class="hljs-comment"># Custom comment header</span><br>  <span class="hljs-attr">pageSize:</span> <span class="hljs-number">10</span> <span class="hljs-comment"># Pagination size</span><br>  <span class="hljs-attr">language:</span> <span class="hljs-comment"># Language, available values: en, zh-cn</span><br>  <span class="hljs-attr">visitor:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># Article reading statistic</span><br>  <span class="hljs-attr">comment_count:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># If false, comment count will only be displayed in post page, not in home page</span><br>  <span class="hljs-attr">recordIP:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># Whether to record the commenter IP</span><br>  <span class="hljs-attr">serverURLs:</span> <span class="hljs-comment"># When the custom domain name is enabled, fill it in here (it will be detected automatically by default, no need to fill in)</span><br>  <span class="hljs-comment">#post_meta_order: 0</span><br></code></pre></td></tr></table></figure><blockquote><p>修改enable和AppID、AppKey之后：</p></blockquote><ul><li>notify：评论后的邮件提示，还需要在leancloud中设置邮件模板自动回复</li></ul><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml">你在</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">appname</span>&#125;&#125;</span><span class="xml"> 的评论收到了新的回复</span><br><span class="xml"></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hi, </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">username</span>&#125;&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">你在 </span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">appname</span>&#125;&#125;</span><span class="xml"> 的评论收到了新的回复，请点击查看：</span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;你的网址首页链接&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: inline-block; padding: 10px 20px; border-radius: 4px; background-color: #3090e4; color: #fff; text-decoration: none;&quot;</span>&gt;</span>马上查看<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br></code></pre></td></tr></table></figure><ul><li>verify：评论时需要验证码</li><li>placeholder：占位符，就是在没有评论时默认的提示文字</li><li>visitor：标题和首页显示浏览量(与不蒜子的会重复，可以选择一个保留)</li></ul><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><blockquote><p>Next V7.7.1 已经集成了相关程序包，不需要额外安装，只要填入AppID和AppKey就好，否则容易出现各种奇怪的问题（别问我怎么知道的）</p></blockquote><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/valine.png" class="" title="评论测试"><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/post.png" class="" title="评论统计"><h2 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a>数据安全</h2><blockquote><p>可选操作：在【Leancloud】 -&gt; 【设置】 -&gt; 【安全中心】 -&gt; 【Web 安全域名】把你的域名加进去，可防止数据被篡改。</p></blockquote><h2 id="标题Valine字段翻译"><a href="#标题Valine字段翻译" class="headerlink" title="标题Valine字段翻译"></a>标题Valine字段翻译</h2><blockquote><p>这个字段生成过程和其他不一样，定义的变量在post下的comments下的valine，修改zh-Hans.yml</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">post:</span><br>  <span class="hljs-attr">comments:</span><br>    <span class="hljs-attr">valine:</span> <span class="hljs-string">评论次数</span> <br></code></pre></td></tr></table></figure><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/fanyi.png" class="" title="Valine翻译"><h2 id="源码踪迹"><a href="#源码踪迹" class="headerlink" title="源码踪迹"></a>源码踪迹</h2><blockquote><p>相关的Valine评论数生成的源文件是<code>themes -&gt; next -&gt; scripts -&gt; filters -&gt; comment -&gt; valine.js</code></p></blockquote><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/valinejs.png" class="" title="valine.js"><blockquote><p>该函数在同文件夹下的<code>common.js</code>文件内</p></blockquote><img src="/2020/02/28/hexo-theme/next/6_add_valine_comments/add-valine-comments/commonjs.png" class="" title="common.js"><blockquote><p>因此在zh-Hans.yml中定义post.comments.valine 变量的翻译字段</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -5- 设定站点建立时间</title>
    <link href="/2020/02/28/hexo-theme/next/5_settings/next-settings/"/>
    <url>/2020/02/28/hexo-theme/next/5_settings/next-settings/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Hexo博客Next主题的站点建立时间主要体现在页脚的 <code>© 2020</code> ，如果不修改会设置为当前年份。本文介绍该年份设置方法。</p></blockquote><span id="more"></span><h2 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h2><blockquote><p>在<code>主题配置文件</code>中修改footer字段的since：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">footer:</span><br>  <span class="hljs-comment"># Specify the date when the site was setup. If not defined, current year will be used.</span><br>  <span class="hljs-attr">since:</span> <span class="hljs-number">2019</span><br></code></pre></td></tr></table></figure><img src="/2020/02/28/hexo-theme/next/5_settings/next-settings/since.png" class="" title="效果展示"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -4- 增加站点访客、文章阅读量、字符统计、阅读时间统计与对应词条翻译</title>
    <link href="/2020/02/28/hexo-theme/next/4_add_viewers/viewers/"/>
    <url>/2020/02/28/hexo-theme/next/4_add_viewers/viewers/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍增加Next主题文章阅读数量和访客数量的方法。</p></blockquote><span id="more"></span><h2 id="不蒜子站点访客、文章阅读量"><a href="#不蒜子站点访客、文章阅读量" class="headerlink" title="不蒜子站点访客、文章阅读量"></a>不蒜子站点访客、文章阅读量</h2><blockquote><p>修改<code>主题配置文件</code>不蒜子<code>enable</code>的开关为<code>true</code>：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Show Views / Visitors of the website / page with busuanzi.</span><br><span class="hljs-comment"># Get more information on http://ibruce.info/2015/04/04/busuanzi</span><br><span class="hljs-attr">busuanzi_count:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_visitors:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_visitors_icon:</span> <span class="hljs-string">user</span><br>  <span class="hljs-attr">total_views:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">total_views_icon:</span> <span class="hljs-string">eye</span><br>  <span class="hljs-attr">post_views:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">post_views_icon:</span> <span class="hljs-string">eye</span><br></code></pre></td></tr></table></figure><img src="/2020/02/28/hexo-theme/next/4_add_viewers/viewers/post.png" class="" title="文章阅读数"><img src="/2020/02/28/hexo-theme/next/4_add_viewers/viewers/footer.png" class="" title="访客与阅读总量"><h3 id="统计失效时的调整方法"><a href="#统计失效时的调整方法" class="headerlink" title="统计失效时的调整方法"></a>统计失效时的调整方法</h3><blockquote><p>有时数据统计会失效，此时删除hexo根目录的<code>db.json</code>，执行命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean<br>hexo g<br></code></pre></td></tr></table></figure><h2 id="字符统计、阅读时间统计"><a href="#字符统计、阅读时间统计" class="headerlink" title="字符统计、阅读时间统计"></a>字符统计、阅读时间统计</h2><blockquote><p>启用 hexo-symbols-count-time ，官方<a href="https://github.com/theme-next/hexo-symbols-count-time">Github链接</a>，执行命令：</p></blockquote><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">npm install hexo-symbols-<span class="hljs-built_in">count</span>-<span class="hljs-built_in">time</span><br></code></pre></td></tr></table></figure><blockquote><p>在<code>站点配置文件</code>加入：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">symbols_count_time:</span><br>  <span class="hljs-attr">symbols:</span> <span class="hljs-literal">true</span>                <span class="hljs-comment"># 文章字数统计</span><br>  <span class="hljs-attr">time:</span> <span class="hljs-literal">true</span>                   <span class="hljs-comment"># 文章阅读时长</span><br>  <span class="hljs-attr">total_symbols:</span> <span class="hljs-literal">true</span>          <span class="hljs-comment"># 站点总字数统计</span><br>  <span class="hljs-attr">total_time:</span> <span class="hljs-literal">true</span>             <span class="hljs-comment"># 站点总阅读时长</span><br>  <span class="hljs-attr">exclude_codeblock:</span> <span class="hljs-literal">false</span>     <span class="hljs-comment"># 排除代码字数统计</span><br></code></pre></td></tr></table></figure><blockquote><p>可以调整<code>主题配置文件</code>：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Post wordcount display settings</span><br><span class="hljs-comment"># Dependencies: https://github.com/theme-next/hexo-symbols-count-time</span><br><span class="hljs-attr">symbols_count_time:</span><br>  <span class="hljs-attr">separated_meta:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 是否换行显示 字数统计 及 阅读时长</span><br>  <span class="hljs-attr">item_text_post:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># 文章 字数统计 阅读时长 使用图标 还是 文本表示</span><br>  <span class="hljs-attr">item_text_total:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 博客底部统计 字数统计 阅读时长 使用图标 还是 文本表示</span><br>  <span class="hljs-attr">awl:</span> <span class="hljs-number">4</span><br>  <span class="hljs-attr">wpm:</span> <span class="hljs-number">275</span><br></code></pre></td></tr></table></figure><img src="/2020/02/28/hexo-theme/next/4_add_viewers/viewers/words.png" class="" title="字符统计、阅读时间"><h2 id="对应词条翻译"><a href="#对应词条翻译" class="headerlink" title="对应词条翻译"></a>对应词条翻译</h2><blockquote><p>对上述词条翻译找了好久，终于摸索出来了，在此贡献给大家，在zh-Hans.yml中加入：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">post:</span><br>  <span class="hljs-attr">views:</span> <span class="hljs-string">阅读次数</span><br><span class="hljs-attr">symbols_count_time:</span><br>  <span class="hljs-attr">time:</span> <span class="hljs-string">阅读时长</span><br>  <span class="hljs-attr">count:</span> <span class="hljs-string">本文字数</span><br>  <span class="hljs-attr">count_total:</span> <span class="hljs-string">站点总字数</span><br>  <span class="hljs-attr">time_total:</span> <span class="hljs-string">站点阅读时长</span><br></code></pre></td></tr></table></figure><img src="/2020/02/28/hexo-theme/next/4_add_viewers/viewers/header-zh.png" class="" title="post翻译"><img src="/2020/02/28/hexo-theme/next/4_add_viewers/viewers/footer-zh.png" class="" title="footer翻译"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -3- 将页面英文标识翻译为中文</title>
    <link href="/2020/02/28/hexo-theme/next/3_translate/translate/"/>
    <url>/2020/02/28/hexo-theme/next/3_translate/translate/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Next默认界面中菜单、文章信息、站点信息名称为英文，本文介绍将这些英文翻译为中文的方法。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><blockquote><p> 设置<code>站点配置信息</code>Site中的<code>language</code>值为 <code>zh-Hans</code>，<a href="https://www.zywvvd.com/zywvvd.github.io/2020/02/24/hexo/hexo_config/Hexo%E7%AB%99%E7%82%B9%E9%85%8D%E7%BD%AE/">Hexo - 站点信息配置</a>。</p></blockquote><h2 id="配置翻译文件"><a href="#配置翻译文件" class="headerlink" title="配置翻译文件"></a>配置翻译文件</h2><blockquote><p>在/hexo_root/themes/next/languages/文件夹中创建<code>zh-Hans.yml</code>文件</p></blockquote><ul><li>翻译菜单</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">menu:</span><br>  <span class="hljs-attr">home:</span> <span class="hljs-string">首页</span><br>  <span class="hljs-attr">archives:</span> <span class="hljs-string">归档</span><br>  <span class="hljs-attr">categories:</span> <span class="hljs-string">分类</span><br>  <span class="hljs-attr">tags:</span> <span class="hljs-string">标签</span><br>  <span class="hljs-attr">about:</span> <span class="hljs-string">关于</span><br>  <span class="hljs-attr">search:</span> <span class="hljs-string">搜索</span><br>  <span class="hljs-attr">commonweal:</span> <span class="hljs-string">公益404</span><br>  <span class="hljs-attr">something:</span> <span class="hljs-string">有料</span><br></code></pre></td></tr></table></figure><ul><li>翻译文章标题</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">post:</span><br>  <span class="hljs-attr">posted:</span> <span class="hljs-string">发表于</span><br>  <span class="hljs-attr">edited:</span> <span class="hljs-string">编辑于</span><br>  <span class="hljs-attr">in:</span> <span class="hljs-string">类别</span><br>  <span class="hljs-attr">views:</span> <span class="hljs-string">阅读次数</span><br></code></pre></td></tr></table></figure><ul><li>翻译侧边栏</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">sidebar:</span><br>  <span class="hljs-attr">toc:</span> <span class="hljs-string">文章目录</span><br>  <span class="hljs-attr">overview:</span> <span class="hljs-string">小站概览</span><br></code></pre></td></tr></table></figure><ul><li>翻译站点状态</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">state:</span><br>  <span class="hljs-attr">posts:</span> <span class="hljs-string">日志</span><br>  <span class="hljs-attr">categories:</span> <span class="hljs-string">分类</span><br>  <span class="hljs-attr">tags:</span> <span class="hljs-string">标签</span><br></code></pre></td></tr></table></figure><ul><li>翻译文章阅读次数</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">post:</span><br>  <span class="hljs-attr">views:</span> <span class="hljs-string">阅读次数</span><br></code></pre></td></tr></table></figure><ul><li>翻译阅读时长、文本字数</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">symbols_count_time:</span><br>  <span class="hljs-attr">time:</span> <span class="hljs-string">阅读时长</span><br>  <span class="hljs-attr">count:</span> <span class="hljs-string">本文字数</span><br>  <span class="hljs-attr">count_total:</span> <span class="hljs-string">站点总字数</span><br>  <span class="hljs-attr">time_total:</span> <span class="hljs-string">站点阅读时长</span><br></code></pre></td></tr></table></figure><ul><li>翻译footer词条</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">footer:</span><br>  <span class="hljs-attr">theme:</span> <span class="hljs-string">主题方案</span><br>  <span class="hljs-attr">powered:</span> <span class="hljs-string">技术支持</span><br></code></pre></td></tr></table></figure><blockquote><p>此时相应的内容会被翻译成设定的文字</p></blockquote><img src="/2020/02/28/hexo-theme/next/3_translate/translate/xiaoguo.png" class="" title="翻译后的页面"><img src="/2020/02/28/hexo-theme/next/3_translate/translate/header-zh.png" class="" title="翻译后的页面"><img src="/2020/02/28/hexo-theme/next/3_translate/translate/xiaoguo2.png" class="" title="翻译后的页面"><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -2- 增加 tags, about, categories 页面</title>
    <link href="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/"/>
    <url>/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Next主题支持文章按照类别划分，而且可以为文章添加标签，并且有专门的页面用来管理和检索。而新安装的Next主题不带about, tags, categories页面，默认只有Archives。本文介绍这些页面的添加方法。</p></blockquote><span id="more"></span><h2 id="开启菜单按钮"><a href="#开启菜单按钮" class="headerlink" title="开启菜单按钮"></a>开启菜单按钮</h2><blockquote><p>在<code>主题配置文件</code>中开启相应按钮（去掉行前的<code>#</code>）</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># ---------------------------------------------------------------</span><br><span class="hljs-comment"># Menu Settings</span><br><span class="hljs-comment"># ---------------------------------------------------------------</span><br><br><span class="hljs-comment"># Usage: `Key: /link/ || icon`</span><br><span class="hljs-comment"># Key is the name of menu item. If the translation for this item is available, the translated text will be loaded, otherwise the Key name will be used. Key is case-senstive.</span><br><span class="hljs-comment"># Value before `||` delimiter is the target link, value after `||` delimiter is the name of Font Awesome icon.</span><br><span class="hljs-comment"># When running the site in a subdirectory (e.g. yoursite.com/blog), remove the leading slash from link value (/archives -&gt; archives).</span><br><span class="hljs-comment"># External url should start with http:// or https://</span><br><span class="hljs-attr">menu:</span><br>  <span class="hljs-attr">home:</span> <span class="hljs-string">/</span> <span class="hljs-string">||</span> <span class="hljs-string">home</span><br>  <span class="hljs-attr">about:</span> <span class="hljs-string">/about/</span> <span class="hljs-string">||</span> <span class="hljs-string">user</span><br>  <span class="hljs-attr">tags:</span> <span class="hljs-string">/tags/</span> <span class="hljs-string">||</span> <span class="hljs-string">tags</span><br>  <span class="hljs-attr">categories:</span> <span class="hljs-string">/categories/</span> <span class="hljs-string">||</span> <span class="hljs-string">th</span><br>  <span class="hljs-attr">archives:</span> <span class="hljs-string">/archives/</span> <span class="hljs-string">||</span> <span class="hljs-string">archive</span><br>  <span class="hljs-comment">#schedule: /schedule/ || calendar</span><br>  <span class="hljs-comment">#sitemap: /sitemap.xml || sitemap</span><br>  <span class="hljs-comment">#commonweal: /404/ || heartbeat</span><br></code></pre></td></tr></table></figure><blockquote><p>此时页面菜单发生了一些变化，但是按钮链接没有对应页面</p></blockquote><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/openbuttons.png" class="" title="开启按钮"><h2 id="添加页面"><a href="#添加页面" class="headerlink" title="添加页面"></a>添加页面</h2><h3 id="添加-tags"><a href="#添加-tags" class="headerlink" title="添加 tags"></a>添加 tags</h3><blockquote><p>在hexo目录的终端输入命令新建文章，layout设置为page，文章名称为tags</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new page tags<br></code></pre></td></tr></table></figure><blockquote><p>此时在 /hexo_root/source/tags/文件夹中出现了<code>index.md</code>文件，打开并修改Front-matter内容</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">title: 文章标签<br>date: 2020-02-28 13:01:59<br>type: &quot;tags&quot;<br></code></pre></td></tr></table></figure><blockquote><p>此时tags页面已经可以打开</p></blockquote><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/tags.png" class="" title="tags页面"><h3 id="添加-categories"><a href="#添加-categories" class="headerlink" title="添加 categories"></a>添加 categories</h3><blockquote><p>在hexo目录的终端输入命令新建文章，layout设置为page，文章名称为categories</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new page categories<br></code></pre></td></tr></table></figure><blockquote><p>此时在 /hexo_root/source/categories/文件夹中出现了<code>index.md</code>文件，打开并修改Front-matter内容</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">title: 文章类别<br>date: 2020-02-28 13:03:19<br>type: &quot;categories&quot;<br></code></pre></td></tr></table></figure><blockquote><p>此时categories页面已经可以打开</p></blockquote><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/categories.png" class="" title="categories页面"><h3 id="添加about"><a href="#添加about" class="headerlink" title="添加about"></a>添加about</h3><blockquote><p>在hexo目录的终端输入命令新建文章，layout设置为page，文章名称为about</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new page about<br></code></pre></td></tr></table></figure><blockquote><p>此时在 /hexo_root/source/about/文件夹中出现了<code>index.md</code>文件，打开并修改Front-matter内容</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">title: 小站自述<br>date: 2020-02-28 13:07:35<br>type: &quot;about&quot;<br></code></pre></td></tr></table></figure><blockquote><p>同时可以在文件中加入站点描述内容</p><p>此时about页面已经可以打开</p></blockquote><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/about.png" class="" title="about页面"><h2 id="设置文章类别和标签"><a href="#设置文章类别和标签" class="headerlink" title="设置文章类别和标签"></a>设置文章类别和标签</h2><blockquote><p>修改/hexo_root/source/_posts/hello-world.md，在Front-matter中添加标签和类别</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">title: Hello World<br>tags: [tag1,tag2]<br>categories: [cate,sub<span class="hljs-emphasis">_cate,sub_</span>sub<span class="hljs-emphasis">_cate]</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown">title: Hello World<br>tags: <br><span class="hljs-bullet">-</span> tag1<br><span class="hljs-bullet">-</span> tag2<br>categories: <br><span class="hljs-bullet">-</span> cate<br><span class="hljs-bullet">-</span> sub<span class="hljs-emphasis">_cate</span><br><span class="hljs-emphasis">- sub_</span>sub<span class="hljs-emphasis">_cate</span><br></code></pre></td></tr></table></figure><blockquote><p>主页面侧边栏状态会发生变化</p></blockquote><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/state.png" class="" title="侧边栏显示类别标签"><blockquote><p>标签页面（标签内容数量多字体会相应变大）</p><p>一篇文章可以设置多个平行标签</p></blockquote><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/tags2.png" class="" title="标签页面显示标签"><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/tags3.png" class="" title="文章标签"><blockquote><p>分类页面</p><p>类别标签不并列，安装顺序设置级别</p></blockquote><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/categories2.png" class="" title="分类页面显示分类"><img src="/2020/02/28/hexo-theme/next/2_add_pages/add-tags-about-categories-page/categories3.png" class="" title="文章分类"><h2 id="关闭评论"><a href="#关闭评论" class="headerlink" title="关闭评论"></a>关闭评论</h2><blockquote><p>后续站点可能会开启评论功能，如果不希望上述页面开启评论可以在页面<code>index.md</code>的Front-matter中添加</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">comments: false<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -4- 向文章添加图片的方法</title>
    <link href="/2020/02/27/hexo/4_hexo_add_image/hexo-add-image/"/>
    <url>/2020/02/27/hexo/4_hexo_add_image/hexo-add-image/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍Hexo编辑文章时添加图像的各种方法。</p></blockquote><span id="more"></span><h2 id="绝对路径本地引用"><a href="#绝对路径本地引用" class="headerlink" title="绝对路径本地引用"></a>绝对路径本地引用</h2><blockquote><p>当Hexo项目中只用到少量图片时，可以将图片统一放在source/images文件夹中，通过markdown语法访问它们。</p></blockquote><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">![](<span class="hljs-regexp">/images/im</span>age.jpg)<br></code></pre></td></tr></table></figure><blockquote><p>此方法加载的图片既可以在首页内容中访问到，也可以在文章正文中访问到。</p></blockquote><h2 id="相对路径本地引用"><a href="#相对路径本地引用" class="headerlink" title="相对路径本地引用"></a>相对路径本地引用</h2><blockquote><p>图片除了可以放在统一的images文件夹中，还可以放在文章自己的目录中。文章的目录可以通过设置<code>站点配置文件</code>的 <code>post_asset_folder: true</code>来自动生成。</p></blockquote><img src="/2020/02/27/hexo/4_hexo_add_image/hexo-add-image/config.png" class="" title="配置文件修改"><blockquote><p>将_config.yml文件中的配置项post_asset_folder设为true后，执行命令$ hexo new post_name，在source/_posts中会生成文章post_name.md和同名文件夹post_name。将图片资源放在post_name中，文章就可以使用相对路径引用图片资源了。</p></blockquote><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less">!<span class="hljs-selector-attr">[]</span>(image.jpg)<br></code></pre></td></tr></table></figure><h2 id="标签插件语法引用"><a href="#标签插件语法引用" class="headerlink" title="标签插件语法引用"></a>标签插件语法引用</h2><p>这种相对路径的图片显示方法在博文详情页面显示没有问题，但是在首页预览页面图片将显示不出来。如果希望<strong>图片在文章和首页中同时显示</strong>，可以使用标签插件语法。</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim"># 本地图片资源，不限制图片尺寸<br>&#123;% asset_img image.jpg This <span class="hljs-keyword">is</span> <span class="hljs-keyword">an</span> image %&#125;<br># 网络图片资源，限制图片显示尺寸<br>&#123;% img http://www.viemu.<span class="hljs-keyword">com</span>/<span class="hljs-keyword">vi</span>-<span class="hljs-keyword">vim</span>-cheat-sheet.gif <span class="hljs-number">200</span> <span class="hljs-number">400</span> <span class="hljs-keyword">vi</span>-<span class="hljs-keyword">vim</span>-cheat-sheet %&#125;<br></code></pre></td></tr></table></figure><h2 id="HTML语法引用"><a href="#HTML语法引用" class="headerlink" title="HTML语法引用"></a>HTML语法引用</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;img <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;SpellCheck.png&quot;</span> <span class="hljs-attribute">width</span>=<span class="hljs-string">&quot;50%&quot;</span> <span class="hljs-attribute">height</span>=<span class="hljs-string">&quot;50%&quot;</span> <span class="hljs-attribute">title</span>=<span class="hljs-string">&quot;拼写检查工具Grammarly.&quot;</span> <span class="hljs-attribute">alt</span>=<span class="hljs-string">&quot;拼写检查工具Grammarly.&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><p>直接将<code>![](image.jpg)</code>替换上面的语法即可。</p><h2 id="启用fancybox：点击查看图片大图"><a href="#启用fancybox：点击查看图片大图" class="headerlink" title="启用fancybox：点击查看图片大图"></a>启用fancybox：点击查看图片大图</h2><p>我这里使用的是Hexo的NexT主题，NexT主题中提供了fancybox的方便接口。</p><p>Usage：<a href="https://github.com/theme-next/theme-next-fancybox3">https://github.com/theme-next/theme-next-fancybox3</a><br>markdown用法：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">&#123;% img http:<span class="hljs-regexp">//</span>www.viemu.com<span class="hljs-regexp">/vi-vim-cheat-sheet.gif 600 600 &quot;点击查看大图:vi/</span>vim-cheat-sheet<span class="hljs-string">&quot; %&#125;</span><br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>机器学习-基础知识 - PR、ROC曲线与AUC</title>
    <link href="/2020/02/27/machine_learning/basic_knowledge/PR_and_ROC/PR-and-ROC/"/>
    <url>/2020/02/27/machine_learning/basic_knowledge/PR_and_ROC/PR-and-ROC/</url>
    
    <content type="html"><![CDATA[<blockquote><p>PR曲线与ROC曲线都是机器学习中性能评估的重要指标，本文主要讲这两个曲线。</p></blockquote><span id="more"></span><h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><ul><li>熟悉基础定义<a href="https://www.zywvvd.com/2020/02/26/machine_learning/basic_knowledge/TP_FN_FP_TN/Evaluation-index/">TP, FN, FP, TN</a>。</li><li>理解主要评估指标概念<a href="https://www.zywvvd.com/2020/02/27/machine_learning/basic_knowledge/performance_evaluation/Performance-evaluation/">Precision, Recall,  FNR, FPR, TPR, TNR</a>等。</li></ul><h2 id="示例数据"><a href="#示例数据" class="headerlink" title="示例数据"></a>示例数据</h2><table>    <tr>        <th ><center>样本编号</center></th>         <th  ><center>1</center></th>        <th  ><center>2</center></th>        <th  ><center>3</center></th>        <th  ><center>4</center></th>        <th  ><center>5</center></th>        <th  ><center>6</center></th>        <th  ><center>7</center></th>        <th  ><center>8</center></th>        <th  ><center>9</center></th>        <th  ><center>10</center></th>    </tr>      <tr>        <td><center>真实类别</center></td>        <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>N</center></td>         <td><center>N</center></td>         <td><center>N</center></td>         <td><center>N</center></td>    </tr></table><blockquote><p>预测-1</p></blockquote> <table>    <tr>        <th ><center>样本编号</center></th>         <th  ><center>1</center></th>        <th  ><center>2</center></th>        <th  ><center>3</center></th>        <th  ><center>4</center></th>        <th  ><center>5</center></th>        <th  ><center>6</center></th>        <th  ><center>7</center></th>        <th  ><center>8</center></th>        <th  ><center>9</center></th>        <th  ><center>10</center></th>    </tr>      <tr>        <td><center>预测为正样本<br>的概率</center></td>        <td><center><font >0.9</font></center></td>          <td><center><font >0.8</font></center></td>          <td><center><font>0.7</font></center></td>         <td><center><font >0.6</font></center></td>         <td><center><font >0.6</font></center></td>          <td><center><font>0.4</font></center></td>         <td><center><font >0.5</font></center></td>          <td><center><font >0.4</font></center></td>         <td><center><font>0.3</font></center></td>         <td><center><font >0.2</font></center></td>    </tr></table><blockquote><p>预测-2</p></blockquote> <table>    <tr>        <th ><center>样本编号</center></th>         <th  ><center>1</center></th>        <th  ><center>2</center></th>        <th  ><center>3</center></th>        <th  ><center>4</center></th>        <th  ><center>5</center></th>        <th  ><center>6</center></th>        <th  ><center>7</center></th>        <th  ><center>8</center></th>        <th  ><center>9</center></th>        <th  ><center>10</center></th>    </tr>      <tr>        <td><center>预测为正样本<br>的概率</center></td>        <td><center><font >0.8</font></center></td>          <td><center><font >0.7</font></center></td>          <td><center><font>0.7</font></center></td>         <td><center><font >0.8</font></center></td>         <td><center><font >0.7</font></center></td>          <td><center><font>0.4</font></center></td>         <td><center><font >0.6</font></center></td>          <td><center><font >0.3</font></center></td>         <td><center><font>0.3</font></center></td>         <td><center><font >0.1</font></center></td>    </tr></table><h2 id="PR曲线"><a href="#PR曲线" class="headerlink" title="PR曲线"></a>PR曲线</h2><blockquote><p>含义：PR曲线中P为Precision（查准率），R为Recall（查全率）。以Recall为横坐标、Precision为纵坐标绘制的曲线即为PR曲线。有同学可能会问Precision、Recall不就是一个值么，怎么画出的曲线？</p></blockquote><h3 id="曲线的由来"><a href="#曲线的由来" class="headerlink" title="曲线的由来"></a>曲线的由来</h3><p>事实上机器学习训练好的模型在对测试样本进行预测的时候，输出的原始结果是模型预测该样本为正样本的概率，而不是我们平时经常听到的Positive或Negative，而概率如何转化为机器学习的输出靠的是一个阈值，当概率大于阈值则判断其为正样本，反之为负样本。</p><p>而这个非常关键的阈值本身不是固定的，在阈值变化过程中模型对样本的预测类别也会相应发生变化，那么阈值不断变化导致模型Precision和Recall变化，将这些点连成线也就是PR曲线了。</p><h3 id="绘制示例数据的PR曲线"><a href="#绘制示例数据的PR曲线" class="headerlink" title="绘制示例数据的PR曲线"></a>绘制示例数据的PR曲线</h3><blockquote><p>为直观展示PR曲线绘制过程，根据示例数据绘制PR曲线（简便起见阈值选定为0.05-0.95，跨度0.1）。</p></blockquote> <table>    <tr>         <th   ><center>阈值</center></th>        <th colspan="4" ><center>预测-1</center></th>        <th  colspan="4"><center>预测-2</center></th>    </tr>        <tr>        <td rowspan="3"><center><font >0.05</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >6</font></center></td>        <td><center><font >4</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >6</font></center></td>        <td><center><font >4</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >0.6</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >0.6</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >1</font></center></td>    </tr>     <td rowspan="3"><center><font >0.15</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >6</font></center></td>        <td><center><font >4</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >6</font></center></td>        <td><center><font >3</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >0</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >0.6</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >0.67</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >1</font></center></td>    </tr> <td rowspan="3"><center><font >0.25</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>     <tr>        <td><center><font >6</font></center></td>        <td><center><font >3</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >6</font></center></td>        <td><center><font >3</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >0</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >0.67</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >0.67</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >1</font></center></td>    </tr> <td rowspan="3"><center><font >0.35</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >6</font></center></td>        <td><center><font >2</font></center></td>          <td><center><font >2</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >6</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >3</font></center></td>        <td><center><font >0</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >0.75</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >0.86</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >1</font></center></td>    </tr> <td rowspan="3"><center><font >0.45</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >5</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >3</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >5</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >3</font></center></td>        <td><center><font >1</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >0.83</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.83</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >0.83</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.83</font></center></td>    </tr> <td rowspan="3"><center><font >0.55</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >5</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >5</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >3</font></center></td>        <td><center><font >1</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.83</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >0.83</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.83</font></center></td>    </tr> <td rowspan="3"><center><font >0.65</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >3</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >3</font></center></td>          <td><center><font >5</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >1</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.5</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.83</font></center></td>    </tr> <td rowspan="3"><center><font >0.75</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >2</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >4</font></center></td>          <td><center><font >2</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >4</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.33</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.33</font></center></td>    </tr> <td rowspan="3"><center><font >0.85</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >1</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >5</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >6</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0.17</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >-</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0</font></center></td>    </tr> <td rowspan="3"><center><font >0.95</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >6</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >6</font></center></td>    </tr>  <tr>        <td><center><font >Precision</font></center></td>        <td><center><font >-</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >Precision</font></center></td>        <td><center><font >-</font></center></td>          <td><center><font >Recall</font></center></td>        <td><center><font >0</font></center></td>    </tr></table><blockquote><p>结果坐标</p></blockquote><table>      <tr>        <th colspan = "2"><center><font >编号</font></center></td>        <th><center><font >1</font></center></td>          <th><center><font >2</font></center></td>        <th><center><font >3</font></center></td>          <th><center><font >4</font></center></td>        <th><center><font >5</font></center></td>          <th><center><font >6</font></center></td>        <th><center><font >7</font></center></td><th><center><font >8</font></center></td>          <th><center><font >9</font></center></td>        <th><center><font >10</font></center></td>    </tr>   <tr>        <td rowspan="2"><center><font >预测-1</font></center></td>       <td><center><font >Recall</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >0.83</font></center></td>        <td><center><font >0.83</font></center></td>       <td><center><font >0.5</font></center></td>        <td><center><font >0.33</font></center></td>          <td><center><font >0.17</font></center></td>        <td><center><font >0</font></center></td>    </tr> <tr>        <td><center><font >Precision</font></center></td>          <td><center><font >0.6</font></center></td>        <td><center><font >0.6</font></center></td>          <td><center><font >0.67</font></center></td>        <td><center><font >0.75</font></center></td>          <td><center><font >0.83</font></center></td>        <td><center><font >1</font></center></td>       <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >-</font></center></td>    </tr>   <tr>        <td rowspan="2"><center><font >预测-2</font></center></td>         <td><center><font >Recall</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >0.83</font></center></td>        <td><center><font >0.83</font></center></td>       <td><center><font >0.83</font></center></td>        <td><center><font >0.33</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>    </tr> <tr>     <td><center><font >Precision</font></center></td>          <td><center><font >0.6</font></center></td>        <td><center><font >0.67</font></center></td>          <td><center><font >0.67</font></center></td>        <td><center><font >0.86</font></center></td>          <td><center><font >0.83</font></center></td>        <td><center><font >0.83</font></center></td>       <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >-</font></center></td>        <td><center><font >-</font></center></td>    </tr></table><blockquote><p>PR曲线：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200505233947.png" alt="PR曲线"></p><blockquote><ul><li><p>如果一个学习器的P-R曲线被另一个学习器的P-R曲线完全包住，则可断言后者的性能优于前者，示例数据中根据PR曲线可以看到预测2优于预测1</p></li><li><p>至于有交叉的情况可以判断曲线下方的面积大小来判断，面积大的性能更好</p></li><li><p>平衡点（BEP）是P=R时的取值，如果这个值较大，则说明学习器的性能较好</p></li></ul><p>参考<a href="https://www.jianshu.com/p/ac46cb7e6f87">性能评估之PR曲线与ROC曲线</a>。</p></blockquote><h2 id="ROC曲线"><a href="#ROC曲线" class="headerlink" title="ROC曲线"></a>ROC曲线</h2><blockquote><p>ROC曲线英文’receiver operating characteristic curve’，直译为“接受者操作特性曲线”，又称为感受性曲线（sensitivity curve）。得此名的原因在于曲线上各点反映着相同的感受性，它们都是对同一信号刺激的反应，只不过是在几种不同的判定标准下所得的结果而已。</p><p>ROC曲线是在门限阈值不断变化过程中以虚警概率（FPR）为横轴，击中概率（TPR）为纵轴绘制而成的曲线。</p></blockquote><h3 id="绘制示例数据的ROC曲线"><a href="#绘制示例数据的ROC曲线" class="headerlink" title="绘制示例数据的ROC曲线"></a>绘制示例数据的ROC曲线</h3><blockquote><p>为直观展示ROC曲线绘制过程，根据示例数据绘制ROC曲线（简便起见阈值选定为0.05-0.95，跨度0.1）。</p></blockquote> <table>    <tr>         <th   ><center>阈值</center></th>        <th colspan="4" ><center>预测-1</center></th>        <th  colspan="4"><center>预测-2</center></th>    </tr>        <tr>        <td rowspan="3"><center><font >0.05</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >6</font></center></td>        <td><center><font >4</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >6</font></center></td>        <td><center><font >4</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >1</font></center></td>    </tr>     <td rowspan="3"><center><font >0.15</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >6</font></center></td>        <td><center><font >4</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >6</font></center></td>        <td><center><font >3</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >0</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0.75</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >1</font></center></td>    </tr> <td rowspan="3"><center><font >0.25</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>     <tr>        <td><center><font >6</font></center></td>        <td><center><font >3</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >6</font></center></td>        <td><center><font >3</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >0</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >0.75</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0.75</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >1</font></center></td>    </tr> <td rowspan="3"><center><font >0.35</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >6</font></center></td>        <td><center><font >2</font></center></td>          <td><center><font >2</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >6</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >3</font></center></td>        <td><center><font >0</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >0.5</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0.25</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >1</font></center></td>    </tr> <td rowspan="3"><center><font >0.45</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >5</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >3</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >5</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >3</font></center></td>        <td><center><font >1</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >0.25</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.83</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0.25</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.83</font></center></td>    </tr> <td rowspan="3"><center><font >0.55</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >5</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >5</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >3</font></center></td>        <td><center><font >1</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.83</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0.25</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.83</font></center></td>    </tr> <td rowspan="3"><center><font >0.65</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >3</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >3</font></center></td>          <td><center><font >5</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >1</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.5</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.83</font></center></td>    </tr> <td rowspan="3"><center><font >0.75</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >2</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >4</font></center></td>          <td><center><font >2</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >4</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.33</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.33</font></center></td>    </tr> <td rowspan="3"><center><font >0.85</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >1</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >5</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >6</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0.17</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0</font></center></td>    </tr> <td rowspan="3"><center><font >0.95</font></center></td>              <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>          <td><center><font >TP</font></center></td>            <td><center><font >FP</font></center></td>              <td><center><font >TN</font></center></td>            <td><center><font >FN</font></center></td>    </tr>       <tr>        <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >6</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >4</font></center></td>        <td><center><font >6</font></center></td>    </tr>  <tr>        <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >FPR</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >TPR</font></center></td>        <td><center><font >0</font></center></td>    </tr></table><blockquote><p>结果坐标</p></blockquote><table>      <tr>        <th colspan = "2"><center><font >编号</font></center></td>        <th><center><font >1</font></center></td>          <th><center><font >2</font></center></td>        <th><center><font >3</font></center></td>          <th><center><font >4</font></center></td>        <th><center><font >5</font></center></td>          <th><center><font >6</font></center></td>        <th><center><font >7</font></center></td><th><center><font >8</font></center></td>          <th><center><font >9</font></center></td>        <th><center><font >10</font></center></td>    </tr>   <tr>        <td rowspan="2"><center><font >预测-1</font></center></td>        <td><center><font >FPR</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >0.75</font></center></td>        <td><center><font >0.5</font></center></td>          <td><center><font >0.25</font></center></td>        <td><center><font >0</font></center></td>       <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>    </tr> <tr>        <td><center><font >TPR</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >0.83</font></center></td>        <td><center><font >0.83</font></center></td>       <td><center><font >0.5</font></center></td>        <td><center><font >0.33</font></center></td>          <td><center><font >0.17</font></center></td>        <td><center><font >0</font></center></td>    </tr>   <tr>        <td rowspan="2"><center><font >预测-2</font></center></td>        <td><center><font >FPR</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >0.75</font></center></td>          <td><center><font >0.75</font></center></td>        <td><center><font >0.25</font></center></td>          <td><center><font >0.25</font></center></td>        <td><center><font >0.25</font></center></td>       <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>    </tr> <tr>        <td><center><font >TPR</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >1</font></center></td>        <td><center><font >1</font></center></td>          <td><center><font >0.83</font></center></td>        <td><center><font >0.83</font></center></td>       <td><center><font >0.83</font></center></td>        <td><center><font >0.33</font></center></td>          <td><center><font >0</font></center></td>        <td><center><font >0</font></center></td>    </tr></table><blockquote><p>ROC曲线：</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200505234008.png" alt="ROC曲线"></p><blockquote><p>ROC曲线图中，坐标（0,0）代表的含义是虚警概率为0，既没有负样本被判定为正样本，同时召回率也为0，既没有正样本被判定为正样本 —— 也就是此处表示所有样本都判定为了负样本。这是由于阈值选择接近1，导致没有样本被划定到正样本区域内，并不说明模型不好，事实上所有的模型都会经过这一点；</p><p>同理，坐标（1,1）表示阈值接近0，所有样本均被判定为正；</p><p>坐标（0,1）意味着完美的分类器，在虚警为0的情况下正确判断了所有正样本，这也是我们机器学习人的毕生追求。因此ROC曲线越接近左上角，模型性能越好。</p></blockquote><h2 id="AUC"><a href="#AUC" class="headerlink" title="AUC"></a>AUC</h2><blockquote><ul><li><p> AUC是英文 Area under Curve的缩写，表示的是ROC曲线下的面积，也就是ROC曲线在[0,1]上的积分</p></li><li><p>这是用来评价模型分类器性能的指标，对不同模型来说，AUC越大表示分类性能越好</p></li><li><p>AUC取值范围为[0,1]，有效果的分类器会大于0.5，效果差的会接近0.5</p></li><li><p>如果有人问为什么不是接近0的效果最差呢？ 事实上如果你得到了AUC为0的分类器，只需要对输出取反你就得到了完美的分类器。</p></li></ul></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>基础知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>性能评估</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>机器学习-基础知识 - Precision, Recall, Sensitivity, Specificity, Accuracy, FNR, FPR, TPR, TNR, F1 Score, Balanced F Score</title>
    <link href="/2020/02/27/machine_learning/basic_knowledge/performance_evaluation/Performance-evaluation/"/>
    <url>/2020/02/27/machine_learning/basic_knowledge/performance_evaluation/Performance-evaluation/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍机器学习中的二分类性能评估指标Precision, Recall, Sensitivity, Specificity, Accuracy, FNR, FPR, TNR, TPR, F1 Score, Balanced F Score基本含义，给出公式和具体算例，并作简要分析。</p></blockquote><span id="more"></span><h2 id="基础定义"><a href="#基础定义" class="headerlink" title="基础定义"></a>基础定义</h2><table>    <tr>        <th colspan="2" rowspan="2" ><center>评估指标</center></th>         <th colspan="2" ><center>预测结果</center></th>    </tr>      <tr>        <th  ><center>正样本</center></th>        <th  ><center>负样本</center></th>    </tr >    <tr >        <td rowspan="2"><center>实际<br>情况</center></td>        <td><center>正样本</center></td>        <td><center>TP</center></td>        <td><center>FN</center></td>    </tr>    <tr >        <td><center>负样本</center></td>        <td><center>FP</center></td>        <td><center>TN</center></td>    </tr></table><blockquote><p>具体含义和理解参考 <a href="https://www.zywvvd.com/2020/02/26/machine_learning/basic_knowledge/TP_FN_FP_TN/Evaluation-index/">机器学习-基础知识- TP、FN、FP、TN</a>。</p></blockquote><p><img src="https://photos.zywvvd.com/image/20200506000757.png"></p><h2 id="示例用例"><a href="#示例用例" class="headerlink" title="示例用例"></a>示例用例</h2><blockquote><p>样本信息</p></blockquote><table>    <tr>        <th ><center>样本编号</center></th>         <th  ><center>1</center></th>        <th  ><center>2</center></th>        <th  ><center>3</center></th>        <th  ><center>4</center></th>        <th  ><center>5</center></th>        <th  ><center>6</center></th>        <th  ><center>7</center></th>        <th  ><center>8</center></th>        <th  ><center>9</center></th>        <th  ><center>10</center></th>    </tr>      <tr>        <td><center>真实类别</center></td>        <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>P</center></td>         <td><center>N</center></td>         <td><center>N</center></td>         <td><center>N</center></td>    </tr></table>> 预测-1 <table>    <tr>        <th ><center>样本编号</center></th>         <th  ><center>1</center></th>        <th  ><center>2</center></th>        <th  ><center>3</center></th>        <th  ><center>4</center></th>        <th  ><center>5</center></th>        <th  ><center>6</center></th>        <th  ><center>7</center></th>        <th  ><center>8</center></th>        <th  ><center>9</center></th>        <th  ><center>10</center></th>    </tr>      <tr>        <td><center>预测类别</center></td>        <td><center><font color='green'>P</font></center></td>          <td><center><font color='green'>P</font></center></td>          <td><center><font color='green'>P</font></center></td>         <td><center><font color='red'>N</font></center></td>         <td><center><font color='red'>N</font></center></td>          <td><center><font color='red'>N</font></center></td>         <td><center><font color='red'>N</font></center></td>          <td><center><font color='green'>N</font></center></td>         <td><center><font color='green'>N</font></center></td>         <td><center><font color='green'>N</font></center></td>    </tr>     <tr>         <td><center>评估指标</center></td>         <td><center>TP</center></td>          <td><center>3</center></td>          <td><center>TN</center></td>          <td><center>3</center></td>          <td><center>FP</center></td>          <td><center>0</center></td>          <td><center>FN</center></td>          <td><center>4</center></td>     </tr></table><blockquote><p>预测-2</p></blockquote> <table>    <tr>        <th ><center>样本编号</center></th>         <th  ><center>1</center></th>        <th  ><center>2</center></th>        <th  ><center>3</center></th>        <th  ><center>4</center></th>        <th  ><center>5</center></th>        <th  ><center>6</center></th>        <th  ><center>7</center></th>        <th  ><center>8</center></th>        <th  ><center>9</center></th>        <th  ><center>10</center></th>    </tr>      <tr>        <td><center>预测类别</center></td>         <td><center><font color='green'>P</font></center></td>         <td><center><font color='green'>P</font></center></td>          <td><center><font color='red'>N</font></center></td>          <td><center><font color='red'>N</font></center></td>          <td><center><font color='green'>P</font></center></td>         <td><center><font color='green'>P</font></center></td>         <td><center><font color='green'>P</font></center></td>        <td><center><font color='red'>P</font></center></td>         <td><center><font color='green'>N</font></center></td>          <td><center><font color='green'>N</font></center></td>    </tr>          <tr>         <td><center>评估指标</center></td>         <td><center>TP</center></td>          <td><center>5</center></td>          <td><center>TN</center></td>          <td><center>2</center></td>          <td><center>FP</center></td>          <td><center>1</center></td>          <td><center>FN</center></td>          <td><center>2</center></td>     </tr></table><blockquote><p>预测-3</p></blockquote> <table>    <tr>        <th ><center>样本编号</center></th>         <th  ><center>1</center></th>        <th  ><center>2</center></th>        <th  ><center>3</center></th>        <th  ><center>4</center></th>        <th  ><center>5</center></th>        <th  ><center>6</center></th>        <th  ><center>7</center></th>        <th  ><center>8</center></th>        <th  ><center>9</center></th>        <th  ><center>10</center></th>    </tr>      <tr>        <td><center>预测类别</center></td>         <td><center><font color='green'>P</font></center></td>         <td><center><font color='green'>P</font></center></td>            <td><center><font color='green'>P</font></center></td>            <td><center><font color='green'>P</font></center></td>          <td><center><font color='green'>P</font></center></td>         <td><center><font color='green'>P</font></center></td>         <td><center><font color='green'>P</font></center></td>        <td><center><font color='red'>P</font></center></td>         <td><center><font color='red'>P</font></center></td>          <td><center><font color='red'>P</font></center></td>    </tr>          <tr>         <td><center>评估指标</center></td>         <td><center>TP</center></td>          <td><center>7</center></td>          <td><center>TN</center></td>          <td><center>0</center></td>          <td><center>FP</center></td>          <td><center>3</center></td>          <td><center>FN</center></td>          <td><center>0</center></td>     </tr></table><h2 id="Precision"><a href="#Precision" class="headerlink" title="Precision"></a>Precision</h2><blockquote><p>译为：<code>精确率</code>，<code>查准率</code>。</p><p>含义：预测所有正样本中判断正确的比例：</p></blockquote><p>$$<br>Precision=\frac{TP}{TP+FP}<br>$$</p><blockquote><p>预测用例Precision：</p></blockquote><p>$$<br>Precision_{预测1}=\frac{TP}{TP+FP}=\frac{3}{3+0}=1<br>$$</p><p>$$<br>Precision_{预测2}=\frac{TP}{TP+FP}=\frac{5}{5+1}\approx 0.83<br>$$</p><p>$$<br>Precision_{预测3}=\frac{TP}{TP+FP}=\frac{7}{7+3}=0.7<br>$$</p><blockquote><p>可以看到预测1判断出的正样本全部正确，因此该预测具有最高的查准率。</p><p>可以理解Precision为模型判断为正样本的置信概率，概率越高，该模型判断出的正样本越可信。</p></blockquote><h2 id="FDR（False-Discorvery-Rate）"><a href="#FDR（False-Discorvery-Rate）" class="headerlink" title="FDR（False Discorvery Rate）"></a>FDR（False Discorvery Rate）</h2><blockquote><p>译为：<code>过杀率(工业缺陷)</code>。<br>含义：反映了检测器判断为正样本的样本中，负样本所占比例：</p></blockquote><p>$$<br>FDR=\frac{FP}{TP+FP}=1-Precision<br>$$</p><blockquote><p>预测用例FA：</p></blockquote><p>$$<br>FDR_{预测1}=\frac{FP}{TP+FP}=\frac{0}{3+0}=0<br>$$</p><p>$$<br>FDR_{预测2}=\frac{FP}{TP+FP}=\frac{1}{5+1}\approx0.17<br>$$</p><p>$$<br>FDR_{预测3}=\frac{FP}{TP+FP}=\frac{3}{7+3}=0.3<br>$$</p><h2 id="Recall-Sensitivity-TPR（True-Positive-Rate）"><a href="#Recall-Sensitivity-TPR（True-Positive-Rate）" class="headerlink" title="Recall / Sensitivity / TPR（True Positive Rate）"></a>Recall / Sensitivity / TPR（True Positive Rate）</h2><blockquote><p>译为：<code>召回率</code>，<code>查全率</code> ， <code>敏感性</code> ， <code>真正率</code>。</p><p>含义：预测正确的所有正样本占实际所有正样本的比例：</p></blockquote><p>$$<br>Recall=Sensitivity=TPR=\frac{TP}{TP+FN}<br>$$</p><blockquote><p> 预测用例Recall / Sensitivity / TPR：</p></blockquote><p>$$<br>Recall_{预测1}=\frac{TP}{TP+FN}=\frac{3}{3+4}\approx0.43<br>$$</p><p>$$<br>Recall_{预测2}=\frac{TP}{TP+FN}=\frac{5}{5+2}\approx0.71<br>$$</p><p>$$<br>Recall_{预测3}=\frac{TP}{TP+FN}=\frac{7}{7+0}=1<br>$$</p><blockquote><p>查全率和查准率考量角度不同，不关注模型判断出正样本是否足够准确，关注模型挑对的正样本占全部正样本的比例。</p><p>因此最简单判断所有样本为正的策略可以得到100%的查全率，因为这个模型查到的正样本很“全”。</p></blockquote><h2 id="Specificity-TNR-（True-Negative-Rate）"><a href="#Specificity-TNR-（True-Negative-Rate）" class="headerlink" title="Specificity / TNR （True Negative Rate）"></a>Specificity / TNR （True Negative Rate）</h2><blockquote><p>译为：<code>特异度</code>，<code>真负率</code>。<br>含义：预测正确的所有负样本占实际所有负样本的比例：</p></blockquote><p>$$<br>Specificity=TNR=\frac{TN}{TN+FP}<br>$$</p><blockquote><p>预测用例Specificity / TNR ：</p></blockquote><p>$$<br>Specificity_{预测1}=\frac{TN}{TN+FP}=\frac{3}{3+0}=1<br>$$</p><p>$$<br>Specificity_{预测2}=\frac{TN}{TN+FP}=\frac{2}{2+1}\approx0.67<br>$$</p><p>$$<br>Specificity_{预测3}=\frac{TN}{TN+FP}=\frac{0}{0+3}=0<br>$$</p><blockquote><p>与查全率相似，描述的是另一边的情况。</p></blockquote><h2 id="FPR（False-Positive-Rate）"><a href="#FPR（False-Positive-Rate）" class="headerlink" title="FPR（False Positive Rate）"></a>FPR（False Positive Rate）</h2><blockquote><p>译为：<code>假正率</code>，<code>误检率</code>，<code>虚警概率</code>。<br>含义：预测误判为正样本的负样本数量占实际所有负样本的比例：</p></blockquote><p>$$<br>FPR=\frac{FP}{FP+TN}<br>$$</p><blockquote><p>预测用例FPR：</p></blockquote><p>$$<br>FPR_{预测1}=\frac{FP}{FP+TN}=\frac{0}{0+3}=0<br>$$</p><p>$$<br>FPR_{预测2}=\frac{FP}{FP+TN}=\frac{1}{1+2}\approx0.33<br>$$</p><p>$$<br>FPR_{预测3}=\frac{FP}{FP+TN}=\frac{3}{3+0}=1<br>$$</p><h2 id="FNR（False-Negative-Rate）"><a href="#FNR（False-Negative-Rate）" class="headerlink" title="FNR（False Negative Rate）"></a>FNR（False Negative Rate）</h2><blockquote><p>译为：<code>假负率</code>，<code>漏警概率</code>，<code>漏检率</code>。<br>含义：预测误判为负样本的正样本数量占实际所有正样本的比例：</p></blockquote><p>$$<br>FNR=\frac{FN}{FN+TP}=1-Recall<br>$$</p><blockquote><p>预测用例FNR：</p></blockquote><p>$$<br>FNR_{预测1}=\frac{FN}{FN+TP}=\frac{4}{4+3}\approx0.57<br>$$</p><p>$$<br>FNR_{预测2}=\frac{FN}{FN+TP}=\frac{2}{2+5}\approx0.29<br>$$</p><p>$$<br>FNR_{预测3}=\frac{FN}{FN+TP}=\frac{0}{0+7}=0<br>$$</p><h1 id="Accuracy"><a href="#Accuracy" class="headerlink" title="Accuracy"></a>Accuracy</h1><blockquote><p>译为：<code>正确率</code><br>含义：所有实验中预测正确的样本数占所有样本数量的比例。</p></blockquote><p>$$<br>Accuracy=\frac{TP+TN}{TP+FP+TN+FN}<br>$$</p><blockquote><p>预测用例Accuracy：</p></blockquote><p>$$<br>Accuracy_{预测1}=\frac{TP+TN}{TP+FP+TN+FN}=\frac{3+3}{3+0+3+4}=0.6<br>$$</p><p>$$<br>Accuracy_{预测2}=\frac{TP+TN}{TP+FP+TN+FN}=\frac{5+2}{5+1+2+2}=0.7<br>$$</p><p>$$<br>Accuracy_{预测3}=\frac{TP+TN}{TP+FP+TN+FN}=\frac{7+0}{7+3+0+0}=0.7<br>$$</p><blockquote><p>事实上预测1,2的模型对正、负样本都是有有一定正确分类能力的，预测3模型仅仅使用了“将所有样本都判为正”的策略既收获了最高的正确率，并不是这个指标有问题，而是数据分布本身并不平衡。</p><p>样本中正样本居多，预测3的模型成功预测了数据中正样本占大多数，因此策略得到了高正确率的回报。</p></blockquote><h2 id="Error-Rate"><a href="#Error-Rate" class="headerlink" title="Error Rate"></a>Error Rate</h2><blockquote><p>译为：<code>错误率</code><br>含义：所有实验中预测错误的样本数占所有样本数量的比例。</p></blockquote><p>$$<br>Error_Rate=\frac{FP+FN}{TP+FP+TN+FN}=1-Accuracy<br>$$</p><blockquote><p>预测用例Accuracy：</p></blockquote><p>$$<br>Error_Rate_{预测1}=\frac{FP+FN}{TP+FP+TN+FN}=\frac{0+4}{3+0+3+4}=0.4<br>$$</p><p>$$<br>Error_Rate_{预测2}=\frac{FP+FN}{TP+FP+TN+FN}=\frac{1+2}{5+1+2+2}=0.3<br>$$</p><p>$$<br>Error_Rate_{预测3}=\frac{FP+FN}{TP+FP+TN+FN}=\frac{3+0}{7+3+0+0}=0.3<br>$$</p><h2 id="F1-Score-Balanced-F-Score"><a href="#F1-Score-Balanced-F-Score" class="headerlink" title="F1 Score / Balanced F Score"></a>F1 Score / Balanced F Score</h2><blockquote><p>译为：<code>F1 分数</code> / <code>平衡F分数</code><br>含义：F1分数兼顾了分类模型的精确率和召回率，定义为模型精确率和召回率的调和平均数。</p></blockquote><p>$$<br>F_1 Score=2\times\frac{Precision\times Recall}{Precision+ Recall}<br>$$</p><blockquote><p>预测用例F1 Score：</p></blockquote><p>$$<br>F_1 Score_{预测1}=2\times\frac{Precision_{预测1}\times Recall_{预测1}}{Precision_{预测1}+ Recall_{预测1}}=2\times\frac{1\times \frac{3}{7}}{1+ \frac{3}{7}}= 0.6<br>$$</p><p>$$<br>F_1 Score_{预测2}=2\times\frac{Precision_{预测2}\times Recall_{预测2}}{Precision_{预测2}+ Recall_{预测2}}=2\times\frac{\frac{5}{6} \times \frac{5}{7}}{\frac{5}{6} + \frac{5}{7}}\approx 0.77<br>$$</p><p>$$<br>F_1 Score_{预测3}=2\times\frac{Precision_{预测3}\times Recall_{预测3}}{Precision_{预测3}+ Recall_{预测3}}=2\times\frac{0.7 \times 1}{0.7 + 1}\approx 0.82<br>$$</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>基础知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>性能评估</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>机器学习-基础知识- TP, FN, FP, TN</title>
    <link href="/2020/02/26/machine_learning/basic_knowledge/TP_FN_FP_TN/Evaluation-index/"/>
    <url>/2020/02/26/machine_learning/basic_knowledge/TP_FN_FP_TN/Evaluation-index/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文介绍机器学习的一系列基础评估指标。</p></blockquote><span id="more"></span><h2 id="基础定义"><a href="#基础定义" class="headerlink" title="基础定义"></a>基础定义</h2><ul><li>T ： True 表示判断正确</li><li>F ： False 表示判断错误</li><li>P ： PostIve 表示判断该样本为正样本</li><li>N ： Negative 表示判断该样本为负样本</li></ul><h2 id="指标定义"><a href="#指标定义" class="headerlink" title="指标定义"></a>指标定义</h2><blockquote><p>如果总是记混，按照上述字母顺序翻译出意义即可。</p></blockquote><ul><li>TP ： (T)该判断正确，(P)判断该样本为正样本（事实上样本为正）</li><li>TN ： (T)该判断正确，(N)判断该样本为负样本（事实上样本为负）</li><li>FP ： (F)该判断错误，(P)判断该样本为正样本（事实上样本为负）</li><li>FN ： (F)该判断错误，(N)判断该样本为负样本（事实上样本为正）</li></ul><table>    <tr>        <th colspan="2" rowspan="2" ><center>评估指标</center></th>         <th colspan="2" ><center>预测结果</center></th>    </tr>      <tr>        <th  ><center>正样本</center></th>        <th  ><center>负样本</center></th>    </tr >    <tr >        <td rowspan="2"><center>实际<br>情况</center></td>        <td><center>正样本</center></td>        <td><center>TP</center></td>        <td><center>FN</center></td>    </tr>    <tr >        <td><center>负样本</center></td>        <td><center>FP</center></td>        <td><center>TN</center></td>    </tr></table><h2 id="加深理解"><a href="#加深理解" class="headerlink" title="加深理解"></a>加深理解</h2><ul><li><p>TP和TN为判别器判断正确的情况，把事实上原本的正/负样本正确分类</p></li><li><p>FP 表示把负样本误认成了正样本，表示虚警</p></li><li><p>FN表示把正样本误认成了负样本，表示漏警</p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>机器学习</category>
      
      <category>基础知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>机器学习</tag>
      
      <tag>性能评估</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -3- 常用命令汇总</title>
    <link href="/2020/02/25/hexo/3_hexo_commands/hexo-commands/"/>
    <url>/2020/02/25/hexo/3_hexo_commands/hexo-commands/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Hexo常用命令与相应说明，相关文档也可以参考<a href="https://hexo.io/zh-cn/docs/commands">官方文档</a>。</p></blockquote><span id="more"></span><h2 id="init"><a href="#init" class="headerlink" title="init"></a>init</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">$ hexo <span class="hljs-keyword">init</span> [folder]<br></code></pre></td></tr></table></figure><blockquote><p>新建网站。如果没有设置 <code>folder</code> ，Hexo 默认在目前的文件夹建立网站。</p></blockquote><h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">$ hexo <span class="hljs-keyword">new</span> [layout] &lt;<span class="hljs-built_in">title</span>&gt;<br></code></pre></td></tr></table></figure><blockquote><p>新建文章。如果没有设置 <code>layout</code> 的话，默认使用 <a href="https://hexo.io/zh-cn/docs/configuration">_config.yml</a> 中的 <code>default_layout</code> 参数代替。如果标题包含空格的话，请使用引号括起来。</p></blockquote><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">$ hexo <span class="hljs-keyword">new</span> <span class="hljs-string">&quot;post title with whitespace&quot;</span><br></code></pre></td></tr></table></figure><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-p</code>, <code>--path</code></td><td align="left">自定义新文章的路径</td></tr><tr><td align="left"><code>-r</code>, <code>--replace</code></td><td align="left">如果存在同名文章，将其替换</td></tr><tr><td align="left"><code>-s</code>, <code>--slug</code></td><td align="left">文章的 Slug，作为新文章的文件名和发布后的 URL</td></tr></tbody></table><p>默认情况下，Hexo 会使用文章的标题来决定文章文件的路径。对于独立页面来说，Hexo 会创建一个以标题为名字的目录，并在目录中放置一个 <code>index.md</code> 文件。你可以使用 <code>--path</code> 参数来覆盖上述行为、自行决定文件的目录：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haxe">hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> --path about/me <span class="hljs-string">&quot;About me&quot;</span><br></code></pre></td></tr></table></figure><p>以上命令会创建一个 <code>source/about/me.md</code> 文件，同时 Front Matter 中的 title 为 <code>&quot;About me&quot;</code></p><p>注意！title 是必须指定的！如果你这么做并不能达到你的目的：</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">hexo <span class="hljs-keyword">new</span> page <span class="hljs-comment">--path about/me</span><br></code></pre></td></tr></table></figure><p>此时 Hexo 会创建 <code>source/_posts/about/me.md</code>，同时 <code>me.md</code> 的 Front Matter 中的 title 为 <code>&quot;page&quot;</code>。这是因为在上述命令中，hexo-cli 将 <code>page</code> 视为指定文章的标题、并采用默认的 <code>layout</code>。</p><h2 id="generate"><a href="#generate" class="headerlink" title="generate"></a>generate</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs verilog">$ hexo <span class="hljs-keyword">generate</span><br></code></pre></td></tr></table></figure><p>生成静态文件。</p><table><thead><tr><th align="left">选项</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-d</code>, <code>--deploy</code></td><td align="left">文件生成后立即部署网站</td></tr><tr><td align="left"><code>-w</code>, <code>--watch</code></td><td align="left">监视文件变动</td></tr><tr><td align="left"><code>-b</code>, <code>--bail</code></td><td align="left">生成过程中如果发生任何未处理的异常则抛出异常</td></tr><tr><td align="left"><code>-f</code>, <code>--force</code></td><td align="left">强制重新生成文件 Hexo 引入了差分机制，如果 <code>public</code> 目录存在，那么 <code>hexo g</code> 只会重新生成改动的文件。 使用该参数的效果接近 <code>hexo clean &amp;&amp; hexo generate</code></td></tr><tr><td align="left"><code>-c</code>, <code>--concurrency</code></td><td align="left">最大同时生成文件的数量，默认无限制</td></tr></tbody></table><p>该命令可以简写为</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>hexo g<br></code></pre></td></tr></table></figure><h2 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">$ hexo publish [layout] <span class="hljs-tag">&lt;<span class="hljs-name">filename</span>&gt;</span><br></code></pre></td></tr></table></figure><p>发表草稿。</p><h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs axapta">$ hexo <span class="hljs-keyword">server</span><br></code></pre></td></tr></table></figure><p>启动服务器。默认情况下，访问网址为： <code>http://localhost:4000/</code>。</p><table><thead><tr><th align="left">选项</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-p</code>, <code>--port</code></td><td align="left">重设端口</td></tr><tr><td align="left"><code>-s</code>, <code>--static</code></td><td align="left">只使用静态文件</td></tr><tr><td align="left"><code>-l</code>, <code>--log</code></td><td align="left">启动日记记录，使用覆盖记录格式</td></tr></tbody></table><p>该命令可以简写为</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>hexo s<br></code></pre></td></tr></table></figure><h2 id="deploy"><a href="#deploy" class="headerlink" title="deploy"></a>deploy</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>hexo deploy<br></code></pre></td></tr></table></figure><p>部署网站。</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-g</code>, <code>--generate</code></td><td align="left">部署之前预先生成静态文件</td></tr></tbody></table><p>该命令可以简写为：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>hexo d<br></code></pre></td></tr></table></figure><h2 id="render"><a href="#render" class="headerlink" title="render"></a>render</h2><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">$ hexo render &lt;file1&gt; [file2] ...<br></code></pre></td></tr></table></figure><p>渲染文件。</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>-o</code>, <code>--output</code></td><td align="left">设置输出路径</td></tr></tbody></table><h2 id="migrate"><a href="#migrate" class="headerlink" title="migrate"></a>migrate</h2><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm">$ hexo migrate &lt;<span class="hljs-keyword">type</span>&gt;<br></code></pre></td></tr></table></figure><p>从其他博客系统 <a href="https://hexo.io/zh-cn/docs/migration">迁移内容</a>。</p><h2 id="clean"><a href="#clean" class="headerlink" title="clean"></a>clean</h2><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>hexo clean<br></code></pre></td></tr></table></figure><p>清除缓存文件 (<code>db.json</code>) 和已生成的静态文件 (<code>public</code>)。</p><p>在某些情况（尤其是更换主题后），如果发现您对站点的更改无论如何也不生效，您可能需要运行该命令。</p><h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm">$ hexo list &lt;<span class="hljs-keyword">type</span>&gt;<br></code></pre></td></tr></table></figure><p>列出网站资料。</p><h2 id="version"><a href="#version" class="headerlink" title="version"></a>version</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$ hexo <span class="hljs-built_in">version</span><br></code></pre></td></tr></table></figure><p>显示 Hexo 版本。</p><h2 id="常用组合命令"><a href="#常用组合命令" class="headerlink" title="常用组合命令"></a>常用组合命令</h2><blockquote><p>清除缓存、重新生成静态文件</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean &amp;&amp; hexo g<br></code></pre></td></tr></table></figure><blockquote><p>清除缓存、重新生成静态文件、同时部署</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean &amp;&amp; hexo g -d<br></code></pre></td></tr></table></figure><h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><h3 id="安全模式"><a href="#安全模式" class="headerlink" title="安全模式"></a>安全模式</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">$ hexo <span class="hljs-comment">--safe</span><br></code></pre></td></tr></table></figure><p>在安全模式下，不会载入插件和脚本。当您在安装新插件遭遇问题时，可以尝试以安全模式重新执行。</p><h3 id="调试模式"><a href="#调试模式" class="headerlink" title="调试模式"></a>调试模式</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">$ hexo <span class="hljs-comment">--debug</span><br></code></pre></td></tr></table></figure><p>在终端中显示调试信息并记录到 <code>debug.log</code>。当您碰到问题时，可以尝试用调试模式重新执行一次，并 <a href="https://github.com/hexojs/hexo/issues/new">提交调试信息到 GitHub</a>。</p><h3 id="简洁模式"><a href="#简洁模式" class="headerlink" title="简洁模式"></a>简洁模式</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">$ hexo <span class="hljs-comment">--silent</span><br></code></pre></td></tr></table></figure><p>隐藏终端信息。</p><h3 id="自定义配置文件的路径"><a href="#自定义配置文件的路径" class="headerlink" title="自定义配置文件的路径"></a>自定义配置文件的路径</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs verilog"># 使用 custom<span class="hljs-variable">.yml</span> 代替默认的 <span class="hljs-number">_</span><span class="hljs-keyword">config</span><span class="hljs-variable">.yml</span><br>$ hexo server --<span class="hljs-keyword">config</span> custom<span class="hljs-variable">.yml</span><br><br># 使用 custom<span class="hljs-variable">.yml</span> 和 custom2<span class="hljs-variable">.json</span>，其中 custom2<span class="hljs-variable">.json</span> 优先级更高<br>$ hexo <span class="hljs-keyword">generate</span> --<span class="hljs-keyword">config</span> custom<span class="hljs-variable">.yml</span>,custom2<span class="hljs-variable">.json</span>,custom3<span class="hljs-variable">.yml</span><br></code></pre></td></tr></table></figure><p>自定义配置文件的路径，指定这个参数后将不再使用默认的 <code>_config.yml</code>。<br>你可以使用一个 YAML 或 JSON 文件的路径，也可以使用逗号分隔（无空格）的多个 YAML 或 JSON 文件的路径。例如：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs verilog"># 使用 custom<span class="hljs-variable">.yml</span> 代替默认的 <span class="hljs-number">_</span><span class="hljs-keyword">config</span><span class="hljs-variable">.yml</span><br>$ hexo server --<span class="hljs-keyword">config</span> custom<span class="hljs-variable">.yml</span><br><br># 使用 custom<span class="hljs-variable">.yml</span>, custom2<span class="hljs-variable">.json</span> 和 custom3<span class="hljs-variable">.yml</span>，其中 custom3<span class="hljs-variable">.yml</span> 优先级最高，其次是 custom2<span class="hljs-variable">.json</span><br>$ hexo <span class="hljs-keyword">generate</span> --<span class="hljs-keyword">config</span> custom<span class="hljs-variable">.yml</span>,custom2<span class="hljs-variable">.json</span>,custom3<span class="hljs-variable">.yml</span><br></code></pre></td></tr></table></figure><p>当你指定了多个配置文件以后，Hexo 会按顺序将这部分配置文件合并成一个 <code>_multiconfig.yml</code>。如果遇到重复的配置，排在后面的文件的配置会覆盖排在前面的文件的配置。这个原则适用于任意数量、任意深度的 YAML 和 JSON 文件。</p><h3 id="显示草稿"><a href="#显示草稿" class="headerlink" title="显示草稿"></a>显示草稿</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">$ hexo <span class="hljs-comment">--draft</span><br></code></pre></td></tr></table></figure><p>显示 <code>source/_drafts</code> 文件夹中的草稿文章。</p><h3 id="自定义-CWD"><a href="#自定义-CWD" class="headerlink" title="自定义 CWD"></a>自定义 CWD</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ hexo --cwd <span class="hljs-regexp">/path/</span>to/cwd<br></code></pre></td></tr></table></figure><p>自定义当前工作目录（Current working directory）的路径。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - xlrd,xlwt模块操作excel文件</title>
    <link href="/2020/02/25/python/python_xlrd_xlwt/python-xlrd-xlwt/"/>
    <url>/2020/02/25/python/python_xlrd_xlwt/python-xlrd-xlwt/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Python输出的数据用Excel文件查看往往更直观，而且Excel中的数据也常常需要读取到Python程序中。Python的xlrd和xlwt模块便是为此而生。文本记录这两个模块的使用方法。</p></blockquote><span id="more"></span><h2 id="测试用例"><a href="#测试用例" class="headerlink" title="测试用例"></a>测试用例</h2><blockquote><p>使用read_test.xlsx作为读取excel的测试文件。其中两个工作表，分别为：</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210817102055.png"></p><p><img src="https://photos.zywvvd.com/win11-mt/20210817102115.png"></p><h2 id="模块安装"><a href="#模块安装" class="headerlink" title="模块安装"></a>模块安装</h2><blockquote><p>用pip可以方便地安装</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install xlrd<br>pip install xlwt<br></code></pre></td></tr></table></figure><h2 id="xlrd"><a href="#xlrd" class="headerlink" title="xlrd"></a>xlrd</h2><h3 id="读取excel文件（xls，xlsx）"><a href="#读取excel文件（xls，xlsx）" class="headerlink" title="读取excel文件（xls，xlsx）"></a>读取excel文件（xls，xlsx）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> xlrd<br><br><br><span class="hljs-comment">## 读取excel文件</span><br><span class="hljs-keyword">try</span>:<br>    data = xlrd.open_workbook(<span class="hljs-string">&#x27;read_test.xlsx&#x27;</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-built_in">print</span>(err)<br></code></pre></td></tr></table></figure><h3 id="获取工作表信息"><a href="#获取工作表信息" class="headerlink" title="获取工作表信息"></a>获取工作表信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 获取工作表信息</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(data.sheets()))<br>sheet_names = data.sheet_names()<br><span class="hljs-built_in">print</span>(sheet_names)<br><br>&gt;&gt;&gt;<span class="hljs-number">2</span><br>[<span class="hljs-string">&#x27;信息表2&#x27;</span>, <span class="hljs-string">&#x27;信息表1&#x27;</span>]<br></code></pre></td></tr></table></figure><h3 id="获取工作表内容"><a href="#获取工作表内容" class="headerlink" title="获取工作表内容"></a>获取工作表内容</h3><h4 id="通过索引"><a href="#通过索引" class="headerlink" title="通过索引"></a>通过索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 通过索引获取工作表内容</span><br>info_sheet_1 = data.sheet_by_index(<span class="hljs-number">0</span>)<br>info_sheet_2 = data.sheet_by_index(<span class="hljs-number">1</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;sheet :<span class="hljs-subst">&#123;info_sheet_1.name&#125;</span>  row_num: <span class="hljs-subst">&#123;info_sheet_1.nrows&#125;</span> column_num: <span class="hljs-subst">&#123;info_sheet_1.ncols&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;sheet :<span class="hljs-subst">&#123;info_sheet_2.name&#125;</span>  row_num: <span class="hljs-subst">&#123;info_sheet_2.nrows&#125;</span> column_num: <span class="hljs-subst">&#123;info_sheet_2.ncols&#125;</span>&#x27;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>sheet :信息表<span class="hljs-number">1</span>  row_num: <span class="hljs-number">5</span> column_num: <span class="hljs-number">7</span><br>sheet :信息表<span class="hljs-number">2</span>  row_num: <span class="hljs-number">5</span> column_num: <span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><h4 id="通过名称"><a href="#通过名称" class="headerlink" title="通过名称"></a>通过名称</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 通过名称获取工作表内容</span><br>sheet_names = data.sheet_names()<br>info_sheet_1 = data.sheet_by_name(sheet_names[<span class="hljs-number">0</span>])<br>info_sheet_2 = data.sheet_by_name(sheet_names[<span class="hljs-number">1</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;sheet :<span class="hljs-subst">&#123;info_sheet_1.name&#125;</span>  row_num: <span class="hljs-subst">&#123;info_sheet_1.nrows&#125;</span> column_num: <span class="hljs-subst">&#123;info_sheet_1.ncols&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;sheet :<span class="hljs-subst">&#123;info_sheet_2.name&#125;</span>  row_num: <span class="hljs-subst">&#123;info_sheet_2.nrows&#125;</span> column_num: <span class="hljs-subst">&#123;info_sheet_2.ncols&#125;</span>&#x27;</span>)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>sheet :信息表<span class="hljs-number">1</span>  row_num: <span class="hljs-number">5</span> column_num: <span class="hljs-number">7</span><br>sheet :信息表<span class="hljs-number">2</span>  row_num: <span class="hljs-number">5</span> column_num: <span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><h3 id="获取工作表中数据内容"><a href="#获取工作表中数据内容" class="headerlink" title="获取工作表中数据内容"></a>获取工作表中数据内容</h3><h4 id="获取工作表行信息"><a href="#获取工作表行信息" class="headerlink" title="获取工作表行信息"></a>获取工作表行信息</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 获取工作表行信息</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(info_sheet_1.nrows):<br>    <span class="hljs-built_in">print</span>(info_sheet_1.row_values(i))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(info_sheet_2.nrows):<br>    <span class="hljs-built_in">print</span>(info_sheet_2.row_values(i))<br>    <br><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-string">&#x27;信息表 1&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br>[<span class="hljs-string">&#x27;姓名&#x27;</span>, <span class="hljs-string">&#x27;性别&#x27;</span>, <span class="hljs-string">&#x27;年龄&#x27;</span>, <span class="hljs-string">&#x27;籍贯&#x27;</span>, <span class="hljs-string">&#x27;手机&#x27;</span>, <span class="hljs-string">&#x27;邮箱&#x27;</span>, <span class="hljs-string">&#x27;备注&#x27;</span>]<br>[<span class="hljs-string">&#x27;淑芬&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">32.0</span>, <span class="hljs-string">&#x27;山东&#x27;</span>, <span class="hljs-number">12345678900.0</span>, <span class="hljs-string">&#x27;Shufen@163.com&#x27;</span>, <span class="hljs-string">&#x27;爱好读书&#x27;</span>]<br>[<span class="hljs-string">&#x27;建国&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">43.0</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-number">13265498700.0</span>, <span class="hljs-string">&#x27;Jianguo@126.com&#x27;</span>, <span class="hljs-string">&#x27;儿女双全&#x27;</span>]<br>[<span class="hljs-string">&#x27;大胖&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">18.0</span>, <span class="hljs-string">&#x27;甘肃&#x27;</span>, <span class="hljs-number">12435698700.0</span>, <span class="hljs-string">&#x27;Dapang@110.com&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br>[<span class="hljs-string">&#x27;信息表 2&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br>[<span class="hljs-string">&#x27;姓名&#x27;</span>, <span class="hljs-string">&#x27;性别&#x27;</span>, <span class="hljs-string">&#x27;年龄&#x27;</span>, <span class="hljs-string">&#x27;籍贯&#x27;</span>, <span class="hljs-string">&#x27;手机&#x27;</span>, <span class="hljs-string">&#x27;邮箱&#x27;</span>, <span class="hljs-string">&#x27;备注&#x27;</span>]<br>[<span class="hljs-string">&#x27;三凤&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-number">28.0</span>, <span class="hljs-string">&#x27;河南&#x27;</span>, <span class="hljs-number">12388678900.0</span>, <span class="hljs-string">&#x27;sanfeng@163.com&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br>[<span class="hljs-string">&#x27;王聪&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">31.0</span>, <span class="hljs-string">&#x27;浙江&#x27;</span>, <span class="hljs-number">13266498700.0</span>, <span class="hljs-string">&#x27;Wangcong@119.com&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br>[<span class="hljs-string">&#x27;Lilei&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-number">22.0</span>, <span class="hljs-string">&#x27;Australia&#x27;</span>, <span class="hljs-number">12499998700.0</span>, <span class="hljs-string">&#x27;Lilei@130.com&#x27;</span>, <span class="hljs-string">&#x27;英语流利&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="获取工作表列信息"><a href="#获取工作表列信息" class="headerlink" title="获取工作表列信息"></a>获取工作表列信息</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 获取工作表列信息</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(info_sheet_1.ncols):<br>    <span class="hljs-built_in">print</span>(info_sheet_1.col_values(i))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(info_sheet_2.ncols):<br>    <span class="hljs-built_in">print</span>(info_sheet_2.col_values(i))<br>    <br>&gt;&gt;&gt;[<span class="hljs-string">&#x27;信息表 1&#x27;</span>, <span class="hljs-string">&#x27;姓名&#x27;</span>, <span class="hljs-string">&#x27;淑芬&#x27;</span>, <span class="hljs-string">&#x27;建国&#x27;</span>, <span class="hljs-string">&#x27;大胖&#x27;</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;性别&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;年龄&#x27;</span>, <span class="hljs-number">32.0</span>, <span class="hljs-number">43.0</span>, <span class="hljs-number">18.0</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;籍贯&#x27;</span>, <span class="hljs-string">&#x27;山东&#x27;</span>, <span class="hljs-string">&#x27;北京&#x27;</span>, <span class="hljs-string">&#x27;甘肃&#x27;</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;手机&#x27;</span>, <span class="hljs-number">12345678900.0</span>, <span class="hljs-number">13265498700.0</span>, <span class="hljs-number">12435698700.0</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;邮箱&#x27;</span>, <span class="hljs-string">&#x27;Shufen@163.com&#x27;</span>, <span class="hljs-string">&#x27;Jianguo@126.com&#x27;</span>, <span class="hljs-string">&#x27;Dapang@110.com&#x27;</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;备注&#x27;</span>, <span class="hljs-string">&#x27;爱好读书&#x27;</span>, <span class="hljs-string">&#x27;儿女双全&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br>[<span class="hljs-string">&#x27;信息表 2&#x27;</span>, <span class="hljs-string">&#x27;姓名&#x27;</span>, <span class="hljs-string">&#x27;三凤&#x27;</span>, <span class="hljs-string">&#x27;王聪&#x27;</span>, <span class="hljs-string">&#x27;Lilei&#x27;</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;性别&#x27;</span>, <span class="hljs-string">&#x27;女&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>, <span class="hljs-string">&#x27;男&#x27;</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;年龄&#x27;</span>, <span class="hljs-number">28.0</span>, <span class="hljs-number">31.0</span>, <span class="hljs-number">22.0</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;籍贯&#x27;</span>, <span class="hljs-string">&#x27;河南&#x27;</span>, <span class="hljs-string">&#x27;浙江&#x27;</span>, <span class="hljs-string">&#x27;Australia&#x27;</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;手机&#x27;</span>, <span class="hljs-number">12388678900.0</span>, <span class="hljs-number">13266498700.0</span>, <span class="hljs-number">12499998700.0</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;邮箱&#x27;</span>, <span class="hljs-string">&#x27;sanfeng@163.com&#x27;</span>, <span class="hljs-string">&#x27;Wangcong@119.com&#x27;</span>, <span class="hljs-string">&#x27;Lilei@130.com&#x27;</span>]<br>[<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;备注&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;英语流利&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="获取工作表指定位置信息"><a href="#获取工作表指定位置信息" class="headerlink" title="获取工作表指定位置信息"></a>获取工作表指定位置信息</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 获取工作表指定位置信息</span><br><span class="hljs-built_in">print</span>(info_sheet_1.cell(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>).value) <br><span class="hljs-built_in">print</span>(info_sheet_1.cell_value(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>))<br><span class="hljs-built_in">print</span>(info_sheet_1.row(<span class="hljs-number">2</span>)[<span class="hljs-number">1</span>].value)<br><span class="hljs-built_in">print</span>(info_sheet_1.row_values(<span class="hljs-number">2</span>)[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(info_sheet_1.col(<span class="hljs-number">1</span>)[<span class="hljs-number">2</span>].value)<br><span class="hljs-built_in">print</span>(info_sheet_1.col_values(<span class="hljs-number">1</span>)[<span class="hljs-number">2</span>])<br><br>&gt;&gt;&gt;女<br>女<br>女<br>女<br>女<br>女<br></code></pre></td></tr></table></figure><h4 id="获取工作表中数据的类型"><a href="#获取工作表中数据的类型" class="headerlink" title="获取工作表中数据的类型"></a>获取工作表中数据的类型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 获取工作表中数据的类型</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(info_sheet_1.ncols):<br>    <span class="hljs-built_in">print</span>(info_sheet_1.cell(<span class="hljs-number">2</span>,i).ctype) <br>    <br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">1</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">1</span><br><span class="hljs-number">2</span><br><span class="hljs-number">1</span><br><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><blockquote><p># 说明：ctype : 0 empty,1 string, 2 number, 3 date, 4 boolean, 5 error</p></blockquote><h4 id="获取合并单元格信息"><a href="#获取合并单元格信息" class="headerlink" title="获取合并单元格信息"></a>获取合并单元格信息</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 获取合并单元格信息</span><br><span class="hljs-built_in">print</span>(info_sheet_1.merged_cells)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>[(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">7</span>)]<br></code></pre></td></tr></table></figure><blockquote><p>这返回的四个数字定位了一组合并单元格操作，如果把四个数表示为(A,B,C,D)，可以这样理解：</p><ul><li>合并单元格的起始（左上角）单元格（在合并区域内）坐标为[A,C]</li><li>合并单元格的结束（右下角）单元格（在合并区域外）坐标为[B,D]</li></ul></blockquote><h2 id="xlwt"><a href="#xlwt" class="headerlink" title="xlwt"></a>xlwt</h2><h3 id="建立xlwt对象"><a href="#建立xlwt对象" class="headerlink" title="建立xlwt对象"></a>建立xlwt对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> xlwt<br><br><span class="hljs-comment">## 建立xlwt对象</span><br>wb = xlwt.Workbook()<br></code></pre></td></tr></table></figure><h3 id="建立工作表"><a href="#建立工作表" class="headerlink" title="建立工作表"></a>建立工作表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 建立工作表</span><br>test_sheet_1 = xlsx_writer.add_sheet(<span class="hljs-string">&#x27;Test Sheet 1&#x27;</span>) <br>test_sheet_2 = xlsx_writer.add_sheet(<span class="hljs-string">&#x27;Test Sheet 2&#x27;</span>) <br><br><span class="hljs-keyword">try</span>:<br>    xlsx_writer.save(<span class="hljs-string">&#x27;write_test.xlsx&#x27;</span>)   <span class="hljs-comment"># 保存xlsx</span><br>    xlsx_writer.save(<span class="hljs-string">&#x27;write_test.xls&#x27;</span>)   <span class="hljs-comment"># 保存xls</span><br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-built_in">print</span>(err)<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/win11-mt/20210817102209.png"></p><h3 id="向数据表写入内容"><a href="#向数据表写入内容" class="headerlink" title="向数据表写入内容"></a>向数据表写入内容</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 向数据表写入内容</span><br>test_sheet_1.write(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">123</span>)<br>test_sheet_1.write(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">110</span>)<br>test_sheet_1.write(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,xlwt.Formula(<span class="hljs-string">&quot;B2+C2&quot;</span>))<br>test_sheet_1.write(<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;test&#x27;</span>)<br>test_sheet_1.write(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-literal">True</span>)<br>test_sheet_2.write(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,xlwt.Formula(<span class="hljs-string">&quot;&#x27;&#123;&#125;&#x27;!$B$2+&#x27;&#123;&#125;&#x27;!$D$2&quot;</span>.<span class="hljs-built_in">format</span>(test_sheet_1.name,test_sheet_1.name)))<br><br><span class="hljs-keyword">try</span>:<br>    xlsx_writer.save(<span class="hljs-string">&#x27;write_test.xlsx&#x27;</span>)   <span class="hljs-comment"># 保存xlsx</span><br>    xlsx_writer.save(<span class="hljs-string">&#x27;write_test.xls&#x27;</span>)   <span class="hljs-comment"># 保存xls</span><br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-built_in">print</span>(err)<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/win11-mt/20210817102138.png"></p><p><img src="https://photos.zywvvd.com/win11-mt/20210817102151.png"></p><h3 id="设置列宽、行高"><a href="#设置列宽、行高" class="headerlink" title="设置列宽、行高"></a>设置列宽、行高</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 设置列宽、行高</span><br>test_sheet_1.col(<span class="hljs-number">0</span>).width = <span class="hljs-number">400</span>*<span class="hljs-number">30</span> <br>test_sheet_1.row(<span class="hljs-number">0</span>).height = <span class="hljs-number">1000</span> <br><span class="hljs-keyword">try</span>:<br>    xlsx_writer.save(<span class="hljs-string">&#x27;write_test.xlsx&#x27;</span>)   <span class="hljs-comment"># 保存xlsx</span><br>    xlsx_writer.save(<span class="hljs-string">&#x27;write_test.xls&#x27;</span>)   <span class="hljs-comment"># 保存xls</span><br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-built_in">print</span>(err)<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/win11-mt/20210817102222.png"></p><h3 id="设置内容样式"><a href="#设置内容样式" class="headerlink" title="设置内容样式"></a>设置内容样式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## 初始化样式</span><br>style = xlwt.XFStyle()  <span class="hljs-comment"># 样式类实例</span><br><br><span class="hljs-comment">## 创建字体</span><br>font = xlwt.Font() <span class="hljs-comment"># 字体类实例</span><br>font.name = <span class="hljs-string">&#x27;Times New Roman&#x27;</span> <span class="hljs-comment"># 字体名称</span><br>font.bold = <span class="hljs-literal">True</span> <span class="hljs-comment"># 加粗</span><br>font.italic =<span class="hljs-literal">True</span> <span class="hljs-comment"># 倾斜</span><br>font.height = <span class="hljs-number">300</span> <span class="hljs-comment"># 字号 200 为 10 points</span><br>font.colour_index=<span class="hljs-number">3</span> <span class="hljs-comment"># 颜色编码</span><br><br><span class="hljs-comment">## 创建边框</span><br>borders= xlwt.Borders() <span class="hljs-comment"># 边框类实例</span><br>borders.left= <span class="hljs-number">6</span><br>borders.right= <span class="hljs-number">6</span><br>borders.top= <span class="hljs-number">6</span><br>borders.bottom= <span class="hljs-number">6</span><br><br><span class="hljs-comment">## 创建对齐</span><br>alignment = xlwt.Alignment() <span class="hljs-comment"># 对齐类实例</span><br><span class="hljs-comment">#alignment.horz = xlwt.Alignment.HORZ_LEFT    # 水平左对齐</span><br><span class="hljs-comment">#alignment.horz = xlwt.Alignment.HORZ_RIGHT     # 水平右对齐</span><br>alignment.horz = xlwt.Alignment.HORZ_CENTER      <span class="hljs-comment"># 水平居中 </span><br><span class="hljs-comment">#alignment.vert = xlwt.Alignment.VERT_TOP  # 垂直靠上</span><br><span class="hljs-comment">#alignment.vert = xlwt.Alignment.VERT_BOTTOM  # 垂直靠下</span><br>alignment.vert = xlwt.Alignment.VERT_CENTER      <span class="hljs-comment"># 垂直居中 </span><br>alignment.wrap = <span class="hljs-number">1</span>      <span class="hljs-comment"># 自动换行</span><br><br><span class="hljs-comment">## 创建模式</span><br>pattern = xlwt.Pattern() <span class="hljs-comment"># 模式类实例</span><br>pattern.pattern = xlwt.Pattern.SOLID_PATTERN <span class="hljs-comment"># 固定的样式</span><br>pattern.pattern_fore_colour = xlwt.Style.colour_map[<span class="hljs-string">&#x27;yellow&#x27;</span>] <span class="hljs-comment"># 背景颜色</span><br><br><span class="hljs-comment">## 应用样式</span><br>style.font = font<br>style.borders = borders<br>style.num_format_str = <span class="hljs-string">&#x27;#,##0.0000&#x27;</span> <span class="hljs-comment"># 内容格式</span><br>style.alignment = alignment<br>style.pattern=pattern<br><br><span class="hljs-comment">## 合并单元格(A,B,C,D) 表示合并左上角[A,C]和右下角[B,D]单元格坐标(均在合并单元格内部)</span><br>test_sheet_1.write_merge(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27; Merge &#x27;</span>,style) <span class="hljs-comment"># &#x27; Merge &#x27; 为写入内容，应用 style 样式</span><br><br>test_sheet_1.write(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1234567.890123</span>,style) <span class="hljs-comment"># 向[0,0]坐标单元格写入数据，应用style样式</span><br><br>style.num_format_str = <span class="hljs-string">&#x27;#,##0.000%&#x27;</span> <span class="hljs-comment"># 内容格式</span><br>test_sheet_1.write(<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">67.8123456</span>,style) <span class="hljs-comment"># 整数部分用逗号分隔，小数部分保留3位小数并以百分数表示</span><br><br>style.num_format_str = <span class="hljs-string">&#x27;###%&#x27;</span> <span class="hljs-comment"># 内容格式</span><br>test_sheet_1.write(<span class="hljs-number">6</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0.128</span>,style) <br><br>style.num_format_str = <span class="hljs-string">&#x27;###.##%&#x27;</span> <span class="hljs-comment"># 内容格式</span><br>test_sheet_1.write(<span class="hljs-number">6</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0.128</span>,style) <br><br>style.num_format_str = <span class="hljs-string">&#x27;000.00%&#x27;</span> <span class="hljs-comment"># 内容格式</span><br>test_sheet_1.write(<span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0.128</span>,style) <br><br><span class="hljs-keyword">try</span>:<br>    xlsx_writer.save(<span class="hljs-string">&#x27;write_test.xlsx&#x27;</span>)   <span class="hljs-comment"># 保存xlsx</span><br>    xlsx_writer.save(<span class="hljs-string">&#x27;write_test.xls&#x27;</span>)   <span class="hljs-comment"># 保存xls</span><br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> err:<br>    <span class="hljs-built_in">print</span>(err)<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/win11-mt/20210817102233.png"></p><h2 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h2><blockquote><p>文中测试环境与所有源码可在<a href="https://github.com/zywvvd/Python_Practise">Github</a>下载。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - 获取文件夹内所有文件</title>
    <link href="/2020/02/25/python/file_list/python-file-list/"/>
    <url>/2020/02/25/python/file_list/python-file-list/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录Python 获取指定文件夹内所有文件的方法。</p></blockquote><span id="more"></span><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><blockquote><p>新建了3个文件夹和11个文件</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210816095433.png"></p><h2 id="glob"><a href="#glob" class="headerlink" title="glob"></a>glob</h2><blockquote><p>glob模块可以返回指定路径（可绝对/可相对）下的符合制定匹配模式的文件路径。</p><ul><li><code>*</code> ： 匹配0或多个任意字符</li><li><code>?</code>： 匹配单个字符</li><li><code>[]</code>： 匹配范围内的字符（如<code>[a-d]</code>匹配a,b,c,d）</li></ul></blockquote><h3 id="glob-glob"><a href="#glob-glob" class="headerlink" title="glob.glob"></a>glob.glob</h3><blockquote><p> 返回所有匹配文件路径列表，参数为pathname，该参数中定义路径匹配规则。</p></blockquote><p>用例1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> glob<br>file_path=<span class="hljs-string">&#x27;*&#x27;</span><br><span class="hljs-built_in">print</span>(glob.glob(file_path))<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;3b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2b&#x27;</span>, <span class="hljs-string">&#x27;2a&#x27;</span>, <span class="hljs-string">&#x27;1a&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3a&#x27;</span>, <span class="hljs-string">&#x27;glob_test.py&#x27;</span>, <span class="hljs-string">&#x27;1b&#x27;</span>]<br></code></pre></td></tr></table></figure><p>用例2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> glob<br>file_path=<span class="hljs-string">&#x27;*[0-9]&#x27;</span><br><span class="hljs-built_in">print</span>(glob.glob(file_path))<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;d2&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;d3&#x27;</span>, <span class="hljs-string">&#x27;d1&#x27;</span>]<br></code></pre></td></tr></table></figure><p>用例3</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> glob<br>file_path=<span class="hljs-string">&#x27;?&#x27;</span><br><span class="hljs-built_in">print</span>(glob.glob(file_path))<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>]<br></code></pre></td></tr></table></figure><p>用例4</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> glob<br>file_path=<span class="hljs-string">&#x27;*b&#x27;</span><br><span class="hljs-built_in">print</span>(glob.glob(file_path))<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-string">&#x27;3b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;2b&#x27;</span>, <span class="hljs-string">&#x27;1b&#x27;</span>]<br></code></pre></td></tr></table></figure><h3 id="glob-iglob"><a href="#glob-iglob" class="headerlink" title="glob.iglob"></a>glob.iglob</h3><blockquote><p>iglob返回<em>generator</em>对象，每次调用返回一个路径。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> glob<br>file_path=<span class="hljs-string">&#x27;*&#x27;</span><br>generator=glob.iglob(file_path)<br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> generator:<br>    <span class="hljs-built_in">print</span>(item)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">3</span><br>a<br>3b<br>d2<br>b<br><span class="hljs-number">1</span><br>2b<br>2a<br>1a<br><span class="hljs-number">2</span><br>d3<br>3a<br>glob_test.py<br>d1<br>1b<br></code></pre></td></tr></table></figure><h2 id="OS"><a href="#OS" class="headerlink" title="OS"></a>OS</h2><blockquote><p>glob方便好用，但是从上述用例输出可以看出glob难以区分文件夹和文件，只识别名称，虽然绝大多数情况文件有后缀，为以往万一，在此补充OS返回指定文件夹下文件名的方法。</p></blockquote><h3 id="OS-walk"><a href="#OS-walk" class="headerlink" title="OS.walk"></a>OS.walk</h3><blockquote><p>OS.walk(filepath) 返回指定目录下所有目录、文件、子目录下的目录、文件。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br>filePath = <span class="hljs-string">&#x27;.&#x27;</span><br><span class="hljs-keyword">for</span> i,j,k <span class="hljs-keyword">in</span> os.walk(filePath):<br>    <span class="hljs-built_in">print</span>(i,j,k)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>. [<span class="hljs-string">&#x27;d2&#x27;</span>, <span class="hljs-string">&#x27;d3&#x27;</span>, <span class="hljs-string">&#x27;d1&#x27;</span>] [<span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;3b&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2b&#x27;</span>, <span class="hljs-string">&#x27;2a&#x27;</span>, <span class="hljs-string">&#x27;1a&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3a&#x27;</span>, <span class="hljs-string">&#x27;glob_test.py&#x27;</span>, <span class="hljs-string">&#x27;1b&#x27;</span>]<br>./d2 [] []<br>./d3 [] []<br>./d1 [] []<br></code></pre></td></tr></table></figure><blockquote><ul><li>i：父目录路径</li><li>j：父目录内文件夹</li><li>k：父目录内文件</li></ul></blockquote><h3 id="os-listdir"><a href="#os-listdir" class="headerlink" title="os.listdir"></a>os.listdir</h3><blockquote><p>os.listdir(filepath)和glob.glob(‘*’)效果类似，返回文件夹下所有文件与文件夹名。</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">filePath = <span class="hljs-string">&#x27;.&#x27;</span>    <br><span class="hljs-built_in">print</span>(os.listdir(filePath))<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;3b&#x27;</span>, <span class="hljs-string">&#x27;d2&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2b&#x27;</span>, <span class="hljs-string">&#x27;2a&#x27;</span>, <span class="hljs-string">&#x27;1a&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;d3&#x27;</span>, <span class="hljs-string">&#x27;3a&#x27;</span>, <span class="hljs-string">&#x27;glob_test.py&#x27;</span>, <span class="hljs-string">&#x27;d1&#x27;</span>, <span class="hljs-string">&#x27;1b&#x27;</span>]<br></code></pre></td></tr></table></figure><h2 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h2><blockquote><p>文中测试环境与所有源码可在<a href="https://github.com/zywvvd/Python_Practise">Github</a>下载。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>文件处理</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python - DOM操作XML技巧汇总</title>
    <link href="/2020/02/24/python/processing_xml/python-xml/"/>
    <url>/2020/02/24/python/processing_xml/python-xml/</url>
    
    <content type="html"><![CDATA[<blockquote><p>XML已经成为数据传输存储使用越来越广泛的数据格式，本文讲述使用Python DOM处理XML文件的方法。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>安装Python</li><li><a href="https://www.zywvvd.com/zywvvd.github.io/2020/02/24/course/words/XML/xml-%E6%95%99%E7%A8%8B/">XML基础知识</a></li></ul><h2 id="Python常用处理XML库"><a href="#Python常用处理XML库" class="headerlink" title="Python常用处理XML库"></a>Python常用处理XML库</h2><blockquote><p> 常见的 XML 编程接口有 DOM 和 SAX，这两种接口处理 XML 文件的方式不同，当然使用场合也不同。Python 有三种方法解析 XML，SAX，DOM，以及 ElementTree:</p></blockquote><h3 id="DOM-Document-Object-Model-本文介绍"><a href="#DOM-Document-Object-Model-本文介绍" class="headerlink" title="DOM(Document Object Model) - 本文介绍"></a>DOM(Document Object Model) - 本文介绍</h3><p>DOM (Document Object Model) 译为文档对象模型，是 HTML 和 XML 文档的编程接口。HTML DOM 定义了访问和操作 HTML 文档的标准方法。将 XML 数据在内存中解析成一个树，通过对树的操作来操作XML。</p><h3 id="SAX-simple-API-for-XML"><a href="#SAX-simple-API-for-XML" class="headerlink" title="SAX (simple API for XML )"></a>SAX (simple API for XML )</h3><p>Python 标准库包含 SAX 解析器，SAX 用事件驱动模型，通过在解析XML的过程中触发一个个的事件并调用用户定义的回调函数来处理XML文件。</p><h3 id="ElementTree-元素树"><a href="#ElementTree-元素树" class="headerlink" title="ElementTree(元素树)"></a>ElementTree(元素树)</h3><p>ElementTree就像一个轻量级的DOM，具有方便友好的API。代码可用性好，速度快，消耗内存少。</p><h2 id="测试用例"><a href="#测试用例" class="headerlink" title="测试用例"></a>测试用例</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="hljs-comment">&lt;!--file name &quot;test.xml&quot; 2020.2.24 by VVD--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;info science&quot;</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;Coding&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>C++Primer<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>StanleyB.Lippman<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>60.0<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2009<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;Computer&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>编译原理<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>AlfredV.Aho<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>70.0<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2013<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="Python-DOM-解析XML"><a href="#Python-DOM-解析XML" class="headerlink" title="Python DOM 解析XML"></a>Python DOM 解析XML</h2><h3 id="DOM节点树"><a href="#DOM节点树" class="headerlink" title="DOM节点树"></a>DOM节点树</h3><blockquote><p>一个 DOM 的解析器在解析一个 XML 文档时，一次性读取整个文档，把文档中所有元素保存在内存中的一个树结构里。</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210813232342.gif"></p><h4 id="节点级别"><a href="#节点级别" class="headerlink" title="节点级别"></a>节点级别</h4><blockquote><p>节点树中的节点彼此之间都有等级关系。</p></blockquote><ul><li>在节点树中，顶端的节点成为根节点</li><li>根节点之外的每个节点都有一个父节点</li><li>节点可以有任何数量的子节点</li><li>叶子是没有子节点的节点</li><li>同级节点是拥有相同父节点的节点</li></ul><h3 id="解析XML"><a href="#解析XML" class="headerlink" title="解析XML"></a>解析XML</h3><blockquote><p>python 加载DOM解析XML，并输出整个XML</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#加载DOM minidom模块</span><br><span class="hljs-keyword">from</span> xml.dom.minidom <span class="hljs-keyword">import</span> parse<br><br><span class="hljs-comment">#解析XML文件</span><br>contents=parse(<span class="hljs-string">&#x27;test.xml&#x27;</span>)<br>root=contents.documentElement<br><br><span class="hljs-built_in">print</span>(root.toxml())<br><br>&gt;&gt;&gt;&lt;bookstore <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;info science&quot;</span>&gt;<br><br>&lt;book category=<span class="hljs-string">&quot;Coding&quot;</span>&gt;<br>&lt;title&gt;C++Primer&lt;/title&gt;<br>&lt;author&gt;StanleyB.Lippman&lt;/author&gt;<br>&lt;price&gt;<span class="hljs-number">60.0</span>&lt;/price&gt;<br>        &lt;year&gt;<span class="hljs-number">2009</span>&lt;/year&gt;<br>&lt;/book&gt;<br><br>&lt;book category=<span class="hljs-string">&quot;Computer&quot;</span>&gt;<br>&lt;title&gt;编译原理&lt;/title&gt;<br>&lt;author&gt;AlfredV.Aho&lt;/author&gt;<br>&lt;price&gt;<span class="hljs-number">70.0</span>&lt;/price&gt;<br>        &lt;year&gt;<span class="hljs-number">2013</span>&lt;/year&gt;<br>&lt;/book&gt;<br><br>&lt;/bookstore&gt;<br></code></pre></td></tr></table></figure><blockquote><p>此时root获取了XML文件中所有内容，组织成了一棵树，root就是该树的根节点</p></blockquote><h3 id="获取节点名称"><a href="#获取节点名称" class="headerlink" title="获取节点名称"></a>获取节点名称</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取节点名称</span><br><span class="hljs-built_in">print</span>(root.nodeName)<br><span class="hljs-built_in">print</span>(root.tagName)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>bookstore<br>bookstore<br></code></pre></td></tr></table></figure><h3 id="获取子节点"><a href="#获取子节点" class="headerlink" title="获取子节点"></a>获取子节点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取子节点</span><br>children_Nodes=root.childNodes<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;子节点个数：<span class="hljs-subst">&#123;children_Nodes.length&#125;</span>&#x27;</span>)<br><br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> children_Nodes:<br>    <span class="hljs-built_in">print</span> (item.toxml())<br>    <br><span class="hljs-meta">&gt;&gt;&gt; </span>子节点个数：<span class="hljs-number">5</span><br><br><br><br>&lt;book category=<span class="hljs-string">&quot;Coding&quot;</span>&gt;<br>&lt;title&gt;C++Primer&lt;/title&gt;<br>&lt;author&gt;StanleyB.Lippman&lt;/author&gt;<br>&lt;price&gt;<span class="hljs-number">60.0</span>&lt;/price&gt;<br>        &lt;year&gt;<span class="hljs-number">2009</span>&lt;/year&gt;<br>&lt;/book&gt;<br><br><br><br>&lt;book category=<span class="hljs-string">&quot;Computer&quot;</span>&gt;<br>&lt;title&gt;编译原理&lt;/title&gt;<br>&lt;author&gt;AlfredV.Aho&lt;/author&gt;<br>&lt;price&gt;<span class="hljs-number">70.0</span>&lt;/price&gt;<br>        &lt;year&gt;<span class="hljs-number">2013</span>&lt;/year&gt;<br>&lt;/book&gt;<br><br></code></pre></td></tr></table></figure><h3 id="节点类型"><a href="#节点类型" class="headerlink" title="节点类型"></a>节点类型</h3><blockquote><p>为什么2本书却有5个节点？</p><p>因为两本书前中后各有一个回车，被划为文本节点。</p><p>DOM规定节点：</p><ol><li>整个文档是一个文档节点</li><li>每个 XML 标签是一个元素节点</li><li>包含在 XML 元素中的文本是文本节点</li><li>每一个 XML 属性是一个属性节点</li><li>注释属于注释节点</li></ol></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210813232424.png"></p><h4 id="文本总是存储在文本节点中"><a href="#文本总是存储在文本节点中" class="headerlink" title="文本总是存储在文本节点中"></a>文本总是存储在文本节点中</h4><blockquote><p> 在 DOM 处理中一个普遍的错误是，认为元素节点包含文本。</p><p> 不过，元素节点的文本是存储在文本节点中的。</p><p> 在这个例子中：<code>&lt;year&gt;2005&lt;/year&gt;</code>，元素节点 <code>&lt;year&gt;</code>，拥有一个值为 “2005” 的文本节点。</p><p> “2005” 不是 <code>&lt;year&gt;</code> 元素的值！d</p></blockquote><h3 id="获取节点属性"><a href="#获取节点属性" class="headerlink" title="获取节点属性"></a>获取节点属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取节点属性</span><br><span class="hljs-built_in">print</span>(root.attributes.items())<br>atr_root=root.attributes[<span class="hljs-string">&#x27;type&#x27;</span>]<br><span class="hljs-built_in">print</span>(atr_root.name)<br><span class="hljs-built_in">print</span>(atr_root.value)<br><br>&gt;&gt;&gt;[(<span class="hljs-string">&#x27;type&#x27;</span>, <span class="hljs-string">&#x27;info science&#x27;</span>)]<br><span class="hljs-built_in">type</span><br>info science<br></code></pre></td></tr></table></figure><h3 id="获取指定名称的节点"><a href="#获取指定名称的节点" class="headerlink" title="获取指定名称的节点"></a>获取指定名称的节点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取指定名称的节点</span><br>books=root.getElementsByTagName(<span class="hljs-string">&#x27;book&#x27;</span>)<br><br><span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:<br>    <span class="hljs-built_in">print</span> (book.nodeName)<br>    <br>&gt;&gt;&gt;book<br>book<br></code></pre></td></tr></table></figure><h3 id="判断是否包含属性值"><a href="#判断是否包含属性值" class="headerlink" title="判断是否包含属性值"></a>判断是否包含属性值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#判断是否包含属性值</span><br><span class="hljs-built_in">print</span>(books[<span class="hljs-number">0</span>].hasAttribute(<span class="hljs-string">&#x27;nnn&#x27;</span>))<br><span class="hljs-built_in">print</span>(books[<span class="hljs-number">0</span>].hasAttribute(<span class="hljs-string">&#x27;category&#x27;</span>))<br><br>&gt;&gt;&gt;<span class="hljs-literal">False</span><br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><h3 id="获取节点指定属性的属性值"><a href="#获取节点指定属性的属性值" class="headerlink" title="获取节点指定属性的属性值"></a>获取节点指定属性的属性值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取节点指定属性的属性值</span><br><span class="hljs-built_in">print</span>(books[<span class="hljs-number">0</span>].getAttribute(<span class="hljs-string">&#x27;category&#x27;</span>))<br><span class="hljs-built_in">print</span>(books[<span class="hljs-number">1</span>].getAttribute(<span class="hljs-string">&#x27;category&#x27;</span>))<br><br>&gt;&gt;&gt;Coding<br>Computer<br></code></pre></td></tr></table></figure><h3 id="获取节点文本值"><a href="#获取节点文本值" class="headerlink" title="获取节点文本值"></a>获取节点文本值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#获取节点文本值</span><br>node=books[<span class="hljs-number">0</span>]<br>author=node.getElementsByTagName(<span class="hljs-string">&#x27;author&#x27;</span>)<br><span class="hljs-built_in">print</span>(author[<span class="hljs-number">0</span>].firstChild.data)<br><br>&gt;&gt;&gt;StanleyB.Lippman<br></code></pre></td></tr></table></figure><h3 id="判断是否有子节点"><a href="#判断是否有子节点" class="headerlink" title="判断是否有子节点"></a>判断是否有子节点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#判断是否有子节点</span><br><span class="hljs-built_in">print</span>(root.hasChildNodes())<br><span class="hljs-built_in">print</span>(author[<span class="hljs-number">0</span>].hasChildNodes())<br><span class="hljs-built_in">print</span>(author[<span class="hljs-number">0</span>].firstChild.hasChildNodes())<br><br>&gt;&gt;&gt;<span class="hljs-literal">True</span><br><span class="hljs-literal">True</span><br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><h3 id="DOM解析XML方法总结"><a href="#DOM解析XML方法总结" class="headerlink" title="DOM解析XML方法总结"></a>DOM解析XML方法总结</h3><ul><li>contents = xml.dom.minidom.parse(filename)：加载读取XML文件</li><li>node = contents.documentElement：获取XML文档对象</li><li>node.getAttribute(AttributeName)：获取XML节点属性值</li><li>node.getElementsByTagName(TagName)：获取XML节点对象集合</li><li>node.childNodes ：返回子节点列表。</li><li>node.childNodes[index].nodeValue：获取XML节点值</li><li>node.firstChild：访问第一个节点，等价于pagexml.childNodes[0]</li><li>node.toxml(‘UTF-8’)返回Node节点的xml表示的文本：</li><li>访问元素属性：<br>atr=Node.attributes[“id”]<br>atr.name # “id”<br>atr.value #属性的值</li><li>node.nodeName/node.tagName：节点的名称</li><li>node.nodeValue：节点的值，文本节点才有值，其它节点返回的是None</li><li>node.nodeType：节点的类型</li></ul><h2 id="Python-DOM-修改XML"><a href="#Python-DOM-修改XML" class="headerlink" title="Python DOM 修改XML"></a>Python DOM 修改XML</h2><h3 id="生成XML树、添加属性"><a href="#生成XML树、添加属性" class="headerlink" title="生成XML树、添加属性"></a>生成XML树、添加属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> xml.dom <span class="hljs-keyword">import</span> minidom<br><br><span class="hljs-comment">#1.创建DOM树对象</span><br>dom=minidom.Document()<br><span class="hljs-comment"># 2.创建根节点。每次都要用DOM对象来创建任何节点。</span><br>root_node=dom.createElement(<span class="hljs-string">&#x27;root&#x27;</span>)<br><span class="hljs-comment"># 3.用DOM对象添加根节点</span><br>dom.appendChild(root_node)<br><span class="hljs-comment"># 用DOM对象创建元素子节点</span><br>book_node=dom.createElement(<span class="hljs-string">&#x27;book&#x27;</span>)<br><span class="hljs-comment"># 用父节点对象添加元素子节点</span><br>root_node.appendChild(book_node)<br><span class="hljs-comment"># 设置该节点的属性</span><br>book_node.setAttribute(<span class="hljs-string">&#x27;price&#x27;</span>,<span class="hljs-string">&#x27;399&#x27;</span>)<br>name_node=dom.createElement(<span class="hljs-string">&#x27;name&#x27;</span>)<br>book_node.appendChild(name_node)<br><span class="hljs-comment"># 也用DOM创建文本节点，把文本节点（文字内容）看成子节点</span><br>name_text=dom.createTextNode(<span class="hljs-string">&#x27;C++ Primer 第1版&#x27;</span>)<br><span class="hljs-comment"># 用添加了文本的节点对象（看成文本节点的父节点）添加文本节点</span><br>name_node.appendChild(name_text)<br><br><span class="hljs-built_in">print</span>(dom.toxml()) <span class="hljs-comment">#字符格式输出</span><br><span class="hljs-built_in">print</span>(dom.toprettyxml()) <span class="hljs-comment">#美丽的输出</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;&lt;root&gt;&lt;book price=<span class="hljs-string">&quot;399&quot;</span>&gt;&lt;name&gt;C++ Primer 第<span class="hljs-number">1</span>版&lt;/name&gt;&lt;/book&gt;&lt;/root&gt;<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;<br>&lt;root&gt;<br>&lt;book price=<span class="hljs-string">&quot;399&quot;</span>&gt;<br>&lt;name&gt;C++ Primer 第<span class="hljs-number">1</span>版&lt;/name&gt;<br>&lt;/book&gt;<br>&lt;/root&gt;<br></code></pre></td></tr></table></figure><h3 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#增加要删除的节点</span><br>another_node=dom.createElement(<span class="hljs-string">&#x27;delete&#x27;</span>)<br>another_node_child=dom.createElement(<span class="hljs-string">&#x27;content&#x27;</span>)<br>another_node_child_text=dom.createTextNode(<span class="hljs-string">&#x27;testing data&#x27;</span>)<br>another_node_child.appendChild(another_node_child_text)<br>another_node.appendChild(another_node_child)<br>root_node.appendChild(another_node)<br><span class="hljs-built_in">print</span>(dom.toprettyxml())<br><br>&gt;&gt;&gt;&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;<br>&lt;root&gt;<br>&lt;book price=<span class="hljs-string">&quot;399&quot;</span>&gt;<br>&lt;name&gt;C++ Primer 第<span class="hljs-number">1</span>版&lt;/name&gt;<br>&lt;/book&gt;<br>&lt;delete&gt;<br>&lt;content&gt;testing data&lt;/content&gt;<br>&lt;/delete&gt;<br>&lt;/root&gt;<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#删除上文增加的节点</span><br>children_Nodes=root_node.childNodes<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(children_Nodes.length-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> children_Nodes[i].tagName==<span class="hljs-string">&#x27;delete&#x27;</span>:<br>        children_Nodes.remove(children_Nodes[i]) <span class="hljs-comment">#删除root中的文本节点</span><br><br><span class="hljs-built_in">print</span>(dom.toprettyxml())<br>        <br><span class="hljs-meta">&gt;&gt;&gt; </span>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;<br>&lt;root&gt;<br>&lt;book price=<span class="hljs-string">&quot;399&quot;</span>&gt;<br>&lt;name&gt;C++ Primer 第<span class="hljs-number">1</span>版&lt;/name&gt;<br>&lt;/book&gt;<br>&lt;/root&gt;<br><br></code></pre></td></tr></table></figure><h3 id="删除节点属性"><a href="#删除节点属性" class="headerlink" title="删除节点属性"></a>删除节点属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#删除节点属性</span><br>book_node.setAttribute(<span class="hljs-string">&#x27;price&#x27;</span>,<span class="hljs-string">&#x27;199&#x27;</span>)<br><span class="hljs-built_in">print</span>(book_node.hasAttribute(<span class="hljs-string">&#x27;price&#x27;</span>))<br><span class="hljs-built_in">print</span>(book_node.getAttribute(<span class="hljs-string">&#x27;price&#x27;</span>))<br>book_node.removeAttribute(<span class="hljs-string">&#x27;price&#x27;</span>)<br><span class="hljs-built_in">print</span>(book_node.hasAttribute(<span class="hljs-string">&#x27;price&#x27;</span>))<br><br>&gt;&gt;&gt;<span class="hljs-literal">True</span><br><span class="hljs-number">199</span><br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><h3 id="修改节点内容"><a href="#修改节点内容" class="headerlink" title="修改节点内容"></a>修改节点内容</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#修改节点内容</span><br>children_Nodes=root_node.childNodes<br>name_Append = <span class="hljs-string">&#x27; (中文版)&#x27;</span><br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> children_Nodes:<br>    <span class="hljs-comment">#print (item.toxml())</span><br>    tag_name=<span class="hljs-string">&#x27;name&#x27;</span><br>    c_name = item.getElementsByTagName(tag_name)<br>    <span class="hljs-built_in">print</span>(c_name[<span class="hljs-number">0</span>].firstChild.data)<br>    c_name[<span class="hljs-number">0</span>].firstChild.data+=name_Append<br><span class="hljs-built_in">print</span>(dom.toprettyxml())<br>    <br>    &gt;&gt;&gt;C++ Primer 第<span class="hljs-number">1</span>版<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;<br>&lt;root&gt;<br>&lt;book&gt;<br>&lt;name&gt;C++ Primer 第<span class="hljs-number">1</span>版 (中文版)&lt;/name&gt;<br>&lt;/book&gt;<br>&lt;/root&gt;<br><br></code></pre></td></tr></table></figure><h3 id="修改节点属性"><a href="#修改节点属性" class="headerlink" title="修改节点属性"></a>修改节点属性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#修改节点属性</span><br>book_node.setAttribute(<span class="hljs-string">&#x27;price&#x27;</span>,<span class="hljs-string">&#x27;199&#x27;</span>)<br><span class="hljs-built_in">print</span>(book_node.hasAttribute(<span class="hljs-string">&#x27;price&#x27;</span>))<br><span class="hljs-built_in">print</span>(book_node.getAttribute(<span class="hljs-string">&#x27;price&#x27;</span>))<br><br>book_node.setAttribute(<span class="hljs-string">&#x27;price&#x27;</span>,<span class="hljs-string">&#x27;399&#x27;</span>)<br><span class="hljs-built_in">print</span>(book_node.getAttribute(<span class="hljs-string">&#x27;price&#x27;</span>))<br><br>book_node.setAttribute(<span class="hljs-string">&#x27;price2&#x27;</span>,<span class="hljs-string">&#x27;599&#x27;</span>)<br><span class="hljs-built_in">print</span>(book_node.attributes.items())<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-literal">True</span><br><span class="hljs-number">199</span><br><span class="hljs-number">399</span><br>[(<span class="hljs-string">&#x27;price&#x27;</span>, <span class="hljs-string">&#x27;399&#x27;</span>), (<span class="hljs-string">&#x27;price2&#x27;</span>, <span class="hljs-string">&#x27;599&#x27;</span>)]<br></code></pre></td></tr></table></figure><h3 id="修改节点名称-可用、不安全"><a href="#修改节点名称-可用、不安全" class="headerlink" title="修改节点名称(可用、不安全)"></a>修改节点名称(可用、不安全)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#修改节点名称(可用、不安全)</span><br>name_node=dom.createElement(<span class="hljs-string">&#x27;name&#x27;</span>)<br>name_node.nodeName=<span class="hljs-string">&#x27;node name&#x27;</span><br>name_node.tagName=<span class="hljs-string">&#x27;tag name&#x27;</span><br>root_node.appendChild(name_node)<br><span class="hljs-built_in">print</span>(dom.toxml())<br><span class="hljs-built_in">print</span>(name_node.nodeName)<br><span class="hljs-built_in">print</span>(name_node.localName)<br><span class="hljs-comment">#删掉刚刚增加的测试节点</span><br>children_Nodes=root_node.childNodes<br>children_Nodes.remove(children_Nodes[<span class="hljs-number">1</span>])<br><br>&gt;&gt;&gt;&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> ?&gt;&lt;root&gt;&lt;book price=<span class="hljs-string">&quot;399&quot;</span> price2=<span class="hljs-string">&quot;599&quot;</span>&gt;&lt;name&gt;C++ Primer 第<span class="hljs-number">1</span>版 (中文版)&lt;/name&gt;&lt;/book&gt;&lt;tag name/&gt;&lt;/root&gt;<br>node name<br>tag name<br></code></pre></td></tr></table></figure><blockquote><p>可以看到，改变tagName在事实上实现了改变节点名称的效果，但nodeName并没有一并更新，使用时需要谨慎。</p></blockquote><h3 id="DOM修改XML方法总结"><a href="#DOM修改XML方法总结" class="headerlink" title="DOM修改XML方法总结"></a>DOM修改XML方法总结</h3><ul><li>dom=minidom.Document()  #创建DOM树对象</li><li>root_node=dom.createElement(‘root’) #用DOM对象创建元素节点</li><li>name_text=dom.createTextNode(‘计算机程序设计语言 第1版’)#用DOM对象创建文本节点</li><li>dom.appendChild(root_node) # 用DOM对象添加节点</li><li>book_node.setAttribute(‘price’,’199’) #添加节点属性（可多个），也可以用来覆盖修改原有的属性</li><li>children_Nodes.remove(children_Nodes[i]) #删除节点</li><li>book_node.removeAttribute(‘price’) #删除节点属性</li><li>price[0].firstChild.data=str(price_float) #直接修改文本节点完成对xml保存内容的修改</li><li>name_node.tagName=’tag name’ #修改节点名称</li></ul><h2 id="Python-DOM-写入XML"><a href="#Python-DOM-写入XML" class="headerlink" title="Python DOM 写入XML"></a>Python DOM 写入XML</h2><h3 id="写入XML"><a href="#写入XML" class="headerlink" title="写入XML"></a>写入XML</h3><blockquote><p> 语法：writexml(writer, indent=””, addindent=””, newl=””, encoding=None)</p></blockquote><ul><li>writer：文件对象</li><li>indent：根节点缩进格式（一般根节点不缩进，所以一般为空）</li><li>addindent：子节点缩进格式（一般为空格<code>    </code>或制表符<code>\t</code>）</li><li>newl：换行格式（一般为换行回车<code>\n</code>)</li><li>encoding：编码方式</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Python DOM 写入XML</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;write_test.xml&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>,encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>) <span class="hljs-keyword">as</span> writer:<br>    dom.writexml(writer,indent=<span class="hljs-string">&#x27;&#x27;</span>,addindent=<span class="hljs-string">&#x27;    &#x27;</span>,newl=<span class="hljs-string">&#x27;\n&#x27;</span>,encoding=<span class="hljs-string">&#x27;UTF-8&#x27;</span>)<br></code></pre></td></tr></table></figure><p>得到xml文件<code>write_test.xml</code>：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">price</span>=<span class="hljs-string">&quot;399&quot;</span> <span class="hljs-attr">price2</span>=<span class="hljs-string">&quot;599&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>C++ Primer 第1版 (中文版)<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h2><blockquote><p>文中测试环境与所有源码可在<a href="https://github.com/zywvvd/Python_Practise">Github</a>下载。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>XML</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>文字编码 - XML 教程</title>
    <link href="/2020/02/24/words/xml/course/xml/"/>
    <url>/2020/02/24/words/xml/course/xml/</url>
    
    <content type="html"><![CDATA[<blockquote><p>XML 指可扩展标记语言，被设计用来传输和存储数据。本文记录XML基础知识。</p><p>教程参考<a href="https://www.w3school.com.cn/xml/index.asp">w3school</a>。</p></blockquote><span id="more"></span><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li>XML 指可扩展标记语言（EXtensible Markup Language）</li><li>XML 是一种标记语言，很类似 HTML</li><li>XML 的设计宗旨是传输数据，而非显示数据</li><li>XML 标签没有被预定义。您需要自行定义标签</li><li>XML 被设计为具有自我描述性。</li><li>XML 是 W3C 的推荐标准</li><li>XML 是没有任何行为的纯文本，仅编码保存数据</li></ul><h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><ul><li>XML 把数据从 HTML 分离</li><li>XML 简化数据共享</li><li>XML 简化数据传输</li><li>XML 简化平台的变更</li></ul><h2 id="XML-树结构"><a href="#XML-树结构" class="headerlink" title="XML 树结构"></a>XML 树结构</h2><blockquote><p>XML 文档形成了一种树结构，它从“根部”开始，然后扩展到“枝叶”。</p></blockquote><ul><li><p>XML 文档必须包含根元素。该元素是所有其他元素的父元素</p></li><li><p>XML 文档中的元素形成了一棵文档树。这棵树从根部开始，并扩展到树的最底端</p></li><li><p>所有元素均可拥有子元素</p></li></ul><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;COOKING&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>Everyday Italian<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Giada De Laurentiis<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>30.00<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;CHILDREN&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;WEB&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>Learning XML<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Erik T. Ray<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2003<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>39.95<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>这段代码表示了具有如下元素框架的三本书。</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210807215251.gif"></p><h2 id="语法规则"><a href="#语法规则" class="headerlink" title="语法规则"></a>语法规则</h2><ul><li><p>所有 XML 元素都须有关闭标签（声明不是XML元素，恰好他又不需要关闭）</p></li><li><p>XML 标签对大小写敏感，必须使用相同的大小写来编写打开标签和关闭标签：</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Message</span>&gt;</span>这是错误的。<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">message</span>&gt;</span>这是正确的。<span class="hljs-tag">&lt;/<span class="hljs-name">message</span>&gt;</span> <br></code></pre></td></tr></table></figure><ul><li>XML 必须正确地嵌套</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>错误嵌套<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>正确嵌套<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>XML 文档必须有根元素</li></ul><blockquote><p>XML 文档必须有一个元素是所有其他元素的父元素。该元素称为根元素。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">child</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">subchild</span>&gt;</span>.....<span class="hljs-tag">&lt;/<span class="hljs-name">subchild</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">child</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>XML 的属性值须加引号</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">note</span> <span class="hljs-attr">date</span>=<span class="hljs-string">08/08/2008</span>&gt;</span>      <span class="hljs-comment">&lt;!-- 错误属性 --&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">note</span> <span class="hljs-attr">date</span>=<span class="hljs-string">&quot;08/08/2008&quot;</span>&gt;</span>      <span class="hljs-comment">&lt;!-- 正确属性 --&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>George<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>John<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span> <br></code></pre></td></tr></table></figure><ul><li>实体引用</li></ul><blockquote><p>在 XML 中，有 5 个预定义的实体引用：</p></blockquote><table><thead><tr><th>&lt;</th><th>&lt;</th><th>小于</th></tr></thead><tbody><tr><td>&gt;</td><td>&gt;</td><td>大于</td></tr><tr><td>&amp;</td><td>&amp;</td><td>和号</td></tr><tr><td>&apos;</td><td>‘</td><td>单引号</td></tr><tr><td>&quot;</td><td>“</td><td>引号</td></tr></tbody></table><ul><li>注释</li></ul><blockquote><p>语法与 HTML 的语法很相似：</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- This is a comment --&gt;</span> <br></code></pre></td></tr></table></figure><ul><li><p>在 XML 中，空格会被保留</p></li><li><p>XML 以 LF 存储换行</p></li></ul><blockquote><p>在 Windows 应用程序中，换行通常以一对字符来存储：回车符 (CR) 和换行符 (LF)。这对字符与打字机设置新行的动作有相似之处。在 Unix 应用程序中，新行以 LF 字符存储。而 Macintosh 应用程序使用 CR 来存储新行。</p></blockquote><h2 id="XML-元素"><a href="#XML-元素" class="headerlink" title="XML 元素"></a>XML 元素</h2><h3 id="XML-元素-1"><a href="#XML-元素-1" class="headerlink" title="XML 元素"></a>XML 元素</h3><blockquote><p>XML 元素指的是从（且包括）开始标签直到（且包括）结束标签的部分。</p><p>元素可包含其他元素、文本或者两者的混合物。元素也可以拥有属性。</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bookstore</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;CHILDREN&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Harry Potter<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>J K. Rowling<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2005<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>29.99<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">book</span> <span class="hljs-attr">category</span>=<span class="hljs-string">&quot;WEB&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Learning XML<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">author</span>&gt;</span>Erik T. Ray<span class="hljs-tag">&lt;/<span class="hljs-name">author</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">year</span>&gt;</span>2003<span class="hljs-tag">&lt;/<span class="hljs-name">year</span>&gt;</span> <br>  <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>39.95<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span> <br><span class="hljs-tag">&lt;/<span class="hljs-name">book</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bookstore</span>&gt;</span> <br></code></pre></td></tr></table></figure><h3 id="XML-命名规则"><a href="#XML-命名规则" class="headerlink" title="XML 命名规则"></a>XML 命名规则</h3><ul><li>名称可以含字母、数字以及其他的字符</li><li>名称不能以数字或者标点符号开始</li><li>名称不能以字符 “xml”（或者 XML、Xml）开始</li><li>名称不能包含空格</li></ul><h3 id="最佳命名习惯"><a href="#最佳命名习惯" class="headerlink" title="最佳命名习惯"></a>最佳命名习惯</h3><ul><li><p>使名称具有描述性。使用下划线的名称也很不错。</p></li><li><p>名称应当比较简短，比如：<book_title>，而不是：<the_title_of_the_book>。</p></li><li><p>避免 “-“ 字符。如果您按照这样的方式进行命名：”first-name”，一些软件会认为你需要提取第一个单词。</p></li><li><p>避免 “.” 字符。如果您按照这样的方式进行命名：”first.name”，一些软件会认为 “name” 是对象 “first” 的属性。</p></li><li><p>避免 “:” 字符。冒号会被转换为命名空间来使用（稍后介绍）。</p></li></ul><h2 id="XML-属性"><a href="#XML-属性" class="headerlink" title="XML 属性"></a>XML 属性</h2><blockquote><p>XML 元素可以在开始标签中包含属性，类似 HTML。属性 (Attribute) 提供关于元素的额外（附加）信息。</p></blockquote><ul><li>XML 属性必须加引号，单引号和双引号均可使用。</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">person</span> <span class="hljs-attr">sex</span>=<span class="hljs-string">&quot;female&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">person</span> <span class="hljs-attr">sex</span>=<span class="hljs-string">&#x27;female&#x27;</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="XML-元素-vs-属性"><a href="#XML-元素-vs-属性" class="headerlink" title="XML 元素 vs. 属性"></a>XML 元素 vs. 属性</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">person</span> <span class="hljs-attr">sex</span>=<span class="hljs-string">&quot;female&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Anna<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>Smith<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">person</span>&gt;</span> <br><br><span class="hljs-tag">&lt;<span class="hljs-name">person</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">sex</span>&gt;</span>female<span class="hljs-tag">&lt;/<span class="hljs-name">sex</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>Anna<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>Smith<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">person</span>&gt;</span> <br></code></pre></td></tr></table></figure><blockquote><p>上述代码表示了同样的信息，也就是说XML中，属性携带的信息量可以被子元素取代。没有什么规矩可以告诉我们什么时候该使用属性，而什么时候该使用子元素。在 HTML 中，属性用起来很便利，但是在 XML 中，您应该尽量避免使用属性。如果信息感觉起来很像数据，那么请使用子元素吧。</p></blockquote><h3 id="XML属性的缺点"><a href="#XML属性的缺点" class="headerlink" title="XML属性的缺点"></a>XML属性的缺点</h3><ul><li>属性无法包含多重的值（元素可以）</li><li>属性无法描述树结构（元素可以）</li><li>属性不易扩展（为未来的变化）</li><li>属性难以阅读和维护</li></ul><h2 id="XML-验证"><a href="#XML-验证" class="headerlink" title="XML 验证"></a>XML 验证</h2><blockquote><p>拥有正确语法的 XML 被称为“形式良好”的 XML。通过 DTD 验证的 XML 是“合法”的 XML。</p></blockquote><h3 id="“形式良好”（Well-Formed）的-XML-文档"><a href="#“形式良好”（Well-Formed）的-XML-文档" class="headerlink" title="“形式良好”（Well Formed）的 XML 文档"></a>“形式良好”（Well Formed）的 XML 文档</h3><ul><li>XML 文档必须有根元素</li><li>XML 文档必须有关闭标签</li><li>XML 标签对大小写敏感</li><li>XML 元素必须被正确的嵌套</li><li>XML 属性必须加引号</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>文字编码</category>
      
    </categories>
    
    
    <tags>
      
      <tag>XML</tag>
      
      <tag>文字编码</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Ubuntu 软件推荐 - 截图利器 flameshot-具有快捷键自由截图、截图涂鸦、截图添加文字等功能</title>
    <link href="/2020/02/24/software/recommend/ubuntu/flameshot/Ubuntu-flameshot/"/>
    <url>/2020/02/24/software/recommend/ubuntu/flameshot/Ubuntu-flameshot/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Ubuntu 在使用过程中经常有截图的需求，自带的截图工具功能单一。我对截图工具的需求是：快捷键自由区域截图、可涂鸦（框、箭头、模糊）、可添加文字、可保存到指定文件夹、可复制到剪贴板、速度快。结合上述特征，推荐大家使用flameshot 0.6+(0.5+版本不带文字工具）。</p></blockquote><span id="more"></span><h2 id="安装方法一（亲测可用）"><a href="#安装方法一（亲测可用）" class="headerlink" title="安装方法一（亲测可用）"></a>安装方法一（亲测可用）</h2><blockquote><p>参考链接：<a href="https://blog.csdn.net/qq_36743482/article/details/94735338">Ubuntu（Debian）截图并编辑软件推荐</a>。</p></blockquote><h3 id="clone-github"><a href="#clone-github" class="headerlink" title="clone github"></a>clone github</h3><blockquote><p>通过github下载源码编译安装，首先在终端进入软件安装的文件夹（我选择了/usr/share/flameshot/，此处需要超级用户权限），clone仓库：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo git clone https://github.com/lupoDharkael/flameshot.git<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/gitclone.png"></p><h3 id="安装依赖库"><a href="#安装依赖库" class="headerlink" title="安装依赖库"></a>安装依赖库</h3><blockquote><p>根据作者在github上的安装介绍，安装Ubuntu（Debian）依赖库：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Compile-time</span><br>sudo apt install g++ build-essential qt5-default qt5-qmake qttools5-dev-tools<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/yilaiku1.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Run-time</span><br>sudo apt install libqt5dbus5 libqt5network5 libqt5core5a libqt5widgets5 libqt5gui5 libqt5svg5-dev<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/yilaiku2.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> Optional</span><br>sudo apt install git openssl ca-certificates<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806230735.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br>sudo apt-get upgrade<br></code></pre></td></tr></table></figure><h3 id="Build-amp-Install"><a href="#Build-amp-Install" class="headerlink" title="Build &amp; Install"></a>Build &amp; Install</h3><blockquote><p>进入flameshot根目录，执行命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo mkdir build<br>cd build<br>qmake ../<br>make<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806230752.png"></p><blockquote><p>继续执行：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo make install<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806230813.png"></p><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><blockquote><p>此时已经成功安装flameshot，输入命令测试并查看程序版本，运行时间（2020.02.24）：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">flameshot --version<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806230833.png"></p><blockquote><p>版本V0.6+即可，执行flameshot命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">flameshot<br></code></pre></td></tr></table></figure><blockquote><p>此时屏幕右上角会出现“火焰截屏”的图标。</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806230851.png"></p><blockquote><p>右键图标，选择设置，勾选文字功能。</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806230910.png"></p><blockquote><p>此时双击火焰图标可以进行截图。</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806230932.png"></p><h3 id="设置键盘快捷键"><a href="#设置键盘快捷键" class="headerlink" title="设置键盘快捷键"></a>设置键盘快捷键</h3><blockquote><p>距离拥有类似QQ截图功能只差一步，打开系统设置，选择设备。</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806230948.png"></p><blockquote><p>键盘-键盘快捷键-滚动条最下面-添加-设置快捷键（我设置的是ctrl+alt+A）</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806231004.png"></p><blockquote><p>之后就可以享受便捷截图的快乐了！</p></blockquote><h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><blockquote><ul><li><p>选区过后可以进行涂鸦、添加文字、模糊等编辑操作</p></li><li><p>通过滚轮改变字号、符号粗细</p></li><li><p>ctrl+S 保存当前截图</p></li><li><p>Enter 当前截图存入剪贴板</p></li><li><p>ctrl+Z 撤销</p></li><li><p>Esc 取消</p></li></ul><p>也可以进入设置界面自行设置</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/20210806231018.png"></p><h2 id="安装方法二"><a href="#安装方法二" class="headerlink" title="安装方法二"></a>安装方法二</h2><blockquote><p>apt安装（未测试）</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo add-apt-repository ppa:rikmills/bionic<br>sudo apt-get update<br>sudo apt install flameshot<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>software</category>
      
      <category>ubuntu</category>
      
    </categories>
    
    
    <tags>
      
      <tag>software</tag>
      
      <tag>ubuntu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -2- 站点信息配置</title>
    <link href="/2020/02/24/hexo/2_hexo_config/Hexo_config/"/>
    <url>/2020/02/24/hexo/2_hexo_config/Hexo_config/</url>
    
    <content type="html"><![CDATA[<blockquote><p> Hexo框架中配置文件内容描述与示例。</p></blockquote><span id="more"></span><h2 id="config-yml-站点配置文件"><a href="#config-yml-站点配置文件" class="headerlink" title="_config.yml - 站点配置文件"></a>_config.yml - 站点配置文件</h2><blockquote><p>在各种Hexo相关教程中频繁出现<code>站点配置文件</code>，指的是Hexo根目录中的文件<code>_config.yml</code>。</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/zhandianpeizhiwenjian.png"></p><blockquote><p>具体内容也可以参考<a href="https://hexo.io/zh-cn/docs/configuration">官方文档</a>。</p></blockquote><ul><li>注意：配置过程中每一项的<code>英文冒号</code>后需要一个<code>空格</code>。</li></ul><h2 id="Site-网站"><a href="#Site-网站" class="headerlink" title="Site - 网站"></a>Site - 网站</h2><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>title</code></td><td align="left">网站标题</td></tr><tr><td align="left"><code>subtitle</code></td><td align="left">网站副标题</td></tr><tr><td align="left"><code>description</code></td><td align="left">网站描述</td></tr><tr><td align="left"><code>keywords</code></td><td align="left">网站的关键词。使用半角逗号 <code>,</code> 分隔多个关键词。</td></tr><tr><td align="left"><code>author</code></td><td align="left">您的名字</td></tr><tr><td align="left"><code>language</code></td><td align="left">网站使用的语言 (<code>初始建议此处设置为zh-Hans，便于后续稳定翻译</code>)</td></tr><tr><td align="left"><code>timezone</code></td><td align="left">网站时区。Hexo 默认使用您电脑的时区。请参考 <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">时区列表</a> 进行设置，如 <code>America/New_York</code>, <code>Japan</code>, 和 <code>UTC</code> 。一般的，对于中国大陆地区可以使用 <code>Asia/Shanghai</code>。</td></tr></tbody></table><ul><li>这部分是我们刚刚建站时需要设置的部分，建议修改。以我的站点配置为例：</li></ul><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Site</span><br><span class="hljs-attr">title:</span> <span class="hljs-string">又见苍岚</span><br><span class="hljs-attr">subtitle:</span> <span class="hljs-string">&#x27;www.zywvvd.com&#x27;</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Stay hungury ! Stay foolish ！&#x27;</span><br><span class="hljs-attr">keywords:</span> <span class="hljs-string">&#x27;人工智能, 深度学习, 个人博客&#x27;</span><br><span class="hljs-attr">author:</span> <span class="hljs-string">Yiwei</span> <span class="hljs-string">Zhang</span><br><span class="hljs-attr">language:</span> <span class="hljs-string">zh-Hans</span><br><span class="hljs-attr">timezone:</span> <span class="hljs-string">Asia/Shanghai</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/title.png"></p><h2 id="URL-网址"><a href="#URL-网址" class="headerlink" title="URL - 网址"></a>URL - 网址</h2><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left">默认值</th></tr></thead><tbody><tr><td align="left"><code>url</code></td><td align="left">网址</td><td align="left"></td></tr><tr><td align="left"><code>root</code></td><td align="left">网站根目录</td><td align="left"></td></tr><tr><td align="left"><code>permalink</code></td><td align="left">文章的 <a href="https://hexo.io/zh-cn/docs/permalinks">永久链接</a> 格式</td><td align="left"><code>:year/:month/:day/:title/</code></td></tr><tr><td align="left"><code>permalink_defaults</code></td><td align="left">永久链接中各部分的默认值</td><td align="left"></td></tr><tr><td align="left"><code>pretty_urls</code></td><td align="left">改写 <a href="https://hexo.io/zh-cn/docs/variables"><code>permalink</code></a> 的值来美化 URL</td><td align="left"></td></tr><tr><td align="left"><code>pretty_urls.trailing_index</code></td><td align="left">是否在永久链接中保留尾部的 <code>index.html</code>，设置为 <code>false</code> 时去除</td><td align="left"><code>true</code></td></tr><tr><td align="left"><code>pretty_urls.trailing_html</code></td><td align="left">是否在永久链接中保留尾部的 <code>.html</code>, 设置为 <code>false</code> 时去除 (<em>对尾部的 <code>index.html</code>无效</em>)</td><td align="left"></td></tr></tbody></table><ul><li>url 和 root 需要关联到挂载的服务器目录</li></ul><blockquote><p>修改<code>站点配置文件</code>，填入网址设置：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># URL</span><br><span class="hljs-comment">## If your site is put in a subdirectory, set url as &#x27;http://yoursite.com/child&#x27; and root as &#x27;/child/&#x27;</span><br><span class="hljs-attr">url:</span> <span class="hljs-string">http://github.com/&lt;Github账号&gt;/&lt;Github账号&gt;.github.io</span><br><span class="hljs-attr">root:</span> <span class="hljs-string">/&lt;Github账号&gt;.github.io/</span><br></code></pre></td></tr></table></figure><ul><li>修改文章永久链接</li></ul><blockquote><p>默认文章路径类似： <a href="https://www.zywvvd.com/2020/02/27/hexo/xxx">https://www.zywvvd.com/2020/02/27/hexo/xxx</a></p><p>这是因为文章链接配置<code>permalink</code>值默认为<code>:year/:month/:day/:title/</code></p><p>不喜欢此种形式链接的同学可以自定义修改，例如：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">permalink:</span> <span class="hljs-string">:category/:title/</span><br></code></pre></td></tr></table></figure><blockquote><p>可以使用如下变量和 Front-matter 中的所有属性。</p></blockquote><table><thead><tr><th align="left">变量</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>:year</code></td><td align="left">文章的发表年份（4 位数）</td></tr><tr><td align="left"><code>:month</code></td><td align="left">文章的发表月份（2 位数）</td></tr><tr><td align="left"><code>:i_month</code></td><td align="left">文章的发表月份（去掉开头的零）</td></tr><tr><td align="left"><code>:day</code></td><td align="left">文章的发表日期 (2 位数)</td></tr><tr><td align="left"><code>:i_day</code></td><td align="left">文章的发表日期（去掉开头的零）</td></tr><tr><td align="left"><code>:hour</code></td><td align="left">文章发表时的小时 (2 位数)</td></tr><tr><td align="left"><code>:minute</code></td><td align="left">文章发表时的分钟 (2 位数)</td></tr><tr><td align="left"><code>:title</code></td><td align="left">文件名称</td></tr><tr><td align="left"><code>:post_title</code></td><td align="left">文章标题</td></tr><tr><td align="left"><code>:id</code></td><td align="left">文章 ID (<em>not persistent across <a href="https://hexo.io/zh-cn/docs/commands#clean">cache reset</a></em>)</td></tr><tr><td align="left"><code>:category</code></td><td align="left">分类。如果文章没有分类，则是 <code>default_category</code> 配置信息。</td></tr></tbody></table><h2 id="Directory-目录"><a href="#Directory-目录" class="headerlink" title="Directory - 目录"></a>Directory - 目录</h2><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left">默认值</th></tr></thead><tbody><tr><td align="left"><code>source_dir</code></td><td align="left">资源文件夹，这个文件夹用来存放内容。</td><td align="left"><code>source</code></td></tr><tr><td align="left"><code>public_dir</code></td><td align="left">公共文件夹，这个文件夹用于存放生成的站点文件。</td><td align="left"><code>public</code></td></tr><tr><td align="left"><code>tag_dir</code></td><td align="left">标签文件夹</td><td align="left"><code>tags</code></td></tr><tr><td align="left"><code>archive_dir</code></td><td align="left">归档文件夹</td><td align="left"><code>archives</code></td></tr><tr><td align="left"><code>category_dir</code></td><td align="left">分类文件夹</td><td align="left"><code>categories</code></td></tr><tr><td align="left"><code>code_dir</code></td><td align="left">Include code 文件夹，<code>source_dir</code> 下的子目录</td><td align="left"><code>downloads/code</code></td></tr><tr><td align="left"><code>i18n_dir</code></td><td align="left">国际化（i18n）文件夹</td><td align="left"><code>:lang</code></td></tr><tr><td align="left"><code>skip_render</code></td><td align="left">跳过指定文件的渲染。匹配到的文件将会被不做改动地复制到 <code>public</code> 目录中。您可使用 <a href="https://github.com/micromatch/micromatch#extended-globbing">glob 表达式</a>来匹配路径。</td><td align="left"></td></tr></tbody></table><h2 id="Writing-文章"><a href="#Writing-文章" class="headerlink" title="Writing - 文章"></a>Writing - 文章</h2><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left">默认值</th></tr></thead><tbody><tr><td align="left"><code>new_post_name</code></td><td align="left">新文章的文件名称</td><td align="left">:title.md</td></tr><tr><td align="left"><code>default_layout</code></td><td align="left">预设布局</td><td align="left">post</td></tr><tr><td align="left"><code>auto_spacing</code></td><td align="left">在中文和英文之间加入空格</td><td align="left">false</td></tr><tr><td align="left"><code>titlecase</code></td><td align="left">把标题转换为 title case</td><td align="left">false</td></tr><tr><td align="left"><code>external_link</code></td><td align="left">在新标签中打开链接</td><td align="left">true</td></tr><tr><td align="left"><code>external_link.enable</code></td><td align="left">在新标签中打开链接</td><td align="left"><code>true</code></td></tr><tr><td align="left"><code>external_link.field</code></td><td align="left">对整个网站（<code>site</code>）生效或仅对文章（<code>post</code>）生效</td><td align="left"><code>site</code></td></tr><tr><td align="left"><code>external_link.exclude</code></td><td align="left">需要排除的域名。主域名和子域名如 <code>www</code> 需分别配置</td><td align="left"><code>[]</code></td></tr><tr><td align="left"><code>filename_case</code></td><td align="left">把文件名称转换为 (1) 小写或 (2) 大写</td><td align="left">0</td></tr><tr><td align="left"><code>render_drafts</code></td><td align="left">显示草稿</td><td align="left">false</td></tr><tr><td align="left"><code>post_asset_folder</code></td><td align="left">启动 <a href="https://hexo.io/zh-cn/docs/asset-folders">Asset 文件夹</a> (建议设置为 True )</td><td align="left">false</td></tr><tr><td align="left"><code>relative_link</code></td><td align="left">把链接改为与根目录的相对位址</td><td align="left">false</td></tr><tr><td align="left"><code>future</code></td><td align="left">显示未来的文章</td><td align="left">true</td></tr><tr><td align="left"><code>highlight</code></td><td align="left">代码块的设置</td><td align="left"></td></tr><tr><td align="left"><code>highlight.enable</code></td><td align="left">开启代码块高亮</td><td align="left"><code>true</code></td></tr><tr><td align="left"><code>highlight.auto_detect</code></td><td align="left">如果未指定语言，则启用自动检测</td><td align="left"><code>false</code></td></tr><tr><td align="left"><code>highlight.line_number</code></td><td align="left">显示行数 <em>Enabling this option will also enable <code>wrap</code> option</em></td><td align="left"><code>true</code></td></tr><tr><td align="left"><code>highlight.tab_replace</code></td><td align="left">用 n 个空格替换 tabs；如果值为空，则不会替换 tabs</td><td align="left"><code>&#39;&#39;</code></td></tr><tr><td align="left"><code>highlight.wrap</code></td><td align="left">Wrap the code block in <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/table">``</a></td><td align="left"><code>true</code></td></tr><tr><td align="left"><code>highlight.hljs</code></td><td align="left">Use the <code>hljs-*</code> prefix for CSS classes</td><td align="left"><code>false</code></td></tr></tbody></table><ul><li><code>post_asset_folder</code>修改为true，这样新建文章时会创建同名文件夹，便于后期博客图片等资源管理</li></ul><h2 id="Category-amp-Tag-分类-amp-标签"><a href="#Category-amp-Tag-分类-amp-标签" class="headerlink" title="Category &amp; Tag - 分类 &amp; 标签"></a>Category &amp; Tag - 分类 &amp; 标签</h2><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left">默认值</th></tr></thead><tbody><tr><td align="left"><code>default_category</code></td><td align="left">默认分类</td><td align="left"><code>uncategorized</code></td></tr><tr><td align="left"><code>category_map</code></td><td align="left">分类别名</td><td align="left"></td></tr><tr><td align="left"><code>tag_map</code></td><td align="left">标签别名</td><td align="left"></td></tr></tbody></table><h2 id="Date-Time-format-日期-时间格式"><a href="#Date-Time-format-日期-时间格式" class="headerlink" title="Date / Time format - 日期 / 时间格式"></a>Date / Time format - 日期 / 时间格式</h2><p>Hexo 使用 <a href="http://momentjs.com/">Moment.js</a> 来解析和显示时间。</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left">默认值</th></tr></thead><tbody><tr><td align="left"><code>date_format</code></td><td align="left">日期格式</td><td align="left"><code>YYYY-MM-DD</code></td></tr><tr><td align="left"><code>time_format</code></td><td align="left">时间格式</td><td align="left"><code>HH:mm:ss</code></td></tr><tr><td align="left"><code>use_date_for_updated</code></td><td align="left">启用以后，如果 Front Matter 中没有指定 <code>updated</code>， <a href="https://hexo.io/zh-cn/docs/variables#%E9%A1%B5%E9%9D%A2%E5%8F%98%E9%87%8F"><code>post.updated</code></a> 将会使用 <code>date</code> 的值而不是文件的创建时间。在 Git 工作流中这个选项会很有用</td><td align="left"><code>true</code></td></tr></tbody></table><h2 id="Pagination-分页"><a href="#Pagination-分页" class="headerlink" title="Pagination - 分页"></a>Pagination - 分页</h2><table><thead><tr><th align="left">参数</th><th align="left">描述</th><th align="left">默认值</th></tr></thead><tbody><tr><td align="left"><code>per_page</code></td><td align="left">每页显示的文章量 (0 = 关闭分页功能)</td><td align="left"><code>10</code></td></tr><tr><td align="left"><code>pagination_dir</code></td><td align="left">分页目录</td><td align="left"><code>page</code></td></tr></tbody></table><h2 id="Extensions-扩展"><a href="#Extensions-扩展" class="headerlink" title="Extensions - 扩展"></a>Extensions - 扩展</h2><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>theme</code></td><td align="left">当前主题名称。值为<code>false</code>时禁用主题</td></tr><tr><td align="left"><code>theme_config</code></td><td align="left">主题的配置文件。在这里放置的配置会覆盖主题目录下的 <code>_config.yml</code> 中的配置</td></tr><tr><td align="left"><code>deploy</code></td><td align="left">部署部分的设置</td></tr><tr><td align="left"><code>meta_generator</code></td><td align="left"><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta#%E5%B1%9E%E6%80%A7">Meta generator</a> 标签。 值为 <code>false</code> 时 Hexo 不会在头部插入该标签</td></tr></tbody></table><ul><li>更换主题时改变theme的值为主题名称</li></ul><h3 id="Include-Exclude-file-s-包括或不包括目录和文件"><a href="#Include-Exclude-file-s-包括或不包括目录和文件" class="headerlink" title="Include / Exclude file(s) - 包括或不包括目录和文件"></a>Include / Exclude file(s) - 包括或不包括目录和文件</h3><blockquote><p> 在 Hexo 配置文件中，通过设置 include/exclude 可以让 Hexo 进行处理或忽略某些目录和文件夹。你可以使用 <a href="https://github.com/isaacs/minimatch">glob 表达式</a> 对目录和文件进行匹配。</p></blockquote><p><code>include</code> and <code>exclude</code> options only apply to the <code>source/</code> folder, whereas <code>ignore</code> option applies to all folders.</p><table><thead><tr><th align="left">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>include</code></td><td align="left">Hexo 默认会忽略隐藏文件和文件夹（包括名称以下划线和 <code>.</code> 开头的文件和文件夹，Hexo 的 <code>_posts</code> 和 <code>_data</code> 等目录除外）。通过设置此字段将使 Hexo 处理他们并将它们复制到 <code>source</code> 目录下。</td></tr><tr><td align="left"><code>exclude</code></td><td align="left">Hexo 会忽略这些文件和目录</td></tr><tr><td align="left"><code>ignore</code></td><td align="left">Ignore files/folders</td></tr></tbody></table><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Next -1- 主题安装</title>
    <link href="/2020/02/24/hexo-theme/next/1_theme_install/Next-install/"/>
    <url>/2020/02/24/hexo-theme/next/1_theme_install/Next-install/</url>
    
    <content type="html"><![CDATA[<blockquote><p>next 是 Hexo 当前最流行的主题，其简约优雅的风格和对多种插件的原生支持使其备受青睐。我本人也是next主题的用户，接下来将由本篇开启next安装美化的系列文章，保证从安装Hexo开始只要安装系列文章操作，你也可以达拥有同样效果的博客。</p><p>本文主要记录Next主题的安装和常用的美化方法，有疑问欢迎在评论区交流。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li>安装Hexo，<a href="https://www.zywvvd.com/zywvvd.github.io/2020/02/19/hexo/hexo_build/Hexo%E6%95%99%E7%A8%8B/">Hexo - 博客搭建基础教程</a></li><li>完成基础配置，<a href="https://www.zywvvd.com/zywvvd.github.io/2020/02/24/hexo/hexo_config/Hexo%E7%AB%99%E7%82%B9%E9%85%8D%E7%BD%AE/">Hexo - 站点信息配置</a></li><li>了解Hexo命令，<a href="https://www.zywvvd.com/zywvvd.github.io/2020/02/25/hexo/hexo_commands/hexo-commands/">Hexo - 常用命令汇总</a></li></ul><h2 id="安装Next主题"><a href="#安装Next主题" class="headerlink" title="安装Next主题"></a>安装Next主题</h2><blockquote><p>Next最新版本为V7.7.1 (2020.02.24)，官方链接<a href="https://github.com/theme-next/hexo-theme-next">Next Github链接</a>。</p></blockquote><h3 id="下载Next仓库"><a href="#下载Next仓库" class="headerlink" title="下载Next仓库"></a>下载Next仓库</h3><blockquote><p>安装时进入Hexo根目录clone Next仓库：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd hexo<br>git clone https://github.com/theme-next/hexo-theme-next themes/next<br></code></pre></td></tr></table></figure><h3 id="更改配置文件"><a href="#更改配置文件" class="headerlink" title="更改配置文件"></a>更改配置文件</h3><blockquote><p>修改<code>站点配置文件</code>，将theme更改为next。</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Extensions</span><br><span class="hljs-comment">## Plugins: https://hexo.io/plugins/</span><br><span class="hljs-comment">## Themes: https://hexo.io/themes/</span><br><span class="hljs-attr">theme:</span> <span class="hljs-string">next</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/peizhizhutu.png"></p><blockquote><p>此时next已经安装并配置完成，更新hexo即可查看效果。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean<br>hexo g<br>hexo s<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/nextanzhuangshili.png"></p><h2 id="更换主题风格"><a href="#更换主题风格" class="headerlink" title="更换主题风格"></a>更换主题风格</h2><blockquote><p>修改<code>主题配置文件</code>中<code>scheme</code> 字段的值，默认为<code>Muse</code>：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">scheme:</span> <span class="hljs-string">Muse</span><br></code></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">scheme:</span> <span class="hljs-string">Mist</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/mist.png"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">scheme:</span> <span class="hljs-string">Pisces</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/Pisces.png"></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">scheme:</span> <span class="hljs-string">Gemini</span><br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/Gemini.png"></p><blockquote><p>我目前使用的是Gemini</p></blockquote><h2 id="更新next仓库"><a href="#更新next仓库" class="headerlink" title="更新next仓库"></a>更新next仓库</h2><blockquote><p>在hexo根目录/themes/next 文件夹下执行命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd themes/next<br>git pull<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Next</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Next</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git - 连接 Github 远程仓库</title>
    <link href="/2020/02/23/git/link_github/Git-connect-remote-pos/"/>
    <url>/2020/02/23/git/link_github/Git-connect-remote-pos/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本教程记录了本地Git与远程Github仓库连接的方法。设置成功后可以从远程仓库获取代码、将本地代码推送到远端。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><blockquote><ul><li>申请Github账号</li><li>基础Git语法知识</li><li>本地安装好Git bash运行环境</li></ul></blockquote><h2 id="建立远程仓库"><a href="#建立远程仓库" class="headerlink" title="建立远程仓库"></a>建立远程仓库</h2><blockquote><p>登录Github账号后点击右上角加号建立自己的仓库，名称自拟。</p><p>此处以test为例。</p></blockquote><p><img src="https://photos.zywvvd.com/vvd-dell-2021-win-10/xinjiancangku.png"></p><h2 id="配置-SSH-秘钥"><a href="#配置-SSH-秘钥" class="headerlink" title="配置 SSH 秘钥"></a>配置 SSH 秘钥</h2><h3 id="创建SSH密钥"><a href="#创建SSH密钥" class="headerlink" title="创建SSH密钥"></a>创建SSH密钥</h3><blockquote><p>在Git bash中执行命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa -C &quot;abc@163.com&quot;   #此处填自己注册GitHub的邮箱<br></code></pre></td></tr></table></figure><blockquote><p>没有特殊需求的话可以不设置密码，两次回车继续。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">~/vvd_git$</span><span class="bash"> ssh-keygen -t rsa -C <span class="hljs-string">&quot;zywvvd@mail.ustc.edu.cn&quot;</span></span><br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/home/zywvvd/.ssh/id_rsa): <br>Created directory &#x27;/home/zywvvd/.ssh&#x27;.<br>Enter passphrase (empty for no passphrase): <br>Enter same passphrase again: <br>Your identification has been saved in /home/zywvvd/.ssh/id_rsa.<br>Your public key has been saved in /home/zywvvd/.ssh/id_rsa.pub.<br>The key fingerprint is:<br>SHA256:klt1J9JxcGBj7xgB5dC1cXsQmK9ioOhInLRgqKppO8k zywvvd@mail.ustc.edu.cn<br>The key&#x27;s randomart image is:<br>+---[RSA 2048]----+<br>|      o+p+=o+.   |<br>|       B.Bo+ o   |<br>|      = *.+ . .  |<br>|.    o = *.  .   |<br>|oo  . . u..      |<br>|* +   . .        |<br>|+*.. . .         |<br>|*E  .  .   .     |<br>|Ooo              |<br>+----[SHA256]-----+<br></code></pre></td></tr></table></figure><blockquote><p> 得到类似上述输出即为创建成功。得到的文件放在~/.ssh文件夹中。</p></blockquote><h3 id="设置Github"><a href="#设置Github" class="headerlink" title="设置Github"></a>设置Github</h3><ul><li><p>登陆github</p></li><li><p>在settings中设置 ‘SSH and GPG keys’</p></li><li><p>添加new SSH key—— 设置名字并将.ssh 文件夹中isa.pub公钥文件的内容复制进去</p></li></ul><h3 id="测试SSH秘钥"><a href="#测试SSH秘钥" class="headerlink" title="测试SSH秘钥"></a>测试SSH秘钥</h3><blockquote><p>执行命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -T git@github.com<br></code></pre></td></tr></table></figure><blockquote><p>输出结果：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">Warning: Permanently added the RSA host key for IP address &#x27;52.74.223.139&#x27; to the list of known hosts.<br>Hi zywvvd! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.<br></code></pre></td></tr></table></figure><blockquote><p>出现欢迎字段说明SSH密钥配置成功。</p></blockquote><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="同步本地库到远程库上"><a href="#同步本地库到远程库上" class="headerlink" title="同步本地库到远程库上"></a>同步本地库到远程库上</h3><blockquote><p>在已有的本地仓库中使用remote命令链接仓库：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git remote add origin https://github.com/zywvvd/test.git<br></code></pre></td></tr></table></figure><blockquote><p>编辑本地库内容，推送到远程端：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;#example&quot; &gt;&gt; README.md<br>git add README.md<br>git commit -m &quot;README.md created&quot;<br>git push -u origin master<br></code></pre></td></tr></table></figure><p>此时可以在github端看到更新上传的说明文件。</p><h3 id="克隆仓库"><a href="#克隆仓库" class="headerlink" title="克隆仓库"></a>克隆仓库</h3><blockquote><p>执行如下命令以创建一个本地仓库的克隆版本：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone /path/to/repository<br></code></pre></td></tr></table></figure><blockquote><p>如果是远端服务器上的仓库，你的命令会是这个样子：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone username@host:/path/to/repository<br></code></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo -1- 博客搭建基础教程</title>
    <link href="/2020/02/19/hexo/1_hexo_build/Hexo/"/>
    <url>/2020/02/19/hexo/1_hexo_build/Hexo/</url>
    
    <content type="html"><![CDATA[<blockquote><p>建立个人博客的需求由来已久，能拥有自己的技术博客是广大程序员的梦想。相比于早些时候的WordPress、织梦等框架，就个人站点来说，用Hexo搭建博客可以用“怎一个爽字了得”形容。Hexo基于Node.js开发，具有轻量、方便、易部署等特点，主题丰富简约，依赖github即可构建站点，近些年受到广泛关注。此篇文章旨在和与我一样的初学者分享经验，有疑问欢迎在评论区交流。</p></blockquote><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul><li><p><code>github账号</code>：需要申请一个属于你的github账号，可以在<a href="https://github.com/">这里申请</a>。</p></li><li><p><code>git bash</code>： 需要有git bash运行环境，相关安装和使用教程请<a href="%5Bhttps://www.baidu.com/s?wd=gitbash&rsv_spt=1&rsv_iqid=0xeaa75c680004abbf&issp=1&f=8&rsv_bp=1&rsv_idx=2&ie=utf-8&tn=baiduhome_pg&rsv_enter=1&rsv_dl=ib&rsv_sug3=8&rsv_sug1=7&rsv_sug7=101&rsv_sug2=0&inputT=2890&rsv_sug4=3589">询问度娘</a>。</p></li><li><p><code>Node.js</code>： 必须安装 Node.js 开发环境，建议参考<a href="https://www.simon96.online/2018/11/10/hexo-env/">Hexo 环境搭建</a>。</p></li><li><p><code>个人域名</code>(可选)：申请自己的域名可以有自己专用的地址解析链接，我使用<a href="https://cloud.baidu.com/product/bcd/price.html">百度智能云</a>申请的域名，用着还不错，也比较便宜。</p></li><li><p><code>markdown</code>：Hexo使用Markdown解析文章，不熟悉的同学可以移步<a href="https://www.zywvvd.com/2020/02/18/Markdown-%E7%AE%80%E6%98%8E%E6%95%99%E7%A8%8B/">Markdown 简明教程</a>。</p></li><li><p><code>html\css\js基础</code>： 有最好，没有也没关系。</p></li></ul><h2 id="Hexo的安装、初始化、本地预览"><a href="#Hexo的安装、初始化、本地预览" class="headerlink" title="Hexo的安装、初始化、本地预览"></a>Hexo的安装、初始化、本地预览</h2><h3 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h3><blockquote><p>在git bash环境下输入命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g hexo-cli<br></code></pre></td></tr></table></figure><h3 id="初始化Hexo"><a href="#初始化Hexo" class="headerlink" title="初始化Hexo"></a>初始化Hexo</h3><blockquote><p>在选好的文件夹下运行命令，我们以 TestHexo 为例设立我们的第一个Hexo 站点。</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo init TestHexo<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/win11-mt/20210721180735.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd TestHexo<br>npm install<br></code></pre></td></tr></table></figure><blockquote><p>完成后在TestHexo 文件夹中会有如下内容：</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210721180755.png"></p><p>如果你坚持到了这里，那么恭喜你：</p><p>此时本地的Hexo站点已经完成了（什么不是刚开始么？？ 是的已经结束了）。</p><h3 id="本地预览"><a href="#本地预览" class="headerlink" title="本地预览"></a>本地预览</h3><blockquote><p>为了查看本地站点实际效果，输入命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo server<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo s<br></code></pre></td></tr></table></figure><blockquote><p>会在本地搭建服务器挂载生成的本地站点，通过访问 <a href="http://localhost:4000/">http://localhost:4000</a> 浏览自己的网站。</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210721180847.png"></p><h2 id="Hexo-部署到Github"><a href="#Hexo-部署到Github" class="headerlink" title="Hexo 部署到Github"></a>Hexo 部署到Github</h2><h3 id="在Github端创建仓库"><a href="#在Github端创建仓库" class="headerlink" title="在Github端创建仓库"></a>在Github端创建仓库</h3><p> 仓库名：&lt;Github 账号&gt;.github.io</p><h3 id="安装Hexo-git-插件"><a href="#安装Hexo-git-插件" class="headerlink" title="安装Hexo-git 插件"></a>安装Hexo-git 插件</h3><p>执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure><h3 id="链接本地与远程仓库"><a href="#链接本地与远程仓库" class="headerlink" title="链接本地与远程仓库"></a>链接本地与远程仓库</h3><blockquote><p>需要在本地建立SSh key，并添加到远程的github配置中。可参考<a href="https://www.zywvvd.com/zywvvd.github.io/2020/02/23/Git-%E8%BF%9E%E6%8E%A5-Github-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93/">Git 连接 Github 远程仓库</a></p></blockquote><h3 id="修改站点配置文件"><a href="#修改站点配置文件" class="headerlink" title="修改站点配置文件"></a>修改<code>站点配置文件</code></h3><blockquote><p><code>站点配置文件</code>为Hexo根目录下的 _config.yml文件，编辑该文件，找到相关部分并修改。</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># Deployment</span><br><span class="hljs-comment">## Docs: https://hexo.io/docs/deployment.html</span><br><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">git@github.com:&lt;Github账号&gt;/&lt;Github账号&gt;.github.io.git</span>  <span class="hljs-comment">#该地址写ssh地址，不写http地址。</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">main</span><br></code></pre></td></tr></table></figure><blockquote><p>修改<code>站点配置文件</code>，填入网址设置：</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment"># URL</span><br><span class="hljs-comment">## If your site is put in a subdirectory, set url as &#x27;http://yoursite.com/child&#x27; and root as &#x27;/child/&#x27;</span><br><span class="hljs-attr">url:</span> <span class="hljs-string">https:&lt;Github账号&gt;.github.io</span><br><span class="hljs-attr">root:</span> <span class="hljs-string">/</span><br></code></pre></td></tr></table></figure><h3 id="推送到Github"><a href="#推送到Github" class="headerlink" title="推送到Github"></a>推送到Github</h3><blockquote><p>依次输入命令：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo g<br>hexo d<br></code></pre></td></tr></table></figure><blockquote><p> 当见到返回：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">INFO  Deploy done: git<br></code></pre></td></tr></table></figure><blockquote><p> 即为推送成功。</p><p>至此，您的Hexo博客已经搭建在GithubPages, 域名为<code>https://&lt;Github账号&gt;.github.io</code>。</p></blockquote><h2 id="自定义域名"><a href="#自定义域名" class="headerlink" title="自定义域名"></a>自定义域名</h2><blockquote><p>在站点部署在Github基础上，您也可以将自己购买的域名解析到刚刚建立的地址。</p></blockquote><h3 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h3><blockquote><p>在域名设置界面:</p></blockquote><ul><li><p>类型选择为 CNAME；</p></li><li><p>主机记录即域名前缀，填写为www；</p></li><li><p>记录值填写为&lt;Github账号名称&gt;.github.io；</p></li><li><p>解析线路，TTL 默认即可。</p></li></ul><p><img src="https://photos.zywvvd.com/win11-mt/20210721180908.png"></p><blockquote><p>提示：域名需要按照国家要求备案</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210721180923.png"></p><h3 id="仓库设置"><a href="#仓库设置" class="headerlink" title="仓库设置"></a>仓库设置</h3><blockquote><p>进入github建立的hexo仓库，点击settings按钮设置仓库，在Custom domin中填入自己的域名，并Save：</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210721180938.png"></p><h3 id="本地设置"><a href="#本地设置" class="headerlink" title="本地设置"></a>本地设置</h3><blockquote><p>在Hexo站点目录source文件夹中，创建名为<code>CNAME</code>的文件，并向其写入<code>自定义域名</code></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo www.zywvvd.com &gt;&gt; CNAME    #域名部分请替换为你自己的<br></code></pre></td></tr></table></figure><p><img src="https://photos.zywvvd.com/win11-mt/20210721180952.png"></p><blockquote><p>几分钟之后，即可通过该域名访问Hexo站点。     <a href="https://www.zywvvd.com/">又见苍岚</a></p></blockquote><h2 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h2><blockquote><p> hexo主题有很多,默认主题为landscape。</p><p>更换主题需要下载主题包放在Hexo目录中themes文件夹内，如我下载了Next主题，文件夹如图所示。</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210721181009.png"></p><blockquote><p>并将<code>站点配置文件</code>中主题换成相应的主题名：</p></blockquote><p><img src="https://photos.zywvvd.com/win11-mt/20210721181019.png"></p><blockquote><p>主题可以在<a href="https://github.com/search?q=hexo-theme">github</a>现有的工作中挑选。</p></blockquote><h3 id="Next"><a href="#Next" class="headerlink" title="Next"></a>Next</h3><blockquote><p>个人使用的是Hexo人气最高的主题Next，当前版本 V 7.7.1，具有简介大方，原生自带大量实用工具，社区活跃等优点。</p><p>有喜欢类似风格的小伙伴可以到<a href="https://www.zywvvd.com/categories/Next/">Next 系列教程</a>了解一下。</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>文字编码 - Markdown 简明教程</title>
    <link href="/2020/02/18/words/markdown/course/Markdown/"/>
    <url>/2020/02/18/words/markdown/course/Markdown/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Markdown 是一种轻量级标记语言，文件以.md/.markdown为后缀，语法简单实用，编写的文档可以导出 HTML 、Word、图像、PDF、Epub 等多种格式，近年来快速流行在程序员群体中。本教程列举了markdown最常用的语法，仅需随便一款markdown编辑器即可轻松学习。</p></blockquote><span id="more"></span><h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><blockquote><p> 文章题目，设有6个等级，可被获取生成文章目录。</p></blockquote><p>语法：若干个(1-6)<code>#</code>后接<code>空格</code>代表不同级别(1-6)的标题</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 一级标题</span><br><span class="hljs-section">## 二级标题</span><br><span class="hljs-section">### 三级标题</span><br><span class="hljs-section">#### 四级标题</span><br><span class="hljs-section">##### 五级标题</span><br><span class="hljs-section">###### 六级标题</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721092836.png"></p><h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><blockquote><p>方便分割内容</p></blockquote><p>语法：<code>***</code> 或<code>---</code>则会出现一条线</p><p>示例编码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ---markdown">---<br>***<br></code></pre></td></tr></table></figure><p>实际效果：</p><hr><hr><h2 id="格式标记"><a href="#格式标记" class="headerlink" title="格式标记"></a>格式标记</h2><blockquote><p>简单方便的格式标记</p></blockquote><p>语法：<code>*</code> 内容<code>*</code>或<code>_</code>内容<code>_</code>标记为倾斜； <code>**</code> 内容<code>**</code> 或<code>__</code>内容<code>__</code>标记为加粗；<code>***</code> 内容<code>**</code> 或<code>___</code>内容<code>___</code>标记为加粗倾斜。</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-emphasis">*倾斜*</span><br><span class="hljs-emphasis">_倾斜_</span><br><span class="hljs-strong">**加粗**</span><br><span class="hljs-strong">__加粗__</span><br><span class="hljs-strong">**<span class="hljs-emphasis">*加粗倾斜<span class="hljs-strong">**<span class="hljs-emphasis">*</span></span></span></span><br><span class="hljs-emphasis"><span class="hljs-strong"><span class="hljs-emphasis"><span class="hljs-strong"><span class="hljs-strong">__<span class="hljs-emphasis">_加粗倾斜<span class="hljs-strong">__<span class="hljs-emphasis">_</span></span></span></span></span></span></span></span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721092816.png"></p><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><blockquote><p>内容条理化的利器，分为有序列表和无序列表</p></blockquote><h3 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h3><p>语法：<code>序号</code>加上<code>.</code>和 <code>空格</code></p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 内容1<br><span class="hljs-bullet">2.</span> 内容2<br><span class="hljs-bullet">3.</span> 内容3<br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721092755.png"></p><h3 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h3><p>语法：<code>*</code>、<code>+</code>或是<code>- </code>加 <code>空格</code> 作为列表标记</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">*</span>  内容1<br><span class="hljs-bullet">*</span>  内容2<br><span class="hljs-bullet">*</span>  内容3<br><br><span class="hljs-bullet">+</span>  内容4<br><span class="hljs-bullet">+</span>  内容5<br><span class="hljs-bullet">+</span>  内容6<br><br><span class="hljs-bullet">-</span>  内容7<br><span class="hljs-bullet">-</span> 内容8<br><span class="hljs-bullet">-</span> 内容9<br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721092735.png"></p><h3 id="列表嵌套"><a href="#列表嵌套" class="headerlink" title="列表嵌套"></a>列表嵌套</h3><p>语法： 使用<code>4个空格</code>缩进即可进行列表嵌套</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 有序内容1<br><span class="hljs-bullet">    +</span> 无序内容1<br><span class="hljs-bullet">    +</span> 无序内容2<br><span class="hljs-bullet">2.</span> 有序内容2<br><span class="hljs-bullet">    +</span> 无序内容1<br><span class="hljs-bullet">    +</span> 无序内容2<br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721092908.png"></p><h2 id="区块（引用）"><a href="#区块（引用）" class="headerlink" title="区块（引用）"></a>区块（引用）</h2><blockquote><p>为内容分区块，可嵌套</p></blockquote><p>语法：<code>&gt;</code>  加 <code>空格</code> 作为标记</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-quote">&gt; 第一层</span><br>&gt;&gt; 第二层<br>&gt;&gt;&gt; 第三层<br>&gt;&gt;&gt;&gt; 第四层<br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721092926.png"></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><blockquote><p>代码段可以用多种语言高亮显示代码，内容不会被markdown标记解释，有两种标记方式</p></blockquote><h3 id="代码片段"><a href="#代码片段" class="headerlink" title="代码片段"></a>代码片段</h3><p>语法：用前后两个`` ` (主键盘区左上角，Esc下面的按键)包裹代码片段</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-code">`cout&lt;&lt;&quot;Hello world&quot;&lt;&lt;endl; `</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721092943.png"></p><h3 id="代码区块"><a href="#代码区块" class="headerlink" title="代码区块"></a>代码区块</h3><p>语法：建议用前后各三个`` `包裹代码作为markdown中的代码段，这种语法更容易被编辑工具识别和支持</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-code">``` c++</span><br><span class="hljs-code">#include &lt;iostream&gt;</span><br><span class="hljs-code">using namespace std;</span><br><span class="hljs-code"></span><br><span class="hljs-code">int main()</span><br><span class="hljs-code">&#123;</span><br><span class="hljs-code">   cout &lt;&lt; &quot;Hello World&quot;;</span><br><span class="hljs-code">   return 0;</span><br><span class="hljs-code">&#125;</span><br><span class="hljs-code">​```</span><br><br><br>实际效果：<br><br>&#123;% asset<span class="hljs-emphasis">_img daimaduan.png 代码区块示例 %&#125;</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">## 链接</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">&gt; 编辑文本变成超链接</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">语法：</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">`[` `链接名称` `]` `(` `链接地址` `)`       或       `&lt;` `链接地址` `&gt;` （中间无空格）</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">示例编码：</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">​```markdown</span><br><span class="hljs-emphasis">[<span class="hljs-string">又见苍岚</span>](<span class="hljs-link">https://www.zywvvd.com</span>)</span><br><span class="hljs-emphasis">或</span><br><span class="hljs-emphasis"> <span class="xml">&lt;https://www.zywvvd.com&gt;</span></span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p><a href="https://www.zywvvd.com/">又见苍岚</a><br>或<br> <a href="https://www.zywvvd.com/">https://www.zywvvd.com</a></p><h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><p>语法格式：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">![<span class="hljs-string">alt 属性</span>](<span class="hljs-link">图片地址</span>)<br>![<span class="hljs-string">alt 属性</span>](<span class="hljs-link">图片地址 &quot;可选标题&quot;</span>)<br></code></pre></td></tr></table></figure><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">![<span class="hljs-string">苍岚1</span>](<span class="hljs-link">http://zywvvd.github.io/images/avatar1.jpg</span>)<br>![<span class="hljs-string">苍岚2</span>](<span class="hljs-link">http://zywvvd.github.io/images/avatar2.jpg &quot;CangLan&quot;</span>)<br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="http://zywvvd.github.io/images/avatar1.jpg" alt="苍岚1"><br><img src="http://zywvvd.github.io/images/avatar2.jpg" alt=" " title="苍岚2"></p><h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><blockquote><p>可以方便地插入表格。</p></blockquote><p>语法：用 <code>|</code> 分隔单元格，使用 <code>-</code> 来分隔表头和其他行， <code>:-</code> <code>-:</code> <code>:-:</code>分别表示左、右、中的对齐方式。</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><br>| 左对齐表头 | 右对齐表头|居中对齐表头|<br>|:--- | ---: |:---: |<br>|内容1| 内容2|内容3|<br>|内容4|内容5|内容6|<br><br></code></pre></td></tr></table></figure><p>实际效果：<br><img src="https://photos.zywvvd.com/win11-mt/20210721093025.png"></p><h2 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h2><blockquote><p>可以插入Tex或LaTex等公式编辑器生成的格式代码</p></blockquote><p>语法：输入<code>$$</code>包裹公式</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">$$<br>\mathbf&#123;X&#125;<span class="hljs-emphasis">_1\times\mathbf&#123;X&#125;_</span>2 = \mathbf&#123;X&#125;<span class="hljs-emphasis">_3</span><br><span class="hljs-emphasis">$$</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p>$$<br>\mathbf{X}_1\times\mathbf{X}_2 = \mathbf{X}_3<br>$$</p><blockquote><p>而且公式可以编号和引用：</p></blockquote><p>语法：</p><ul><li>编号：<code>\tag&#123;1&#125;</code></li><li>标签：<code>\label&#123;eq1&#125;</code></li><li>引用：<code>\eqref&#123;eq1&#125;​</code></li></ul><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">$$<br>\mathbf&#123;X&#125;<span class="hljs-emphasis">_1\times\mathbf&#123;X&#125;_</span>2 = \mathbf&#123;X&#125;<span class="hljs-emphasis">_3 \tag&#123;1&#125; \label&#123;eq1&#125;</span><br><span class="hljs-emphasis">$$</span><br><span class="hljs-emphasis">在公式$\eqref&#123;eq1&#125;$中...</span><br></code></pre></td></tr></table></figure><p>实际效果：<br>$$<br>\mathbf{X}_1\times\mathbf{X}_2 = \mathbf{X}_3 \tag{1} \label{eq2}<br>$$<br>在公式$\eqref{eq2}$中…</p><h2 id="任务列表"><a href="#任务列表" class="headerlink" title="任务列表"></a>任务列表</h2><blockquote><p>简单的任务标记</p></blockquote><p>语法：<code>- 空格[空格]空格</code>不勾选<code> -空格[x]空格</code>勾选</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> [ ] 挣他一个亿<br><span class="hljs-bullet">-</span> [x] 花个五千万<br><span class="hljs-bullet">-</span> [ ]  存个五千万<br><span class="hljs-bullet">-</span> [ ] 年利息二百万<br><span class="hljs-bullet">-</span> [ ] 实现财务自由<br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721093051.png"></p><h2 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h2><blockquote><p>支持脚注功能，鼠标悬停可以读出内容</p></blockquote><p>语法： 文中定义脚注A - <code>[^A]</code>（脚注前需要有内容），对应A的脚注文本<code>[^A]: 脚注的*文本*</code></p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">你可以使用脚注像这样[^脚注]<br>脚注前面需要有内容！！！<br>[<span class="hljs-symbol">^脚注</span>]: <span class="hljs-link">这里写脚注的*文本*</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p>你可以使用脚注像这样<a href="%E8%BF%99%E9%87%8C%E5%86%99%E8%84%9A%E6%B3%A8%E7%9A%84*%E6%96%87%E6%9C%AC*">^脚注</a><br>脚注前面需要有内容！！！</p><h2 id="高级链接"><a href="#高级链接" class="headerlink" title="高级链接"></a>高级链接</h2><blockquote><p>可以将链接地址放在变量中</p></blockquote><p>语法： 链接<code>[链接名称]</code> <code>[变量A]</code>，设置变量A <code>[A]:链接地址</code></p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">加油 [<span class="hljs-string">又见苍岚</span>][<span class="hljs-symbol">a</span>]<br><br>[<span class="hljs-symbol">a</span>]:<span class="hljs-link">https://www.zywvvd.com</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p>加油 <a href="https://www.zywvvd.com/">又见苍岚</a></p><h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><blockquote><p>markdown支持流程图功能，这里介绍框架语法，只不过不是所有markdown编辑器、显示框架都支持</p></blockquote><p>语法： ```mermaid  和  ``` 包裹的部分 可以解读成流程图</p><p>示例编码：</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs coq">` ` `mermaid<br>graph LR<br>A[方形] --&gt;B(圆角)<br>    B --&gt; C&#123;条件a&#125;<br>    C --&gt;|<span class="hljs-type">a</span>=<span class="hljs-number">1</span>| <span class="hljs-type">D</span>[结果<span class="hljs-number">1</span>]<br>    C --&gt;|<span class="hljs-type">a</span>=<span class="hljs-number">2</span>| <span class="hljs-type">E</span>[结果<span class="hljs-number">2</span>]<br>    F[横向流程图]<br>` ` `<br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721093339.png"></p><h2 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h2><blockquote><p>Markdown 使用了很多特殊符号来表示特定的意义，如果需要显示特定的符号则需要使用转义字符，Markdown 使用反斜杠转义特殊字符</p></blockquote><p>语法：<code>\</code> 加特殊字符</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-strong">**不想被加粗**</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p><strong>不想被加粗</strong></p><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><blockquote><p>markdown可以根据标题内容自动提取目录</p></blockquote><p>语法：<code>[toc]</code>回车即可</p><p>示例编码：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">[toc]<br></code></pre></td></tr></table></figure><p>实际效果：</p><p><img src="https://photos.zywvvd.com/win11-mt/20210721093117.png"></p><h2 id="使用HTML代码实现高级效果"><a href="#使用HTML代码实现高级效果" class="headerlink" title="使用HTML代码实现高级效果"></a>使用HTML代码实现高级效果</h2><blockquote><p>markdown语法简单，内容表现丰富程度有限。但其本身兼容HTML代码，可以借助其实现高级显示的效果。</p></blockquote><h3 id="文本对齐"><a href="#文本对齐" class="headerlink" title="文本对齐"></a>文本对齐</h3><blockquote><p>借助align属性可以实现文本对齐</p></blockquote><p>示例代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&#x27;center&#x27;</span>&gt;</span>居中文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&#x27;right&#x27;</span>&gt;</span>右对齐文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">align</span>=<span class="hljs-string">&#x27;left&#x27;</span>&gt;</span>左对齐文本<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><div><p align='center'>居中文本</p><p align='right'>右对齐文本</p><p align='left'>左对齐文本</p></div><h3 id="图像水平排列"><a href="#图像水平排列" class="headerlink" title="图像水平排列"></a>图像水平排列</h3><blockquote><p>markdown自带图像插入功能无法水平自由排列，借助html中的table和img标签可以实现。</p></blockquote><p>示例代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;timg.jpg&quot;</span>  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;240&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;240&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;timg.jpg&quot;</span>  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;240&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;240&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span> 图1  <span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span> 图2 <span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;timg.jpg&quot;</span>  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;240&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;240&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;timg.jpg&quot;</span>  <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;240&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;240&quot;</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span> 图3  <span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span> 图4<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><table>    <tr>        <td ><center><img src="https://photos.zywvvd.com/win11-mt/20210721093219.jpg"  height="240" width="240"> </center></td>        <td ><center><img src="https://photos.zywvvd.com/win11-mt/20210721093219.jpg"  height="240" width="240"> </center></td>    </tr>    <tr>        <td ><center> 图1  </center></td>        <td ><center> 图2 </center></td>    </tr>      <tr>        <td ><center><img src="https://photos.zywvvd.com/win11-mt/20210721093219.jpg"  height="240" width="240"> </center></td>        <td ><center><img src="https://photos.zywvvd.com/win11-mt/20210721093219.jpg"  height="240" width="240"> </center></td>    </tr>    <tr>        <td ><center> 图3  </center></td>        <td ><center> 图4</center></td>    </tr></table><h3 id="合并单元格"><a href="#合并单元格" class="headerlink" title="合并单元格"></a>合并单元格</h3><blockquote><p>markdown 自带语法只支持基本表格，复杂表格需要HTML语言描述。</p></blockquote><p>示例代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;2&quot;</span> <span class="hljs-attr">rowspan</span>=<span class="hljs-string">&quot;2&quot;</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>评估指标<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">&quot;2&quot;</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>预测结果<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>  &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>正样本<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">th</span>  &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>负样本<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>&lt;/tr &gt;<br><span class="hljs-tag">&lt;<span class="hljs-name">tr</span> &gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">rowspan</span>=<span class="hljs-string">&quot;2&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>实际<span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>情况<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>正样本<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>TP<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>FN<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> &gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>负样本<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>FP<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">center</span>&gt;</span>TN<span class="hljs-tag">&lt;/<span class="hljs-name">center</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><table>    <tr>        <th colspan="2" rowspan="2" ><center>评估指标</center></th>         <th colspan="2" ><center>预测结果</center></th>    </tr>      <tr>        <th  ><center>正样本</center></th>        <th  ><center>负样本</center></th>    </tr >    <tr >        <td rowspan="2"><center>实际<br>情况</center></td>        <td><center>正样本</center></td>        <td><center>TP</center></td>        <td><center>FN</center></td>    </tr>    <tr >        <td><center>负样本</center></td>        <td><center>FP</center></td>        <td><center>TN</center></td>    </tr></table><h3 id="文字改变颜色、大小、字体"><a href="#文字改变颜色、大小、字体" class="headerlink" title="文字改变颜色、大小、字体"></a>文字改变颜色、大小、字体</h3><p>示例代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">face</span>=<span class="hljs-string">&quot;宋体&quot;</span> &gt;</span>我是宋体字<span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">font</span>  <span class="hljs-attr">size</span>=<span class="hljs-string">10</span>&gt;</span>我是10号字<span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">color</span>=<span class="hljs-string">red</span>&gt;</span>我是红色字<span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">color</span>=<span class="hljs-string">red</span> <span class="hljs-attr">size</span>=<span class="hljs-string">10</span> <span class="hljs-attr">face</span>=<span class="hljs-string">&#x27;宋体&#x27;</span>&gt;</span>我是红色10号宋体字<span class="hljs-tag">&lt;/<span class="hljs-name">font</span>&gt;</span><br></code></pre></td></tr></table></figure><p>实际效果：</p><p><font face="宋体" >我是宋体字</font></p><p><font  size=10>我是10号字</font></p><p><font color=red>我是红色字</font></p><p><font color=red size=10 face='宋体'>我是红色10号宋体字</font></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <categories>
      
      <category>文字编码</category>
      
    </categories>
    
    
    <tags>
      
      <tag>文字编码</tag>
      
      <tag>Markdown</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
